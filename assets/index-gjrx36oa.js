function goe(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in e)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(e,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var Zqe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gY(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var vY={exports:{}},HC={},yY={exports:{}},Ri={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ib=Symbol.for("react.element"),voe=Symbol.for("react.portal"),yoe=Symbol.for("react.fragment"),xoe=Symbol.for("react.strict_mode"),boe=Symbol.for("react.profiler"),woe=Symbol.for("react.provider"),_oe=Symbol.for("react.context"),Soe=Symbol.for("react.forward_ref"),Moe=Symbol.for("react.suspense"),Eoe=Symbol.for("react.memo"),Aoe=Symbol.for("react.lazy"),a5=Symbol.iterator;function Coe(e){return e===null||typeof e!="object"?null:(e=a5&&e[a5]||e["@@iterator"],typeof e=="function"?e:null)}var xY={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bY=Object.assign,wY={};function w0(e,t,i){this.props=e,this.context=t,this.refs=wY,this.updater=i||xY}w0.prototype.isReactComponent={};w0.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};w0.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function _Y(){}_Y.prototype=w0.prototype;function bz(e,t,i){this.props=e,this.context=t,this.refs=wY,this.updater=i||xY}var wz=bz.prototype=new _Y;wz.constructor=bz;bY(wz,w0.prototype);wz.isPureReactComponent=!0;var o5=Array.isArray,SY=Object.prototype.hasOwnProperty,_z={current:null},MY={key:!0,ref:!0,__self:!0,__source:!0};function EY(e,t,i){var r,n={},s=null,a=null;if(t!=null)for(r in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(s=""+t.key),t)SY.call(t,r)&&!MY.hasOwnProperty(r)&&(n[r]=t[r]);var o=arguments.length-2;if(o===1)n.children=i;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];n.children=l}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)n[r]===void 0&&(n[r]=o[r]);return{$$typeof:Ib,type:e,key:s,ref:a,props:n,_owner:_z.current}}function Toe(e,t){return{$$typeof:Ib,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Sz(e){return typeof e=="object"&&e!==null&&e.$$typeof===Ib}function Poe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var l5=/\/+/g;function vP(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Poe(""+e.key):t.toString(36)}function $M(e,t,i,r,n){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case Ib:case voe:a=!0}}if(a)return a=e,n=n(a),e=r===""?"."+vP(a,0):r,o5(n)?(i="",e!=null&&(i=e.replace(l5,"$&/")+"/"),$M(n,t,i,"",function(c){return c})):n!=null&&(Sz(n)&&(n=Toe(n,i+(!n.key||a&&a.key===n.key?"":(""+n.key).replace(l5,"$&/")+"/")+e)),t.push(n)),1;if(a=0,r=r===""?".":r+":",o5(e))for(var o=0;o<e.length;o++){s=e[o];var l=r+vP(s,o);a+=$M(s,t,i,l,n)}else if(l=Coe(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=r+vP(s,o++),a+=$M(s,t,i,l,n);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function h_(e,t,i){if(e==null)return e;var r=[],n=0;return $M(e,r,"","",function(s){return t.call(i,s,n++)}),r}function Doe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Sa={current:null},eE={transition:null},Loe={ReactCurrentDispatcher:Sa,ReactCurrentBatchConfig:eE,ReactCurrentOwner:_z};function AY(){throw Error("act(...) is not supported in production builds of React.")}Ri.Children={map:h_,forEach:function(e,t,i){h_(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return h_(e,function(){t++}),t},toArray:function(e){return h_(e,function(t){return t})||[]},only:function(e){if(!Sz(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ri.Component=w0;Ri.Fragment=yoe;Ri.Profiler=boe;Ri.PureComponent=bz;Ri.StrictMode=xoe;Ri.Suspense=Moe;Ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Loe;Ri.act=AY;Ri.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=bY({},e.props),n=e.key,s=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,a=_z.current),t.key!==void 0&&(n=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)SY.call(t,l)&&!MY.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:Ib,type:e.type,key:n,ref:s,props:r,_owner:a}};Ri.createContext=function(e){return e={$$typeof:_oe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:woe,_context:e},e.Consumer=e};Ri.createElement=EY;Ri.createFactory=function(e){var t=EY.bind(null,e);return t.type=e,t};Ri.createRef=function(){return{current:null}};Ri.forwardRef=function(e){return{$$typeof:Soe,render:e}};Ri.isValidElement=Sz;Ri.lazy=function(e){return{$$typeof:Aoe,_payload:{_status:-1,_result:e},_init:Doe}};Ri.memo=function(e,t){return{$$typeof:Eoe,type:e,compare:t===void 0?null:t}};Ri.startTransition=function(e){var t=eE.transition;eE.transition={};try{e()}finally{eE.transition=t}};Ri.unstable_act=AY;Ri.useCallback=function(e,t){return Sa.current.useCallback(e,t)};Ri.useContext=function(e){return Sa.current.useContext(e)};Ri.useDebugValue=function(){};Ri.useDeferredValue=function(e){return Sa.current.useDeferredValue(e)};Ri.useEffect=function(e,t){return Sa.current.useEffect(e,t)};Ri.useId=function(){return Sa.current.useId()};Ri.useImperativeHandle=function(e,t,i){return Sa.current.useImperativeHandle(e,t,i)};Ri.useInsertionEffect=function(e,t){return Sa.current.useInsertionEffect(e,t)};Ri.useLayoutEffect=function(e,t){return Sa.current.useLayoutEffect(e,t)};Ri.useMemo=function(e,t){return Sa.current.useMemo(e,t)};Ri.useReducer=function(e,t,i){return Sa.current.useReducer(e,t,i)};Ri.useRef=function(e){return Sa.current.useRef(e)};Ri.useState=function(e){return Sa.current.useState(e)};Ri.useSyncExternalStore=function(e,t,i){return Sa.current.useSyncExternalStore(e,t,i)};Ri.useTransition=function(){return Sa.current.useTransition()};Ri.version="18.3.1";yY.exports=Ri;var R=yY.exports;const FE=gY(R),Roe=goe({__proto__:null,default:FE},[R]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ioe=R,Ooe=Symbol.for("react.element"),Noe=Symbol.for("react.fragment"),zoe=Object.prototype.hasOwnProperty,Boe=Ioe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,koe={key:!0,ref:!0,__self:!0,__source:!0};function CY(e,t,i){var r,n={},s=null,a=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(a=t.ref);for(r in t)zoe.call(t,r)&&!koe.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)n[r]===void 0&&(n[r]=t[r]);return{$$typeof:Ooe,type:e,key:s,ref:a,props:n,_owner:Boe.current}}HC.Fragment=Noe;HC.jsx=CY;HC.jsxs=CY;vY.exports=HC;var j=vY.exports,TY={exports:{}},xo={},PY={exports:{}},DY={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(O,V){var F=O.length;O.push(V);e:for(;0<F;){var W=F-1>>>1,ee=O[W];if(0<n(ee,V))O[W]=V,O[F]=ee,F=W;else break e}}function i(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var V=O[0],F=O.pop();if(F!==V){O[0]=F;e:for(var W=0,ee=O.length,ae=ee>>>1;W<ae;){var K=2*(W+1)-1,$=O[K],ie=K+1,ye=O[ie];if(0>n($,F))ie<ee&&0>n(ye,$)?(O[W]=ye,O[ie]=F,W=ie):(O[W]=$,O[K]=F,W=K);else if(ie<ee&&0>n(ye,F))O[W]=ye,O[ie]=F,W=ie;else break e}}return V}function n(O,V){var F=O.sortIndex-V.sortIndex;return F!==0?F:O.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(O){for(var V=i(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=O)r(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=i(c)}}function _(O){if(v=!1,x(O),!f)if(i(l)!==null)f=!0,Q(M);else{var V=i(c);V!==null&&Y(_,V.startTime-O)}}function M(O,V){f=!1,v&&(v=!1,g(A),A=-1),p=!0;var F=d;try{for(x(V),h=i(l);h!==null&&(!(h.expirationTime>V)||O&&!D());){var W=h.callback;if(typeof W=="function"){h.callback=null,d=h.priorityLevel;var ee=W(h.expirationTime<=V);V=e.unstable_now(),typeof ee=="function"?h.callback=ee:h===i(l)&&r(l),x(V)}else r(l);h=i(l)}if(h!==null)var ae=!0;else{var K=i(c);K!==null&&Y(_,K.startTime-V),ae=!1}return ae}finally{h=null,d=F,p=!1}}var S=!1,E=null,A=-1,P=5,C=-1;function D(){return!(e.unstable_now()-C<P)}function N(){if(E!==null){var O=e.unstable_now();C=O;var V=!0;try{V=E(!0,O)}finally{V?U():(S=!1,E=null)}}else S=!1}var U;if(typeof y=="function")U=function(){y(N)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,G=I.port2;I.port1.onmessage=N,U=function(){G.postMessage(null)}}else U=function(){m(N,0)};function Q(O){E=O,S||(S=!0,U())}function Y(O,V){A=m(function(){O(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,Q(M))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var V=3;break;default:V=d}var F=d;d=V;try{return O()}finally{d=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,V){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var F=d;d=O;try{return V()}finally{d=F}},e.unstable_scheduleCallback=function(O,V,F){var W=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?W+F:W):F=W,O){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=F+ee,O={id:u++,callback:V,priorityLevel:O,startTime:F,expirationTime:ee,sortIndex:-1},F>W?(O.sortIndex=F,t(c,O),i(l)===null&&O===i(c)&&(v?(g(A),A=-1):v=!0,Y(_,F-W))):(O.sortIndex=ee,t(l,O),f||p||(f=!0,Q(M))),O},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(O){var V=d;return function(){var F=d;d=V;try{return O.apply(this,arguments)}finally{d=F}}}})(DY);PY.exports=DY;var Uoe=PY.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Foe=R,mo=Uoe;function ft(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var LY=new Set,gx={};function om(e,t){Wv(e,t),Wv(e+"Capture",t)}function Wv(e,t){for(gx[e]=t,e=0;e<t.length;e++)LY.add(t[e])}var eh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cR=Object.prototype.hasOwnProperty,Voe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c5={},u5={};function joe(e){return cR.call(u5,e)?!0:cR.call(c5,e)?!1:Voe.test(e)?u5[e]=!0:(c5[e]=!0,!1)}function Hoe(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Goe(e,t,i,r){if(t===null||typeof t>"u"||Hoe(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ma(e,t,i,r,n,s,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var Cs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Cs[e]=new Ma(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Cs[t]=new Ma(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Cs[e]=new Ma(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Cs[e]=new Ma(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Cs[e]=new Ma(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Cs[e]=new Ma(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Cs[e]=new Ma(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Cs[e]=new Ma(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Cs[e]=new Ma(e,5,!1,e.toLowerCase(),null,!1,!1)});var Mz=/[\-:]([a-z])/g;function Ez(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Mz,Ez);Cs[t]=new Ma(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Mz,Ez);Cs[t]=new Ma(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Mz,Ez);Cs[t]=new Ma(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Cs[e]=new Ma(e,1,!1,e.toLowerCase(),null,!1,!1)});Cs.xlinkHref=new Ma("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Cs[e]=new Ma(e,1,!1,e.toLowerCase(),null,!0,!0)});function Az(e,t,i,r){var n=Cs.hasOwnProperty(t)?Cs[t]:null;(n!==null?n.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Goe(t,i,n,r)&&(i=null),r||n===null?joe(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=i===null?n.type===3?!1:"":i:(t=n.attributeName,r=n.attributeNamespace,i===null?e.removeAttribute(t):(n=n.type,i=n===3||n===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var fh=Foe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,d_=Symbol.for("react.element"),Yg=Symbol.for("react.portal"),Zg=Symbol.for("react.fragment"),Cz=Symbol.for("react.strict_mode"),uR=Symbol.for("react.profiler"),RY=Symbol.for("react.provider"),IY=Symbol.for("react.context"),Tz=Symbol.for("react.forward_ref"),hR=Symbol.for("react.suspense"),dR=Symbol.for("react.suspense_list"),Pz=Symbol.for("react.memo"),ed=Symbol.for("react.lazy"),OY=Symbol.for("react.offscreen"),h5=Symbol.iterator;function my(e){return e===null||typeof e!="object"?null:(e=h5&&e[h5]||e["@@iterator"],typeof e=="function"?e:null)}var Vr=Object.assign,yP;function g1(e){if(yP===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);yP=t&&t[1]||""}return`
`+yP+e}var xP=!1;function bP(e,t){if(!e||xP)return"";xP=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=r.stack.split(`
`),a=n.length-1,o=s.length-1;1<=a&&0<=o&&n[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(n[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||n[a]!==s[o]){var l=`
`+n[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=a&&0<=o);break}}}finally{xP=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?g1(e):""}function Woe(e){switch(e.tag){case 5:return g1(e.type);case 16:return g1("Lazy");case 13:return g1("Suspense");case 19:return g1("SuspenseList");case 0:case 2:case 15:return e=bP(e.type,!1),e;case 11:return e=bP(e.type.render,!1),e;case 1:return e=bP(e.type,!0),e;default:return""}}function pR(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Zg:return"Fragment";case Yg:return"Portal";case uR:return"Profiler";case Cz:return"StrictMode";case hR:return"Suspense";case dR:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case IY:return(e.displayName||"Context")+".Consumer";case RY:return(e._context.displayName||"Context")+".Provider";case Tz:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Pz:return t=e.displayName||null,t!==null?t:pR(e.type)||"Memo";case ed:t=e._payload,e=e._init;try{return pR(e(t))}catch{}}return null}function Xoe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pR(t);case 8:return t===Cz?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Wd(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function NY(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function qoe(e){var t=NY(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var n=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function p_(e){e._valueTracker||(e._valueTracker=qoe(e))}function zY(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=NY(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function VE(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function fR(e,t){var i=t.checked;return Vr({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function d5(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=Wd(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function BY(e,t){t=t.checked,t!=null&&Az(e,"checked",t,!1)}function mR(e,t){BY(e,t);var i=Wd(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?gR(e,t.type,i):t.hasOwnProperty("defaultValue")&&gR(e,t.type,Wd(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function p5(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function gR(e,t,i){(t!=="number"||VE(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var v1=Array.isArray;function Mv(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+Wd(i),t=null,n=0;n<e.length;n++){if(e[n].value===i){e[n].selected=!0,r&&(e[n].defaultSelected=!0);return}t!==null||e[n].disabled||(t=e[n])}t!==null&&(t.selected=!0)}}function vR(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ft(91));return Vr({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function f5(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(ft(92));if(v1(i)){if(1<i.length)throw Error(ft(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:Wd(i)}}function kY(e,t){var i=Wd(t.value),r=Wd(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function m5(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function UY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function yR(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?UY(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var f_,FY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,n){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,n)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(f_=f_||document.createElement("div"),f_.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=f_.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function vx(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var N1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Yoe=["Webkit","ms","Moz","O"];Object.keys(N1).forEach(function(e){Yoe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),N1[t]=N1[e]})});function VY(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||N1.hasOwnProperty(e)&&N1[e]?(""+t).trim():t+"px"}function jY(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,n=VY(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}var Zoe=Vr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xR(e,t){if(t){if(Zoe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ft(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ft(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ft(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ft(62))}}function bR(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wR=null;function Dz(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var _R=null,Ev=null,Av=null;function g5(e){if(e=zb(e)){if(typeof _R!="function")throw Error(ft(280));var t=e.stateNode;t&&(t=YC(t),_R(e.stateNode,e.type,t))}}function HY(e){Ev?Av?Av.push(e):Av=[e]:Ev=e}function GY(){if(Ev){var e=Ev,t=Av;if(Av=Ev=null,g5(e),t)for(e=0;e<t.length;e++)g5(t[e])}}function WY(e,t){return e(t)}function XY(){}var wP=!1;function qY(e,t,i){if(wP)return e(t,i);wP=!0;try{return WY(e,t,i)}finally{wP=!1,(Ev!==null||Av!==null)&&(XY(),GY())}}function yx(e,t){var i=e.stateNode;if(i===null)return null;var r=YC(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(ft(231,t,typeof i));return i}var SR=!1;if(eh)try{var gy={};Object.defineProperty(gy,"passive",{get:function(){SR=!0}}),window.addEventListener("test",gy,gy),window.removeEventListener("test",gy,gy)}catch{SR=!1}function Qoe(e,t,i,r,n,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(u){this.onError(u)}}var z1=!1,jE=null,HE=!1,MR=null,Koe={onError:function(e){z1=!0,jE=e}};function Joe(e,t,i,r,n,s,a,o,l){z1=!1,jE=null,Qoe.apply(Koe,arguments)}function $oe(e,t,i,r,n,s,a,o,l){if(Joe.apply(this,arguments),z1){if(z1){var c=jE;z1=!1,jE=null}else throw Error(ft(198));HE||(HE=!0,MR=c)}}function lm(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function YY(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function v5(e){if(lm(e)!==e)throw Error(ft(188))}function ele(e){var t=e.alternate;if(!t){if(t=lm(e),t===null)throw Error(ft(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(n===null)break;var s=n.alternate;if(s===null){if(r=n.return,r!==null){i=r;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===i)return v5(n),e;if(s===r)return v5(n),t;s=s.sibling}throw Error(ft(188))}if(i.return!==r.return)i=n,r=s;else{for(var a=!1,o=n.child;o;){if(o===i){a=!0,i=n,r=s;break}if(o===r){a=!0,r=n,i=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===i){a=!0,i=s,r=n;break}if(o===r){a=!0,r=s,i=n;break}o=o.sibling}if(!a)throw Error(ft(189))}}if(i.alternate!==r)throw Error(ft(190))}if(i.tag!==3)throw Error(ft(188));return i.stateNode.current===i?e:t}function ZY(e){return e=ele(e),e!==null?QY(e):null}function QY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=QY(e);if(t!==null)return t;e=e.sibling}return null}var KY=mo.unstable_scheduleCallback,y5=mo.unstable_cancelCallback,tle=mo.unstable_shouldYield,ile=mo.unstable_requestPaint,un=mo.unstable_now,rle=mo.unstable_getCurrentPriorityLevel,Lz=mo.unstable_ImmediatePriority,JY=mo.unstable_UserBlockingPriority,GE=mo.unstable_NormalPriority,nle=mo.unstable_LowPriority,$Y=mo.unstable_IdlePriority,GC=null,Rc=null;function sle(e){if(Rc&&typeof Rc.onCommitFiberRoot=="function")try{Rc.onCommitFiberRoot(GC,e,void 0,(e.current.flags&128)===128)}catch{}}var Bl=Math.clz32?Math.clz32:lle,ale=Math.log,ole=Math.LN2;function lle(e){return e>>>=0,e===0?32:31-(ale(e)/ole|0)|0}var m_=64,g_=4194304;function y1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function WE(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,n=e.suspendedLanes,s=e.pingedLanes,a=i&268435455;if(a!==0){var o=a&~n;o!==0?r=y1(o):(s&=a,s!==0&&(r=y1(s)))}else a=i&~n,a!==0?r=y1(a):s!==0&&(r=y1(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&n)&&(n=r&-r,s=t&-t,n>=s||n===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-Bl(t),n=1<<i,r|=e[i],t&=~n;return r}function cle(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ule(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-Bl(s),o=1<<a,l=n[a];l===-1?(!(o&i)||o&r)&&(n[a]=cle(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function ER(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function eZ(){var e=m_;return m_<<=1,!(m_&4194240)&&(m_=64),e}function _P(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Ob(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Bl(t),e[t]=i}function hle(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-Bl(i),s=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~s}}function Rz(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-Bl(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var or=0;function tZ(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var iZ,Iz,rZ,nZ,sZ,AR=!1,v_=[],Ad=null,Cd=null,Td=null,xx=new Map,bx=new Map,sd=[],dle="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function x5(e,t){switch(e){case"focusin":case"focusout":Ad=null;break;case"dragenter":case"dragleave":Cd=null;break;case"mouseover":case"mouseout":Td=null;break;case"pointerover":case"pointerout":xx.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":bx.delete(t.pointerId)}}function vy(e,t,i,r,n,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[n]},t!==null&&(t=zb(t),t!==null&&Iz(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,n!==null&&t.indexOf(n)===-1&&t.push(n),e)}function ple(e,t,i,r,n){switch(t){case"focusin":return Ad=vy(Ad,e,t,i,r,n),!0;case"dragenter":return Cd=vy(Cd,e,t,i,r,n),!0;case"mouseover":return Td=vy(Td,e,t,i,r,n),!0;case"pointerover":var s=n.pointerId;return xx.set(s,vy(xx.get(s)||null,e,t,i,r,n)),!0;case"gotpointercapture":return s=n.pointerId,bx.set(s,vy(bx.get(s)||null,e,t,i,r,n)),!0}return!1}function aZ(e){var t=pf(e.target);if(t!==null){var i=lm(t);if(i!==null){if(t=i.tag,t===13){if(t=YY(i),t!==null){e.blockedOn=t,sZ(e.priority,function(){rZ(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function tE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=CR(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);wR=r,i.target.dispatchEvent(r),wR=null}else return t=zb(i),t!==null&&Iz(t),e.blockedOn=i,!1;t.shift()}return!0}function b5(e,t,i){tE(e)&&i.delete(t)}function fle(){AR=!1,Ad!==null&&tE(Ad)&&(Ad=null),Cd!==null&&tE(Cd)&&(Cd=null),Td!==null&&tE(Td)&&(Td=null),xx.forEach(b5),bx.forEach(b5)}function yy(e,t){e.blockedOn===t&&(e.blockedOn=null,AR||(AR=!0,mo.unstable_scheduleCallback(mo.unstable_NormalPriority,fle)))}function wx(e){function t(n){return yy(n,e)}if(0<v_.length){yy(v_[0],e);for(var i=1;i<v_.length;i++){var r=v_[i];r.blockedOn===e&&(r.blockedOn=null)}}for(Ad!==null&&yy(Ad,e),Cd!==null&&yy(Cd,e),Td!==null&&yy(Td,e),xx.forEach(t),bx.forEach(t),i=0;i<sd.length;i++)r=sd[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<sd.length&&(i=sd[0],i.blockedOn===null);)aZ(i),i.blockedOn===null&&sd.shift()}var Cv=fh.ReactCurrentBatchConfig,XE=!0;function mle(e,t,i,r){var n=or,s=Cv.transition;Cv.transition=null;try{or=1,Oz(e,t,i,r)}finally{or=n,Cv.transition=s}}function gle(e,t,i,r){var n=or,s=Cv.transition;Cv.transition=null;try{or=4,Oz(e,t,i,r)}finally{or=n,Cv.transition=s}}function Oz(e,t,i,r){if(XE){var n=CR(e,t,i,r);if(n===null)RP(e,t,r,qE,i),x5(e,r);else if(ple(n,e,t,i,r))r.stopPropagation();else if(x5(e,r),t&4&&-1<dle.indexOf(e)){for(;n!==null;){var s=zb(n);if(s!==null&&iZ(s),s=CR(e,t,i,r),s===null&&RP(e,t,r,qE,i),s===n)break;n=s}n!==null&&r.stopPropagation()}else RP(e,t,r,null,i)}}var qE=null;function CR(e,t,i,r){if(qE=null,e=Dz(r),e=pf(e),e!==null)if(t=lm(e),t===null)e=null;else if(i=t.tag,i===13){if(e=YY(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qE=e,null}function oZ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rle()){case Lz:return 1;case JY:return 4;case GE:case nle:return 16;case $Y:return 536870912;default:return 16}default:return 16}}var fd=null,Nz=null,iE=null;function lZ(){if(iE)return iE;var e,t=Nz,i=t.length,r,n="value"in fd?fd.value:fd.textContent,s=n.length;for(e=0;e<i&&t[e]===n[e];e++);var a=i-e;for(r=1;r<=a&&t[i-r]===n[s-r];r++);return iE=n.slice(e,1<r?1-r:void 0)}function rE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function y_(){return!0}function w5(){return!1}function bo(e){function t(i,r,n,s,a){this._reactName=i,this._targetInst=n,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?y_:w5,this.isPropagationStopped=w5,this}return Vr(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=y_)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=y_)},persist:function(){},isPersistent:y_}),t}var _0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zz=bo(_0),Nb=Vr({},_0,{view:0,detail:0}),vle=bo(Nb),SP,MP,xy,WC=Vr({},Nb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bz,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==xy&&(xy&&e.type==="mousemove"?(SP=e.screenX-xy.screenX,MP=e.screenY-xy.screenY):MP=SP=0,xy=e),SP)},movementY:function(e){return"movementY"in e?e.movementY:MP}}),_5=bo(WC),yle=Vr({},WC,{dataTransfer:0}),xle=bo(yle),ble=Vr({},Nb,{relatedTarget:0}),EP=bo(ble),wle=Vr({},_0,{animationName:0,elapsedTime:0,pseudoElement:0}),_le=bo(wle),Sle=Vr({},_0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Mle=bo(Sle),Ele=Vr({},_0,{data:0}),S5=bo(Ele),Ale={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cle={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tle={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ple(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Tle[e])?!!t[e]:!1}function Bz(){return Ple}var Dle=Vr({},Nb,{key:function(e){if(e.key){var t=Ale[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=rE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Cle[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bz,charCode:function(e){return e.type==="keypress"?rE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?rE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Lle=bo(Dle),Rle=Vr({},WC,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),M5=bo(Rle),Ile=Vr({},Nb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bz}),Ole=bo(Ile),Nle=Vr({},_0,{propertyName:0,elapsedTime:0,pseudoElement:0}),zle=bo(Nle),Ble=Vr({},WC,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),kle=bo(Ble),Ule=[9,13,27,32],kz=eh&&"CompositionEvent"in window,B1=null;eh&&"documentMode"in document&&(B1=document.documentMode);var Fle=eh&&"TextEvent"in window&&!B1,cZ=eh&&(!kz||B1&&8<B1&&11>=B1),E5=" ",A5=!1;function uZ(e,t){switch(e){case"keyup":return Ule.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hZ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Qg=!1;function Vle(e,t){switch(e){case"compositionend":return hZ(t);case"keypress":return t.which!==32?null:(A5=!0,E5);case"textInput":return e=t.data,e===E5&&A5?null:e;default:return null}}function jle(e,t){if(Qg)return e==="compositionend"||!kz&&uZ(e,t)?(e=lZ(),iE=Nz=fd=null,Qg=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return cZ&&t.locale!=="ko"?null:t.data;default:return null}}var Hle={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function C5(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Hle[e.type]:t==="textarea"}function dZ(e,t,i,r){HY(r),t=YE(t,"onChange"),0<t.length&&(i=new zz("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var k1=null,_x=null;function Gle(e){SZ(e,0)}function XC(e){var t=$g(e);if(zY(t))return e}function Wle(e,t){if(e==="change")return t}var pZ=!1;if(eh){var AP;if(eh){var CP="oninput"in document;if(!CP){var T5=document.createElement("div");T5.setAttribute("oninput","return;"),CP=typeof T5.oninput=="function"}AP=CP}else AP=!1;pZ=AP&&(!document.documentMode||9<document.documentMode)}function P5(){k1&&(k1.detachEvent("onpropertychange",fZ),_x=k1=null)}function fZ(e){if(e.propertyName==="value"&&XC(_x)){var t=[];dZ(t,_x,e,Dz(e)),qY(Gle,t)}}function Xle(e,t,i){e==="focusin"?(P5(),k1=t,_x=i,k1.attachEvent("onpropertychange",fZ)):e==="focusout"&&P5()}function qle(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return XC(_x)}function Yle(e,t){if(e==="click")return XC(t)}function Zle(e,t){if(e==="input"||e==="change")return XC(t)}function Qle(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Fl=typeof Object.is=="function"?Object.is:Qle;function Sx(e,t){if(Fl(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!cR.call(t,n)||!Fl(e[n],t[n]))return!1}return!0}function D5(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function L5(e,t){var i=D5(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=D5(i)}}function mZ(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?mZ(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function gZ(){for(var e=window,t=VE();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=VE(e.document)}return t}function Uz(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Kle(e){var t=gZ(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&mZ(i.ownerDocument.documentElement,i)){if(r!==null&&Uz(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var n=i.textContent.length,s=Math.min(r.start,n);r=r.end===void 0?s:Math.min(r.end,n),!e.extend&&s>r&&(n=r,r=s,s=n),n=L5(i,s);var a=L5(i,r);n&&a&&(e.rangeCount!==1||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(n.node,n.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Jle=eh&&"documentMode"in document&&11>=document.documentMode,Kg=null,TR=null,U1=null,PR=!1;function R5(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;PR||Kg==null||Kg!==VE(r)||(r=Kg,"selectionStart"in r&&Uz(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),U1&&Sx(U1,r)||(U1=r,r=YE(TR,"onSelect"),0<r.length&&(t=new zz("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=Kg)))}function x_(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Jg={animationend:x_("Animation","AnimationEnd"),animationiteration:x_("Animation","AnimationIteration"),animationstart:x_("Animation","AnimationStart"),transitionend:x_("Transition","TransitionEnd")},TP={},vZ={};eh&&(vZ=document.createElement("div").style,"AnimationEvent"in window||(delete Jg.animationend.animation,delete Jg.animationiteration.animation,delete Jg.animationstart.animation),"TransitionEvent"in window||delete Jg.transitionend.transition);function qC(e){if(TP[e])return TP[e];if(!Jg[e])return e;var t=Jg[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in vZ)return TP[e]=t[i];return e}var yZ=qC("animationend"),xZ=qC("animationiteration"),bZ=qC("animationstart"),wZ=qC("transitionend"),_Z=new Map,I5="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tp(e,t){_Z.set(e,t),om(t,[e])}for(var PP=0;PP<I5.length;PP++){var DP=I5[PP],$le=DP.toLowerCase(),ece=DP[0].toUpperCase()+DP.slice(1);tp($le,"on"+ece)}tp(yZ,"onAnimationEnd");tp(xZ,"onAnimationIteration");tp(bZ,"onAnimationStart");tp("dblclick","onDoubleClick");tp("focusin","onFocus");tp("focusout","onBlur");tp(wZ,"onTransitionEnd");Wv("onMouseEnter",["mouseout","mouseover"]);Wv("onMouseLeave",["mouseout","mouseover"]);Wv("onPointerEnter",["pointerout","pointerover"]);Wv("onPointerLeave",["pointerout","pointerover"]);om("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));om("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));om("onBeforeInput",["compositionend","keypress","textInput","paste"]);om("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));om("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));om("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var x1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tce=new Set("cancel close invalid load scroll toggle".split(" ").concat(x1));function O5(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,$oe(r,t,void 0,e),e.currentTarget=null}function SZ(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&n.isPropagationStopped())break e;O5(n,o,c),s=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&n.isPropagationStopped())break e;O5(n,o,c),s=l}}}if(HE)throw e=MR,HE=!1,MR=null,e}function Mr(e,t){var i=t[OR];i===void 0&&(i=t[OR]=new Set);var r=e+"__bubble";i.has(r)||(MZ(t,e,2,!1),i.add(r))}function LP(e,t,i){var r=0;t&&(r|=4),MZ(i,e,r,t)}var b_="_reactListening"+Math.random().toString(36).slice(2);function Mx(e){if(!e[b_]){e[b_]=!0,LY.forEach(function(i){i!=="selectionchange"&&(tce.has(i)||LP(i,!1,e),LP(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[b_]||(t[b_]=!0,LP("selectionchange",!1,t))}}function MZ(e,t,i,r){switch(oZ(t)){case 1:var n=mle;break;case 4:n=gle;break;default:n=Oz}i=n.bind(null,t,i,e),n=void 0,!SR||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(n=!0),r?n!==void 0?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):n!==void 0?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function RP(e,t,i,r,n){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;a=a.return}for(;o!==null;){if(a=pf(o),a===null)return;if(l=a.tag,l===5||l===6){r=s=a;continue e}o=o.parentNode}}r=r.return}qY(function(){var c=s,u=Dz(i),h=[];e:{var d=_Z.get(e);if(d!==void 0){var p=zz,f=e;switch(e){case"keypress":if(rE(i)===0)break e;case"keydown":case"keyup":p=Lle;break;case"focusin":f="focus",p=EP;break;case"focusout":f="blur",p=EP;break;case"beforeblur":case"afterblur":p=EP;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=_5;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=xle;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Ole;break;case yZ:case xZ:case bZ:p=_le;break;case wZ:p=zle;break;case"scroll":p=vle;break;case"wheel":p=kle;break;case"copy":case"cut":case"paste":p=Mle;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=M5}var v=(t&4)!==0,m=!v&&e==="scroll",g=v?d!==null?d+"Capture":null:d;v=[];for(var y=c,x;y!==null;){x=y;var _=x.stateNode;if(x.tag===5&&_!==null&&(x=_,g!==null&&(_=yx(y,g),_!=null&&v.push(Ex(y,_,x)))),m)break;y=y.return}0<v.length&&(d=new p(d,f,null,i,u),h.push({event:d,listeners:v}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&i!==wR&&(f=i.relatedTarget||i.fromElement)&&(pf(f)||f[th]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=i.relatedTarget||i.toElement,p=c,f=f?pf(f):null,f!==null&&(m=lm(f),f!==m||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(v=_5,_="onMouseLeave",g="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(v=M5,_="onPointerLeave",g="onPointerEnter",y="pointer"),m=p==null?d:$g(p),x=f==null?d:$g(f),d=new v(_,y+"leave",p,i,u),d.target=m,d.relatedTarget=x,_=null,pf(u)===c&&(v=new v(g,y+"enter",f,i,u),v.target=x,v.relatedTarget=m,_=v),m=_,p&&f)t:{for(v=p,g=f,y=0,x=v;x;x=Bm(x))y++;for(x=0,_=g;_;_=Bm(_))x++;for(;0<y-x;)v=Bm(v),y--;for(;0<x-y;)g=Bm(g),x--;for(;y--;){if(v===g||g!==null&&v===g.alternate)break t;v=Bm(v),g=Bm(g)}v=null}else v=null;p!==null&&N5(h,d,p,v,!1),f!==null&&m!==null&&N5(h,m,f,v,!0)}}e:{if(d=c?$g(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var M=Wle;else if(C5(d))if(pZ)M=Zle;else{M=qle;var S=Xle}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(M=Yle);if(M&&(M=M(e,c))){dZ(h,M,i,u);break e}S&&S(e,d,c),e==="focusout"&&(S=d._wrapperState)&&S.controlled&&d.type==="number"&&gR(d,"number",d.value)}switch(S=c?$g(c):window,e){case"focusin":(C5(S)||S.contentEditable==="true")&&(Kg=S,TR=c,U1=null);break;case"focusout":U1=TR=Kg=null;break;case"mousedown":PR=!0;break;case"contextmenu":case"mouseup":case"dragend":PR=!1,R5(h,i,u);break;case"selectionchange":if(Jle)break;case"keydown":case"keyup":R5(h,i,u)}var E;if(kz)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Qg?uZ(e,i)&&(A="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(A="onCompositionStart");A&&(cZ&&i.locale!=="ko"&&(Qg||A!=="onCompositionStart"?A==="onCompositionEnd"&&Qg&&(E=lZ()):(fd=u,Nz="value"in fd?fd.value:fd.textContent,Qg=!0)),S=YE(c,A),0<S.length&&(A=new S5(A,e,null,i,u),h.push({event:A,listeners:S}),E?A.data=E:(E=hZ(i),E!==null&&(A.data=E)))),(E=Fle?Vle(e,i):jle(e,i))&&(c=YE(c,"onBeforeInput"),0<c.length&&(u=new S5("onBeforeInput","beforeinput",null,i,u),h.push({event:u,listeners:c}),u.data=E))}SZ(h,t)})}function Ex(e,t,i){return{instance:e,listener:t,currentTarget:i}}function YE(e,t){for(var i=t+"Capture",r=[];e!==null;){var n=e,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=yx(e,i),s!=null&&r.unshift(Ex(e,s,n)),s=yx(e,t),s!=null&&r.push(Ex(e,s,n))),e=e.return}return r}function Bm(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function N5(e,t,i,r,n){for(var s=t._reactName,a=[];i!==null&&i!==r;){var o=i,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,n?(l=yx(i,s),l!=null&&a.unshift(Ex(i,l,o))):n||(l=yx(i,s),l!=null&&a.push(Ex(i,l,o)))),i=i.return}a.length!==0&&e.push({event:t,listeners:a})}var ice=/\r\n?/g,rce=/\u0000|\uFFFD/g;function z5(e){return(typeof e=="string"?e:""+e).replace(ice,`
`).replace(rce,"")}function w_(e,t,i){if(t=z5(t),z5(e)!==t&&i)throw Error(ft(425))}function ZE(){}var DR=null,LR=null;function RR(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var IR=typeof setTimeout=="function"?setTimeout:void 0,nce=typeof clearTimeout=="function"?clearTimeout:void 0,B5=typeof Promise=="function"?Promise:void 0,sce=typeof queueMicrotask=="function"?queueMicrotask:typeof B5<"u"?function(e){return B5.resolve(null).then(e).catch(ace)}:IR;function ace(e){setTimeout(function(){throw e})}function IP(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&n.nodeType===8)if(i=n.data,i==="/$"){if(r===0){e.removeChild(n),wx(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=n}while(i);wx(t)}function Pd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function k5(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var S0=Math.random().toString(36).slice(2),_c="__reactFiber$"+S0,Ax="__reactProps$"+S0,th="__reactContainer$"+S0,OR="__reactEvents$"+S0,oce="__reactListeners$"+S0,lce="__reactHandles$"+S0;function pf(e){var t=e[_c];if(t)return t;for(var i=e.parentNode;i;){if(t=i[th]||i[_c]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=k5(e);e!==null;){if(i=e[_c])return i;e=k5(e)}return t}e=i,i=e.parentNode}return null}function zb(e){return e=e[_c]||e[th],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function $g(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ft(33))}function YC(e){return e[Ax]||null}var NR=[],ev=-1;function ip(e){return{current:e}}function Tr(e){0>ev||(e.current=NR[ev],NR[ev]=null,ev--)}function wr(e,t){ev++,NR[ev]=e.current,e.current=t}var Xd={},Ks=ip(Xd),ja=ip(!1),Gf=Xd;function Xv(e,t){var i=e.type.contextTypes;if(!i)return Xd;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in i)n[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=n),n}function Ha(e){return e=e.childContextTypes,e!=null}function QE(){Tr(ja),Tr(Ks)}function U5(e,t,i){if(Ks.current!==Xd)throw Error(ft(168));wr(Ks,t),wr(ja,i)}function EZ(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var n in r)if(!(n in t))throw Error(ft(108,Xoe(e)||"Unknown",n));return Vr({},i,r)}function KE(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Xd,Gf=Ks.current,wr(Ks,e),wr(ja,ja.current),!0}function F5(e,t,i){var r=e.stateNode;if(!r)throw Error(ft(169));i?(e=EZ(e,t,Gf),r.__reactInternalMemoizedMergedChildContext=e,Tr(ja),Tr(Ks),wr(Ks,e)):Tr(ja),wr(ja,i)}var Tu=null,ZC=!1,OP=!1;function AZ(e){Tu===null?Tu=[e]:Tu.push(e)}function cce(e){ZC=!0,AZ(e)}function rp(){if(!OP&&Tu!==null){OP=!0;var e=0,t=or;try{var i=Tu;for(or=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}Tu=null,ZC=!1}catch(n){throw Tu!==null&&(Tu=Tu.slice(e+1)),KY(Lz,rp),n}finally{or=t,OP=!1}}return null}var tv=[],iv=0,JE=null,$E=0,Go=[],Wo=0,Wf=null,ku=1,Uu="";function Xp(e,t){tv[iv++]=$E,tv[iv++]=JE,JE=e,$E=t}function CZ(e,t,i){Go[Wo++]=ku,Go[Wo++]=Uu,Go[Wo++]=Wf,Wf=e;var r=ku;e=Uu;var n=32-Bl(r)-1;r&=~(1<<n),i+=1;var s=32-Bl(t)+n;if(30<s){var a=n-n%5;s=(r&(1<<a)-1).toString(32),r>>=a,n-=a,ku=1<<32-Bl(t)+n|i<<n|r,Uu=s+e}else ku=1<<s|i<<n|r,Uu=e}function Fz(e){e.return!==null&&(Xp(e,1),CZ(e,1,0))}function Vz(e){for(;e===JE;)JE=tv[--iv],tv[iv]=null,$E=tv[--iv],tv[iv]=null;for(;e===Wf;)Wf=Go[--Wo],Go[Wo]=null,Uu=Go[--Wo],Go[Wo]=null,ku=Go[--Wo],Go[Wo]=null}var ho=null,co=null,Lr=!1,Pl=null;function TZ(e,t){var i=Yo(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function V5(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ho=e,co=Pd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ho=e,co=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=Wf!==null?{id:ku,overflow:Uu}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Yo(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,ho=e,co=null,!0):!1;default:return!1}}function zR(e){return(e.mode&1)!==0&&(e.flags&128)===0}function BR(e){if(Lr){var t=co;if(t){var i=t;if(!V5(e,t)){if(zR(e))throw Error(ft(418));t=Pd(i.nextSibling);var r=ho;t&&V5(e,t)?TZ(r,i):(e.flags=e.flags&-4097|2,Lr=!1,ho=e)}}else{if(zR(e))throw Error(ft(418));e.flags=e.flags&-4097|2,Lr=!1,ho=e}}}function j5(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ho=e}function __(e){if(e!==ho)return!1;if(!Lr)return j5(e),Lr=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!RR(e.type,e.memoizedProps)),t&&(t=co)){if(zR(e))throw PZ(),Error(ft(418));for(;t;)TZ(e,t),t=Pd(t.nextSibling)}if(j5(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ft(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){co=Pd(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}co=null}}else co=ho?Pd(e.stateNode.nextSibling):null;return!0}function PZ(){for(var e=co;e;)e=Pd(e.nextSibling)}function qv(){co=ho=null,Lr=!1}function jz(e){Pl===null?Pl=[e]:Pl.push(e)}var uce=fh.ReactCurrentBatchConfig;function by(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(ft(309));var r=i.stateNode}if(!r)throw Error(ft(147,e));var n=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(a){var o=n.refs;a===null?delete o[s]:o[s]=a},t._stringRef=s,t)}if(typeof e!="string")throw Error(ft(284));if(!i._owner)throw Error(ft(290,e))}return e}function S_(e,t){throw e=Object.prototype.toString.call(t),Error(ft(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function H5(e){var t=e._init;return t(e._payload)}function DZ(e){function t(g,y){if(e){var x=g.deletions;x===null?(g.deletions=[y],g.flags|=16):x.push(y)}}function i(g,y){if(!e)return null;for(;y!==null;)t(g,y),y=y.sibling;return null}function r(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function n(g,y){return g=Id(g,y),g.index=0,g.sibling=null,g}function s(g,y,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<y?(g.flags|=2,y):x):(g.flags|=2,y)):(g.flags|=1048576,y)}function a(g){return e&&g.alternate===null&&(g.flags|=2),g}function o(g,y,x,_){return y===null||y.tag!==6?(y=VP(x,g.mode,_),y.return=g,y):(y=n(y,x),y.return=g,y)}function l(g,y,x,_){var M=x.type;return M===Zg?u(g,y,x.props.children,_,x.key):y!==null&&(y.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===ed&&H5(M)===y.type)?(_=n(y,x.props),_.ref=by(g,y,x),_.return=g,_):(_=uE(x.type,x.key,x.props,null,g.mode,_),_.ref=by(g,y,x),_.return=g,_)}function c(g,y,x,_){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=jP(x,g.mode,_),y.return=g,y):(y=n(y,x.children||[]),y.return=g,y)}function u(g,y,x,_,M){return y===null||y.tag!==7?(y=Lf(x,g.mode,_,M),y.return=g,y):(y=n(y,x),y.return=g,y)}function h(g,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=VP(""+y,g.mode,x),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case d_:return x=uE(y.type,y.key,y.props,null,g.mode,x),x.ref=by(g,null,y),x.return=g,x;case Yg:return y=jP(y,g.mode,x),y.return=g,y;case ed:var _=y._init;return h(g,_(y._payload),x)}if(v1(y)||my(y))return y=Lf(y,g.mode,x,null),y.return=g,y;S_(g,y)}return null}function d(g,y,x,_){var M=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return M!==null?null:o(g,y,""+x,_);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case d_:return x.key===M?l(g,y,x,_):null;case Yg:return x.key===M?c(g,y,x,_):null;case ed:return M=x._init,d(g,y,M(x._payload),_)}if(v1(x)||my(x))return M!==null?null:u(g,y,x,_,null);S_(g,x)}return null}function p(g,y,x,_,M){if(typeof _=="string"&&_!==""||typeof _=="number")return g=g.get(x)||null,o(y,g,""+_,M);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case d_:return g=g.get(_.key===null?x:_.key)||null,l(y,g,_,M);case Yg:return g=g.get(_.key===null?x:_.key)||null,c(y,g,_,M);case ed:var S=_._init;return p(g,y,x,S(_._payload),M)}if(v1(_)||my(_))return g=g.get(x)||null,u(y,g,_,M,null);S_(y,_)}return null}function f(g,y,x,_){for(var M=null,S=null,E=y,A=y=0,P=null;E!==null&&A<x.length;A++){E.index>A?(P=E,E=null):P=E.sibling;var C=d(g,E,x[A],_);if(C===null){E===null&&(E=P);break}e&&E&&C.alternate===null&&t(g,E),y=s(C,y,A),S===null?M=C:S.sibling=C,S=C,E=P}if(A===x.length)return i(g,E),Lr&&Xp(g,A),M;if(E===null){for(;A<x.length;A++)E=h(g,x[A],_),E!==null&&(y=s(E,y,A),S===null?M=E:S.sibling=E,S=E);return Lr&&Xp(g,A),M}for(E=r(g,E);A<x.length;A++)P=p(E,g,A,x[A],_),P!==null&&(e&&P.alternate!==null&&E.delete(P.key===null?A:P.key),y=s(P,y,A),S===null?M=P:S.sibling=P,S=P);return e&&E.forEach(function(D){return t(g,D)}),Lr&&Xp(g,A),M}function v(g,y,x,_){var M=my(x);if(typeof M!="function")throw Error(ft(150));if(x=M.call(x),x==null)throw Error(ft(151));for(var S=M=null,E=y,A=y=0,P=null,C=x.next();E!==null&&!C.done;A++,C=x.next()){E.index>A?(P=E,E=null):P=E.sibling;var D=d(g,E,C.value,_);if(D===null){E===null&&(E=P);break}e&&E&&D.alternate===null&&t(g,E),y=s(D,y,A),S===null?M=D:S.sibling=D,S=D,E=P}if(C.done)return i(g,E),Lr&&Xp(g,A),M;if(E===null){for(;!C.done;A++,C=x.next())C=h(g,C.value,_),C!==null&&(y=s(C,y,A),S===null?M=C:S.sibling=C,S=C);return Lr&&Xp(g,A),M}for(E=r(g,E);!C.done;A++,C=x.next())C=p(E,g,A,C.value,_),C!==null&&(e&&C.alternate!==null&&E.delete(C.key===null?A:C.key),y=s(C,y,A),S===null?M=C:S.sibling=C,S=C);return e&&E.forEach(function(N){return t(g,N)}),Lr&&Xp(g,A),M}function m(g,y,x,_){if(typeof x=="object"&&x!==null&&x.type===Zg&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case d_:e:{for(var M=x.key,S=y;S!==null;){if(S.key===M){if(M=x.type,M===Zg){if(S.tag===7){i(g,S.sibling),y=n(S,x.props.children),y.return=g,g=y;break e}}else if(S.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===ed&&H5(M)===S.type){i(g,S.sibling),y=n(S,x.props),y.ref=by(g,S,x),y.return=g,g=y;break e}i(g,S);break}else t(g,S);S=S.sibling}x.type===Zg?(y=Lf(x.props.children,g.mode,_,x.key),y.return=g,g=y):(_=uE(x.type,x.key,x.props,null,g.mode,_),_.ref=by(g,y,x),_.return=g,g=_)}return a(g);case Yg:e:{for(S=x.key;y!==null;){if(y.key===S)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){i(g,y.sibling),y=n(y,x.children||[]),y.return=g,g=y;break e}else{i(g,y);break}else t(g,y);y=y.sibling}y=jP(x,g.mode,_),y.return=g,g=y}return a(g);case ed:return S=x._init,m(g,y,S(x._payload),_)}if(v1(x))return f(g,y,x,_);if(my(x))return v(g,y,x,_);S_(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(i(g,y.sibling),y=n(y,x),y.return=g,g=y):(i(g,y),y=VP(x,g.mode,_),y.return=g,g=y),a(g)):i(g,y)}return m}var Yv=DZ(!0),LZ=DZ(!1),eA=ip(null),tA=null,rv=null,Hz=null;function Gz(){Hz=rv=tA=null}function Wz(e){var t=eA.current;Tr(eA),e._currentValue=t}function kR(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Tv(e,t){tA=e,Hz=rv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ua=!0),e.firstContext=null)}function tl(e){var t=e._currentValue;if(Hz!==e)if(e={context:e,memoizedValue:t,next:null},rv===null){if(tA===null)throw Error(ft(308));rv=e,tA.dependencies={lanes:0,firstContext:e}}else rv=rv.next=e;return t}var ff=null;function Xz(e){ff===null?ff=[e]:ff.push(e)}function RZ(e,t,i,r){var n=t.interleaved;return n===null?(i.next=i,Xz(t)):(i.next=n.next,n.next=i),t.interleaved=i,ih(e,r)}function ih(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var td=!1;function qz(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function IZ(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Yu(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Dd(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Hi&2){var n=r.pending;return n===null?t.next=t:(t.next=n.next,n.next=t),r.pending=t,ih(e,i)}return n=r.interleaved,n===null?(t.next=t,Xz(r)):(t.next=n.next,n.next=t),r.interleaved=t,ih(e,i)}function nE(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,Rz(e,i)}}function G5(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var n=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var a={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?n=s=a:s=s.next=a,i=i.next}while(i!==null);s===null?n=s=t:s=s.next=t}else n=s=t;i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function iA(e,t,i,r){var n=e.updateQueue;td=!1;var s=n.firstBaseUpdate,a=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var l=o,c=l.next;l.next=null,a===null?s=c:a.next=c,a=l;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==a&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;a=0,u=c=l=null,o=s;do{var d=o.lane,p=o.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,v=o;switch(d=t,p=i,v.tag){case 1:if(f=v.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=v.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=Vr({},h,d);break e;case 2:td=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,d=n.effects,d===null?n.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,a|=d;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;d=o,o=d.next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}while(!0);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,t=n.shared.interleaved,t!==null){n=t;do a|=n.lane,n=n.next;while(n!==t)}else s===null&&(n.shared.lanes=0);qf|=a,e.lanes=a,e.memoizedState=h}}function W5(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(n!==null){if(r.callback=null,r=i,typeof n!="function")throw Error(ft(191,n));n.call(r)}}}var Bb={},Ic=ip(Bb),Cx=ip(Bb),Tx=ip(Bb);function mf(e){if(e===Bb)throw Error(ft(174));return e}function Yz(e,t){switch(wr(Tx,t),wr(Cx,e),wr(Ic,Bb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:yR(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=yR(t,e)}Tr(Ic),wr(Ic,t)}function Zv(){Tr(Ic),Tr(Cx),Tr(Tx)}function OZ(e){mf(Tx.current);var t=mf(Ic.current),i=yR(t,e.type);t!==i&&(wr(Cx,e),wr(Ic,i))}function Zz(e){Cx.current===e&&(Tr(Ic),Tr(Cx))}var Or=ip(0);function rA(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var NP=[];function Qz(){for(var e=0;e<NP.length;e++)NP[e]._workInProgressVersionPrimary=null;NP.length=0}var sE=fh.ReactCurrentDispatcher,zP=fh.ReactCurrentBatchConfig,Xf=0,Ur=null,zn=null,is=null,nA=!1,F1=!1,Px=0,hce=0;function Os(){throw Error(ft(321))}function Kz(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!Fl(e[i],t[i]))return!1;return!0}function Jz(e,t,i,r,n,s){if(Xf=s,Ur=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sE.current=e===null||e.memoizedState===null?mce:gce,e=i(r,n),F1){s=0;do{if(F1=!1,Px=0,25<=s)throw Error(ft(301));s+=1,is=zn=null,t.updateQueue=null,sE.current=vce,e=i(r,n)}while(F1)}if(sE.current=sA,t=zn!==null&&zn.next!==null,Xf=0,is=zn=Ur=null,nA=!1,t)throw Error(ft(300));return e}function $z(){var e=Px!==0;return Px=0,e}function vc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return is===null?Ur.memoizedState=is=e:is=is.next=e,is}function il(){if(zn===null){var e=Ur.alternate;e=e!==null?e.memoizedState:null}else e=zn.next;var t=is===null?Ur.memoizedState:is.next;if(t!==null)is=t,zn=e;else{if(e===null)throw Error(ft(310));zn=e,e={memoizedState:zn.memoizedState,baseState:zn.baseState,baseQueue:zn.baseQueue,queue:zn.queue,next:null},is===null?Ur.memoizedState=is=e:is=is.next=e}return is}function Dx(e,t){return typeof t=="function"?t(e):t}function BP(e){var t=il(),i=t.queue;if(i===null)throw Error(ft(311));i.lastRenderedReducer=e;var r=zn,n=r.baseQueue,s=i.pending;if(s!==null){if(n!==null){var a=n.next;n.next=s.next,s.next=a}r.baseQueue=n=s,i.pending=null}if(n!==null){s=n.next,r=r.baseState;var o=a=null,l=null,c=s;do{var u=c.lane;if((Xf&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,a=r):l=l.next=h,Ur.lanes|=u,qf|=u}c=c.next}while(c!==null&&c!==s);l===null?a=r:l.next=o,Fl(r,t.memoizedState)||(Ua=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){n=e;do s=n.lane,Ur.lanes|=s,qf|=s,n=n.next;while(n!==e)}else n===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function kP(e){var t=il(),i=t.queue;if(i===null)throw Error(ft(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,s=t.memoizedState;if(n!==null){i.pending=null;var a=n=n.next;do s=e(s,a.action),a=a.next;while(a!==n);Fl(s,t.memoizedState)||(Ua=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function NZ(){}function zZ(e,t){var i=Ur,r=il(),n=t(),s=!Fl(r.memoizedState,n);if(s&&(r.memoizedState=n,Ua=!0),r=r.queue,eB(UZ.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||is!==null&&is.memoizedState.tag&1){if(i.flags|=2048,Lx(9,kZ.bind(null,i,r,n,t),void 0,null),cs===null)throw Error(ft(349));Xf&30||BZ(i,t,n)}return n}function BZ(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Ur.updateQueue,t===null?(t={lastEffect:null,stores:null},Ur.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function kZ(e,t,i,r){t.value=i,t.getSnapshot=r,FZ(t)&&VZ(e)}function UZ(e,t,i){return i(function(){FZ(t)&&VZ(e)})}function FZ(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!Fl(e,i)}catch{return!0}}function VZ(e){var t=ih(e,1);t!==null&&kl(t,e,1,-1)}function X5(e){var t=vc();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dx,lastRenderedState:e},t.queue=e,e=e.dispatch=fce.bind(null,Ur,e),[t.memoizedState,e]}function Lx(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=Ur.updateQueue,t===null?(t={lastEffect:null,stores:null},Ur.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function jZ(){return il().memoizedState}function aE(e,t,i,r){var n=vc();Ur.flags|=e,n.memoizedState=Lx(1|t,i,void 0,r===void 0?null:r)}function QC(e,t,i,r){var n=il();r=r===void 0?null:r;var s=void 0;if(zn!==null){var a=zn.memoizedState;if(s=a.destroy,r!==null&&Kz(r,a.deps)){n.memoizedState=Lx(t,i,s,r);return}}Ur.flags|=e,n.memoizedState=Lx(1|t,i,s,r)}function q5(e,t){return aE(8390656,8,e,t)}function eB(e,t){return QC(2048,8,e,t)}function HZ(e,t){return QC(4,2,e,t)}function GZ(e,t){return QC(4,4,e,t)}function WZ(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function XZ(e,t,i){return i=i!=null?i.concat([e]):null,QC(4,4,WZ.bind(null,t,e),i)}function tB(){}function qZ(e,t){var i=il();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&Kz(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function YZ(e,t){var i=il();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&Kz(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function ZZ(e,t,i){return Xf&21?(Fl(i,t)||(i=eZ(),Ur.lanes|=i,qf|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ua=!0),e.memoizedState=i)}function dce(e,t){var i=or;or=i!==0&&4>i?i:4,e(!0);var r=zP.transition;zP.transition={};try{e(!1),t()}finally{or=i,zP.transition=r}}function QZ(){return il().memoizedState}function pce(e,t,i){var r=Rd(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},KZ(e))JZ(t,i);else if(i=RZ(e,t,i,r),i!==null){var n=ya();kl(i,e,r,n),$Z(i,t,r)}}function fce(e,t,i){var r=Rd(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(KZ(e))JZ(t,n);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var a=t.lastRenderedState,o=s(a,i);if(n.hasEagerState=!0,n.eagerState=o,Fl(o,a)){var l=t.interleaved;l===null?(n.next=n,Xz(t)):(n.next=l.next,l.next=n),t.interleaved=n;return}}catch{}finally{}i=RZ(e,t,n,r),i!==null&&(n=ya(),kl(i,e,r,n),$Z(i,t,r))}}function KZ(e){var t=e.alternate;return e===Ur||t!==null&&t===Ur}function JZ(e,t){F1=nA=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function $Z(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,Rz(e,i)}}var sA={readContext:tl,useCallback:Os,useContext:Os,useEffect:Os,useImperativeHandle:Os,useInsertionEffect:Os,useLayoutEffect:Os,useMemo:Os,useReducer:Os,useRef:Os,useState:Os,useDebugValue:Os,useDeferredValue:Os,useTransition:Os,useMutableSource:Os,useSyncExternalStore:Os,useId:Os,unstable_isNewReconciler:!1},mce={readContext:tl,useCallback:function(e,t){return vc().memoizedState=[e,t===void 0?null:t],e},useContext:tl,useEffect:q5,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,aE(4194308,4,WZ.bind(null,t,e),i)},useLayoutEffect:function(e,t){return aE(4194308,4,e,t)},useInsertionEffect:function(e,t){return aE(4,2,e,t)},useMemo:function(e,t){var i=vc();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=vc();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=pce.bind(null,Ur,e),[r.memoizedState,e]},useRef:function(e){var t=vc();return e={current:e},t.memoizedState=e},useState:X5,useDebugValue:tB,useDeferredValue:function(e){return vc().memoizedState=e},useTransition:function(){var e=X5(!1),t=e[0];return e=dce.bind(null,e[1]),vc().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=Ur,n=vc();if(Lr){if(i===void 0)throw Error(ft(407));i=i()}else{if(i=t(),cs===null)throw Error(ft(349));Xf&30||BZ(r,t,i)}n.memoizedState=i;var s={value:i,getSnapshot:t};return n.queue=s,q5(UZ.bind(null,r,s,e),[e]),r.flags|=2048,Lx(9,kZ.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=vc(),t=cs.identifierPrefix;if(Lr){var i=Uu,r=ku;i=(r&~(1<<32-Bl(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=Px++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=hce++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},gce={readContext:tl,useCallback:qZ,useContext:tl,useEffect:eB,useImperativeHandle:XZ,useInsertionEffect:HZ,useLayoutEffect:GZ,useMemo:YZ,useReducer:BP,useRef:jZ,useState:function(){return BP(Dx)},useDebugValue:tB,useDeferredValue:function(e){var t=il();return ZZ(t,zn.memoizedState,e)},useTransition:function(){var e=BP(Dx)[0],t=il().memoizedState;return[e,t]},useMutableSource:NZ,useSyncExternalStore:zZ,useId:QZ,unstable_isNewReconciler:!1},vce={readContext:tl,useCallback:qZ,useContext:tl,useEffect:eB,useImperativeHandle:XZ,useInsertionEffect:HZ,useLayoutEffect:GZ,useMemo:YZ,useReducer:kP,useRef:jZ,useState:function(){return kP(Dx)},useDebugValue:tB,useDeferredValue:function(e){var t=il();return zn===null?t.memoizedState=e:ZZ(t,zn.memoizedState,e)},useTransition:function(){var e=kP(Dx)[0],t=il().memoizedState;return[e,t]},useMutableSource:NZ,useSyncExternalStore:zZ,useId:QZ,unstable_isNewReconciler:!1};function Al(e,t){if(e&&e.defaultProps){t=Vr({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}function UR(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:Vr({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var KC={isMounted:function(e){return(e=e._reactInternals)?lm(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=ya(),n=Rd(e),s=Yu(r,n);s.payload=t,i!=null&&(s.callback=i),t=Dd(e,s,n),t!==null&&(kl(t,e,n,r),nE(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=ya(),n=Rd(e),s=Yu(r,n);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=Dd(e,s,n),t!==null&&(kl(t,e,n,r),nE(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ya(),r=Rd(e),n=Yu(i,r);n.tag=2,t!=null&&(n.callback=t),t=Dd(e,n,r),t!==null&&(kl(t,e,r,i),nE(t,e,r))}};function Y5(e,t,i,r,n,s,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,a):t.prototype&&t.prototype.isPureReactComponent?!Sx(i,r)||!Sx(n,s):!0}function eQ(e,t,i){var r=!1,n=Xd,s=t.contextType;return typeof s=="object"&&s!==null?s=tl(s):(n=Ha(t)?Gf:Ks.current,r=t.contextTypes,s=(r=r!=null)?Xv(e,n):Xd),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=KC,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=s),t}function Z5(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&KC.enqueueReplaceState(t,t.state,null)}function FR(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs={},qz(e);var s=t.contextType;typeof s=="object"&&s!==null?n.context=tl(s):(s=Ha(t)?Gf:Ks.current,n.context=Xv(e,s)),n.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(UR(e,t,s,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(t=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),t!==n.state&&KC.enqueueReplaceState(n,n.state,null),iA(e,i,n,r),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308)}function Qv(e,t){try{var i="",r=t;do i+=Woe(r),r=r.return;while(r);var n=i}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:n,digest:null}}function UP(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function VR(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var yce=typeof WeakMap=="function"?WeakMap:Map;function tQ(e,t,i){i=Yu(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){oA||(oA=!0,KR=r),VR(e,t)},i}function iQ(e,t,i){i=Yu(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){VR(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){VR(e,t),typeof r!="function"&&(Ld===null?Ld=new Set([this]):Ld.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),i}function Q5(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new yce;var n=new Set;r.set(t,n)}else n=r.get(t),n===void 0&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=Rce.bind(null,e,t,i),t.then(e,e))}function K5(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function J5(e,t,i,r,n){return e.mode&1?(e.flags|=65536,e.lanes=n,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Yu(-1,1),t.tag=2,Dd(i,t,1))),i.lanes|=1),e)}var xce=fh.ReactCurrentOwner,Ua=!1;function ua(e,t,i,r){t.child=e===null?LZ(t,null,i,r):Yv(t,e.child,i,r)}function $5(e,t,i,r,n){i=i.render;var s=t.ref;return Tv(t,n),r=Jz(e,t,i,r,s,n),i=$z(),e!==null&&!Ua?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,rh(e,t,n)):(Lr&&i&&Fz(t),t.flags|=1,ua(e,t,r,n),t.child)}function eV(e,t,i,r,n){if(e===null){var s=i.type;return typeof s=="function"&&!cB(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,rQ(e,t,s,r,n)):(e=uE(i.type,null,r,t,t.mode,n),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&n)){var a=s.memoizedProps;if(i=i.compare,i=i!==null?i:Sx,i(a,r)&&e.ref===t.ref)return rh(e,t,n)}return t.flags|=1,e=Id(s,r),e.ref=t.ref,e.return=t,t.child=e}function rQ(e,t,i,r,n){if(e!==null){var s=e.memoizedProps;if(Sx(s,r)&&e.ref===t.ref)if(Ua=!1,t.pendingProps=r=s,(e.lanes&n)!==0)e.flags&131072&&(Ua=!0);else return t.lanes=e.lanes,rh(e,t,n)}return jR(e,t,i,r,n)}function nQ(e,t,i){var r=t.pendingProps,n=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wr(sv,no),no|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wr(sv,no),no|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,wr(sv,no),no|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,wr(sv,no),no|=r;return ua(e,t,n,i),t.child}function sQ(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function jR(e,t,i,r,n){var s=Ha(i)?Gf:Ks.current;return s=Xv(t,s),Tv(t,n),i=Jz(e,t,i,r,s,n),r=$z(),e!==null&&!Ua?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,rh(e,t,n)):(Lr&&r&&Fz(t),t.flags|=1,ua(e,t,i,n),t.child)}function tV(e,t,i,r,n){if(Ha(i)){var s=!0;KE(t)}else s=!1;if(Tv(t,n),t.stateNode===null)oE(e,t),eQ(t,i,r),FR(t,i,r,n),r=!0;else if(e===null){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=i.contextType;typeof c=="object"&&c!==null?c=tl(c):(c=Ha(i)?Gf:Ks.current,c=Xv(t,c));var u=i.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==c)&&Z5(t,a,r,c),td=!1;var d=t.memoizedState;a.state=d,iA(t,r,a,n),l=t.memoizedState,o!==r||d!==l||ja.current||td?(typeof u=="function"&&(UR(t,i,u,r),l=t.memoizedState),(o=td||Y5(t,i,o,r,d,l,c))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,IZ(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:Al(t.type,o),a.props=c,h=t.pendingProps,d=a.context,l=i.contextType,typeof l=="object"&&l!==null?l=tl(l):(l=Ha(i)?Gf:Ks.current,l=Xv(t,l));var p=i.getDerivedStateFromProps;(u=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==h||d!==l)&&Z5(t,a,r,l),td=!1,d=t.memoizedState,a.state=d,iA(t,r,a,n);var f=t.memoizedState;o!==h||d!==f||ja.current||td?(typeof p=="function"&&(UR(t,i,p,r),f=t.memoizedState),(c=td||Y5(t,i,c,r,d,f,l)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,f,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,f,l)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=c):(typeof a.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return HR(e,t,i,r,s,n)}function HR(e,t,i,r,n,s){sQ(e,t);var a=(t.flags&128)!==0;if(!r&&!a)return n&&F5(t,i,!1),rh(e,t,s);r=t.stateNode,xce.current=t;var o=a&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&a?(t.child=Yv(t,e.child,null,s),t.child=Yv(t,null,o,s)):ua(e,t,o,s),t.memoizedState=r.state,n&&F5(t,i,!0),t.child}function aQ(e){var t=e.stateNode;t.pendingContext?U5(e,t.pendingContext,t.pendingContext!==t.context):t.context&&U5(e,t.context,!1),Yz(e,t.containerInfo)}function iV(e,t,i,r,n){return qv(),jz(n),t.flags|=256,ua(e,t,i,r),t.child}var GR={dehydrated:null,treeContext:null,retryLane:0};function WR(e){return{baseLanes:e,cachePool:null,transitions:null}}function oQ(e,t,i){var r=t.pendingProps,n=Or.current,s=!1,a=(t.flags&128)!==0,o;if((o=a)||(o=e!==null&&e.memoizedState===null?!1:(n&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(n|=1),wr(Or,n&1),e===null)return BR(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=r.children,e=r.fallback,s?(r=t.mode,s=t.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=eT(a,r,0,null),e=Lf(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=WR(i),t.memoizedState=GR,e):iB(t,a));if(n=e.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return bce(e,t,a,r,o,n,i);if(s){s=r.fallback,a=t.mode,n=e.child,o=n.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&t.child!==n?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=Id(n,l),r.subtreeFlags=n.subtreeFlags&14680064),o!==null?s=Id(o,s):(s=Lf(s,a,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,a=e.child.memoizedState,a=a===null?WR(i):{baseLanes:a.baseLanes|i,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=e.childLanes&~i,t.memoizedState=GR,r}return s=e.child,e=s.sibling,r=Id(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function iB(e,t){return t=eT({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function M_(e,t,i,r){return r!==null&&jz(r),Yv(t,e.child,null,i),e=iB(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function bce(e,t,i,r,n,s,a){if(i)return t.flags&256?(t.flags&=-257,r=UP(Error(ft(422))),M_(e,t,a,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,n=t.mode,r=eT({mode:"visible",children:r.children},n,0,null),s=Lf(s,n,a,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&Yv(t,e.child,null,a),t.child.memoizedState=WR(a),t.memoizedState=GR,s);if(!(t.mode&1))return M_(e,t,a,null);if(n.data==="$!"){if(r=n.nextSibling&&n.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(ft(419)),r=UP(s,r,void 0),M_(e,t,a,r)}if(o=(a&e.childLanes)!==0,Ua||o){if(r=cs,r!==null){switch(a&-a){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(r.suspendedLanes|a)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,ih(e,n),kl(r,e,n,-1))}return lB(),r=UP(Error(ft(421))),M_(e,t,a,r)}return n.data==="$?"?(t.flags|=128,t.child=e.child,t=Ice.bind(null,e),n._reactRetry=t,null):(e=s.treeContext,co=Pd(n.nextSibling),ho=t,Lr=!0,Pl=null,e!==null&&(Go[Wo++]=ku,Go[Wo++]=Uu,Go[Wo++]=Wf,ku=e.id,Uu=e.overflow,Wf=t),t=iB(t,r.children),t.flags|=4096,t)}function rV(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),kR(e.return,t,i)}function FP(e,t,i,r,n){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=n)}function lQ(e,t,i){var r=t.pendingProps,n=r.revealOrder,s=r.tail;if(ua(e,t,r.children,i),r=Or.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&rV(e,i,t);else if(e.tag===19)rV(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(wr(Or,r),!(t.mode&1))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;i!==null;)e=i.alternate,e!==null&&rA(e)===null&&(n=i),i=i.sibling;i=n,i===null?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),FP(t,!1,n,i,s);break;case"backwards":for(i=null,n=t.child,t.child=null;n!==null;){if(e=n.alternate,e!==null&&rA(e)===null){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}FP(t,!0,i,null,s);break;case"together":FP(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function oE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function rh(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),qf|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ft(153));if(t.child!==null){for(e=t.child,i=Id(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Id(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function wce(e,t,i){switch(t.tag){case 3:aQ(t),qv();break;case 5:OZ(t);break;case 1:Ha(t.type)&&KE(t);break;case 4:Yz(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;wr(eA,r._currentValue),r._currentValue=n;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(wr(Or,Or.current&1),t.flags|=128,null):i&t.child.childLanes?oQ(e,t,i):(wr(Or,Or.current&1),e=rh(e,t,i),e!==null?e.sibling:null);wr(Or,Or.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return lQ(e,t,i);t.flags|=128}if(n=t.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),wr(Or,Or.current),r)break;return null;case 22:case 23:return t.lanes=0,nQ(e,t,i)}return rh(e,t,i)}var cQ,XR,uQ,hQ;cQ=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};XR=function(){};uQ=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,mf(Ic.current);var s=null;switch(i){case"input":n=fR(e,n),r=fR(e,r),s=[];break;case"select":n=Vr({},n,{value:void 0}),r=Vr({},r,{value:void 0}),s=[];break;case"textarea":n=vR(e,n),r=vR(e,r),s=[];break;default:typeof n.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=ZE)}xR(i,r);var a;i=null;for(c in n)if(!r.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var o=n[c];for(a in o)o.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(gx.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=n!=null?n[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(i||(i={}),i[a]=l[a])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(gx.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Mr("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};hQ=function(e,t,i,r){i!==r&&(t.flags|=4)};function wy(e,t){if(!Lr)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ns(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags&14680064,r|=n.flags&14680064,n.return=e,n=n.sibling;else for(n=e.child;n!==null;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function _ce(e,t,i){var r=t.pendingProps;switch(Vz(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ns(t),null;case 1:return Ha(t.type)&&QE(),Ns(t),null;case 3:return r=t.stateNode,Zv(),Tr(ja),Tr(Ks),Qz(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(__(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Pl!==null&&(eI(Pl),Pl=null))),XR(e,t),Ns(t),null;case 5:Zz(t);var n=mf(Tx.current);if(i=t.type,e!==null&&t.stateNode!=null)uQ(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(ft(166));return Ns(t),null}if(e=mf(Ic.current),__(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[_c]=t,r[Ax]=s,e=(t.mode&1)!==0,i){case"dialog":Mr("cancel",r),Mr("close",r);break;case"iframe":case"object":case"embed":Mr("load",r);break;case"video":case"audio":for(n=0;n<x1.length;n++)Mr(x1[n],r);break;case"source":Mr("error",r);break;case"img":case"image":case"link":Mr("error",r),Mr("load",r);break;case"details":Mr("toggle",r);break;case"input":d5(r,s),Mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mr("invalid",r);break;case"textarea":f5(r,s),Mr("invalid",r)}xR(i,s),n=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&w_(r.textContent,o,e),n=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&w_(r.textContent,o,e),n=["children",""+o]):gx.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Mr("scroll",r)}switch(i){case"input":p_(r),p5(r,s,!0);break;case"textarea":p_(r),m5(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=ZE)}r=n,t.updateQueue=r,r!==null&&(t.flags|=4)}else{a=n.nodeType===9?n:n.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=UY(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=a.createElement(i,{is:r.is}):(e=a.createElement(i),i==="select"&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,i),e[_c]=t,e[Ax]=r,cQ(e,t,!1,!1),t.stateNode=e;e:{switch(a=bR(i,r),i){case"dialog":Mr("cancel",e),Mr("close",e),n=r;break;case"iframe":case"object":case"embed":Mr("load",e),n=r;break;case"video":case"audio":for(n=0;n<x1.length;n++)Mr(x1[n],e);n=r;break;case"source":Mr("error",e),n=r;break;case"img":case"image":case"link":Mr("error",e),Mr("load",e),n=r;break;case"details":Mr("toggle",e),n=r;break;case"input":d5(e,r),n=fR(e,r),Mr("invalid",e);break;case"option":n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=Vr({},r,{value:void 0}),Mr("invalid",e);break;case"textarea":f5(e,r),n=vR(e,r),Mr("invalid",e);break;default:n=r}xR(i,n),o=n;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?jY(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&FY(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&vx(e,l):typeof l=="number"&&vx(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(gx.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Mr("scroll",e):l!=null&&Az(e,s,l,a))}switch(i){case"input":p_(e),p5(e,r,!1);break;case"textarea":p_(e),m5(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Wd(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?Mv(e,!!r.multiple,s,!1):r.defaultValue!=null&&Mv(e,!!r.multiple,r.defaultValue,!0);break;default:typeof n.onClick=="function"&&(e.onclick=ZE)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ns(t),null;case 6:if(e&&t.stateNode!=null)hQ(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(ft(166));if(i=mf(Tx.current),mf(Ic.current),__(t)){if(r=t.stateNode,i=t.memoizedProps,r[_c]=t,(s=r.nodeValue!==i)&&(e=ho,e!==null))switch(e.tag){case 3:w_(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&w_(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[_c]=t,t.stateNode=r}return Ns(t),null;case 13:if(Tr(Or),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(Lr&&co!==null&&t.mode&1&&!(t.flags&128))PZ(),qv(),t.flags|=98560,s=!1;else if(s=__(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(ft(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ft(317));s[_c]=t}else qv(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ns(t),s=!1}else Pl!==null&&(eI(Pl),Pl=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||Or.current&1?Vn===0&&(Vn=3):lB())),t.updateQueue!==null&&(t.flags|=4),Ns(t),null);case 4:return Zv(),XR(e,t),e===null&&Mx(t.stateNode.containerInfo),Ns(t),null;case 10:return Wz(t.type._context),Ns(t),null;case 17:return Ha(t.type)&&QE(),Ns(t),null;case 19:if(Tr(Or),s=t.memoizedState,s===null)return Ns(t),null;if(r=(t.flags&128)!==0,a=s.rendering,a===null)if(r)wy(s,!1);else{if(Vn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=rA(e),a!==null){for(t.flags|=128,wy(s,!1),r=a.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,e=a.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return wr(Or,Or.current&1|2),t.child}e=e.sibling}s.tail!==null&&un()>Kv&&(t.flags|=128,r=!0,wy(s,!1),t.lanes=4194304)}else{if(!r)if(e=rA(a),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),wy(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Lr)return Ns(t),null}else 2*un()-s.renderingStartTime>Kv&&i!==1073741824&&(t.flags|=128,r=!0,wy(s,!1),t.lanes=4194304);s.isBackwards?(a.sibling=t.child,t.child=a):(i=s.last,i!==null?i.sibling=a:t.child=a,s.last=a)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=un(),t.sibling=null,i=Or.current,wr(Or,r?i&1|2:i&1),t):(Ns(t),null);case 22:case 23:return oB(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?no&1073741824&&(Ns(t),t.subtreeFlags&6&&(t.flags|=8192)):Ns(t),null;case 24:return null;case 25:return null}throw Error(ft(156,t.tag))}function Sce(e,t){switch(Vz(t),t.tag){case 1:return Ha(t.type)&&QE(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Zv(),Tr(ja),Tr(Ks),Qz(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Zz(t),null;case 13:if(Tr(Or),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ft(340));qv()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Tr(Or),null;case 4:return Zv(),null;case 10:return Wz(t.type._context),null;case 22:case 23:return oB(),null;case 24:return null;default:return null}}var E_=!1,js=!1,Mce=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function nv(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){Zr(e,t,r)}else i.current=null}function qR(e,t,i){try{i()}catch(r){Zr(e,t,r)}}var nV=!1;function Ece(e,t){if(DR=XE,e=gZ(),Uz(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var n=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var a=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var p;h!==i||n!==0&&h.nodeType!==3||(o=a+n),h!==s||r!==0&&h.nodeType!==3||(l=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===e)break t;if(d===i&&++c===n&&(o=a),d===s&&++u===r&&(l=a),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}i=o===-1||l===-1?null:{start:o,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(LR={focusedElem:e,selectionRange:i},XE=!1,Nt=t;Nt!==null;)if(t=Nt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Nt=e;else for(;Nt!==null;){t=Nt;try{var f=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var v=f.memoizedProps,m=f.memoizedState,g=t.stateNode,y=g.getSnapshotBeforeUpdate(t.elementType===t.type?v:Al(t.type,v),m);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ft(163))}}catch(_){Zr(t,t.return,_)}if(e=t.sibling,e!==null){e.return=t.return,Nt=e;break}Nt=t.return}return f=nV,nV=!1,f}function V1(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var n=r=r.next;do{if((n.tag&e)===e){var s=n.destroy;n.destroy=void 0,s!==void 0&&qR(t,i,s)}n=n.next}while(n!==r)}}function JC(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function YR(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function dQ(e){var t=e.alternate;t!==null&&(e.alternate=null,dQ(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[_c],delete t[Ax],delete t[OR],delete t[oce],delete t[lce])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function pQ(e){return e.tag===5||e.tag===3||e.tag===4}function sV(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||pQ(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ZR(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=ZE));else if(r!==4&&(e=e.child,e!==null))for(ZR(e,t,i),e=e.sibling;e!==null;)ZR(e,t,i),e=e.sibling}function QR(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(QR(e,t,i),e=e.sibling;e!==null;)QR(e,t,i),e=e.sibling}var gs=null,Tl=!1;function Ch(e,t,i){for(i=i.child;i!==null;)fQ(e,t,i),i=i.sibling}function fQ(e,t,i){if(Rc&&typeof Rc.onCommitFiberUnmount=="function")try{Rc.onCommitFiberUnmount(GC,i)}catch{}switch(i.tag){case 5:js||nv(i,t);case 6:var r=gs,n=Tl;gs=null,Ch(e,t,i),gs=r,Tl=n,gs!==null&&(Tl?(e=gs,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):gs.removeChild(i.stateNode));break;case 18:gs!==null&&(Tl?(e=gs,i=i.stateNode,e.nodeType===8?IP(e.parentNode,i):e.nodeType===1&&IP(e,i),wx(e)):IP(gs,i.stateNode));break;case 4:r=gs,n=Tl,gs=i.stateNode.containerInfo,Tl=!0,Ch(e,t,i),gs=r,Tl=n;break;case 0:case 11:case 14:case 15:if(!js&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){n=r=r.next;do{var s=n,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&qR(i,t,a),n=n.next}while(n!==r)}Ch(e,t,i);break;case 1:if(!js&&(nv(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){Zr(i,t,o)}Ch(e,t,i);break;case 21:Ch(e,t,i);break;case 22:i.mode&1?(js=(r=js)||i.memoizedState!==null,Ch(e,t,i),js=r):Ch(e,t,i);break;default:Ch(e,t,i)}}function aV(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new Mce),t.forEach(function(r){var n=Oce.bind(null,e,r);i.has(r)||(i.add(r),r.then(n,n))})}}function ul(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var n=i[r];try{var s=e,a=t,o=a;e:for(;o!==null;){switch(o.tag){case 5:gs=o.stateNode,Tl=!1;break e;case 3:gs=o.stateNode.containerInfo,Tl=!0;break e;case 4:gs=o.stateNode.containerInfo,Tl=!0;break e}o=o.return}if(gs===null)throw Error(ft(160));fQ(s,a,n),gs=null,Tl=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){Zr(n,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)mQ(t,e),t=t.sibling}function mQ(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ul(t,e),rc(e),r&4){try{V1(3,e,e.return),JC(3,e)}catch(v){Zr(e,e.return,v)}try{V1(5,e,e.return)}catch(v){Zr(e,e.return,v)}}break;case 1:ul(t,e),rc(e),r&512&&i!==null&&nv(i,i.return);break;case 5:if(ul(t,e),rc(e),r&512&&i!==null&&nv(i,i.return),e.flags&32){var n=e.stateNode;try{vx(n,"")}catch(v){Zr(e,e.return,v)}}if(r&4&&(n=e.stateNode,n!=null)){var s=e.memoizedProps,a=i!==null?i.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&BY(n,s),bR(o,a);var c=bR(o,s);for(a=0;a<l.length;a+=2){var u=l[a],h=l[a+1];u==="style"?jY(n,h):u==="dangerouslySetInnerHTML"?FY(n,h):u==="children"?vx(n,h):Az(n,u,h,c)}switch(o){case"input":mR(n,s);break;case"textarea":kY(n,s);break;case"select":var d=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Mv(n,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?Mv(n,!!s.multiple,s.defaultValue,!0):Mv(n,!!s.multiple,s.multiple?[]:"",!1))}n[Ax]=s}catch(v){Zr(e,e.return,v)}}break;case 6:if(ul(t,e),rc(e),r&4){if(e.stateNode===null)throw Error(ft(162));n=e.stateNode,s=e.memoizedProps;try{n.nodeValue=s}catch(v){Zr(e,e.return,v)}}break;case 3:if(ul(t,e),rc(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{wx(t.containerInfo)}catch(v){Zr(e,e.return,v)}break;case 4:ul(t,e),rc(e);break;case 13:ul(t,e),rc(e),n=e.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(sB=un())),r&4&&aV(e);break;case 22:if(u=i!==null&&i.memoizedState!==null,e.mode&1?(js=(c=js)||u,ul(t,e),js=c):ul(t,e),rc(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(Nt=e,u=e.child;u!==null;){for(h=Nt=u;Nt!==null;){switch(d=Nt,p=d.child,d.tag){case 0:case 11:case 14:case 15:V1(4,d,d.return);break;case 1:nv(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,i=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(v){Zr(r,i,v)}}break;case 5:nv(d,d.return);break;case 22:if(d.memoizedState!==null){lV(h);continue}}p!==null?(p.return=d,Nt=p):lV(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=VY("display",a))}catch(v){Zr(e,e.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){Zr(e,e.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ul(t,e),rc(e),r&4&&aV(e);break;case 21:break;default:ul(t,e),rc(e)}}function rc(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(pQ(i)){var r=i;break e}i=i.return}throw Error(ft(160))}switch(r.tag){case 5:var n=r.stateNode;r.flags&32&&(vx(n,""),r.flags&=-33);var s=sV(e);QR(e,s,n);break;case 3:case 4:var a=r.stateNode.containerInfo,o=sV(e);ZR(e,o,a);break;default:throw Error(ft(161))}}catch(l){Zr(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Ace(e,t,i){Nt=e,gQ(e)}function gQ(e,t,i){for(var r=(e.mode&1)!==0;Nt!==null;){var n=Nt,s=n.child;if(n.tag===22&&r){var a=n.memoizedState!==null||E_;if(!a){var o=n.alternate,l=o!==null&&o.memoizedState!==null||js;o=E_;var c=js;if(E_=a,(js=l)&&!c)for(Nt=n;Nt!==null;)a=Nt,l=a.child,a.tag===22&&a.memoizedState!==null?cV(n):l!==null?(l.return=a,Nt=l):cV(n);for(;s!==null;)Nt=s,gQ(s),s=s.sibling;Nt=n,E_=o,js=c}oV(e)}else n.subtreeFlags&8772&&s!==null?(s.return=n,Nt=s):oV(e)}}function oV(e){for(;Nt!==null;){var t=Nt;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:js||JC(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!js)if(i===null)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:Al(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&W5(t,s,r);break;case 3:var a=t.updateQueue;if(a!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}W5(t,a,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&wx(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ft(163))}js||t.flags&512&&YR(t)}catch(d){Zr(t,t.return,d)}}if(t===e){Nt=null;break}if(i=t.sibling,i!==null){i.return=t.return,Nt=i;break}Nt=t.return}}function lV(e){for(;Nt!==null;){var t=Nt;if(t===e){Nt=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Nt=i;break}Nt=t.return}}function cV(e){for(;Nt!==null;){var t=Nt;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{JC(4,t)}catch(l){Zr(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var n=t.return;try{r.componentDidMount()}catch(l){Zr(t,n,l)}}var s=t.return;try{YR(t)}catch(l){Zr(t,s,l)}break;case 5:var a=t.return;try{YR(t)}catch(l){Zr(t,a,l)}}}catch(l){Zr(t,t.return,l)}if(t===e){Nt=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Nt=o;break}Nt=t.return}}var Cce=Math.ceil,aA=fh.ReactCurrentDispatcher,rB=fh.ReactCurrentOwner,Ko=fh.ReactCurrentBatchConfig,Hi=0,cs=null,_n=null,Es=0,no=0,sv=ip(0),Vn=0,Rx=null,qf=0,$C=0,nB=0,j1=null,Oa=null,sB=0,Kv=1/0,Eu=null,oA=!1,KR=null,Ld=null,A_=!1,md=null,lA=0,H1=0,JR=null,lE=-1,cE=0;function ya(){return Hi&6?un():lE!==-1?lE:lE=un()}function Rd(e){return e.mode&1?Hi&2&&Es!==0?Es&-Es:uce.transition!==null?(cE===0&&(cE=eZ()),cE):(e=or,e!==0||(e=window.event,e=e===void 0?16:oZ(e.type)),e):1}function kl(e,t,i,r){if(50<H1)throw H1=0,JR=null,Error(ft(185));Ob(e,i,r),(!(Hi&2)||e!==cs)&&(e===cs&&(!(Hi&2)&&($C|=i),Vn===4&&ad(e,Es)),Ga(e,r),i===1&&Hi===0&&!(t.mode&1)&&(Kv=un()+500,ZC&&rp()))}function Ga(e,t){var i=e.callbackNode;ule(e,t);var r=WE(e,e===cs?Es:0);if(r===0)i!==null&&y5(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&y5(i),t===1)e.tag===0?cce(uV.bind(null,e)):AZ(uV.bind(null,e)),sce(function(){!(Hi&6)&&rp()}),i=null;else{switch(tZ(r)){case 1:i=Lz;break;case 4:i=JY;break;case 16:i=GE;break;case 536870912:i=$Y;break;default:i=GE}i=MQ(i,vQ.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function vQ(e,t){if(lE=-1,cE=0,Hi&6)throw Error(ft(327));var i=e.callbackNode;if(Pv()&&e.callbackNode!==i)return null;var r=WE(e,e===cs?Es:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=cA(e,r);else{t=r;var n=Hi;Hi|=2;var s=xQ();(cs!==e||Es!==t)&&(Eu=null,Kv=un()+500,Df(e,t));do try{Dce();break}catch(o){yQ(e,o)}while(!0);Gz(),aA.current=s,Hi=n,_n!==null?t=0:(cs=null,Es=0,t=Vn)}if(t!==0){if(t===2&&(n=ER(e),n!==0&&(r=n,t=$R(e,n))),t===1)throw i=Rx,Df(e,0),ad(e,r),Ga(e,un()),i;if(t===6)ad(e,r);else{if(n=e.current.alternate,!(r&30)&&!Tce(n)&&(t=cA(e,r),t===2&&(s=ER(e),s!==0&&(r=s,t=$R(e,s))),t===1))throw i=Rx,Df(e,0),ad(e,r),Ga(e,un()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(ft(345));case 2:qp(e,Oa,Eu);break;case 3:if(ad(e,r),(r&130023424)===r&&(t=sB+500-un(),10<t)){if(WE(e,0)!==0)break;if(n=e.suspendedLanes,(n&r)!==r){ya(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=IR(qp.bind(null,e,Oa,Eu),t);break}qp(e,Oa,Eu);break;case 4:if(ad(e,r),(r&4194240)===r)break;for(t=e.eventTimes,n=-1;0<r;){var a=31-Bl(r);s=1<<a,a=t[a],a>n&&(n=a),r&=~s}if(r=n,r=un()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cce(r/1960))-r,10<r){e.timeoutHandle=IR(qp.bind(null,e,Oa,Eu),r);break}qp(e,Oa,Eu);break;case 5:qp(e,Oa,Eu);break;default:throw Error(ft(329))}}}return Ga(e,un()),e.callbackNode===i?vQ.bind(null,e):null}function $R(e,t){var i=j1;return e.current.memoizedState.isDehydrated&&(Df(e,t).flags|=256),e=cA(e,t),e!==2&&(t=Oa,Oa=i,t!==null&&eI(t)),e}function eI(e){Oa===null?Oa=e:Oa.push.apply(Oa,e)}function Tce(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var n=i[r],s=n.getSnapshot;n=n.value;try{if(!Fl(s(),n))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ad(e,t){for(t&=~nB,t&=~$C,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Bl(t),r=1<<i;e[i]=-1,t&=~r}}function uV(e){if(Hi&6)throw Error(ft(327));Pv();var t=WE(e,0);if(!(t&1))return Ga(e,un()),null;var i=cA(e,t);if(e.tag!==0&&i===2){var r=ER(e);r!==0&&(t=r,i=$R(e,r))}if(i===1)throw i=Rx,Df(e,0),ad(e,t),Ga(e,un()),i;if(i===6)throw Error(ft(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,qp(e,Oa,Eu),Ga(e,un()),null}function aB(e,t){var i=Hi;Hi|=1;try{return e(t)}finally{Hi=i,Hi===0&&(Kv=un()+500,ZC&&rp())}}function Yf(e){md!==null&&md.tag===0&&!(Hi&6)&&Pv();var t=Hi;Hi|=1;var i=Ko.transition,r=or;try{if(Ko.transition=null,or=1,e)return e()}finally{or=r,Ko.transition=i,Hi=t,!(Hi&6)&&rp()}}function oB(){no=sv.current,Tr(sv)}function Df(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,nce(i)),_n!==null)for(i=_n.return;i!==null;){var r=i;switch(Vz(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&QE();break;case 3:Zv(),Tr(ja),Tr(Ks),Qz();break;case 5:Zz(r);break;case 4:Zv();break;case 13:Tr(Or);break;case 19:Tr(Or);break;case 10:Wz(r.type._context);break;case 22:case 23:oB()}i=i.return}if(cs=e,_n=e=Id(e.current,null),Es=no=t,Vn=0,Rx=null,nB=$C=qf=0,Oa=j1=null,ff!==null){for(t=0;t<ff.length;t++)if(i=ff[t],r=i.interleaved,r!==null){i.interleaved=null;var n=r.next,s=i.pending;if(s!==null){var a=s.next;s.next=n,r.next=a}i.pending=r}ff=null}return e}function yQ(e,t){do{var i=_n;try{if(Gz(),sE.current=sA,nA){for(var r=Ur.memoizedState;r!==null;){var n=r.queue;n!==null&&(n.pending=null),r=r.next}nA=!1}if(Xf=0,is=zn=Ur=null,F1=!1,Px=0,rB.current=null,i===null||i.return===null){Vn=1,Rx=t,_n=null;break}e:{var s=e,a=i.return,o=i,l=t;if(t=Es,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=K5(a);if(p!==null){p.flags&=-257,J5(p,a,o,s,t),p.mode&1&&Q5(s,c,t),t=p,l=c;var f=t.updateQueue;if(f===null){var v=new Set;v.add(l),t.updateQueue=v}else f.add(l);break e}else{if(!(t&1)){Q5(s,c,t),lB();break e}l=Error(ft(426))}}else if(Lr&&o.mode&1){var m=K5(a);if(m!==null){!(m.flags&65536)&&(m.flags|=256),J5(m,a,o,s,t),jz(Qv(l,o));break e}}s=l=Qv(l,o),Vn!==4&&(Vn=2),j1===null?j1=[s]:j1.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var g=tQ(s,l,t);G5(s,g);break e;case 1:o=l;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Ld===null||!Ld.has(x)))){s.flags|=65536,t&=-t,s.lanes|=t;var _=iQ(s,o,t);G5(s,_);break e}}s=s.return}while(s!==null)}wQ(i)}catch(M){t=M,_n===i&&i!==null&&(_n=i=i.return);continue}break}while(!0)}function xQ(){var e=aA.current;return aA.current=sA,e===null?sA:e}function lB(){(Vn===0||Vn===3||Vn===2)&&(Vn=4),cs===null||!(qf&268435455)&&!($C&268435455)||ad(cs,Es)}function cA(e,t){var i=Hi;Hi|=2;var r=xQ();(cs!==e||Es!==t)&&(Eu=null,Df(e,t));do try{Pce();break}catch(n){yQ(e,n)}while(!0);if(Gz(),Hi=i,aA.current=r,_n!==null)throw Error(ft(261));return cs=null,Es=0,Vn}function Pce(){for(;_n!==null;)bQ(_n)}function Dce(){for(;_n!==null&&!tle();)bQ(_n)}function bQ(e){var t=SQ(e.alternate,e,no);e.memoizedProps=e.pendingProps,t===null?wQ(e):_n=t,rB.current=null}function wQ(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=Sce(i,t),i!==null){i.flags&=32767,_n=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Vn=6,_n=null;return}}else if(i=_ce(i,t,no),i!==null){_n=i;return}if(t=t.sibling,t!==null){_n=t;return}_n=t=e}while(t!==null);Vn===0&&(Vn=5)}function qp(e,t,i){var r=or,n=Ko.transition;try{Ko.transition=null,or=1,Lce(e,t,i,r)}finally{Ko.transition=n,or=r}return null}function Lce(e,t,i,r){do Pv();while(md!==null);if(Hi&6)throw Error(ft(327));i=e.finishedWork;var n=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(ft(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(hle(e,s),e===cs&&(_n=cs=null,Es=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||A_||(A_=!0,MQ(GE,function(){return Pv(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=Ko.transition,Ko.transition=null;var a=or;or=1;var o=Hi;Hi|=4,rB.current=null,Ece(e,i),mQ(i,e),Kle(LR),XE=!!DR,LR=DR=null,e.current=i,Ace(i),ile(),Hi=o,or=a,Ko.transition=s}else e.current=i;if(A_&&(A_=!1,md=e,lA=n),s=e.pendingLanes,s===0&&(Ld=null),sle(i.stateNode),Ga(e,un()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(oA)throw oA=!1,e=KR,KR=null,e;return lA&1&&e.tag!==0&&Pv(),s=e.pendingLanes,s&1?e===JR?H1++:(H1=0,JR=e):H1=0,rp(),null}function Pv(){if(md!==null){var e=tZ(lA),t=Ko.transition,i=or;try{if(Ko.transition=null,or=16>e?16:e,md===null)var r=!1;else{if(e=md,md=null,lA=0,Hi&6)throw Error(ft(331));var n=Hi;for(Hi|=4,Nt=e.current;Nt!==null;){var s=Nt,a=s.child;if(Nt.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(Nt=c;Nt!==null;){var u=Nt;switch(u.tag){case 0:case 11:case 15:V1(8,u,s)}var h=u.child;if(h!==null)h.return=u,Nt=h;else for(;Nt!==null;){u=Nt;var d=u.sibling,p=u.return;if(dQ(u),u===c){Nt=null;break}if(d!==null){d.return=p,Nt=d;break}Nt=p}}}var f=s.alternate;if(f!==null){var v=f.child;if(v!==null){f.child=null;do{var m=v.sibling;v.sibling=null,v=m}while(v!==null)}}Nt=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Nt=a;else e:for(;Nt!==null;){if(s=Nt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:V1(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,Nt=g;break e}Nt=s.return}}var y=e.current;for(Nt=y;Nt!==null;){a=Nt;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Nt=x;else e:for(a=y;Nt!==null;){if(o=Nt,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:JC(9,o)}}catch(M){Zr(o,o.return,M)}if(o===a){Nt=null;break e}var _=o.sibling;if(_!==null){_.return=o.return,Nt=_;break e}Nt=o.return}}if(Hi=n,rp(),Rc&&typeof Rc.onPostCommitFiberRoot=="function")try{Rc.onPostCommitFiberRoot(GC,e)}catch{}r=!0}return r}finally{or=i,Ko.transition=t}}return!1}function hV(e,t,i){t=Qv(i,t),t=tQ(e,t,1),e=Dd(e,t,1),t=ya(),e!==null&&(Ob(e,1,t),Ga(e,t))}function Zr(e,t,i){if(e.tag===3)hV(e,e,i);else for(;t!==null;){if(t.tag===3){hV(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ld===null||!Ld.has(r))){e=Qv(i,e),e=iQ(t,e,1),t=Dd(t,e,1),e=ya(),t!==null&&(Ob(t,1,e),Ga(t,e));break}}t=t.return}}function Rce(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=ya(),e.pingedLanes|=e.suspendedLanes&i,cs===e&&(Es&i)===i&&(Vn===4||Vn===3&&(Es&130023424)===Es&&500>un()-sB?Df(e,0):nB|=i),Ga(e,t)}function _Q(e,t){t===0&&(e.mode&1?(t=g_,g_<<=1,!(g_&130023424)&&(g_=4194304)):t=1);var i=ya();e=ih(e,t),e!==null&&(Ob(e,t,i),Ga(e,i))}function Ice(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),_Q(e,i)}function Oce(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;n!==null&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(ft(314))}r!==null&&r.delete(t),_Q(e,i)}var SQ;SQ=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||ja.current)Ua=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Ua=!1,wce(e,t,i);Ua=!!(e.flags&131072)}else Ua=!1,Lr&&t.flags&1048576&&CZ(t,$E,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;oE(e,t),e=t.pendingProps;var n=Xv(t,Ks.current);Tv(t,i),n=Jz(null,t,r,e,n,i);var s=$z();return t.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ha(r)?(s=!0,KE(t)):s=!1,t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,qz(t),n.updater=KC,t.stateNode=n,n._reactInternals=t,FR(t,r,e,i),t=HR(null,t,r,!0,s,i)):(t.tag=0,Lr&&s&&Fz(t),ua(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(oE(e,t),e=t.pendingProps,n=r._init,r=n(r._payload),t.type=r,n=t.tag=zce(r),e=Al(r,e),n){case 0:t=jR(null,t,r,e,i);break e;case 1:t=tV(null,t,r,e,i);break e;case 11:t=$5(null,t,r,e,i);break e;case 14:t=eV(null,t,r,Al(r.type,e),i);break e}throw Error(ft(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Al(r,n),jR(e,t,r,n,i);case 1:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Al(r,n),tV(e,t,r,n,i);case 3:e:{if(aQ(t),e===null)throw Error(ft(387));r=t.pendingProps,s=t.memoizedState,n=s.element,IZ(e,t),iA(t,r,null,i);var a=t.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){n=Qv(Error(ft(423)),t),t=iV(e,t,r,i,n);break e}else if(r!==n){n=Qv(Error(ft(424)),t),t=iV(e,t,r,i,n);break e}else for(co=Pd(t.stateNode.containerInfo.firstChild),ho=t,Lr=!0,Pl=null,i=LZ(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(qv(),r===n){t=rh(e,t,i);break e}ua(e,t,r,i)}t=t.child}return t;case 5:return OZ(t),e===null&&BR(t),r=t.type,n=t.pendingProps,s=e!==null?e.memoizedProps:null,a=n.children,RR(r,n)?a=null:s!==null&&RR(r,s)&&(t.flags|=32),sQ(e,t),ua(e,t,a,i),t.child;case 6:return e===null&&BR(t),null;case 13:return oQ(e,t,i);case 4:return Yz(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Yv(t,null,r,i):ua(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Al(r,n),$5(e,t,r,n,i);case 7:return ua(e,t,t.pendingProps,i),t.child;case 8:return ua(e,t,t.pendingProps.children,i),t.child;case 12:return ua(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,s=t.memoizedProps,a=n.value,wr(eA,r._currentValue),r._currentValue=a,s!==null)if(Fl(s.value,a)){if(s.children===n.children&&!ja.current){t=rh(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Yu(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),kR(s.return,i,t),o.lanes|=i;break}l=l.next}}else if(s.tag===10)a=s.type===t.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ft(341));a.lanes|=i,o=a.alternate,o!==null&&(o.lanes|=i),kR(a,i,t),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}ua(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,Tv(t,i),n=tl(n),r=r(n),t.flags|=1,ua(e,t,r,i),t.child;case 14:return r=t.type,n=Al(r,t.pendingProps),n=Al(r.type,n),eV(e,t,r,n,i);case 15:return rQ(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:Al(r,n),oE(e,t),t.tag=1,Ha(r)?(e=!0,KE(t)):e=!1,Tv(t,i),eQ(t,r,n),FR(t,r,n,i),HR(null,t,r,!0,e,i);case 19:return lQ(e,t,i);case 22:return nQ(e,t,i)}throw Error(ft(156,t.tag))};function MQ(e,t){return KY(e,t)}function Nce(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yo(e,t,i,r){return new Nce(e,t,i,r)}function cB(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zce(e){if(typeof e=="function")return cB(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Tz)return 11;if(e===Pz)return 14}return 2}function Id(e,t){var i=e.alternate;return i===null?(i=Yo(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function uE(e,t,i,r,n,s){var a=2;if(r=e,typeof e=="function")cB(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Zg:return Lf(i.children,n,s,t);case Cz:a=8,n|=8;break;case uR:return e=Yo(12,i,t,n|2),e.elementType=uR,e.lanes=s,e;case hR:return e=Yo(13,i,t,n),e.elementType=hR,e.lanes=s,e;case dR:return e=Yo(19,i,t,n),e.elementType=dR,e.lanes=s,e;case OY:return eT(i,n,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case RY:a=10;break e;case IY:a=9;break e;case Tz:a=11;break e;case Pz:a=14;break e;case ed:a=16,r=null;break e}throw Error(ft(130,e==null?e:typeof e,""))}return t=Yo(a,i,t,n),t.elementType=e,t.type=r,t.lanes=s,t}function Lf(e,t,i,r){return e=Yo(7,e,r,t),e.lanes=i,e}function eT(e,t,i,r){return e=Yo(22,e,r,t),e.elementType=OY,e.lanes=i,e.stateNode={isHidden:!1},e}function VP(e,t,i){return e=Yo(6,e,null,t),e.lanes=i,e}function jP(e,t,i){return t=Yo(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bce(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=_P(0),this.expirationTimes=_P(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_P(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function uB(e,t,i,r,n,s,a,o,l){return e=new Bce(e,t,i,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Yo(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},qz(s),e}function kce(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yg,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function EQ(e){if(!e)return Xd;e=e._reactInternals;e:{if(lm(e)!==e||e.tag!==1)throw Error(ft(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ha(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ft(171))}if(e.tag===1){var i=e.type;if(Ha(i))return EZ(e,i,t)}return t}function AQ(e,t,i,r,n,s,a,o,l){return e=uB(i,r,!0,e,n,s,a,o,l),e.context=EQ(null),i=e.current,r=ya(),n=Rd(i),s=Yu(r,n),s.callback=t??null,Dd(i,s,n),e.current.lanes=n,Ob(e,n,r),Ga(e,r),e}function tT(e,t,i,r){var n=t.current,s=ya(),a=Rd(n);return i=EQ(i),t.context===null?t.context=i:t.pendingContext=i,t=Yu(s,a),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Dd(n,t,a),e!==null&&(kl(e,n,a,s),nE(e,n,a)),a}function uA(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function dV(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function hB(e,t){dV(e,t),(e=e.alternate)&&dV(e,t)}function Uce(){return null}var CQ=typeof reportError=="function"?reportError:function(e){console.error(e)};function dB(e){this._internalRoot=e}iT.prototype.render=dB.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ft(409));tT(e,t,null,null)};iT.prototype.unmount=dB.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Yf(function(){tT(null,e,null,null)}),t[th]=null}};function iT(e){this._internalRoot=e}iT.prototype.unstable_scheduleHydration=function(e){if(e){var t=nZ();e={blockedOn:null,target:e,priority:t};for(var i=0;i<sd.length&&t!==0&&t<sd[i].priority;i++);sd.splice(i,0,e),i===0&&aZ(e)}};function pB(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function rT(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pV(){}function Fce(e,t,i,r,n){if(n){if(typeof r=="function"){var s=r;r=function(){var c=uA(a);s.call(c)}}var a=AQ(t,r,e,0,null,!1,!1,"",pV);return e._reactRootContainer=a,e[th]=a.current,Mx(e.nodeType===8?e.parentNode:e),Yf(),a}for(;n=e.lastChild;)e.removeChild(n);if(typeof r=="function"){var o=r;r=function(){var c=uA(l);o.call(c)}}var l=uB(e,0,!1,null,null,!1,!1,"",pV);return e._reactRootContainer=l,e[th]=l.current,Mx(e.nodeType===8?e.parentNode:e),Yf(function(){tT(t,l,i,r)}),l}function nT(e,t,i,r,n){var s=i._reactRootContainer;if(s){var a=s;if(typeof n=="function"){var o=n;n=function(){var l=uA(a);o.call(l)}}tT(t,a,e,n)}else a=Fce(i,t,e,n,r);return uA(a)}iZ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=y1(t.pendingLanes);i!==0&&(Rz(t,i|1),Ga(t,un()),!(Hi&6)&&(Kv=un()+500,rp()))}break;case 13:Yf(function(){var r=ih(e,1);if(r!==null){var n=ya();kl(r,e,1,n)}}),hB(e,1)}};Iz=function(e){if(e.tag===13){var t=ih(e,134217728);if(t!==null){var i=ya();kl(t,e,134217728,i)}hB(e,134217728)}};rZ=function(e){if(e.tag===13){var t=Rd(e),i=ih(e,t);if(i!==null){var r=ya();kl(i,e,t,r)}hB(e,t)}};nZ=function(){return or};sZ=function(e,t){var i=or;try{return or=e,t()}finally{or=i}};_R=function(e,t,i){switch(t){case"input":if(mR(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=YC(r);if(!n)throw Error(ft(90));zY(r),mR(r,n)}}}break;case"textarea":kY(e,i);break;case"select":t=i.value,t!=null&&Mv(e,!!i.multiple,t,!1)}};WY=aB;XY=Yf;var Vce={usingClientEntryPoint:!1,Events:[zb,$g,YC,HY,GY,aB]},_y={findFiberByHostInstance:pf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jce={bundleType:_y.bundleType,version:_y.version,rendererPackageName:_y.rendererPackageName,rendererConfig:_y.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:fh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=ZY(e),e===null?null:e.stateNode},findFiberByHostInstance:_y.findFiberByHostInstance||Uce,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var C_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!C_.isDisabled&&C_.supportsFiber)try{GC=C_.inject(jce),Rc=C_}catch{}}xo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vce;xo.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pB(t))throw Error(ft(200));return kce(e,t,null,i)};xo.createRoot=function(e,t){if(!pB(e))throw Error(ft(299));var i=!1,r="",n=CQ;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(n=t.onRecoverableError)),t=uB(e,1,!1,null,null,i,!1,r,n),e[th]=t.current,Mx(e.nodeType===8?e.parentNode:e),new dB(t)};xo.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ft(188)):(e=Object.keys(e).join(","),Error(ft(268,e)));return e=ZY(t),e=e===null?null:e.stateNode,e};xo.flushSync=function(e){return Yf(e)};xo.hydrate=function(e,t,i){if(!rT(t))throw Error(ft(200));return nT(null,e,t,!0,i)};xo.hydrateRoot=function(e,t,i){if(!pB(e))throw Error(ft(405));var r=i!=null&&i.hydratedSources||null,n=!1,s="",a=CQ;if(i!=null&&(i.unstable_strictMode===!0&&(n=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(a=i.onRecoverableError)),t=AQ(t,null,e,1,i??null,n,!1,s,a),e[th]=t.current,Mx(e),r)for(e=0;e<r.length;e++)i=r[e],n=i._getVersion,n=n(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new iT(t)};xo.render=function(e,t,i){if(!rT(t))throw Error(ft(200));return nT(null,e,t,!1,i)};xo.unmountComponentAtNode=function(e){if(!rT(e))throw Error(ft(40));return e._reactRootContainer?(Yf(function(){nT(null,null,e,!1,function(){e._reactRootContainer=null,e[th]=null})}),!0):!1};xo.unstable_batchedUpdates=aB;xo.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!rT(i))throw Error(ft(200));if(e==null||e._reactInternals===void 0)throw Error(ft(38));return nT(e,t,i,!1,r)};xo.version="18.3.1-next-f1338f8080-20240426";function TQ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(TQ)}catch(e){console.error(e)}}TQ(),TY.exports=xo;var cm=TY.exports,PQ,fV=cm;PQ=fV.createRoot,fV.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ix(){return Ix=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Ix.apply(this,arguments)}var gd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(gd||(gd={}));const mV="popstate";function Hce(e){e===void 0&&(e={});function t(r,n){let{pathname:s,search:a,hash:o}=r.location;return tI("",{pathname:s,search:a,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function i(r,n){return typeof n=="string"?n:hA(n)}return Wce(t,i,null,e)}function Cn(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function DQ(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Gce(){return Math.random().toString(36).substr(2,8)}function gV(e,t){return{usr:e.state,key:e.key,idx:t}}function tI(e,t,i,r){return i===void 0&&(i=null),Ix({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?M0(t):t,{state:i,key:t&&t.key||r||Gce()})}function hA(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function M0(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function Wce(e,t,i,r){r===void 0&&(r={});let{window:n=document.defaultView,v5Compat:s=!1}=r,a=n.history,o=gd.Pop,l=null,c=u();c==null&&(c=0,a.replaceState(Ix({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function h(){o=gd.Pop;let m=u(),g=m==null?null:m-c;c=m,l&&l({action:o,location:v.location,delta:g})}function d(m,g){o=gd.Push;let y=tI(v.location,m,g);c=u()+1;let x=gV(y,c),_=v.createHref(y);try{a.pushState(x,"",_)}catch(M){if(M instanceof DOMException&&M.name==="DataCloneError")throw M;n.location.assign(_)}s&&l&&l({action:o,location:v.location,delta:1})}function p(m,g){o=gd.Replace;let y=tI(v.location,m,g);c=u();let x=gV(y,c),_=v.createHref(y);a.replaceState(x,"",_),s&&l&&l({action:o,location:v.location,delta:0})}function f(m){let g=n.location.origin!=="null"?n.location.origin:n.location.href,y=typeof m=="string"?m:hA(m);return y=y.replace(/ $/,"%20"),Cn(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let v={get action(){return o},get location(){return e(n,a)},listen(m){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(mV,h),l=m,()=>{n.removeEventListener(mV,h),l=null}},createHref(m){return t(n,m)},createURL:f,encodeLocation(m){let g=f(m);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:d,replace:p,go(m){return a.go(m)}};return v}var vV;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(vV||(vV={}));function Xce(e,t,i){return i===void 0&&(i="/"),qce(e,t,i,!1)}function qce(e,t,i,r){let n=typeof t=="string"?M0(t):t,s=fB(n.pathname||"/",i);if(s==null)return null;let a=LQ(e);Yce(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let c=sue(s);o=rue(a[l],c,r)}return o}function LQ(e,t,i,r){t===void 0&&(t=[]),i===void 0&&(i=[]),r===void 0&&(r="");let n=(s,a,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};l.relativePath.startsWith("/")&&(Cn(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=Od([r,l.relativePath]),u=i.concat(l);s.children&&s.children.length>0&&(Cn(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),LQ(s.children,t,u,c)),!(s.path==null&&!s.index)&&t.push({path:c,score:tue(c,s.index),routesMeta:u})};return e.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))n(s,a);else for(let l of RQ(s.path))n(s,a,l)}),t}function RQ(e){let t=e.split("/");if(t.length===0)return[];let[i,...r]=t,n=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return n?[s,""]:[s];let a=RQ(r.join("/")),o=[];return o.push(...a.map(l=>l===""?s:[s,l].join("/"))),n&&o.push(...a),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function Yce(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:iue(t.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}const Zce=/^:[\w-]+$/,Qce=3,Kce=2,Jce=1,$ce=10,eue=-2,yV=e=>e==="*";function tue(e,t){let i=e.split("/"),r=i.length;return i.some(yV)&&(r+=eue),t&&(r+=Kce),i.filter(n=>!yV(n)).reduce((n,s)=>n+(Zce.test(s)?Qce:s===""?Jce:$ce),r)}function iue(e,t){return e.length===t.length&&e.slice(0,-1).every((r,n)=>r===t[n])?e[e.length-1]-t[t.length-1]:0}function rue(e,t,i){let{routesMeta:r}=e,n={},s="/",a=[];for(let o=0;o<r.length;++o){let l=r[o],c=o===r.length-1,u=s==="/"?t:t.slice(s.length)||"/",h=xV({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h&&c&&i&&!r[r.length-1].route.index&&(h=xV({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(n,h.params),a.push({params:n,pathname:Od([s,h.pathname]),pathnameBase:cue(Od([s,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(s=Od([s,h.pathnameBase]))}return a}function xV(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=nue(e.path,e.caseSensitive,e.end),n=t.match(i);if(!n)return null;let s=n[0],a=s.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:r.reduce((c,u,h)=>{let{paramName:d,isOptional:p}=u;if(d==="*"){let v=o[h]||"";a=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const f=o[h];return p&&!f?c[d]=void 0:c[d]=(f||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:a,pattern:e}}function nue(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),DQ(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),n+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":e!==""&&e!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,t?void 0:"i"),r]}function sue(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return DQ(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function fB(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}function aue(e,t){t===void 0&&(t="/");let{pathname:i,search:r="",hash:n=""}=typeof e=="string"?M0(e):e;return{pathname:i?i.startsWith("/")?i:oue(i,t):t,search:uue(r),hash:hue(n)}}function oue(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(n=>{n===".."?i.length>1&&i.pop():n!=="."&&i.push(n)}),i.length>1?i.join("/"):"/"}function HP(e,t,i,r){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+i+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function lue(e){return e.filter((t,i)=>i===0||t.route.path&&t.route.path.length>0)}function IQ(e,t){let i=lue(e);return t?i.map((r,n)=>n===i.length-1?r.pathname:r.pathnameBase):i.map(r=>r.pathnameBase)}function OQ(e,t,i,r){r===void 0&&(r=!1);let n;typeof e=="string"?n=M0(e):(n=Ix({},e),Cn(!n.pathname||!n.pathname.includes("?"),HP("?","pathname","search",n)),Cn(!n.pathname||!n.pathname.includes("#"),HP("#","pathname","hash",n)),Cn(!n.search||!n.search.includes("#"),HP("#","search","hash",n)));let s=e===""||n.pathname==="",a=s?"/":n.pathname,o;if(a==null)o=i;else{let h=t.length-1;if(!r&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;n.pathname=d.join("/")}o=h>=0?t[h]:"/"}let l=aue(n,o),c=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&i.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}const Od=e=>e.join("/").replace(/\/\/+/g,"/"),cue=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),uue=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,hue=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function due(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const NQ=["post","put","patch","delete"];new Set(NQ);const pue=["get",...NQ];new Set(pue);/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ox(){return Ox=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Ox.apply(this,arguments)}const mB=R.createContext(null),fue=R.createContext(null),um=R.createContext(null),sT=R.createContext(null),hm=R.createContext({outlet:null,matches:[],isDataRoute:!1}),zQ=R.createContext(null);function mue(e,t){let{relative:i}=t===void 0?{}:t;kb()||Cn(!1);let{basename:r,navigator:n}=R.useContext(um),{hash:s,pathname:a,search:o}=kQ(e,{relative:i}),l=a;return r!=="/"&&(l=a==="/"?r:Od([r,a])),n.createHref({pathname:l,search:o,hash:s})}function kb(){return R.useContext(sT)!=null}function Ub(){return kb()||Cn(!1),R.useContext(sT).location}function BQ(e){R.useContext(um).static||R.useLayoutEffect(e)}function gue(){let{isDataRoute:e}=R.useContext(hm);return e?Pue():vue()}function vue(){kb()||Cn(!1);let e=R.useContext(mB),{basename:t,future:i,navigator:r}=R.useContext(um),{matches:n}=R.useContext(hm),{pathname:s}=Ub(),a=JSON.stringify(IQ(n,i.v7_relativeSplatPath)),o=R.useRef(!1);return BQ(()=>{o.current=!0}),R.useCallback(function(c,u){if(u===void 0&&(u={}),!o.current)return;if(typeof c=="number"){r.go(c);return}let h=OQ(c,JSON.parse(a),s,u.relative==="path");e==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:Od([t,h.pathname])),(u.replace?r.replace:r.push)(h,u.state,u)},[t,r,a,s,e])}function kQ(e,t){let{relative:i}=t===void 0?{}:t,{future:r}=R.useContext(um),{matches:n}=R.useContext(hm),{pathname:s}=Ub(),a=JSON.stringify(IQ(n,r.v7_relativeSplatPath));return R.useMemo(()=>OQ(e,JSON.parse(a),s,i==="path"),[e,a,s,i])}function yue(e,t){return xue(e,t)}function xue(e,t,i,r){kb()||Cn(!1);let{navigator:n,static:s}=R.useContext(um),{matches:a}=R.useContext(hm),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u=Ub(),h;if(t){var d;let g=typeof t=="string"?M0(t):t;c==="/"||(d=g.pathname)!=null&&d.startsWith(c)||Cn(!1),h=g}else h=u;let p=h.pathname||"/",f=p;if(c!=="/"){let g=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(g.length).join("/")}let v=!s&&i&&i.matches&&i.matches.length>0?i.matches:Xce(e,{pathname:f}),m=Mue(v&&v.map(g=>Object.assign({},g,{params:Object.assign({},l,g.params),pathname:Od([c,n.encodeLocation?n.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?c:Od([c,n.encodeLocation?n.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),a,i,r);return t&&m?R.createElement(sT.Provider,{value:{location:Ox({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:gd.Pop}},m):m}function bue(){let e=Tue(),t=due(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return R.createElement(R.Fragment,null,R.createElement("h2",null,"Unexpected Application Error!"),R.createElement("h3",{style:{fontStyle:"italic"}},t),i?R.createElement("pre",{style:n},i):null,null)}const wue=R.createElement(bue,null);class _ue extends R.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?R.createElement(hm.Provider,{value:this.props.routeContext},R.createElement(zQ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Sue(e){let{routeContext:t,match:i,children:r}=e,n=R.useContext(mB);return n&&n.static&&n.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=i.route.id),R.createElement(hm.Provider,{value:t},r)}function Mue(e,t,i,r){var n;if(t===void 0&&(t=[]),i===void 0&&(i=null),r===void 0&&(r=null),e==null){var s;if(!i)return null;if(i.errors)e=i.matches;else if((s=r)!=null&&s.v7_partialHydration&&t.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let a=e,o=(n=i)==null?void 0:n.errors;if(o!=null){let u=a.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);u>=0||Cn(!1),a=a.slice(0,Math.min(a.length,u+1))}let l=!1,c=-1;if(i&&r&&r.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:d,errors:p}=i,f=h.route.loader&&d[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||f){l=!0,c>=0?a=a.slice(0,c+1):a=[a[0]];break}}}return a.reduceRight((u,h,d)=>{let p,f=!1,v=null,m=null;i&&(p=o&&h.route.id?o[h.route.id]:void 0,v=h.route.errorElement||wue,l&&(c<0&&d===0?(f=!0,m=null):c===d&&(f=!0,m=h.route.hydrateFallbackElement||null)));let g=t.concat(a.slice(0,d+1)),y=()=>{let x;return p?x=v:f?x=m:h.route.Component?x=R.createElement(h.route.Component,null):h.route.element?x=h.route.element:x=u,R.createElement(Sue,{match:h,routeContext:{outlet:u,matches:g,isDataRoute:i!=null},children:x})};return i&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?R.createElement(_ue,{location:i.location,revalidation:i.revalidation,component:v,error:p,children:y(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):y()},null)}var UQ=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(UQ||{}),dA=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(dA||{});function Eue(e){let t=R.useContext(mB);return t||Cn(!1),t}function Aue(e){let t=R.useContext(fue);return t||Cn(!1),t}function Cue(e){let t=R.useContext(hm);return t||Cn(!1),t}function FQ(e){let t=Cue(),i=t.matches[t.matches.length-1];return i.route.id||Cn(!1),i.route.id}function Tue(){var e;let t=R.useContext(zQ),i=Aue(dA.UseRouteError),r=FQ(dA.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[r]}function Pue(){let{router:e}=Eue(UQ.UseNavigateStable),t=FQ(dA.UseNavigateStable),i=R.useRef(!1);return BQ(()=>{i.current=!0}),R.useCallback(function(n,s){s===void 0&&(s={}),i.current&&(typeof n=="number"?e.navigate(n):e.navigate(n,Ox({fromRouteId:t},s)))},[e,t])}function Due(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function wu(e){Cn(!1)}function Lue(e){let{basename:t="/",children:i=null,location:r,navigationType:n=gd.Pop,navigator:s,static:a=!1,future:o}=e;kb()&&Cn(!1);let l=t.replace(/^\/*/,"/"),c=R.useMemo(()=>({basename:l,navigator:s,static:a,future:Ox({v7_relativeSplatPath:!1},o)}),[l,o,s,a]);typeof r=="string"&&(r=M0(r));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:f="default"}=r,v=R.useMemo(()=>{let m=fB(u,l);return m==null?null:{location:{pathname:m,search:h,hash:d,state:p,key:f},navigationType:n}},[l,u,h,d,p,f,n]);return v==null?null:R.createElement(um.Provider,{value:c},R.createElement(sT.Provider,{children:i,value:v}))}function Rue(e){let{children:t,location:i}=e;return yue(iI(t),i)}new Promise(()=>{});function iI(e,t){t===void 0&&(t=[]);let i=[];return R.Children.forEach(e,(r,n)=>{if(!R.isValidElement(r))return;let s=[...t,n];if(r.type===R.Fragment){i.push.apply(i,iI(r.props.children,s));return}r.type!==wu&&Cn(!1),!r.props.index||!r.props.children||Cn(!1);let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=iI(r.props.children,s)),i.push(a)}),i}/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rI(){return rI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},rI.apply(this,arguments)}function Iue(e,t){if(e==null)return{};var i={},r=Object.keys(e),n,s;for(s=0;s<r.length;s++)n=r[s],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}function Oue(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Nue(e,t){return e.button===0&&(!t||t==="_self")&&!Oue(e)}const zue=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Bue="6";try{window.__reactRouterVersion=Bue}catch{}const kue="startTransition",bV=Roe[kue];function Uue(e){let{basename:t,children:i,future:r,window:n}=e,s=R.useRef();s.current==null&&(s.current=Hce({window:n,v5Compat:!0}));let a=s.current,[o,l]=R.useState({action:a.action,location:a.location}),{v7_startTransition:c}=r||{},u=R.useCallback(h=>{c&&bV?bV(()=>l(h)):l(h)},[l,c]);return R.useLayoutEffect(()=>a.listen(u),[a,u]),R.useEffect(()=>Due(r),[r]),R.createElement(Lue,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:a,future:r})}const Fue=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Vue=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Zo=R.forwardRef(function(t,i){let{onClick:r,relative:n,reloadDocument:s,replace:a,state:o,target:l,to:c,preventScrollReset:u,viewTransition:h}=t,d=Iue(t,zue),{basename:p}=R.useContext(um),f,v=!1;if(typeof c=="string"&&Vue.test(c)&&(f=c,Fue))try{let x=new URL(window.location.href),_=c.startsWith("//")?new URL(x.protocol+c):new URL(c),M=fB(_.pathname,p);_.origin===x.origin&&M!=null?c=M+_.search+_.hash:v=!0}catch{}let m=mue(c,{relative:n}),g=jue(c,{replace:a,state:o,target:l,preventScrollReset:u,relative:n,viewTransition:h});function y(x){r&&r(x),x.defaultPrevented||g(x)}return R.createElement("a",rI({},d,{href:f||m,onClick:v||s?r:y,ref:i,target:l}))});var wV;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(wV||(wV={}));var _V;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(_V||(_V={}));function jue(e,t){let{target:i,replace:r,state:n,preventScrollReset:s,relative:a,viewTransition:o}=t===void 0?{}:t,l=gue(),c=Ub(),u=kQ(e,{relative:a});return R.useCallback(h=>{if(Nue(h,i)){h.preventDefault();let d=r!==void 0?r:hA(c)===hA(u);l(e,{replace:d,state:n,preventScrollReset:s,relative:a,viewTransition:o})}},[c,l,u,r,n,i,e,s,a,o])}const gB=R.createContext({});function vB(e){const t=R.useRef(null);return t.current===null&&(t.current=e()),t.current}const aT=R.createContext(null),yB=R.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class Hue extends R.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=i.offsetHeight||0,r.width=i.offsetWidth||0,r.top=i.offsetTop,r.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Gue({children:e,isPresent:t}){const i=R.useId(),r=R.useRef(null),n=R.useRef({width:0,height:0,top:0,left:0}),{nonce:s}=R.useContext(yB);return R.useInsertionEffect(()=>{const{width:a,height:o,top:l,left:c}=n.current;if(t||!r.current||!a||!o)return;r.current.dataset.motionPopId=i;const u=document.createElement("style");return s&&(u.nonce=s),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${o}px !important;
            top: ${l}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[t]),j.jsx(Hue,{isPresent:t,childRef:r,sizeRef:n,children:R.cloneElement(e,{ref:r})})}const Wue=({children:e,initial:t,isPresent:i,onExitComplete:r,custom:n,presenceAffectsLayout:s,mode:a})=>{const o=vB(Xue),l=R.useId(),c=R.useCallback(h=>{o.set(h,!0);for(const d of o.values())if(!d)return;r&&r()},[o,r]),u=R.useMemo(()=>({id:l,initial:t,isPresent:i,custom:n,onExitComplete:c,register:h=>(o.set(h,!1),()=>o.delete(h))}),s?[Math.random(),c]:[i,c]);return R.useMemo(()=>{o.forEach((h,d)=>o.set(d,!1))},[i]),R.useEffect(()=>{!i&&!o.size&&r&&r()},[i]),a==="popLayout"&&(e=j.jsx(Gue,{isPresent:i,children:e})),j.jsx(aT.Provider,{value:u,children:e})};function Xue(){return new Map}function VQ(e=!0){const t=R.useContext(aT);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:r,register:n}=t,s=R.useId();R.useEffect(()=>{e&&n(s)},[e]);const a=R.useCallback(()=>e&&r&&r(s),[s,r,e]);return!i&&r?[!1,a]:[!0]}const T_=e=>e.key||"";function SV(e){const t=[];return R.Children.forEach(e,i=>{R.isValidElement(i)&&t.push(i)}),t}const xB=typeof window<"u",jQ=xB?R.useLayoutEffect:R.useEffect,que=({children:e,custom:t,initial:i=!0,onExitComplete:r,presenceAffectsLayout:n=!0,mode:s="sync",propagate:a=!1})=>{const[o,l]=VQ(a),c=R.useMemo(()=>SV(e),[e]),u=a&&!o?[]:c.map(T_),h=R.useRef(!0),d=R.useRef(c),p=vB(()=>new Map),[f,v]=R.useState(c),[m,g]=R.useState(c);jQ(()=>{h.current=!1,d.current=c;for(let _=0;_<m.length;_++){const M=T_(m[_]);u.includes(M)?p.delete(M):p.get(M)!==!0&&p.set(M,!1)}},[m,u.length,u.join("-")]);const y=[];if(c!==f){let _=[...c];for(let M=0;M<m.length;M++){const S=m[M],E=T_(S);u.includes(E)||(_.splice(M,0,S),y.push(S))}s==="wait"&&y.length&&(_=y),g(SV(_)),v(c);return}const{forceRender:x}=R.useContext(gB);return j.jsx(j.Fragment,{children:m.map(_=>{const M=T_(_),S=a&&!o?!1:c===m||u.includes(M),E=()=>{if(p.has(M))p.set(M,!0);else return;let A=!0;p.forEach(P=>{P||(A=!1)}),A&&(x==null||x(),g(d.current),a&&(l==null||l()),r&&r())};return j.jsx(Wue,{isPresent:S,initial:!h.current||i?void 0:!1,custom:S?void 0:t,presenceAffectsLayout:n,mode:s,onExitComplete:S?void 0:E,children:_},M)})})},po=e=>e;let nI=po;function bB(e){let t;return()=>(t===void 0&&(t=e()),t)}const Jv=(e,t,i)=>{const r=t-e;return r===0?1:(i-e)/r},Zu=e=>e*1e3,Qu=e=>e/1e3,Yue={skipAnimations:!1,useManualTiming:!1};function Zue(e){let t=new Set,i=new Set,r=!1,n=!1;const s=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function o(c){s.has(c)&&(l.schedule(c),e()),c(a)}const l={schedule:(c,u=!1,h=!1)=>{const p=h&&r?t:i;return u&&s.add(c),p.has(c)||p.add(c),c},cancel:c=>{i.delete(c),s.delete(c)},process:c=>{if(a=c,r){n=!0;return}r=!0,[t,i]=[i,t],t.forEach(o),t.clear(),r=!1,n&&(n=!1,l.process(c))}};return l}const P_=["read","resolveKeyframes","update","preRender","render","postRender"],Que=40;function HQ(e,t){let i=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=P_.reduce((g,y)=>(g[y]=Zue(s),g),{}),{read:o,resolveKeyframes:l,update:c,preRender:u,render:h,postRender:d}=a,p=()=>{const g=performance.now();i=!1,n.delta=r?1e3/60:Math.max(Math.min(g-n.timestamp,Que),1),n.timestamp=g,n.isProcessing=!0,o.process(n),l.process(n),c.process(n),u.process(n),h.process(n),d.process(n),n.isProcessing=!1,i&&t&&(r=!1,e(p))},f=()=>{i=!0,r=!0,n.isProcessing||e(p)};return{schedule:P_.reduce((g,y)=>{const x=a[y];return g[y]=(_,M=!1,S=!1)=>(i||f(),x.schedule(_,M,S)),g},{}),cancel:g=>{for(let y=0;y<P_.length;y++)a[P_[y]].cancel(g)},state:n,steps:a}}const{schedule:Pr,cancel:qd,state:vs,steps:GP}=HQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:po,!0),GQ=R.createContext({strict:!1}),MV={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},$v={};for(const e in MV)$v[e]={isEnabled:t=>MV[e].some(i=>!!t[i])};function Kue(e){for(const t in e)$v[t]={...$v[t],...e[t]}}const Jue=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function pA(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Jue.has(e)}let WQ=e=>!pA(e);function $ue(e){e&&(WQ=t=>t.startsWith("on")?!pA(t):e(t))}try{$ue(require("@emotion/is-prop-valid").default)}catch{}function ehe(e,t,i){const r={};for(const n in e)n==="values"&&typeof e.values=="object"||(WQ(n)||i===!0&&pA(n)||!t&&!pA(n)||e.draggable&&n.startsWith("onDrag"))&&(r[n]=e[n]);return r}function the(e){if(typeof Proxy>"u")return e;const t=new Map,i=(...r)=>e(...r);return new Proxy(i,{get:(r,n)=>n==="create"?e:(t.has(n)||t.set(n,e(n)),t.get(n))})}const oT=R.createContext({});function Nx(e){return typeof e=="string"||Array.isArray(e)}function lT(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const wB=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],_B=["initial",...wB];function cT(e){return lT(e.animate)||_B.some(t=>Nx(e[t]))}function XQ(e){return!!(cT(e)||e.variants)}function ihe(e,t){if(cT(e)){const{initial:i,animate:r}=e;return{initial:i===!1||Nx(i)?i:void 0,animate:Nx(r)?r:void 0}}return e.inherit!==!1?t:{}}function rhe(e){const{initial:t,animate:i}=ihe(e,R.useContext(oT));return R.useMemo(()=>({initial:t,animate:i}),[EV(t),EV(i)])}function EV(e){return Array.isArray(e)?e.join(" "):e}const nhe=Symbol.for("motionComponentSymbol");function av(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function she(e,t,i){return R.useCallback(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),i&&(typeof i=="function"?i(r):av(i)&&(i.current=r))},[t])}const SB=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ahe="framerAppearId",qQ="data-"+SB(ahe),{schedule:MB,cancel:Qqe}=HQ(queueMicrotask,!1),YQ=R.createContext({});function ohe(e,t,i,r,n){var s,a;const{visualElement:o}=R.useContext(oT),l=R.useContext(GQ),c=R.useContext(aT),u=R.useContext(yB).reducedMotion,h=R.useRef(null);r=r||l.renderer,!h.current&&r&&(h.current=r(e,{visualState:t,parent:o,props:i,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u}));const d=h.current,p=R.useContext(YQ);d&&!d.projection&&n&&(d.type==="html"||d.type==="svg")&&lhe(h.current,i,n,p);const f=R.useRef(!1);R.useInsertionEffect(()=>{d&&f.current&&d.update(i,c)});const v=i[qQ],m=R.useRef(!!v&&!(!((s=window.MotionHandoffIsComplete)===null||s===void 0)&&s.call(window,v))&&((a=window.MotionHasOptimisedAnimation)===null||a===void 0?void 0:a.call(window,v)));return jQ(()=>{d&&(f.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),MB.render(d.render),m.current&&d.animationState&&d.animationState.animateChanges())}),R.useEffect(()=>{d&&(!m.current&&d.animationState&&d.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)===null||g===void 0||g.call(window,v)}),m.current=!1))}),d}function lhe(e,t,i,r){const{layoutId:n,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c}=t;e.projection=new i(e.latestValues,t["data-framer-portal-id"]?void 0:ZQ(e.parent)),e.projection.setOptions({layoutId:n,layout:s,alwaysMeasureLayout:!!a||o&&av(o),visualElement:e,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,layoutScroll:l,layoutRoot:c})}function ZQ(e){if(e)return e.options.allowProjection!==!1?e.projection:ZQ(e.parent)}function che({preloadedFeatures:e,createVisualElement:t,useRender:i,useVisualState:r,Component:n}){var s,a;e&&Kue(e);function o(c,u){let h;const d={...R.useContext(yB),...c,layoutId:uhe(c)},{isStatic:p}=d,f=rhe(c),v=r(c,p);if(!p&&xB){hhe();const m=dhe(d);h=m.MeasureLayout,f.visualElement=ohe(n,v,d,t,m.ProjectionNode)}return j.jsxs(oT.Provider,{value:f,children:[h&&f.visualElement?j.jsx(h,{visualElement:f.visualElement,...d}):null,i(n,c,she(v,f.visualElement,u),v,p,f.visualElement)]})}o.displayName=`motion.${typeof n=="string"?n:`create(${(a=(s=n.displayName)!==null&&s!==void 0?s:n.name)!==null&&a!==void 0?a:""})`}`;const l=R.forwardRef(o);return l[nhe]=n,l}function uhe({layoutId:e}){const t=R.useContext(gB).id;return t&&e!==void 0?t+"-"+e:e}function hhe(e,t){R.useContext(GQ).strict}function dhe(e){const{drag:t,layout:i}=$v;if(!t&&!i)return{};const r={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(e)||i!=null&&i.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}const phe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function EB(e){return typeof e!="string"||e.includes("-")?!1:!!(phe.indexOf(e)>-1||/[A-Z]/u.test(e))}function AV(e){const t=[{},{}];return e==null||e.values.forEach((i,r)=>{t[0][r]=i.get(),t[1][r]=i.getVelocity()}),t}function AB(e,t,i,r){if(typeof t=="function"){const[n,s]=AV(r);t=t(i!==void 0?i:e.custom,n,s)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[n,s]=AV(r);t=t(i!==void 0?i:e.custom,n,s)}return t}const sI=e=>Array.isArray(e),fhe=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),mhe=e=>sI(e)?e[e.length-1]||0:e,Xs=e=>!!(e&&e.getVelocity);function hE(e){const t=Xs(e)?e.get():e;return fhe(t)?t.toValue():t}function ghe({scrapeMotionValuesFromProps:e,createRenderState:t,onUpdate:i},r,n,s){const a={latestValues:vhe(r,n,s,e),renderState:t()};return i&&(a.onMount=o=>i({props:r,current:o,...a}),a.onUpdate=o=>i(o)),a}const QQ=e=>(t,i)=>{const r=R.useContext(oT),n=R.useContext(aT),s=()=>ghe(e,t,r,n);return i?s():vB(s)};function vhe(e,t,i,r){const n={},s=r(e,{});for(const d in s)n[d]=hE(s[d]);let{initial:a,animate:o}=e;const l=cT(e),c=XQ(e);t&&c&&!l&&e.inherit!==!1&&(a===void 0&&(a=t.initial),o===void 0&&(o=t.animate));let u=i?i.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!lT(h)){const d=Array.isArray(h)?h:[h];for(let p=0;p<d.length;p++){const f=AB(e,d[p]);if(f){const{transitionEnd:v,transition:m,...g}=f;for(const y in g){let x=g[y];if(Array.isArray(x)){const _=u?x.length-1:0;x=x[_]}x!==null&&(n[y]=x)}for(const y in v)n[y]=v[y]}}}return n}const E0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],dm=new Set(E0),KQ=e=>t=>typeof t=="string"&&t.startsWith(e),JQ=KQ("--"),yhe=KQ("var(--"),CB=e=>yhe(e)?xhe.test(e.split("/*")[0].trim()):!1,xhe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,$Q=(e,t)=>t&&typeof e=="number"?t.transform(e):e,nh=(e,t,i)=>i>t?t:i<e?e:i,A0={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},zx={...A0,transform:e=>nh(0,1,e)},D_={...A0,default:1},Fb=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Jh=Fb("deg"),Oc=Fb("%"),ci=Fb("px"),bhe=Fb("vh"),whe=Fb("vw"),CV={...Oc,parse:e=>Oc.parse(e)/100,transform:e=>Oc.transform(e*100)},_he={borderWidth:ci,borderTopWidth:ci,borderRightWidth:ci,borderBottomWidth:ci,borderLeftWidth:ci,borderRadius:ci,radius:ci,borderTopLeftRadius:ci,borderTopRightRadius:ci,borderBottomRightRadius:ci,borderBottomLeftRadius:ci,width:ci,maxWidth:ci,height:ci,maxHeight:ci,top:ci,right:ci,bottom:ci,left:ci,padding:ci,paddingTop:ci,paddingRight:ci,paddingBottom:ci,paddingLeft:ci,margin:ci,marginTop:ci,marginRight:ci,marginBottom:ci,marginLeft:ci,backgroundPositionX:ci,backgroundPositionY:ci},She={rotate:Jh,rotateX:Jh,rotateY:Jh,rotateZ:Jh,scale:D_,scaleX:D_,scaleY:D_,scaleZ:D_,skew:Jh,skewX:Jh,skewY:Jh,distance:ci,translateX:ci,translateY:ci,translateZ:ci,x:ci,y:ci,z:ci,perspective:ci,transformPerspective:ci,opacity:zx,originX:CV,originY:CV,originZ:ci},TV={...A0,transform:Math.round},TB={..._he,...She,zIndex:TV,size:ci,fillOpacity:zx,strokeOpacity:zx,numOctaves:TV},Mhe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Ehe=E0.length;function Ahe(e,t,i){let r="",n=!0;for(let s=0;s<Ehe;s++){const a=E0[s],o=e[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||i){const c=$Q(o,TB[a]);if(!l){n=!1;const u=Mhe[a]||a;r+=`${u}(${c}) `}i&&(t[a]=c)}}return r=r.trim(),i?r=i(t,n?"":r):n&&(r="none"),r}function PB(e,t,i){const{style:r,vars:n,transformOrigin:s}=e;let a=!1,o=!1;for(const l in t){const c=t[l];if(dm.has(l)){a=!0;continue}else if(JQ(l)){n[l]=c;continue}else{const u=$Q(c,TB[l]);l.startsWith("origin")?(o=!0,s[l]=u):r[l]=u}}if(t.transform||(a||i?r.transform=Ahe(t,e.transform,i):r.transform&&(r.transform="none")),o){const{originX:l="50%",originY:c="50%",originZ:u=0}=s;r.transformOrigin=`${l} ${c} ${u}`}}const Che={offset:"stroke-dashoffset",array:"stroke-dasharray"},The={offset:"strokeDashoffset",array:"strokeDasharray"};function Phe(e,t,i=1,r=0,n=!0){e.pathLength=1;const s=n?Che:The;e[s.offset]=ci.transform(-r);const a=ci.transform(t),o=ci.transform(i);e[s.array]=`${a} ${o}`}function PV(e,t,i){return typeof e=="string"?e:ci.transform(t+i*e)}function Dhe(e,t,i){const r=PV(t,e.x,e.width),n=PV(i,e.y,e.height);return`${r} ${n}`}function DB(e,{attrX:t,attrY:i,attrScale:r,originX:n,originY:s,pathLength:a,pathSpacing:o=1,pathOffset:l=0,...c},u,h){if(PB(e,c,h),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:d,style:p,dimensions:f}=e;d.transform&&(f&&(p.transform=d.transform),delete d.transform),f&&(n!==void 0||s!==void 0||p.transform)&&(p.transformOrigin=Dhe(f,n!==void 0?n:.5,s!==void 0?s:.5)),t!==void 0&&(d.x=t),i!==void 0&&(d.y=i),r!==void 0&&(d.scale=r),a!==void 0&&Phe(d,a,o,l,!1)}const LB=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),eK=()=>({...LB(),attrs:{}}),RB=e=>typeof e=="string"&&e.toLowerCase()==="svg";function tK(e,{style:t,vars:i},r,n){Object.assign(e.style,t,n&&n.getProjectionStyles(r));for(const s in i)e.style.setProperty(s,i[s])}const iK=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function rK(e,t,i,r){tK(e,t,void 0,r);for(const n in t.attrs)e.setAttribute(iK.has(n)?n:SB(n),t.attrs[n])}const fA={};function Lhe(e){Object.assign(fA,e)}function nK(e,{layout:t,layoutId:i}){return dm.has(e)||e.startsWith("origin")||(t||i!==void 0)&&(!!fA[e]||e==="opacity")}function IB(e,t,i){var r;const{style:n}=e,s={};for(const a in n)(Xs(n[a])||t.style&&Xs(t.style[a])||nK(a,e)||((r=i==null?void 0:i.getValue(a))===null||r===void 0?void 0:r.liveStyle)!==void 0)&&(s[a]=n[a]);return s}function sK(e,t,i){const r=IB(e,t,i);for(const n in e)if(Xs(e[n])||Xs(t[n])){const s=E0.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=e[n]}return r}function Rhe(e,t){try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const DV=["x","y","width","height","cx","cy","r"],Ihe={useVisualState:QQ({scrapeMotionValuesFromProps:sK,createRenderState:eK,onUpdate:({props:e,prevProps:t,current:i,renderState:r,latestValues:n})=>{if(!i)return;let s=!!e.drag;if(!s){for(const o in n)if(dm.has(o)){s=!0;break}}if(!s)return;let a=!t;if(t)for(let o=0;o<DV.length;o++){const l=DV[o];e[l]!==t[l]&&(a=!0)}a&&Pr.read(()=>{Rhe(i,r),Pr.render(()=>{DB(r,n,RB(i.tagName),e.transformTemplate),rK(i,r)})})}})},Ohe={useVisualState:QQ({scrapeMotionValuesFromProps:IB,createRenderState:LB})};function aK(e,t,i){for(const r in t)!Xs(t[r])&&!nK(r,i)&&(e[r]=t[r])}function Nhe({transformTemplate:e},t){return R.useMemo(()=>{const i=LB();return PB(i,t,e),Object.assign({},i.vars,i.style)},[t])}function zhe(e,t){const i=e.style||{},r={};return aK(r,i,e),Object.assign(r,Nhe(e,t)),r}function Bhe(e,t){const i={},r=zhe(e,t);return e.drag&&e.dragListener!==!1&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(i.tabIndex=0),i.style=r,i}function khe(e,t,i,r){const n=R.useMemo(()=>{const s=eK();return DB(s,t,RB(r),e.transformTemplate),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};aK(s,e.style,e),n.style={...s,...n.style}}return n}function Uhe(e=!1){return(i,r,n,{latestValues:s},a)=>{const l=(EB(i)?khe:Bhe)(r,s,a,i),c=ehe(r,typeof i=="string",e),u=i!==R.Fragment?{...c,...l,ref:n}:{},{children:h}=r,d=R.useMemo(()=>Xs(h)?h.get():h,[h]);return R.createElement(i,{...u,children:d})}}function Fhe(e,t){return function(r,{forwardMotionProps:n}={forwardMotionProps:!1}){const a={...EB(r)?Ihe:Ohe,preloadedFeatures:e,useRender:Uhe(n),createVisualElement:t,Component:r};return che(a)}}function oK(e,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==e.length)return!1;for(let r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}function uT(e,t,i){const r=e.getProps();return AB(r,t,i!==void 0?i:r.custom,e)}const Vhe=bB(()=>window.ScrollTimeline!==void 0);class jhe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,i){for(let r=0;r<this.animations.length;r++)this.animations[r][t]=i}attachTimeline(t,i){const r=this.animations.map(n=>{if(Vhe()&&n.attachTimeline)return n.attachTimeline(t);if(typeof i=="function")return i(n)});return()=>{r.forEach((n,s)=>{n&&n(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let i=0;i<this.animations.length;i++)t=Math.max(t,this.animations[i].duration);return t}runAll(t){this.animations.forEach(i=>i[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Hhe extends jhe{then(t,i){return Promise.all(this.animations).then(t).catch(i)}}function OB(e,t){return e?e[t]||e.default||e:void 0}const aI=2e4;function lK(e){let t=0;const i=50;let r=e.next(t);for(;!r.done&&t<aI;)t+=i,r=e.next(t);return t>=aI?1/0:t}function NB(e){return typeof e=="function"}function LV(e,t){e.timeline=t,e.onfinish=null}const zB=e=>Array.isArray(e)&&typeof e[0]=="number",Ghe={linearEasing:void 0};function Whe(e,t){const i=bB(e);return()=>{var r;return(r=Ghe[t])!==null&&r!==void 0?r:i()}}const mA=Whe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cK=(e,t,i=10)=>{let r="";const n=Math.max(Math.round(t/i),2);for(let s=0;s<n;s++)r+=e(Jv(0,n-1,s))+", ";return`linear(${r.substring(0,r.length-2)})`};function uK(e){return!!(typeof e=="function"&&mA()||!e||typeof e=="string"&&(e in oI||mA())||zB(e)||Array.isArray(e)&&e.every(uK))}const b1=([e,t,i,r])=>`cubic-bezier(${e}, ${t}, ${i}, ${r})`,oI={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:b1([0,.65,.55,1]),circOut:b1([.55,0,1,.45]),backIn:b1([.31,.01,.66,-.59]),backOut:b1([.33,1.53,.69,.99])};function hK(e,t){if(e)return typeof e=="function"&&mA()?cK(e,t):zB(e)?b1(e):Array.isArray(e)?e.map(i=>hK(i,t)||oI.easeOut):oI[e]}const El={x:!1,y:!1};function dK(){return El.x||El.y}function Xhe(e,t,i){var r;if(e instanceof Element)return[e];if(typeof e=="string"){let n=document;const s=(r=void 0)!==null&&r!==void 0?r:n.querySelectorAll(e);return s?Array.from(s):[]}return Array.from(e)}function pK(e,t){const i=Xhe(e),r=new AbortController,n={passive:!0,...t,signal:r.signal};return[i,n,()=>r.abort()]}function RV(e){return t=>{t.pointerType==="touch"||dK()||e(t)}}function qhe(e,t,i={}){const[r,n,s]=pK(e,i),a=RV(o=>{const{target:l}=o,c=t(o);if(typeof c!="function"||!l)return;const u=RV(h=>{c(h),l.removeEventListener("pointerleave",u)});l.addEventListener("pointerleave",u,n)});return r.forEach(o=>{o.addEventListener("pointerenter",a,n)}),s}const fK=(e,t)=>t?e===t?!0:fK(e,t.parentElement):!1,BB=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Yhe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Zhe(e){return Yhe.has(e.tagName)||e.tabIndex!==-1}const w1=new WeakSet;function IV(e){return t=>{t.key==="Enter"&&e(t)}}function WP(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Qhe=(e,t)=>{const i=e.currentTarget;if(!i)return;const r=IV(()=>{if(w1.has(i))return;WP(i,"down");const n=IV(()=>{WP(i,"up")}),s=()=>WP(i,"cancel");i.addEventListener("keyup",n,t),i.addEventListener("blur",s,t)});i.addEventListener("keydown",r,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",r),t)};function OV(e){return BB(e)&&!dK()}function Khe(e,t,i={}){const[r,n,s]=pK(e,i),a=o=>{const l=o.currentTarget;if(!OV(o)||w1.has(l))return;w1.add(l);const c=t(o),u=(p,f)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",d),!(!OV(p)||!w1.has(l))&&(w1.delete(l),typeof c=="function"&&c(p,{success:f}))},h=p=>{u(p,i.useGlobalTarget||fK(l,p.target))},d=p=>{u(p,!1)};window.addEventListener("pointerup",h,n),window.addEventListener("pointercancel",d,n)};return r.forEach(o=>{!Zhe(o)&&o.getAttribute("tabindex")===null&&(o.tabIndex=0),(i.useGlobalTarget?window:o).addEventListener("pointerdown",a,n),o.addEventListener("focus",c=>Qhe(c,n),n)}),s}function Jhe(e){return e==="x"||e==="y"?El[e]?null:(El[e]=!0,()=>{El[e]=!1}):El.x||El.y?null:(El.x=El.y=!0,()=>{El.x=El.y=!1})}const mK=new Set(["width","height","top","left","right","bottom",...E0]);let dE;function $he(){dE=void 0}const Nc={now:()=>(dE===void 0&&Nc.set(vs.isProcessing||Yue.useManualTiming?vs.timestamp:performance.now()),dE),set:e=>{dE=e,queueMicrotask($he)}};function kB(e,t){e.indexOf(t)===-1&&e.push(t)}function UB(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}class FB{constructor(){this.subscriptions=[]}add(t){return kB(this.subscriptions,t),()=>UB(this.subscriptions,t)}notify(t,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(t,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function gK(e,t){return t?e*(1e3/t):0}const NV=30,ede=e=>!isNaN(parseFloat(e));class tde{constructor(t,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(r,n=!0)=>{const s=Nc.now();this.updatedAt!==s&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=Nc.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=ede(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new FB);const r=this.events[t].add(i);return t==="change"?()=>{r(),Pr.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,r){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Nc.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>NV)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,NV);return gK(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Bx(e,t){return new tde(e,t)}function ide(e,t,i){e.hasValue(t)?e.getValue(t).set(i):e.addValue(t,Bx(i))}function rde(e,t){const i=uT(e,t);let{transitionEnd:r={},transition:n={},...s}=i||{};s={...s,...r};for(const a in s){const o=mhe(s[a]);ide(e,a,o)}}function nde(e){return!!(Xs(e)&&e.add)}function lI(e,t){const i=e.getValue("willChange");if(nde(i))return i.add(t)}function vK(e){return e.props[qQ]}const yK=(e,t,i)=>(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e,sde=1e-7,ade=12;function ode(e,t,i,r,n){let s,a,o=0;do a=t+(i-t)/2,s=yK(a,r,n)-e,s>0?i=a:t=a;while(Math.abs(s)>sde&&++o<ade);return a}function Vb(e,t,i,r){if(e===t&&i===r)return po;const n=s=>ode(s,0,1,e,i);return s=>s===0||s===1?s:yK(n(s),t,r)}const xK=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,bK=e=>t=>1-e(1-t),wK=Vb(.33,1.53,.69,.99),VB=bK(wK),_K=xK(VB),SK=e=>(e*=2)<1?.5*VB(e):.5*(2-Math.pow(2,-10*(e-1))),jB=e=>1-Math.sin(Math.acos(e)),MK=bK(jB),EK=xK(jB),AK=e=>/^0[^.\s]+$/u.test(e);function lde(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||AK(e):!0}const G1=e=>Math.round(e*1e5)/1e5,HB=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function cde(e){return e==null}const ude=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,GB=(e,t)=>i=>!!(typeof i=="string"&&ude.test(i)&&i.startsWith(e)||t&&!cde(i)&&Object.prototype.hasOwnProperty.call(i,t)),CK=(e,t,i)=>r=>{if(typeof r!="string")return r;const[n,s,a,o]=r.match(HB);return{[e]:parseFloat(n),[t]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},hde=e=>nh(0,255,e),XP={...A0,transform:e=>Math.round(hde(e))},gf={test:GB("rgb","red"),parse:CK("red","green","blue"),transform:({red:e,green:t,blue:i,alpha:r=1})=>"rgba("+XP.transform(e)+", "+XP.transform(t)+", "+XP.transform(i)+", "+G1(zx.transform(r))+")"};function dde(e){let t="",i="",r="",n="";return e.length>5?(t=e.substring(1,3),i=e.substring(3,5),r=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),i=e.substring(2,3),r=e.substring(3,4),n=e.substring(4,5),t+=t,i+=i,r+=r,n+=n),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const cI={test:GB("#"),parse:dde,transform:gf.transform},ov={test:GB("hsl","hue"),parse:CK("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:i,alpha:r=1})=>"hsla("+Math.round(e)+", "+Oc.transform(G1(t))+", "+Oc.transform(G1(i))+", "+G1(zx.transform(r))+")"},Vs={test:e=>gf.test(e)||cI.test(e)||ov.test(e),parse:e=>gf.test(e)?gf.parse(e):ov.test(e)?ov.parse(e):cI.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?gf.transform(e):ov.transform(e)},pde=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function fde(e){var t,i;return isNaN(e)&&typeof e=="string"&&(((t=e.match(HB))===null||t===void 0?void 0:t.length)||0)+(((i=e.match(pde))===null||i===void 0?void 0:i.length)||0)>0}const TK="number",PK="color",mde="var",gde="var(",zV="${}",vde=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function kx(e){const t=e.toString(),i=[],r={color:[],number:[],var:[]},n=[];let s=0;const o=t.replace(vde,l=>(Vs.test(l)?(r.color.push(s),n.push(PK),i.push(Vs.parse(l))):l.startsWith(gde)?(r.var.push(s),n.push(mde),i.push(l)):(r.number.push(s),n.push(TK),i.push(parseFloat(l))),++s,zV)).split(zV);return{values:i,split:o,indexes:r,types:n}}function DK(e){return kx(e).values}function LK(e){const{split:t,types:i}=kx(e),r=t.length;return n=>{let s="";for(let a=0;a<r;a++)if(s+=t[a],n[a]!==void 0){const o=i[a];o===TK?s+=G1(n[a]):o===PK?s+=Vs.transform(n[a]):s+=n[a]}return s}}const yde=e=>typeof e=="number"?0:e;function xde(e){const t=DK(e);return LK(e)(t.map(yde))}const Yd={test:fde,parse:DK,createTransformer:LK,getAnimatableNone:xde},bde=new Set(["brightness","contrast","saturate","opacity"]);function wde(e){const[t,i]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=i.match(HB)||[];if(!r)return e;const n=i.replace(r,"");let s=bde.has(t)?1:0;return r!==i&&(s*=100),t+"("+s+n+")"}const _de=/\b([a-z-]*)\(.*?\)/gu,uI={...Yd,getAnimatableNone:e=>{const t=e.match(_de);return t?t.map(wde).join(" "):e}},Sde={...TB,color:Vs,backgroundColor:Vs,outlineColor:Vs,fill:Vs,stroke:Vs,borderColor:Vs,borderTopColor:Vs,borderRightColor:Vs,borderBottomColor:Vs,borderLeftColor:Vs,filter:uI,WebkitFilter:uI},WB=e=>Sde[e];function RK(e,t){let i=WB(e);return i!==uI&&(i=Yd),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const Mde=new Set(["auto","none","0"]);function Ede(e,t,i){let r=0,n;for(;r<e.length&&!n;){const s=e[r];typeof s=="string"&&!Mde.has(s)&&kx(s).values.length&&(n=e[r]),r++}if(n&&i)for(const s of t)e[s]=RK(i,n)}const BV=e=>e===A0||e===ci,kV=(e,t)=>parseFloat(e.split(", ")[t]),UV=(e,t)=>(i,{transform:r})=>{if(r==="none"||!r)return 0;const n=r.match(/^matrix3d\((.+)\)$/u);if(n)return kV(n[1],t);{const s=r.match(/^matrix\((.+)\)$/u);return s?kV(s[1],e):0}},Ade=new Set(["x","y","z"]),Cde=E0.filter(e=>!Ade.has(e));function Tde(e){const t=[];return Cde.forEach(i=>{const r=e.getValue(i);r!==void 0&&(t.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),t}const e0={width:({x:e},{paddingLeft:t="0",paddingRight:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),height:({y:e},{paddingTop:t="0",paddingBottom:i="0"})=>e.max-e.min-parseFloat(t)-parseFloat(i),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:UV(4,13),y:UV(5,14)};e0.translateX=e0.x;e0.translateY=e0.y;const Rf=new Set;let hI=!1,dI=!1;function IK(){if(dI){const e=Array.from(Rf).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),i=new Map;t.forEach(r=>{const n=Tde(r);n.length&&(i.set(r,n),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const n=i.get(r);n&&n.forEach(([s,a])=>{var o;(o=r.getValue(s))===null||o===void 0||o.set(a)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}dI=!1,hI=!1,Rf.forEach(e=>e.complete()),Rf.clear()}function OK(){Rf.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(dI=!0)})}function Pde(){OK(),IK()}class XB{constructor(t,i,r,n,s,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=r,this.motionValue=n,this.element=s,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Rf.add(this),hI||(hI=!0,Pr.read(OK),Pr.resolveKeyframes(IK))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:r,motionValue:n}=this;for(let s=0;s<t.length;s++)if(t[s]===null)if(s===0){const a=n==null?void 0:n.get(),o=t[t.length-1];if(a!==void 0)t[0]=a;else if(r&&i){const l=r.readValue(i,o);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=o),n&&a===void 0&&n.set(t[0])}else t[s]=t[s-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Rf.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Rf.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const NK=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),Dde=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Lde(e){const t=Dde.exec(e);if(!t)return[,];const[,i,r,n]=t;return[`--${i??r}`,n]}function zK(e,t,i=1){const[r,n]=Lde(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const a=s.trim();return NK(a)?parseFloat(a):a}return CB(n)?zK(n,t,i+1):n}const BK=e=>t=>t.test(e),Rde={test:e=>e==="auto",parse:e=>e},kK=[A0,ci,Oc,Jh,whe,bhe,Rde],FV=e=>kK.find(BK(e));class UK extends XB{constructor(t,i,r,n,s){super(t,i,r,n,s,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:r}=this;if(!i||!i.current)return;super.readKeyframes();for(let l=0;l<t.length;l++){let c=t[l];if(typeof c=="string"&&(c=c.trim(),CB(c))){const u=zK(c,i.current);u!==void 0&&(t[l]=u),l===t.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!mK.has(r)||t.length!==2)return;const[n,s]=t,a=FV(n),o=FV(s);if(a!==o)if(BV(a)&&BV(o))for(let l=0;l<t.length;l++){const c=t[l];typeof c=="string"&&(t[l]=parseFloat(c))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,r=[];for(let n=0;n<t.length;n++)lde(t[n])&&r.push(n);r.length&&Ede(t,r,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=e0[r](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const n=i[i.length-1];n!==void 0&&t.getValue(r,n).jump(n,!1)}measureEndState(){var t;const{element:i,name:r,unresolvedKeyframes:n}=this;if(!i||!i.current)return;const s=i.getValue(r);s&&s.jump(this.measuredOrigin,!1);const a=n.length-1,o=n[a];n[a]=e0[r](i.measureViewportBox(),window.getComputedStyle(i.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([l,c])=>{i.getValue(l).set(c)}),this.resolveNoneKeyframes()}}const VV=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Yd.test(e)||e==="0")&&!e.startsWith("url("));function Ide(e){const t=e[0];if(e.length===1)return!0;for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}function Ode(e,t,i,r){const n=e[0];if(n===null)return!1;if(t==="display"||t==="visibility")return!0;const s=e[e.length-1],a=VV(n,t),o=VV(s,t);return!a||!o?!1:Ide(e)||(i==="spring"||NB(i))&&r}const Nde=e=>e!==null;function hT(e,{repeat:t,repeatType:i="loop"},r){const n=e.filter(Nde),s=t&&i!=="loop"&&t%2===1?0:n.length-1;return!s||r===void 0?n[s]:r}const zde=40;class FK{constructor({autoplay:t=!0,delay:i=0,type:r="keyframes",repeat:n=0,repeatDelay:s=0,repeatType:a="loop",...o}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Nc.now(),this.options={autoplay:t,delay:i,type:r,repeat:n,repeatDelay:s,repeatType:a,...o},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>zde?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Pde(),this._resolved}onKeyframesResolved(t,i){this.resolvedAt=Nc.now(),this.hasAttemptedResolve=!0;const{name:r,type:n,velocity:s,delay:a,onComplete:o,onUpdate:l,isGenerator:c}=this.options;if(!c&&!Ode(t,r,n,s))if(a)this.options.duration=0;else{l&&l(hT(t,this.options,i)),o&&o(),this.resolveFinishedPromise();return}const u=this.initPlayback(t,i);u!==!1&&(this._resolved={keyframes:t,finalKeyframe:i,...u},this.onPostResolved())}onPostResolved(){}then(t,i){return this.currentFinishedPromise.then(t,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const zr=(e,t,i)=>e+(t-e)*i;function qP(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function Bde({hue:e,saturation:t,lightness:i,alpha:r}){e/=360,t/=100,i/=100;let n=0,s=0,a=0;if(!t)n=s=a=i;else{const o=i<.5?i*(1+t):i+t-i*t,l=2*i-o;n=qP(l,o,e+1/3),s=qP(l,o,e),a=qP(l,o,e-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}function gA(e,t){return i=>i>0?t:e}const YP=(e,t,i)=>{const r=e*e,n=i*(t*t-r)+r;return n<0?0:Math.sqrt(n)},kde=[cI,gf,ov],Ude=e=>kde.find(t=>t.test(e));function jV(e){const t=Ude(e);if(!t)return!1;let i=t.parse(e);return t===ov&&(i=Bde(i)),i}const HV=(e,t)=>{const i=jV(e),r=jV(t);if(!i||!r)return gA(e,t);const n={...i};return s=>(n.red=YP(i.red,r.red,s),n.green=YP(i.green,r.green,s),n.blue=YP(i.blue,r.blue,s),n.alpha=zr(i.alpha,r.alpha,s),gf.transform(n))},Fde=(e,t)=>i=>t(e(i)),jb=(...e)=>e.reduce(Fde),pI=new Set(["none","hidden"]);function Vde(e,t){return pI.has(e)?i=>i<=0?e:t:i=>i>=1?t:e}function jde(e,t){return i=>zr(e,t,i)}function qB(e){return typeof e=="number"?jde:typeof e=="string"?CB(e)?gA:Vs.test(e)?HV:Wde:Array.isArray(e)?VK:typeof e=="object"?Vs.test(e)?HV:Hde:gA}function VK(e,t){const i=[...e],r=i.length,n=e.map((s,a)=>qB(s)(s,t[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}}function Hde(e,t){const i={...e,...t},r={};for(const n in i)e[n]!==void 0&&t[n]!==void 0&&(r[n]=qB(e[n])(e[n],t[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}}function Gde(e,t){var i;const r=[],n={color:0,var:0,number:0};for(let s=0;s<t.values.length;s++){const a=t.types[s],o=e.indexes[a][n[a]],l=(i=e.values[o])!==null&&i!==void 0?i:0;r[s]=l,n[a]++}return r}const Wde=(e,t)=>{const i=Yd.createTransformer(t),r=kx(e),n=kx(t);return r.indexes.var.length===n.indexes.var.length&&r.indexes.color.length===n.indexes.color.length&&r.indexes.number.length>=n.indexes.number.length?pI.has(e)&&!n.values.length||pI.has(t)&&!r.values.length?Vde(e,t):jb(VK(Gde(r,n),n.values),i):gA(e,t)};function jK(e,t,i){return typeof e=="number"&&typeof t=="number"&&typeof i=="number"?zr(e,t,i):qB(e)(e,t)}const Xde=5;function HK(e,t,i){const r=Math.max(t-Xde,0);return gK(i-e(r),t-r)}const Yr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},ZP=.001;function qde({duration:e=Yr.duration,bounce:t=Yr.bounce,velocity:i=Yr.velocity,mass:r=Yr.mass}){let n,s,a=1-t;a=nh(Yr.minDamping,Yr.maxDamping,a),e=nh(Yr.minDuration,Yr.maxDuration,Qu(e)),a<1?(n=c=>{const u=c*a,h=u*e,d=u-i,p=fI(c,a),f=Math.exp(-h);return ZP-d/p*f},s=c=>{const h=c*a*e,d=h*i+i,p=Math.pow(a,2)*Math.pow(c,2)*e,f=Math.exp(-h),v=fI(Math.pow(c,2),a);return(-n(c)+ZP>0?-1:1)*((d-p)*f)/v}):(n=c=>{const u=Math.exp(-c*e),h=(c-i)*e+1;return-ZP+u*h},s=c=>{const u=Math.exp(-c*e),h=(i-c)*(e*e);return u*h});const o=5/e,l=Zde(n,s,o);if(e=Zu(e),isNaN(l))return{stiffness:Yr.stiffness,damping:Yr.damping,duration:e};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:a*2*Math.sqrt(r*c),duration:e}}}const Yde=12;function Zde(e,t,i){let r=i;for(let n=1;n<Yde;n++)r=r-e(r)/t(r);return r}function fI(e,t){return e*Math.sqrt(1-t*t)}const Qde=["duration","bounce"],Kde=["stiffness","damping","mass"];function GV(e,t){return t.some(i=>e[i]!==void 0)}function Jde(e){let t={velocity:Yr.velocity,stiffness:Yr.stiffness,damping:Yr.damping,mass:Yr.mass,isResolvedFromDuration:!1,...e};if(!GV(e,Kde)&&GV(e,Qde))if(e.visualDuration){const i=e.visualDuration,r=2*Math.PI/(i*1.2),n=r*r,s=2*nh(.05,1,1-(e.bounce||0))*Math.sqrt(n);t={...t,mass:Yr.mass,stiffness:n,damping:s}}else{const i=qde(e);t={...t,...i,mass:Yr.mass},t.isResolvedFromDuration=!0}return t}function GK(e=Yr.visualDuration,t=Yr.bounce){const i=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:n}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:p}=Jde({...i,velocity:-Qu(i.velocity||0)}),f=d||0,v=c/(2*Math.sqrt(l*u)),m=a-s,g=Qu(Math.sqrt(l/u)),y=Math.abs(m)<5;r||(r=y?Yr.restSpeed.granular:Yr.restSpeed.default),n||(n=y?Yr.restDelta.granular:Yr.restDelta.default);let x;if(v<1){const M=fI(g,v);x=S=>{const E=Math.exp(-v*g*S);return a-E*((f+v*g*m)/M*Math.sin(M*S)+m*Math.cos(M*S))}}else if(v===1)x=M=>a-Math.exp(-g*M)*(m+(f+g*m)*M);else{const M=g*Math.sqrt(v*v-1);x=S=>{const E=Math.exp(-v*g*S),A=Math.min(M*S,300);return a-E*((f+v*g*m)*Math.sinh(A)+M*m*Math.cosh(A))/M}}const _={calculatedDuration:p&&h||null,next:M=>{const S=x(M);if(p)o.done=M>=h;else{let E=0;v<1&&(E=M===0?Zu(f):HK(x,M,S));const A=Math.abs(E)<=r,P=Math.abs(a-S)<=n;o.done=A&&P}return o.value=o.done?a:S,o},toString:()=>{const M=Math.min(lK(_),aI),S=cK(E=>_.next(M*E).value,M,30);return M+"ms "+S}};return _}function WV({keyframes:e,velocity:t=0,power:i=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:u}){const h=e[0],d={done:!1,value:h},p=A=>o!==void 0&&A<o||l!==void 0&&A>l,f=A=>o===void 0?l:l===void 0||Math.abs(o-A)<Math.abs(l-A)?o:l;let v=i*t;const m=h+v,g=a===void 0?m:a(m);g!==m&&(v=g-h);const y=A=>-v*Math.exp(-A/r),x=A=>g+y(A),_=A=>{const P=y(A),C=x(A);d.done=Math.abs(P)<=c,d.value=d.done?g:C};let M,S;const E=A=>{p(d.value)&&(M=A,S=GK({keyframes:[d.value,f(d.value)],velocity:HK(x,A,d.value),damping:n,stiffness:s,restDelta:c,restSpeed:u}))};return E(0),{calculatedDuration:null,next:A=>{let P=!1;return!S&&M===void 0&&(P=!0,_(A),E(A)),M!==void 0&&A>=M?S.next(A-M):(!P&&_(A),d)}}}const $de=Vb(.42,0,1,1),epe=Vb(0,0,.58,1),WK=Vb(.42,0,.58,1),tpe=e=>Array.isArray(e)&&typeof e[0]!="number",XV={linear:po,easeIn:$de,easeInOut:WK,easeOut:epe,circIn:jB,circInOut:EK,circOut:MK,backIn:VB,backInOut:_K,backOut:wK,anticipate:SK},qV=e=>{if(zB(e)){nI(e.length===4);const[t,i,r,n]=e;return Vb(t,i,r,n)}else if(typeof e=="string")return nI(XV[e]!==void 0),XV[e];return e};function ipe(e,t,i){const r=[],n=i||jK,s=e.length-1;for(let a=0;a<s;a++){let o=n(e[a],e[a+1]);if(t){const l=Array.isArray(t)?t[a]||po:t;o=jb(l,o)}r.push(o)}return r}function rpe(e,t,{clamp:i=!0,ease:r,mixer:n}={}){const s=e.length;if(nI(s===t.length),s===1)return()=>t[0];if(s===2&&t[0]===t[1])return()=>t[1];const a=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=ipe(t,r,n),l=o.length,c=u=>{if(a&&u<e[0])return t[0];let h=0;if(l>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const d=Jv(e[h],e[h+1],u);return o[h](d)};return i?u=>c(nh(e[0],e[s-1],u)):c}function npe(e,t){const i=e[e.length-1];for(let r=1;r<=t;r++){const n=Jv(0,t,r);e.push(zr(i,1,n))}}function spe(e){const t=[0];return npe(t,e.length-1),t}function ape(e,t){return e.map(i=>i*t)}function ope(e,t){return e.map(()=>t||WK).splice(0,e.length-1)}function vA({duration:e=300,keyframes:t,times:i,ease:r="easeInOut"}){const n=tpe(r)?r.map(qV):qV(r),s={done:!1,value:t[0]},a=ape(i&&i.length===t.length?i:spe(t),e),o=rpe(a,t,{ease:Array.isArray(n)?n:ope(t,n)});return{calculatedDuration:e,next:l=>(s.value=o(l),s.done=l>=e,s)}}const lpe=e=>{const t=({timestamp:i})=>e(i);return{start:()=>Pr.update(t,!0),stop:()=>qd(t),now:()=>vs.isProcessing?vs.timestamp:Nc.now()}},cpe={decay:WV,inertia:WV,tween:vA,keyframes:vA,spring:GK},upe=e=>e/100;class YB extends FK{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:i,motionValue:r,element:n,keyframes:s}=this.options,a=(n==null?void 0:n.KeyframeResolver)||XB,o=(l,c)=>this.onKeyframesResolved(l,c);this.resolver=new a(s,o,i,r,n),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:i="keyframes",repeat:r=0,repeatDelay:n=0,repeatType:s,velocity:a=0}=this.options,o=NB(i)?i:cpe[i]||vA;let l,c;o!==vA&&typeof t[0]!="number"&&(l=jb(upe,jK(t[0],t[1])),t=[0,100]);const u=o({...this.options,keyframes:t});s==="mirror"&&(c=o({...this.options,keyframes:[...t].reverse(),velocity:-a})),u.calculatedDuration===null&&(u.calculatedDuration=lK(u));const{calculatedDuration:h}=u,d=h+n,p=d*(r+1)-n;return{generator:u,mirroredGenerator:c,mapPercentToKeyframes:l,calculatedDuration:h,resolvedDuration:d,totalDuration:p}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,i=!1){const{resolved:r}=this;if(!r){const{keyframes:A}=this.options;return{done:!0,value:A[A.length-1]}}const{finalKeyframe:n,generator:s,mirroredGenerator:a,mapPercentToKeyframes:o,keyframes:l,calculatedDuration:c,totalDuration:u,resolvedDuration:h}=r;if(this.startTime===null)return s.next(0);const{delay:d,repeat:p,repeatType:f,repeatDelay:v,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-u/this.speed,this.startTime)),i?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const g=this.currentTime-d*(this.speed>=0?1:-1),y=this.speed>=0?g<0:g>u;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=u);let x=this.currentTime,_=s;if(p){const A=Math.min(this.currentTime,u)/h;let P=Math.floor(A),C=A%1;!C&&A>=1&&(C=1),C===1&&P--,P=Math.min(P,p+1),!!(P%2)&&(f==="reverse"?(C=1-C,v&&(C-=v/h)):f==="mirror"&&(_=a)),x=nh(0,1,C)*h}const M=y?{done:!1,value:l[0]}:_.next(x);o&&(M.value=o(M.value));let{done:S}=M;!y&&c!==null&&(S=this.speed>=0?this.currentTime>=u:this.currentTime<=0);const E=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return E&&n!==void 0&&(M.value=hT(l,this.options,n)),m&&m(M.value),E&&this.finish(),M}get duration(){const{resolved:t}=this;return t?Qu(t.calculatedDuration):0}get time(){return Qu(this.currentTime)}set time(t){t=Zu(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=Qu(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=lpe,onPlay:i,startTime:r}=this.options;this.driver||(this.driver=t(s=>this.tick(s))),i&&i();const n=this.driver.now();this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=n):this.startTime=r??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const hpe=new Set(["opacity","clipPath","filter","transform"]);function dpe(e,t,i,{delay:r=0,duration:n=300,repeat:s=0,repeatType:a="loop",ease:o="easeInOut",times:l}={}){const c={[t]:i};l&&(c.offset=l);const u=hK(o,n);return Array.isArray(u)&&(c.easing=u),e.animate(c,{delay:r,duration:n,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"})}const ppe=bB(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),yA=10,fpe=2e4;function mpe(e){return NB(e.type)||e.type==="spring"||!uK(e.ease)}function gpe(e,t){const i=new YB({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let r={done:!1,value:e[0]};const n=[];let s=0;for(;!r.done&&s<fpe;)r=i.sample(s),n.push(r.value),s+=yA;return{times:void 0,keyframes:n,duration:s-yA,ease:"linear"}}const XK={anticipate:SK,backInOut:_K,circInOut:EK};function vpe(e){return e in XK}class YV extends FK{constructor(t){super(t);const{name:i,motionValue:r,element:n,keyframes:s}=this.options;this.resolver=new UK(s,(a,o)=>this.onKeyframesResolved(a,o),i,r,n),this.resolver.scheduleResolve()}initPlayback(t,i){let{duration:r=300,times:n,ease:s,type:a,motionValue:o,name:l,startTime:c}=this.options;if(!o.owner||!o.owner.current)return!1;if(typeof s=="string"&&mA()&&vpe(s)&&(s=XK[s]),mpe(this.options)){const{onComplete:h,onUpdate:d,motionValue:p,element:f,...v}=this.options,m=gpe(t,v);t=m.keyframes,t.length===1&&(t[1]=t[0]),r=m.duration,n=m.times,s=m.ease,a="keyframes"}const u=dpe(o.owner.current,l,t,{...this.options,duration:r,times:n,ease:s});return u.startTime=c??this.calcStartTime(),this.pendingTimeline?(LV(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:h}=this.options;o.set(hT(t,this.options,i)),h&&h(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:r,times:n,type:a,ease:s,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:i}=t;return Qu(i)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:i}=t;return Qu(i.currentTime||0)}set time(t){const{resolved:i}=this;if(!i)return;const{animation:r}=i;r.currentTime=Zu(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:i}=t;return i.playbackRate}set speed(t){const{resolved:i}=this;if(!i)return;const{animation:r}=i;r.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:i}=t;return i.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:i}=t;return i.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:i}=this;if(!i)return po;const{animation:r}=i;LV(r,t)}return po}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:i,keyframes:r,duration:n,type:s,ease:a,times:o}=t;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:c,onUpdate:u,onComplete:h,element:d,...p}=this.options,f=new YB({...p,keyframes:r,duration:n,type:s,ease:a,times:o,isGenerator:!0}),v=Zu(this.time);c.setWithVelocity(f.sample(v-yA).value,f.sample(v).value,yA)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:i,name:r,repeatDelay:n,repeatType:s,damping:a,type:o}=t;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=i.owner.getProps();return ppe()&&r&&hpe.has(r)&&!l&&!c&&!n&&s!=="mirror"&&a!==0&&o!=="inertia"}}const ype={type:"spring",stiffness:500,damping:25,restSpeed:10},xpe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),bpe={type:"keyframes",duration:.8},wpe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},_pe=(e,{keyframes:t})=>t.length>2?bpe:dm.has(e)?e.startsWith("scale")?xpe(t[1]):ype:wpe;function Spe({when:e,delay:t,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const ZB=(e,t,i,r={},n,s)=>a=>{const o=OB(r,e)||{},l=o.delay||r.delay||0;let{elapsed:c=0}=r;c=c-Zu(l);let u={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-c,onUpdate:d=>{t.set(d),o.onUpdate&&o.onUpdate(d)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:s?void 0:n};Spe(o)||(u={...u,..._pe(e,u)}),u.duration&&(u.duration=Zu(u.duration)),u.repeatDelay&&(u.repeatDelay=Zu(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(u.duration=0,u.delay===0&&(h=!0)),h&&!s&&t.get()!==void 0){const d=hT(u.keyframes,o);if(d!==void 0)return Pr.update(()=>{u.onUpdate(d),u.onComplete()}),new Hhe([])}return!s&&YV.supports(u)?new YV(u):new YB(u)};function Mpe({protectedKeys:e,needsAnimating:t},i){const r=e.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,r}function qK(e,t,{delay:i=0,transitionOverride:r,type:n}={}){var s;let{transition:a=e.getDefaultTransition(),transitionEnd:o,...l}=t;r&&(a=r);const c=[],u=n&&e.animationState&&e.animationState.getState()[n];for(const h in l){const d=e.getValue(h,(s=e.latestValues[h])!==null&&s!==void 0?s:null),p=l[h];if(p===void 0||u&&Mpe(u,h))continue;const f={delay:i,...OB(a||{},h)};let v=!1;if(window.MotionHandoffAnimation){const g=vK(e);if(g){const y=window.MotionHandoffAnimation(g,h,Pr);y!==null&&(f.startTime=y,v=!0)}}lI(e,h),d.start(ZB(h,d,p,e.shouldReduceMotion&&mK.has(h)?{type:!1}:f,e,v));const m=d.animation;m&&c.push(m)}return o&&Promise.all(c).then(()=>{Pr.update(()=>{o&&rde(e,o)})}),c}function mI(e,t,i={}){var r;const n=uT(e,t,i.type==="exit"?(r=e.presenceContext)===null||r===void 0?void 0:r.custom:void 0);let{transition:s=e.getDefaultTransition()||{}}=n||{};i.transitionOverride&&(s=i.transitionOverride);const a=n?()=>Promise.all(qK(e,n,i)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:d}=s;return Epe(e,t,u+c,h,d,i)}:()=>Promise.resolve(),{when:l}=s;if(l){const[c,u]=l==="beforeChildren"?[a,o]:[o,a];return c().then(()=>u())}else return Promise.all([a(),o(i.delay)])}function Epe(e,t,i=0,r=0,n=1,s){const a=[],o=(e.variantChildren.size-1)*r,l=n===1?(c=0)=>c*r:(c=0)=>o-c*r;return Array.from(e.variantChildren).sort(Ape).forEach((c,u)=>{c.notify("AnimationStart",t),a.push(mI(c,t,{...s,delay:i+l(u)}).then(()=>c.notify("AnimationComplete",t)))}),Promise.all(a)}function Ape(e,t){return e.sortNodePosition(t)}function Cpe(e,t,i={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const n=t.map(s=>mI(e,s,i));r=Promise.all(n)}else if(typeof t=="string")r=mI(e,t,i);else{const n=typeof t=="function"?uT(e,t,i.custom):t;r=Promise.all(qK(e,n,i))}return r.then(()=>{e.notify("AnimationComplete",t)})}const Tpe=_B.length;function YK(e){if(!e)return;if(!e.isControllingVariants){const i=e.parent?YK(e.parent)||{}:{};return e.props.initial!==void 0&&(i.initial=e.props.initial),i}const t={};for(let i=0;i<Tpe;i++){const r=_B[i],n=e.props[r];(Nx(n)||n===!1)&&(t[r]=n)}return t}const Ppe=[...wB].reverse(),Dpe=wB.length;function Lpe(e){return t=>Promise.all(t.map(({animation:i,options:r})=>Cpe(e,i,r)))}function Rpe(e){let t=Lpe(e),i=ZV(),r=!0;const n=l=>(c,u)=>{var h;const d=uT(e,u,l==="exit"?(h=e.presenceContext)===null||h===void 0?void 0:h.custom:void 0);if(d){const{transition:p,transitionEnd:f,...v}=d;c={...c,...v,...f}}return c};function s(l){t=l(e)}function a(l){const{props:c}=e,u=YK(e.parent)||{},h=[],d=new Set;let p={},f=1/0;for(let m=0;m<Dpe;m++){const g=Ppe[m],y=i[g],x=c[g]!==void 0?c[g]:u[g],_=Nx(x),M=g===l?y.isActive:null;M===!1&&(f=m);let S=x===u[g]&&x!==c[g]&&_;if(S&&r&&e.manuallyAnimateOnMount&&(S=!1),y.protectedKeys={...p},!y.isActive&&M===null||!x&&!y.prevProp||lT(x)||typeof x=="boolean")continue;const E=Ipe(y.prevProp,x);let A=E||g===l&&y.isActive&&!S&&_||m>f&&_,P=!1;const C=Array.isArray(x)?x:[x];let D=C.reduce(n(g),{});M===!1&&(D={});const{prevResolvedValues:N={}}=y,U={...N,...D},I=Y=>{A=!0,d.has(Y)&&(P=!0,d.delete(Y)),y.needsAnimating[Y]=!0;const O=e.getValue(Y);O&&(O.liveStyle=!1)};for(const Y in U){const O=D[Y],V=N[Y];if(p.hasOwnProperty(Y))continue;let F=!1;sI(O)&&sI(V)?F=!oK(O,V):F=O!==V,F?O!=null?I(Y):d.add(Y):O!==void 0&&d.has(Y)?I(Y):y.protectedKeys[Y]=!0}y.prevProp=x,y.prevResolvedValues=D,y.isActive&&(p={...p,...D}),r&&e.blockInitialAnimation&&(A=!1),A&&(!(S&&E)||P)&&h.push(...C.map(Y=>({animation:Y,options:{type:g}})))}if(d.size){const m={};d.forEach(g=>{const y=e.getBaseTarget(g),x=e.getValue(g);x&&(x.liveStyle=!0),m[g]=y??null}),h.push({animation:m})}let v=!!h.length;return r&&(c.initial===!1||c.initial===c.animate)&&!e.manuallyAnimateOnMount&&(v=!1),r=!1,v?t(h):Promise.resolve()}function o(l,c){var u;if(i[l].isActive===c)return Promise.resolve();(u=e.variantChildren)===null||u===void 0||u.forEach(d=>{var p;return(p=d.animationState)===null||p===void 0?void 0:p.setActive(l,c)}),i[l].isActive=c;const h=a(l);for(const d in i)i[d].protectedKeys={};return h}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i,reset:()=>{i=ZV(),r=!0}}}function Ipe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!oK(t,e):!1}function Sp(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ZV(){return{animate:Sp(!0),whileInView:Sp(),whileHover:Sp(),whileTap:Sp(),whileDrag:Sp(),whileFocus:Sp(),exit:Sp()}}class np{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Ope extends np{constructor(t){super(t),t.animationState||(t.animationState=Rpe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();lT(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Npe=0;class zpe extends np{constructor(){super(...arguments),this.id=Npe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const n=this.node.animationState.setActive("exit",!t);i&&!t&&n.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Bpe={animation:{Feature:Ope},exit:{Feature:zpe}};function Ux(e,t,i,r={passive:!0}){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i)}function Hb(e){return{point:{x:e.pageX,y:e.pageY}}}const kpe=e=>t=>BB(t)&&e(t,Hb(t));function W1(e,t,i,r){return Ux(e,t,kpe(i),r)}const QV=(e,t)=>Math.abs(e-t);function Upe(e,t){const i=QV(e.x,t.x),r=QV(e.y,t.y);return Math.sqrt(i**2+r**2)}class ZK{constructor(t,i,{transformPagePoint:r,contextWindow:n,dragSnapToOrigin:s=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=KP(this.lastMoveEventInfo,this.history),d=this.startEvent!==null,p=Upe(h.offset,{x:0,y:0})>=3;if(!d&&!p)return;const{point:f}=h,{timestamp:v}=vs;this.history.push({...f,timestamp:v});const{onStart:m,onMove:g}=this.handlers;d||(m&&m(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,h)},this.handlePointerMove=(h,d)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=QP(d,this.transformPagePoint),Pr.update(this.updatePoint,!0)},this.handlePointerUp=(h,d)=>{this.end();const{onEnd:p,onSessionEnd:f,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=KP(h.type==="pointercancel"?this.lastMoveEventInfo:QP(d,this.transformPagePoint),this.history);this.startEvent&&p&&p(h,m),f&&f(h,m)},!BB(t))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=r,this.contextWindow=n||window;const a=Hb(t),o=QP(a,this.transformPagePoint),{point:l}=o,{timestamp:c}=vs;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=i;u&&u(t,KP(o,this.history)),this.removeListeners=jb(W1(this.contextWindow,"pointermove",this.handlePointerMove),W1(this.contextWindow,"pointerup",this.handlePointerUp),W1(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),qd(this.updatePoint)}}function QP(e,t){return t?{point:t(e.point)}:e}function KV(e,t){return{x:e.x-t.x,y:e.y-t.y}}function KP({point:e},t){return{point:e,delta:KV(e,QK(t)),offset:KV(e,Fpe(t)),velocity:Vpe(t,.1)}}function Fpe(e){return e[0]}function QK(e){return e[e.length-1]}function Vpe(e,t){if(e.length<2)return{x:0,y:0};let i=e.length-1,r=null;const n=QK(e);for(;i>=0&&(r=e[i],!(n.timestamp-r.timestamp>Zu(t)));)i--;if(!r)return{x:0,y:0};const s=Qu(n.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}const KK=1e-4,jpe=1-KK,Hpe=1+KK,JK=.01,Gpe=0-JK,Wpe=0+JK;function go(e){return e.max-e.min}function Xpe(e,t,i){return Math.abs(e-t)<=i}function JV(e,t,i,r=.5){e.origin=r,e.originPoint=zr(t.min,t.max,e.origin),e.scale=go(i)/go(t),e.translate=zr(i.min,i.max,e.origin)-e.originPoint,(e.scale>=jpe&&e.scale<=Hpe||isNaN(e.scale))&&(e.scale=1),(e.translate>=Gpe&&e.translate<=Wpe||isNaN(e.translate))&&(e.translate=0)}function X1(e,t,i,r){JV(e.x,t.x,i.x,r?r.originX:void 0),JV(e.y,t.y,i.y,r?r.originY:void 0)}function $V(e,t,i){e.min=i.min+t.min,e.max=e.min+go(t)}function qpe(e,t,i){$V(e.x,t.x,i.x),$V(e.y,t.y,i.y)}function ej(e,t,i){e.min=t.min-i.min,e.max=e.min+go(t)}function q1(e,t,i){ej(e.x,t.x,i.x),ej(e.y,t.y,i.y)}function Ype(e,{min:t,max:i},r){return t!==void 0&&e<t?e=r?zr(t,e,r.min):Math.max(e,t):i!==void 0&&e>i&&(e=r?zr(i,e,r.max):Math.min(e,i)),e}function tj(e,t,i){return{min:t!==void 0?e.min+t:void 0,max:i!==void 0?e.max+i-(e.max-e.min):void 0}}function Zpe(e,{top:t,left:i,bottom:r,right:n}){return{x:tj(e.x,i,n),y:tj(e.y,t,r)}}function ij(e,t){let i=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([i,r]=[r,i]),{min:i,max:r}}function Qpe(e,t){return{x:ij(e.x,t.x),y:ij(e.y,t.y)}}function Kpe(e,t){let i=.5;const r=go(e),n=go(t);return n>r?i=Jv(t.min,t.max-r,e.min):r>n&&(i=Jv(e.min,e.max-n,t.min)),nh(0,1,i)}function Jpe(e,t){const i={};return t.min!==void 0&&(i.min=t.min-e.min),t.max!==void 0&&(i.max=t.max-e.min),i}const gI=.35;function $pe(e=gI){return e===!1?e=0:e===!0&&(e=gI),{x:rj(e,"left","right"),y:rj(e,"top","bottom")}}function rj(e,t,i){return{min:nj(e,t),max:nj(e,i)}}function nj(e,t){return typeof e=="number"?e:e[t]||0}const sj=()=>({translate:0,scale:1,origin:0,originPoint:0}),lv=()=>({x:sj(),y:sj()}),aj=()=>({min:0,max:0}),ln=()=>({x:aj(),y:aj()});function Bo(e){return[e("x"),e("y")]}function $K({top:e,left:t,right:i,bottom:r}){return{x:{min:t,max:i},y:{min:e,max:r}}}function efe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function tfe(e,t){if(!t)return e;const i=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}function JP(e){return e===void 0||e===1}function vI({scale:e,scaleX:t,scaleY:i}){return!JP(e)||!JP(t)||!JP(i)}function Yp(e){return vI(e)||eJ(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function eJ(e){return oj(e.x)||oj(e.y)}function oj(e){return e&&e!=="0%"}function xA(e,t,i){const r=e-i,n=t*r;return i+n}function lj(e,t,i,r,n){return n!==void 0&&(e=xA(e,n,r)),xA(e,i,r)+t}function yI(e,t=0,i=1,r,n){e.min=lj(e.min,t,i,r,n),e.max=lj(e.max,t,i,r,n)}function tJ(e,{x:t,y:i}){yI(e.x,t.translate,t.scale,t.originPoint),yI(e.y,i.translate,i.scale,i.originPoint)}const cj=.999999999999,uj=1.0000000000001;function ife(e,t,i,r=!1){const n=i.length;if(!n)return;t.x=t.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&uv(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,tJ(e,a)),r&&Yp(s.latestValues)&&uv(e,s.latestValues))}t.x<uj&&t.x>cj&&(t.x=1),t.y<uj&&t.y>cj&&(t.y=1)}function cv(e,t){e.min=e.min+t,e.max=e.max+t}function hj(e,t,i,r,n=.5){const s=zr(e.min,e.max,n);yI(e,t,i,s,r)}function uv(e,t){hj(e.x,t.x,t.scaleX,t.scale,t.originX),hj(e.y,t.y,t.scaleY,t.scale,t.originY)}function iJ(e,t){return $K(tfe(e.getBoundingClientRect(),t))}function rfe(e,t,i){const r=iJ(e,i),{scroll:n}=t;return n&&(cv(r.x,n.offset.x),cv(r.y,n.offset.y)),r}const rJ=({current:e})=>e?e.ownerDocument.defaultView:null,nfe=new WeakMap;class sfe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ln(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:r}=this.visualElement;if(r&&r.isPresent===!1)return;const n=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(Hb(u).point)},s=(u,h)=>{const{drag:d,dragPropagation:p,onDragStart:f}=this.getProps();if(d&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Jhe(d),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Bo(m=>{let g=this.getAxisMotionValue(m).get()||0;if(Oc.test(g)){const{projection:y}=this.visualElement;if(y&&y.layout){const x=y.layout.layoutBox[m];x&&(g=go(x)*(parseFloat(g)/100))}}this.originPoint[m]=g}),f&&Pr.postRender(()=>f(u,h)),lI(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},a=(u,h)=>{const{dragPropagation:d,dragDirectionLock:p,onDirectionLock:f,onDrag:v}=this.getProps();if(!d&&!this.openDragLock)return;const{offset:m}=h;if(p&&this.currentDirection===null){this.currentDirection=afe(m),this.currentDirection!==null&&f&&f(this.currentDirection);return}this.updateAxis("x",h.point,m),this.updateAxis("y",h.point,m),this.visualElement.render(),v&&v(u,h)},o=(u,h)=>this.stop(u,h),l=()=>Bo(u=>{var h;return this.getAnimationState(u)==="paused"&&((h=this.getAxisMotionValue(u).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new ZK(t,{onSessionStart:n,onStart:s,onMove:a,onSessionEnd:o,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:rJ(this.visualElement)})}stop(t,i){const r=this.isDragging;if(this.cancel(),!r)return;const{velocity:n}=i;this.startAnimation(n);const{onDragEnd:s}=this.getProps();s&&Pr.postRender(()=>s(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,r){const{drag:n}=this.getProps();if(!r||!L_(t,n,this.currentDirection))return;const s=this.getAxisMotionValue(t);let a=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(a=Ype(a,this.constraints[t],this.elastic[t])),s.set(a)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,s=this.constraints;i&&av(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&n?this.constraints=Zpe(n.layoutBox,i):this.constraints=!1,this.elastic=$pe(r),s!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&Bo(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=Jpe(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!av(t))return!1;const r=t.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=rfe(r,n.root,this.visualElement.getTransformPagePoint());let a=Qpe(n.layout.layoutBox,s);if(i){const o=i(efe(a));this.hasMutatedConstraints=!!o,o&&(a=$K(o))}return a}startAnimation(t){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=Bo(u=>{if(!L_(u,i,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const d=n?200:1e6,p=n?40:1e7,f={type:"inertia",velocity:r?t[u]:0,bounceStiffness:d,bounceDamping:p,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,f)});return Promise.all(c).then(o)}startAxisValueAnimation(t,i){const r=this.getAxisMotionValue(t);return lI(this.visualElement,t),r.start(ZB(t,r,0,i,this.visualElement,!1))}stopAnimation(){Bo(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Bo(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Bo(i=>{const{drag:r}=this.getProps();if(!L_(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(t[i]-zr(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!av(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};Bo(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();n[a]=Kpe({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Bo(a=>{if(!L_(a,t,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(zr(l,c,n[a]))})}addListeners(){if(!this.visualElement.current)return;nfe.set(this.visualElement,this);const t=this.visualElement.current,i=W1(t,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();av(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Pr.read(r);const a=Ux(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Bo(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),i(),s(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=gI,dragMomentum:o=!0}=t;return{...t,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function L_(e,t,i){return(t===!0||t===e)&&(i===null||i===e)}function afe(e,t=10){let i=null;return Math.abs(e.y)>t?i="y":Math.abs(e.x)>t&&(i="x"),i}class ofe extends np{constructor(t){super(t),this.removeGroupControls=po,this.removeListeners=po,this.controls=new sfe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||po}unmount(){this.removeGroupControls(),this.removeListeners()}}const dj=e=>(t,i)=>{e&&Pr.postRender(()=>e(t,i))};class lfe extends np{constructor(){super(...arguments),this.removePointerDownListener=po}onPointerDown(t){this.session=new ZK(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:rJ(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:dj(t),onStart:dj(i),onMove:r,onEnd:(s,a)=>{delete this.session,n&&Pr.postRender(()=>n(s,a))}}}mount(){this.removePointerDownListener=W1(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const pE={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pj(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Sy={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(ci.test(e))e=parseFloat(e);else return e;const i=pj(e,t.target.x),r=pj(e,t.target.y);return`${i}% ${r}%`}},cfe={correct:(e,{treeScale:t,projectionDelta:i})=>{const r=e,n=Yd.parse(e);if(n.length>5)return r;const s=Yd.createTransformer(e),a=typeof n[0]!="number"?1:0,o=i.x.scale*t.x,l=i.y.scale*t.y;n[0+a]/=o,n[1+a]/=l;const c=zr(o,l,.5);return typeof n[2+a]=="number"&&(n[2+a]/=c),typeof n[3+a]=="number"&&(n[3+a]/=c),s(n)}};class ufe extends R.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=t;Lhe(hfe),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),pE.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,a=r.projection;return a&&(a.isPresent=s,n||t.layoutDependency!==i||i===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?a.promote():a.relegate()||Pr.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),MB.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=t;n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function nJ(e){const[t,i]=VQ(),r=R.useContext(gB);return j.jsx(ufe,{...e,layoutGroup:r,switchLayoutGroup:R.useContext(YQ),isPresent:t,safeToRemove:i})}const hfe={borderRadius:{...Sy,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Sy,borderTopRightRadius:Sy,borderBottomLeftRadius:Sy,borderBottomRightRadius:Sy,boxShadow:cfe};function dfe(e,t,i){const r=Xs(e)?e:Bx(e);return r.start(ZB("",r,t,i)),r.animation}function pfe(e){return e instanceof SVGElement&&e.tagName!=="svg"}const ffe=(e,t)=>e.depth-t.depth;class mfe{constructor(){this.children=[],this.isDirty=!1}add(t){kB(this.children,t),this.isDirty=!0}remove(t){UB(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(ffe),this.isDirty=!1,this.children.forEach(t)}}function gfe(e,t){const i=Nc.now(),r=({timestamp:n})=>{const s=n-i;s>=t&&(qd(r),e(s-t))};return Pr.read(r,!0),()=>qd(r)}const sJ=["TopLeft","TopRight","BottomLeft","BottomRight"],vfe=sJ.length,fj=e=>typeof e=="string"?parseFloat(e):e,mj=e=>typeof e=="number"||ci.test(e);function yfe(e,t,i,r,n,s){n?(e.opacity=zr(0,i.opacity!==void 0?i.opacity:1,xfe(r)),e.opacityExit=zr(t.opacity!==void 0?t.opacity:1,0,bfe(r))):s&&(e.opacity=zr(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,r));for(let a=0;a<vfe;a++){const o=`border${sJ[a]}Radius`;let l=gj(t,o),c=gj(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||mj(l)===mj(c)?(e[o]=Math.max(zr(fj(l),fj(c),r),0),(Oc.test(c)||Oc.test(l))&&(e[o]+="%")):e[o]=c}(t.rotate||i.rotate)&&(e.rotate=zr(t.rotate||0,i.rotate||0,r))}function gj(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const xfe=aJ(0,.5,MK),bfe=aJ(.5,.95,po);function aJ(e,t,i){return r=>r<e?0:r>t?1:i(Jv(e,t,r))}function vj(e,t){e.min=t.min,e.max=t.max}function Po(e,t){vj(e.x,t.x),vj(e.y,t.y)}function yj(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function xj(e,t,i,r,n){return e-=t,e=xA(e,1/i,r),n!==void 0&&(e=xA(e,1/n,r)),e}function wfe(e,t=0,i=1,r=.5,n,s=e,a=e){if(Oc.test(t)&&(t=parseFloat(t),t=zr(a.min,a.max,t/100)-a.min),typeof t!="number")return;let o=zr(s.min,s.max,r);e===s&&(o-=t),e.min=xj(e.min,t,i,o,n),e.max=xj(e.max,t,i,o,n)}function bj(e,t,[i,r,n],s,a){wfe(e,t[i],t[r],t[n],t.scale,s,a)}const _fe=["x","scaleX","originX"],Sfe=["y","scaleY","originY"];function wj(e,t,i,r){bj(e.x,t,_fe,i?i.x:void 0,r?r.x:void 0),bj(e.y,t,Sfe,i?i.y:void 0,r?r.y:void 0)}function _j(e){return e.translate===0&&e.scale===1}function oJ(e){return _j(e.x)&&_j(e.y)}function Sj(e,t){return e.min===t.min&&e.max===t.max}function Mfe(e,t){return Sj(e.x,t.x)&&Sj(e.y,t.y)}function Mj(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function lJ(e,t){return Mj(e.x,t.x)&&Mj(e.y,t.y)}function Ej(e){return go(e.x)/go(e.y)}function Aj(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Efe{constructor(){this.members=[]}add(t){kB(this.members,t),t.scheduleRender()}remove(t){if(UB(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(n=>t===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,i){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,i&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:r}=t;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Afe(e,t,i){let r="";const n=e.x.translate/t.x,s=e.y.translate/t.y,a=(i==null?void 0:i.z)||0;if((n||s||a)&&(r=`translate3d(${n}px, ${s}px, ${a}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:c,rotate:u,rotateX:h,rotateY:d,skewX:p,skewY:f}=i;c&&(r=`perspective(${c}px) ${r}`),u&&(r+=`rotate(${u}deg) `),h&&(r+=`rotateX(${h}deg) `),d&&(r+=`rotateY(${d}deg) `),p&&(r+=`skewX(${p}deg) `),f&&(r+=`skewY(${f}deg) `)}const o=e.x.scale*t.x,l=e.y.scale*t.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const Zp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},_1=typeof window<"u"&&window.MotionDebug!==void 0,$P=["","X","Y","Z"],Cfe={visibility:"hidden"},Cj=1e3;let Tfe=0;function eD(e,t,i,r){const{latestValues:n}=t;n[e]&&(i[e]=n[e],t.setStaticValue(e,0),r&&(r[e]=0))}function cJ(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const i=vK(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:n,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(i,"transform",Pr,!(n||s))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&cJ(r)}function uJ({attachResizeListener:e,defaultParent:t,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a={},o=t==null?void 0:t()){this.id=Tfe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,_1&&(Zp.totalNodes=Zp.resolvedTargetDeltas=Zp.recalculatedProjection=0),this.nodes.forEach(Lfe),this.nodes.forEach(zfe),this.nodes.forEach(Bfe),this.nodes.forEach(Rfe),_1&&window.MotionDebug.record(Zp)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new mfe)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new FB),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,o=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=pfe(a),this.instance=a;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),o&&(c||l)&&(this.isLayoutDirty=!0),e){let h;const d=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=gfe(d,250),pE.hasAnimatedSinceResize&&(pE.hasAnimatedSinceResize=!1,this.nodes.forEach(Pj))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:d,hasRelativeTargetChanged:p,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const v=this.options.transition||u.getDefaultTransition()||jfe,{onLayoutAnimationStart:m,onLayoutAnimationComplete:g}=u.getProps(),y=!this.targetLayout||!lJ(this.targetLayout,f)||p,x=!d&&p;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||x||d&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,x);const _={...OB(v,"layout"),onPlay:m,onComplete:g};(u.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_)}else d||Pj(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,qd(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(kfe),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cJ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Tj);return}this.isUpdating||this.nodes.forEach(Ofe),this.isUpdating=!1,this.nodes.forEach(Nfe),this.nodes.forEach(Pfe),this.nodes.forEach(Dfe),this.clearAllSnapshots();const o=Nc.now();vs.delta=nh(0,1e3/60,o-vs.timestamp),vs.timestamp=o,vs.isProcessing=!0,GP.update.process(vs),GP.preRender.process(vs),GP.render.process(vs),vs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,MB.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Ife),this.sharedNodes.forEach(Ufe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Pr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Pr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ln(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!oJ(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;a&&(o||Yp(this.latestValues)||u)&&(n(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),Hfe(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:o}=this.options;if(!o)return ln();const l=o.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Gfe))){const{scroll:u}=this.root;u&&(cv(l.x,u.offset.x),cv(l.y,u.offset.y))}return l}removeElementScroll(a){var o;const l=ln();if(Po(l,a),!((o=this.scroll)===null||o===void 0)&&o.wasRoot)return l;for(let c=0;c<this.path.length;c++){const u=this.path[c],{scroll:h,options:d}=u;u!==this.root&&h&&d.layoutScroll&&(h.wasRoot&&Po(l,a),cv(l.x,h.offset.x),cv(l.y,h.offset.y))}return l}applyTransform(a,o=!1){const l=ln();Po(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&uv(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Yp(u.latestValues)&&uv(l,u.latestValues)}return Yp(this.latestValues)&&uv(l,this.latestValues),l}removeTransform(a){const o=ln();Po(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Yp(c.latestValues))continue;vI(c.latestValues)&&c.updateSnapshot();const u=ln(),h=c.measurePageBox();Po(u,h),wj(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Yp(this.latestValues)&&wj(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==vs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var o;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:h,layoutId:d}=this.options;if(!(!this.layout||!(h||d))){if(this.resolvedRelativeTargetAt=vs.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ln(),this.relativeTargetOrigin=ln(),q1(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),Po(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ln(),this.targetWithTransforms=ln()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),qpe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Po(this.target,this.layout.layoutBox),tJ(this.target,this.targetDelta)):Po(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ln(),this.relativeTargetOrigin=ln(),q1(this.relativeTargetOrigin,this.target,p.target),Po(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}_1&&Zp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||vI(this.parent.latestValues)||eJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===vs.timestamp&&(c=!1),c)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;Po(this.layoutCorrected,this.layout.layoutBox);const d=this.treeScale.x,p=this.treeScale.y;ife(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=ln());const{target:f}=o;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(yj(this.prevProjectionDelta.x,this.projectionDelta.x),yj(this.prevProjectionDelta.y,this.projectionDelta.y)),X1(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==d||this.treeScale.y!==p||!Aj(this.projectionDelta.x,this.prevProjectionDelta.x)||!Aj(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f)),_1&&Zp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var o;if((o=this.options.visualElement)===null||o===void 0||o.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=lv(),this.projectionDelta=lv(),this.projectionDeltaWithTransform=lv()}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},h=lv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=ln(),p=l?l.source:void 0,f=this.layout?this.layout.source:void 0,v=p!==f,m=this.getStack(),g=!m||m.members.length<=1,y=!!(v&&!g&&this.options.crossfade===!0&&!this.path.some(Vfe));this.animationProgress=0;let x;this.mixTargetDelta=_=>{const M=_/1e3;Dj(h.x,a.x,M),Dj(h.y,a.y,M),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(q1(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Ffe(this.relativeTarget,this.relativeTargetOrigin,d,M),x&&Mfe(this.relativeTarget,x)&&(this.isProjectionDirty=!1),x||(x=ln()),Po(x,this.relativeTarget)),v&&(this.animationValues=u,yfe(u,c,this.latestValues,M,y,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=M},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(qd(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Pr.update(()=>{pE.hasAnimatedSinceResize=!0,this.currentAnimation=dfe(0,Cj,{...a,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Cj),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:u}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&hJ(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||ln();const h=go(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=go(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}Po(o,l),uv(o,u),X1(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Efe),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:o}=this.options;return o?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:o}=this.options;return o?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const c={};l.z&&eD("z",a,c,this.animationValues);for(let u=0;u<$P.length;u++)eD(`rotate${$P[u]}`,a,c,this.animationValues),eD(`skew${$P[u]}`,a,c,this.animationValues);a.render();for(const u in c)a.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);a.scheduleRender()}getProjectionStyles(a){var o,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Cfe;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=hE(a==null?void 0:a.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const v={};return this.options.layoutId&&(v.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,v.pointerEvents=hE(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Yp(this.latestValues)&&(v.transform=u?u({},""):"none",this.hasProjected=!1),v}const d=h.animationValues||h.latestValues;this.applyTransformsToTarget(),c.transform=Afe(this.projectionDeltaWithTransform,this.treeScale,d),u&&(c.transform=u(d,c.transform));const{x:p,y:f}=this.projectionDelta;c.transformOrigin=`${p.origin*100}% ${f.origin*100}% 0`,h.animationValues?c.opacity=h===this?(l=(o=d.opacity)!==null&&o!==void 0?o:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:c.opacity=h===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const v in fA){if(d[v]===void 0)continue;const{correct:m,applyTo:g}=fA[v],y=c.transform==="none"?d[v]:m(d[v],h);if(g){const x=g.length;for(let _=0;_<x;_++)c[g[_]]=y}else c[v]=y}return this.options.layoutId&&(c.pointerEvents=h===this?hE(a==null?void 0:a.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var o;return(o=a.currentAnimation)===null||o===void 0?void 0:o.stop()}),this.root.nodes.forEach(Tj),this.root.sharedNodes.clear()}}}function Pfe(e){e.updateLayout()}function Dfe(e){var t;const i=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:n}=e.layout,{animationType:s}=e.options,a=i.source!==e.layout.source;s==="size"?Bo(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],p=go(d);d.min=r[h].min,d.max=d.min+p}):hJ(s,i.layoutBox,r)&&Bo(h=>{const d=a?i.measuredBox[h]:i.layoutBox[h],p=go(r[h]);d.max=d.min+p,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+p)});const o=lv();X1(o,r,i.layoutBox);const l=lv();a?X1(l,e.applyTransform(n,!0),i.measuredBox):X1(l,r,i.layoutBox);const c=!oJ(o);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:d,layout:p}=h;if(d&&p){const f=ln();q1(f,i.layoutBox,d.layoutBox);const v=ln();q1(v,r,p.layoutBox),lJ(f,v)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=v,e.relativeTargetOrigin=f,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:i,delta:l,layoutDelta:o,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function Lfe(e){_1&&Zp.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Rfe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Ife(e){e.clearSnapshot()}function Tj(e){e.clearMeasurements()}function Ofe(e){e.isLayoutDirty=!1}function Nfe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Pj(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function zfe(e){e.resolveTargetDelta()}function Bfe(e){e.calcProjection()}function kfe(e){e.resetSkewAndRotation()}function Ufe(e){e.removeLeadSnapshot()}function Dj(e,t,i){e.translate=zr(t.translate,0,i),e.scale=zr(t.scale,1,i),e.origin=t.origin,e.originPoint=t.originPoint}function Lj(e,t,i,r){e.min=zr(t.min,i.min,r),e.max=zr(t.max,i.max,r)}function Ffe(e,t,i,r){Lj(e.x,t.x,i.x,r),Lj(e.y,t.y,i.y,r)}function Vfe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const jfe={duration:.45,ease:[.4,0,.1,1]},Rj=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Ij=Rj("applewebkit/")&&!Rj("chrome/")?Math.round:po;function Oj(e){e.min=Ij(e.min),e.max=Ij(e.max)}function Hfe(e){Oj(e.x),Oj(e.y)}function hJ(e,t,i){return e==="position"||e==="preserve-aspect"&&!Xpe(Ej(t),Ej(i),.2)}function Gfe(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Wfe=uJ({attachResizeListener:(e,t)=>Ux(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),tD={current:void 0},dJ=uJ({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!tD.current){const e=new Wfe({});e.mount(window),e.setOptions({layoutScroll:!0}),tD.current=e}return tD.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Xfe={pan:{Feature:lfe},drag:{Feature:ofe,ProjectionNode:dJ,MeasureLayout:nJ}};function Nj(e,t,i){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",i==="Start");const n="onHover"+i,s=r[n];s&&Pr.postRender(()=>s(t,Hb(t)))}class qfe extends np{mount(){const{current:t}=this.node;t&&(this.unmount=qhe(t,i=>(Nj(this.node,i,"Start"),r=>Nj(this.node,r,"End"))))}unmount(){}}class Yfe extends np{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=jb(Ux(this.node.current,"focus",()=>this.onFocus()),Ux(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function zj(e,t,i){const{props:r}=e;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",i==="Start");const n="onTap"+(i==="End"?"":i),s=r[n];s&&Pr.postRender(()=>s(t,Hb(t)))}class Zfe extends np{mount(){const{current:t}=this.node;t&&(this.unmount=Khe(t,i=>(zj(this.node,i,"Start"),(r,{success:n})=>zj(this.node,r,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const xI=new WeakMap,iD=new WeakMap,Qfe=e=>{const t=xI.get(e.target);t&&t(e)},Kfe=e=>{e.forEach(Qfe)};function Jfe({root:e,...t}){const i=e||document;iD.has(i)||iD.set(i,{});const r=iD.get(i),n=JSON.stringify(t);return r[n]||(r[n]=new IntersectionObserver(Kfe,{root:e,...t})),r[n]}function $fe(e,t,i){const r=Jfe(t);return xI.set(e,i),r.observe(e),()=>{xI.delete(e),r.unobserve(e)}}const eme={some:0,all:1};class tme extends np{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s}=t,a={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:eme[n]},o=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),d=c?u:h;d&&d(l)};return $fe(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(ime(t,i))&&this.startObserver()}unmount(){}}function ime({viewport:e={}},{viewport:t={}}={}){return i=>e[i]!==t[i]}const rme={inView:{Feature:tme},tap:{Feature:Zfe},focus:{Feature:Yfe},hover:{Feature:qfe}},nme={layout:{ProjectionNode:dJ,MeasureLayout:nJ}},bI={current:null},pJ={current:!1};function sme(){if(pJ.current=!0,!!xB)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>bI.current=e.matches;e.addListener(t),t()}else bI.current=!1}const ame=[...kK,Vs,Yd],ome=e=>ame.find(BK(e)),Bj=new WeakMap;function lme(e,t,i){for(const r in t){const n=t[r],s=i[r];if(Xs(n))e.addValue(r,n);else if(Xs(s))e.addValue(r,Bx(n,{owner:e}));else if(s!==n)if(e.hasValue(r)){const a=e.getValue(r);a.liveStyle===!0?a.jump(n):a.hasAnimated||a.set(n)}else{const a=e.getStaticValue(r);e.addValue(r,Bx(a!==void 0?a:n,{owner:e}))}}for(const r in i)t[r]===void 0&&e.removeValue(r);return t}const kj=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class cme{scrapeMotionValuesFromProps(t,i,r){return{}}constructor({parent:t,props:i,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:s,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=XB,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=Nc.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Pr.render(this.render,!1,!0))};const{latestValues:l,renderState:c,onUpdate:u}=a;this.onUpdate=u,this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=i,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=n,this.options=o,this.blockInitialAnimation=!!s,this.isControllingVariants=cT(i),this.isVariantNode=XQ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...d}=this.scrapeMotionValuesFromProps(i,{},this);for(const p in d){const f=d[p];l[p]!==void 0&&Xs(f)&&f.set(l[p],!1)}}mount(t){this.current=t,Bj.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),pJ.current||sme(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:bI.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){Bj.delete(this.current),this.projection&&this.projection.unmount(),qd(this.notifyUpdate),qd(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const r=dm.has(t),n=i.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&Pr.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0)}),s=i.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{n(),s(),a&&a(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in $v){const i=$v[t];if(!i)continue;const{isEnabled:r,Feature:n}=i;if(!this.features[t]&&n&&r(this.props)&&(this.features[t]=new n(this)),this.features[t]){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ln()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<kj.length;r++){const n=kj[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s="on"+n,a=t[s];a&&(this.propEventSubscriptions[n]=this.on(n,a))}this.prevMotionValues=lme(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const r=this.values.get(t);i!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&i!==void 0&&(r=Bx(i===null?void 0:i,{owner:this}),this.addValue(t,r)),r}readValue(t,i){var r;let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(NK(n)||AK(n))?n=parseFloat(n):!ome(n)&&Yd.test(i)&&(n=RK(t,i)),this.setBaseTarget(t,Xs(n)?n.get():n)),Xs(n)?n.get():n}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const a=AB(this.props,r,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);a&&(n=a[t])}if(r&&n!==void 0)return n;const s=this.getBaseTargetFromProps(this.props,t);return s!==void 0&&!Xs(s)?s:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new FB),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class fJ extends cme{constructor(){super(...arguments),this.KeyframeResolver=UK}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:r}){delete i[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Xs(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function ume(e){return window.getComputedStyle(e)}class hme extends fJ{constructor(){super(...arguments),this.type="html",this.renderInstance=tK}readValueFromInstance(t,i){if(dm.has(i)){const r=WB(i);return r&&r.default||0}else{const r=ume(t),n=(JQ(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(t,{transformPagePoint:i}){return iJ(t,i)}build(t,i,r){PB(t,i,r.transformTemplate)}scrapeMotionValuesFromProps(t,i,r){return IB(t,i,r)}}class dme extends fJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ln}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(dm.has(i)){const r=WB(i);return r&&r.default||0}return i=iK.has(i)?i:SB(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,r){return sK(t,i,r)}build(t,i,r){DB(t,i,this.isSVGTag,r.transformTemplate)}renderInstance(t,i,r,n){rK(t,i,r,n)}mount(t){this.isSVGTag=RB(t.tagName),super.mount(t)}}const pme=(e,t)=>EB(e)?new dme(t):new hme(t,{allowProjection:e!==R.Fragment}),fme=Fhe({...Bpe,...rme,...Xfe,...nme},pme),Gt=the(fme);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var mme={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gme=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),lr=(e,t)=>{const i=R.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:o="",children:l,...c},u)=>R.createElement("svg",{ref:u,...mme,width:n,height:n,stroke:r,strokeWidth:a?Number(s)*24/Number(n):s,className:["lucide",`lucide-${gme(e)}`,o].join(" "),...c},[...t.map(([h,d])=>R.createElement(h,d)),...Array.isArray(l)?l:[l]]));return i.displayName=`${e}`,i};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mJ=lr("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vme=lr("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uj=lr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yme=lr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gJ=lr("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vJ=lr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xme=lr("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bme=lr("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yJ=lr("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wme=lr("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _me=lr("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sme=lr("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xJ=lr("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QB=lr("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mme=lr("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eme=lr("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ame=lr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cme=lr("Paintbrush",[["path",{d:"M18.37 2.63 14 7l-1.59-1.59a2 2 0 0 0-2.82 0L8 7l9 9 1.59-1.59a2 2 0 0 0 0-2.82L17 10l4.37-4.37a2.12 2.12 0 1 0-3-3Z",key:"m6k5sh"}],["path",{d:"M9 8c-2 3-4 3.5-7 4l8 10c2-1 6-5 6-7",key:"arzq70"}],["path",{d:"M14.5 17.5 4.5 15",key:"s7fvrz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bJ=lr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tme=lr("RefreshCcw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pme=lr("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dme=lr("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wJ=lr("Sofa",[["path",{d:"M20 9V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v3",key:"1dgpiv"}],["path",{d:"M2 11v5a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v2H6v-2a2 2 0 0 0-4 0Z",key:"u5qfb7"}],["path",{d:"M4 18v2",key:"jwo5n2"}],["path",{d:"M20 18v2",key:"1ar1qi"}],["path",{d:"M12 4v9",key:"oqhhn3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lme=lr("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rme=lr("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ime=lr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=lr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ome=lr("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nme=lr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),zme="/zain-front-end/assets/logo-9SPnwP3J.png",Bme=()=>{const[e,t]=R.useState(!1),[i,r]=R.useState(!1),n=Ub();R.useEffect(()=>{const a=()=>{r(window.scrollY>20)};return window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[]);const s=[{name:"Home",path:"/"},{name:"Services",path:"/services"},{name:"Portfolio",path:"/portfolio"},{name:"Contact",path:"/contact"}];return j.jsx("nav",{className:`fixed w-full z-50 transition-all duration-300 ${i?"py-4 mt-5 bg-black/60 backdrop-blur-md rounded-full":"py-6 bg-transparent rounded-full"}`,children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs("div",{className:"flex items-center justify-between",children:[j.jsxs(Zo,{to:"/",className:"flex items-center space-x-2",children:[j.jsx(Gt.div,{whileHover:{scale:1.1,rotate:360},transition:{duration:.5},children:j.jsx("img",{src:zme,className:"w-8 h-10"})}),j.jsx("span",{className:"text-2xl font-bold text-white",children:"Zain Interior"})]}),j.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[s.map(a=>j.jsxs(Zo,{to:a.path,className:`relative text-lg text-white hover:text-amber-400 transition-colors ${n.pathname===a.path?"text-amber-400":""}`,children:[a.name,n.pathname===a.path&&j.jsx(Gt.div,{layoutId:"underline",className:"absolute -bottom-1 left-0 right-0 h-0.5 bg-amber-400"})]},a.path)),j.jsx(Zo,{to:"consultation/",className:"flex items-center space-x-2",children:j.jsx(Gt.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-6 py-2 bg-amber-400 text-black rounded-full font-medium hover:bg-amber-300 transition-colors",children:"Book Consultation"})})]}),j.jsx(Gt.button,{whileTap:{scale:.95},onClick:()=>t(!e),className:"md:hidden text-white",children:e?j.jsx(Nme,{className:"w-6 h-6"}):j.jsx(Eme,{className:"w-6 h-6"})})]}),j.jsx(que,{children:e&&j.jsx(Gt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"md:hidden overflow-hidden",children:j.jsxs("div",{className:"py-4 space-y-4",children:[s.map(a=>j.jsx(Gt.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{duration:.3},children:j.jsx(Zo,{to:a.path,className:`block px-4 py-2 text-white hover:text-amber-400 transition-colors ${n.pathname===a.path?"text-amber-400":""}`,onClick:()=>t(!1),children:a.name})},a.path)),j.jsx(Gt.button,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},className:"w-full px-4 py-2 bg-amber-400 text-black rounded-lg font-medium hover:bg-amber-300 transition-colors",children:"Book Consultation"})]})})})]})})},kme="modulepreload",Ume=function(e){return"/zain-front-end/"+e},Fj={},sp=function(t,i,r){let n=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(i.map(l=>{if(l=Ume(l),l in Fj)return;Fj[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":kme,c||(h.as="script"),h.crossOrigin="",h.href=l,o&&h.setAttribute("nonce",o),document.head.appendChild(h),c)return new Promise((d,p)=>{h.addEventListener("load",d),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})};var Fme=Object.create,dT=Object.defineProperty,Vme=Object.getOwnPropertyDescriptor,jme=Object.getOwnPropertyNames,Hme=Object.getPrototypeOf,Gme=Object.prototype.hasOwnProperty,Wme=(e,t,i)=>t in e?dT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,pm=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Xme=(e,t)=>{for(var i in t)dT(e,i,{get:t[i],enumerable:!0})},qme=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of jme(t))!Gme.call(e,n)&&n!==i&&dT(e,n,{get:()=>t[n],enumerable:!(r=Vme(t,n))||r.enumerable});return e},ap=(e,t,i)=>(i=e!=null?Fme(Hme(e)):{},qme(t||!e||!e.__esModule?dT(i,"default",{value:e,enumerable:!0}):i,e)),S1=(e,t,i)=>(Wme(e,typeof t!="symbol"?t+"":t,i),i),Yme=pm((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),SJ=pm((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,p,f,v,m,g,y,x,_=r[0].length,M=r.length;if(M<_)throw new TypeError("Invalid matrix: m < n");for(var S=[],E=[],A=[],P=n==="f"?M:_,C=g=f=0;C<M;C++)E[C]=new Array(P).fill(0);for(C=0;C<_;C++)A[C]=new Array(_).fill(0);var D,N=new Array(_).fill(0);for(C=0;C<M;C++)for(l=0;l<_;l++)E[C][l]=r[C][l];for(C=0;C<_;C++){for(S[C]=f,m=0,u=C+1,l=C;l<M;l++)m+=Math.pow(E[l][C],2);if(m<o)f=0;else for(v=(p=E[C][C])*(f=p<0?Math.sqrt(m):-Math.sqrt(m))-m,E[C][C]=p-f,l=u;l<_;l++){for(m=0,c=C;c<M;c++)m+=E[c][C]*E[c][l];for(p=m/v,c=C;c<M;c++)E[c][l]=E[c][l]+p*E[c][C]}for(N[C]=f,m=0,l=u;l<_;l++)m+=Math.pow(E[C][l],2);if(m<o)f=0;else{for(v=(p=E[C][C+1])*(f=p<0?Math.sqrt(m):-Math.sqrt(m))-m,E[C][C+1]=p-f,l=u;l<_;l++)S[l]=E[C][l]/v;for(l=u;l<M;l++){for(m=0,c=u;c<_;c++)m+=E[l][c]*E[C][c];for(c=u;c<_;c++)E[l][c]=E[l][c]+m*S[c]}}g<(y=Math.abs(N[C])+Math.abs(S[C]))&&(g=y)}if(s)for(C=_-1;0<=C;C--){if(f!==0){for(v=E[C][C+1]*f,l=u;l<_;l++)A[l][C]=E[C][l]/v;for(l=u;l<_;l++){for(m=0,c=u;c<_;c++)m+=E[C][c]*A[c][l];for(c=u;c<_;c++)A[c][l]=A[c][l]+m*A[c][C]}}for(l=u;l<_;l++)A[C][l]=0,A[l][C]=0;A[C][C]=1,f=S[C],u=C}if(n){if(n==="f")for(C=_;C<M;C++){for(l=_;l<M;l++)E[C][l]=0;E[C][C]=1}for(C=_-1;0<=C;C--){for(u=C+1,f=N[C],l=u;l<P;l++)E[C][l]=0;if(f!==0){for(v=E[C][C]*f,l=u;l<P;l++){for(m=0,c=u;c<M;c++)m+=E[c][C]*E[c][l];for(p=m/v,c=C;c<M;c++)E[c][l]=E[c][l]+p*E[c][C]}for(l=C;l<M;l++)E[l][C]=E[l][C]/f}else for(l=C;l<M;l++)E[l][C]=0;E[C][C]=E[C][C]+1}}for(a*=g,c=_-1;0<=c;c--)for(var U=0;U<50;U++){for(D=!1,u=c;0<=u;u--){if(Math.abs(S[u])<=a){D=!0;break}if(Math.abs(N[u-1])<=a)break}if(!D){for(d=0,h=u-(m=1),C=u;C<c+1&&(p=m*S[C],S[C]=d*S[C],!(Math.abs(p)<=a));C++)if(f=N[C],N[C]=Math.sqrt(p*p+f*f),d=f/(v=N[C]),m=-p/v,n)for(l=0;l<M;l++)y=E[l][h],x=E[l][C],E[l][h]=y*d+x*m,E[l][C]=-y*m+x*d}if(x=N[c],u===c){if(x<0&&(N[c]=-x,s))for(l=0;l<_;l++)A[l][c]=-A[l][c];break}for(g=N[u],p=(((y=N[c-1])-x)*(y+x)+((f=S[c-1])-(v=S[c]))*(f+v))/(2*v*y),f=Math.sqrt(p*p+1),p=((g-x)*(g+x)+v*(y/(p<0?p-f:p+f)-v))/g,C=u+(m=d=1);C<c+1;C++){if(f=S[C],y=N[C],v=m*f,f*=d,x=Math.sqrt(p*p+v*v),p=g*(d=p/(S[C-1]=x))+f*(m=v/x),f=-g*m+f*d,v=y*m,y*=d,s)for(l=0;l<_;l++)g=A[l][C-1],x=A[l][C],A[l][C-1]=g*d+x*m,A[l][C]=-g*m+x*d;if(x=Math.sqrt(p*p+v*v),p=(d=p/(N[C-1]=x))*f+(m=v/x)*y,g=-m*f+d*y,n)for(l=0;l<M;l++)y=E[l][C-1],x=E[l][C],E[l][C-1]=y*d+x*m,E[l][C]=-y*m+x*d}S[u]=0,S[c]=p,N[c]=g}for(C=0;C<_;C++)N[C]<a&&(N[C]=0);return{u:E,q:N,v:A}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),Zme=pm((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.exports=e.default}),Qme=pm((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}t.exports=e.default}),Kme=pm((e,t)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(f){return'"'+c(f.text)+'"'},class:function(f){var v="",m;for(m=0;m<f.parts.length;m++)v+=f.parts[m]instanceof Array?u(f.parts[m][0])+"-"+u(f.parts[m][1]):u(f.parts[m]);return"["+(f.inverted?"^":"")+v+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function l(f){return f.charCodeAt(0).toString(16).toUpperCase()}function c(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function u(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+l(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+l(v)})}function h(f){return o[f.type](f)}function d(f){var v=new Array(f.length),m,g;for(m=0;m<f.length;m++)v[m]=h(f[m]);if(v.sort(),v.length>0){for(m=1,g=1;m<v.length;m++)v[m-1]!==v[m]&&(v[g]=v[m],g++);v.length=g}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function p(f){return f?'"'+c(f)+'"':"end of input"}return"Expected "+d(s)+" but "+p(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:ut},c=ut,u=function(Z){if(!Z)return[];for(var J=[],be=0;be<Z.length;be++)J=J.concat.apply(J,Z[be]);var ne=J[0];return ne&&ne.code=="m"&&(delete ne.relative,ne.code="M"),J},h=function(Z,J){return Vi(Z,J)},d=/^[Mm]/,p=Ve(["M","m"],!1,!1),f=function(Z,J,be){var ne=er(Z,[J]);return be&&(ne=ne.concat(er(Z=="M"?"L":"l",be[1]))),ne},v=/^[Zz]/,m=Ve(["Z","z"],!1,!1),g=function(){return er("Z")},y=/^[Ll]/,x=Ve(["L","l"],!1,!1),_=function(Z,J){return er(Z,J)},M=/^[Hh]/,S=Ve(["H","h"],!1,!1),E=function(Z,J){return er(Z,J.map(function(be){return{x:be}}))},A=/^[Vv]/,P=Ve(["V","v"],!1,!1),C=function(Z,J){return er(Z,J.map(function(be){return{y:be}}))},D=/^[Cc]/,N=Ve(["C","c"],!1,!1),U=function(Z,J,be){return{x1:Z.x,y1:Z.y,x2:J.x,y2:J.y,x:be.x,y:be.y}},I=/^[Ss]/,G=Ve(["S","s"],!1,!1),Q=function(Z,J){return{x2:Z.x,y2:Z.y,x:J.x,y:J.y}},Y=/^[Qq]/,O=Ve(["Q","q"],!1,!1),V=function(Z,J){return{x1:Z.x,y1:Z.y,x:J.x,y:J.y}},F=/^[Tt]/,W=Ve(["T","t"],!1,!1),ee=/^[Aa]/,ae=Ve(["A","a"],!1,!1),K=function(Z,J,be,ne,Me,ht){return{rx:Z,ry:J,xAxisRotation:be,largeArc:ne,sweep:Me,x:ht.x,y:ht.y}},$=function(Z,J){return{x:Z,y:J}},ie=function(Z){return Z*1},ye=function(Z){return Z.join("")*1},pe=/^[01]/,me=Ve(["0","1"],!1,!1),ge=function(Z){return Z=="1"},xe=function(){return""},te=",",we=at(",",!1),Ce=function(Z){return Z.join("")},Se=".",Re=at(".",!1),Xe=/^[eE]/,Be=Ve(["e","E"],!1,!1),Fe=/^[+\-]/,dt=Ve(["+","-"],!1,!1),se=/^[0-9]/,z=Ve([["0","9"]],!1,!1),X=function(Z){return Z.join("")},ce=/^[ \t\n\r]/,Ee=Ve([" ","	",`
`,"\r"],!1,!1),q=0,Ye=[{line:1,column:1}],et=0,ke=[],_e;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function at(Z,J){return{type:"literal",text:Z,ignoreCase:J}}function Ve(Z,J,be){return{type:"class",parts:Z,inverted:J,ignoreCase:be}}function mt(){return{type:"end"}}function pt(Z){var J=Ye[Z],be;if(J)return J;for(be=Z-1;!Ye[be];)be--;for(J=Ye[be],J={line:J.line,column:J.column};be<Z;)s.charCodeAt(be)===10?(J.line++,J.column=1):J.column++,be++;return Ye[Z]=J,J}function st(Z,J){var be=pt(Z),ne=pt(J);return{start:{offset:Z,line:be.line,column:be.column},end:{offset:J,line:ne.line,column:ne.column}}}function ue(Z){q<et||(q>et&&(et=q,ke=[]),ke.push(Z))}function ze(Z,J,be){return new r(r.buildMessage(Z,J),Z,J,be)}function ut(){var Z,J,be,ne,Me;for(Z=q,J=[],be=yt();be!==o;)J.push(be),be=yt();if(J!==o)if(be=de(),be===o&&(be=null),be!==o){for(ne=[],Me=yt();Me!==o;)ne.push(Me),Me=yt();ne!==o?(J=u(be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;else q=Z,Z=o;return Z}function de(){var Z,J,be,ne,Me,ht;if(Z=q,J=Ne(),J!==o){for(be=[],ne=q,Me=[],ht=yt();ht!==o;)Me.push(ht),ht=yt();for(Me!==o?(ht=Ne(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;){for(be.push(ne),ne=q,Me=[],ht=yt();ht!==o;)Me.push(ht),ht=yt();Me!==o?(ht=Ne(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o)}be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Ne(){var Z,J,be,ne,Me,ht;if(Z=q,J=He(),J!==o){for(be=[],ne=q,Me=[],ht=yt();ht!==o;)Me.push(ht),ht=yt();for(Me!==o?(ht=oe(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;){for(be.push(ne),ne=q,Me=[],ht=yt();ht!==o;)Me.push(ht),ht=yt();Me!==o?(ht=oe(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o)}be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function oe(){var Z;return Z=Ae(),Z===o&&(Z=tt(),Z===o&&(Z=Dt(),Z===o&&(Z=Wt(),Z===o&&(Z=Ni(),Z===o&&(Z=Ps(),Z===o&&(Z=le(),Z===o&&(Z=Ue(),Z===o&&(Z=It())))))))),Z}function He(){var Z,J,be,ne,Me,ht,jr;if(Z=q,d.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(p)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=re(),ne!==o?(Me=q,ht=Pe(),ht===o&&(ht=null),ht!==o?(jr=ct(),jr!==o?(ht=[ht,jr],Me=ht):(q=Me,Me=o)):(q=Me,Me=o),Me===o&&(Me=null),Me!==o?(J=f(J,ne,Me),Z=J):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Ae(){var Z,J;return Z=q,v.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(m)),J!==o&&(J=g()),Z=J,Z}function tt(){var Z,J,be,ne;if(Z=q,y.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(x)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=ct(),ne!==o?(J=_(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function ct(){var Z,J,be,ne,Me,ht;if(Z=q,J=re(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=re(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=re(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Dt(){var Z,J,be,ne;if(Z=q,M.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(S)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=ai(),ne!==o?(J=E(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function ai(){var Z,J,be,ne,Me,ht;if(Z=q,J=Le(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Le(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Le(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Wt(){var Z,J,be,ne;if(Z=q,A.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(P)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=ai(),ne!==o?(J=C(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Ni(){var Z,J,be,ne;if(Z=q,D.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(N)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=Qt(),ne!==o?(J=_(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Qt(){var Z,J,be,ne,Me,ht;if(Z=q,J=Ot(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Ot(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Ot(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Ot(){var Z,J,be,ne,Me,ht;return Z=q,J=re(),J!==o?(be=Pe(),be===o&&(be=null),be!==o?(ne=re(),ne!==o?(Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=re(),ht!==o?(J=U(J,ne,ht),Z=J):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o),Z}function Ps(){var Z,J,be,ne;if(Z=q,I.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(G)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=Kc(),ne!==o?(J=_(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Kc(){var Z,J,be,ne,Me,ht;if(Z=q,J=al(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=al(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=al(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function al(){var Z,J,be,ne;return Z=q,J=re(),J!==o?(be=Pe(),be===o&&(be=null),be!==o?(ne=re(),ne!==o?(J=Q(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o),Z}function le(){var Z,J,be,ne;if(Z=q,Y.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(O)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=Ge(),ne!==o?(J=_(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Ge(){var Z,J,be,ne,Me,ht;if(Z=q,J=Ze(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Ze(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Ze(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Ze(){var Z,J,be,ne;return Z=q,J=re(),J!==o?(be=Pe(),be===o&&(be=null),be!==o?(ne=re(),ne!==o?(J=V(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o),Z}function Ue(){var Z,J,be,ne;if(Z=q,F.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(W)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=Je(),ne!==o?(J=_(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function Je(){var Z,J,be,ne,Me,ht;if(Z=q,J=re(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=re(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=re(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function It(){var Z,J,be,ne;if(Z=q,ee.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(ae)),J!==o){for(be=[],ne=yt();ne!==o;)be.push(ne),ne=yt();be!==o?(ne=ei(),ne!==o?(J=_(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)}else q=Z,Z=o;return Z}function ei(){var Z,J,be,ne,Me,ht;if(Z=q,J=oi(),J!==o){for(be=[],ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=oi(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);ne!==o;)be.push(ne),ne=q,Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=oi(),ht!==o?(Me=[Me,ht],ne=Me):(q=ne,ne=o)):(q=ne,ne=o);be!==o?(J=h(J,be),Z=J):(q=Z,Z=o)}else q=Z,Z=o;return Z}function oi(){var Z,J,be,ne,Me,ht,jr,Hr,vr,Ca,ol,tn;return Z=q,J=Te(),J!==o?(be=Pe(),be===o&&(be=null),be!==o?(ne=Te(),ne!==o?(Me=Pe(),Me===o&&(Me=null),Me!==o?(ht=Le(),ht!==o?(jr=Pe(),jr!==o?(Hr=Ie(),Hr!==o?(vr=Pe(),vr===o&&(vr=null),vr!==o?(Ca=Ie(),Ca!==o?(ol=Pe(),ol===o&&(ol=null),ol!==o?(tn=re(),tn!==o?(J=K(J,ne,ht,Hr,Ca,tn),Z=J):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o),Z}function re(){var Z,J,be,ne;return Z=q,J=Le(),J!==o?(be=Pe(),be===o&&(be=null),be!==o?(ne=Le(),ne!==o?(J=$(J,ne),Z=J):(q=Z,Z=o)):(q=Z,Z=o)):(q=Z,Z=o),Z}function Te(){var Z,J;return Z=q,J=Lt(),J===o&&(J=Vt()),J!==o&&(J=ie(J)),Z=J,Z}function Le(){var Z,J,be,ne;return Z=q,J=q,be=bt(),be===o&&(be=null),be!==o?(ne=Lt(),ne!==o?(be=[be,ne],J=be):(q=J,J=o)):(q=J,J=o),J===o&&(J=q,be=bt(),be===o&&(be=null),be!==o?(ne=Vt(),ne!==o?(be=[be,ne],J=be):(q=J,J=o)):(q=J,J=o)),J!==o&&(J=ye(J)),Z=J,Z}function Ie(){var Z,J;return Z=q,pe.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(me)),J!==o&&(J=ge(J)),Z=J,Z}function Pe(){var Z,J,be,ne,Me;if(Z=q,J=[],be=yt(),be!==o)for(;be!==o;)J.push(be),be=yt();else J=o;if(J!==o)if(be=gt(),be===o&&(be=null),be!==o){for(ne=[],Me=yt();Me!==o;)ne.push(Me),Me=yt();ne!==o?(J=[J,be,ne],Z=J):(q=Z,Z=o)}else q=Z,Z=o;else q=Z,Z=o;if(Z===o){if(Z=q,J=q,be=gt(),be!==o){for(ne=[],Me=yt();Me!==o;)ne.push(Me),Me=yt();ne!==o?(be=[be,ne],J=be):(q=J,J=o)}else q=J,J=o;J!==o&&(J=xe()),Z=J}return Z}function gt(){var Z;return s.charCodeAt(q)===44?(Z=te,q++):(Z=o,ue(we)),Z}function Lt(){var Z,J,be,ne;return Z=q,J=q,be=Ft(),be!==o?(ne=At(),ne===o&&(ne=null),ne!==o?(be=[be,ne],J=be):(q=J,J=o)):(q=J,J=o),J===o&&(J=q,be=Vt(),be!==o?(ne=At(),ne!==o?(be=[be,ne],J=be):(q=J,J=o)):(q=J,J=o)),J!==o&&(J=Ce(J)),Z=J,Z}function Ft(){var Z,J,be,ne,Me;return Z=q,J=q,be=Vt(),be===o&&(be=null),be!==o?(s.charCodeAt(q)===46?(ne=Se,q++):(ne=o,ue(Re)),ne!==o?(Me=Vt(),Me!==o?(be=[be,ne,Me],J=be):(q=J,J=o)):(q=J,J=o)):(q=J,J=o),J===o&&(J=q,be=Vt(),be!==o?(s.charCodeAt(q)===46?(ne=Se,q++):(ne=o,ue(Re)),ne!==o?(be=[be,ne],J=be):(q=J,J=o)):(q=J,J=o)),J!==o&&(J=Ce(J)),Z=J,Z}function At(){var Z,J,be,ne,Me;return Z=q,J=q,Xe.test(s.charAt(q))?(be=s.charAt(q),q++):(be=o,ue(Be)),be!==o?(ne=bt(),ne===o&&(ne=null),ne!==o?(Me=Vt(),Me!==o?(be=[be,ne,Me],J=be):(q=J,J=o)):(q=J,J=o)):(q=J,J=o),J!==o&&(J=Ce(J)),Z=J,Z}function bt(){var Z;return Fe.test(s.charAt(q))?(Z=s.charAt(q),q++):(Z=o,ue(dt)),Z}function Vt(){var Z,J,be;if(Z=q,J=[],se.test(s.charAt(q))?(be=s.charAt(q),q++):(be=o,ue(z)),be!==o)for(;be!==o;)J.push(be),se.test(s.charAt(q))?(be=s.charAt(q),q++):(be=o,ue(z));else J=o;return J!==o&&(J=X(J)),Z=J,Z}function yt(){var Z,J;return Z=q,ce.test(s.charAt(q))?(J=s.charAt(q),q++):(J=o,ue(Ee)),J!==o&&(J=xe()),Z=J,Z}function Vi(Z,J){if(!J)return[Z];for(var be=[Z],ne=0,Me=J.length;ne<Me;ne++)be[ne+1]=J[ne][1];return be}var Sr={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ki in Sr)Sr[ki.toUpperCase()]=Sr[ki];function er(Z,J){J||(J=[{}]);for(var be=J.length;be--;){var ne={code:Z,command:Sr[Z]};Z==Z.toLowerCase()&&(ne.relative=!0);for(var Me in J[be])ne[Me]=J[be][Me];J[be]=ne}return J}if(_e=c(),_e!==o&&q===s.length)return _e;throw _e!==o&&q<s.length&&ue(mt()),ze(ke,et<s.length?s.charAt(et):null,et<s.length?st(et,et+1):st(et,et))}t.exports={SyntaxError:r,parse:n}}),MJ=pm((e,t)=>{var i=Kme().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),Jme=pm((e,t)=>{t.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),C0="149",Do={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},$me=0,Vj=1,ege=2,KB=1,tge=2,M1=3,Vl=0,os=1,qs=2,Tn=0,If=1,jj=2,Hj=3,Gj=4,ige=5,Ug=100,rge=101,nge=102,Wj=103,Xj=104,sge=200,age=201,oge=202,lge=203,EJ=204,AJ=205,cge=206,uge=207,hge=208,dge=209,pge=210,fge=0,mge=1,gge=2,wI=3,vge=4,yge=5,xge=6,bge=7,CJ=0,wge=1,_ge=2,zc=0,Sge=1,Mge=2,Ege=3,Age=4,Cge=5,TJ=300,Zf=301,Qf=302,_I=303,SI=304,Gb=306,Fu=1e3,Cr=1001,MI=1002,_i=1003,qj=1004,rD=1005,gi=1006,Tge=1007,t0=1008,Js=1009,Pge=1010,Dge=1011,PJ=1012,Lge=1013,Vu=1014,rr=1015,sh=1016,Rge=1017,Ige=1018,Of=1020,Oge=1021,Rr=1023,Nge=1024,zge=1025,Nf=1026,Kf=1027,fE=1028,Bge=1029,bA=1030,kge=1031,DJ=1033,nD=33776,sD=33777,aD=33778,oD=33779,Yj=35840,Zj=35841,Qj=35842,Kj=35843,Uge=36196,Jj=37492,$j=37496,e6=37808,t6=37809,i6=37810,r6=37811,n6=37812,s6=37813,a6=37814,o6=37815,l6=37816,c6=37817,u6=37818,h6=37819,d6=37820,p6=37821,lD=36492,Fge=36283,f6=36284,m6=36285,g6=36286,LJ=2200,RJ=2201,JB=2202,wA=2300,_A=2301,cD=2302,hv=2400,dv=2401,SA=2402,$B=2500,Vge=2501,jl=3e3,fi=3001,mh=3200,IJ=3201,jge=0,Hge=1,yc="srgb",MA="srgb-linear",uD=7680,Gge=519,EI=35044,Wge=35048,AI="300 es",CI=1035,Ts=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,e);e.target=null}}},zs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],v6=1234567,Y1=Math.PI/180,Fx=180/Math.PI;function Jo(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(zs[e&255]+zs[e>>8&255]+zs[e>>16&255]+zs[e>>24&255]+"-"+zs[t&255]+zs[t>>8&255]+"-"+zs[t>>16&15|64]+zs[t>>24&255]+"-"+zs[i&63|128]+zs[i>>8&255]+"-"+zs[i>>16&255]+zs[i>>24&255]+zs[r&255]+zs[r>>8&255]+zs[r>>16&255]+zs[r>>24&255]).toLowerCase()}function wn(e,t,i){return Math.max(t,Math.min(i,e))}function ek(e,t){return(e%t+t)%t}function Xge(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function qge(e,t,i){return e!==t?(i-e)/(t-e):0}function Z1(e,t,i){return(1-i)*e+i*t}function Yge(e,t,i,r){return Z1(e,t,1-Math.exp(-i*r))}function Zge(e,t=1){return t-Math.abs(ek(e,t*2)-t)}function Qge(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function Kge(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function Jge(e,t){return e+Math.floor(Math.random()*(t-e+1))}function $ge(e,t){return e+Math.random()*(t-e)}function eve(e){return e*(.5-Math.random())}function tve(e){e!==void 0&&(v6=e);let t=v6+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function ive(e){return e*Y1}function rve(e){return e*Fx}function TI(e){return(e&e-1)===0&&e!==0}function OJ(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function EA(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function nve(e,t,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function ju(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function mr(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Mt=Object.freeze({__proto__:null,DEG2RAD:Y1,RAD2DEG:Fx,ceilPowerOfTwo:OJ,clamp:wn,damp:Yge,degToRad:ive,denormalize:ju,euclideanModulo:ek,floorPowerOfTwo:EA,generateUUID:Jo,inverseLerp:qge,isPowerOfTwo:TI,lerp:Z1,mapLinear:Xge,normalize:mr,pingpong:Zge,radToDeg:rve,randFloat:$ge,randFloatSpread:eve,randInt:Jge,seededRandom:tve,setQuaternionFromProperEuler:nve,smootherstep:Kge,smoothstep:Qge}),ve=class{constructor(e=0,t=0){ve.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,s=this.y-e.y;return this.x=n*i-s*r+e.x,this.y=n*r+s*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Mn=class{constructor(){Mn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,n,s,a,o,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=a,c[3]=t,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],f=r[0],v=r[3],m=r[6],g=r[1],y=r[4],x=r[7],_=r[2],M=r[5],S=r[8];return n[0]=s*f+a*g+o*_,n[3]=s*v+a*y+o*M,n[6]=s*m+a*x+o*S,n[1]=l*f+c*g+u*_,n[4]=l*v+c*y+u*M,n[7]=l*m+c*x+u*S,n[2]=h*f+d*g+p*_,n[5]=h*v+d*y+p*M,n[8]=h*m+d*x+p*S,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],c=e[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,p=t*u+i*h+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=u*f,e[1]=(r*l-c*i)*f,e[2]=(a*i-r*s)*f,e[3]=h*f,e[4]=(c*t-r*o)*f,e[5]=(r*n-a*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*n)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(hD.makeScale(e,t)),this}rotate(e){return this.premultiply(hD.makeRotation(-e)),this}translate(e,t){return this.premultiply(hD.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},hD=new Mn;function NJ(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var sve={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function R_(e,t){return new sve[e](t)}function Vx(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ave(e,t,i){return new Promise(function(r,n){function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:n();break;case e.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function zf(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function mE(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var dD={[yc]:{[MA]:zf},[MA]:{[yc]:mE}},ra={legacyMode:!0,get workingColorSpace(){return MA},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(dD[t]&&dD[t][i]!==void 0){let r=dD[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},zJ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Rn={r:0,g:0,b:0},hl={h:0,s:0,l:0},I_={h:0,s:0,l:0};function pD(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function O_(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Yt=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=yc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ra.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=ra.workingColorSpace){return this.r=e,this.g=t,this.b=i,ra.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=ra.workingColorSpace){if(e=ek(e,1),t=wn(t,0,1),i=wn(i,0,1),t===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=pD(s,n,e+1/3),this.g=pD(s,n,e),this.b=pD(s,n,e-1/3)}return ra.toWorkingColorSpace(this,r),this}setStyle(e,t=yc){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,ra.toWorkingColorSpace(this,t),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,ra.toWorkingColorSpace(this,t),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,ra.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,ra.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=yc){let i=zJ[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=zf(e.r),this.g=zf(e.g),this.b=zf(e.b),this}copyLinearToSRGB(e){return this.r=mE(e.r),this.g=mE(e.g),this.b=mE(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=yc){return ra.fromWorkingColorSpace(O_(this,Rn),e),wn(Rn.r*255,0,255)<<16^wn(Rn.g*255,0,255)<<8^wn(Rn.b*255,0,255)<<0}getHexString(e=yc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ra.workingColorSpace){ra.fromWorkingColorSpace(O_(this,Rn),t);let i=Rn.r,r=Rn.g,n=Rn.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-i)/u+2;break;case n:o=(i-r)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=ra.workingColorSpace){return ra.fromWorkingColorSpace(O_(this,Rn),t),e.r=Rn.r,e.g=Rn.g,e.b=Rn.b,e}getStyle(e=yc){return ra.fromWorkingColorSpace(O_(this,Rn),e),e!==yc?`color(${e} ${Rn.r} ${Rn.g} ${Rn.b})`:`rgb(${Rn.r*255|0},${Rn.g*255|0},${Rn.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(hl),hl.h+=e,hl.s+=t,hl.l+=i,this.setHSL(hl.h,hl.s,hl.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(hl),e.getHSL(I_);let i=Z1(hl.h,I_.h,t),r=Z1(hl.s,I_.s,t),n=Z1(hl.l,I_.l,t);return this.setHSL(i,r,n),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Yt.NAMES=zJ;var km,BJ=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{km===void 0&&(km=Vx("canvas")),km.width=e.width,km.height=e.height;let i=km.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=km}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=Vx("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=zf(n[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(zf(t[i]/255)*255):t[i]=zf(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},kJ=class{constructor(t=null){this.isSource=!0,this.uuid=Jo(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(fD(n[a].image)):s.push(fD(n[a]))}else s=fD(n);r.url=s}return i||(t.images[this.uuid]=r),r}};function fD(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?BJ.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var ove=0,Fr=class extends Ts{constructor(e=Fr.DEFAULT_IMAGE,t=Fr.DEFAULT_MAPPING,i=Cr,r=Cr,n=gi,s=t0,a=Rr,o=Js,l=Fr.DEFAULT_ANISOTROPY,c=jl){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ove++}),this.uuid=Jo(),this.name="",this.source=new kJ(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new ve(0,0),this.repeat=new ve(1,1),this.center=new ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Mn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==TJ)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Fu:e.x=e.x-Math.floor(e.x);break;case Cr:e.x=e.x<0?0:1;break;case MI:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Fu:e.y=e.y-Math.floor(e.y);break;case Cr:e.y=e.y<0?0:1;break;case MI:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Fr.DEFAULT_IMAGE=null;Fr.DEFAULT_MAPPING=TJ;Fr.DEFAULT_ANISOTROPY=1;var li=class{constructor(e=0,t=0,i=0,r=1){li.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,n,s=e.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(a+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let m=(a+1)/2,g=(u+1)/2,y=(f+1)/2,x=(o+c)/4,_=(l+d)/4,M=(h+p)/4;return m>g&&m>y?m<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(m),r=x/i,n=_/i):g>y?g<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(g),i=x/r,n=M/r):y<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(y),i=_/n,r=M/n),this.set(i,r,n,t),this}let v=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(v)<.001&&(v=1),this.x=(p-h)/v,this.y=(l-d)/v,this.z=(c-o)/v,this.w=Math.acos((a+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Ii=class extends Ts{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new li(0,0,e,t),this.scissorTest=!1,this.viewport=new li(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new Fr(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:gi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new kJ(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},UJ=class extends Fr{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=_i,this.minFilter=_i,this.wrapR=Cr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},lve=class extends Fr{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=_i,this.minFilter=_i,this.wrapR=Cr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},FJ=class extends Ii{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ni=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[s+0],d=n[s+1],p=n[s+2],f=n[s+3];if(a===0){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(a===1){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(u!==f||o!==h||l!==d||c!==p){let v=1-a,m=o*h+l*d+c*p+u*f,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){let _=Math.sqrt(y),M=Math.atan2(_,m*g);v=Math.sin(v*M)/_,a=Math.sin(a*M)/_}let x=a*g;if(o=o*v+h*x,l=l*v+d*x,c=c*v+p*x,u=u*v+f*x,v===1-a){let _=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=_,l*=_,c*=_,u*=_}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=n[s],h=n[s+1],d=n[s+2],p=n[s+3];return e[t]=a*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-a*d,e[t+2]=l*p+c*d+a*h-o*u,e[t+3]=c*p-a*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=o(i/2),d=o(r/2),p=o(n/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(wn(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*e._w+i*e._x+r*e._y+n*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*n+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(n),i*Math.cos(n),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},k=class{constructor(t=0,i=0,r=0){k.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(y6.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(y6.setFromAxisAngle(t,i))}applyMatrix3(t){let i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){let i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=l*i+a*n-o*r,u=l*r+o*i-s*n,h=l*n+s*r-a*i,d=-s*i-a*r-o*n;return this.x=c*l+d*-s+u*-o-h*-a,this.y=u*l+d*-a+h*-s-c*-o,this.z=h*l+d*-o+c*-a-u*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){let r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){let i=t.lengthSq();if(i===0)return this.set(0,0,0);let r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return mD.copy(this).projectOnVector(t),this.sub(mD)}reflect(t){return this.sub(mD.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;let r=this.dot(t)/i;return Math.acos(wn(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){let n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){let i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){let i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,i=Math.random()*Math.PI*2,r=Math.sqrt(1-t**2);return this.x=r*Math.cos(i),this.y=r*Math.sin(i),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},mD=new k,y6=new ni,fn=class{constructor(e=new k(1/0,1/0,1/0),t=new k(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(n,s,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=Mp.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Mp.fromBufferAttribute(n,s).applyMatrix4(e.matrixWorld),this.expandByPoint(Mp)}else i.boundingBox===null&&i.computeBoundingBox(),gD.copy(i.boundingBox),gD.applyMatrix4(e.matrixWorld),this.union(gD);let r=e.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Mp),Mp.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(My),N_.subVectors(this.max,My),Um.subVectors(e.a,My),Fm.subVectors(e.b,My),Vm.subVectors(e.c,My),Th.subVectors(Fm,Um),Ph.subVectors(Vm,Fm),Ep.subVectors(Um,Vm);let t=[0,-Th.z,Th.y,0,-Ph.z,Ph.y,0,-Ep.z,Ep.y,Th.z,0,-Th.x,Ph.z,0,-Ph.x,Ep.z,0,-Ep.x,-Th.y,Th.x,0,-Ph.y,Ph.x,0,-Ep.y,Ep.x,0];return!vD(t,Um,Fm,Vm,N_)||(t=[1,0,0,0,1,0,0,0,1],!vD(t,Um,Fm,Vm,N_))?!1:(z_.crossVectors(Th,Ph),t=[z_.x,z_.y,z_.z],vD(t,Um,Fm,Vm,N_))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Mp.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Mp).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(nu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),nu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),nu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),nu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),nu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),nu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),nu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),nu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(nu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},nu=[new k,new k,new k,new k,new k,new k,new k,new k],Mp=new k,gD=new fn,Um=new k,Fm=new k,Vm=new k,Th=new k,Ph=new k,Ep=new k,My=new k,N_=new k,z_=new k,Ap=new k;function vD(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Ap.fromArray(e,s);let o=n.x*Math.abs(Ap.x)+n.y*Math.abs(Ap.y)+n.z*Math.abs(Ap.z),l=t.dot(Ap),c=i.dot(Ap),u=r.dot(Ap);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var cve=new fn,Ey=new k,yD=new k,Xa=class{constructor(t=new k,i=-1){this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){let r=this.center;i!==void 0?r.copy(i):cve.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){let r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ey.subVectors(t,this.center);let i=Ey.lengthSq();if(i>this.radius*this.radius){let r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(Ey,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(yD.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ey.copy(t.center).add(yD)),this.expandByPoint(Ey.copy(t.center).sub(yD))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},su=new k,xD=new k,B_=new k,Dh=new k,bD=new k,k_=new k,wD=new k,T0=class{constructor(e=new k,t=new k(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,su)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=su.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(su.copy(this.direction).multiplyScalar(t).add(this.origin),su.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){xD.copy(e).add(t).multiplyScalar(.5),B_.copy(t).sub(e).normalize(),Dh.copy(this.origin).sub(xD);let n=e.distanceTo(t)*.5,s=-this.direction.dot(B_),a=Dh.dot(this.direction),o=-Dh.dot(B_),l=Dh.lengthSq(),c=Math.abs(1-s*s),u,h,d,p;if(c>0)if(u=s*o-a,h=s*a-o,p=n*c,u>=0)if(h>=-p)if(h<=p){let f=1/c;u*=f,h*=f,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(B_).multiplyScalar(h).add(xD),d}intersectSphere(e,t){su.subVectors(e.center,this.origin);let i=su.dot(this.direction),r=su.dot(su)-i*i,n=e.radius*e.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(n=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(n=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(a=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,su)!==null}intersectTriangle(e,t,i,r,n){bD.subVectors(t,e),k_.subVectors(i,e),wD.crossVectors(bD,k_);let s=this.direction.dot(wD),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Dh.subVectors(this.origin,e);let o=a*this.direction.dot(k_.crossVectors(Dh,k_));if(o<0)return null;let l=a*this.direction.dot(bD.cross(Dh));if(l<0||o+l>s)return null;let c=-a*Dh.dot(wD);return c<0?null:this.at(c/s,n)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},lt=class{constructor(){lt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m){let g=this.elements;return g[0]=t,g[4]=i,g[8]=r,g[12]=n,g[1]=s,g[5]=a,g[9]=o,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=p,g[7]=f,g[11]=v,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new lt().fromArray(this.elements)}copy(t){let i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){let i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){let i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){let i=this.elements,r=t.elements,n=1/jm.setFromMatrixColumn(t,0).length(),s=1/jm.setFromMatrixColumn(t,1).length(),a=1/jm.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){let i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){let d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+f*c,i[5]=d-v*c,i[9]=-o*l,i[2]=v-d*c,i[6]=f+p*c,i[10]=a*l}else if(t.order==="YXZ"){let d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d+v*o,i[4]=f*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-f,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){let d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d-v*o,i[4]=-a*h,i[8]=f+p*o,i[1]=p+f*o,i[5]=a*u,i[9]=v-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){let d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=f*c-p,i[8]=d*c+v,i[1]=l*h,i[5]=v*c+d,i[9]=p*c-f,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){let d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=v-d*h,i[8]=f*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+f,i[10]=d-v*h}else if(t.order==="XZY"){let d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+v,i[5]=a*u,i[9]=p*h-f,i[2]=f*h-p,i[6]=o*u,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(uve,t,hve)}lookAt(t,i,r){let n=this.elements;return eo.subVectors(t,i),eo.lengthSq()===0&&(eo.z=1),eo.normalize(),Lh.crossVectors(r,eo),Lh.lengthSq()===0&&(Math.abs(r.z)===1?eo.x+=1e-4:eo.z+=1e-4,eo.normalize(),Lh.crossVectors(r,eo)),Lh.normalize(),U_.crossVectors(eo,Lh),n[0]=Lh.x,n[4]=U_.x,n[8]=eo.x,n[1]=Lh.y,n[5]=U_.y,n[9]=eo.y,n[2]=Lh.z,n[6]=U_.z,n[10]=eo.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){let r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],f=r[2],v=r[6],m=r[10],g=r[14],y=r[3],x=r[7],_=r[11],M=r[15],S=n[0],E=n[4],A=n[8],P=n[12],C=n[1],D=n[5],N=n[9],U=n[13],I=n[2],G=n[6],Q=n[10],Y=n[14],O=n[3],V=n[7],F=n[11],W=n[15];return s[0]=a*S+o*C+l*I+c*O,s[4]=a*E+o*D+l*G+c*V,s[8]=a*A+o*N+l*Q+c*F,s[12]=a*P+o*U+l*Y+c*W,s[1]=u*S+h*C+d*I+p*O,s[5]=u*E+h*D+d*G+p*V,s[9]=u*A+h*N+d*Q+p*F,s[13]=u*P+h*U+d*Y+p*W,s[2]=f*S+v*C+m*I+g*O,s[6]=f*E+v*D+m*G+g*V,s[10]=f*A+v*N+m*Q+g*F,s[14]=f*P+v*U+m*Y+g*W,s[3]=y*S+x*C+_*I+M*O,s[7]=y*E+x*D+_*G+M*V,s[11]=y*A+x*N+_*Q+M*F,s[15]=y*P+x*U+_*Y+M*W,this}multiplyScalar(t){let i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){let t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],f=t[3],v=t[7],m=t[11],g=t[15];return f*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*p-r*l*p)+v*(+i*l*p-i*c*d+s*a*d-n*a*p+n*c*u-s*l*u)+m*(+i*c*h-i*o*p-s*a*h+r*a*p+s*o*u-r*c*u)+g*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){let t=this.elements,i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){let n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){let t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],v=t[13],m=t[14],g=t[15],y=h*m*c-v*d*c+v*l*p-o*m*p-h*l*g+o*d*g,x=f*d*c-u*m*c-f*l*p+a*m*p+u*l*g-a*d*g,_=u*v*c-f*h*c+f*o*p-a*v*p-u*o*g+a*h*g,M=f*h*l-u*v*l-f*o*d+a*v*d+u*o*m-a*h*m,S=i*y+r*x+n*_+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let E=1/S;return t[0]=y*E,t[1]=(v*d*s-h*m*s-v*n*p+r*m*p+h*n*g-r*d*g)*E,t[2]=(o*m*s-v*l*s+v*n*c-r*m*c-o*n*g+r*l*g)*E,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*p-r*l*p)*E,t[4]=x*E,t[5]=(u*m*s-f*d*s+f*n*p-i*m*p-u*n*g+i*d*g)*E,t[6]=(f*l*s-a*m*s-f*n*c+i*m*c+a*n*g-i*l*g)*E,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*p+i*l*p)*E,t[8]=_*E,t[9]=(f*h*s-u*v*s-f*r*p+i*v*p+u*r*g-i*h*g)*E,t[10]=(a*v*s-f*o*s+f*r*c-i*v*c-a*r*g+i*o*g)*E,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*p-i*o*p)*E,t[12]=M*E,t[13]=(u*v*n-f*h*n+f*r*d-i*v*d-u*r*m+i*h*m)*E,t[14]=(f*o*n-a*v*n-f*r*l+i*v*l+a*r*m-i*o*m)*E,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*E,this}scale(t){let i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){let i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){let r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){let n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,f=s*h,v=a*u,m=a*h,g=o*h,y=l*c,x=l*u,_=l*h,M=r.x,S=r.y,E=r.z;return n[0]=(1-(v+g))*M,n[1]=(p+_)*M,n[2]=(f-x)*M,n[3]=0,n[4]=(p-_)*S,n[5]=(1-(d+g))*S,n[6]=(m+y)*S,n[7]=0,n[8]=(f+x)*E,n[9]=(m-y)*E,n[10]=(1-(d+v))*E,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){let n=this.elements,s=jm.set(n[0],n[1],n[2]).length(),a=jm.set(n[4],n[5],n[6]).length(),o=jm.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],dl.copy(this);let l=1/s,c=1/a,u=1/o;return dl.elements[0]*=l,dl.elements[1]*=l,dl.elements[2]*=l,dl.elements[4]*=c,dl.elements[5]*=c,dl.elements[6]*=c,dl.elements[8]*=u,dl.elements[9]*=u,dl.elements[10]*=u,i.setFromRotationMatrix(dl),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a){let o=this.elements,l=2*s/(i-t),c=2*s/(r-n),u=(i+t)/(i-t),h=(r+n)/(r-n),d=-(a+s)/(a-s),p=-2*a*s/(a-s);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,i,r,n,s,a){let o=this.elements,l=1/(i-t),c=1/(r-n),u=1/(a-s),h=(i+t)*l,d=(r+n)*c,p=(a+s)*u;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){let i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){let r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}},jm=new k,dl=new lt,uve=new k(0,0,0),hve=new k(1,1,1),Lh=new k,U_=new k,eo=new k,x6=new lt,b6=new ni,kn=class{constructor(e=0,t=0,i=0,r=kn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(wn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-wn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(wn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-wn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(wn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-wn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return x6.makeRotationFromQuaternion(e),this.setFromRotationMatrix(x6,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return b6.setFromEuler(this),this.setFromQuaternion(b6,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};kn.DEFAULT_ORDER="XYZ";var tk=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},dve=0,w6=new k,Hm=new ni,au=new lt,F_=new k,Ay=new k,pve=new k,fve=new ni,_6=new k(1,0,0),S6=new k(0,1,0),M6=new k(0,0,1),mve={type:"added"},E6={type:"removed"},$i=class extends Ts{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dve++}),this.uuid=Jo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=$i.DEFAULT_UP.clone();let e=new k,t=new kn,i=new ni,r=new k(1,1,1);function n(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new lt},normalMatrix:{value:new Mn}}),this.matrix=new lt,this.matrixWorld=new lt,this.matrixAutoUpdate=$i.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=$i.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new tk,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Hm.setFromAxisAngle(e,t),this.quaternion.multiply(Hm),this}rotateOnWorldAxis(e,t){return Hm.setFromAxisAngle(e,t),this.quaternion.premultiply(Hm),this}rotateX(e){return this.rotateOnAxis(_6,e)}rotateY(e){return this.rotateOnAxis(S6,e)}rotateZ(e){return this.rotateOnAxis(M6,e)}translateOnAxis(e,t){return w6.copy(e).applyQuaternion(this.quaternion),this.position.add(w6.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_6,e)}translateY(e){return this.translateOnAxis(S6,e)}translateZ(e){return this.translateOnAxis(M6,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(au.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?F_.copy(e):F_.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),Ay.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?au.lookAt(Ay,F_,this.up):au.lookAt(F_,Ay,this.up),this.quaternion.setFromRotationMatrix(au),r&&(au.extractRotation(r.matrixWorld),Hm.setFromRotationMatrix(au),this.quaternion.premultiply(Hm.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(mve)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(E6)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(E6)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),au.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),au.multiply(e.parent.matrixWorld)),e.applyMatrix4(au),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(e,t);if(n!==void 0)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ay,e,pve),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ay,fve,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let n=t[i];(n.matrixWorldAutoUpdate===!0||e===!0)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(e.shapes,u)}else n(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(e.materials,this.material[o]));r.material=a}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(e.animations,o))}}if(t){let a=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};$i.DEFAULT_UP=new k(0,1,0);$i.DEFAULT_MATRIX_AUTO_UPDATE=!0;$i.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var pl=new k,ou=new k,_D=new k,lu=new k,Gm=new k,Wm=new k,A6=new k,SD=new k,MD=new k,ED=new k,ws=class{constructor(t=new k,i=new k,r=new k){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),pl.subVectors(t,i),n.cross(pl);let s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){pl.subVectors(n,i),ou.subVectors(r,i),_D.subVectors(t,i);let a=pl.dot(pl),o=pl.dot(ou),l=pl.dot(_D),c=ou.dot(ou),u=ou.dot(_D),h=a*c-o*o;if(h===0)return s.set(-2,-1,-1);let d=1/h,p=(c*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,lu),lu.x>=0&&lu.y>=0&&lu.x+lu.y<=1}static getUV(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,lu),l.set(0,0),l.addScaledVector(s,lu.x),l.addScaledVector(a,lu.y),l.addScaledVector(o,lu.z),l}static isFrontFacing(t,i,r,n){return pl.subVectors(r,i),ou.subVectors(t,i),pl.cross(ou).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return pl.subVectors(this.c,this.b),ou.subVectors(this.a,this.b),pl.cross(ou).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ws.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return ws.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,r,n,s){return ws.getUV(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return ws.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ws.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){let r=this.a,n=this.b,s=this.c,a,o;Gm.subVectors(n,r),Wm.subVectors(s,r),SD.subVectors(t,r);let l=Gm.dot(SD),c=Wm.dot(SD);if(l<=0&&c<=0)return i.copy(r);MD.subVectors(t,n);let u=Gm.dot(MD),h=Wm.dot(MD);if(u>=0&&h<=u)return i.copy(n);let d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(Gm,a);ED.subVectors(t,s);let p=Gm.dot(ED),f=Wm.dot(ED);if(f>=0&&p<=f)return i.copy(s);let v=p*c-l*f;if(v<=0&&c>=0&&f<=0)return o=c/(c-f),i.copy(r).addScaledVector(Wm,o);let m=u*f-p*h;if(m<=0&&h-u>=0&&p-f>=0)return A6.subVectors(s,n),o=(h-u)/(h-u+(p-f)),i.copy(n).addScaledVector(A6,o);let g=1/(m+v+d);return a=v*g,o=d*g,i.copy(r).addScaledVector(Gm,a).addScaledVector(Wm,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},gve=0,Wb=class extends Ts{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:gve++}),this.uuid=Jo(),this.name="",this.type="Material",this.blending=If,this.side=Vl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=EJ,this.blendDst=AJ,this.blendEquation=Ug,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=wI,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Gge,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=uD,this.stencilZFail=uD,this.stencilZPass=uD,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==If&&(i.blending=this.blending),this.side!==Vl&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(t){let n=r(e.textures),s=r(e.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},ah=class extends Wb{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Yt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=CJ,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},yn=new k,V_=new ve,Zt=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=EI,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)V_.fromBufferAttribute(this,t),V_.applyMatrix3(e),this.setXY(t,V_.x,V_.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)yn.fromBufferAttribute(this,t),yn.applyMatrix3(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)yn.fromBufferAttribute(this,t),yn.applyMatrix4(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)yn.fromBufferAttribute(this,t),yn.applyNormalMatrix(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)yn.fromBufferAttribute(this,t),yn.transformDirection(e),this.setXYZ(t,yn.x,yn.y,yn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ju(t,this.array)),t}setX(e,t){return this.normalized&&(t=mr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ju(t,this.array)),t}setY(e,t){return this.normalized&&(t=mr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ju(t,this.array)),t}setZ(e,t){return this.normalized&&(t=mr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ju(t,this.array)),t}setW(e,t){return this.normalized&&(t=mr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=mr(t,this.array),i=mr(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=mr(t,this.array),i=mr(i,this.array),r=mr(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e*=this.itemSize,this.normalized&&(t=mr(t,this.array),i=mr(i,this.array),r=mr(r,this.array),n=mr(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==EI&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},VJ=class extends Zt{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Dv=class extends Zt{constructor(e,t,i){super(new Uint32Array(e),t,i)}},_t=class extends Zt{constructor(e,t,i){super(new Float32Array(e),t,i)}},vve=0,Lo=new lt,AD=new $i,Xm=new k,to=new fn,Cy=new fn,Kn=new k,Bt=class extends Ts{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vve++}),this.uuid=Jo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(NJ(e)?Dv:VJ)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Mn().getNormalMatrix(e);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Lo.makeRotationFromQuaternion(e),this.applyMatrix4(Lo),this}rotateX(e){return Lo.makeRotationX(e),this.applyMatrix4(Lo),this}rotateY(e){return Lo.makeRotationY(e),this.applyMatrix4(Lo),this}rotateZ(e){return Lo.makeRotationZ(e),this.applyMatrix4(Lo),this}translate(e,t,i){return Lo.makeTranslation(e,t,i),this.applyMatrix4(Lo),this}scale(e,t,i){return Lo.makeScale(e,t,i),this.applyMatrix4(Lo),this}lookAt(e){return AD.lookAt(e),AD.updateMatrix(),this.applyMatrix4(AD.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xm).negate(),this.translate(Xm.x,Xm.y,Xm.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new _t(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new fn);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new k(-1/0,-1/0,-1/0),new k(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let n=t[i];to.setFromBufferAttribute(n),this.morphTargetsRelative?(Kn.addVectors(this.boundingBox.min,to.min),this.boundingBox.expandByPoint(Kn),Kn.addVectors(this.boundingBox.max,to.max),this.boundingBox.expandByPoint(Kn)):(this.boundingBox.expandByPoint(to.min),this.boundingBox.expandByPoint(to.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xa);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new k,1/0);return}if(e){let i=this.boundingSphere.center;if(to.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let a=t[n];Cy.setFromBufferAttribute(a),this.morphTargetsRelative?(Kn.addVectors(to.min,Cy.min),to.expandByPoint(Kn),Kn.addVectors(to.max,Cy.max),to.expandByPoint(Kn)):(to.expandByPoint(Cy.min),to.expandByPoint(Cy.max))}to.getCenter(i);let r=0;for(let n=0,s=e.count;n<s;n++)Kn.fromBufferAttribute(e,n),r=Math.max(r,i.distanceToSquared(Kn));if(t)for(let n=0,s=t.length;n<s;n++){let a=t[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)Kn.fromBufferAttribute(a,l),o&&(Xm.fromBufferAttribute(e,l),Kn.add(Xm)),r=Math.max(r,i.distanceToSquared(Kn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,n=t.normal.array,s=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Zt(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let P=0;P<a;P++)l[P]=new k,c[P]=new k;let u=new k,h=new k,d=new k,p=new ve,f=new ve,v=new ve,m=new k,g=new k;function y(P,C,D){u.fromArray(r,P*3),h.fromArray(r,C*3),d.fromArray(r,D*3),p.fromArray(s,P*2),f.fromArray(s,C*2),v.fromArray(s,D*2),h.sub(u),d.sub(u),f.sub(p),v.sub(p);let N=1/(f.x*v.y-v.x*f.y);!isFinite(N)||(m.copy(h).multiplyScalar(v.y).addScaledVector(d,-f.y).multiplyScalar(N),g.copy(d).multiplyScalar(f.x).addScaledVector(h,-v.x).multiplyScalar(N),l[P].add(m),l[C].add(m),l[D].add(m),c[P].add(g),c[C].add(g),c[D].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let P=0,C=x.length;P<C;++P){let D=x[P],N=D.start,U=D.count;for(let I=N,G=N+U;I<G;I+=3)y(i[I+0],i[I+1],i[I+2])}let _=new k,M=new k,S=new k,E=new k;function A(P){S.fromArray(n,P*3),E.copy(S);let C=l[P];_.copy(C),_.sub(S.multiplyScalar(S.dot(C))).normalize(),M.crossVectors(E,C);let D=M.dot(c[P])<0?-1:1;o[P*4]=_.x,o[P*4+1]=_.y,o[P*4+2]=_.z,o[P*4+3]=D}for(let P=0,C=x.length;P<C;++P){let D=x[P],N=D.start,U=D.count;for(let I=N,G=N+U;I<G;I+=3)A(i[I+0]),A(i[I+1]),A(i[I+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Zt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new k,n=new k,s=new k,a=new k,o=new k,l=new k,c=new k,u=new k;if(e)for(let h=0,d=e.count;h<d;h+=3){let p=e.getX(h+0),f=e.getX(h+1),v=e.getX(h+2);r.fromBufferAttribute(t,p),n.fromBufferAttribute(t,f),s.fromBufferAttribute(t,v),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),a.fromBufferAttribute(i,p),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,v),a.add(c),o.add(c),l.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(v,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)r.fromBufferAttribute(t,h+0),n.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Kn.fromBufferAttribute(e,t),Kn.normalize(),e.setXYZ(t,Kn.x,Kn.y,Kn.z)}toNonIndexed(){function e(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,p=0;for(let f=0,v=o.length;f<v;f++){a.isInterleavedBufferAttribute?d=o[f]*a.data.stride+a.offset:d=o[f]*c;for(let m=0;m<c;m++)h[p++]=l[d++]}return new Zt(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Bt,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=e(o,i);t.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=e(h,i);o.push(d)}t.morphAttributes[a]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(e.data))}c.length>0&&(r[o]=c,n=!0)}n&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(t))}let n=e.morphAttributes;for(let l in n){let c=[],u=n[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},C6=new lt,qm=new T0,CD=new Xa,Ty=new k,Py=new k,Dy=new k,TD=new k,j_=new k,H_=new ve,G_=new ve,W_=new ve,PD=new k,X_=new k,gr=class extends $i{constructor(e=new Bt,t=new ah){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let a=this.morphTargetInfluences;if(n&&a){j_.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(TD.fromBufferAttribute(u,e),s?j_.addScaledVector(TD,c):j_.addScaledVector(TD.sub(t),c))}t.add(j_)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),CD.copy(i.boundingSphere),CD.applyMatrix4(n),e.ray.intersectsSphere(CD)===!1)||(C6.copy(n).invert(),qm.copy(e.ray).applyMatrix4(C6),i.boundingBox!==null&&qm.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],v=r[f.materialIndex],m=Math.max(f.start,h.start),g=Math.min(a.count,Math.min(f.start+f.count,h.start+h.count));for(let y=m,x=g;y<x;y+=3){let _=a.getX(y),M=a.getX(y+1),S=a.getX(y+2);s=q_(this,v,e,qm,l,c,_,M,S),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(a.count,h.start+h.count);for(let f=d,v=p;f<v;f+=3){let m=a.getX(f),g=a.getX(f+1),y=a.getX(f+2);s=q_(this,r,e,qm,l,c,m,g,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],v=r[f.materialIndex],m=Math.max(f.start,h.start),g=Math.min(o.count,Math.min(f.start+f.count,h.start+h.count));for(let y=m,x=g;y<x;y+=3){let _=y,M=y+1,S=y+2;s=q_(this,v,e,qm,l,c,_,M,S),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let f=d,v=p;f<v;f+=3){let m=f,g=f+1,y=f+2;s=q_(this,r,e,qm,l,c,m,g,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}}};function yve(e,t,i,r,n,s,a,o){let l;if(t.side===os?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===Vl,o),l===null)return null;X_.copy(o),X_.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(X_);return c<i.near||c>i.far?null:{distance:c,point:X_.clone(),object:e}}function q_(e,t,i,r,n,s,a,o,l){e.getVertexPosition(a,Ty),e.getVertexPosition(o,Py),e.getVertexPosition(l,Dy);let c=yve(e,t,i,r,Ty,Py,Dy,PD);if(c){n&&(H_.fromBufferAttribute(n,a),G_.fromBufferAttribute(n,o),W_.fromBufferAttribute(n,l),c.uv=ws.getUV(PD,Ty,Py,Dy,H_,G_,W_,new ve)),s&&(H_.fromBufferAttribute(s,a),G_.fromBufferAttribute(s,o),W_.fromBufferAttribute(s,l),c.uv2=ws.getUV(PD,Ty,Py,Dy,H_,G_,W_,new ve));let u={a,b:o,c:l,normal:new k,materialIndex:0};ws.getNormal(Ty,Py,Dy,u.normal),c.face=u}return c}var Hl=class extends Bt{constructor(e=1,t=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;p("z","y","x",-1,-1,i,t,e,s,n,0),p("z","y","x",1,-1,i,t,-e,s,n,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,n,4),p("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new _t(l,3)),this.setAttribute("normal",new _t(c,3)),this.setAttribute("uv",new _t(u,2));function p(f,v,m,g,y,x,_,M,S,E,A){let P=x/S,C=_/E,D=x/2,N=_/2,U=M/2,I=S+1,G=E+1,Q=0,Y=0,O=new k;for(let V=0;V<G;V++){let F=V*C-N;for(let W=0;W<I;W++){let ee=W*P-D;O[f]=ee*g,O[v]=F*y,O[m]=U,l.push(O.x,O.y,O.z),O[f]=0,O[v]=0,O[m]=M>0?1:-1,c.push(O.x,O.y,O.z),u.push(W/S),u.push(1-V/E),Q+=1}}for(let V=0;V<E;V++)for(let F=0;F<S;F++){let W=h+F+I*V,ee=h+F+I*(V+1),ae=h+(F+1)+I*(V+1),K=h+(F+1)+I*V;o.push(W,ee,K),o.push(ee,ae,K),Y+=6}a.addGroup(d,Y,A),d+=Y,h+=Q}}static fromJSON(e){return new Hl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function i0(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function la(e){let t={};for(let i=0;i<e.length;i++){let r=i0(e[i]);for(let n in r)t[n]=r[n]}return t}function xve(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function jJ(e){return e.getRenderTarget()===null&&e.outputEncoding===fi?yc:MA}var P0={clone:i0,merge:la},bve=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,wve=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Oi=class extends Wb{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=bve,this.fragmentShader=wve,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=i0(e.uniforms),this.uniformsGroups=xve(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?t.uniforms[r]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[r]={type:"m4",value:n.toArray()}:t.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},op=class extends $i{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new lt,this.projectionMatrix=new lt,this.projectionMatrixInverse=new lt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Hs=class extends op{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=Fx*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Y1*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Fx*2*Math.atan(Math.tan(Y1*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,n,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Y1*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Ym=-90,Zm=1,_ve=class extends $i{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Hs(Ym,Zm,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new Hs(Ym,Zm,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new Hs(Ym,Zm,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new Hs(Ym,Zm,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new Hs(Ym,Zm,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Hs(Ym,Zm,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=zc,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,n),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},ik=class extends Fr{constructor(e,t,i,r,n,s,a,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:Zf,super(e,t,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},Sve=class extends Ii{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new ik(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:gi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Hl(5,5,5),n=new Oi({name:"CubemapFromEquirect",uniforms:i0(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:os,blending:Tn});n.uniforms.tEquirect.value=t;let s=new gr(r,n),a=t.minFilter;return t.minFilter===t0&&(t.minFilter=gi),new _ve(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let n=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(n)}},DD=new k,Mve=new k,Eve=new Mn,Na=class{constructor(e=new k(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=DD.subVectors(i,t).cross(Mve.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(DD),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let n=-(e.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:t.copy(i).multiplyScalar(n).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||Eve.getNormalMatrix(e),r=this.coplanarPoint(DD).applyMatrix4(e),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Qm=new Xa,Y_=new k,rk=class{constructor(e=new Na,t=new Na,i=new Na,r=new Na,n=new Na,s=new Na){this.planes=[e,t,i,r,n,s]}set(e,t,i,r,n,s){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],v=i[12],m=i[13],g=i[14],y=i[15];return t[0].setComponents(a-r,u-o,f-h,y-v).normalize(),t[1].setComponents(a+r,u+o,f+h,y+v).normalize(),t[2].setComponents(a+n,u+l,f+d,y+m).normalize(),t[3].setComponents(a-n,u-l,f-d,y-m).normalize(),t[4].setComponents(a-s,u-c,f-p,y-g).normalize(),t[5].setComponents(a+s,u+c,f+p,y+g).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Qm.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Qm)}intersectsSprite(e){return Qm.center.set(0,0,0),Qm.radius=.7071067811865476,Qm.applyMatrix4(e.matrixWorld),this.intersectsSphere(Qm)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let n=0;n<6;n++)if(t[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(Y_.x=r.normal.x>0?e.max.x:e.min.x,Y_.y=r.normal.y>0?e.max.y:e.min.y,Y_.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Y_)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function HJ(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function Ave(e,t){let i=t.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,d),c.onUploadCallback();let f;if(h instanceof Float32Array)f=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(h instanceof Int16Array)f=5122;else if(h instanceof Uint32Array)f=5125;else if(h instanceof Int32Array)f=5124;else if(h instanceof Int8Array)f=5120;else if(h instanceof Uint8Array)f=5121;else if(h instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:f,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,p=u.updateRange;e.bindBuffer(h,c),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var Hc=class extends Bt{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let n=e/2,s=t/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=e/a,h=t/o,d=[],p=[],f=[],v=[];for(let m=0;m<c;m++){let g=m*h-s;for(let y=0;y<l;y++){let x=y*u-n;p.push(x,-g,0),f.push(0,0,1),v.push(y/a),v.push(1-m/o)}}for(let m=0;m<o;m++)for(let g=0;g<a;g++){let y=g+l*m,x=g+l*(m+1),_=g+1+l*(m+1),M=g+1+l*m;d.push(y,x,M),d.push(x,_,M)}this.setIndex(d),this.setAttribute("position",new _t(p,3)),this.setAttribute("normal",new _t(f,3)),this.setAttribute("uv",new _t(v,2))}static fromJSON(e){return new Hc(e.width,e.height,e.widthSegments,e.heightSegments)}},Cve=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Tve=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Pve=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,Dve=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Lve=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Rve=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Ive="vec3 transformed = vec3( position );",Ove=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Nve=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,zve=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Bve=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,kve=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Uve=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Fve=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Vve=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,jve=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Hve=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Gve=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Wve=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Xve=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,qve=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Yve=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Zve=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Qve=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Kve=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Jve=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,$ve="gl_FragColor = linearToOutputTexel( gl_FragColor );",e0e=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,t0e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,i0e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,r0e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,n0e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,s0e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,a0e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,o0e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,l0e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,c0e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,u0e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,h0e=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,d0e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,p0e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,f0e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,m0e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,g0e=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,v0e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,y0e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,x0e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,b0e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,w0e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,_0e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,S0e=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,M0e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,E0e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,A0e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,C0e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,T0e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,P0e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,D0e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,L0e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,R0e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,I0e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,O0e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,N0e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,z0e=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,B0e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,k0e=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,U0e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,F0e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,V0e=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,j0e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,H0e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,G0e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,W0e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,X0e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,q0e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,Y0e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Z0e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Q0e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,K0e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,J0e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,$0e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,eye=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,tye=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,iye=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,rye=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,nye=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,sye=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,aye=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,oye=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,lye=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cye=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,uye=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,hye=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,dye=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,pye=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,fye=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,mye=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,gye=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,vye=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,yye=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,xye=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,bye=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,wye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,_ye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,Sye=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,Mye=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,Eye=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Aye=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Cye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Tye=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Pye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Dye=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Lye=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Rye=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Iye=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Oye=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Nye=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,zye=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Bye=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,kye=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Uye=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Fye=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vye=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,jye=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Hye=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Gye=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Wye=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Xye=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,qye=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Yye=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Zye=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Qye=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Kye=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Jye=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$ye=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,e1e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,t1e=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,i1e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,r1e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,n1e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,mi={alphamap_fragment:Cve,alphamap_pars_fragment:Tve,alphatest_fragment:Pve,alphatest_pars_fragment:Dve,aomap_fragment:Lve,aomap_pars_fragment:Rve,begin_vertex:Ive,beginnormal_vertex:Ove,bsdfs:Nve,iridescence_fragment:zve,bumpmap_pars_fragment:Bve,clipping_planes_fragment:kve,clipping_planes_pars_fragment:Uve,clipping_planes_pars_vertex:Fve,clipping_planes_vertex:Vve,color_fragment:jve,color_pars_fragment:Hve,color_pars_vertex:Gve,color_vertex:Wve,common:Xve,cube_uv_reflection_fragment:qve,defaultnormal_vertex:Yve,displacementmap_pars_vertex:Zve,displacementmap_vertex:Qve,emissivemap_fragment:Kve,emissivemap_pars_fragment:Jve,encodings_fragment:$ve,encodings_pars_fragment:e0e,envmap_fragment:t0e,envmap_common_pars_fragment:i0e,envmap_pars_fragment:r0e,envmap_pars_vertex:n0e,envmap_physical_pars_fragment:g0e,envmap_vertex:s0e,fog_vertex:a0e,fog_pars_vertex:o0e,fog_fragment:l0e,fog_pars_fragment:c0e,gradientmap_pars_fragment:u0e,lightmap_fragment:h0e,lightmap_pars_fragment:d0e,lights_lambert_fragment:p0e,lights_lambert_pars_fragment:f0e,lights_pars_begin:m0e,lights_toon_fragment:v0e,lights_toon_pars_fragment:y0e,lights_phong_fragment:x0e,lights_phong_pars_fragment:b0e,lights_physical_fragment:w0e,lights_physical_pars_fragment:_0e,lights_fragment_begin:S0e,lights_fragment_maps:M0e,lights_fragment_end:E0e,logdepthbuf_fragment:A0e,logdepthbuf_pars_fragment:C0e,logdepthbuf_pars_vertex:T0e,logdepthbuf_vertex:P0e,map_fragment:D0e,map_pars_fragment:L0e,map_particle_fragment:R0e,map_particle_pars_fragment:I0e,metalnessmap_fragment:O0e,metalnessmap_pars_fragment:N0e,morphcolor_vertex:z0e,morphnormal_vertex:B0e,morphtarget_pars_vertex:k0e,morphtarget_vertex:U0e,normal_fragment_begin:F0e,normal_fragment_maps:V0e,normal_pars_fragment:j0e,normal_pars_vertex:H0e,normal_vertex:G0e,normalmap_pars_fragment:W0e,clearcoat_normal_fragment_begin:X0e,clearcoat_normal_fragment_maps:q0e,clearcoat_pars_fragment:Y0e,iridescence_pars_fragment:Z0e,output_fragment:Q0e,packing:K0e,premultiplied_alpha_fragment:J0e,project_vertex:$0e,dithering_fragment:eye,dithering_pars_fragment:tye,roughnessmap_fragment:iye,roughnessmap_pars_fragment:rye,shadowmap_pars_fragment:nye,shadowmap_pars_vertex:sye,shadowmap_vertex:aye,shadowmask_pars_fragment:oye,skinbase_vertex:lye,skinning_pars_vertex:cye,skinning_vertex:uye,skinnormal_vertex:hye,specularmap_fragment:dye,specularmap_pars_fragment:pye,tonemapping_fragment:fye,tonemapping_pars_fragment:mye,transmission_fragment:gye,transmission_pars_fragment:vye,uv_pars_fragment:yye,uv_pars_vertex:xye,uv_vertex:bye,uv2_pars_fragment:wye,uv2_pars_vertex:_ye,uv2_vertex:Sye,worldpos_vertex:Mye,background_vert:Eye,background_frag:Aye,backgroundCube_vert:Cye,backgroundCube_frag:Tye,cube_vert:Pye,cube_frag:Dye,depth_vert:Lye,depth_frag:Rye,distanceRGBA_vert:Iye,distanceRGBA_frag:Oye,equirect_vert:Nye,equirect_frag:zye,linedashed_vert:Bye,linedashed_frag:kye,meshbasic_vert:Uye,meshbasic_frag:Fye,meshlambert_vert:Vye,meshlambert_frag:jye,meshmatcap_vert:Hye,meshmatcap_frag:Gye,meshnormal_vert:Wye,meshnormal_frag:Xye,meshphong_vert:qye,meshphong_frag:Yye,meshphysical_vert:Zye,meshphysical_frag:Qye,meshtoon_vert:Kye,meshtoon_frag:Jye,points_vert:$ye,points_frag:e1e,shadow_vert:t1e,shadow_frag:i1e,sprite_vert:r1e,sprite_frag:n1e},xt={common:{diffuse:{value:new Yt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Mn},uv2Transform:{value:new Mn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Yt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Mn}},sprite:{diffuse:{value:new Yt(16777215)},opacity:{value:1},center:{value:new ve(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Mn}}},bc={basic:{uniforms:la([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.fog]),vertexShader:mi.meshbasic_vert,fragmentShader:mi.meshbasic_frag},lambert:{uniforms:la([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)}}]),vertexShader:mi.meshlambert_vert,fragmentShader:mi.meshlambert_frag},phong:{uniforms:la([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)},specular:{value:new Yt(1118481)},shininess:{value:30}}]),vertexShader:mi.meshphong_vert,fragmentShader:mi.meshphong_frag},standard:{uniforms:la([xt.common,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.roughnessmap,xt.metalnessmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:mi.meshphysical_vert,fragmentShader:mi.meshphysical_frag},toon:{uniforms:la([xt.common,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.gradientmap,xt.fog,xt.lights,{emissive:{value:new Yt(0)}}]),vertexShader:mi.meshtoon_vert,fragmentShader:mi.meshtoon_frag},matcap:{uniforms:la([xt.common,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,{matcap:{value:null}}]),vertexShader:mi.meshmatcap_vert,fragmentShader:mi.meshmatcap_frag},points:{uniforms:la([xt.points,xt.fog]),vertexShader:mi.points_vert,fragmentShader:mi.points_frag},dashed:{uniforms:la([xt.common,xt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:mi.linedashed_vert,fragmentShader:mi.linedashed_frag},depth:{uniforms:la([xt.common,xt.displacementmap]),vertexShader:mi.depth_vert,fragmentShader:mi.depth_frag},normal:{uniforms:la([xt.common,xt.bumpmap,xt.normalmap,xt.displacementmap,{opacity:{value:1}}]),vertexShader:mi.meshnormal_vert,fragmentShader:mi.meshnormal_frag},sprite:{uniforms:la([xt.sprite,xt.fog]),vertexShader:mi.sprite_vert,fragmentShader:mi.sprite_frag},background:{uniforms:{uvTransform:{value:new Mn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:mi.background_vert,fragmentShader:mi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:mi.backgroundCube_vert,fragmentShader:mi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:mi.cube_vert,fragmentShader:mi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:mi.equirect_vert,fragmentShader:mi.equirect_frag},distanceRGBA:{uniforms:la([xt.common,xt.displacementmap,{referencePosition:{value:new k},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:mi.distanceRGBA_vert,fragmentShader:mi.distanceRGBA_frag},shadow:{uniforms:la([xt.lights,xt.fog,{color:{value:new Yt(0)},opacity:{value:1}}]),vertexShader:mi.shadow_vert,fragmentShader:mi.shadow_frag}};bc.physical={uniforms:la([bc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ve(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Yt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ve},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Yt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Yt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:mi.meshphysical_vert,fragmentShader:mi.meshphysical_frag};var Z_={r:0,b:0,g:0};function s1e(e,t,i,r,n,s,a){let o=new Yt(0),l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(m,g){let y=!1,x=g.isScene===!0?g.background:null;x&&x.isTexture&&(x=(g.backgroundBlurriness>0?i:t).get(x));let _=e.xr,M=_.getSession&&_.getSession();M&&M.environmentBlendMode==="additive"&&(x=null),x===null?v(o,l):x&&x.isColor&&(v(x,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Gb)?(u===void 0&&(u=new gr(new Hl(1,1,1),new Oi({name:"BackgroundCubeMaterial",uniforms:i0(bc.backgroundCube.uniforms),vertexShader:bc.backgroundCube.vertexShader,fragmentShader:bc.backgroundCube.fragmentShader,side:os,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(S,E,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.toneMapped=x.encoding!==fi,(h!==x||d!==x.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=x,d=x.version,p=e.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new gr(new Hc(2,2),new Oi({name:"BackgroundMaterial",uniforms:i0(bc.background.uniforms),vertexShader:bc.background.vertexShader,fragmentShader:bc.background.fragmentShader,side:Vl,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=x.encoding!==fi,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||d!==x.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=x,d=x.version,p=e.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function v(m,g){m.getRGB(Z_,jJ(e)),r.buffers.color.setClear(Z_.r,Z_.g,Z_.b,g,a)}return{getClearColor:function(){return o},setClearColor:function(m,g=1){o.set(m),l=g,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,v(o,l)},render:f}}function a1e(e,t,i,r){let n=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=m(null),c=l,u=!1;function h(I,G,Q,Y,O){let V=!1;if(a){let F=v(Y,Q,G);c!==F&&(c=F,p(c.object)),V=g(I,Y,Q,O),V&&y(I,Y,Q,O)}else{let F=G.wireframe===!0;(c.geometry!==Y.id||c.program!==Q.id||c.wireframe!==F)&&(c.geometry=Y.id,c.program=Q.id,c.wireframe=F,V=!0)}O!==null&&i.update(O,34963),(V||u)&&(u=!1,A(I,G,Q,Y),O!==null&&e.bindBuffer(34963,i.get(O).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(I){return r.isWebGL2?e.bindVertexArray(I):s.bindVertexArrayOES(I)}function f(I){return r.isWebGL2?e.deleteVertexArray(I):s.deleteVertexArrayOES(I)}function v(I,G,Q){let Y=Q.wireframe===!0,O=o[I.id];O===void 0&&(O={},o[I.id]=O);let V=O[G.id];V===void 0&&(V={},O[G.id]=V);let F=V[Y];return F===void 0&&(F=m(d()),V[Y]=F),F}function m(I){let G=[],Q=[],Y=[];for(let O=0;O<n;O++)G[O]=0,Q[O]=0,Y[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:G,enabledAttributes:Q,attributeDivisors:Y,object:I,attributes:{},index:null}}function g(I,G,Q,Y){let O=c.attributes,V=G.attributes,F=0,W=Q.getAttributes();for(let ee in W)if(W[ee].location>=0){let ae=O[ee],K=V[ee];if(K===void 0&&(ee==="instanceMatrix"&&I.instanceMatrix&&(K=I.instanceMatrix),ee==="instanceColor"&&I.instanceColor&&(K=I.instanceColor)),ae===void 0||ae.attribute!==K||K&&ae.data!==K.data)return!0;F++}return c.attributesNum!==F||c.index!==Y}function y(I,G,Q,Y){let O={},V=G.attributes,F=0,W=Q.getAttributes();for(let ee in W)if(W[ee].location>=0){let ae=V[ee];ae===void 0&&(ee==="instanceMatrix"&&I.instanceMatrix&&(ae=I.instanceMatrix),ee==="instanceColor"&&I.instanceColor&&(ae=I.instanceColor));let K={};K.attribute=ae,ae&&ae.data&&(K.data=ae.data),O[ee]=K,F++}c.attributes=O,c.attributesNum=F,c.index=Y}function x(){let I=c.newAttributes;for(let G=0,Q=I.length;G<Q;G++)I[G]=0}function _(I){M(I,0)}function M(I,G){let Q=c.newAttributes,Y=c.enabledAttributes,O=c.attributeDivisors;Q[I]=1,Y[I]===0&&(e.enableVertexAttribArray(I),Y[I]=1),O[I]!==G&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,G),O[I]=G)}function S(){let I=c.newAttributes,G=c.enabledAttributes;for(let Q=0,Y=G.length;Q<Y;Q++)G[Q]!==I[Q]&&(e.disableVertexAttribArray(Q),G[Q]=0)}function E(I,G,Q,Y,O,V){r.isWebGL2===!0&&(Q===5124||Q===5125)?e.vertexAttribIPointer(I,G,Q,O,V):e.vertexAttribPointer(I,G,Q,Y,O,V)}function A(I,G,Q,Y){if(r.isWebGL2===!1&&(I.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();let O=Y.attributes,V=Q.getAttributes(),F=G.defaultAttributeValues;for(let W in V){let ee=V[W];if(ee.location>=0){let ae=O[W];if(ae===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(ae=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(ae=I.instanceColor)),ae!==void 0){let K=ae.normalized,$=ae.itemSize,ie=i.get(ae);if(ie===void 0)continue;let ye=ie.buffer,pe=ie.type,me=ie.bytesPerElement;if(ae.isInterleavedBufferAttribute){let ge=ae.data,xe=ge.stride,te=ae.offset;if(ge.isInstancedInterleavedBuffer){for(let we=0;we<ee.locationSize;we++)M(ee.location+we,ge.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ge.meshPerAttribute*ge.count)}else for(let we=0;we<ee.locationSize;we++)_(ee.location+we);e.bindBuffer(34962,ye);for(let we=0;we<ee.locationSize;we++)E(ee.location+we,$/ee.locationSize,pe,K,xe*me,(te+$/ee.locationSize*we)*me)}else{if(ae.isInstancedBufferAttribute){for(let ge=0;ge<ee.locationSize;ge++)M(ee.location+ge,ae.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ae.meshPerAttribute*ae.count)}else for(let ge=0;ge<ee.locationSize;ge++)_(ee.location+ge);e.bindBuffer(34962,ye);for(let ge=0;ge<ee.locationSize;ge++)E(ee.location+ge,$/ee.locationSize,pe,K,$*me,$/ee.locationSize*ge*me)}}else if(F!==void 0){let K=F[W];if(K!==void 0)switch(K.length){case 2:e.vertexAttrib2fv(ee.location,K);break;case 3:e.vertexAttrib3fv(ee.location,K);break;case 4:e.vertexAttrib4fv(ee.location,K);break;default:e.vertexAttrib1fv(ee.location,K)}}}}S()}function P(){N();for(let I in o){let G=o[I];for(let Q in G){let Y=G[Q];for(let O in Y)f(Y[O].object),delete Y[O];delete G[Q]}delete o[I]}}function C(I){if(o[I.id]===void 0)return;let G=o[I.id];for(let Q in G){let Y=G[Q];for(let O in Y)f(Y[O].object),delete Y[O];delete G[Q]}delete o[I.id]}function D(I){for(let G in o){let Q=o[G];if(Q[I.id]===void 0)continue;let Y=Q[I.id];for(let O in Y)f(Y[O].object),delete Y[O];delete Q[I.id]}}function N(){U(),u=!0,c!==l&&(c=l,p(c.object))}function U(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:N,resetDefaultState:U,dispose:P,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:x,enableAttribute:_,disableUnusedAttributes:S}}function o1e(e,t,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(n)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function l1e(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let E=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(E){if(E==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";E="mediump"}return E==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),v=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),y=e.getParameter(36349),x=d>0,_=a||t.has("OES_texture_float"),M=x&&_,S=a?e.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:v,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:M,maxSamples:S}}function c1e(e){let t=this,i=null,r=0,n=!1,s=!1,a=new Na,o=new Mn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){let f=h.clippingPlanes,v=h.clipIntersection,m=h.clipShadows,g=e.get(h);if(!n||f===null||f.length===0||s&&!m)s?u(null):c();else{let y=s?0:r,x=y*4,_=g.clippingState||null;l.value=_,_=u(f,d,x,p);for(let M=0;M!==x;++M)_[M]=i[M];g.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){let v=h!==null?h.length:0,m=null;if(v!==0){if(m=l.value,f!==!0||m===null){let g=p+v*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(m===null||m.length<g)&&(m=new Float32Array(g));for(let x=0,_=p;x!==v;++x,_+=4)a.copy(h[x]).applyMatrix4(y,o),a.normal.toArray(m,_),m[_+3]=a.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,m}}function u1e(e){let t=new WeakMap;function i(a,o){return o===_I?a.mapping=Zf:o===SI&&(a.mapping=Qf),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===_I||o===SI)if(t.has(a)){let l=t.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new Sve(l.height/2);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var pT=class extends op{constructor(e=-1,t=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,s=i+e,a=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},pv=4,T6=[.125,.215,.35,.446,.526,.582],sf=20,LD=new pT,P6=new Yt,RD=null,Qp=(1+Math.sqrt(5))/2,Km=1/Qp,D6=[new k(1,1,1),new k(-1,1,1),new k(1,1,-1),new k(-1,1,-1),new k(0,Qp,Km),new k(0,Qp,-Km),new k(Km,0,Qp),new k(-Km,0,Qp),new k(Qp,Km,0),new k(-Qp,Km,0)],L6=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){RD=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(e,i,r,n),t>0&&this._blur(n,0,0,t),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=O6(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=I6(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(RD),e.scissorTest=!1,Q_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Zf||e.mapping===Qf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),RD=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:gi,minFilter:gi,generateMipmaps:!1,type:sh,format:Rr,encoding:jl,depthBuffer:!1},r=R6(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=R6(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=h1e(n)),this._blurMaterial=d1e(n,e,t)}return r}_compileMaterial(e){let t=new gr(this._lodPlanes[0],e);this._renderer.compile(t,LD)}_sceneToCubeUV(e,t,i,r){let n=new Hs(90,1,t,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(P6),o.toneMapping=zc,o.autoClear=!1;let u=new ah({name:"PMREM.Background",side:os,depthWrite:!1,depthTest:!1}),h=new gr(new Hl,u),d=!1,p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(P6),d=!0);for(let f=0;f<6;f++){let v=f%3;v===0?(n.up.set(0,s[f],0),n.lookAt(a[f],0,0)):v===1?(n.up.set(0,0,s[f]),n.lookAt(0,a[f],0)):(n.up.set(0,s[f],0),n.lookAt(0,0,a[f]));let m=this._cubeSize;Q_(r,v*m,f>2?m:0,m,m),o.setRenderTarget(r),d&&o.render(h,n),o.render(e,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===Zf||e.mapping===Qf;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=O6()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=I6());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new gr(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=e;let o=this._cubeSize;Q_(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,LD)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=D6[(r-1)%D6.length];this._blur(e,r-1,r,n,s)}t.autoClear=i}_blur(e,t,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",n),this._halfBlur(s,e,i,i,r,"longitudinal",n)}_halfBlur(e,t,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new gr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*sf-1),f=n/p,v=isFinite(n)?1+Math.floor(c*f):sf;v>sf&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${sf}`);let m=[],g=0;for(let S=0;S<sf;++S){let E=S/f,A=Math.exp(-E*E/2);m.push(A),S===0?g+=A:S<v&&(g+=2*A)}for(let S=0;S<m.length;S++)m[S]=m[S]/g;h.envMap.value=e.texture,h.samples.value=v,h.weights.value=m,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:y}=this;h.dTheta.value=p,h.mipInt.value=y-i;let x=this._sizeLods[r],_=3*x*(r>y-pv?r-y+pv:0),M=4*(this._cubeSize-x);Q_(t,_,M,3*x,2*x),o.setRenderTarget(t),o.render(u,LD)}};function h1e(e){let t=[],i=[],r=[],n=e,s=e-pv+1+T6.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>e-pv?l=T6[a-e+pv-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,v=3,m=2,g=1,y=new Float32Array(v*f*p),x=new Float32Array(m*f*p),_=new Float32Array(g*f*p);for(let S=0;S<p;S++){let E=S%3*2/3-1,A=S>2?0:-1,P=[E,A,0,E+2/3,A,0,E+2/3,A+1,0,E,A,0,E+2/3,A+1,0,E,A+1,0];y.set(P,v*f*S),x.set(d,m*f*S);let C=[S,S,S,S,S,S];_.set(C,g*f*S)}let M=new Bt;M.setAttribute("position",new Zt(y,v)),M.setAttribute("uv",new Zt(x,m)),M.setAttribute("faceIndex",new Zt(_,g)),t.push(M),n>pv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function R6(e,t,i){let r=new Ii(e,t,i);return r.texture.mapping=Gb,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Q_(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function d1e(e,t,i){let r=new Float32Array(sf),n=new k(0,1,0);return new Oi({name:"SphericalGaussianBlur",defines:{n:sf,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:nk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Tn,depthTest:!1,depthWrite:!1})}function I6(){return new Oi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:nk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Tn,depthTest:!1,depthWrite:!1})}function O6(){return new Oi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:nk(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Tn,depthTest:!1,depthWrite:!1})}function nk(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function p1e(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===_I||l===SI,u=l===Zf||l===Qf;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new L6(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new L6(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function f1e(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function m1e(e,t,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",a),delete n[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let f in d)t.update(d[f],34962);let p=h.morphAttributes;for(let f in p){let v=p[f];for(let m=0,g=v.length;m<g;m++)t.update(v[m],34962)}}function c(h){let d=[],p=h.index,f=h.attributes.position,v=0;if(p!==null){let y=p.array;v=p.version;for(let x=0,_=y.length;x<_;x+=3){let M=y[x+0],S=y[x+1],E=y[x+2];d.push(M,S,S,E,E,M)}}else{let y=f.array;v=f.version;for(let x=0,_=y.length/3-1;x<_;x+=3){let M=x+0,S=x+1,E=x+2;d.push(M,S,S,E,E,M)}}let m=new(NJ(d)?Dv:VJ)(d,1);m.version=v;let g=s.get(h);g&&t.remove(g),s.set(h,m)}function u(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function g1e(e,t,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,f){if(f===0)return;let v,m;if(n)v=e,m="drawElementsInstanced";else if(v=t.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",v===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}v[m](s,p,o,d*l,f),i.update(p,s,f)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function v1e(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function y1e(e,t){return e[0]-t[0]}function x1e(e,t){return Math.abs(t[1])-Math.abs(e[1])}function b1e(e,t,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new li,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(t.isWebGL2===!0){let f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,v=f!==void 0?f.length:0,m=s.get(u);if(m===void 0||m.count!==v){let x=function(){I.dispose(),s.delete(u),u.removeEventListener("dispose",x)};m!==void 0&&m.texture.dispose();let _=u.morphAttributes.position!==void 0,M=u.morphAttributes.normal!==void 0,S=u.morphAttributes.color!==void 0,E=u.morphAttributes.position||[],A=u.morphAttributes.normal||[],P=u.morphAttributes.color||[],C=0;_===!0&&(C=1),M===!0&&(C=2),S===!0&&(C=3);let D=u.attributes.position.count*C,N=1;D>t.maxTextureSize&&(N=Math.ceil(D/t.maxTextureSize),D=t.maxTextureSize);let U=new Float32Array(D*N*4*v),I=new UJ(U,D,N,v);I.type=rr,I.needsUpdate=!0;let G=C*4;for(let Q=0;Q<v;Q++){let Y=E[Q],O=A[Q],V=P[Q],F=D*N*4*Q;for(let W=0;W<Y.count;W++){let ee=W*G;_===!0&&(a.fromBufferAttribute(Y,W),U[F+ee+0]=a.x,U[F+ee+1]=a.y,U[F+ee+2]=a.z,U[F+ee+3]=0),M===!0&&(a.fromBufferAttribute(O,W),U[F+ee+4]=a.x,U[F+ee+5]=a.y,U[F+ee+6]=a.z,U[F+ee+7]=0),S===!0&&(a.fromBufferAttribute(V,W),U[F+ee+8]=a.x,U[F+ee+9]=a.y,U[F+ee+10]=a.z,U[F+ee+11]=V.itemSize===4?a.w:1)}}m={count:v,texture:I,size:new ve(D,N)},s.set(u,m),u.addEventListener("dispose",x)}let g=0;for(let x=0;x<p.length;x++)g+=p[x];let y=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",m.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",m.size)}else{let f=p===void 0?0:p.length,v=r[u.id];if(v===void 0||v.length!==f){v=[];for(let _=0;_<f;_++)v[_]=[_,0];r[u.id]=v}for(let _=0;_<f;_++){let M=v[_];M[0]=_,M[1]=p[_]}v.sort(x1e);for(let _=0;_<8;_++)_<f&&v[_][1]?(o[_][0]=v[_][0],o[_][1]=v[_][1]):(o[_][0]=Number.MAX_SAFE_INTEGER,o[_][1]=0);o.sort(y1e);let m=u.morphAttributes.position,g=u.morphAttributes.normal,y=0;for(let _=0;_<8;_++){let M=o[_],S=M[0],E=M[1];S!==Number.MAX_SAFE_INTEGER&&E?(m&&u.getAttribute("morphTarget"+_)!==m[S]&&u.setAttribute("morphTarget"+_,m[S]),g&&u.getAttribute("morphNormal"+_)!==g[S]&&u.setAttribute("morphNormal"+_,g[S]),n[_]=E,y+=E):(m&&u.hasAttribute("morphTarget"+_)===!0&&u.deleteAttribute("morphTarget"+_),g&&u.hasAttribute("morphNormal"+_)===!0&&u.deleteAttribute("morphNormal"+_),n[_]=0)}let x=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function w1e(e,t,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=t.get(l,u);return n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var GJ=new Fr,WJ=new UJ,XJ=new lve,qJ=new ik,N6=[],z6=[],B6=new Float32Array(16),k6=new Float32Array(9),U6=new Float32Array(4);function D0(e,t,i){let r=e[0];if(r==null||r<=0||r>0)return e;let n=t*i,s=N6[n];if(s===void 0&&(s=new Float32Array(n),N6[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function jn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Hn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function fT(e,t){let i=z6[t];i===void 0&&(i=new Int32Array(t),z6[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function _1e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function S1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(jn(i,t))return;e.uniform2fv(this.addr,t),Hn(i,t)}}function M1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(jn(i,t))return;e.uniform3fv(this.addr,t),Hn(i,t)}}function E1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(jn(i,t))return;e.uniform4fv(this.addr,t),Hn(i,t)}}function A1e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(jn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Hn(i,t)}else{if(jn(i,r))return;U6.set(r),e.uniformMatrix2fv(this.addr,!1,U6),Hn(i,r)}}function C1e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(jn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Hn(i,t)}else{if(jn(i,r))return;k6.set(r),e.uniformMatrix3fv(this.addr,!1,k6),Hn(i,r)}}function T1e(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(jn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Hn(i,t)}else{if(jn(i,r))return;B6.set(r),e.uniformMatrix4fv(this.addr,!1,B6),Hn(i,r)}}function P1e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function D1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(jn(i,t))return;e.uniform2iv(this.addr,t),Hn(i,t)}}function L1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(jn(i,t))return;e.uniform3iv(this.addr,t),Hn(i,t)}}function R1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(jn(i,t))return;e.uniform4iv(this.addr,t),Hn(i,t)}}function I1e(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function O1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(jn(i,t))return;e.uniform2uiv(this.addr,t),Hn(i,t)}}function N1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(jn(i,t))return;e.uniform3uiv(this.addr,t),Hn(i,t)}}function z1e(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(jn(i,t))return;e.uniform4uiv(this.addr,t),Hn(i,t)}}function B1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(t||GJ,n)}function k1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||XJ,n)}function U1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||qJ,n)}function F1e(e,t,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||WJ,n)}function V1e(e){switch(e){case 5126:return _1e;case 35664:return S1e;case 35665:return M1e;case 35666:return E1e;case 35674:return A1e;case 35675:return C1e;case 35676:return T1e;case 5124:case 35670:return P1e;case 35667:case 35671:return D1e;case 35668:case 35672:return L1e;case 35669:case 35673:return R1e;case 5125:return I1e;case 36294:return O1e;case 36295:return N1e;case 36296:return z1e;case 35678:case 36198:case 36298:case 36306:case 35682:return B1e;case 35679:case 36299:case 36307:return k1e;case 35680:case 36300:case 36308:case 36293:return U1e;case 36289:case 36303:case 36311:case 36292:return F1e}}function j1e(e,t){e.uniform1fv(this.addr,t)}function H1e(e,t){let i=D0(t,this.size,2);e.uniform2fv(this.addr,i)}function G1e(e,t){let i=D0(t,this.size,3);e.uniform3fv(this.addr,i)}function W1e(e,t){let i=D0(t,this.size,4);e.uniform4fv(this.addr,i)}function X1e(e,t){let i=D0(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function q1e(e,t){let i=D0(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function Y1e(e,t){let i=D0(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Z1e(e,t){e.uniform1iv(this.addr,t)}function Q1e(e,t){e.uniform2iv(this.addr,t)}function K1e(e,t){e.uniform3iv(this.addr,t)}function J1e(e,t){e.uniform4iv(this.addr,t)}function $1e(e,t){e.uniform1uiv(this.addr,t)}function exe(e,t){e.uniform2uiv(this.addr,t)}function txe(e,t){e.uniform3uiv(this.addr,t)}function ixe(e,t){e.uniform4uiv(this.addr,t)}function rxe(e,t,i){let r=this.cache,n=t.length,s=fT(i,n);jn(r,s)||(e.uniform1iv(this.addr,s),Hn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||GJ,s[a])}function nxe(e,t,i){let r=this.cache,n=t.length,s=fT(i,n);jn(r,s)||(e.uniform1iv(this.addr,s),Hn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||XJ,s[a])}function sxe(e,t,i){let r=this.cache,n=t.length,s=fT(i,n);jn(r,s)||(e.uniform1iv(this.addr,s),Hn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||qJ,s[a])}function axe(e,t,i){let r=this.cache,n=t.length,s=fT(i,n);jn(r,s)||(e.uniform1iv(this.addr,s),Hn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||WJ,s[a])}function oxe(e){switch(e){case 5126:return j1e;case 35664:return H1e;case 35665:return G1e;case 35666:return W1e;case 35674:return X1e;case 35675:return q1e;case 35676:return Y1e;case 5124:case 35670:return Z1e;case 35667:case 35671:return Q1e;case 35668:case 35672:return K1e;case 35669:case 35673:return J1e;case 5125:return $1e;case 36294:return exe;case 36295:return txe;case 36296:return ixe;case 35678:case 36198:case 36298:case 36306:case 35682:return rxe;case 35679:case 36299:case 36307:return nxe;case 35680:case 36300:case 36308:case 36293:return sxe;case 36289:case 36303:case 36311:case 36292:return axe}}var lxe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=V1e(t.type)}},cxe=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=oxe(t.type)}},uxe=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){if(t===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(e,t[a.id],i)}}},ID=/(\w+)(\])?(\[|\.)?/g;function F6(e,t){e.seq.push(t),e.map[t.id]=t}function hxe(e,t,i){let r=e.name,n=r.length;for(ID.lastIndex=0;;){let s=ID.exec(r),a=ID.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){F6(i,c===void 0?new lxe(o,e,t):new cxe(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new uxe(o),F6(i,u)),i=u}}}var gE=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let n=e.getActiveUniform(t,r),s=e.getUniformLocation(t,n.name);hxe(n,s,this)}}setValue(e,t,i,r){let n=this.map[t];n!==void 0&&n.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let n=0,s=t.length;n!==s;++n){let a=t[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,n=e.length;r!==n;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function V6(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var dxe=0;function pxe(e,t){let i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function fxe(e){switch(e){case jl:return["Linear","( value )"];case fi:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function j6(e,t,i){let r=e.getShaderParameter(t,35713),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+pxe(e.getShaderSource(t),a)}else return n}function mxe(e,t){let i=fxe(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function gxe(e,t){let i;switch(t){case Sge:i="Linear";break;case Mge:i="Reinhard";break;case Ege:i="OptimizedCineon";break;case Age:i="ACESFilmic";break;case Cge:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function vxe(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(E1).join(`
`)}function yxe(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function xxe(e,t){let i={},r=e.getProgramParameter(t,35721);for(let n=0;n<r;n++){let s=e.getActiveAttrib(t,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function E1(e){return e!==""}function H6(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function G6(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var bxe=/^[ \t]*#include +<([\w\d./]+)>/gm;function PI(e){return e.replace(bxe,wxe)}function wxe(e,t){let i=mi[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return PI(i)}var _xe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function W6(e){return e.replace(_xe,Sxe)}function Sxe(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function X6(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Mxe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===KB?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===tge?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===M1&&(t="SHADOWMAP_TYPE_VSM"),t}function Exe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Zf:case Qf:t="ENVMAP_TYPE_CUBE";break;case Gb:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Axe(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Qf:t="ENVMAP_MODE_REFRACTION";break}return t}function Cxe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case CJ:t="ENVMAP_BLENDING_MULTIPLY";break;case wge:t="ENVMAP_BLENDING_MIX";break;case _ge:t="ENVMAP_BLENDING_ADD";break}return t}function Txe(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function Pxe(e,t,i,r){let n=e.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=Mxe(i),c=Exe(i),u=Axe(i),h=Cxe(i),d=Txe(i),p=i.isWebGL2?"":vxe(i),f=yxe(s),v=n.createProgram(),m,g,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=[f].filter(E1).join(`
`),m.length>0&&(m+=`
`),g=[p,f].filter(E1).join(`
`),g.length>0&&(g+=`
`)):(m=[X6(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(E1).join(`
`),g=[p,X6(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==zc?"#define TONE_MAPPING":"",i.toneMapping!==zc?mi.tonemapping_pars_fragment:"",i.toneMapping!==zc?gxe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",mi.encodings_pars_fragment,mxe("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(E1).join(`
`)),a=PI(a),a=H6(a,i),a=G6(a,i),o=PI(o),o=H6(o,i),o=G6(o,i),a=W6(a),o=W6(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,g=["#define varying in",i.glslVersion===AI?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===AI?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);let x=y+m+a,_=y+g+o,M=V6(n,35633,x),S=V6(n,35632,_);if(n.attachShader(v,M),n.attachShader(v,S),i.index0AttributeName!==void 0?n.bindAttribLocation(v,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(v,0,"position"),n.linkProgram(v),e.debug.checkShaderErrors){let P=n.getProgramInfoLog(v).trim(),C=n.getShaderInfoLog(M).trim(),D=n.getShaderInfoLog(S).trim(),N=!0,U=!0;if(n.getProgramParameter(v,35714)===!1){N=!1;let I=j6(n,M,"vertex"),G=j6(n,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(v,35715)+`

Program Info Log: `+P+`
`+I+`
`+G)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(C===""||D==="")&&(U=!1);U&&(this.diagnostics={runnable:N,programLog:P,vertexShader:{log:C,prefix:m},fragmentShader:{log:D,prefix:g}})}n.deleteShader(M),n.deleteShader(S);let E;this.getUniforms=function(){return E===void 0&&(E=new gE(n,v)),E};let A;return this.getAttributes=function(){return A===void 0&&(A=xxe(n,v)),A},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=dxe++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=M,this.fragmentShader=S,this}var Dxe=0,Lxe=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new Rxe(e),t.set(e,i)),i}},Rxe=class{constructor(e){this.id=Dxe++,this.code=e,this.usedTimes=0}};function Ixe(e,t,i,r,n,s,a){let o=new tk,l=new Lxe,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,p=n.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(A,P,C,D,N){let U=D.fog,I=N.geometry,G=A.isMeshStandardMaterial?D.environment:null,Q=(A.isMeshStandardMaterial?i:t).get(A.envMap||G),Y=Q&&Q.mapping===Gb?Q.image.height:null,O=f[A.type];A.precision!==null&&(p=n.getMaxPrecision(A.precision),p!==A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",p,"instead."));let V=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,F=V!==void 0?V.length:0,W=0;I.morphAttributes.position!==void 0&&(W=1),I.morphAttributes.normal!==void 0&&(W=2),I.morphAttributes.color!==void 0&&(W=3);let ee,ae,K,$;if(O){let ge=bc[O];ee=ge.vertexShader,ae=ge.fragmentShader}else ee=A.vertexShader,ae=A.fragmentShader,l.update(A),K=l.getVertexShaderID(A),$=l.getFragmentShaderID(A);let ie=e.getRenderTarget(),ye=A.alphaTest>0,pe=A.clearcoat>0,me=A.iridescence>0;return{isWebGL2:u,shaderID:O,shaderName:A.type,vertexShader:ee,fragmentShader:ae,defines:A.defines,customVertexShaderID:K,customFragmentShaderID:$,isRawShaderMaterial:A.isRawShaderMaterial===!0,glslVersion:A.glslVersion,precision:p,instancing:N.isInstancedMesh===!0,instancingColor:N.isInstancedMesh===!0&&N.instanceColor!==null,supportsVertexTextures:d,outputEncoding:ie===null?e.outputEncoding:ie.isXRRenderTarget===!0?ie.texture.encoding:jl,map:!!A.map,matcap:!!A.matcap,envMap:!!Q,envMapMode:Q&&Q.mapping,envMapCubeUVHeight:Y,lightMap:!!A.lightMap,aoMap:!!A.aoMap,emissiveMap:!!A.emissiveMap,bumpMap:!!A.bumpMap,normalMap:!!A.normalMap,objectSpaceNormalMap:A.normalMapType===Hge,tangentSpaceNormalMap:A.normalMapType===jge,decodeVideoTexture:!!A.map&&A.map.isVideoTexture===!0&&A.map.encoding===fi,clearcoat:pe,clearcoatMap:pe&&!!A.clearcoatMap,clearcoatRoughnessMap:pe&&!!A.clearcoatRoughnessMap,clearcoatNormalMap:pe&&!!A.clearcoatNormalMap,iridescence:me,iridescenceMap:me&&!!A.iridescenceMap,iridescenceThicknessMap:me&&!!A.iridescenceThicknessMap,displacementMap:!!A.displacementMap,roughnessMap:!!A.roughnessMap,metalnessMap:!!A.metalnessMap,specularMap:!!A.specularMap,specularIntensityMap:!!A.specularIntensityMap,specularColorMap:!!A.specularColorMap,opaque:A.transparent===!1&&A.blending===If,alphaMap:!!A.alphaMap,alphaTest:ye,gradientMap:!!A.gradientMap,sheen:A.sheen>0,sheenColorMap:!!A.sheenColorMap,sheenRoughnessMap:!!A.sheenRoughnessMap,transmission:A.transmission>0,transmissionMap:!!A.transmissionMap,thicknessMap:!!A.thicknessMap,combine:A.combine,vertexTangents:!!A.normalMap&&!!I.attributes.tangent,vertexColors:A.vertexColors,vertexAlphas:A.vertexColors===!0&&!!I.attributes.color&&I.attributes.color.itemSize===4,vertexUvs:!!A.map||!!A.bumpMap||!!A.normalMap||!!A.specularMap||!!A.alphaMap||!!A.emissiveMap||!!A.roughnessMap||!!A.metalnessMap||!!A.clearcoatMap||!!A.clearcoatRoughnessMap||!!A.clearcoatNormalMap||!!A.iridescenceMap||!!A.iridescenceThicknessMap||!!A.displacementMap||!!A.transmissionMap||!!A.thicknessMap||!!A.specularIntensityMap||!!A.specularColorMap||!!A.sheenColorMap||!!A.sheenRoughnessMap,uvsVertexOnly:!(A.map||A.bumpMap||A.normalMap||A.specularMap||A.alphaMap||A.emissiveMap||A.roughnessMap||A.metalnessMap||A.clearcoatNormalMap||A.iridescenceMap||A.iridescenceThicknessMap||A.transmission>0||A.transmissionMap||A.thicknessMap||A.specularIntensityMap||A.specularColorMap||A.sheen>0||A.sheenColorMap||A.sheenRoughnessMap)&&!!A.displacementMap,fog:!!U,useFog:A.fog===!0,fogExp2:U&&U.isFogExp2,flatShading:!!A.flatShading,sizeAttenuation:A.sizeAttenuation,logarithmicDepthBuffer:h,skinning:N.isSkinnedMesh===!0,morphTargets:I.morphAttributes.position!==void 0,morphNormals:I.morphAttributes.normal!==void 0,morphColors:I.morphAttributes.color!==void 0,morphTargetsCount:F,morphTextureStride:W,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:A.dithering,shadowMapEnabled:e.shadowMap.enabled&&C.length>0,shadowMapType:e.shadowMap.type,toneMapping:A.toneMapped?e.toneMapping:zc,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:A.premultipliedAlpha,doubleSided:A.side===qs,flipSided:A.side===os,useDepthPacking:!!A.depthPacking,depthPacking:A.depthPacking||0,index0AttributeName:A.index0AttributeName,extensionDerivatives:A.extensions&&A.extensions.derivatives,extensionFragDepth:A.extensions&&A.extensions.fragDepth,extensionDrawBuffers:A.extensions&&A.extensions.drawBuffers,extensionShaderTextureLOD:A.extensions&&A.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:A.customProgramCacheKey()}}function m(A){let P=[];if(A.shaderID?P.push(A.shaderID):(P.push(A.customVertexShaderID),P.push(A.customFragmentShaderID)),A.defines!==void 0)for(let C in A.defines)P.push(C),P.push(A.defines[C]);return A.isRawShaderMaterial===!1&&(g(P,A),y(P,A),P.push(e.outputEncoding)),P.push(A.customProgramCacheKey),P.join()}function g(A,P){A.push(P.precision),A.push(P.outputEncoding),A.push(P.envMapMode),A.push(P.envMapCubeUVHeight),A.push(P.combine),A.push(P.vertexUvs),A.push(P.fogExp2),A.push(P.sizeAttenuation),A.push(P.morphTargetsCount),A.push(P.morphAttributeCount),A.push(P.numDirLights),A.push(P.numPointLights),A.push(P.numSpotLights),A.push(P.numSpotLightMaps),A.push(P.numHemiLights),A.push(P.numRectAreaLights),A.push(P.numDirLightShadows),A.push(P.numPointLightShadows),A.push(P.numSpotLightShadows),A.push(P.numSpotLightShadowsWithMaps),A.push(P.shadowMapType),A.push(P.toneMapping),A.push(P.numClippingPlanes),A.push(P.numClipIntersection),A.push(P.depthPacking)}function y(A,P){o.disableAll(),P.isWebGL2&&o.enable(0),P.supportsVertexTextures&&o.enable(1),P.instancing&&o.enable(2),P.instancingColor&&o.enable(3),P.map&&o.enable(4),P.matcap&&o.enable(5),P.envMap&&o.enable(6),P.lightMap&&o.enable(7),P.aoMap&&o.enable(8),P.emissiveMap&&o.enable(9),P.bumpMap&&o.enable(10),P.normalMap&&o.enable(11),P.objectSpaceNormalMap&&o.enable(12),P.tangentSpaceNormalMap&&o.enable(13),P.clearcoat&&o.enable(14),P.clearcoatMap&&o.enable(15),P.clearcoatRoughnessMap&&o.enable(16),P.clearcoatNormalMap&&o.enable(17),P.iridescence&&o.enable(18),P.iridescenceMap&&o.enable(19),P.iridescenceThicknessMap&&o.enable(20),P.displacementMap&&o.enable(21),P.specularMap&&o.enable(22),P.roughnessMap&&o.enable(23),P.metalnessMap&&o.enable(24),P.gradientMap&&o.enable(25),P.alphaMap&&o.enable(26),P.alphaTest&&o.enable(27),P.vertexColors&&o.enable(28),P.vertexAlphas&&o.enable(29),P.vertexUvs&&o.enable(30),P.vertexTangents&&o.enable(31),P.uvsVertexOnly&&o.enable(32),A.push(o.mask),o.disableAll(),P.fog&&o.enable(0),P.useFog&&o.enable(1),P.flatShading&&o.enable(2),P.logarithmicDepthBuffer&&o.enable(3),P.skinning&&o.enable(4),P.morphTargets&&o.enable(5),P.morphNormals&&o.enable(6),P.morphColors&&o.enable(7),P.premultipliedAlpha&&o.enable(8),P.shadowMapEnabled&&o.enable(9),P.physicallyCorrectLights&&o.enable(10),P.doubleSided&&o.enable(11),P.flipSided&&o.enable(12),P.useDepthPacking&&o.enable(13),P.dithering&&o.enable(14),P.specularIntensityMap&&o.enable(15),P.specularColorMap&&o.enable(16),P.transmission&&o.enable(17),P.transmissionMap&&o.enable(18),P.thicknessMap&&o.enable(19),P.sheen&&o.enable(20),P.sheenColorMap&&o.enable(21),P.sheenRoughnessMap&&o.enable(22),P.decodeVideoTexture&&o.enable(23),P.opaque&&o.enable(24),A.push(o.mask)}function x(A){let P=f[A.type],C;if(P){let D=bc[P];C=P0.clone(D.uniforms)}else C=A.uniforms;return C}function _(A,P){let C;for(let D=0,N=c.length;D<N;D++){let U=c[D];if(U.cacheKey===P){C=U,++C.usedTimes;break}}return C===void 0&&(C=new Pxe(e,P,A,s),c.push(C)),C}function M(A){if(--A.usedTimes===0){let P=c.indexOf(A);c[P]=c[c.length-1],c.pop(),A.destroy()}}function S(A){l.remove(A)}function E(){l.dispose()}return{getParameters:v,getProgramCacheKey:m,getUniforms:x,acquireProgram:_,releaseProgram:M,releaseShaderCache:S,programs:c,dispose:E}}function Oxe(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function Nxe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function q6(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Y6(){let e=[],t=0,i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,f,v,m){let g=e[t];return g===void 0?(g={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:v,group:m},e[t]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=p,g.groupOrder=f,g.renderOrder=h.renderOrder,g.z=v,g.group=m),t++,g}function o(h,d,p,f,v,m){let g=a(h,d,p,f,v,m);p.transmission>0?r.push(g):p.transparent===!0?n.push(g):i.push(g)}function l(h,d,p,f,v,m){let g=a(h,d,p,f,v,m);p.transmission>0?r.unshift(g):p.transparent===!0?n.unshift(g):i.unshift(g)}function c(h,d){i.length>1&&i.sort(h||Nxe),r.length>1&&r.sort(d||q6),n.length>1&&n.sort(d||q6)}function u(){for(let h=t,d=e.length;h<d;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function zxe(){let e=new WeakMap;function t(r,n){let s=e.get(r),a;return s===void 0?(a=new Y6,e.set(r,[a])):n>=s.length?(a=new Y6,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function Bxe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new k,color:new Yt};break;case"SpotLight":i={position:new k,direction:new k,color:new Yt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new k,color:new Yt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new k,skyColor:new Yt,groundColor:new Yt};break;case"RectAreaLight":i={color:new Yt,position:new k,halfWidth:new k,halfHeight:new k};break}return e[t.id]=i,i}}}function kxe(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var Uxe=0;function Fxe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Vxe(e,t){let i=new Bxe,r=kxe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new k);let s=new k,a=new lt,o=new lt;function l(u,h){let d=0,p=0,f=0;for(let D=0;D<9;D++)n.probe[D].set(0,0,0);let v=0,m=0,g=0,y=0,x=0,_=0,M=0,S=0,E=0,A=0;u.sort(Fxe);let P=h!==!0?Math.PI:1;for(let D=0,N=u.length;D<N;D++){let U=u[D],I=U.color,G=U.intensity,Q=U.distance,Y=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)d+=I.r*G*P,p+=I.g*G*P,f+=I.b*G*P;else if(U.isLightProbe)for(let O=0;O<9;O++)n.probe[O].addScaledVector(U.sh.coefficients[O],G);else if(U.isDirectionalLight){let O=i.get(U);if(O.color.copy(U.color).multiplyScalar(U.intensity*P),U.castShadow){let V=U.shadow,F=r.get(U);F.shadowBias=V.bias,F.shadowNormalBias=V.normalBias,F.shadowRadius=V.radius,F.shadowMapSize=V.mapSize,n.directionalShadow[v]=F,n.directionalShadowMap[v]=Y,n.directionalShadowMatrix[v]=U.shadow.matrix,_++}n.directional[v]=O,v++}else if(U.isSpotLight){let O=i.get(U);O.position.setFromMatrixPosition(U.matrixWorld),O.color.copy(I).multiplyScalar(G*P),O.distance=Q,O.coneCos=Math.cos(U.angle),O.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),O.decay=U.decay,n.spot[g]=O;let V=U.shadow;if(U.map&&(n.spotLightMap[E]=U.map,E++,V.updateMatrices(U),U.castShadow&&A++),n.spotLightMatrix[g]=V.matrix,U.castShadow){let F=r.get(U);F.shadowBias=V.bias,F.shadowNormalBias=V.normalBias,F.shadowRadius=V.radius,F.shadowMapSize=V.mapSize,n.spotShadow[g]=F,n.spotShadowMap[g]=Y,S++}g++}else if(U.isRectAreaLight){let O=i.get(U);O.color.copy(I).multiplyScalar(G),O.halfWidth.set(U.width*.5,0,0),O.halfHeight.set(0,U.height*.5,0),n.rectArea[y]=O,y++}else if(U.isPointLight){let O=i.get(U);if(O.color.copy(U.color).multiplyScalar(U.intensity*P),O.distance=U.distance,O.decay=U.decay,U.castShadow){let V=U.shadow,F=r.get(U);F.shadowBias=V.bias,F.shadowNormalBias=V.normalBias,F.shadowRadius=V.radius,F.shadowMapSize=V.mapSize,F.shadowCameraNear=V.camera.near,F.shadowCameraFar=V.camera.far,n.pointShadow[m]=F,n.pointShadowMap[m]=Y,n.pointShadowMatrix[m]=U.shadow.matrix,M++}n.point[m]=O,m++}else if(U.isHemisphereLight){let O=i.get(U);O.skyColor.copy(U.color).multiplyScalar(G*P),O.groundColor.copy(U.groundColor).multiplyScalar(G*P),n.hemi[x]=O,x++}}y>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=xt.LTC_FLOAT_1,n.rectAreaLTC2=xt.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=xt.LTC_HALF_1,n.rectAreaLTC2=xt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=f;let C=n.hash;(C.directionalLength!==v||C.pointLength!==m||C.spotLength!==g||C.rectAreaLength!==y||C.hemiLength!==x||C.numDirectionalShadows!==_||C.numPointShadows!==M||C.numSpotShadows!==S||C.numSpotMaps!==E)&&(n.directional.length=v,n.spot.length=g,n.rectArea.length=y,n.point.length=m,n.hemi.length=x,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=S+E-A,n.spotLightMap.length=E,n.numSpotLightShadowsWithMaps=A,C.directionalLength=v,C.pointLength=m,C.spotLength=g,C.rectAreaLength=y,C.hemiLength=x,C.numDirectionalShadows=_,C.numPointShadows=M,C.numSpotShadows=S,C.numSpotMaps=E,n.version=Uxe++)}function c(u,h){let d=0,p=0,f=0,v=0,m=0,g=h.matrixWorldInverse;for(let y=0,x=u.length;y<x;y++){let _=u[y];if(_.isDirectionalLight){let M=n.directional[d];M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),d++}else if(_.isSpotLight){let M=n.spot[f];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),f++}else if(_.isRectAreaLight){let M=n.rectArea[v];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),o.identity(),a.copy(_.matrixWorld),a.premultiply(g),o.extractRotation(a),M.halfWidth.set(_.width*.5,0,0),M.halfHeight.set(0,_.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),v++}else if(_.isPointLight){let M=n.point[p];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),p++}else if(_.isHemisphereLight){let M=n.hemi[m];M.direction.setFromMatrixPosition(_.matrixWorld),M.direction.transformDirection(g),m++}}}return{setup:l,setupView:c,state:n}}function Z6(e,t){let i=new Vxe(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function jxe(e,t){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new Z6(e,t),i.set(s,[l])):a>=o.length?(l=new Z6(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var YJ=class extends Wb{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=mh,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},Hxe=class extends Wb{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new k,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Gxe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Wxe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Xxe(e,t,i){let r=new rk,n=new ve,s=new ve,a=new li,o=new YJ({depthPacking:IJ}),l=new Hxe,c={},u=i.maxTextureSize,h={[Vl]:os,[os]:Vl,[qs]:qs},d=new Oi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ve},radius:{value:4}},vertexShader:Gxe,fragmentShader:Wxe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Bt;f.setAttribute("position",new Zt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let v=new gr(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=KB,this.render=function(_,M,S){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||_.length===0)return;let E=e.getRenderTarget(),A=e.getActiveCubeFace(),P=e.getActiveMipmapLevel(),C=e.state;C.setBlending(Tn),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let D=0,N=_.length;D<N;D++){let U=_[D],I=U.shadow;if(I===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(I.autoUpdate===!1&&I.needsUpdate===!1)continue;n.copy(I.mapSize);let G=I.getFrameExtents();if(n.multiply(G),s.copy(I.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/G.x),n.x=s.x*G.x,I.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/G.y),n.y=s.y*G.y,I.mapSize.y=s.y)),I.map===null){let Y=this.type!==M1?{minFilter:_i,magFilter:_i}:{};I.map=new Ii(n.x,n.y,Y),I.map.texture.name=U.name+".shadowMap",I.camera.updateProjectionMatrix()}e.setRenderTarget(I.map),e.clear();let Q=I.getViewportCount();for(let Y=0;Y<Q;Y++){let O=I.getViewport(Y);a.set(s.x*O.x,s.y*O.y,s.x*O.z,s.y*O.w),C.viewport(a),I.updateMatrices(U,Y),r=I.getFrustum(),x(M,S,I.camera,U,this.type)}I.isPointLightShadow!==!0&&this.type===M1&&g(I,S),I.needsUpdate=!1}m.needsUpdate=!1,e.setRenderTarget(E,A,P)};function g(_,M){let S=t.update(v);d.defines.VSM_SAMPLES!==_.blurSamples&&(d.defines.VSM_SAMPLES=_.blurSamples,p.defines.VSM_SAMPLES=_.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new Ii(n.x,n.y)),d.uniforms.shadow_pass.value=_.map.texture,d.uniforms.resolution.value=_.mapSize,d.uniforms.radius.value=_.radius,e.setRenderTarget(_.mapPass),e.clear(),e.renderBufferDirect(M,null,S,d,v,null),p.uniforms.shadow_pass.value=_.mapPass.texture,p.uniforms.resolution.value=_.mapSize,p.uniforms.radius.value=_.radius,e.setRenderTarget(_.map),e.clear(),e.renderBufferDirect(M,null,S,p,v,null)}function y(_,M,S,E,A,P){let C=null,D=S.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(D!==void 0)C=D;else if(C=S.isPointLight===!0?l:o,e.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){let N=C.uuid,U=M.uuid,I=c[N];I===void 0&&(I={},c[N]=I);let G=I[U];G===void 0&&(G=C.clone(),I[U]=G),C=G}return C.visible=M.visible,C.wireframe=M.wireframe,P===M1?C.side=M.shadowSide!==null?M.shadowSide:M.side:C.side=M.shadowSide!==null?M.shadowSide:h[M.side],C.alphaMap=M.alphaMap,C.alphaTest=M.alphaTest,C.map=M.map,C.clipShadows=M.clipShadows,C.clippingPlanes=M.clippingPlanes,C.clipIntersection=M.clipIntersection,C.displacementMap=M.displacementMap,C.displacementScale=M.displacementScale,C.displacementBias=M.displacementBias,C.wireframeLinewidth=M.wireframeLinewidth,C.linewidth=M.linewidth,S.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(S.matrixWorld),C.nearDistance=E,C.farDistance=A),C}function x(_,M,S,E,A){if(_.visible===!1)return;if(_.layers.test(M.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&A===M1)&&(!_.frustumCulled||r.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,_.matrixWorld);let C=t.update(_),D=_.material;if(Array.isArray(D)){let N=C.groups;for(let U=0,I=N.length;U<I;U++){let G=N[U],Q=D[G.materialIndex];if(Q&&Q.visible){let Y=y(_,Q,E,S.near,S.far,A);e.renderBufferDirect(S,null,C,Y,_,G)}}}else if(D.visible){let N=y(_,D,E,S.near,S.far,A);e.renderBufferDirect(S,null,C,N,_,null)}}let P=_.children;for(let C=0,D=P.length;C<D;C++)x(P[C],M,S,E,A)}}function qxe(e,t,i){let r=i.isWebGL2;function n(){let de=!1,Ne=new li,oe=null,He=new li(0,0,0,0);return{setMask:function(Ae){oe!==Ae&&!de&&(e.colorMask(Ae,Ae,Ae,Ae),oe=Ae)},setLocked:function(Ae){de=Ae},setClear:function(Ae,tt,ct,Dt,ai){ai===!0&&(Ae*=Dt,tt*=Dt,ct*=Dt),Ne.set(Ae,tt,ct,Dt),He.equals(Ne)===!1&&(e.clearColor(Ae,tt,ct,Dt),He.copy(Ne))},reset:function(){de=!1,oe=null,He.set(-1,0,0,0)}}}function s(){let de=!1,Ne=null,oe=null,He=null;return{setTest:function(Ae){Ae?ye(2929):pe(2929)},setMask:function(Ae){Ne!==Ae&&!de&&(e.depthMask(Ae),Ne=Ae)},setFunc:function(Ae){if(oe!==Ae){switch(Ae){case fge:e.depthFunc(512);break;case mge:e.depthFunc(519);break;case gge:e.depthFunc(513);break;case wI:e.depthFunc(515);break;case vge:e.depthFunc(514);break;case yge:e.depthFunc(518);break;case xge:e.depthFunc(516);break;case bge:e.depthFunc(517);break;default:e.depthFunc(515)}oe=Ae}},setLocked:function(Ae){de=Ae},setClear:function(Ae){He!==Ae&&(e.clearDepth(Ae),He=Ae)},reset:function(){de=!1,Ne=null,oe=null,He=null}}}function a(){let de=!1,Ne=null,oe=null,He=null,Ae=null,tt=null,ct=null,Dt=null,ai=null;return{setTest:function(Wt){de||(Wt?ye(2960):pe(2960))},setMask:function(Wt){Ne!==Wt&&!de&&(e.stencilMask(Wt),Ne=Wt)},setFunc:function(Wt,Ni,Qt){(oe!==Wt||He!==Ni||Ae!==Qt)&&(e.stencilFunc(Wt,Ni,Qt),oe=Wt,He=Ni,Ae=Qt)},setOp:function(Wt,Ni,Qt){(tt!==Wt||ct!==Ni||Dt!==Qt)&&(e.stencilOp(Wt,Ni,Qt),tt=Wt,ct=Ni,Dt=Qt)},setLocked:function(Wt){de=Wt},setClear:function(Wt){ai!==Wt&&(e.clearStencil(Wt),ai=Wt)},reset:function(){de=!1,Ne=null,oe=null,He=null,Ae=null,tt=null,ct=null,Dt=null,ai=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},p={},f=new WeakMap,v=[],m=null,g=!1,y=null,x=null,_=null,M=null,S=null,E=null,A=null,P=!1,C=null,D=null,N=null,U=null,I=null,G=e.getParameter(35661),Q=!1,Y=0,O=e.getParameter(7938);O.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(O)[1]),Q=Y>=1):O.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),Q=Y>=2);let V=null,F={},W=e.getParameter(3088),ee=e.getParameter(2978),ae=new li().fromArray(W),K=new li().fromArray(ee);function $(de,Ne,oe){let He=new Uint8Array(4),Ae=e.createTexture();e.bindTexture(de,Ae),e.texParameteri(de,10241,9728),e.texParameteri(de,10240,9728);for(let tt=0;tt<oe;tt++)e.texImage2D(Ne+tt,0,6408,1,1,0,6408,5121,He);return Ae}let ie={};ie[3553]=$(3553,3553,1),ie[34067]=$(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ye(2929),l.setFunc(wI),Re(!1),Xe(Vj),ye(2884),Ce(Tn);function ye(de){d[de]!==!0&&(e.enable(de),d[de]=!0)}function pe(de){d[de]!==!1&&(e.disable(de),d[de]=!1)}function me(de,Ne){return p[de]!==Ne?(e.bindFramebuffer(de,Ne),p[de]=Ne,r&&(de===36009&&(p[36160]=Ne),de===36160&&(p[36009]=Ne)),!0):!1}function ge(de,Ne){let oe=v,He=!1;if(de)if(oe=f.get(Ne),oe===void 0&&(oe=[],f.set(Ne,oe)),de.isWebGLMultipleRenderTargets){let Ae=de.texture;if(oe.length!==Ae.length||oe[0]!==36064){for(let tt=0,ct=Ae.length;tt<ct;tt++)oe[tt]=36064+tt;oe.length=Ae.length,He=!0}}else oe[0]!==36064&&(oe[0]=36064,He=!0);else oe[0]!==1029&&(oe[0]=1029,He=!0);He&&(i.isWebGL2?e.drawBuffers(oe):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(oe))}function xe(de){return m!==de?(e.useProgram(de),m=de,!0):!1}let te={[Ug]:32774,[rge]:32778,[nge]:32779};if(r)te[Wj]=32775,te[Xj]=32776;else{let de=t.get("EXT_blend_minmax");de!==null&&(te[Wj]=de.MIN_EXT,te[Xj]=de.MAX_EXT)}let we={[sge]:0,[age]:1,[oge]:768,[EJ]:770,[pge]:776,[hge]:774,[cge]:772,[lge]:769,[AJ]:771,[dge]:775,[uge]:773};function Ce(de,Ne,oe,He,Ae,tt,ct,Dt){if(de===Tn){g===!0&&(pe(3042),g=!1);return}if(g===!1&&(ye(3042),g=!0),de!==ige){if(de!==y||Dt!==P){if((x!==Ug||S!==Ug)&&(e.blendEquation(32774),x=Ug,S=Ug),Dt)switch(de){case If:e.blendFuncSeparate(1,771,1,771);break;case jj:e.blendFunc(1,1);break;case Hj:e.blendFuncSeparate(0,769,0,1);break;case Gj:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",de);break}else switch(de){case If:e.blendFuncSeparate(770,771,1,771);break;case jj:e.blendFunc(770,1);break;case Hj:e.blendFuncSeparate(0,769,0,1);break;case Gj:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",de);break}_=null,M=null,E=null,A=null,y=de,P=Dt}return}Ae=Ae||Ne,tt=tt||oe,ct=ct||He,(Ne!==x||Ae!==S)&&(e.blendEquationSeparate(te[Ne],te[Ae]),x=Ne,S=Ae),(oe!==_||He!==M||tt!==E||ct!==A)&&(e.blendFuncSeparate(we[oe],we[He],we[tt],we[ct]),_=oe,M=He,E=tt,A=ct),y=de,P=!1}function Se(de,Ne){de.side===qs?pe(2884):ye(2884);let oe=de.side===os;Ne&&(oe=!oe),Re(oe),de.blending===If&&de.transparent===!1?Ce(Tn):Ce(de.blending,de.blendEquation,de.blendSrc,de.blendDst,de.blendEquationAlpha,de.blendSrcAlpha,de.blendDstAlpha,de.premultipliedAlpha),l.setFunc(de.depthFunc),l.setTest(de.depthTest),l.setMask(de.depthWrite),o.setMask(de.colorWrite);let He=de.stencilWrite;c.setTest(He),He&&(c.setMask(de.stencilWriteMask),c.setFunc(de.stencilFunc,de.stencilRef,de.stencilFuncMask),c.setOp(de.stencilFail,de.stencilZFail,de.stencilZPass)),Fe(de.polygonOffset,de.polygonOffsetFactor,de.polygonOffsetUnits),de.alphaToCoverage===!0?ye(32926):pe(32926)}function Re(de){C!==de&&(de?e.frontFace(2304):e.frontFace(2305),C=de)}function Xe(de){de!==$me?(ye(2884),de!==D&&(de===Vj?e.cullFace(1029):de===ege?e.cullFace(1028):e.cullFace(1032))):pe(2884),D=de}function Be(de){de!==N&&(Q&&e.lineWidth(de),N=de)}function Fe(de,Ne,oe){de?(ye(32823),(U!==Ne||I!==oe)&&(e.polygonOffset(Ne,oe),U=Ne,I=oe)):pe(32823)}function dt(de){de?ye(3089):pe(3089)}function se(de){de===void 0&&(de=33984+G-1),V!==de&&(e.activeTexture(de),V=de)}function z(de,Ne,oe){oe===void 0&&(V===null?oe=33984+G-1:oe=V);let He=F[oe];He===void 0&&(He={type:void 0,texture:void 0},F[oe]=He),(He.type!==de||He.texture!==Ne)&&(V!==oe&&(e.activeTexture(oe),V=oe),e.bindTexture(de,Ne||ie[de]),He.type=de,He.texture=Ne)}function X(){let de=F[V];de!==void 0&&de.type!==void 0&&(e.bindTexture(de.type,null),de.type=void 0,de.texture=void 0)}function ce(){try{e.compressedTexImage2D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function Ee(){try{e.compressedTexImage3D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function q(){try{e.texSubImage2D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function Ye(){try{e.texSubImage3D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function et(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function ke(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function _e(){try{e.texStorage2D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function at(){try{e.texStorage3D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function Ve(){try{e.texImage2D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function mt(){try{e.texImage3D.apply(e,arguments)}catch(de){console.error("THREE.WebGLState:",de)}}function pt(de){ae.equals(de)===!1&&(e.scissor(de.x,de.y,de.z,de.w),ae.copy(de))}function st(de){K.equals(de)===!1&&(e.viewport(de.x,de.y,de.z,de.w),K.copy(de))}function ue(de,Ne){let oe=h.get(Ne);oe===void 0&&(oe=new WeakMap,h.set(Ne,oe));let He=oe.get(de);He===void 0&&(He=e.getUniformBlockIndex(Ne,de.name),oe.set(de,He))}function ze(de,Ne){let oe=h.get(Ne).get(de);u.get(Ne)!==oe&&(e.uniformBlockBinding(Ne,oe,de.__bindingPointIndex),u.set(Ne,oe))}function ut(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},V=null,F={},p={},f=new WeakMap,v=[],m=null,g=!1,y=null,x=null,_=null,M=null,S=null,E=null,A=null,P=!1,C=null,D=null,N=null,U=null,I=null,ae.set(0,0,e.canvas.width,e.canvas.height),K.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:ye,disable:pe,bindFramebuffer:me,drawBuffers:ge,useProgram:xe,setBlending:Ce,setMaterial:Se,setFlipSided:Re,setCullFace:Xe,setLineWidth:Be,setPolygonOffset:Fe,setScissorTest:dt,activeTexture:se,bindTexture:z,unbindTexture:X,compressedTexImage2D:ce,compressedTexImage3D:Ee,texImage2D:Ve,texImage3D:mt,updateUBOMapping:ue,uniformBlockBinding:ze,texStorage2D:_e,texStorage3D:at,texSubImage2D:q,texSubImage3D:Ye,compressedTexSubImage2D:et,compressedTexSubImage3D:ke,scissor:pt,viewport:st,reset:ut}}function Yxe(e,t,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,v,m=new WeakMap,g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(z,X){return g?new OffscreenCanvas(z,X):Vx("canvas")}function x(z,X,ce,Ee){let q=1;if((z.width>Ee||z.height>Ee)&&(q=Ee/Math.max(z.width,z.height)),q<1||X===!0)if(typeof HTMLImageElement<"u"&&z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&z instanceof ImageBitmap){let Ye=X?EA:Math.floor,et=Ye(q*z.width),ke=Ye(q*z.height);v===void 0&&(v=y(et,ke));let _e=ce?y(et,ke):v;return _e.width=et,_e.height=ke,_e.getContext("2d").drawImage(z,0,0,et,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+z.width+"x"+z.height+") to ("+et+"x"+ke+")."),_e}else return"data"in z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+z.width+"x"+z.height+")."),z;return z}function _(z){return TI(z.width)&&TI(z.height)}function M(z){return o?!1:z.wrapS!==Cr||z.wrapT!==Cr||z.minFilter!==_i&&z.minFilter!==gi}function S(z,X){return z.generateMipmaps&&X&&z.minFilter!==_i&&z.minFilter!==gi}function E(z){e.generateMipmap(z)}function A(z,X,ce,Ee,q=!1){if(o===!1)return X;if(z!==null){if(e[z]!==void 0)return e[z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+z+"'")}let Ye=X;return X===6403&&(ce===5126&&(Ye=33326),ce===5131&&(Ye=33325),ce===5121&&(Ye=33321)),X===33319&&(ce===5126&&(Ye=33328),ce===5131&&(Ye=33327),ce===5121&&(Ye=33323)),X===6408&&(ce===5126&&(Ye=34836),ce===5131&&(Ye=34842),ce===5121&&(Ye=Ee===fi&&q===!1?35907:32856),ce===32819&&(Ye=32854),ce===32820&&(Ye=32855)),(Ye===33325||Ye===33326||Ye===33327||Ye===33328||Ye===34842||Ye===34836)&&t.get("EXT_color_buffer_float"),Ye}function P(z,X,ce){return S(z,ce)===!0||z.isFramebufferTexture&&z.minFilter!==_i&&z.minFilter!==gi?Math.log2(Math.max(X.width,X.height))+1:z.mipmaps!==void 0&&z.mipmaps.length>0?z.mipmaps.length:z.isCompressedTexture&&Array.isArray(z.image)?X.mipmaps.length:1}function C(z){return z===_i||z===qj||z===rD?9728:9729}function D(z){let X=z.target;X.removeEventListener("dispose",D),U(X),X.isVideoTexture&&f.delete(X)}function N(z){let X=z.target;X.removeEventListener("dispose",N),G(X)}function U(z){let X=r.get(z);if(X.__webglInit===void 0)return;let ce=z.source,Ee=m.get(ce);if(Ee){let q=Ee[X.__cacheKey];q.usedTimes--,q.usedTimes===0&&I(z),Object.keys(Ee).length===0&&m.delete(ce)}r.remove(z)}function I(z){let X=r.get(z);e.deleteTexture(X.__webglTexture);let ce=z.source,Ee=m.get(ce);delete Ee[X.__cacheKey],a.memory.textures--}function G(z){let X=z.texture,ce=r.get(z),Ee=r.get(X);if(Ee.__webglTexture!==void 0&&(e.deleteTexture(Ee.__webglTexture),a.memory.textures--),z.depthTexture&&z.depthTexture.dispose(),z.isWebGLCubeRenderTarget)for(let q=0;q<6;q++)e.deleteFramebuffer(ce.__webglFramebuffer[q]),ce.__webglDepthbuffer&&e.deleteRenderbuffer(ce.__webglDepthbuffer[q]);else{if(e.deleteFramebuffer(ce.__webglFramebuffer),ce.__webglDepthbuffer&&e.deleteRenderbuffer(ce.__webglDepthbuffer),ce.__webglMultisampledFramebuffer&&e.deleteFramebuffer(ce.__webglMultisampledFramebuffer),ce.__webglColorRenderbuffer)for(let q=0;q<ce.__webglColorRenderbuffer.length;q++)ce.__webglColorRenderbuffer[q]&&e.deleteRenderbuffer(ce.__webglColorRenderbuffer[q]);ce.__webglDepthRenderbuffer&&e.deleteRenderbuffer(ce.__webglDepthRenderbuffer)}if(z.isWebGLMultipleRenderTargets)for(let q=0,Ye=X.length;q<Ye;q++){let et=r.get(X[q]);et.__webglTexture&&(e.deleteTexture(et.__webglTexture),a.memory.textures--),r.remove(X[q])}r.remove(X),r.remove(z)}let Q=0;function Y(){Q=0}function O(){let z=Q;return z>=l&&console.warn("THREE.WebGLTextures: Trying to use "+z+" texture units while this GPU supports only "+l),Q+=1,z}function V(z){let X=[];return X.push(z.wrapS),X.push(z.wrapT),X.push(z.wrapR||0),X.push(z.magFilter),X.push(z.minFilter),X.push(z.anisotropy),X.push(z.internalFormat),X.push(z.format),X.push(z.type),X.push(z.generateMipmaps),X.push(z.premultiplyAlpha),X.push(z.flipY),X.push(z.unpackAlignment),X.push(z.encoding),X.join()}function F(z,X){let ce=r.get(z);if(z.isVideoTexture&&dt(z),z.isRenderTargetTexture===!1&&z.version>0&&ce.__version!==z.version){let Ee=z.image;if(Ee===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ee.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(ce,z,X);return}}i.bindTexture(3553,ce.__webglTexture,33984+X)}function W(z,X){let ce=r.get(z);if(z.version>0&&ce.__version!==z.version){pe(ce,z,X);return}i.bindTexture(35866,ce.__webglTexture,33984+X)}function ee(z,X){let ce=r.get(z);if(z.version>0&&ce.__version!==z.version){pe(ce,z,X);return}i.bindTexture(32879,ce.__webglTexture,33984+X)}function ae(z,X){let ce=r.get(z);if(z.version>0&&ce.__version!==z.version){me(ce,z,X);return}i.bindTexture(34067,ce.__webglTexture,33984+X)}let K={[Fu]:10497,[Cr]:33071,[MI]:33648},$={[_i]:9728,[qj]:9984,[rD]:9986,[gi]:9729,[Tge]:9985,[t0]:9987};function ie(z,X,ce){if(ce?(e.texParameteri(z,10242,K[X.wrapS]),e.texParameteri(z,10243,K[X.wrapT]),(z===32879||z===35866)&&e.texParameteri(z,32882,K[X.wrapR]),e.texParameteri(z,10240,$[X.magFilter]),e.texParameteri(z,10241,$[X.minFilter])):(e.texParameteri(z,10242,33071),e.texParameteri(z,10243,33071),(z===32879||z===35866)&&e.texParameteri(z,32882,33071),(X.wrapS!==Cr||X.wrapT!==Cr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(z,10240,C(X.magFilter)),e.texParameteri(z,10241,C(X.minFilter)),X.minFilter!==_i&&X.minFilter!==gi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let Ee=t.get("EXT_texture_filter_anisotropic");if(X.magFilter===_i||X.minFilter!==rD&&X.minFilter!==t0||X.type===rr&&t.has("OES_texture_float_linear")===!1||o===!1&&X.type===sh&&t.has("OES_texture_half_float_linear")===!1)return;(X.anisotropy>1||r.get(X).__currentAnisotropy)&&(e.texParameterf(z,Ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(X.anisotropy,n.getMaxAnisotropy())),r.get(X).__currentAnisotropy=X.anisotropy)}}function ye(z,X){let ce=!1;z.__webglInit===void 0&&(z.__webglInit=!0,X.addEventListener("dispose",D));let Ee=X.source,q=m.get(Ee);q===void 0&&(q={},m.set(Ee,q));let Ye=V(X);if(Ye!==z.__cacheKey){q[Ye]===void 0&&(q[Ye]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,ce=!0),q[Ye].usedTimes++;let et=q[z.__cacheKey];et!==void 0&&(q[z.__cacheKey].usedTimes--,et.usedTimes===0&&I(X)),z.__cacheKey=Ye,z.__webglTexture=q[Ye].texture}return ce}function pe(z,X,ce){let Ee=3553;(X.isDataArrayTexture||X.isCompressedArrayTexture)&&(Ee=35866),X.isData3DTexture&&(Ee=32879);let q=ye(z,X),Ye=X.source;i.bindTexture(Ee,z.__webglTexture,33984+ce);let et=r.get(Ye);if(Ye.version!==et.__version||q===!0){i.activeTexture(33984+ce),e.pixelStorei(37440,X.flipY),e.pixelStorei(37441,X.premultiplyAlpha),e.pixelStorei(3317,X.unpackAlignment),e.pixelStorei(37443,0);let ke=M(X)&&_(X.image)===!1,_e=x(X.image,ke,!1,u);_e=se(X,_e);let at=_(_e)||o,Ve=s.convert(X.format,X.encoding),mt=s.convert(X.type),pt=A(X.internalFormat,Ve,mt,X.encoding,X.isVideoTexture);ie(Ee,X,at);let st,ue=X.mipmaps,ze=o&&X.isVideoTexture!==!0,ut=et.__version===void 0||q===!0,de=P(X,_e,at);if(X.isDepthTexture)pt=6402,o?X.type===rr?pt=36012:X.type===Vu?pt=33190:X.type===Of?pt=35056:pt=33189:X.type===rr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),X.format===Nf&&pt===6402&&X.type!==PJ&&X.type!==Vu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),X.type=Vu,mt=s.convert(X.type)),X.format===Kf&&pt===6402&&(pt=34041,X.type!==Of&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),X.type=Of,mt=s.convert(X.type))),ut&&(ze?i.texStorage2D(3553,1,pt,_e.width,_e.height):i.texImage2D(3553,0,pt,_e.width,_e.height,0,Ve,mt,null));else if(X.isDataTexture)if(ue.length>0&&at){ze&&ut&&i.texStorage2D(3553,de,pt,ue[0].width,ue[0].height);for(let Ne=0,oe=ue.length;Ne<oe;Ne++)st=ue[Ne],ze?i.texSubImage2D(3553,Ne,0,0,st.width,st.height,Ve,mt,st.data):i.texImage2D(3553,Ne,pt,st.width,st.height,0,Ve,mt,st.data);X.generateMipmaps=!1}else ze?(ut&&i.texStorage2D(3553,de,pt,_e.width,_e.height),i.texSubImage2D(3553,0,0,0,_e.width,_e.height,Ve,mt,_e.data)):i.texImage2D(3553,0,pt,_e.width,_e.height,0,Ve,mt,_e.data);else if(X.isCompressedTexture)if(X.isCompressedArrayTexture){ze&&ut&&i.texStorage3D(35866,de,pt,ue[0].width,ue[0].height,_e.depth);for(let Ne=0,oe=ue.length;Ne<oe;Ne++)st=ue[Ne],X.format!==Rr?Ve!==null?ze?i.compressedTexSubImage3D(35866,Ne,0,0,0,st.width,st.height,_e.depth,Ve,st.data,0,0):i.compressedTexImage3D(35866,Ne,pt,st.width,st.height,_e.depth,0,st.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ze?i.texSubImage3D(35866,Ne,0,0,0,st.width,st.height,_e.depth,Ve,mt,st.data):i.texImage3D(35866,Ne,pt,st.width,st.height,_e.depth,0,Ve,mt,st.data)}else{ze&&ut&&i.texStorage2D(3553,de,pt,ue[0].width,ue[0].height);for(let Ne=0,oe=ue.length;Ne<oe;Ne++)st=ue[Ne],X.format!==Rr?Ve!==null?ze?i.compressedTexSubImage2D(3553,Ne,0,0,st.width,st.height,Ve,st.data):i.compressedTexImage2D(3553,Ne,pt,st.width,st.height,0,st.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ze?i.texSubImage2D(3553,Ne,0,0,st.width,st.height,Ve,mt,st.data):i.texImage2D(3553,Ne,pt,st.width,st.height,0,Ve,mt,st.data)}else if(X.isDataArrayTexture)ze?(ut&&i.texStorage3D(35866,de,pt,_e.width,_e.height,_e.depth),i.texSubImage3D(35866,0,0,0,0,_e.width,_e.height,_e.depth,Ve,mt,_e.data)):i.texImage3D(35866,0,pt,_e.width,_e.height,_e.depth,0,Ve,mt,_e.data);else if(X.isData3DTexture)ze?(ut&&i.texStorage3D(32879,de,pt,_e.width,_e.height,_e.depth),i.texSubImage3D(32879,0,0,0,0,_e.width,_e.height,_e.depth,Ve,mt,_e.data)):i.texImage3D(32879,0,pt,_e.width,_e.height,_e.depth,0,Ve,mt,_e.data);else if(X.isFramebufferTexture){if(ut)if(ze)i.texStorage2D(3553,de,pt,_e.width,_e.height);else{let Ne=_e.width,oe=_e.height;for(let He=0;He<de;He++)i.texImage2D(3553,He,pt,Ne,oe,0,Ve,mt,null),Ne>>=1,oe>>=1}}else if(ue.length>0&&at){ze&&ut&&i.texStorage2D(3553,de,pt,ue[0].width,ue[0].height);for(let Ne=0,oe=ue.length;Ne<oe;Ne++)st=ue[Ne],ze?i.texSubImage2D(3553,Ne,0,0,Ve,mt,st):i.texImage2D(3553,Ne,pt,Ve,mt,st);X.generateMipmaps=!1}else ze?(ut&&i.texStorage2D(3553,de,pt,_e.width,_e.height),i.texSubImage2D(3553,0,0,0,Ve,mt,_e)):i.texImage2D(3553,0,pt,Ve,mt,_e);S(X,at)&&E(Ee),et.__version=Ye.version,X.onUpdate&&X.onUpdate(X)}z.__version=X.version}function me(z,X,ce){if(X.image.length!==6)return;let Ee=ye(z,X),q=X.source;i.bindTexture(34067,z.__webglTexture,33984+ce);let Ye=r.get(q);if(q.version!==Ye.__version||Ee===!0){i.activeTexture(33984+ce),e.pixelStorei(37440,X.flipY),e.pixelStorei(37441,X.premultiplyAlpha),e.pixelStorei(3317,X.unpackAlignment),e.pixelStorei(37443,0);let et=X.isCompressedTexture||X.image[0].isCompressedTexture,ke=X.image[0]&&X.image[0].isDataTexture,_e=[];for(let Ne=0;Ne<6;Ne++)!et&&!ke?_e[Ne]=x(X.image[Ne],!1,!0,c):_e[Ne]=ke?X.image[Ne].image:X.image[Ne],_e[Ne]=se(X,_e[Ne]);let at=_e[0],Ve=_(at)||o,mt=s.convert(X.format,X.encoding),pt=s.convert(X.type),st=A(X.internalFormat,mt,pt,X.encoding),ue=o&&X.isVideoTexture!==!0,ze=Ye.__version===void 0||Ee===!0,ut=P(X,at,Ve);ie(34067,X,Ve);let de;if(et){ue&&ze&&i.texStorage2D(34067,ut,st,at.width,at.height);for(let Ne=0;Ne<6;Ne++){de=_e[Ne].mipmaps;for(let oe=0;oe<de.length;oe++){let He=de[oe];X.format!==Rr?mt!==null?ue?i.compressedTexSubImage2D(34069+Ne,oe,0,0,He.width,He.height,mt,He.data):i.compressedTexImage2D(34069+Ne,oe,st,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ue?i.texSubImage2D(34069+Ne,oe,0,0,He.width,He.height,mt,pt,He.data):i.texImage2D(34069+Ne,oe,st,He.width,He.height,0,mt,pt,He.data)}}}else{de=X.mipmaps,ue&&ze&&(de.length>0&&ut++,i.texStorage2D(34067,ut,st,_e[0].width,_e[0].height));for(let Ne=0;Ne<6;Ne++)if(ke){ue?i.texSubImage2D(34069+Ne,0,0,0,_e[Ne].width,_e[Ne].height,mt,pt,_e[Ne].data):i.texImage2D(34069+Ne,0,st,_e[Ne].width,_e[Ne].height,0,mt,pt,_e[Ne].data);for(let oe=0;oe<de.length;oe++){let He=de[oe].image[Ne].image;ue?i.texSubImage2D(34069+Ne,oe+1,0,0,He.width,He.height,mt,pt,He.data):i.texImage2D(34069+Ne,oe+1,st,He.width,He.height,0,mt,pt,He.data)}}else{ue?i.texSubImage2D(34069+Ne,0,0,0,mt,pt,_e[Ne]):i.texImage2D(34069+Ne,0,st,mt,pt,_e[Ne]);for(let oe=0;oe<de.length;oe++){let He=de[oe];ue?i.texSubImage2D(34069+Ne,oe+1,0,0,mt,pt,He.image[Ne]):i.texImage2D(34069+Ne,oe+1,st,mt,pt,He.image[Ne])}}}S(X,Ve)&&E(34067),Ye.__version=q.version,X.onUpdate&&X.onUpdate(X)}z.__version=X.version}function ge(z,X,ce,Ee,q){let Ye=s.convert(ce.format,ce.encoding),et=s.convert(ce.type),ke=A(ce.internalFormat,Ye,et,ce.encoding);r.get(X).__hasExternalTextures||(q===32879||q===35866?i.texImage3D(q,0,ke,X.width,X.height,X.depth,0,Ye,et,null):i.texImage2D(q,0,ke,X.width,X.height,0,Ye,et,null)),i.bindFramebuffer(36160,z),Fe(X)?d.framebufferTexture2DMultisampleEXT(36160,Ee,q,r.get(ce).__webglTexture,0,Be(X)):(q===3553||q>=34069&&q<=34074)&&e.framebufferTexture2D(36160,Ee,q,r.get(ce).__webglTexture,0),i.bindFramebuffer(36160,null)}function xe(z,X,ce){if(e.bindRenderbuffer(36161,z),X.depthBuffer&&!X.stencilBuffer){let Ee=33189;if(ce||Fe(X)){let q=X.depthTexture;q&&q.isDepthTexture&&(q.type===rr?Ee=36012:q.type===Vu&&(Ee=33190));let Ye=Be(X);Fe(X)?d.renderbufferStorageMultisampleEXT(36161,Ye,Ee,X.width,X.height):e.renderbufferStorageMultisample(36161,Ye,Ee,X.width,X.height)}else e.renderbufferStorage(36161,Ee,X.width,X.height);e.framebufferRenderbuffer(36160,36096,36161,z)}else if(X.depthBuffer&&X.stencilBuffer){let Ee=Be(X);ce&&Fe(X)===!1?e.renderbufferStorageMultisample(36161,Ee,35056,X.width,X.height):Fe(X)?d.renderbufferStorageMultisampleEXT(36161,Ee,35056,X.width,X.height):e.renderbufferStorage(36161,34041,X.width,X.height),e.framebufferRenderbuffer(36160,33306,36161,z)}else{let Ee=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let q=0;q<Ee.length;q++){let Ye=Ee[q],et=s.convert(Ye.format,Ye.encoding),ke=s.convert(Ye.type),_e=A(Ye.internalFormat,et,ke,Ye.encoding),at=Be(X);ce&&Fe(X)===!1?e.renderbufferStorageMultisample(36161,at,_e,X.width,X.height):Fe(X)?d.renderbufferStorageMultisampleEXT(36161,at,_e,X.width,X.height):e.renderbufferStorage(36161,_e,X.width,X.height)}}e.bindRenderbuffer(36161,null)}function te(z,X){if(X&&X.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,z),!(X.depthTexture&&X.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(X.depthTexture).__webglTexture||X.depthTexture.image.width!==X.width||X.depthTexture.image.height!==X.height)&&(X.depthTexture.image.width=X.width,X.depthTexture.image.height=X.height,X.depthTexture.needsUpdate=!0),F(X.depthTexture,0);let ce=r.get(X.depthTexture).__webglTexture,Ee=Be(X);if(X.depthTexture.format===Nf)Fe(X)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,ce,0,Ee):e.framebufferTexture2D(36160,36096,3553,ce,0);else if(X.depthTexture.format===Kf)Fe(X)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,ce,0,Ee):e.framebufferTexture2D(36160,33306,3553,ce,0);else throw new Error("Unknown depthTexture format")}function we(z){let X=r.get(z),ce=z.isWebGLCubeRenderTarget===!0;if(z.depthTexture&&!X.__autoAllocateDepthBuffer){if(ce)throw new Error("target.depthTexture not supported in Cube render targets");te(X.__webglFramebuffer,z)}else if(ce){X.__webglDepthbuffer=[];for(let Ee=0;Ee<6;Ee++)i.bindFramebuffer(36160,X.__webglFramebuffer[Ee]),X.__webglDepthbuffer[Ee]=e.createRenderbuffer(),xe(X.__webglDepthbuffer[Ee],z,!1)}else i.bindFramebuffer(36160,X.__webglFramebuffer),X.__webglDepthbuffer=e.createRenderbuffer(),xe(X.__webglDepthbuffer,z,!1);i.bindFramebuffer(36160,null)}function Ce(z,X,ce){let Ee=r.get(z);X!==void 0&&ge(Ee.__webglFramebuffer,z,z.texture,36064,3553),ce!==void 0&&we(z)}function Se(z){let X=z.texture,ce=r.get(z),Ee=r.get(X);z.addEventListener("dispose",N),z.isWebGLMultipleRenderTargets!==!0&&(Ee.__webglTexture===void 0&&(Ee.__webglTexture=e.createTexture()),Ee.__version=X.version,a.memory.textures++);let q=z.isWebGLCubeRenderTarget===!0,Ye=z.isWebGLMultipleRenderTargets===!0,et=_(z)||o;if(q){ce.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)ce.__webglFramebuffer[ke]=e.createFramebuffer()}else{if(ce.__webglFramebuffer=e.createFramebuffer(),Ye)if(n.drawBuffers){let ke=z.texture;for(let _e=0,at=ke.length;_e<at;_e++){let Ve=r.get(ke[_e]);Ve.__webglTexture===void 0&&(Ve.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&z.samples>0&&Fe(z)===!1){let ke=Ye?X:[X];ce.__webglMultisampledFramebuffer=e.createFramebuffer(),ce.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,ce.__webglMultisampledFramebuffer);for(let _e=0;_e<ke.length;_e++){let at=ke[_e];ce.__webglColorRenderbuffer[_e]=e.createRenderbuffer(),e.bindRenderbuffer(36161,ce.__webglColorRenderbuffer[_e]);let Ve=s.convert(at.format,at.encoding),mt=s.convert(at.type),pt=A(at.internalFormat,Ve,mt,at.encoding,z.isXRRenderTarget===!0),st=Be(z);e.renderbufferStorageMultisample(36161,st,pt,z.width,z.height),e.framebufferRenderbuffer(36160,36064+_e,36161,ce.__webglColorRenderbuffer[_e])}e.bindRenderbuffer(36161,null),z.depthBuffer&&(ce.__webglDepthRenderbuffer=e.createRenderbuffer(),xe(ce.__webglDepthRenderbuffer,z,!0)),i.bindFramebuffer(36160,null)}}if(q){i.bindTexture(34067,Ee.__webglTexture),ie(34067,X,et);for(let ke=0;ke<6;ke++)ge(ce.__webglFramebuffer[ke],z,X,36064,34069+ke);S(X,et)&&E(34067),i.unbindTexture()}else if(Ye){let ke=z.texture;for(let _e=0,at=ke.length;_e<at;_e++){let Ve=ke[_e],mt=r.get(Ve);i.bindTexture(3553,mt.__webglTexture),ie(3553,Ve,et),ge(ce.__webglFramebuffer,z,Ve,36064+_e,3553),S(Ve,et)&&E(3553)}i.unbindTexture()}else{let ke=3553;(z.isWebGL3DRenderTarget||z.isWebGLArrayRenderTarget)&&(o?ke=z.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(ke,Ee.__webglTexture),ie(ke,X,et),ge(ce.__webglFramebuffer,z,X,36064,ke),S(X,et)&&E(ke),i.unbindTexture()}z.depthBuffer&&we(z)}function Re(z){let X=_(z)||o,ce=z.isWebGLMultipleRenderTargets===!0?z.texture:[z.texture];for(let Ee=0,q=ce.length;Ee<q;Ee++){let Ye=ce[Ee];if(S(Ye,X)){let et=z.isWebGLCubeRenderTarget?34067:3553,ke=r.get(Ye).__webglTexture;i.bindTexture(et,ke),E(et),i.unbindTexture()}}}function Xe(z){if(o&&z.samples>0&&Fe(z)===!1){let X=z.isWebGLMultipleRenderTargets?z.texture:[z.texture],ce=z.width,Ee=z.height,q=16384,Ye=[],et=z.stencilBuffer?33306:36096,ke=r.get(z),_e=z.isWebGLMultipleRenderTargets===!0;if(_e)for(let at=0;at<X.length;at++)i.bindFramebuffer(36160,ke.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+at,36161,null),i.bindFramebuffer(36160,ke.__webglFramebuffer),e.framebufferTexture2D(36009,36064+at,3553,null,0);i.bindFramebuffer(36008,ke.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,ke.__webglFramebuffer);for(let at=0;at<X.length;at++){Ye.push(36064+at),z.depthBuffer&&Ye.push(et);let Ve=ke.__ignoreDepthValues!==void 0?ke.__ignoreDepthValues:!1;if(Ve===!1&&(z.depthBuffer&&(q|=256),z.stencilBuffer&&(q|=1024)),_e&&e.framebufferRenderbuffer(36008,36064,36161,ke.__webglColorRenderbuffer[at]),Ve===!0&&(e.invalidateFramebuffer(36008,[et]),e.invalidateFramebuffer(36009,[et])),_e){let mt=r.get(X[at]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,mt,0)}e.blitFramebuffer(0,0,ce,Ee,0,0,ce,Ee,q,9728),p&&e.invalidateFramebuffer(36008,Ye)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),_e)for(let at=0;at<X.length;at++){i.bindFramebuffer(36160,ke.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+at,36161,ke.__webglColorRenderbuffer[at]);let Ve=r.get(X[at]).__webglTexture;i.bindFramebuffer(36160,ke.__webglFramebuffer),e.framebufferTexture2D(36009,36064+at,3553,Ve,0)}i.bindFramebuffer(36009,ke.__webglMultisampledFramebuffer)}}function Be(z){return Math.min(h,z.samples)}function Fe(z){let X=r.get(z);return o&&z.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&X.__useRenderToTexture!==!1}function dt(z){let X=a.render.frame;f.get(z)!==X&&(f.set(z,X),z.update())}function se(z,X){let ce=z.encoding,Ee=z.format,q=z.type;return z.isCompressedTexture===!0||z.isVideoTexture===!0||z.format===CI||ce!==jl&&(ce===fi?o===!1?t.has("EXT_sRGB")===!0&&Ee===Rr?(z.format=CI,z.minFilter=gi,z.generateMipmaps=!1):X=BJ.sRGBToLinear(X):(Ee!==Rr||q!==Js)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ce)),X}this.allocateTextureUnit=O,this.resetTextureUnits=Y,this.setTexture2D=F,this.setTexture2DArray=W,this.setTexture3D=ee,this.setTextureCube=ae,this.rebindTextures=Ce,this.setupRenderTarget=Se,this.updateRenderTargetMipmap=Re,this.updateMultisampleRenderTarget=Xe,this.setupDepthRenderbuffer=we,this.setupFrameBufferTexture=ge,this.useMultisampledRTT=Fe}function Zxe(e,t,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Js)return 5121;if(s===Rge)return 32819;if(s===Ige)return 32820;if(s===Pge)return 5120;if(s===Dge)return 5122;if(s===PJ)return 5123;if(s===Lge)return 5124;if(s===Vu)return 5125;if(s===rr)return 5126;if(s===sh)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===Oge)return 6406;if(s===Rr)return 6408;if(s===Nge)return 6409;if(s===zge)return 6410;if(s===Nf)return 6402;if(s===Kf)return 34041;if(s===CI)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===fE)return 6403;if(s===Bge)return 36244;if(s===bA)return 33319;if(s===kge)return 33320;if(s===DJ)return 36249;if(s===nD||s===sD||s===aD||s===oD)if(a===fi)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===nD)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===sD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===aD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===oD)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===nD)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===sD)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===aD)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===oD)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Yj||s===Zj||s===Qj||s===Kj)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===Yj)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===Zj)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Qj)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===Kj)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===Uge)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Jj||s===$j)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===Jj)return a===fi?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===$j)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===e6||s===t6||s===i6||s===r6||s===n6||s===s6||s===a6||s===o6||s===l6||s===c6||s===u6||s===h6||s===d6||s===p6)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===e6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===t6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===i6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===r6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===n6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===s6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===a6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===o6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===l6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===c6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===u6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===h6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===d6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===p6)return a===fi?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===lD)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===lD)return a===fi?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===Fge||s===f6||s===m6||s===g6)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===lD)return o.COMPRESSED_RED_RGTC1_EXT;if(s===f6)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===m6)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===g6)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Of?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}var Qxe=class extends Hs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Hu=class extends $i{constructor(){super(),this.isGroup=!0,this.type="Group"}},Kxe={type:"move"},OD=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Hu,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Hu,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new k,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new k),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Hu,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new k,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new k),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let f of e.hand.values()){let v=t.getJointPose(f,i),m=this._getHandJoint(l,f);v!==null&&(m.matrix.fromArray(v.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=v.radius),m.visible=v!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(n=t.getPose(e.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Kxe)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new Hu;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},r0=class extends Fr{constructor(e,t,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:Nf,c!==Nf&&c!==Kf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Nf&&(i=Vu),i===void 0&&c===Kf&&(i=Of),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:_i,this.minFilter=o!==void 0?o:_i,this.flipY=!1,this.generateMipmaps=!1}},Jxe=class extends Ts{constructor(e,t){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null,f=t.getContextAttributes(),v=null,m=null,g=[],y=[],x=new Set,_=new Map,M=new Hs;M.layers.enable(1),M.viewport=new li;let S=new Hs;S.layers.enable(2),S.viewport=new li;let E=[M,S],A=new Qxe;A.layers.enable(1),A.layers.enable(2);let P=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let ee=g[W];return ee===void 0&&(ee=new OD,g[W]=ee),ee.getTargetRaySpace()},this.getControllerGrip=function(W){let ee=g[W];return ee===void 0&&(ee=new OD,g[W]=ee),ee.getGripSpace()},this.getHand=function(W){let ee=g[W];return ee===void 0&&(ee=new OD,g[W]=ee),ee.getHandSpace()};function D(W){let ee=y.indexOf(W.inputSource);if(ee===-1)return;let ae=g[ee];ae!==void 0&&ae.dispatchEvent({type:W.type,data:W.inputSource})}function N(){r.removeEventListener("select",D),r.removeEventListener("selectstart",D),r.removeEventListener("selectend",D),r.removeEventListener("squeeze",D),r.removeEventListener("squeezestart",D),r.removeEventListener("squeezeend",D),r.removeEventListener("end",N),r.removeEventListener("inputsourceschange",U);for(let W=0;W<g.length;W++){let ee=y[W];ee!==null&&(y[W]=null,g[W].disconnect(ee))}P=null,C=null,e.setRenderTarget(v),d=null,h=null,u=null,r=null,m=null,F.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(W){n=W,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){a=W,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(W){l=W},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(W){if(r=W,r!==null){if(v=e.getRenderTarget(),r.addEventListener("select",D),r.addEventListener("selectstart",D),r.addEventListener("selectend",D),r.addEventListener("squeeze",D),r.addEventListener("squeezestart",D),r.addEventListener("squeezeend",D),r.addEventListener("end",N),r.addEventListener("inputsourceschange",U),f.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let ee={antialias:r.renderState.layers===void 0?f.antialias:!0,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,t,ee),r.updateRenderState({baseLayer:d}),m=new Ii(d.framebufferWidth,d.framebufferHeight,{format:Rr,type:Js,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let ee=null,ae=null,K=null;f.depth&&(K=f.stencil?35056:33190,ee=f.stencil?Kf:Nf,ae=f.stencil?Of:Vu);let $={colorFormat:32856,depthFormat:K,scaleFactor:n};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer($),r.updateRenderState({layers:[h]}),m=new Ii(h.textureWidth,h.textureHeight,{format:Rr,type:Js,depthTexture:new r0(h.textureWidth,h.textureHeight,ae,void 0,void 0,void 0,void 0,void 0,void 0,ee),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});let ie=e.properties.get(m);ie.__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),F.setContext(r),F.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function U(W){for(let ee=0;ee<W.removed.length;ee++){let ae=W.removed[ee],K=y.indexOf(ae);K>=0&&(y[K]=null,g[K].disconnect(ae))}for(let ee=0;ee<W.added.length;ee++){let ae=W.added[ee],K=y.indexOf(ae);if(K===-1){for(let ie=0;ie<g.length;ie++)if(ie>=y.length){y.push(ae),K=ie;break}else if(y[ie]===null){y[ie]=ae,K=ie;break}if(K===-1)break}let $=g[K];$&&$.connect(ae)}}let I=new k,G=new k;function Q(W,ee,ae){I.setFromMatrixPosition(ee.matrixWorld),G.setFromMatrixPosition(ae.matrixWorld);let K=I.distanceTo(G),$=ee.projectionMatrix.elements,ie=ae.projectionMatrix.elements,ye=$[14]/($[10]-1),pe=$[14]/($[10]+1),me=($[9]+1)/$[5],ge=($[9]-1)/$[5],xe=($[8]-1)/$[0],te=(ie[8]+1)/ie[0],we=ye*xe,Ce=ye*te,Se=K/(-xe+te),Re=Se*-xe;ee.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(Re),W.translateZ(Se),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert();let Xe=ye+Se,Be=pe+Se,Fe=we-Re,dt=Ce+(K-Re),se=me*pe/Be*Xe,z=ge*pe/Be*Xe;W.projectionMatrix.makePerspective(Fe,dt,se,z,Xe,Be)}function Y(W,ee){ee===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(ee.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}this.updateCamera=function(W){if(r===null)return;A.near=S.near=M.near=W.near,A.far=S.far=M.far=W.far,(P!==A.near||C!==A.far)&&(r.updateRenderState({depthNear:A.near,depthFar:A.far}),P=A.near,C=A.far);let ee=W.parent,ae=A.cameras;Y(A,ee);for(let $=0;$<ae.length;$++)Y(ae[$],ee);A.matrixWorld.decompose(A.position,A.quaternion,A.scale),W.matrix.copy(A.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale);let K=W.children;for(let $=0,ie=K.length;$<ie;$++)K[$].updateMatrixWorld(!0);ae.length===2?Q(A,M,S):A.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return A},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(W){o=W,h!==null&&(h.fixedFoveation=W),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=W)},this.getPlanes=function(){return x};let O=null;function V(W,ee){if(c=ee.getViewerPose(l||s),p=ee,c!==null){let ae=c.views;d!==null&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));let K=!1;ae.length!==A.cameras.length&&(A.cameras.length=0,K=!0);for(let $=0;$<ae.length;$++){let ie=ae[$],ye=null;if(d!==null)ye=d.getViewport(ie);else{let me=u.getViewSubImage(h,ie);ye=me.viewport,$===0&&(e.setRenderTargetTextures(m,me.colorTexture,h.ignoreDepthValues?void 0:me.depthStencilTexture),e.setRenderTarget(m))}let pe=E[$];pe===void 0&&(pe=new Hs,pe.layers.enable($),pe.viewport=new li,E[$]=pe),pe.matrix.fromArray(ie.transform.matrix),pe.projectionMatrix.fromArray(ie.projectionMatrix),pe.viewport.set(ye.x,ye.y,ye.width,ye.height),$===0&&A.matrix.copy(pe.matrix),K===!0&&A.cameras.push(pe)}}for(let ae=0;ae<g.length;ae++){let K=y[ae],$=g[ae];K!==null&&$!==void 0&&$.update(K,ee,l||s)}if(O&&O(W,ee),ee.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:ee.detectedPlanes});let ae=null;for(let K of x)ee.detectedPlanes.has(K)||(ae===null&&(ae=[]),ae.push(K));if(ae!==null)for(let K of ae)x.delete(K),_.delete(K),i.dispatchEvent({type:"planeremoved",data:K});for(let K of ee.detectedPlanes)if(!x.has(K))x.add(K),_.set(K,ee.lastChangedTime),i.dispatchEvent({type:"planeadded",data:K});else{let $=_.get(K);K.lastChangedTime>$&&(_.set(K,K.lastChangedTime),i.dispatchEvent({type:"planechanged",data:K}))}}p=null}let F=new HJ;F.setAnimationLoop(V),this.setAnimationLoop=function(W){O=W},this.dispose=function(){}}};function $xe(e,t){function i(v,m){m.color.getRGB(v.fogColor.value,jJ(e)),m.isFog?(v.fogNear.value=m.near,v.fogFar.value=m.far):m.isFogExp2&&(v.fogDensity.value=m.density)}function r(v,m,g,y,x){m.isMeshBasicMaterial||m.isMeshLambertMaterial?n(v,m):m.isMeshToonMaterial?(n(v,m),u(v,m)):m.isMeshPhongMaterial?(n(v,m),c(v,m)):m.isMeshStandardMaterial?(n(v,m),h(v,m),m.isMeshPhysicalMaterial&&d(v,m,x)):m.isMeshMatcapMaterial?(n(v,m),p(v,m)):m.isMeshDepthMaterial?n(v,m):m.isMeshDistanceMaterial?(n(v,m),f(v,m)):m.isMeshNormalMaterial?n(v,m):m.isLineBasicMaterial?(s(v,m),m.isLineDashedMaterial&&a(v,m)):m.isPointsMaterial?o(v,m,g,y):m.isSpriteMaterial?l(v,m):m.isShadowMaterial?(v.color.value.copy(m.color),v.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(v,m){v.opacity.value=m.opacity,m.color&&v.diffuse.value.copy(m.color),m.emissive&&v.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(v.map.value=m.map),m.alphaMap&&(v.alphaMap.value=m.alphaMap),m.bumpMap&&(v.bumpMap.value=m.bumpMap,v.bumpScale.value=m.bumpScale,m.side===os&&(v.bumpScale.value*=-1)),m.displacementMap&&(v.displacementMap.value=m.displacementMap,v.displacementScale.value=m.displacementScale,v.displacementBias.value=m.displacementBias),m.emissiveMap&&(v.emissiveMap.value=m.emissiveMap),m.normalMap&&(v.normalMap.value=m.normalMap,v.normalScale.value.copy(m.normalScale),m.side===os&&v.normalScale.value.negate()),m.specularMap&&(v.specularMap.value=m.specularMap),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);let g=t.get(m).envMap;if(g&&(v.envMap.value=g,v.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=m.reflectivity,v.ior.value=m.ior,v.refractionRatio.value=m.refractionRatio),m.lightMap){v.lightMap.value=m.lightMap;let _=e.physicallyCorrectLights!==!0?Math.PI:1;v.lightMapIntensity.value=m.lightMapIntensity*_}m.aoMap&&(v.aoMap.value=m.aoMap,v.aoMapIntensity.value=m.aoMapIntensity);let y;m.map?y=m.map:m.specularMap?y=m.specularMap:m.displacementMap?y=m.displacementMap:m.normalMap?y=m.normalMap:m.bumpMap?y=m.bumpMap:m.roughnessMap?y=m.roughnessMap:m.metalnessMap?y=m.metalnessMap:m.alphaMap?y=m.alphaMap:m.emissiveMap?y=m.emissiveMap:m.clearcoatMap?y=m.clearcoatMap:m.clearcoatNormalMap?y=m.clearcoatNormalMap:m.clearcoatRoughnessMap?y=m.clearcoatRoughnessMap:m.iridescenceMap?y=m.iridescenceMap:m.iridescenceThicknessMap?y=m.iridescenceThicknessMap:m.specularIntensityMap?y=m.specularIntensityMap:m.specularColorMap?y=m.specularColorMap:m.transmissionMap?y=m.transmissionMap:m.thicknessMap?y=m.thicknessMap:m.sheenColorMap?y=m.sheenColorMap:m.sheenRoughnessMap&&(y=m.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),v.uvTransform.value.copy(y.matrix));let x;m.aoMap?x=m.aoMap:m.lightMap&&(x=m.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uv2Transform.value.copy(x.matrix))}function s(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity}function a(v,m){v.dashSize.value=m.dashSize,v.totalSize.value=m.dashSize+m.gapSize,v.scale.value=m.scale}function o(v,m,g,y){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.size.value=m.size*g,v.scale.value=y*.5,m.map&&(v.map.value=m.map),m.alphaMap&&(v.alphaMap.value=m.alphaMap),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);let x;m.map?x=m.map:m.alphaMap&&(x=m.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),v.uvTransform.value.copy(x.matrix))}function l(v,m){v.diffuse.value.copy(m.color),v.opacity.value=m.opacity,v.rotation.value=m.rotation,m.map&&(v.map.value=m.map),m.alphaMap&&(v.alphaMap.value=m.alphaMap),m.alphaTest>0&&(v.alphaTest.value=m.alphaTest);let g;m.map?g=m.map:m.alphaMap&&(g=m.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),v.uvTransform.value.copy(g.matrix))}function c(v,m){v.specular.value.copy(m.specular),v.shininess.value=Math.max(m.shininess,1e-4)}function u(v,m){m.gradientMap&&(v.gradientMap.value=m.gradientMap)}function h(v,m){v.roughness.value=m.roughness,v.metalness.value=m.metalness,m.roughnessMap&&(v.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(v.metalnessMap.value=m.metalnessMap),t.get(m).envMap&&(v.envMapIntensity.value=m.envMapIntensity)}function d(v,m,g){v.ior.value=m.ior,m.sheen>0&&(v.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),v.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(v.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(v.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(v.clearcoat.value=m.clearcoat,v.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(v.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(v.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),v.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===os&&v.clearcoatNormalScale.value.negate())),m.iridescence>0&&(v.iridescence.value=m.iridescence,v.iridescenceIOR.value=m.iridescenceIOR,v.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(v.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(v.transmission.value=m.transmission,v.transmissionSamplerMap.value=g.texture,v.transmissionSamplerSize.value.set(g.width,g.height),m.transmissionMap&&(v.transmissionMap.value=m.transmissionMap),v.thickness.value=m.thickness,m.thicknessMap&&(v.thicknessMap.value=m.thicknessMap),v.attenuationDistance.value=m.attenuationDistance,v.attenuationColor.value.copy(m.attenuationColor)),v.specularIntensity.value=m.specularIntensity,v.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(v.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(v.specularColorMap.value=m.specularColorMap)}function p(v,m){m.matcap&&(v.matcap.value=m.matcap)}function f(v,m){v.referencePosition.value.copy(m.referencePosition),v.nearDistance.value=m.nearDistance,v.farDistance.value=m.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function ebe(e,t,i,r){let n={},s={},a=[],o=i.isWebGL2?e.getParameter(35375):0;function l(y,x){let _=x.program;r.uniformBlockBinding(y,_)}function c(y,x){let _=n[y.id];_===void 0&&(f(y),_=u(y),n[y.id]=_,y.addEventListener("dispose",m));let M=x.program;r.updateUBOMapping(y,M);let S=t.render.frame;s[y.id]!==S&&(d(y),s[y.id]=S)}function u(y){let x=h();y.__bindingPointIndex=x;let _=e.createBuffer(),M=y.__size,S=y.usage;return e.bindBuffer(35345,_),e.bufferData(35345,M,S),e.bindBuffer(35345,null),e.bindBufferBase(35345,x,_),_}function h(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=n[y.id],_=y.uniforms,M=y.__cache;e.bindBuffer(35345,x);for(let S=0,E=_.length;S<E;S++){let A=_[S];if(p(A,S,M)===!0){let P=A.__offset,C=Array.isArray(A.value)?A.value:[A.value],D=0;for(let N=0;N<C.length;N++){let U=C[N],I=v(U);typeof U=="number"?(A.__data[0]=U,e.bufferSubData(35345,P+D,A.__data)):U.isMatrix3?(A.__data[0]=U.elements[0],A.__data[1]=U.elements[1],A.__data[2]=U.elements[2],A.__data[3]=U.elements[0],A.__data[4]=U.elements[3],A.__data[5]=U.elements[4],A.__data[6]=U.elements[5],A.__data[7]=U.elements[0],A.__data[8]=U.elements[6],A.__data[9]=U.elements[7],A.__data[10]=U.elements[8],A.__data[11]=U.elements[0]):(U.toArray(A.__data,D),D+=I.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,P,A.__data)}}e.bindBuffer(35345,null)}function p(y,x,_){let M=y.value;if(_[x]===void 0){if(typeof M=="number")_[x]=M;else{let S=Array.isArray(M)?M:[M],E=[];for(let A=0;A<S.length;A++)E.push(S[A].clone());_[x]=E}return!0}else if(typeof M=="number"){if(_[x]!==M)return _[x]=M,!0}else{let S=Array.isArray(_[x])?_[x]:[_[x]],E=Array.isArray(M)?M:[M];for(let A=0;A<S.length;A++){let P=S[A];if(P.equals(E[A])===!1)return P.copy(E[A]),!0}}return!1}function f(y){let x=y.uniforms,_=0,M=16,S=0;for(let E=0,A=x.length;E<A;E++){let P=x[E],C={boundary:0,storage:0},D=Array.isArray(P.value)?P.value:[P.value];for(let N=0,U=D.length;N<U;N++){let I=D[N],G=v(I);C.boundary+=G.boundary,C.storage+=G.storage}if(P.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=_,E>0){S=_%M;let N=M-S;S!==0&&N-C.boundary<0&&(_+=M-S,P.__offset=_)}_+=C.storage}return S=_%M,S>0&&(_+=M-S),y.__size=_,y.__cache={},this}function v(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function m(y){let x=y.target;x.removeEventListener("dispose",m);let _=a.indexOf(x.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function g(){for(let y in n)e.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:c,dispose:g}}function tbe(){let e=Vx("canvas");return e.style.display="block",e}function ZJ(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:tbe(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,n=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,a=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=jl,this.physicallyCorrectLights=!1,this.toneMapping=zc,this.toneMappingExposure=1;let v=this,m=!1,g=0,y=0,x=null,_=-1,M=null,S=new li,E=new li,A=null,P=t.width,C=t.height,D=1,N=null,U=null,I=new li(0,0,P,C),G=new li(0,0,P,C),Q=!1,Y=new rk,O=!1,V=!1,F=null,W=new lt,ee=new ve,ae=new k,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function $(){return x===null?D:1}let ie=i;function ye(le,Ge){for(let Ze=0;Ze<le.length;Ze++){let Ue=le[Ze],Je=t.getContext(Ue,Ge);if(Je!==null)return Je}return null}try{let le={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${C0}`),t.addEventListener("webglcontextlost",pt,!1),t.addEventListener("webglcontextrestored",st,!1),t.addEventListener("webglcontextcreationerror",ue,!1),ie===null){let Ge=["webgl2","webgl","experimental-webgl"];if(v.isWebGL1Renderer===!0&&Ge.shift(),ie=ye(Ge,le),ie===null)throw ye(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}ie.getShaderPrecisionFormat===void 0&&(ie.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(le){throw console.error("THREE.WebGLRenderer: "+le.message),le}let pe,me,ge,xe,te,we,Ce,Se,Re,Xe,Be,Fe,dt,se,z,X,ce,Ee,q,Ye,et,ke,_e,at;function Ve(){pe=new f1e(ie),me=new l1e(ie,pe,e),pe.init(me),ke=new Zxe(ie,pe,me),ge=new qxe(ie,pe,me),xe=new v1e,te=new Oxe,we=new Yxe(ie,pe,ge,te,me,ke,xe),Ce=new u1e(v),Se=new p1e(v),Re=new Ave(ie,me),_e=new a1e(ie,pe,Re,me),Xe=new m1e(ie,Re,xe,_e),Be=new w1e(ie,Xe,Re,xe),q=new b1e(ie,me,we),X=new c1e(te),Fe=new Ixe(v,Ce,Se,pe,me,_e,X),dt=new $xe(v,te),se=new zxe,z=new jxe(pe,me),Ee=new s1e(v,Ce,Se,ge,Be,u,a),ce=new Xxe(v,Be,me),at=new ebe(ie,xe,me,ge),Ye=new o1e(ie,pe,xe,me),et=new g1e(ie,pe,xe,me),xe.programs=Fe.programs,v.capabilities=me,v.extensions=pe,v.properties=te,v.renderLists=se,v.shadowMap=ce,v.state=ge,v.info=xe}Ve();let mt=new Jxe(v,ie);this.xr=mt,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){let le=pe.get("WEBGL_lose_context");le&&le.loseContext()},this.forceContextRestore=function(){let le=pe.get("WEBGL_lose_context");le&&le.restoreContext()},this.getPixelRatio=function(){return D},this.setPixelRatio=function(le){le!==void 0&&(D=le,this.setSize(P,C,!1))},this.getSize=function(le){return le.set(P,C)},this.setSize=function(le,Ge,Ze){if(mt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}P=le,C=Ge,t.width=Math.floor(le*D),t.height=Math.floor(Ge*D),Ze!==!1&&(t.style.width=le+"px",t.style.height=Ge+"px"),this.setViewport(0,0,le,Ge)},this.getDrawingBufferSize=function(le){return le.set(P*D,C*D).floor()},this.setDrawingBufferSize=function(le,Ge,Ze){P=le,C=Ge,D=Ze,t.width=Math.floor(le*Ze),t.height=Math.floor(Ge*Ze),this.setViewport(0,0,le,Ge)},this.getCurrentViewport=function(le){return le.copy(S)},this.getViewport=function(le){return le.copy(I)},this.setViewport=function(le,Ge,Ze,Ue){le.isVector4?I.set(le.x,le.y,le.z,le.w):I.set(le,Ge,Ze,Ue),ge.viewport(S.copy(I).multiplyScalar(D).floor())},this.getScissor=function(le){return le.copy(G)},this.setScissor=function(le,Ge,Ze,Ue){le.isVector4?G.set(le.x,le.y,le.z,le.w):G.set(le,Ge,Ze,Ue),ge.scissor(E.copy(G).multiplyScalar(D).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(le){ge.setScissorTest(Q=le)},this.setOpaqueSort=function(le){N=le},this.setTransparentSort=function(le){U=le},this.getClearColor=function(le){return le.copy(Ee.getClearColor())},this.setClearColor=function(){Ee.setClearColor.apply(Ee,arguments)},this.getClearAlpha=function(){return Ee.getClearAlpha()},this.setClearAlpha=function(){Ee.setClearAlpha.apply(Ee,arguments)},this.clear=function(le=!0,Ge=!0,Ze=!0){let Ue=0;le&&(Ue|=16384),Ge&&(Ue|=256),Ze&&(Ue|=1024),ie.clear(Ue)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pt,!1),t.removeEventListener("webglcontextrestored",st,!1),t.removeEventListener("webglcontextcreationerror",ue,!1),se.dispose(),z.dispose(),te.dispose(),Ce.dispose(),Se.dispose(),Be.dispose(),_e.dispose(),at.dispose(),Fe.dispose(),mt.dispose(),mt.removeEventListener("sessionstart",He),mt.removeEventListener("sessionend",Ae),F&&(F.dispose(),F=null),tt.stop()};function pt(le){le.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function st(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let le=xe.autoReset,Ge=ce.enabled,Ze=ce.autoUpdate,Ue=ce.needsUpdate,Je=ce.type;Ve(),xe.autoReset=le,ce.enabled=Ge,ce.autoUpdate=Ze,ce.needsUpdate=Ue,ce.type=Je}function ue(le){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",le.statusMessage)}function ze(le){let Ge=le.target;Ge.removeEventListener("dispose",ze),ut(Ge)}function ut(le){de(le),te.remove(le)}function de(le){let Ge=te.get(le).programs;Ge!==void 0&&(Ge.forEach(function(Ze){Fe.releaseProgram(Ze)}),le.isShaderMaterial&&Fe.releaseShaderCache(le))}this.renderBufferDirect=function(le,Ge,Ze,Ue,Je,It){Ge===null&&(Ge=K);let ei=Je.isMesh&&Je.matrixWorld.determinant()<0,oi=Ps(le,Ge,Ze,Ue,Je);ge.setMaterial(Ue,ei);let re=Ze.index,Te=1;Ue.wireframe===!0&&(re=Xe.getWireframeAttribute(Ze),Te=2);let Le=Ze.drawRange,Ie=Ze.attributes.position,Pe=Le.start*Te,gt=(Le.start+Le.count)*Te;It!==null&&(Pe=Math.max(Pe,It.start*Te),gt=Math.min(gt,(It.start+It.count)*Te)),re!==null?(Pe=Math.max(Pe,0),gt=Math.min(gt,re.count)):Ie!=null&&(Pe=Math.max(Pe,0),gt=Math.min(gt,Ie.count));let Lt=gt-Pe;if(Lt<0||Lt===1/0)return;_e.setup(Je,Ue,oi,Ze,re);let Ft,At=Ye;if(re!==null&&(Ft=Re.get(re),At=et,At.setIndex(Ft)),Je.isMesh)Ue.wireframe===!0?(ge.setLineWidth(Ue.wireframeLinewidth*$()),At.setMode(1)):At.setMode(4);else if(Je.isLine){let bt=Ue.linewidth;bt===void 0&&(bt=1),ge.setLineWidth(bt*$()),Je.isLineSegments?At.setMode(1):Je.isLineLoop?At.setMode(2):At.setMode(3)}else Je.isPoints?At.setMode(0):Je.isSprite&&At.setMode(4);if(Je.isInstancedMesh)At.renderInstances(Pe,Lt,Je.count);else if(Ze.isInstancedBufferGeometry){let bt=Ze._maxInstanceCount!==void 0?Ze._maxInstanceCount:1/0,Vt=Math.min(Ze.instanceCount,bt);At.renderInstances(Pe,Lt,Vt)}else At.render(Pe,Lt)},this.compile=function(le,Ge){function Ze(Ue,Je,It){Ue.transparent===!0&&Ue.side===qs&&Ue.forceSinglePass===!1?(Ue.side=os,Ue.needsUpdate=!0,Qt(Ue,Je,It),Ue.side=Vl,Ue.needsUpdate=!0,Qt(Ue,Je,It),Ue.side=qs):Qt(Ue,Je,It)}d=z.get(le),d.init(),f.push(d),le.traverseVisible(function(Ue){Ue.isLight&&Ue.layers.test(Ge.layers)&&(d.pushLight(Ue),Ue.castShadow&&d.pushShadow(Ue))}),d.setupLights(v.physicallyCorrectLights),le.traverse(function(Ue){let Je=Ue.material;if(Je)if(Array.isArray(Je))for(let It=0;It<Je.length;It++){let ei=Je[It];Ze(ei,le,Ue)}else Ze(Je,le,Ue)}),f.pop(),d=null};let Ne=null;function oe(le){Ne&&Ne(le)}function He(){tt.stop()}function Ae(){tt.start()}let tt=new HJ;tt.setAnimationLoop(oe),typeof self<"u"&&tt.setContext(self),this.setAnimationLoop=function(le){Ne=le,mt.setAnimationLoop(le),le===null?tt.stop():tt.start()},mt.addEventListener("sessionstart",He),mt.addEventListener("sessionend",Ae),this.render=function(le,Ge){if(Ge!==void 0&&Ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),Ge.parent===null&&Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),mt.enabled===!0&&mt.isPresenting===!0&&(mt.cameraAutoUpdate===!0&&mt.updateCamera(Ge),Ge=mt.getCamera()),le.isScene===!0&&le.onBeforeRender(v,le,Ge,x),d=z.get(le,f.length),d.init(),f.push(d),W.multiplyMatrices(Ge.projectionMatrix,Ge.matrixWorldInverse),Y.setFromProjectionMatrix(W),V=this.localClippingEnabled,O=X.init(this.clippingPlanes,V),h=se.get(le,p.length),h.init(),p.push(h),ct(le,Ge,0,v.sortObjects),h.finish(),v.sortObjects===!0&&h.sort(N,U),O===!0&&X.beginShadows();let Ze=d.state.shadowsArray;if(ce.render(Ze,le,Ge),O===!0&&X.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ee.render(h,le),d.setupLights(v.physicallyCorrectLights),Ge.isArrayCamera){let Ue=Ge.cameras;for(let Je=0,It=Ue.length;Je<It;Je++){let ei=Ue[Je];Dt(h,le,ei,ei.viewport)}}else Dt(h,le,Ge);x!==null&&(we.updateMultisampleRenderTarget(x),we.updateRenderTargetMipmap(x)),le.isScene===!0&&le.onAfterRender(v,le,Ge),_e.resetDefaultState(),_=-1,M=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function ct(le,Ge,Ze,Ue){if(le.visible===!1)return;if(le.layers.test(Ge.layers)){if(le.isGroup)Ze=le.renderOrder;else if(le.isLOD)le.autoUpdate===!0&&le.update(Ge);else if(le.isLight)d.pushLight(le),le.castShadow&&d.pushShadow(le);else if(le.isSprite){if(!le.frustumCulled||Y.intersectsSprite(le)){Ue&&ae.setFromMatrixPosition(le.matrixWorld).applyMatrix4(W);let It=Be.update(le),ei=le.material;ei.visible&&h.push(le,It,ei,Ze,ae.z,null)}}else if((le.isMesh||le.isLine||le.isPoints)&&(le.isSkinnedMesh&&le.skeleton.frame!==xe.render.frame&&(le.skeleton.update(),le.skeleton.frame=xe.render.frame),!le.frustumCulled||Y.intersectsObject(le))){Ue&&ae.setFromMatrixPosition(le.matrixWorld).applyMatrix4(W);let It=Be.update(le),ei=le.material;if(Array.isArray(ei)){let oi=It.groups;for(let re=0,Te=oi.length;re<Te;re++){let Le=oi[re],Ie=ei[Le.materialIndex];Ie&&Ie.visible&&h.push(le,It,Ie,Ze,ae.z,Le)}}else ei.visible&&h.push(le,It,ei,Ze,ae.z,null)}}let Je=le.children;for(let It=0,ei=Je.length;It<ei;It++)ct(Je[It],Ge,Ze,Ue)}function Dt(le,Ge,Ze,Ue){let Je=le.opaque,It=le.transmissive,ei=le.transparent;d.setupLightsView(Ze),O===!0&&X.setGlobalState(v.clippingPlanes,Ze),It.length>0&&ai(Je,Ge,Ze),Ue&&ge.viewport(S.copy(Ue)),Je.length>0&&Wt(Je,Ge,Ze),It.length>0&&Wt(It,Ge,Ze),ei.length>0&&Wt(ei,Ge,Ze),ge.buffers.depth.setTest(!0),ge.buffers.depth.setMask(!0),ge.buffers.color.setMask(!0),ge.setPolygonOffset(!1)}function ai(le,Ge,Ze){let Ue=me.isWebGL2;F===null&&(F=new Ii(1,1,{generateMipmaps:!0,type:pe.has("EXT_color_buffer_half_float")?sh:Js,minFilter:t0,samples:Ue&&s===!0?4:0})),v.getDrawingBufferSize(ee),Ue?F.setSize(ee.x,ee.y):F.setSize(EA(ee.x),EA(ee.y));let Je=v.getRenderTarget();v.setRenderTarget(F),v.clear();let It=v.toneMapping;v.toneMapping=zc,Wt(le,Ge,Ze),v.toneMapping=It,we.updateMultisampleRenderTarget(F),we.updateRenderTargetMipmap(F),v.setRenderTarget(Je)}function Wt(le,Ge,Ze){let Ue=Ge.isScene===!0?Ge.overrideMaterial:null;for(let Je=0,It=le.length;Je<It;Je++){let ei=le[Je],oi=ei.object,re=ei.geometry,Te=Ue===null?ei.material:Ue,Le=ei.group;oi.layers.test(Ze.layers)&&Ni(oi,Ge,Ze,re,Te,Le)}}function Ni(le,Ge,Ze,Ue,Je,It){le.onBeforeRender(v,Ge,Ze,Ue,Je,It),le.modelViewMatrix.multiplyMatrices(Ze.matrixWorldInverse,le.matrixWorld),le.normalMatrix.getNormalMatrix(le.modelViewMatrix),Je.onBeforeRender(v,Ge,Ze,Ue,le,It),Je.transparent===!0&&Je.side===qs&&Je.forceSinglePass===!1?(Je.side=os,Je.needsUpdate=!0,v.renderBufferDirect(Ze,Ge,Ue,Je,le,It),Je.side=Vl,Je.needsUpdate=!0,v.renderBufferDirect(Ze,Ge,Ue,Je,le,It),Je.side=qs):v.renderBufferDirect(Ze,Ge,Ue,Je,le,It),le.onAfterRender(v,Ge,Ze,Ue,Je,It)}function Qt(le,Ge,Ze){Ge.isScene!==!0&&(Ge=K);let Ue=te.get(le),Je=d.state.lights,It=d.state.shadowsArray,ei=Je.state.version,oi=Fe.getParameters(le,Je.state,It,Ge,Ze),re=Fe.getProgramCacheKey(oi),Te=Ue.programs;Ue.environment=le.isMeshStandardMaterial?Ge.environment:null,Ue.fog=Ge.fog,Ue.envMap=(le.isMeshStandardMaterial?Se:Ce).get(le.envMap||Ue.environment),Te===void 0&&(le.addEventListener("dispose",ze),Te=new Map,Ue.programs=Te);let Le=Te.get(re);if(Le!==void 0){if(Ue.currentProgram===Le&&Ue.lightsStateVersion===ei)return Ot(le,oi),Le}else oi.uniforms=Fe.getUniforms(le),le.onBuild(Ze,oi,v),le.onBeforeCompile(oi,v),Le=Fe.acquireProgram(oi,re),Te.set(re,Le),Ue.uniforms=oi.uniforms;let Ie=Ue.uniforms;(!le.isShaderMaterial&&!le.isRawShaderMaterial||le.clipping===!0)&&(Ie.clippingPlanes=X.uniform),Ot(le,oi),Ue.needsLights=al(le),Ue.lightsStateVersion=ei,Ue.needsLights&&(Ie.ambientLightColor.value=Je.state.ambient,Ie.lightProbe.value=Je.state.probe,Ie.directionalLights.value=Je.state.directional,Ie.directionalLightShadows.value=Je.state.directionalShadow,Ie.spotLights.value=Je.state.spot,Ie.spotLightShadows.value=Je.state.spotShadow,Ie.rectAreaLights.value=Je.state.rectArea,Ie.ltc_1.value=Je.state.rectAreaLTC1,Ie.ltc_2.value=Je.state.rectAreaLTC2,Ie.pointLights.value=Je.state.point,Ie.pointLightShadows.value=Je.state.pointShadow,Ie.hemisphereLights.value=Je.state.hemi,Ie.directionalShadowMap.value=Je.state.directionalShadowMap,Ie.directionalShadowMatrix.value=Je.state.directionalShadowMatrix,Ie.spotShadowMap.value=Je.state.spotShadowMap,Ie.spotLightMatrix.value=Je.state.spotLightMatrix,Ie.spotLightMap.value=Je.state.spotLightMap,Ie.pointShadowMap.value=Je.state.pointShadowMap,Ie.pointShadowMatrix.value=Je.state.pointShadowMatrix);let Pe=Le.getUniforms(),gt=gE.seqWithValue(Pe.seq,Ie);return Ue.currentProgram=Le,Ue.uniformsList=gt,Le}function Ot(le,Ge){let Ze=te.get(le);Ze.outputEncoding=Ge.outputEncoding,Ze.instancing=Ge.instancing,Ze.skinning=Ge.skinning,Ze.morphTargets=Ge.morphTargets,Ze.morphNormals=Ge.morphNormals,Ze.morphColors=Ge.morphColors,Ze.morphTargetsCount=Ge.morphTargetsCount,Ze.numClippingPlanes=Ge.numClippingPlanes,Ze.numIntersection=Ge.numClipIntersection,Ze.vertexAlphas=Ge.vertexAlphas,Ze.vertexTangents=Ge.vertexTangents,Ze.toneMapping=Ge.toneMapping}function Ps(le,Ge,Ze,Ue,Je){Ge.isScene!==!0&&(Ge=K),we.resetTextureUnits();let It=Ge.fog,ei=Ue.isMeshStandardMaterial?Ge.environment:null,oi=x===null?v.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:jl,re=(Ue.isMeshStandardMaterial?Se:Ce).get(Ue.envMap||ei),Te=Ue.vertexColors===!0&&!!Ze.attributes.color&&Ze.attributes.color.itemSize===4,Le=!!Ue.normalMap&&!!Ze.attributes.tangent,Ie=!!Ze.morphAttributes.position,Pe=!!Ze.morphAttributes.normal,gt=!!Ze.morphAttributes.color,Lt=Ue.toneMapped?v.toneMapping:zc,Ft=Ze.morphAttributes.position||Ze.morphAttributes.normal||Ze.morphAttributes.color,At=Ft!==void 0?Ft.length:0,bt=te.get(Ue),Vt=d.state.lights;if(O===!0&&(V===!0||le!==M)){let ne=le===M&&Ue.id===_;X.setState(Ue,le,ne)}let yt=!1;Ue.version===bt.__version?(bt.needsLights&&bt.lightsStateVersion!==Vt.state.version||bt.outputEncoding!==oi||Je.isInstancedMesh&&bt.instancing===!1||!Je.isInstancedMesh&&bt.instancing===!0||Je.isSkinnedMesh&&bt.skinning===!1||!Je.isSkinnedMesh&&bt.skinning===!0||bt.envMap!==re||Ue.fog===!0&&bt.fog!==It||bt.numClippingPlanes!==void 0&&(bt.numClippingPlanes!==X.numPlanes||bt.numIntersection!==X.numIntersection)||bt.vertexAlphas!==Te||bt.vertexTangents!==Le||bt.morphTargets!==Ie||bt.morphNormals!==Pe||bt.morphColors!==gt||bt.toneMapping!==Lt||me.isWebGL2===!0&&bt.morphTargetsCount!==At)&&(yt=!0):(yt=!0,bt.__version=Ue.version);let Vi=bt.currentProgram;yt===!0&&(Vi=Qt(Ue,Ge,Je));let Sr=!1,ki=!1,er=!1,Z=Vi.getUniforms(),J=bt.uniforms;if(ge.useProgram(Vi.program)&&(Sr=!0,ki=!0,er=!0),Ue.id!==_&&(_=Ue.id,ki=!0),Sr||M!==le){if(Z.setValue(ie,"projectionMatrix",le.projectionMatrix),me.logarithmicDepthBuffer&&Z.setValue(ie,"logDepthBufFC",2/(Math.log(le.far+1)/Math.LN2)),M!==le&&(M=le,ki=!0,er=!0),Ue.isShaderMaterial||Ue.isMeshPhongMaterial||Ue.isMeshToonMaterial||Ue.isMeshStandardMaterial||Ue.envMap){let ne=Z.map.cameraPosition;ne!==void 0&&ne.setValue(ie,ae.setFromMatrixPosition(le.matrixWorld))}(Ue.isMeshPhongMaterial||Ue.isMeshToonMaterial||Ue.isMeshLambertMaterial||Ue.isMeshBasicMaterial||Ue.isMeshStandardMaterial||Ue.isShaderMaterial)&&Z.setValue(ie,"isOrthographic",le.isOrthographicCamera===!0),(Ue.isMeshPhongMaterial||Ue.isMeshToonMaterial||Ue.isMeshLambertMaterial||Ue.isMeshBasicMaterial||Ue.isMeshStandardMaterial||Ue.isShaderMaterial||Ue.isShadowMaterial||Je.isSkinnedMesh)&&Z.setValue(ie,"viewMatrix",le.matrixWorldInverse)}if(Je.isSkinnedMesh){Z.setOptional(ie,Je,"bindMatrix"),Z.setOptional(ie,Je,"bindMatrixInverse");let ne=Je.skeleton;ne&&(me.floatVertexTextures?(ne.boneTexture===null&&ne.computeBoneTexture(),Z.setValue(ie,"boneTexture",ne.boneTexture,we),Z.setValue(ie,"boneTextureSize",ne.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let be=Ze.morphAttributes;if((be.position!==void 0||be.normal!==void 0||be.color!==void 0&&me.isWebGL2===!0)&&q.update(Je,Ze,Ue,Vi),(ki||bt.receiveShadow!==Je.receiveShadow)&&(bt.receiveShadow=Je.receiveShadow,Z.setValue(ie,"receiveShadow",Je.receiveShadow)),Ue.isMeshGouraudMaterial&&Ue.envMap!==null&&(J.envMap.value=re,J.flipEnvMap.value=re.isCubeTexture&&re.isRenderTargetTexture===!1?-1:1),ki&&(Z.setValue(ie,"toneMappingExposure",v.toneMappingExposure),bt.needsLights&&Kc(J,er),It&&Ue.fog===!0&&dt.refreshFogUniforms(J,It),dt.refreshMaterialUniforms(J,Ue,D,C,F),gE.upload(ie,bt.uniformsList,J,we)),Ue.isShaderMaterial&&Ue.uniformsNeedUpdate===!0&&(gE.upload(ie,bt.uniformsList,J,we),Ue.uniformsNeedUpdate=!1),Ue.isSpriteMaterial&&Z.setValue(ie,"center",Je.center),Z.setValue(ie,"modelViewMatrix",Je.modelViewMatrix),Z.setValue(ie,"normalMatrix",Je.normalMatrix),Z.setValue(ie,"modelMatrix",Je.matrixWorld),Je.previousModelViewMatrix&&Z.setValue(ie,"previousModelViewMatrix",Je.previousModelViewMatrix),le.previousProjectionMatrix&&Z.setValue(ie,"previousProjectionMatrix",le.previousProjectionMatrix),Ue.isShaderMaterial||Ue.isRawShaderMaterial){let ne=Ue.uniformsGroups;for(let Me=0,ht=ne.length;Me<ht;Me++)if(me.isWebGL2){let jr=ne[Me];at.update(jr,Vi),at.bind(jr,Vi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Vi}function Kc(le,Ge){le.ambientLightColor.needsUpdate=Ge,le.lightProbe.needsUpdate=Ge,le.directionalLights.needsUpdate=Ge,le.directionalLightShadows.needsUpdate=Ge,le.pointLights.needsUpdate=Ge,le.pointLightShadows.needsUpdate=Ge,le.spotLights.needsUpdate=Ge,le.spotLightShadows.needsUpdate=Ge,le.rectAreaLights.needsUpdate=Ge,le.hemisphereLights.needsUpdate=Ge}function al(le){return le.isMeshLambertMaterial||le.isMeshToonMaterial||le.isMeshPhongMaterial||le.isMeshStandardMaterial||le.isShadowMaterial||le.isShaderMaterial&&le.lights===!0}this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(le,Ge,Ze){te.get(le.texture).__webglTexture=Ge,te.get(le.depthTexture).__webglTexture=Ze;let Ue=te.get(le);Ue.__hasExternalTextures=!0,Ue.__hasExternalTextures&&(Ue.__autoAllocateDepthBuffer=Ze===void 0,Ue.__autoAllocateDepthBuffer||pe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ue.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(le,Ge){let Ze=te.get(le);Ze.__webglFramebuffer=Ge,Ze.__useDefaultFramebuffer=Ge===void 0},this.setRenderTarget=function(le,Ge=0,Ze=0){x=le,g=Ge,y=Ze;let Ue=!0,Je=null,It=!1,ei=!1;if(le){let oi=te.get(le);oi.__useDefaultFramebuffer!==void 0?(ge.bindFramebuffer(36160,null),Ue=!1):oi.__webglFramebuffer===void 0?we.setupRenderTarget(le):oi.__hasExternalTextures&&we.rebindTextures(le,te.get(le.texture).__webglTexture,te.get(le.depthTexture).__webglTexture);let re=le.texture;(re.isData3DTexture||re.isDataArrayTexture||re.isCompressedArrayTexture)&&(ei=!0);let Te=te.get(le).__webglFramebuffer;le.isWebGLCubeRenderTarget?(Je=Te[Ge],It=!0):me.isWebGL2&&le.samples>0&&we.useMultisampledRTT(le)===!1?Je=te.get(le).__webglMultisampledFramebuffer:Je=Te,S.copy(le.viewport),E.copy(le.scissor),A=le.scissorTest}else S.copy(I).multiplyScalar(D).floor(),E.copy(G).multiplyScalar(D).floor(),A=Q;if(ge.bindFramebuffer(36160,Je)&&me.drawBuffers&&Ue&&ge.drawBuffers(le,Je),ge.viewport(S),ge.scissor(E),ge.setScissorTest(A),It){let oi=te.get(le.texture);ie.framebufferTexture2D(36160,36064,34069+Ge,oi.__webglTexture,Ze)}else if(ei){let oi=te.get(le.texture),re=Ge||0;ie.framebufferTextureLayer(36160,36064,oi.__webglTexture,Ze||0,re)}_=-1},this.readRenderTargetPixels=function(le,Ge,Ze,Ue,Je,It,ei){if(!(le&&le.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let oi=te.get(le).__webglFramebuffer;if(le.isWebGLCubeRenderTarget&&ei!==void 0&&(oi=oi[ei]),oi){ge.bindFramebuffer(36160,oi);try{let re=le.texture,Te=re.format,Le=re.type;if(Te!==Rr&&ke.convert(Te)!==ie.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Ie=Le===sh&&(pe.has("EXT_color_buffer_half_float")||me.isWebGL2&&pe.has("EXT_color_buffer_float"));if(Le!==Js&&ke.convert(Le)!==ie.getParameter(35738)&&!(Le===rr&&(me.isWebGL2||pe.has("OES_texture_float")||pe.has("WEBGL_color_buffer_float")))&&!Ie){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ge>=0&&Ge<=le.width-Ue&&Ze>=0&&Ze<=le.height-Je&&ie.readPixels(Ge,Ze,Ue,Je,ke.convert(Te),ke.convert(Le),It)}finally{let re=x!==null?te.get(x).__webglFramebuffer:null;ge.bindFramebuffer(36160,re)}}},this.readRenderTargetPixelsAsync=async function(le,Ge,Ze,Ue,Je,It,ei){if(!(le&&le.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let oi=te.get(le).__webglFramebuffer;if(le.isWebGLCubeRenderTarget&&ei!==void 0&&(oi=oi[ei]),oi){let re=le.texture,Te=re.format,Le=re.type;if(Ge>=0&&Ge<=le.width-Ue&&Ze>=0&&Ze<=le.height-Je){ge.bindFramebuffer(ie.FRAMEBUFFER,oi);let Ie=ie.createBuffer();ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Ie),ie.bufferData(ie.PIXEL_PACK_BUFFER,It.byteLength,ie.STREAM_READ),ie.readPixels(Ge,Ze,Ue,Je,ke.convert(Te),ke.convert(Le),0);let Pe=x!==null?te.get(x).__webglFramebuffer:null;ge.bindFramebuffer(ie.FRAMEBUFFER,Pe);let gt=ie.fenceSync(ie.SYNC_GPU_COMMANDS_COMPLETE,0);return ie.flush(),await ave(ie,gt,4),ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Ie),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,It),ie.deleteBuffer(Ie),ie.deleteSync(gt),It}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(le,Ge,Ze=0){let Ue=Math.pow(2,-Ze),Je=Math.floor(Ge.image.width*Ue),It=Math.floor(Ge.image.height*Ue);we.setTexture2D(Ge,0),ie.copyTexSubImage2D(3553,Ze,0,0,le.x,le.y,Je,It),ge.unbindTexture()},this.copyTextureToTexture=function(le,Ge,Ze,Ue=0){let Je=Ge.image.width,It=Ge.image.height,ei=ke.convert(Ze.format),oi=ke.convert(Ze.type);we.setTexture2D(Ze,0),ie.pixelStorei(37440,Ze.flipY),ie.pixelStorei(37441,Ze.premultiplyAlpha),ie.pixelStorei(3317,Ze.unpackAlignment),Ge.isDataTexture?ie.texSubImage2D(3553,Ue,le.x,le.y,Je,It,ei,oi,Ge.image.data):Ge.isCompressedTexture?ie.compressedTexSubImage2D(3553,Ue,le.x,le.y,Ge.mipmaps[0].width,Ge.mipmaps[0].height,ei,Ge.mipmaps[0].data):ie.texSubImage2D(3553,Ue,le.x,le.y,ei,oi,Ge.image),Ue===0&&Ze.generateMipmaps&&ie.generateMipmap(3553),ge.unbindTexture()},this.copyTextureToTexture3D=function(le,Ge,Ze,Ue,Je=0){if(v.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let It=le.max.x-le.min.x+1,ei=le.max.y-le.min.y+1,oi=le.max.z-le.min.z+1,re=ke.convert(Ue.format),Te=ke.convert(Ue.type),Le;if(Ue.isData3DTexture)we.setTexture3D(Ue,0),Le=32879;else if(Ue.isDataArrayTexture)we.setTexture2DArray(Ue,0),Le=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}ie.pixelStorei(37440,Ue.flipY),ie.pixelStorei(37441,Ue.premultiplyAlpha),ie.pixelStorei(3317,Ue.unpackAlignment);let Ie=ie.getParameter(3314),Pe=ie.getParameter(32878),gt=ie.getParameter(3316),Lt=ie.getParameter(3315),Ft=ie.getParameter(32877),At=Ze.isCompressedTexture?Ze.mipmaps[0]:Ze.image;ie.pixelStorei(3314,At.width),ie.pixelStorei(32878,At.height),ie.pixelStorei(3316,le.min.x),ie.pixelStorei(3315,le.min.y),ie.pixelStorei(32877,le.min.z),Ze.isDataTexture||Ze.isData3DTexture?ie.texSubImage3D(Le,Je,Ge.x,Ge.y,Ge.z,It,ei,oi,re,Te,At.data):Ze.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ie.compressedTexSubImage3D(Le,Je,Ge.x,Ge.y,Ge.z,It,ei,oi,re,At.data)):ie.texSubImage3D(Le,Je,Ge.x,Ge.y,Ge.z,It,ei,oi,re,Te,At),ie.pixelStorei(3314,Ie),ie.pixelStorei(32878,Pe),ie.pixelStorei(3316,gt),ie.pixelStorei(3315,Lt),ie.pixelStorei(32877,Ft),Je===0&&Ue.generateMipmaps&&ie.generateMipmap(Le),ge.unbindTexture()},this.initRenderTarget=function(le){te.get(le).__webglFramebuffer===void 0&&we.setupRenderTarget(le)},this.initTexture=function(le){le.isCubeTexture?we.setTextureCube(le,0):le.isData3DTexture?we.setTexture3D(le,0):le.isDataArrayTexture||le.isCompressedArrayTexture?we.setTexture2DArray(le,0):we.setTexture2D(le,0),ge.unbindTexture()},this.resetState=function(){g=0,y=0,x=null,ge.reset(),_e.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var ibe=class extends ZJ{};ibe.prototype.isWebGL1Renderer=!0;var QJ=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Yt(e),this.near=t,this.far=i}clone(){return new QJ(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Wa=class extends $i{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},rbe=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=EI,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Jo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Jo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Jo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},na=new k,DI=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)na.fromBufferAttribute(this,t),na.applyMatrix4(e),this.setXYZ(t,na.x,na.y,na.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)na.fromBufferAttribute(this,t),na.applyNormalMatrix(e),this.setXYZ(t,na.x,na.y,na.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)na.fromBufferAttribute(this,t),na.transformDirection(e),this.setXYZ(t,na.x,na.y,na.z);return this}setX(e,t){return this.normalized&&(t=mr(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=mr(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=mr(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=mr(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ju(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ju(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ju(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ju(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=mr(t,this.array),i=mr(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=mr(t,this.array),i=mr(i,this.array),r=mr(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=mr(t,this.array),i=mr(i,this.array),r=mr(r,this.array),n=mr(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return new Zt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new DI(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},KJ=class extends $i{constructor(){super(),this.isBone=!0,this.type="Bone"}},ga=class extends Fr{constructor(t=null,i=1,r=1,n,s,a,o,l,c=_i,u=_i,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},Q6=new lt,nbe=new lt,sk=class{constructor(e=[],t=[]){this.uuid=Jo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new lt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new lt;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=e.length;n<s;n++){let a=e[n]?e[n].matrixWorld:nbe;Q6.multiplyMatrices(a,t[n]),Q6.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new sk(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=OJ(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new ga(t,e,e,Rr,rr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let n=e.bones[i],s=t[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new KJ),this.bones.push(s),this.boneInverses.push(new lt().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,n=t.length;r<n;r++){let s=t[r];e.bones.push(s.uuid);let a=i[r];e.boneInverses.push(a.toArray())}return e}},jx=class extends Zt{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},K6=new lt,J6=new lt,K_=[],sbe=new lt,Ly=new gr,abe=class extends gr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new jx(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,sbe)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(Ly.geometry=this.geometry,Ly.material=this.material,Ly.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,K6),J6.multiplyMatrices(i,K6),Ly.matrixWorld=J6,Ly.raycast(e,K_);for(let s=0,a=K_.length;s<a;s++){let o=K_[s];o.instanceId=n,o.object=this,t.push(o)}K_.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new jx(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},lp=class extends Wb{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Yt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},$6=new k,eH=new k,tH=new lt,ND=new T0,J_=new Xa,AA=class extends $i{constructor(e=new Bt,t=new lp){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,n=t.count;r<n;r++)$6.fromBufferAttribute(t,r-1),eH.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=$6.distanceTo(eH);e.setAttribute("lineDistance",new _t(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,n=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),J_.copy(i.boundingSphere),J_.applyMatrix4(r),J_.radius+=n,e.ray.intersectsSphere(J_)===!1)return;tH.copy(r).invert(),ND.copy(e.ray).applyMatrix4(tH);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new k,c=new k,u=new k,h=new k,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){let v=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let g=v,y=m-1;g<y;g+=d){let x=p.getX(g),_=p.getX(g+1);if(l.fromBufferAttribute(f,x),c.fromBufferAttribute(f,_),ND.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let M=e.ray.origin.distanceTo(h);M<e.near||M>e.far||t.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else{let v=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count);for(let g=v,y=m-1;g<y;g+=d){if(l.fromBufferAttribute(f,g),c.fromBufferAttribute(f,g+1),ND.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(h);x<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},iH=new k,rH=new k,Xb=class extends AA{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,n=t.count;r<n;r+=2)iH.fromBufferAttribute(t,r),rH.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+iH.distanceTo(rH);e.setAttribute("lineDistance",new _t(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},obe=class extends Fr{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:gi,this.magFilter=n!==void 0?n:gi,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},lbe=class extends Fr{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},qc=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),n=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),n+=i.distanceTo(r),t.push(n),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,n=i.length,s;t?s=t:s=e*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=t||(n.isVector2?new ve:new k);return a.copy(s).sub(n).normalize(),a}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new k,r=[],n=[],s=[],a=new k,o=new lt;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new k)}n[0]=new k,s[0]=new k;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=e;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let p=Math.acos(wn(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,p))}s[d].crossVectors(r[d],n[d])}if(t===!0){let d=Math.acos(wn(n[0].dot(n[e]),-1,1));d/=e,r[0].dot(a.crossVectors(n[0],n[e]))>0&&(d=-d);for(let p=1;p<=e;p++)n[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],n[p])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},mT=class extends qc{constructor(e=0,t=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t){let i=t||new ve,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+e*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},cbe=class extends mT{constructor(e,t,i,r,n,s){super(e,t,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function ak(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){let a=s*s,o=a*s;return e+t*s+i*a+r*o}}}var $_=new k,zD=new ak,BD=new ak,kD=new ak,ube=class extends qc{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new k){let i=t,r=this.points,n=r.length,s=(n-(this.closed?0:1))*e,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:($_.subVectors(r[0],r[1]).add(r[0]),l=$_);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:($_.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=$_),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),v<1e-4&&(v=f),zD.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,p,f,v),BD.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,p,f,v),kD.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,p,f,v)}else this.curveType==="catmullrom"&&(zD.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),BD.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),kD.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(zD.calc(o),BD.calc(o),kD.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new k().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function nH(e,t,i,r,n){let s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function hbe(e,t){let i=1-e;return i*i*t}function dbe(e,t){return 2*(1-e)*e*t}function pbe(e,t){return e*e*t}function Q1(e,t,i,r){return hbe(e,t)+dbe(e,i)+pbe(e,r)}function fbe(e,t){let i=1-e;return i*i*i*t}function mbe(e,t){let i=1-e;return 3*i*i*e*t}function gbe(e,t){return 3*(1-e)*e*e*t}function vbe(e,t){return e*e*e*t}function K1(e,t,i,r,n){return fbe(e,t)+mbe(e,i)+gbe(e,r)+vbe(e,n)}var Ol=class extends qc{constructor(e=new ve,t=new ve,i=new ve,r=new ve){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ve){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(K1(e,r.x,n.x,s.x,a.x),K1(e,r.y,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},vE=class extends qc{constructor(e=new k,t=new k,i=new k,r=new k){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new k){let i=t,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(K1(e,r.x,n.x,s.x,a.x),K1(e,r.y,n.y,s.y,a.y),K1(e,r.z,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Ul=class extends qc{constructor(e=new ve,t=new ve){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ve){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new ve;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},JJ=class extends qc{constructor(e=new k,t=new k){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new k){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Zd=class extends qc{constructor(e=new ve,t=new ve,i=new ve){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ve){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(Q1(e,r.x,n.x,s.x),Q1(e,r.y,n.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},ybe=class extends qc{constructor(e=new k,t=new k,i=new k){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new k){let i=t,r=this.v0,n=this.v1,s=this.v2;return i.set(Q1(e,r.x,n.x,s.x),Q1(e,r.y,n.y,s.y),Q1(e,r.z,n.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},ok=class extends qc{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ve){let i=t,r=this.points,n=(r.length-1)*e,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(nH(a,o.x,l.x,c.x,u.x),nH(a,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new ve().fromArray(r))}return this}},xbe=Object.freeze({__proto__:null,ArcCurve:cbe,CatmullRomCurve3:ube,CubicBezierCurve:Ol,CubicBezierCurve3:vE,EllipseCurve:mT,LineCurve:Ul,LineCurve3:JJ,QuadraticBezierCurve:Zd,QuadraticBezierCurve3:ybe,SplineCurve:ok}),$J=class extends qc{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ul(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,t)}n++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new xbe[r.type]().fromJSON(r))}return this}},CA=class extends $J{constructor(e){super(),this.type="Path",this.currentPoint=new ve,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Ul(this.currentPoint.clone(),new ve(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let n=new Zd(this.currentPoint.clone(),new ve(e,t),new ve(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,n,s){let a=new Ol(this.currentPoint.clone(),new ve(e,t),new ve(i,r),new ve(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new ok(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,i,r,n,s),this}absarc(e,t,i,r,n,s){return this.absellipse(e,t,i,i,r,n,s),this}ellipse(e,t,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,n,s,a,o),this}absellipse(e,t,i,r,n,s,a,o){let l=new mT(e,t,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},e$=class extends Bt{constructor(e=[new ve(0,-.5),new ve(.5,0),new ve(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=wn(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/t,u=new k,h=new ve,d=new k,p=new k,f=new k,v=0,m=0;for(let g=0;g<=e.length-1;g++)switch(g){case 0:v=e[g+1].x-e[g].x,m=e[g+1].y-e[g].y,d.x=m*1,d.y=-v,d.z=m*0,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:v=e[g+1].x-e[g].x,m=e[g+1].y-e[g].y,d.x=m*1,d.y=-v,d.z=m*0,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let g=0;g<=t;g++){let y=i+g*c*r,x=Math.sin(y),_=Math.cos(y);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*x,u.y=e[M].y,u.z=e[M].x*_,s.push(u.x,u.y,u.z),h.x=g/t,h.y=M/(e.length-1),a.push(h.x,h.y);let S=o[3*M+0]*x,E=o[3*M+1],A=o[3*M+0]*_;l.push(S,E,A)}}for(let g=0;g<t;g++)for(let y=0;y<e.length-1;y++){let x=y+g*e.length,_=x,M=x+e.length,S=x+e.length+1,E=x+1;n.push(_,M,E),n.push(S,E,M)}this.setIndex(n),this.setAttribute("position",new _t(s,3)),this.setAttribute("uv",new _t(a,2)),this.setAttribute("normal",new _t(l,3))}static fromJSON(e){return new e$(e.points,e.segments,e.phiStart,e.phiLength)}},lk=class extends Bt{constructor(e=1,t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],p=0,f=[],v=i/2,m=0;g(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new _t(u,3)),this.setAttribute("normal",new _t(h,3)),this.setAttribute("uv",new _t(d,2));function g(){let x=new k,_=new k,M=0,S=(t-e)/i;for(let E=0;E<=n;E++){let A=[],P=E/n,C=P*(t-e)+e;for(let D=0;D<=r;D++){let N=D/r,U=N*o+a,I=Math.sin(U),G=Math.cos(U);_.x=C*I,_.y=-P*i+v,_.z=C*G,u.push(_.x,_.y,_.z),x.set(I,S,G).normalize(),h.push(x.x,x.y,x.z),d.push(N,1-P),A.push(p++)}f.push(A)}for(let E=0;E<r;E++)for(let A=0;A<n;A++){let P=f[A][E],C=f[A+1][E],D=f[A+1][E+1],N=f[A][E+1];c.push(P,C,N),c.push(C,D,N),M+=6}l.addGroup(m,M,0),m+=M}function y(x){let _=p,M=new ve,S=new k,E=0,A=x===!0?e:t,P=x===!0?1:-1;for(let D=1;D<=r;D++)u.push(0,v*P,0),h.push(0,P,0),d.push(.5,.5),p++;let C=p;for(let D=0;D<=r;D++){let N=D/r*o+a,U=Math.cos(N),I=Math.sin(N);S.x=A*I,S.y=v*P,S.z=A*U,u.push(S.x,S.y,S.z),h.push(0,P,0),M.x=U*.5+.5,M.y=I*.5*P+.5,d.push(M.x,M.y),p++}for(let D=0;D<r;D++){let N=_+D,U=C+D;x===!0?c.push(U,U+1,N):c.push(U+1,U,N),E+=3}l.addGroup(m,E,x===!0?1:2),m+=E}}static fromJSON(e){return new lk(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},ck=class extends lk{constructor(e=1,t=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,e,t,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(e){return new ck(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},uk=class extends Bt{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new _t(n,3)),this.setAttribute("normal",new _t(n.slice(),3)),this.setAttribute("uv",new _t(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(g){let y=new k,x=new k,_=new k;for(let M=0;M<t.length;M+=3)d(t[M+0],y),d(t[M+1],x),d(t[M+2],_),o(y,x,_,g)}function o(g,y,x,_){let M=_+1,S=[];for(let E=0;E<=M;E++){S[E]=[];let A=g.clone().lerp(x,E/M),P=y.clone().lerp(x,E/M),C=M-E;for(let D=0;D<=C;D++)D===0&&E===M?S[E][D]=A:S[E][D]=A.clone().lerp(P,D/C)}for(let E=0;E<M;E++)for(let A=0;A<2*(M-E)-1;A++){let P=Math.floor(A/2);A%2===0?(h(S[E][P+1]),h(S[E+1][P]),h(S[E][P])):(h(S[E][P+1]),h(S[E+1][P+1]),h(S[E+1][P]))}}function l(g){let y=new k;for(let x=0;x<n.length;x+=3)y.x=n[x+0],y.y=n[x+1],y.z=n[x+2],y.normalize().multiplyScalar(g),n[x+0]=y.x,n[x+1]=y.y,n[x+2]=y.z}function c(){let g=new k;for(let y=0;y<n.length;y+=3){g.x=n[y+0],g.y=n[y+1],g.z=n[y+2];let x=v(g)/2/Math.PI+.5,_=m(g)/Math.PI+.5;s.push(x,1-_)}p(),u()}function u(){for(let g=0;g<s.length;g+=6){let y=s[g+0],x=s[g+2],_=s[g+4],M=Math.max(y,x,_),S=Math.min(y,x,_);M>.9&&S<.1&&(y<.2&&(s[g+0]+=1),x<.2&&(s[g+2]+=1),_<.2&&(s[g+4]+=1))}}function h(g){n.push(g.x,g.y,g.z)}function d(g,y){let x=g*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function p(){let g=new k,y=new k,x=new k,_=new k,M=new ve,S=new ve,E=new ve;for(let A=0,P=0;A<n.length;A+=9,P+=6){g.set(n[A+0],n[A+1],n[A+2]),y.set(n[A+3],n[A+4],n[A+5]),x.set(n[A+6],n[A+7],n[A+8]),M.set(s[P+0],s[P+1]),S.set(s[P+2],s[P+3]),E.set(s[P+4],s[P+5]),_.copy(g).add(y).add(x).divideScalar(3);let C=v(_);f(M,P+0,g,C),f(S,P+2,y,C),f(E,P+4,x,C)}}function f(g,y,x,_){_<0&&g.x===1&&(s[y]=g.x-1),x.x===0&&x.z===0&&(s[y]=_/2/Math.PI+.5)}function v(g){return Math.atan2(g.z,-g.x)}function m(g){return Math.atan2(-g.y,Math.sqrt(g.x*g.x+g.z*g.z))}}static fromJSON(e){return new uk(e.vertices,e.indices,e.radius,e.details)}},t$=class extends uk{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new t$(e.radius,e.detail)}},TA=class extends CA{constructor(e){super(e),this.uuid=Jo(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new CA().fromJSON(r))}return this}},bbe={triangulate:function(e,t,i=2){let r=t&&t.length,n=r?t[0]*i:e.length,s=i$(e,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=Ebe(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<n;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return Hx(s,a,i,o,l,p,0),a}};function i$(e,t,i,r,n){let s,a;if(n===zbe(e,t,i,r)>0)for(s=t;s<i;s+=r)a=sH(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=sH(s,e[s],e[s+1],a);return a&&gT(a,a.next)&&(Wx(a),a=a.next),a}function Jf(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(gT(i,i.next)||Br(i.prev,i,i.next)===0)){if(Wx(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Hx(e,t,i,r,n,s,a){if(!e)return;!a&&s&&Dbe(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?_be(e,r,n,s):wbe(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),Wx(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=Sbe(Jf(e),t,i),Hx(e,t,i,r,n,s,2)):a===2&&Mbe(e,t,i,r,n,s):Hx(Jf(e),t,i,r,n,s,1);break}}}function wbe(e){let t=e.prev,i=e,r=e.next;if(Br(t,i,r)>=0)return!1;let n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c,f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&fv(n,o,s,l,a,c,f.x,f.y)&&Br(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function _be(e,t,i,r){let n=e.prev,s=e,a=e.next;if(Br(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=LI(p,f,t,i,r),y=LI(v,m,t,i,r),x=e.prevZ,_=e.nextZ;for(;x&&x.z>=g&&_&&_.z<=y;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=m&&x!==n&&x!==a&&fv(o,u,l,h,c,d,x.x,x.y)&&Br(x.prev,x,x.next)>=0||(x=x.prevZ,_.x>=p&&_.x<=v&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&fv(o,u,l,h,c,d,_.x,_.y)&&Br(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=m&&x!==n&&x!==a&&fv(o,u,l,h,c,d,x.x,x.y)&&Br(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=y;){if(_.x>=p&&_.x<=v&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&fv(o,u,l,h,c,d,_.x,_.y)&&Br(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Sbe(e,t,i){let r=e;do{let n=r.prev,s=r.next.next;!gT(n,s)&&r$(n,r,r.next,s)&&Gx(n,s)&&Gx(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Wx(r),Wx(r.next),r=e=s),r=r.next}while(r!==e);return Jf(r)}function Mbe(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&Ibe(a,o)){let l=n$(a,o);a=Jf(a,a.next),l=Jf(l,l.next),Hx(a,t,i,r,n,s,0),Hx(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function Ebe(e,t,i,r){let n=[],s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=i$(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(Rbe(c));for(n.sort(Abe),s=0;s<n.length;s++)i=Cbe(n[s],i);return i}function Abe(e,t){return e.x-t.x}function Cbe(e,t){let i=Tbe(e,t);if(!i)return t;let r=n$(i,e);return Jf(r,r.next),Jf(i,i.next)}function Tbe(e,t){let i=t,r=-1/0,n,s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&fv(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Gx(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&Pbe(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function Pbe(e,t){return Br(e.prev,e,t.prev)<0&&Br(t.next,e,e.next)<0}function Dbe(e,t,i,r){let n=e;do n.z===0&&(n.z=LI(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,Lbe(n)}function Lbe(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function LI(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Rbe(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function fv(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function Ibe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!Obe(e,t)&&(Gx(e,t)&&Gx(t,e)&&Nbe(e,t)&&(Br(e.prev,e,t.prev)||Br(e,t.prev,t))||gT(e,t)&&Br(e.prev,e,e.next)>0&&Br(t.prev,t,t.next)>0)}function Br(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function gT(e,t){return e.x===t.x&&e.y===t.y}function r$(e,t,i,r){let n=tS(Br(e,t,i)),s=tS(Br(e,t,r)),a=tS(Br(i,r,e)),o=tS(Br(i,r,t));return!!(n!==s&&a!==o||n===0&&eS(e,i,t)||s===0&&eS(e,r,t)||a===0&&eS(i,e,r)||o===0&&eS(i,t,r))}function eS(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function tS(e){return e>0?1:e<0?-1:0}function Obe(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&r$(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Gx(e,t){return Br(e.prev,e,e.next)<0?Br(e,t,e.next)>=0&&Br(e,e.prev,t)>=0:Br(e,t,e.prev)<0||Br(e,e.next,t)<0}function Nbe(e,t){let i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function n$(e,t){let i=new RI(e.i,e.x,e.y),r=new RI(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function sH(e,t,i,r){let n=new RI(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Wx(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function RI(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zbe(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}var s$=class{static area(e){let t=e.length,i=0;for(let r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return i*.5}static isClockWise(e){return s$.area(e)<0}static triangulateShape(e,t){let i=[],r=[],n=[];aH(e),oH(i,e);let s=e.length;t.forEach(aH);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,oH(i,t[o]);let a=bbe.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function aH(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function oH(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var a$=class extends uk{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new a$(e.radius,e.detail)}},Lv=class extends Bt{constructor(e=1,t=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new k,h=new k,d=[],p=[],f=[],v=[];for(let m=0;m<=i;m++){let g=[],y=m/i,x=0;m==0&&s==0?x=.5/t:m==i&&o==Math.PI&&(x=-.5/t);for(let _=0;_<=t;_++){let M=_/t;u.x=-e*Math.cos(r+M*n)*Math.sin(s+y*a),u.y=e*Math.cos(s+y*a),u.z=e*Math.sin(r+M*n)*Math.sin(s+y*a),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),v.push(M+x,1-y),g.push(l++)}c.push(g)}for(let m=0;m<i;m++)for(let g=0;g<t;g++){let y=c[m][g+1],x=c[m][g],_=c[m+1][g],M=c[m+1][g+1];(m!==0||s>0)&&d.push(y,x,M),(m!==i-1||o<Math.PI)&&d.push(x,_,M)}this.setIndex(d),this.setAttribute("position",new _t(p,3)),this.setAttribute("normal",new _t(f,3)),this.setAttribute("uv",new _t(v,2))}static fromJSON(e){return new Lv(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},o$=class extends Bt{constructor(e=1,t=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new k,u=new k,h=new k;for(let d=0;d<=i;d++)for(let p=0;p<=r;p++){let f=p/r*n,v=d/i*Math.PI*2;u.x=(e+t*Math.cos(v))*Math.cos(f),u.y=(e+t*Math.cos(v))*Math.sin(f),u.z=t*Math.sin(v),a.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(p/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=r;p++){let f=(r+1)*d+p-1,v=(r+1)*(d-1)+p-1,m=(r+1)*(d-1)+p,g=(r+1)*d+p;s.push(f,v,g),s.push(v,m,g)}this.setIndex(s),this.setAttribute("position",new _t(a,3)),this.setAttribute("normal",new _t(o,3)),this.setAttribute("uv",new _t(l,2))}static fromJSON(e){return new o$(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},l$=class extends Bt{constructor(e=1,t=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new k,h=new k,d=new k,p=new k,f=new k,v=new k,m=new k;for(let y=0;y<=i;++y){let x=y/i*n*Math.PI*2;g(x,n,s,e,d),g(x+.01,n,s,e,p),v.subVectors(p,d),m.addVectors(p,d),f.crossVectors(v,m),m.crossVectors(f,v),f.normalize(),m.normalize();for(let _=0;_<=r;++_){let M=_/r*Math.PI*2,S=-t*Math.cos(M),E=t*Math.sin(M);u.x=d.x+(S*m.x+E*f.x),u.y=d.y+(S*m.y+E*f.y),u.z=d.z+(S*m.z+E*f.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/i),c.push(_/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let _=(r+1)*(y-1)+(x-1),M=(r+1)*y+(x-1),S=(r+1)*y+x,E=(r+1)*(y-1)+x;a.push(_,M,E),a.push(M,S,E)}this.setIndex(a),this.setAttribute("position",new _t(o,3)),this.setAttribute("normal",new _t(l,3)),this.setAttribute("uv",new _t(c,2));function g(y,x,_,M,S){let E=Math.cos(y),A=Math.sin(y),P=_/x*y,C=Math.cos(P);S.x=M*(2+C)*.5*E,S.y=M*(2+C)*A*.5,S.z=M*Math.sin(P)*.5}}static fromJSON(e){return new l$(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}},Bbe=class extends Oi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Rh(e,t,i){return c$(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function iS(e,t,i){return!e||e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function c$(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function kbe(e){function t(n,s){return e[n]-e[s]}let i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function lH(e,t,i){let r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function u$(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}var vT=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=n)){let a=t[1];e<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=t[--i-1],e>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;e<t[a]?s=a:i=a+1}if(r=t[i],n=t[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r;for(let s=0;s!==r;++s)t[s]=i[n+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},Ube=class extends vT{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:hv,endingEnd:hv}}intervalChanged_(e,t,i){let r=this.parameterPositions,n=e-2,s=e+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case dv:n=e,a=2*t-i;break;case SA:n=r.length-2,a=t+r[n]-r[n+1];break;default:n=e,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case dv:s=e,o=2*i-t;break;case SA:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,v=f*p,m=-h*v+2*h*f-h*p,g=(1+h)*v+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*v+(1.5+d)*f+.5*p,x=d*v-d*f;for(let _=0;_!==a;++_)n[_]=m*s[c+_]+g*s[l+_]+y*s[o+_]+x*s[u+_];return n}},h$=class extends vT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},Fbe=class extends vT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},Yc=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=iS(t,this.TimeBufferType),this.values=iS(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:iS(e.times,Array),values:iS(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Fbe(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new h$(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Ube(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case wA:t=this.InterpolantFactoryMethodDiscrete;break;case _A:t=this.InterpolantFactoryMethodLinear;break;case cD:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return wA;case this.InterpolantFactoryMethodLinear:return _A;case this.InterpolantFactoryMethodSmooth:return cD}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<e;)++n;for(;s!==-1&&i[s]>t;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Rh(i,n,s),this.values=Rh(this.values,n*a,s*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),e=!1;break}s=o}if(r!==void 0&&c$(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Rh(this.times),t=Rh(this.values),i=this.getValueSize(),r=this.getInterpolation()===cD,n=e.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let p=0;p!==i;++p){let f=t[u+p];if(f!==t[h+p]||f!==t[d+p]){o=!0;break}}}if(o){if(a!==s){e[s]=e[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(n>0){e[s]=e[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[a+l];++s}return s!==e.length?(this.times=Rh(e,0,s),this.values=Rh(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=Rh(this.times,0),t=Rh(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};Yc.prototype.TimeBufferType=Float32Array;Yc.prototype.ValueBufferType=Float32Array;Yc.prototype.DefaultInterpolation=_A;var L0=class extends Yc{};L0.prototype.ValueTypeName="bool";L0.prototype.ValueBufferType=Array;L0.prototype.DefaultInterpolation=wA;L0.prototype.InterpolantFactoryMethodLinear=void 0;L0.prototype.InterpolantFactoryMethodSmooth=void 0;var d$=class extends Yc{};d$.prototype.ValueTypeName="color";var PA=class extends Yc{};PA.prototype.ValueTypeName="number";var Vbe=class extends vT{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-t)/(r-t),l=e*a;for(let c=l+a;l!==c;l+=4)ni.slerpFlat(n,0,s,l-a,s,l,o);return n}},qb=class extends Yc{InterpolantFactoryMethodLinear(e){return new Vbe(this.times,this.values,this.getValueSize(),e)}};qb.prototype.ValueTypeName="quaternion";qb.prototype.DefaultInterpolation=_A;qb.prototype.InterpolantFactoryMethodSmooth=void 0;var R0=class extends Yc{};R0.prototype.ValueTypeName="string";R0.prototype.ValueBufferType=Array;R0.prototype.DefaultInterpolation=wA;R0.prototype.InterpolantFactoryMethodLinear=void 0;R0.prototype.InterpolantFactoryMethodSmooth=void 0;var DA=class extends Yc{};DA.prototype.ValueTypeName="vector";var II=class{constructor(e,t=-1,i,r=$B){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Jo(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,a=i.length;s!==a;++s)t.push(Hbe(i[s]).scale(r));let n=new this(e.name,e.duration,t,e.blendMode);return n.uuid=e.uuid,n}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let n=0,s=i.length;n!==s;++n)t.push(Yc.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let n=t.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=kbe(o);o=lH(o,1,c),l=lH(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new PA(".morphTargetInfluences["+t[a].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=e.length;a<o;a++){let l=e[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,p){if(h.length!==0){let f=[],v=[];u$(h,f,v,d),f.length!==0&&p.push(new c(u,f,v))}},r=[],n=e.name||"default",s=e.fps||30,a=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(let p in h){let f=[],v=[];for(let m=0;m!==u[d].morphTargets.length;++m){let g=u[d];f.push(g.time),v.push(g.morphTarget===p?1:0)}r.push(new PA(".morphTargetInfluence["+p+"]",f,v))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(DA,h+".position",u,"pos",r),i(qb,h+".quaternion",u,"rot",r),i(DA,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let n=this.tracks[i];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function jbe(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return PA;case"vector":case"vector2":case"vector3":case"vector4":return DA;case"color":return d$;case"quaternion":return qb;case"bool":case"boolean":return L0;case"string":return R0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function Hbe(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=jbe(e.type);if(e.times===void 0){let i=[],r=[];u$(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var LA={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},p$=class{constructor(e,t,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},Gbe=new p$,Yb=class{constructor(e){this.manager=e!==void 0?e:Gbe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,n){i.load(e,r,t,n)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},cu={},Wbe=class extends Error{constructor(e,t){super(e),this.response=t}},OI=class extends Yb{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=LA.get(e);if(n!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(n),this.manager.itemEnd(e)},0),n;if(cu[e]!==void 0){cu[e].push({onLoad:t,onProgress:i,onError:r});return}cu[e]=[],cu[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=cu[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,f=0,v=new ReadableStream({start(m){g();function g(){u.read().then(({done:y,value:x})=>{if(y)m.close();else{f+=x.byteLength;let _=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let M=0,S=c.length;M<S;M++){let E=c[M];E.onProgress&&E.onProgress(_)}m.enqueue(x),g()}})}}});return new Response(v)}else throw new Wbe(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{LA.add(e,l);let c=cu[e];delete cu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=cu[e];if(c===void 0)throw this.manager.itemError(e),l;delete cu[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},Xbe=class extends Yb{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let n=this,s=LA.get(e);if(s!==void 0)return n.manager.itemStart(e),setTimeout(function(){t&&t(s),n.manager.itemEnd(e)},0),s;let a=Vx("img");function o(){c(),LA.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(u){c(),r&&r(u),n.manager.itemError(e),n.manager.itemEnd(e)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}},qbe=class extends Yb{constructor(e){super(e)}load(e,t,i,r){let n=new Fr,s=new Xbe(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){n.image=a,n.needsUpdate=!0,t!==void 0&&t(n)},i,r),n}},Zb=class extends $i{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Yt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},Ybe=class extends Zb{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy($i.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Yt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},UD=new lt,cH=new k,uH=new k,hk=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ve(512,512),this.map=null,this.mapPass=null,this.matrix=new lt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rk,this._frameExtents=new ve(1,1),this._viewportCount=1,this._viewports=[new li(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;cH.setFromMatrixPosition(e.matrixWorld),t.position.copy(cH),uH.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(uH),t.updateMatrixWorld(),UD.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(UD),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(UD)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},Zbe=class extends hk{constructor(){super(new Hs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=Fx*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;(i!==t.fov||r!==t.aspect||n!==t.far)&&(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},Qbe=class extends Zb{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy($i.DEFAULT_UP),this.updateMatrix(),this.target=new $i,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Zbe}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},hH=new lt,Ry=new k,FD=new k,Kbe=class extends hk{constructor(){super(new Hs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ve(4,2),this._viewportCount=6,this._viewports=[new li(2,1,1,1),new li(0,1,1,1),new li(3,1,1,1),new li(1,1,1,1),new li(3,0,1,1),new li(1,0,1,1)],this._cubeDirections=[new k(1,0,0),new k(-1,0,0),new k(0,0,1),new k(0,0,-1),new k(0,1,0),new k(0,-1,0)],this._cubeUps=[new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,1,0),new k(0,0,1),new k(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,n=e.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Ry.setFromMatrixPosition(e.matrixWorld),i.position.copy(Ry),FD.copy(i.position),FD.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(FD),i.updateMatrixWorld(),r.makeTranslation(-Ry.x,-Ry.y,-Ry.z),hH.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hH)}},Jbe=class extends Zb{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new Kbe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},$be=class extends hk{constructor(){super(new pT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},ewe=class extends Zb{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy($i.DEFAULT_UP),this.updateMatrix(),this.target=new $i,this.shadow=new $be}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},f$=class extends Bt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},m$=class extends Yb{constructor(e){super(e)}load(e,t,i,r){let n=this,s=new OI(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(e,function(a){try{t(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let p=h.interleavedBuffers[d],f=n(h,p.buffer),v=R_(p.type,f),m=new rbe(v,p.stride);return m.uuid=p.uuid,t[d]=m,m}function n(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],f=new Uint32Array(p).buffer;return i[d]=f,f}let s=e.isInstancedBufferGeometry?new f$:new Bt,a=e.data.index;if(a!==void 0){let h=R_(a.type,a.array);s.setIndex(new Zt(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let f=r(e.data,d.data);p=new DI(f,d.itemSize,d.offset,d.normalized)}else{let f=R_(d.type,d.array),v=d.isInstancedBufferAttribute?jx:Zt;p=new v(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let f=0,v=d.length;f<v;f++){let m=d[f],g;if(m.isInterleavedBufferAttribute){let y=r(e.data,m.data);g=new DI(y,m.itemSize,m.offset,m.normalized)}else{let y=R_(m.type,m.array);g=new Zt(y,m.itemSize,m.normalized)}m.name!==void 0&&(g.name=m.name),p.push(g)}s.morphAttributes[h]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let p=c[h];s.addGroup(p.start,p.count,p.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new k;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new Xa(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},twe=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=dH(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=dH();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function dH(){return(typeof performance>"u"?Date:performance).now()}var iwe=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,n,s;switch(t){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,n=e*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=t}else{s+=t;let a=t/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-n,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){a.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let n=i,s=r;n!==s;++n)t[n]=t[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){ni.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,n){let s=this._workIndex*n;ni.multiplyQuaternionsFlat(e,s,e,t,e,i),ni.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=t+a;e[o]=e[o]*s+e[i+a]*r}}_lerpAdditive(e,t,i,r,n){for(let s=0;s!==n;++s){let a=t+s;e[a]=e[a]+e[i+s]*r}}},dk="\\[\\]\\.:\\/",rwe=new RegExp("["+dk+"]","g"),pk="[^"+dk+"]",nwe="[^"+dk.replace("\\.","")+"]",swe=/((?:WC+[\/:])*)/.source.replace("WC",pk),awe=/(WCOD+)?/.source.replace("WCOD",nwe),owe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pk),lwe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pk),cwe=new RegExp("^"+swe+awe+owe+lwe+"$"),uwe=["material","materials","bones","map"],hwe=class{constructor(e,t,i){let r=i||ur.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},ur=class{constructor(e,t,i){this.path=t,this.parsedPath=i||ur.parseTrackName(t),this.node=ur.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new ur.Composite(e,t,i):new ur(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(rwe,"")}static parseTrackName(e){let t=cwe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);uwe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===t||a.uuid===t)return a;let o=i(a.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=ur.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[n]!==void 0&&(n=e.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};ur.Composite=hwe;ur.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ur.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ur.prototype.GetterByBindingType=[ur.prototype._getValue_direct,ur.prototype._getValue_array,ur.prototype._getValue_arrayElement,ur.prototype._getValue_toArray];ur.prototype.SetterByBindingTypeAndVersioning=[[ur.prototype._setValue_direct,ur.prototype._setValue_direct_setNeedsUpdate,ur.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ur.prototype._setValue_array,ur.prototype._setValue_array_setNeedsUpdate,ur.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ur.prototype._setValue_arrayElement,ur.prototype._setValue_arrayElement_setNeedsUpdate,ur.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ur.prototype._setValue_fromArray,ur.prototype._setValue_fromArray_setNeedsUpdate,ur.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var dwe=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let n=t.tracks,s=n.length,a=new Array(s),o={endingStart:hv,endingEnd:hv};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=RJ,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,n=e._clip.duration,s=n/r,a=r/n;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let n=this._startTime;if(n!==null){let o=(e-n)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),a=this._updateWeight(e);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case Vge:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case $B:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,n=this._loopCount,s=i===JB;if(e===0)return n===-1?r:s&&(n&1)===1?t-r:r;if(i===LJ){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(n===-1&&(e>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let a=Math.floor(r/t);r-=t*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=dv,r.endingEnd=dv):(e?r.endingStart=this.zeroSlopeAtStart?dv:hv:r.endingStart=SA,t?r.endingEnd=this.zeroSlopeAtEnd?dv:hv:r.endingEnd=SA)}_scheduleFading(e,t,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=t,a[1]=n+e,o[1]=i,this}},pwe=new Float32Array(1),fwe=class extends Ts{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,s=e._propertyBindings,a=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,p=c[d];if(p!==void 0)++p.referenceCount,s[u]=p;else{if(p=s[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let f=t&&t._propertyBindings[u].binding.parsedPath;p=new iwe(ur.create(i,d,f),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,n=this._actionsByClip[r];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,n=this._actionsByClip,s=n[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=s;else{let a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let n=e._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=a.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let n=t[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=n.length,n.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new h$(new Float32Array(2),new Float32Array(2),1,pwe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n}clipAction(e,t,i){let r=t||this._root,n=r.uuid,s=typeof e=="string"?II.findByName(r,e):e,a=s!==null?s.uuid:e,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=$B),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new dwe(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(e,t){let i=t||this._root,r=i.uuid,n=typeof e=="string"?II.findByName(i,e):e,s=n?n.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[t];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},rt=class{constructor(t){this.value=t}clone(){return new rt(this.value.clone===void 0?this.value:this.value.clone())}},g$=class{constructor(e,t,i=0,r=1/0){this.ray=new T0(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new tk,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return NI(e,this,i,t),i.sort(pH),i}intersectObjects(e,t=!0,i=[]){for(let r=0,n=e.length;r<n;r++)NI(e[r],this,i,t);return i.sort(pH),i}};function pH(e,t){return e.distance-t.distance}function NI(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let n=e.children;for(let s=0,a=n.length;s<a;s++)NI(n[s],t,i,!0)}}var fH=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(wn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},mH=new ve,fk=class{constructor(e=new ve(1/0,1/0),t=new ve(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=mH.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return mH.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},gH=new k,rS=new k,$o=class{constructor(e=new k,t=new k){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){gH.subVectors(e,this.start),rS.subVectors(this.end,this.start);let i=rS.dot(rS),r=rS.dot(gH)/i;return t&&(r=wn(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},vH=new k,mwe=class extends $i{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Bt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new _t(r,3));let n=new lp({fog:!1,toneMapped:!1});this.cone=new Xb(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),vH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(vH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},gwe=class extends gr{constructor(e,t,i){let r=new Lv(t,4,2),n=new ah({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},yH=new k,nS=new k,xH=new k,vwe=class extends $i{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Bt;r.setAttribute("position",new _t([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let n=new lp({fog:!1,toneMapped:!1});this.lightPlane=new AA(r,n),this.add(this.lightPlane),r=new Bt,r.setAttribute("position",new _t([0,0,0,0,0,1],3)),this.targetLine=new AA(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),yH.setFromMatrixPosition(this.light.matrixWorld),nS.setFromMatrixPosition(this.light.target.matrixWorld),xH.subVectors(nS,yH),this.lightPlane.lookAt(nS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(nS),this.targetLine.scale.z=xH.length()}},sS=new k,Wr=new op,RA=class extends Xb{constructor(e){let t=new Bt,i=new lp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,f){o(p),o(f)}function o(p){r.push(0,0,0),n.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new _t(r,3)),t.setAttribute("color",new _t(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Yt(16755200),c=new Yt(16711680),u=new Yt(43775),h=new Yt(16777215),d=new Yt(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;Wr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),nn("c",t,e,Wr,0,0,-1),nn("t",t,e,Wr,0,0,1),nn("n1",t,e,Wr,-i,-r,-1),nn("n2",t,e,Wr,i,-r,-1),nn("n3",t,e,Wr,-i,r,-1),nn("n4",t,e,Wr,i,r,-1),nn("f1",t,e,Wr,-i,-r,1),nn("f2",t,e,Wr,i,-r,1),nn("f3",t,e,Wr,-i,r,1),nn("f4",t,e,Wr,i,r,1),nn("u1",t,e,Wr,i*.7,r*1.1,-1),nn("u2",t,e,Wr,-i*.7,r*1.1,-1),nn("u3",t,e,Wr,0,r*2,-1),nn("cf1",t,e,Wr,-i,0,1),nn("cf2",t,e,Wr,i,0,1),nn("cf3",t,e,Wr,0,-r,1),nn("cf4",t,e,Wr,0,r,1),nn("cn1",t,e,Wr,-i,0,-1),nn("cn2",t,e,Wr,i,0,-1),nn("cn3",t,e,Wr,0,-r,-1),nn("cn4",t,e,Wr,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function nn(e,t,i,r,n,s,a){sS.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],sS.x,sS.y,sS.z)}}var IA=class extends Xb{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new Bt;n.setIndex(new Zt(i,1)),n.setAttribute("position",new _t(r,3)),super(n,new lp({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},ywe=class extends Xb{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Bt;r.setAttribute("position",new _t(t,3)),r.setAttribute("color",new _t(i,3));let n=new lp({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(e,t,i){let r=new Yt,n=this.geometry.attributes.color.array;return r.set(e),r.toArray(n,0),r.toArray(n,3),r.set(t),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Ou=xwe();function xwe(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function bwe(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=wn(e,-65504,65504),Ou.floatView[0]=e;let t=Ou.uint32View[0],i=t>>23&511;return Ou.baseTable[i]+((t&8388607)>>Ou.shiftTable[i])}function wwe(e){let t=e>>10;return Ou.uint32View[0]=Ou.mantissaTable[Ou.offsetTable[t]+(e&1023)]+Ou.exponentTable[t],Ou.floatView[0]}var _we=Object.freeze({__proto__:null,fromHalfFloat:wwe,toHalfFloat:bwe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:C0}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=C0);var Iy=".",mk=Symbol("target"),v$=Symbol("unsubscribe");function zI(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function Swe(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Sc=Array.isArray;function gk(e){return typeof e=="symbol"}var Mwe={after:(e,t)=>Sc(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Sc(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=Iy),gk(t)?e+t.toString():e+t):e,initial:e=>{if(Sc(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(Iy);return t===-1?"":e.slice(0,t)},last:e=>{if(Sc(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(Iy);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Sc(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(Iy);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(Iy,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},Fo=Mwe;function Ewe(e){return typeof e=="object"&&typeof e.next=="function"}function Awe(e,t,i,r,n){let s=e.next;if(t.name==="entries")e.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],t,a.value[0],r),a.value[1]=n(a.value[1],t,a.value[0],r)),a};else if(t.name==="values"){let a=i[mk].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,t,a.next().value,r)),o}}else e.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,t,a.value,r)),a};return e}function bH(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&gk(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var Cwe=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let n=e[r],s=n||e;this._pathCache.set(s,t);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(e,i):e,this._proxyCache.set(s,a)),a}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Fo.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,n){if(!this._equals(n,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function BI(e){return toString.call(e)==="[object Object]"}function aS(){return!0}function Jm(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var y$=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Twe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),x$={push:aS,pop:aS,shift:aS,unshift:aS,copyWithin:Jm,reverse:Jm,sort:Jm,splice:Jm,flat:Jm,fill:Jm},Pwe=new Set([...y$,...Twe,...Object.keys(x$)]);function oS(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var b$=["keys","values","entries"],w$=new Set(["has","toString"]),_$={add:oS,clear:oS,delete:oS,forEach:oS},Dwe=new Set([...w$,...Object.keys(_$),...b$]);function lS(e,t){if(e.size!==t.size)return!0;let i;for(let[r,n]of e)if(i=t.get(r),i!==n||i===void 0&&!t.has(r))return!0;return!1}var Lwe=new Set([...w$,"get"]),S$={set:lS,clear:lS,delete:lS,forEach:lS},Rwe=new Set([...Lwe,...Object.keys(S$),...b$]),Qd=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return y$.has(e)}_shallowClone(e){let t=e;if(BI(e))t={...e};else if(Sc(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Sc(r)?this._onIsChanged=x$[t]:r instanceof Set?this._onIsChanged=_$[t]:r instanceof Map&&(this._onIsChanged=S$[t]),r):i}update(e,t,i){let r=Fo.after(e,this._path);if(t!=="length"){let n=this.clone;Fo.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),n&&n[t]&&(n[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],Fo.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},wH=class extends Qd{static isHandledMethod(e){return Pwe.has(e)}},Iwe=class extends Qd{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},_H=class extends Qd{static isHandledMethod(e){return Dwe.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},SH=class extends Qd{static isHandledMethod(e){return Rwe.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},Owe=class extends Qd{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},Nwe=class extends Qd{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Fg=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return BI(e)||Sc(e)||zI(e)}static isHandledMethod(e,t){return BI(e)?Qd.isHandledMethod(t):Sc(e)?wH.isHandledMethod(t):e instanceof Set?_H.isHandledMethod(t):e instanceof Map?SH.isHandledMethod(t):zI(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=Qd;Sc(e)?r=wH:e instanceof Date?r=Iwe:e instanceof Set?r=_H:e instanceof Map?r=SH:e instanceof WeakSet?r=Owe:e instanceof WeakMap&&(r=Nwe),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,n=Fg.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},zwe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},vk=(e,t,i={})=>{i={...zwe,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new Cwe(n),c=typeof i.onValidate=="function",u=new Fg(c),h=(y,x,_,M,S)=>!c||u.isCloning||i.onValidate(Fo.concat(l.getPath(y),x),_,M,S)===!0,d=(y,x,_,M)=>{!bH(l,i,x)&&!(a&&l.isDetached(y,e))&&p(l.getPath(y),x,_,M)},p=(y,x,_,M,S)=>{u.isCloning?u.update(y,x,M):t(Fo.concat(y,x),_,M,S)},f=y=>y&&(y[r]||y),v=(y,x,_,M)=>Swe(y)||_==="constructor"||s&&!Fg.isHandledMethod(x,_)||bH(l,i,_)||l.isGetInvariant(x,_)||a&&l.isDetached(x,e)?y:(M===void 0&&(M=l.getPath(x)),l.getProxy(y,Fo.concat(M,_),m,r)),m={get(y,x,_){if(gk(x)){if(x===r||x===mk)return y;if(x===v$&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let M=zI(y)?Reflect.get(y,x):Reflect.get(y,x,_);return v(M,y,x)},set(y,x,_,M){_=f(_);let S=y[r]||y,E=S[x];if(n(E,_)&&x in y)return!0;let A=h(y,x,_,E);return A&&l.setProperty(S,x,_,M,E)?(d(y,x,y[x],E),!0):!A},defineProperty(y,x,_){if(!l.isSameDescriptor(_,y,x)){let M=y[x];h(y,x,_.value,M)&&l.defineProperty(y,x,_,M)&&d(y,x,_.value,M)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let _=Reflect.get(y,x),M=h(y,x,void 0,_);return M&&l.deleteProperty(y,x,_)?(d(y,x,void 0,_),!0):!M},apply(y,x,_){let M=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,M,_);if((o===!1||o!==!0&&!o.includes(y.name))&&Fg.isHandledType(M)){let S=Fo.initial(l.getPath(y)),E=Fg.isHandledMethod(M,y.name);u.start(M,S,_);let A=Reflect.apply(y,u.preferredThisArg(y,x,M),E?_.map(D=>f(D)):_),P=u.isChanged(M,n),C=u.stop();if(Fg.isHandledType(A)&&E&&(x instanceof Map&&y.name==="get"&&(S=Fo.concat(S,_[0])),A=l.getProxy(A,S,m)),P){let D={name:y.name,args:_,result:A},N=u.isCloning?Fo.initial(S):S,U=u.isCloning?Fo.last(S):"";h(Fo.get(e,N),U,M,C,D)?p(N,U,M,C,D):u.undo(M)}return(x instanceof Map||x instanceof Set)&&Ewe(A)?Awe(A,y,x,S,v):A}return Reflect.apply(y,x,_)}},g=l.getProxy(e,i.pathAsArray?[]:"",m);return t=t.bind(g),c&&(i.onValidate=i.onValidate.bind(g)),g};vk.target=e=>e&&e[mk]||e;vk.unsubscribe=e=>e[v$]||e;var MH=vk,Bwe=typeof global=="object"&&global&&global.Object===Object&&global,M$=Bwe,kwe=typeof self=="object"&&self&&self.Object===Object&&self,Uwe=M$||kwe||Function("return this")(),Xl=Uwe,Fwe=Xl.Symbol,rl=Fwe,E$=Object.prototype,Vwe=E$.hasOwnProperty,jwe=E$.toString,Oy=rl?rl.toStringTag:void 0;function Hwe(e){var t=Vwe.call(e,Oy),i=e[Oy];try{e[Oy]=void 0;var r=!0}catch{}var n=jwe.call(e);return r&&(t?e[Oy]=i:delete e[Oy]),n}var Gwe=Hwe,Wwe=Object.prototype,Xwe=Wwe.toString;function qwe(e){return Xwe.call(e)}var Ywe=qwe,Zwe="[object Null]",Qwe="[object Undefined]",EH=rl?rl.toStringTag:void 0;function Kwe(e){return e==null?e===void 0?Qwe:Zwe:EH&&EH in Object(e)?Gwe(e):Ywe(e)}var fm=Kwe;function Jwe(e){return e!=null&&typeof e=="object"}var oh=Jwe,$we="[object Symbol]";function e_e(e){return typeof e=="symbol"||oh(e)&&fm(e)==$we}var Qb=e_e;function t_e(e,t){for(var i=-1,r=e==null?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n}var A$=t_e,i_e=Array.isArray,Gc=i_e,r_e=1/0,AH=rl?rl.prototype:void 0,CH=AH?AH.toString:void 0;function C$(e){if(typeof e=="string")return e;if(Gc(e))return A$(e,C$)+"";if(Qb(e))return CH?CH.call(e):"";var t=e+"";return t=="0"&&1/e==-r_e?"-0":t}var n_e=C$,s_e=/\s/;function a_e(e){for(var t=e.length;t--&&s_e.test(e.charAt(t)););return t}var o_e=a_e,l_e=/^\s+/;function c_e(e){return e&&e.slice(0,o_e(e)+1).replace(l_e,"")}var u_e=c_e;function h_e(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Gl=h_e,TH=NaN,d_e=/^[-+]0x[0-9a-f]+$/i,p_e=/^0b[01]+$/i,f_e=/^0o[0-7]+$/i,m_e=parseInt;function g_e(e){if(typeof e=="number")return e;if(Qb(e))return TH;if(Gl(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Gl(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=u_e(e);var i=p_e.test(e);return i||f_e.test(e)?m_e(e.slice(2),i?2:8):d_e.test(e)?TH:+e}var PH=g_e;function v_e(e){return e}var T$=v_e,y_e="[object AsyncFunction]",x_e="[object Function]",b_e="[object GeneratorFunction]",w_e="[object Proxy]";function __e(e){if(!Gl(e))return!1;var t=fm(e);return t==x_e||t==b_e||t==y_e||t==w_e}var P$=__e,S_e=Xl["__core-js_shared__"],VD=S_e,DH=function(){var e=/[^.]+$/.exec(VD&&VD.keys&&VD.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function M_e(e){return!!DH&&DH in e}var E_e=M_e,A_e=Function.prototype,C_e=A_e.toString;function T_e(e){if(e!=null){try{return C_e.call(e)}catch{}try{return e+""}catch{}}return""}var mm=T_e,P_e=/[\\^$.*+?()[\]{}|]/g,D_e=/^\[object .+?Constructor\]$/,L_e=Function.prototype,R_e=Object.prototype,I_e=L_e.toString,O_e=R_e.hasOwnProperty,N_e=RegExp("^"+I_e.call(O_e).replace(P_e,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function z_e(e){if(!Gl(e)||E_e(e))return!1;var t=P$(e)?N_e:D_e;return t.test(mm(e))}var B_e=z_e;function k_e(e,t){return e==null?void 0:e[t]}var U_e=k_e;function F_e(e,t){var i=U_e(e,t);return B_e(i)?i:void 0}var gm=F_e,V_e=gm(Xl,"WeakMap"),kI=V_e,LH=Object.create,j_e=function(){function e(){}return function(t){if(!Gl(t))return{};if(LH)return LH(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),H_e=j_e;function G_e(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var W_e=G_e;function X_e(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var q_e=X_e,Y_e=800,Z_e=16,Q_e=Date.now;function K_e(e){var t=0,i=0;return function(){var r=Q_e(),n=Z_e-(r-i);if(i=r,n>0){if(++t>=Y_e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var J_e=K_e;function $_e(e){return function(){return e}}var eSe=$_e,tSe=function(){try{var e=gm(Object,"defineProperty");return e({},"",{}),e}catch{}}(),OA=tSe,iSe=OA?function(e,t){return OA(e,"toString",{configurable:!0,enumerable:!1,value:eSe(t),writable:!0})}:T$,rSe=iSe,nSe=J_e(rSe),sSe=nSe;function aSe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var oSe=aSe,lSe=9007199254740991,cSe=/^(?:0|[1-9]\d*)$/;function uSe(e,t){var i=typeof e;return t=t??lSe,!!t&&(i=="number"||i!="symbol"&&cSe.test(e))&&e>-1&&e%1==0&&e<t}var yk=uSe;function hSe(e,t,i){t=="__proto__"&&OA?OA(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var D$=hSe;function dSe(e,t){return e===t||e!==e&&t!==t}var xk=dSe,pSe=Object.prototype,fSe=pSe.hasOwnProperty;function mSe(e,t,i){var r=e[t];(!(fSe.call(e,t)&&xk(r,i))||i===void 0&&!(t in e))&&D$(e,t,i)}var bk=mSe;function gSe(e,t,i,r){var n=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),n?D$(i,o,l):bk(i,o,l)}return i}var Kb=gSe,RH=Math.max;function vSe(e,t,i){return t=RH(t===void 0?e.length-1:t,0),function(){for(var r=arguments,n=-1,s=RH(r.length-t,0),a=Array(s);++n<s;)a[n]=r[t+n];n=-1;for(var o=Array(t+1);++n<t;)o[n]=r[n];return o[t]=i(a),W_e(e,this,o)}}var ySe=vSe,xSe=9007199254740991;function bSe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=xSe}var wk=bSe;function wSe(e){return e!=null&&wk(e.length)&&!P$(e)}var L$=wSe,_Se=Object.prototype;function SSe(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||_Se;return e===i}var _k=SSe;function MSe(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var ESe=MSe,ASe="[object Arguments]";function CSe(e){return oh(e)&&fm(e)==ASe}var IH=CSe,R$=Object.prototype,TSe=R$.hasOwnProperty,PSe=R$.propertyIsEnumerable,DSe=IH(function(){return arguments}())?IH:function(e){return oh(e)&&TSe.call(e,"callee")&&!PSe.call(e,"callee")},Sk=DSe;function LSe(){return!1}var RSe=LSe,I$=typeof exports=="object"&&exports&&!exports.nodeType&&exports,OH=I$&&typeof module=="object"&&module&&!module.nodeType&&module,ISe=OH&&OH.exports===I$,NH=ISe?Xl.Buffer:void 0,OSe=NH?NH.isBuffer:void 0,NSe=OSe||RSe,NA=NSe,zSe="[object Arguments]",BSe="[object Array]",kSe="[object Boolean]",USe="[object Date]",FSe="[object Error]",VSe="[object Function]",jSe="[object Map]",HSe="[object Number]",GSe="[object Object]",WSe="[object RegExp]",XSe="[object Set]",qSe="[object String]",YSe="[object WeakMap]",ZSe="[object ArrayBuffer]",QSe="[object DataView]",KSe="[object Float32Array]",JSe="[object Float64Array]",$Se="[object Int8Array]",eMe="[object Int16Array]",tMe="[object Int32Array]",iMe="[object Uint8Array]",rMe="[object Uint8ClampedArray]",nMe="[object Uint16Array]",sMe="[object Uint32Array]",Er={};Er[KSe]=Er[JSe]=Er[$Se]=Er[eMe]=Er[tMe]=Er[iMe]=Er[rMe]=Er[nMe]=Er[sMe]=!0;Er[zSe]=Er[BSe]=Er[ZSe]=Er[kSe]=Er[QSe]=Er[USe]=Er[FSe]=Er[VSe]=Er[jSe]=Er[HSe]=Er[GSe]=Er[WSe]=Er[XSe]=Er[qSe]=Er[YSe]=!1;function aMe(e){return oh(e)&&wk(e.length)&&!!Er[fm(e)]}var oMe=aMe;function lMe(e){return function(t){return e(t)}}var Mk=lMe,O$=typeof exports=="object"&&exports&&!exports.nodeType&&exports,J1=O$&&typeof module=="object"&&module&&!module.nodeType&&module,cMe=J1&&J1.exports===O$,jD=cMe&&M$.process,uMe=function(){try{var e=J1&&J1.require&&J1.require("util").types;return e||jD&&jD.binding&&jD.binding("util")}catch{}}(),n0=uMe,zH=n0&&n0.isTypedArray,hMe=zH?Mk(zH):oMe,N$=hMe,dMe=Object.prototype,pMe=dMe.hasOwnProperty;function fMe(e,t){var i=Gc(e),r=!i&&Sk(e),n=!i&&!r&&NA(e),s=!i&&!r&&!n&&N$(e),a=i||r||n||s,o=a?ESe(e.length,String):[],l=o.length;for(var c in e)(t||pMe.call(e,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||yk(c,l)))&&o.push(c);return o}var z$=fMe;function mMe(e,t){return function(i){return e(t(i))}}var B$=mMe,gMe=B$(Object.keys,Object),vMe=gMe,yMe=Object.prototype,xMe=yMe.hasOwnProperty;function bMe(e){if(!_k(e))return vMe(e);var t=[];for(var i in Object(e))xMe.call(e,i)&&i!="constructor"&&t.push(i);return t}var wMe=bMe;function _Me(e){return L$(e)?z$(e):wMe(e)}var Ek=_Me;function SMe(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var MMe=SMe,EMe=Object.prototype,AMe=EMe.hasOwnProperty;function CMe(e){if(!Gl(e))return MMe(e);var t=_k(e),i=[];for(var r in e)r=="constructor"&&(t||!AMe.call(e,r))||i.push(r);return i}var TMe=CMe;function PMe(e){return L$(e)?z$(e,!0):TMe(e)}var vf=PMe,DMe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,LMe=/^\w*$/;function RMe(e,t){if(Gc(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||Qb(e)?!0:LMe.test(e)||!DMe.test(e)||t!=null&&e in Object(t)}var IMe=RMe,OMe=gm(Object,"create"),Xx=OMe;function NMe(){this.__data__=Xx?Xx(null):{},this.size=0}var zMe=NMe;function BMe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var kMe=BMe,UMe="__lodash_hash_undefined__",FMe=Object.prototype,VMe=FMe.hasOwnProperty;function jMe(e){var t=this.__data__;if(Xx){var i=t[e];return i===UMe?void 0:i}return VMe.call(t,e)?t[e]:void 0}var HMe=jMe,GMe=Object.prototype,WMe=GMe.hasOwnProperty;function XMe(e){var t=this.__data__;return Xx?t[e]!==void 0:WMe.call(t,e)}var qMe=XMe,YMe="__lodash_hash_undefined__";function ZMe(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Xx&&t===void 0?YMe:t,this}var QMe=ZMe;function I0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}I0.prototype.clear=zMe;I0.prototype.delete=kMe;I0.prototype.get=HMe;I0.prototype.has=qMe;I0.prototype.set=QMe;var BH=I0;function KMe(){this.__data__=[],this.size=0}var JMe=KMe;function $Me(e,t){for(var i=e.length;i--;)if(xk(e[i][0],t))return i;return-1}var yT=$Me,eEe=Array.prototype,tEe=eEe.splice;function iEe(e){var t=this.__data__,i=yT(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():tEe.call(t,i,1),--this.size,!0}var rEe=iEe;function nEe(e){var t=this.__data__,i=yT(t,e);return i<0?void 0:t[i][1]}var sEe=nEe;function aEe(e){return yT(this.__data__,e)>-1}var oEe=aEe;function lEe(e,t){var i=this.__data__,r=yT(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var cEe=lEe;function O0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}O0.prototype.clear=JMe;O0.prototype.delete=rEe;O0.prototype.get=sEe;O0.prototype.has=oEe;O0.prototype.set=cEe;var xT=O0,uEe=gm(Xl,"Map"),qx=uEe;function hEe(){this.size=0,this.__data__={hash:new BH,map:new(qx||xT),string:new BH}}var dEe=hEe;function pEe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var fEe=pEe;function mEe(e,t){var i=e.__data__;return fEe(t)?i[typeof t=="string"?"string":"hash"]:i.map}var bT=mEe;function gEe(e){var t=bT(this,e).delete(e);return this.size-=t?1:0,t}var vEe=gEe;function yEe(e){return bT(this,e).get(e)}var xEe=yEe;function bEe(e){return bT(this,e).has(e)}var wEe=bEe;function _Ee(e,t){var i=bT(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var SEe=_Ee;function N0(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}N0.prototype.clear=dEe;N0.prototype.delete=vEe;N0.prototype.get=xEe;N0.prototype.has=wEe;N0.prototype.set=SEe;var wT=N0,MEe="Expected a function";function Ak(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(MEe);var i=function(){var r=arguments,n=t?t.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=e.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(Ak.Cache||wT),i}Ak.Cache=wT;var EEe=Ak,AEe=500;function CEe(e){var t=EEe(e,function(r){return i.size===AEe&&i.clear(),r}),i=t.cache;return t}var TEe=CEe,PEe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,DEe=/\\(\\)?/g,LEe=TEe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(PEe,function(i,r,n,s){t.push(n?s.replace(DEe,"$1"):r||i)}),t}),REe=LEe;function IEe(e){return e==null?"":n_e(e)}var OEe=IEe;function NEe(e,t){return Gc(e)?e:IMe(e,t)?[e]:REe(OEe(e))}var z0=NEe,zEe=1/0;function BEe(e){if(typeof e=="string"||Qb(e))return e;var t=e+"";return t=="0"&&1/e==-zEe?"-0":t}var _T=BEe;function kEe(e,t){t=z0(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[_T(t[i++])];return i&&i==r?e:void 0}var k$=kEe;function UEe(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}var Ck=UEe,kH=rl?rl.isConcatSpreadable:void 0;function FEe(e){return Gc(e)||Sk(e)||!!(kH&&e&&e[kH])}var VEe=FEe;function U$(e,t,i,r,n){var s=-1,a=e.length;for(i||(i=VEe),n||(n=[]);++s<a;){var o=e[s];t>0&&i(o)?t>1?U$(o,t-1,i,r,n):Ck(n,o):r||(n[n.length]=o)}return n}var jEe=U$;function HEe(e){var t=e==null?0:e.length;return t?jEe(e,1):[]}var GEe=HEe;function WEe(e){return sSe(ySe(e,void 0,GEe),e+"")}var F$=WEe,XEe=B$(Object.getPrototypeOf,Object),Tk=XEe,qEe="[object Object]",YEe=Function.prototype,ZEe=Object.prototype,V$=YEe.toString,QEe=ZEe.hasOwnProperty,KEe=V$.call(Object);function JEe(e){if(!oh(e)||fm(e)!=qEe)return!1;var t=Tk(e);if(t===null)return!0;var i=QEe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&V$.call(i)==KEe}var $Ee=JEe;function eAe(e,t,i){var r=-1,n=e.length;t<0&&(t=-t>n?0:n+t),i=i>n?n:i,i<0&&(i+=n),n=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(n);++r<n;)s[r]=e[r+t];return s}var tAe=eAe;function iAe(){this.__data__=new xT,this.size=0}var rAe=iAe;function nAe(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var sAe=nAe;function aAe(e){return this.__data__.get(e)}var oAe=aAe;function lAe(e){return this.__data__.has(e)}var cAe=lAe,uAe=200;function hAe(e,t){var i=this.__data__;if(i instanceof xT){var r=i.__data__;if(!qx||r.length<uAe-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new wT(r)}return i.set(e,t),this.size=i.size,this}var dAe=hAe;function B0(e){var t=this.__data__=new xT(e);this.size=t.size}B0.prototype.clear=rAe;B0.prototype.delete=sAe;B0.prototype.get=oAe;B0.prototype.has=cAe;B0.prototype.set=dAe;var yE=B0;function pAe(e,t){return e&&Kb(t,Ek(t),e)}var fAe=pAe;function mAe(e,t){return e&&Kb(t,vf(t),e)}var gAe=mAe,j$=typeof exports=="object"&&exports&&!exports.nodeType&&exports,UH=j$&&typeof module=="object"&&module&&!module.nodeType&&module,vAe=UH&&UH.exports===j$,FH=vAe?Xl.Buffer:void 0,VH=FH?FH.allocUnsafe:void 0;function yAe(e,t){if(t)return e.slice();var i=e.length,r=VH?VH(i):new e.constructor(i);return e.copy(r),r}var xAe=yAe;function bAe(e,t){for(var i=-1,r=e==null?0:e.length,n=0,s=[];++i<r;){var a=e[i];t(a,i,e)&&(s[n++]=a)}return s}var wAe=bAe;function _Ae(){return[]}var H$=_Ae,SAe=Object.prototype,MAe=SAe.propertyIsEnumerable,jH=Object.getOwnPropertySymbols,EAe=jH?function(e){return e==null?[]:(e=Object(e),wAe(jH(e),function(t){return MAe.call(e,t)}))}:H$,Pk=EAe;function AAe(e,t){return Kb(e,Pk(e),t)}var CAe=AAe,TAe=Object.getOwnPropertySymbols,PAe=TAe?function(e){for(var t=[];e;)Ck(t,Pk(e)),e=Tk(e);return t}:H$,G$=PAe;function DAe(e,t){return Kb(e,G$(e),t)}var LAe=DAe;function RAe(e,t,i){var r=t(e);return Gc(e)?r:Ck(r,i(e))}var W$=RAe;function IAe(e){return W$(e,Ek,Pk)}var UI=IAe;function OAe(e){return W$(e,vf,G$)}var X$=OAe,NAe=gm(Xl,"DataView"),FI=NAe,zAe=gm(Xl,"Promise"),VI=zAe,BAe=gm(Xl,"Set"),jI=BAe,HH="[object Map]",kAe="[object Object]",GH="[object Promise]",WH="[object Set]",XH="[object WeakMap]",qH="[object DataView]",UAe=mm(FI),FAe=mm(qx),VAe=mm(VI),jAe=mm(jI),HAe=mm(kI),Kp=fm;(FI&&Kp(new FI(new ArrayBuffer(1)))!=qH||qx&&Kp(new qx)!=HH||VI&&Kp(VI.resolve())!=GH||jI&&Kp(new jI)!=WH||kI&&Kp(new kI)!=XH)&&(Kp=function(e){var t=fm(e),i=t==kAe?e.constructor:void 0,r=i?mm(i):"";if(r)switch(r){case UAe:return qH;case FAe:return HH;case VAe:return GH;case jAe:return WH;case HAe:return XH}return t});var Yx=Kp,GAe=Object.prototype,WAe=GAe.hasOwnProperty;function XAe(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&WAe.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var qAe=XAe,YAe=Xl.Uint8Array,zA=YAe;function ZAe(e){var t=new e.constructor(e.byteLength);return new zA(t).set(new zA(e)),t}var Dk=ZAe;function QAe(e,t){var i=t?Dk(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var KAe=QAe,JAe=/\w*$/;function $Ae(e){var t=new e.constructor(e.source,JAe.exec(e));return t.lastIndex=e.lastIndex,t}var eCe=$Ae,YH=rl?rl.prototype:void 0,ZH=YH?YH.valueOf:void 0;function tCe(e){return ZH?Object(ZH.call(e)):{}}var iCe=tCe;function rCe(e,t){var i=t?Dk(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var nCe=rCe,sCe="[object Boolean]",aCe="[object Date]",oCe="[object Map]",lCe="[object Number]",cCe="[object RegExp]",uCe="[object Set]",hCe="[object String]",dCe="[object Symbol]",pCe="[object ArrayBuffer]",fCe="[object DataView]",mCe="[object Float32Array]",gCe="[object Float64Array]",vCe="[object Int8Array]",yCe="[object Int16Array]",xCe="[object Int32Array]",bCe="[object Uint8Array]",wCe="[object Uint8ClampedArray]",_Ce="[object Uint16Array]",SCe="[object Uint32Array]";function MCe(e,t,i){var r=e.constructor;switch(t){case pCe:return Dk(e);case sCe:case aCe:return new r(+e);case fCe:return KAe(e,i);case mCe:case gCe:case vCe:case yCe:case xCe:case bCe:case wCe:case _Ce:case SCe:return nCe(e,i);case oCe:return new r;case lCe:case hCe:return new r(e);case cCe:return eCe(e);case uCe:return new r;case dCe:return iCe(e)}}var ECe=MCe;function ACe(e){return typeof e.constructor=="function"&&!_k(e)?H_e(Tk(e)):{}}var CCe=ACe,TCe="[object Map]";function PCe(e){return oh(e)&&Yx(e)==TCe}var DCe=PCe,QH=n0&&n0.isMap,LCe=QH?Mk(QH):DCe,RCe=LCe,ICe="[object Set]";function OCe(e){return oh(e)&&Yx(e)==ICe}var NCe=OCe,KH=n0&&n0.isSet,zCe=KH?Mk(KH):NCe,BCe=zCe,kCe=1,UCe=2,FCe=4,q$="[object Arguments]",VCe="[object Array]",jCe="[object Boolean]",HCe="[object Date]",GCe="[object Error]",Y$="[object Function]",WCe="[object GeneratorFunction]",XCe="[object Map]",qCe="[object Number]",Z$="[object Object]",YCe="[object RegExp]",ZCe="[object Set]",QCe="[object String]",KCe="[object Symbol]",JCe="[object WeakMap]",$Ce="[object ArrayBuffer]",eTe="[object DataView]",tTe="[object Float32Array]",iTe="[object Float64Array]",rTe="[object Int8Array]",nTe="[object Int16Array]",sTe="[object Int32Array]",aTe="[object Uint8Array]",oTe="[object Uint8ClampedArray]",lTe="[object Uint16Array]",cTe="[object Uint32Array]",yr={};yr[q$]=yr[VCe]=yr[$Ce]=yr[eTe]=yr[jCe]=yr[HCe]=yr[tTe]=yr[iTe]=yr[rTe]=yr[nTe]=yr[sTe]=yr[XCe]=yr[qCe]=yr[Z$]=yr[YCe]=yr[ZCe]=yr[QCe]=yr[KCe]=yr[aTe]=yr[oTe]=yr[lTe]=yr[cTe]=!0;yr[GCe]=yr[Y$]=yr[JCe]=!1;function xE(e,t,i,r,n,s){var a,o=t&kCe,l=t&UCe,c=t&FCe;if(i&&(a=n?i(e,r,n,s):i(e)),a!==void 0)return a;if(!Gl(e))return e;var u=Gc(e);if(u){if(a=qAe(e),!o)return q_e(e,a)}else{var h=Yx(e),d=h==Y$||h==WCe;if(NA(e))return xAe(e,o);if(h==Z$||h==q$||d&&!n){if(a=l||d?{}:CCe(e),!o)return l?LAe(e,gAe(a,e)):CAe(e,fAe(a,e))}else{if(!yr[h])return n?e:{};a=ECe(e,h,o)}}s||(s=new yE);var p=s.get(e);if(p)return p;s.set(e,a),BCe(e)?e.forEach(function(m){a.add(xE(m,t,i,m,e,s))}):RCe(e)&&e.forEach(function(m,g){a.set(g,xE(m,t,i,g,e,s))});var f=c?l?X$:UI:l?vf:Ek,v=u?void 0:f(e);return oSe(v||e,function(m,g){v&&(g=m,m=e[g]),bk(a,g,xE(m,t,i,g,e,s))}),a}var Q$=xE,uTe=1,hTe=4;function dTe(e){return Q$(e,uTe|hTe)}var ST=dTe,pTe="__lodash_hash_undefined__";function fTe(e){return this.__data__.set(e,pTe),this}var mTe=fTe;function gTe(e){return this.__data__.has(e)}var vTe=gTe;function BA(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new wT;++t<i;)this.add(e[t])}BA.prototype.add=BA.prototype.push=mTe;BA.prototype.has=vTe;var yTe=BA;function xTe(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var bTe=xTe;function wTe(e,t){return e.has(t)}var _Te=wTe,STe=1,MTe=2;function ETe(e,t,i,r,n,s){var a=i&STe,o=e.length,l=t.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,p=i&MTe?new yTe:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var f=e[h],v=t[h];if(r)var m=a?r(v,f,h,t,e,s):r(f,v,h,e,t,s);if(m!==void 0){if(m)continue;d=!1;break}if(p){if(!bTe(t,function(g,y){if(!_Te(p,y)&&(f===g||n(f,g,i,r,s)))return p.push(y)})){d=!1;break}}else if(!(f===v||n(f,v,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var K$=ETe;function ATe(e){var t=-1,i=Array(e.size);return e.forEach(function(r,n){i[++t]=[n,r]}),i}var CTe=ATe;function TTe(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var PTe=TTe,DTe=1,LTe=2,RTe="[object Boolean]",ITe="[object Date]",OTe="[object Error]",NTe="[object Map]",zTe="[object Number]",BTe="[object RegExp]",kTe="[object Set]",UTe="[object String]",FTe="[object Symbol]",VTe="[object ArrayBuffer]",jTe="[object DataView]",JH=rl?rl.prototype:void 0,HD=JH?JH.valueOf:void 0;function HTe(e,t,i,r,n,s,a){switch(i){case jTe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case VTe:return!(e.byteLength!=t.byteLength||!s(new zA(e),new zA(t)));case RTe:case ITe:case zTe:return xk(+e,+t);case OTe:return e.name==t.name&&e.message==t.message;case BTe:case UTe:return e==t+"";case NTe:var o=CTe;case kTe:var l=r&DTe;if(o||(o=PTe),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=LTe,a.set(e,t);var u=K$(o(e),o(t),r,n,s,a);return a.delete(e),u;case FTe:if(HD)return HD.call(e)==HD.call(t)}return!1}var GTe=HTe,WTe=1,XTe=Object.prototype,qTe=XTe.hasOwnProperty;function YTe(e,t,i,r,n,s){var a=i&WTe,o=UI(e),l=o.length,c=UI(t),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in t:qTe.call(t,d)))return!1}var p=s.get(e),f=s.get(t);if(p&&f)return p==t&&f==e;var v=!0;s.set(e,t),s.set(t,e);for(var m=a;++h<l;){d=o[h];var g=e[d],y=t[d];if(r)var x=a?r(y,g,d,t,e,s):r(g,y,d,e,t,s);if(!(x===void 0?g===y||n(g,y,i,r,s):x)){v=!1;break}m||(m=d=="constructor")}if(v&&!m){var _=e.constructor,M=t.constructor;_!=M&&"constructor"in e&&"constructor"in t&&!(typeof _=="function"&&_ instanceof _&&typeof M=="function"&&M instanceof M)&&(v=!1)}return s.delete(e),s.delete(t),v}var ZTe=YTe,QTe=1,$H="[object Arguments]",eG="[object Array]",cS="[object Object]",KTe=Object.prototype,tG=KTe.hasOwnProperty;function JTe(e,t,i,r,n,s){var a=Gc(e),o=Gc(t),l=a?eG:Yx(e),c=o?eG:Yx(t);l=l==$H?cS:l,c=c==$H?cS:c;var u=l==cS,h=c==cS,d=l==c;if(d&&NA(e)){if(!NA(t))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new yE),a||N$(e)?K$(e,t,i,r,n,s):GTe(e,t,l,i,r,n,s);if(!(i&QTe)){var p=u&&tG.call(e,"__wrapped__"),f=h&&tG.call(t,"__wrapped__");if(p||f){var v=p?e.value():e,m=f?t.value():t;return s||(s=new yE),n(v,m,i,r,s)}}return d?(s||(s=new yE),ZTe(e,t,i,r,n,s)):!1}var $Te=JTe;function J$(e,t,i,r,n){return e===t?!0:e==null||t==null||!oh(e)&&!oh(t)?e!==e&&t!==t:$Te(e,t,i,r,J$,n)}var e2e=J$;function t2e(e,t){return e!=null&&t in Object(e)}var i2e=t2e;function r2e(e,t,i){t=z0(t,e);for(var r=-1,n=t.length,s=!1;++r<n;){var a=_T(t[r]);if(!(s=e!=null&&i(e,a)))break;e=e[a]}return s||++r!=n?s:(n=e==null?0:e.length,!!n&&wk(n)&&yk(a,n)&&(Gc(e)||Sk(e)))}var n2e=r2e;function s2e(e,t){return e!=null&&n2e(e,t,i2e)}var a2e=s2e,o2e=function(){return Xl.Date.now()},GD=o2e,l2e="Expected a function",c2e=Math.max,u2e=Math.min;function h2e(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(l2e);t=PH(t)||0,Gl(i)&&(u=!!i.leading,h="maxWait"in i,s=h?c2e(PH(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var E=r,A=n;return r=n=void 0,c=S,a=e.apply(A,E),a}function f(S){return c=S,o=setTimeout(g,t),u?p(S):a}function v(S){var E=S-l,A=S-c,P=t-E;return h?u2e(P,s-A):P}function m(S){var E=S-l,A=S-c;return l===void 0||E>=t||E<0||h&&A>=s}function g(){var S=GD();if(m(S))return y(S);o=setTimeout(g,v(S))}function y(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:y(GD())}function M(){var S=GD(),E=m(S);if(r=arguments,n=this,l=S,E){if(o===void 0)return f(l);if(h)return clearTimeout(o),o=setTimeout(g,t),p(l)}return o===void 0&&(o=setTimeout(g,t)),a}return M.cancel=x,M.flush=_,M}var Zx=h2e;function d2e(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var p2e=d2e;function f2e(e,t){return e>t}var m2e=f2e;function g2e(e,t){return t.length<2?e:k$(e,tAe(t,0,-1))}var v2e=g2e;function y2e(e,t){return e2e(e,t)}var Lk=y2e;function x2e(e,t,i){for(var r=-1,n=e.length;++r<n;){var s=e[r],a=t(s);if(a!=null&&(o===void 0?a===a&&!Qb(a):i(a,o)))var o=a,l=s}return l}var b2e=x2e;function w2e(e){return e&&e.length?b2e(e,T$,m2e):void 0}var _2e=w2e;function S2e(e,t){return t=z0(t,e),e=v2e(e,t),e==null||delete e[_T(p2e(t))]}var M2e=S2e;function E2e(e){return $Ee(e)?void 0:e}var A2e=E2e,C2e=1,T2e=2,P2e=4,D2e=F$(function(e,t){var i={};if(e==null)return i;var r=!1;t=A$(t,function(s){return s=z0(s,e),r||(r=s.length>1),s}),Kb(e,X$(e),i),r&&(i=Q$(i,C2e|T2e|P2e,A2e));for(var n=t.length;n--;)M2e(i,t[n]);return i}),HI=D2e;function L2e(e,t,i,r){if(!Gl(e))return e;t=z0(t,e);for(var n=-1,s=t.length,a=s-1,o=e;o!=null&&++n<s;){var l=_T(t[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=Gl(u)?u:yk(t[n+1])?[]:{})}bk(o,l,c),o=o[l]}return e}var R2e=L2e;function I2e(e,t,i){for(var r=-1,n=t.length,s={};++r<n;){var a=t[r],o=k$(e,a);i(o,a)&&R2e(s,z0(a,e),o)}return s}var O2e=I2e;function N2e(e,t){return O2e(e,t,function(i,r){return a2e(e,r)})}var z2e=N2e,B2e=F$(function(e,t){return e==null?{}:z2e(e,t)}),Bc=B2e,k2e="Expected a function";function U2e(e,t,i){var r=!0,n=!0;if(typeof e!="function")throw new TypeError(k2e);return Gl(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),Zx(e,t,{leading:r,maxWait:t,trailing:n})}var F2e=U2e;function $$(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function nl(e,t){return Object.setPrototypeOf(e,t),e}var V2e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),j2e=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),H2e=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||MT&&"ontouchend"in document,G2e=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,W2e=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,X2e=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},q2e=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},Y2e=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},eee=V2e();eee&&Y2e();var MT=j2e(),Jb=H2e(),Z2e=G2e(),uo=W2e(),iG=X2e(),Q2e=Number(q2e());function tee(e){return Array.isArray(e)?e:[e]}function iee(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function uS(e){return MT?e.metaKey:e.ctrlKey}function K2e(e){return e.wheelDeltaY===0||e.deltaY===0?MT&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var $t=[],kA={},A1={},bE={};function ree(e){$t.includes(e)||$t.push(e)}function Rv(e){delete kA[e.pointerId];for(let t=0;t<$t.length;t++)if($t[t].pointerId===e.pointerId){$t.splice(t,1);break}}function J2e(){$t.splice(0,$t.length)}function UA(e){if(e.pointerType!=="touch")return;let t=kA[e.pointerId];t===void 0&&(t={x:0,y:0},kA[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function WD(e){let t=e.pointerId===$t[0].pointerId?$t[1]:$t[0];return kA[t.pointerId]}function nee(e){A1[e.key]=!0,bE[e.key]=bE[e.key]===void 0?1:bE[e.key]+1}function see(e){if(MT&&A1.Meta)for(let t in A1)A1[t]=!1;else A1[e.key]=!1;bE={}}function $2e(e){e.addEventListener("pointerdown",ree,!0),e.addEventListener("pointerdown",UA,!0),e.addEventListener("pointermove",UA,!0),e.addEventListener("pointerup",Rv,!0),e.addEventListener("pointercancel",Rv,!0),e.addEventListener("pointerleave",Rv,!0),window.addEventListener("keydown",nee,!0),window.addEventListener("keyup",see,!0)}function ePe(e){e.removeEventListener("pointerdown",ree,!0),e.removeEventListener("pointerdown",UA,!0),e.removeEventListener("pointermove",UA,!0),e.removeEventListener("pointerup",Rv,!0),e.removeEventListener("pointercancel",Rv,!0),e.removeEventListener("pointerleave",Rv,!0),window.removeEventListener("keydown",nee,!0),window.removeEventListener("keyup",see,!0)}var aee,tPe=new Promise(e=>{aee=e}),hS;function iPe(){if(hS)return hS;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.9.75/build",i=sp(()=>import("./navmesh-BFd9Mv4x.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});aee(a)}return hS=e(),hS}var oee,rPe=new Promise(e=>{oee=e}),dS;function nPe(){if(dS)return dS;async function e(){let t=await sp(()=>import("./physics-BM4kW-A5.js"),[]);await t.init(),oee(t)}return dS=e(),dS}var qt=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,qt.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:n,data:s}=e,a={...t,[n]:s};return Object.setPrototypeOf(a,qt.prototype),{data:a,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let n={...t};return Object.setPrototypeOf(n,qt.prototype),delete n[i],{data:n,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function Rk(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&Rk(r)}return Object.freeze(e)}function sPe(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var lee=class extends Error{};function XD(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function vd(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=e+(t-e)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function Ik(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function aPe(){return typeof process<"u"}function cee(e,t){for(let i of e)t(i.id,i.data)!==!0&&cee(i.children,t)}function uee(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)uee(i,t)}var _s=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,_s.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Rk(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(t)e=t;else return e}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return(t=this.get(e))==null?void 0:t.data}has(e){return this.childrenOf(e)!==void 0}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return e===null?this:(t=this.get(e))==null?void 0:t.children}traverseFrom(e,t){if(e===null)this.traverse(t);else{let i=this.get(e);i&&uee(i,t)}}traverse(e){cee(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return e===null?this:this.get(e).children}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this.parent(e),r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:t},this.modifyArrayBy(i,r)}}modifyArrayBy(e,t){let i=e,r=t;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,_s.prototype);let n=r;return n.fillCaches(),n}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec({id:e,children:t}){if(this.get(e)!==void 0)return!0;for(let i of t)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(e){let{parent:t,fi:i,id:r,data:n,children:s}=e;if(t!==null&&this.get(t)===void 0||this.checkDuplicatedIdRec(e))return null;{let a=t,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:e,reverse:{type:8,id:r}}}}deleteOp(e){let{id:t}=e;if(this.get(t)===null)return null;{let i=this.parent(t);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);e.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:e,reverse:{type:7,...s,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:r}=e;if(t!==null&&this.get(t)===void 0)return this.deleteOp({type:8,id:r});if(t!==null){let h=t;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new lee("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=t,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),e.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:e,reverse:{type:9,parent:s,fi:u,id:r}}}previous(e,t){if(t===null){let r=this.childrenArray(e);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(e)){if(r.id===t)return i;i=r.id}return null}traverseSortNext(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)+1;if(r<i.length)return i[r].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(t!==void 0){let i=this.childrenArray(t),r=i.findIndex(n=>n.id===e)-1;return r>=0?this.traverseSortPrevious(i[r].id):t}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push({...i,...r})}t.sort((i,r)=>sPe(i.sortKey,r.sortKey));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],r=this.get(t),n=r;if(r!==void 0){for(;t;)i.splice(0,0,r.fi),t=this.parent(t),t!==null&&(r=this.get(t));return{...n,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let r=this.childrenArray(e);if(t===null){if(r.length===0)return vd(0,i,i);{let n=r[0].fi;return vd(n-i,n,i)}}else{let n=this.get(t);if(n===void 0||this.parent(t)!==e)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return vd(a,a+i,i)}else return vd(n.fi,s.fi,i)}}},FA;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(FA||(FA={}));var kt=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,kt.prototype)}deepFreeze(){let e=0;for(;e<this.length;)Rk(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,kt.prototype);let t=e;return aPe()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,n=this,s={fi:t,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...n}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:t};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return vd(0,t,t);{let r=i[0].fi;return vd(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return vd(s,s+t,t)}else return vd(r.fi,n.fi,t)}}};function s0(e){return e&&typeof e=="object"&&e instanceof Pn}var Pn=class{unusedFunOverridesTable(t){}runOp(t){let i=[],r=this,n=0,s={};for(;n<t.path.length;){if(i.push(r),r=r===void 0?void 0:r[t.path[n]],r!==void 0&&!s0(r))return null;n+=1}r=r?XD(r):new Pn;for(let[l,c]of Object.entries(t.props)){let u=r[l];s[l]=u,c===void 0?delete r[l]:r[l]=c}for(;n>0;){if(Object.keys(r).length===0){let l=i[n-1];l&&(r=XD(l),delete r[t.path[n-1]])}else{let l=i[n-1];if(l){let c=XD(l);c[t.path[n-1]]=r,r=c}else{let c=new Pn;c[t.path[n-1]]=r,r=c}}n-=1}let a=Object.setPrototypeOf(r,Pn.prototype),o={...t,props:s};return{data:a,actual:t,reverse:o}}},Nd;(e=>{function t(n,s){return Qx(n,s)??n}e.apply=t;function i(n,s){return Nk(n,s)}e.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=Un.zoomOnce(l,o[a]),l===void 0)return s;if(!s0(l))return;a+=1}if(l===void 0)return s;if(s0(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=Ok([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(Nd||(Nd={}));function Ok(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=Qx(n.data,t[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=Ok(n.children,t);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function oPe(e,t){if(t===void 0)return;let i=!1,r=e.map(n=>{let s=n.id,a=Qx(n.data,t[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function Qx(e,t){if(!s0(t))return t;if(e instanceof _s){let i=Ok(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof kt)return oPe(e,t);if(Array.isArray(e)){let i=!1,r=e.map((n,s)=>{let a=Qx(n,t[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof Pn)return Nk(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[n,s]of Object.entries(e)){let a=Qx(s,t[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function Nk(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!s0(t))return t;if(!s0(e))return Nd.apply(e,t);let i=new Set;for(let n of Object.keys(e))i.add(n);for(let n of Object.keys(t))i.add(n);let r=new Pn;for(let n of i){let s=Nk(e===void 0?void 0:e[n],t===void 0?void 0:t[n]);r[n]=s}return r}function lPe(e,t){let i={cur:[],result:[],len:0};return e=Kx(e,t,i)??e,[e,i.result]}function VA(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function jA(e){e&&(e.len-=1)}function cPe(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function hee(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=Kx(s.data,t,VA(i,a));jA(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=hee(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function uPe(e,t,i){let r=!1,n=e.map(s=>{let a=s.id,o=t[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=Kx(s.data,t,VA(i,a));return jA(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}function Kx(e,t,i){if(e instanceof _s){let r=hee(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof kt)return uPe(e,t,i);if(Array.isArray(e)){let r=!1,n=e.map((s,a)=>{let o=Kx(s,t,VA(i,a));return jA(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}else if(e&&typeof e=="object"&&!Ik(e)){let r={},n=!1;for(let[s,a]of Object.entries(e))if(s!=="name"&&s!=="variableId"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=Kx(a,t,VA(i,s));jA(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&cPe(i),r}else return}}var HA;(e=>{function t(i,r){let n=Un.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(HA||(HA={}));var ss;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}e.applySimple=i;function r(l,c){var d,p;let u=c.path;for(var h=[];;){let f;if(l instanceof Pn&&c.type===0&&(f=l.runOp({...c,path:u.slice(h.length)}),f===null&&(f=void 0)),f===void 0&&h.length===u.length&&(l instanceof _s||l instanceof kt||l instanceof qt?f=l.runOp(c):f=FA.runOp(l,c)),f!==void 0)if(f!==null){let g=f.data;for(let y=h.length-1;y>=0;y--){let x=u[y],_=h[y];if(_ instanceof _s){if(typeof x=="number")throw new Error("illegal arg");g=_.modifyById(x,g)}else if(_ instanceof kt){if(typeof x=="number")throw new Error("illegal arg");g=_.modifyById(x,g)}else if(_ instanceof qt){if(typeof x=="number")throw new Error("illegal arg");g=_.modifyById(x,g)}else if(_ instanceof Pn){let M={..._,[x]:g};g=Object.setPrototypeOf(M,Pn.prototype)}else if(typeof _=="object")if(Array.isArray(_)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let M=g;g=[..._],g[x]=M}else g={..._,[x]:g};else return null}return{data:g,actual:{...f.actual,path:u},reverse:{...f.reverse,path:u}}}else return null;let v=u[h.length],m;if(l instanceof _s){if(typeof v=="number")throw new Error("");m=(d=l.get(v))==null?void 0:d.data}else if(l instanceof kt){if(typeof v=="number")throw new Error("");m=(p=l.get(v))==null?void 0:p.data}else l!==null&&(m=l[v]);if(m!==void 0)h.push(l),l=m;else return null}}e.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function a(l,c){return n(l.path,c.path)}e.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(ss||(ss={}));var GI;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[p,...f]=d.path;p===u&&h.push({...d,path:f})}return h}e.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=r;function n(c,u){return[...c,...u]}e.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>ss.subsumed(h,d))),...u]}e.compress=s;function a(c,u){return c.every(h=>u.every(d=>ss.commutative(h,d)))}e.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],p=[];for(let f of u)try{if(f.type===3||f.type===5&&f.path[f.path.length-1]==="variables"){let v,m,g;if(f.type===3?(v=Un.zoom(h,[...f.path,f.id]),g=ss.apply(h,{...f,type:2})):(v=Un.zoom(h,[...f.path,f.id,"value"]),g=ss.apply(h,f)),g!==null){h=g.data;let[y,x]=lPe(h,{[f.id]:v});h=y;for(let _=0;_<x.length;_++){let M=x[_],S=M.pop();if(typeof S=="number"){let E=[S];for(let P=_+1;P<x.length;P++){let C=x[P],D=C[C.length-1];if(typeof D=="number"&&Un.equal(M,C.slice(0,C.length-1)))E.push(D),x.splice(P,1);else break}let A=Un.zoom(h,M);m=A.map((P,C)=>E.includes(C)?f.id:P),v=A,S=M.pop()}else{if(S==="alphaOverride"||S==="alpha"){v/=100;let E=v,A=Un.zoom(h,M.slice(0,M.length-2)),P=A.layers.map(C=>C.id===M[M.length-1]?{...C,data:{...C.data,[S]:E}}:C);Object.setPrototypeOf(P,Object.getPrototypeOf(A.layers)),A.layers=P}m=f.id}d.push({type:0,path:M,props:{[S]:v}}),p.push({type:0,path:M,props:{[S]:m}})}p.push(g.reverse),d.push(g.actual)}}else{let v=ss.apply(h,f);v!==null&&(d.push(v.actual),h=v.data,p.push(v.reverse))}}catch(v){if(v instanceof lee)return null;throw v}return{data:h,actual:d,reverse:p.reverse()}}e.apply=l})(GI||(GI={}));var dee=Symbol(),hPe=Symbol(),ET=Symbol(),$b=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let n=i;for(;!(r instanceof fee);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[ET];i&&i(),delete this._children[e]}}}},dPe=class extends $b{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,FA.runOp(this._current,e),e.path)}},pPe=class extends $b{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,qt.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},pee={get(e,t){if(t===ET)return()=>{e._parent=null};if(t===dee)return e._current;if(t===hPe)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[t];if(n!==void 0)return n;let s=i[t],a=AT(e,t,s);return a!==s?(r===void 0&&(r={},e._children=r),r[t]=a,a):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},fPe={...pee,set(e,t,i){let r={type:0,props:{[t]:dn(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},mPe={...pee,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},zk=class extends $b{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[ET]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=AT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}add(e,t,i,r,n){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:n})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(e,r[n],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(e,r[n],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},Bk=class extends $b{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[ET]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),r,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var a;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let n=(a=t.get(e))==null?void 0:a.data,s=AT(this,e,n);return s!==n?(i===void 0&&(i={},this._children=i),i[e]=s,s):n}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.add(i[r],n.id,n.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let n=t[r];this.move(i[r],n)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function qD(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Un.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var fee=class extends $b{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){qD(this.ts,t,e),qD(this.actual,i,e),qD(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function AT(e,t,i){return i instanceof _s?new zk(e,t,i):i instanceof kt?new Bk(e,t,i):i instanceof qt?new Proxy(new pPe(e,t,i),mPe):i!==null&&typeof i=="object"?Ik(i)?i:new Proxy(new dPe(e,t,i),fPe):i}function mee(e){let t=new fee(e);return[AT(t,"",e),t]}function Jx(e,t){let[i,r]=mee(e);return t(i),r.result()}function dn(e){return e instanceof zk||e instanceof Bk?e._current:e!==null&&typeof e=="object"?e[dee]:e}var Un;(e=>{function t(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}e.removeOverridden=i;function r(s,a){if((s instanceof _s||s instanceof zk)&&typeof a=="string"||(s instanceof kt||s instanceof Bk)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}e.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}e.zoom=n})(Un||(Un={}));function gPe(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function dr(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var gee=class{},rG=class extends gee{constructor(e){super(),this.id=e}},nG=class extends gee{constructor(e){super(),this.data=e}},WI;try{WI=new TextDecoder}catch{}var Pt,zd,je=0,Ba={},Yi,yd,Vo=0,Mc=0,so,Ku,wa=[],Ji,sG={useRecords:!1,mapsAsObjects:!0},vee=class{},yee=new vee;yee.name="MessagePack 0xC1";var a0=!1,GA=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Pt)return Mee(()=>(qI(),this?this.unpack(e,t):GA.prototype.unpack.call(sG,e,t)));zd=t>-1?t:e.length,je=0,Mc=0,yd=null,so=null,Pt=e;try{Ji=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Pt=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof GA){if(Ba=this,this.structures)return Yi=this.structures,pS();(!Yi||Yi.length>0)&&(Yi=[])}else Ba=sG,(!Yi||Yi.length>0)&&(Yi=[]);return pS()}unpackMultiple(e,t){let i,r=0;try{a0=!0;let n=e.length,s=this?this.unpack(e,n):TT.unpack(e,n);if(t){for(t(s);je<n;)if(r=je,t(pS())===!1)return}else{for(i=[s];je<n;)r=je,i.push(pS());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{a0=!1,qI()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let n=e[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],n=t[i];n&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=n)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function pS(){try{if(!Ba.trusted&&!a0){let t=Yi.sharedLength||0;t<Yi.length&&(Yi.length=t)}let e=Qr();if(je==zd)Yi.restoreStructures&&aG(),Yi=null,Pt=null,Ku&&(Ku=null);else if(je>zd){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!a0)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw Yi.restoreStructures&&aG(),qI(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function aG(){for(let e in Yi.restoreStructures)Yi[e]=Yi.restoreStructures[e];Yi.restoreStructures=null}function Qr(){let e=Pt[je++];if(e<160)if(e<128){if(e<64)return e;{let t=Yi[e&63]||Ba.getStructures&&xee()[e&63];return t?(t.read||(t.read=kk(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Ba.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[wee()]=Qr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Qr(),Qr());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Qr();return t}else if(e<192){let t=e-160;if(Mc>=je)return yd.slice(je-Vo,(je+=t)-Vo);if(Mc==0&&zd<140){let i=t<16?Uk(t):bee(t);if(i!=null)return i}return XI(t)}else{let t;switch(e){case 192:return null;case 193:return so?(t=Qr(),t>0?so[1].slice(so.position1,so.position1+=t):so[0].slice(so.position0,so.position0-=t)):yee;case 194:return!1;case 195:return!0;case 196:return YD(Pt[je++]);case 197:return t=Ji.getUint16(je),je+=2,YD(t);case 198:return t=Ji.getUint32(je),je+=4,YD(t);case 199:return Cp(Pt[je++]);case 200:return t=Ji.getUint16(je),je+=2,Cp(t);case 201:return t=Ji.getUint32(je),je+=4,Cp(t);case 202:if(t=Ji.getFloat32(je),Ba.useFloat32>2){let i=Fk[(Pt[je]&127)<<1|Pt[je+1]>>7];return je+=4,(i*t+(t>0?.5:-.5)>>0)/i}return je+=4,t;case 203:return t=Ji.getFloat64(je),je+=8,t;case 204:return Pt[je++];case 205:return t=Ji.getUint16(je),je+=2,t;case 206:return t=Ji.getUint32(je),je+=4,t;case 207:return Ba.int64AsNumber?(t=Ji.getUint32(je)*4294967296,t+=Ji.getUint32(je+4)):t=Ji.getBigUint64(je),je+=8,t;case 208:return Ji.getInt8(je++);case 209:return t=Ji.getInt16(je),je+=2,t;case 210:return t=Ji.getInt32(je),je+=4,t;case 211:return Ba.int64AsNumber?(t=Ji.getInt32(je)*4294967296,t+=Ji.getUint32(je+4)):t=Ji.getBigInt64(je),je+=8,t;case 212:if(t=Pt[je++],t==114)return hG(Pt[je++]&63);{let i=wa[t];if(i)return i.read?(je++,i.read(Qr())):i.noBuffer?(je++,i()):i(Pt.subarray(je,++je));throw new Error("Unknown extension "+t)}case 213:return t=Pt[je],t==114?(je++,hG(Pt[je++]&63,Pt[je++])):Cp(2);case 214:return Cp(4);case 215:return Cp(8);case 216:return Cp(16);case 217:return t=Pt[je++],Mc>=je?yd.slice(je-Vo,(je+=t)-Vo):yPe(t);case 218:return t=Ji.getUint16(je),je+=2,Mc>=je?yd.slice(je-Vo,(je+=t)-Vo):xPe(t);case 219:return t=Ji.getUint32(je),je+=4,Mc>=je?yd.slice(je-Vo,(je+=t)-Vo):bPe(t);case 220:return t=Ji.getUint16(je),je+=2,lG(t);case 221:return t=Ji.getUint32(je),je+=4,lG(t);case 222:return t=Ji.getUint16(je),je+=2,cG(t);case 223:return t=Ji.getUint32(je),je+=4,cG(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var vPe=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function kk(e,t){function i(){if(i.count++>2){let n=e.read=new Function("r","return function(){return {"+e.map(s=>vPe.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Qr);return e.highByte===0&&(e.read=oG(t,e.read)),n()}let r={};for(let n=0,s=e.length;n<s;n++){let a=e[n];r[a]=Qr()}return r}return i.count=0,e.highByte===0?oG(t,i):i}var oG=(e,t)=>function(){let i=Pt[je++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),n=Yi[r]||xee()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=kk(n,e)),n.read()};function xee(){let e=Mee(()=>(Pt=null,Ba.getStructures()));return Yi=Ba._mergeStructures(e,Yi)}var XI=CT,yPe=CT,xPe=CT,bPe=CT;function CT(e){let t;if(e<16&&(t=Uk(e)))return t;if(e>64&&WI)return WI.decode(Pt.subarray(je,je+=e));let i=je+e,r=[];for(t="";je<i;){let n=Pt[je++];if(!(n&128))r.push(n);else if((n&224)===192){let s=Pt[je++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Pt[je++]&63,a=Pt[je++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Pt[je++]&63,a=Pt[je++]&63,o=Pt[je++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(t+=es.apply(String,r),r.length=0)}return r.length>0&&(t+=es.apply(String,r)),t}function lG(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Qr();return t}function cG(e){if(Ba.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[wee()]=Qr();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Qr(),Qr());return t}}var es=String.fromCharCode;function bee(e){let t=je,i=new Array(e);for(let r=0;r<e;r++){let n=Pt[je++];if((n&128)>0){je=t;return}i[r]=n}return es.apply(String,i)}function Uk(e){if(e<4)if(e<2){if(e===0)return"";{let t=Pt[je++];if((t&128)>1){je-=1;return}return es(t)}}else{let t=Pt[je++],i=Pt[je++];if((t&128)>0||(i&128)>0){je-=2;return}if(e<3)return es(t,i);let r=Pt[je++];if((r&128)>0){je-=3;return}return es(t,i,r)}else{let t=Pt[je++],i=Pt[je++],r=Pt[je++],n=Pt[je++];if((t&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){je-=4;return}if(e<6){if(e===4)return es(t,i,r,n);{let s=Pt[je++];if((s&128)>0){je-=5;return}return es(t,i,r,n,s)}}else if(e<8){let s=Pt[je++],a=Pt[je++];if((s&128)>0||(a&128)>0){je-=6;return}if(e<7)return es(t,i,r,n,s,a);let o=Pt[je++];if((o&128)>0){je-=7;return}return es(t,i,r,n,s,a,o)}else{let s=Pt[je++],a=Pt[je++],o=Pt[je++],l=Pt[je++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){je-=8;return}if(e<10){if(e===8)return es(t,i,r,n,s,a,o,l);{let c=Pt[je++];if((c&128)>0){je-=9;return}return es(t,i,r,n,s,a,o,l,c)}}else if(e<12){let c=Pt[je++],u=Pt[je++];if((c&128)>0||(u&128)>0){je-=10;return}if(e<11)return es(t,i,r,n,s,a,o,l,c,u);let h=Pt[je++];if((h&128)>0){je-=11;return}return es(t,i,r,n,s,a,o,l,c,u,h)}else{let c=Pt[je++],u=Pt[je++],h=Pt[je++],d=Pt[je++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){je-=12;return}if(e<14){if(e===12)return es(t,i,r,n,s,a,o,l,c,u,h,d);{let p=Pt[je++];if((p&128)>0){je-=13;return}return es(t,i,r,n,s,a,o,l,c,u,h,d,p)}}else{let p=Pt[je++],f=Pt[je++];if((p&128)>0||(f&128)>0){je-=14;return}if(e<15)return es(t,i,r,n,s,a,o,l,c,u,h,d,p,f);let v=Pt[je++];if((v&128)>0){je-=15;return}return es(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v)}}}}}function YD(e){return Ba.copyBuffers?Uint8Array.prototype.slice.call(Pt,je,je+=e):Pt.subarray(je,je+=e)}function Cp(e){let t=Pt[je++];if(wa[t])return wa[t](Pt.subarray(je,je+=e));throw new Error("Unknown extension type "+t)}var uG=new Array(4096);function wee(){let e=Pt[je++];if(e>=160&&e<192){if(e=e-160,Mc>=je)return yd.slice(je-Vo,(je+=e)-Vo);if(!(Mc==0&&zd<180))return XI(e)}else return je--,Qr();let t=(e<<5^(e>1?Ji.getUint16(je):e>0?Pt[je]:0))&4095,i=uG[t],r=je,n=je+e-3,s,a=0;if(i&&i.bytes==e){for(;r<n;){if(s=Ji.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Pt[r++],s!=i[a++]){r=1879048192;break}if(r===n)return je=r,i.string;n-=3,r=je}for(i=[],uG[t]=i,i.bytes=e;r<n;)s=Ji.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Pt[r++],i.push(s);let o=e<16?Uk(e):bee(e);return o!=null?i.string=o:i.string=XI(e)}var hG=(e,t)=>{var i=Qr();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let n=Yi[e];return n&&n.isShared&&((Yi.restoreStructures||(Yi.restoreStructures=[]))[e]=n),Yi[e]=i,i.read=kk(i,r),i.read()},_ee=typeof self=="object"?self:global;wa[0]=()=>{};wa[0].noBuffer=!0;wa[101]=()=>{let e=Qr();return(_ee[e[0]]||Error)(e[1])};wa[105]=e=>{let t=Ji.getUint32(je-4);Ku||(Ku=new Map);let i=Pt[je],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Ku.set(t,n);let s=Qr();return n.used?Object.assign(r,s):(n.target=s,s)};wa[112]=e=>{let t=Ji.getUint32(je-4),i=Ku.get(t);return i.used=!0,i.target};wa[115]=()=>new Set(Qr());var See=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");wa[116]=e=>{let t=e[0],i=See[t];if(!i)throw new Error("Could not find typed array for code "+t);return new _ee[i](Uint8Array.prototype.slice.call(e,1).buffer)};wa[120]=()=>{let e=Qr();return new RegExp(e[0],e[1])};wa[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=je;je+=t-4,so=[Qr(),Qr()],so.position0=0,so.position1=0;let r=je;je=i;try{return Qr()}finally{je=r}};wa[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Mee(e){let t=zd,i=je,r=Vo,n=Mc,s=yd,a=Ku,o=so,l=new Uint8Array(Pt.slice(0,zd)),c=Yi,u=Yi.slice(0,Yi.length),h=Ba,d=a0,p=e();return zd=t,je=i,Vo=r,Mc=n,yd=s,Ku=a,so=o,Pt=l,a0=d,Yi=c,Yi.splice(0,Yi.length,...u),Ba=h,Ji=new DataView(Pt.buffer,Pt.byteOffset,Pt.byteLength),p}function qI(){Pt=null,Ku=null,Yi=null}function wPe(e){e.unpack?wa[e.type]=e.unpack:wa[e.type]=e}var Fk=new Array(147);for(let e=0;e<256;e++)Fk[e]=+("1e"+Math.floor(45.15-e*.30103));var TT=new GA({useRecords:!1});TT.unpack;TT.unpackMultiple;TT.unpack;var _Pe=new Float32Array(1);new Uint8Array(_Pe.buffer,0,4);var wE;try{wE=new TextEncoder}catch{}var WA,Vk,PT=typeof Buffer<"u",ZD=PT?Buffer.allocUnsafeSlow:Uint8Array,Eee=PT?Buffer:Uint8Array,dG=PT?4294967296:2144337920,ot,sn,qe=0,nc,sc=null,SPe=/[\u0080-\uFFFF]/,Ny=Symbol("record-id"),Aee=class extends GA{constructor(e){super(e),this.offset=0;let t,i,r,n,s,a=0,o=Eee.prototype.utf8Write?function(S,E,A){return ot.utf8Write(S,E,A)}:wE&&wE.encodeInto?function(S,E){return wE.encodeInto(S,ot.subarray(E)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,f=h+64,v=h+d+64;if(v>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],g=0,y=0;this.pack=this.encode=function(S,E){if(ot||(ot=new ZD(8192),sn=new DataView(ot.buffer,0,8192),qe=0),nc=ot.length-10,nc-qe<2048?(ot=new ZD(ot.length),sn=new DataView(ot.buffer,0,ot.length),nc=ot.length-10,qe=0):qe=qe+7&2147483640,t=qe,s=l.structuredClone?new Map:null,l.bundleStrings?(sc=["",""],ot[qe++]=214,ot[qe++]=98,sc.position=qe-t,qe+=4):sc=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let A=i.sharedLength||0;if(A>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let P=0;P<A;P++){let C=i[P];if(!C)continue;let D,N=i.transitions;for(let U=0,I=C.length;U<I;U++){let G=C[U];D=N[G],D||(D=N[G]=Object.create(null)),N=D}N[Ny]=P+64}a=A}c||(i.nextId=A+64)}r&&(r=!1),n=i||[];try{if(x(S),sc){sn.setUint32(sc.position+t,qe-sc.position-t);let A=sc;sc=null,x(A[0]),x(A[1])}if(l.offset=qe,s&&s.idsToInsert){qe+=s.idsToInsert.length*6,qe>nc&&M(qe),l.offset=qe;let A=EPe(ot.subarray(t,qe),s.idsToInsert);return s=null,A}return E&APe?(ot.start=t,ot.end=qe,ot):ot.subarray(t,qe)}finally{if(i){if(y<10&&y++,g>1e4)i.transitions=null,y=0,g=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let A=0,P=m.length;A<P;A++)m[A][Ny]=0;m=[]}if(r&&l.saveStructures){let A=i.sharedLength||h;i.length>A&&(i=i.slice(0,A));let P=ot.subarray(t,qe);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(S)):(a=A,P)}}E&CPe&&(qe=t)}};let x=S=>{qe>nc&&(ot=M(qe));var E=typeof S,A;if(E==="string"){let P=S.length;if(sc&&P>=8&&P<4096){let N=SPe.test(S);sc[N?0:1]+=S,ot[qe++]=193,x(N?-P:P);return}let C;P<32?C=1:P<256?C=2:P<65536?C=3:C=5;let D=P*3;if(qe+D>nc&&(ot=M(qe+D)),P<64||!o){let N,U,I,G=qe+C;for(N=0;N<P;N++)U=S.charCodeAt(N),U<128?ot[G++]=U:U<2048?(ot[G++]=U>>6|192,ot[G++]=U&63|128):(U&64512)===55296&&((I=S.charCodeAt(N+1))&64512)===56320?(U=65536+((U&1023)<<10)+(I&1023),N++,ot[G++]=U>>18|240,ot[G++]=U>>12&63|128,ot[G++]=U>>6&63|128,ot[G++]=U&63|128):(ot[G++]=U>>12|224,ot[G++]=U>>6&63|128,ot[G++]=U&63|128);A=G-qe-C}else A=o(S,qe+C,D);A<32?ot[qe++]=160|A:A<256?(C<2&&ot.copyWithin(qe+2,qe+1,qe+1+A),ot[qe++]=217,ot[qe++]=A):A<65536?(C<3&&ot.copyWithin(qe+3,qe+2,qe+2+A),ot[qe++]=218,ot[qe++]=A>>8,ot[qe++]=A&255):(C<5&&ot.copyWithin(qe+5,qe+3,qe+3+A),ot[qe++]=219,sn.setUint32(qe,A),qe+=4),qe+=A}else if(E==="number")if(S>>>0===S)S<64?ot[qe++]=S:S<256?(ot[qe++]=204,ot[qe++]=S):S<65536?(ot[qe++]=205,ot[qe++]=S>>8,ot[qe++]=S&255):(ot[qe++]=206,sn.setUint32(qe,S),qe+=4);else if(S>>0===S)S>=-32?ot[qe++]=256+S:S>=-128?(ot[qe++]=208,ot[qe++]=S+256):S>=-32768?(ot[qe++]=209,sn.setInt16(qe,S),qe+=2):(ot[qe++]=210,sn.setInt32(qe,S),qe+=4);else{let P;if((P=this.useFloat32)>0&&S<4294967296&&S>=-2147483648){ot[qe++]=202,sn.setFloat32(qe,S);let C;if(P<4||(C=S*Fk[(ot[qe]&127)<<1|ot[qe+1]>>7])>>0===C){qe+=4;return}else qe--}ot[qe++]=203,sn.setFloat64(qe,S),qe+=8}else if(E==="object")if(!S)ot[qe++]=192;else{if(s){let C=s.get(S);if(C){if(!C.id){let D=s.idsToInsert||(s.idsToInsert=[]);C.id=D.push(C)}ot[qe++]=214,ot[qe++]=112,sn.setUint32(qe,C.id),qe+=4;return}else s.set(S,{offset:qe-t})}let P=S.constructor;if(P===Object)_(S,!0);else if(P===Array){A=S.length,A<16?ot[qe++]=144|A:A<65536?(ot[qe++]=220,ot[qe++]=A>>8,ot[qe++]=A&255):(ot[qe++]=221,sn.setUint32(qe,A),qe+=4);for(let C=0;C<A;C++)x(S[C])}else if(P===Map){A=S.size,A<16?ot[qe++]=128|A:A<65536?(ot[qe++]=222,ot[qe++]=A>>8,ot[qe++]=A&255):(ot[qe++]=223,sn.setUint32(qe,A),qe+=4);for(let[C,D]of S)x(C),x(D)}else{for(let C=0,D=WA.length;C<D;C++){let N=Vk[C];if(S instanceof N){let U=WA[C];if(U.write){U.type&&(ot[qe++]=212,ot[qe++]=U.type,ot[qe++]=0),x(U.write.call(this,S));return}let I=ot,G=sn,Q=qe;ot=null;let Y;try{Y=U.pack.call(this,S,O=>(ot=I,I=null,qe+=O,qe>nc&&M(qe),{target:ot,targetView:sn,position:qe-O}),x)}finally{I&&(ot=I,sn=G,qe=Q,nc=ot.length-10)}Y&&(Y.length+qe>nc&&M(Y.length+qe),qe=MPe(Y,ot,qe,U.type));return}}_(S,!S.hasOwnProperty)}}else if(E==="boolean")ot[qe++]=S?195:194;else if(E==="bigint"){if(S<BigInt(1)<<BigInt(63)&&S>=-(BigInt(1)<<BigInt(63)))ot[qe++]=211,sn.setBigInt64(qe,S);else if(S<BigInt(1)<<BigInt(64)&&S>0)ot[qe++]=207,sn.setBigUint64(qe,S);else if(this.largeBigIntToFloat)ot[qe++]=203,sn.setFloat64(qe,Number(S));else throw new RangeError(S+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");qe+=8}else if(E==="undefined")this.encodeUndefinedAsNil?ot[qe++]=192:(ot[qe++]=212,ot[qe++]=0,ot[qe++]=0);else if(E==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+E)},_=this.useRecords===!1?this.variableMapSize?S=>{let E=Object.keys(S),A=E.length;A<16?ot[qe++]=128|A:A<65536?(ot[qe++]=222,ot[qe++]=A>>8,ot[qe++]=A&255):(ot[qe++]=223,sn.setUint32(qe,A),qe+=4);let P;for(let C=0;C<A;C++)x(P=E[C]),x(S[P])}:(S,E)=>{ot[qe++]=222;let A=qe-t;qe+=2;let P=0;for(let C in S)(E||S.hasOwnProperty(C))&&(x(C),x(S[C]),P++);ot[A+++t]=P>>8,ot[A+t]=P&255}:S=>{let E=Object.keys(S),A,P=n.transitions||(n.transitions=Object.create(null)),C=0;for(let N=0,U=E.length;N<U;N++){let I=E[N];A=P[I],A||(A=P[I]=Object.create(null),C++),P=A}let D=P[Ny];if(D)D>=96&&p?(ot[qe++]=((D-=96)&31)+96,ot[qe++]=D>>5):ot[qe++]=D;else{D=n.nextId,D||(D=64),D<f&&this.shouldShareStructure&&!this.shouldShareStructure(E)?(D=n.nextOwnId,D<v||(D=f),n.nextOwnId=D+1):(D>=v&&(D=f),n.nextId=D+1);let N=E.highByte=D>=96&&p?D-96>>5:-1;P[Ny]=D,n[D-64]=E,D<f?(E.isShared=!0,n.sharedLength=D-63,r=!0,N>=0?(ot[qe++]=(D&31)+96,ot[qe++]=N):ot[qe++]=D):(N>=0?(ot[qe++]=213,ot[qe++]=114,ot[qe++]=(D&31)+96,ot[qe++]=N):(ot[qe++]=212,ot[qe++]=114,ot[qe++]=D),C&&(g+=y*C),m.length>=d&&(m.shift()[Ny]=0),m.push(P),x(E))}for(let N=0,U=E.length;N<U;N++)x(S[E[N]])},M=S=>{let E;if(S>16777216){if(S-t>dG)throw new Error("Packed buffer would be larger than maximum buffer size");E=Math.min(dG,Math.round(Math.max((S-t)*(S>67108864?1.25:2),4194304)/4096)*4096)}else E=(Math.max(S-t<<2,ot.length-1)>>12)+1<<12;let A=new ZD(E);return sn=new DataView(A.buffer,0,E),ot.copy?ot.copy(A,0,t,S):A.set(ot.slice(t,S)),qe-=t,t=0,nc=A.length-10,ot=A}}useBuffer(e){ot=e,sn=new DataView(ot.buffer,ot.byteOffset,ot.byteLength),qe=0}};Vk=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,vee];WA=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=t(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=t(10);n[a++]=215,n[a++]=255,s.setUint32(a,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=t(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=t(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,e.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:n,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:n}=t(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?pG(e,16,t):fG(PT?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==Eee&&this.structuredClone?pG(e,See.indexOf(i.name),t):fG(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function pG(e,t,i,r){let n=e.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function fG(e,t){let i=e.byteLength;var r,n;if(i<256){var{target:r,position:n}=t(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=t(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=t(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(e,n)}function MPe(e,t,i,r){let n=e.length;switch(n){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:n<256?(t[i++]=199,t[i++]=n):n<65536?(t[i++]=200,t[i++]=n>>8,t[i++]=n&255):(t[i++]=201,t[i++]=n>>24,t[i++]=n>>16&255,t[i++]=n>>8&255,t[i++]=n&255)}return t[i++]=r,t.set(e,i),i+=n,i}function EPe(e,t){let i,r=t.length*6,n=e.length-r;for(t.sort((s,a)=>s.offset>a.offset?1:-1);i=t.pop();){let s=i.offset,a=i.id;e.copyWithin(s+r,s,n),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=a>>24,e[o++]=a>>16&255,e[o++]=a>>8&255,e[o++]=a&255,n=s}return e}function k0(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");Vk.unshift(e.Class),WA.unshift(e)}wPe(e)}var Cee=new Aee({useRecords:!1});Cee.pack;Cee.pack;var APe=512,CPe=1024,mG=new Aee({structuredClone:!0});k0({Class:qt.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,qt.prototype),e}});k0({Class:kt.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,kt.prototype),e}});k0({Class:_s.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,_s.prototype),e}});k0({Class:rG.prototype.constructor,type:4,write(e){return e.id},read(e){return new rG(e)}});k0({Class:nG.prototype.constructor,type:5,write(e){return e.data},read(e){return new nG(e)}});k0({Class:Pn.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,Pn.prototype),e}});function TPe(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function YI(e){if(Ik(e))return e;if(Array.isArray(e))return e.map(YI);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=YI(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var ZI;(e=>{function t(n){return mG.pack(n)}e.serialize=t;function i(n){return mG.unpack(n)}e.deserialize=i;function r(n){return TPe(t(YI(n))).toString()}e.checksum=r})(ZI||(ZI={}));var gG;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(gG||(gG={}));function vG(e){return e==="MouseDown"||e==="MouseUp"||e==="KeyDown"||e==="KeyUp"||e==="Collision"||e==="Trigger"}var Bs={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},yG;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new kt}:{type:r,disabled:!1,key:void 0,actions:new kt}}e.defaultData=i})(yG||(yG={}));var XA;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(XA||(XA={}));var QI;(e=>{function t(n){return{type:"Comparison",operator:"==",lOperand:XA.propertyDefaultData(n),rOperand:{...XA.valueDefaultData}}}e.comparisonDefaultData=t;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}e.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}e.stateDefaultData=r})(QI||(QI={}));var xG;(e=>{function t(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}e.isConditionalSubActions=t})(xG||(xG={}));var bG;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new kt,outActions:new kt,condition:QI.distanceDefaultData(r)}}e.defaultData=i})(bG||(bG={}));var wG;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new kt,drop:new kt}})(wG||(wG={}));var KI;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new kt})(KI||(KI={}));var JI;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(JI||(JI={}));var _G;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new kt}}e.defaultData=i})(_G||(_G={}));var SG;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new kt}}e.defaultData=i})(SG||(SG={}));var MG;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new kt}}e.defaultData=i})(MG||(MG={}));var EG;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new kt}}e.defaultData=i})(EG||(EG={}));var AG;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new kt,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(AG||(AG={}));var $I;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(a){return a.type==="Resize"}e.is=t;function i(a){return typeof a=="string"?a:"custom"}e.sizeToDevice=i;function r(a){return typeof a=="string"?[...e.defaultSizes[a]]:[...a]}e.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new kt},o={size:"tablet",operator:"<",actions:new kt},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new kt},c=new kt;return c.push({id:Mt.generateUUID(),fi:0,data:a},{id:Mt.generateUUID(),fi:1,data:o},{id:Mt.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=n;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new kt}}e.defaultBreakpointData=s})($I||($I={}));var eO;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new kt,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(eO||(eO={}));var CG;(e=>{function t(r){return r.type==="API"}e.is=t;function i(){return{disabled:!1,type:"API",successActions:new kt,errorActions:new kt,userAPIId:""}}e.defaultData=i})(CG||(CG={}));var TG;(e=>{function t(r){return r.type==="WEBHOOK"}e.is=t;function i(){return{disabled:!1,type:"WEBHOOK",actions:new kt,userWebhookId:""}}e.defaultData=i})(TG||(TG={}));var PG;(e=>{function t(r){return r.type==="AIAssistantListener"}e.is=t;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new kt,analysis:"average",analysisRange:[0,71],analysisSingle:0}}e.defaultData=i})(PG||(PG={}));var DG;(e=>{function t(r){return r.type==="AIAssistantTrigger"}e.is=t;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new kt}}e.defaultData=i})(DG||(DG={}));var U0="personal camera",$1="a218fcc3-276b-49b9-b485-49037fd14f5f",PPe=2960946,vo=5526619,Gu;(e=>{function t(f,v){return f[0]===v[0]&&f[1]===v[1]}e.isEqual=t;function i(f,v,m){return[f[0]+(v[0]-f[0])*m,f[1]+(v[1]-f[1])*m]}e.lerp=i;function r(f,v){return[f[0]+v[0],f[1]+v[1]]}e.add=r;function n(f,v){return[f[0]-v[0],f[1]-v[1]]}e.sub=n;function s(f,v){return[f[0]*v[0],f[1]*v[1]]}e.multiply=s;function a(f,v){return[f[0]/v[0],f[1]/v[1]]}e.divide=a;function o(f,v){return Math.pow(v[0]-f[0],2)+Math.pow(v[1]-f[1],2)}e.distanceSquared=o;function l(f,v){return Math.sqrt(o(f,v))}e.distance=l;function c(f,v){return f[0]*v[0]+f[1]*v[1]}e.dot=c;function u(f,v){return[f[0]*v,f[1]*v]}e.scalarMultiply=u;function h(f,v,m){let g=e.sub(v,f),y=e.sub(m,f),x=e.dot(g,y)/e.dot(g,g),_=e.scalarMultiply(g,x);return e.add(f,_)}e.projectionOnto=h;function d(f,v,m){return l(f,h(f,v,m))}e.projectionOntoDistance=d;function p(f,v){return[(f[0]+v[0])*.5,(f[1]+v[1])*.5]}e.center=p})(Gu||(Gu={}));var Bf;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(Bf||(Bf={}));var qA;(e=>{function t(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}e.isEqual=t;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}e.lerp=i})(qA||(qA={}));var LG;(e=>{let t=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*t:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}e.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}e.degToRad=a})(LG||(LG={}));var o0;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}e.isEqual=t;function i(n){return n??e.identity}e.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}e.applyMatrix4=r})(o0||(o0={}));var bs;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function n(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=n;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function a(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=a;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(bs||(bs={}));var ar;(e=>{e.white={...bs.white,a:1},e.transparent={...bs.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...bs.fromHex(l),a:c}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function n(l,c){return bs.equals(l,c)&&l.a===c.a}e.equals=n;function s(l,c){return bs.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function a(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=a;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(ar||(ar={}));var tO;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(tO||(tO={}));var RG;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(RG||(RG={}));var IG;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(IG||(IG={}));var id;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(id||(id={}));function OG(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var $f;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})($f||($f={}));var l0;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){var r,n;return i.type==="PerspectiveCamera"?((r=i.perspective)==null?void 0:r.zoom)??1:((n=i.orthographic)==null?void 0:n.zoom)??1}e.getZoom=t})(l0||(l0={}));var xd;(e=>{function t(r,n=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*n,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+n)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,n){let s={...r};if(Tee.forEach(a=>{Object.assign(s,{[a]:n[a]??r[a]})}),s.radial={...r.radial},n.radial){let a=r.radial,o=n.radial;Pee.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??a[l]})})}if(s.linear={...r.linear},n.linear){let a=r.linear,o=n.linear;Dee.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??a[l]})})}if(s.grid={...r.grid},n.grid){let a=r.grid,o=n.grid;Lee.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??a[l]})})}if(s.toObject={...r.toObject},n.toObject){let a=r.toObject,o=n.toObject;Ree.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??a[l]})})}if(s.randomnessObject={...r.randomnessObject},n.randomnessObject){let a=r.randomnessObject,o=n.randomnessObject;Iee.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??a[l]})})}return s}e.merge=i})(xd||(xd={}));var iO;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of t){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}e.toOps=i})(iO||(iO={}));var Tee=["count"],Pee=["radius","start","end","position","scale","rotation"],Dee=["position","scale","rotation"],Lee=["count","size"],Ree=["count","position","scale","rotation"],Iee=["strength","scale","rotation","position","movement","seed","freqScale"],rO;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(rO||(rO={}));var nO;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:ar.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:ar.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:ar.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(nO||(nO={}));var YA;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...e.defaultCollisionData}))(YA||(YA={}));var c0;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(c0||(c0={}));var sO;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(sO||(sO={}));var aO;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(aO||(aO={}));var oO;(e=>e.defaultData={...aO.defaultData,...sO.defaultData})(oO||(oO={}));var NG;(e=>{function t(i,r){var s,a;let n=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&n.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((a=r.lib.materials[o])==null?void 0:a.asset):o;l&&n.push(l)}return n}e.getMaterialData=t})(NG||(NG={}));var ZA;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(ZA||(ZA={}));var zG;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(zG||(zG={}));function DPe(e){return e.type!=="displace"}var BG;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(BG||(BG={}));var Oee=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],LPe=["wrapping","image","video","name","minFilter","magFilter"],ts;(e=>{function t(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,a){return s==="light"&&a?r(a):n(s)}e.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:ZA.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:bs.fromHex(vo)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...bs.fromHex(6710886),a:1},colorB:{...bs.fromHex(6710886),a:1},colorC:{...bs.fromHex(16777215),a:1},colorD:{...bs.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:ar.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:ar.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:ar.fromHexAndA(0,1),contourColor:ar.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...bs.fromHex(0),a:1},colorB:{...bs.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(ts||(ts={}));var as;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,f])=>{h+=`${p}${f}`,Array.isArray(f)?f.forEach(v=>h+=`${v}`):typeof f=="object"?Object.values(f).forEach(v=>{typeof v=="number"?h+=`${v.toFixed(4)}`:h+=`${v}`}):h+=`${f}`})}),h}e.getHash=i;function r(){return{layers:new kt}}e.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}e.defaultData=n;function s(u,h){return{...u,name:h}}e.withName=s;function a(u,h="layer1",d="layer2"){let p=new kt;return p.push({fi:0,data:ts.defaultData("light",u),id:h}),p.push({fi:1,data:ts.defaultData("color"),id:d}),{layers:p}}e.defaultTwoLayerData=a;function o(u){let h=ts.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new kt;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...ts.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...ts.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",p="layer2"){let f=ts.defaultData("texture");Object.assign(f.texture,{image:u});let v=new kt;return v.push({fi:0,data:f,id:d}),v.push({fi:1,data:ts.defaultData("light",h),id:p}),{layers:v}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",p="layer2"){let f=ts.defaultData("video");Object.assign(f.texture,{video:u});let v=new kt;return v.push({fi:0,data:f,id:d}),v.push({fi:1,data:ts.defaultData("light",h),id:p}),{layers:v}}e.defaultTwoLayerVideoTextureData=c})(as||(as={}));var QA;(e=>{function t(){return{points:new kt,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(QA||(QA={}));var KA;(e=>{function t(){return{points:new kt,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(KA||(KA={}));var Nee={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},lO;(e=>{function t(i,r){let n={...i};return Bee.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}e.merge=t})(lO||(lO={}));var zee={shape:Nee,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},Bee=["depth","offset","angle","twist","startScale","endScale"],JA;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"||r==="InputGeometry"}e.isParametricMesh=i})(JA||(JA={}));var cO;(e=>{function t(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,lO.merge(n.extrusion,r.extrusion))),n}e.merge=t})(cO||(cO={}));var od;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:KA.defaultData(),extrusion:zee};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:QA.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...e.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(od||(od={}));var QD=["width","height","depth"],uO;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:bs.white,near:.1,far:2e3})(uO||(uO={}));var $A;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})($A||($A={}));var hO;(e=>e.defaultData={softShadowQuality:"low"})(hO||(hO={}));var dO;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(dO||(dO={}));var pO;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(pO||(pO={}));var u0;(e=>e.defaultData={usePhysics:!1,gravity:-10})(u0||(u0={}));var fO;(e=>e.defaultData={playCamera:U0,gameControlObject:null})(fO||(fO={}));var mO;(e=>e.defaultData={backgroundColor:ar.fromHexAndA(PPe,1),postprocessing:$A.defaultData,fog:uO.defaultData,globalPhysics:u0.defaultData,ambient:dO.defaultData,ao:pO.defaultData,shadow:hO.defaultData,publish:fO.defaultData})(mO||(mO={}));var gO;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(gO||(gO={}));var kG;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(kG||(kG={}));var h0;(e=>{e.identity={...tO.identity,hiddenMatrix:o0.identity};function t(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}e.fromObject=t;function i(n,s){return{position:(s==null?void 0:s.position)||n.position,rotation:(s==null?void 0:s.rotation)||n.rotation,scale:(s==null?void 0:s.scale)||n.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||n.hiddenMatrix}}e.merge=i;function r(n,s){return $$({position:Bf.isEqual(n.position,s.position)?void 0:s.position,rotation:Bf.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:Bf.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:o0.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(h0||(h0={}));var Fn;(e=>e.defaultData={states:new kt,events:new kt,visible:!0,raycastLock:!1,physics:c0.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...h0.identity,cloner:null})(Fn||(Fn={}));var vO;(e=>e.defaultData={type:"Empty",...Fn.defaultData})(vO||(vO={}));var UG;(e=>e.defaultData={type:"ParticleCollider",...gO.defaultData,...Fn.defaultData})(UG||(UG={}));var FG;(e=>e.defaultData={type:"Component",...Fn.defaultData})(FG||(FG={}));var VG;(e=>e.defaultData={type:"Particle",...Fn.defaultData,...YA.defaultData})(VG||(VG={}));var ld;(e=>e.defaultData={type:"Mesh",...Fn.defaultData,...oO.defaultData})(ld||(ld={}));var $x;(e=>e.defaultData={...Fn.defaultData,...h0.identity,position:[0,0,l0.DefaultTargetOffset],...l0.defaultData})($x||($x={}));var yO;(e=>{function t(i){return{...Fn.defaultData,...nO.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(yO||(yO={}));var eC;(e=>{function t(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,n,s=0){let a=t(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}e.resolve=i})(eC||(eC={}));var bd;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,n){return{...Fn.defaultData,...n,component:r,overrides:new Pn,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let n=h0.fromObject(r.data);return t(r.id,n)}e.fromComponentData=i})(bd||(bd={}));var d0;(e=>{e.defaultData={type:"Page",...Fn.defaultData,physics:{...c0.defaultData,fusedBody:!1},...mO.defaultData,camera:$x.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(d0||(d0={}));var xO;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:o0.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:c0.defaultData,states:new kt,events:new kt,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...l0.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Fn.defaultData,...ld.defaultData,geometry:od.defaultData("RectangleGeometry"),material:as.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Fn.defaultData,...ld.defaultData,geometry:od.defaultData("BooleanGeometry"),material:as.defaultTwoLayerData("phong","layer1","layer2")},e.defaultShapeBlendObject={name:"Shape Blend",...Fn.defaultData,...ld.defaultData,geometry:od.defaultData("ShapeBlendGeometry"),material:as.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Fn.defaultData,...ld.defaultData,geometry:od.defaultData("TextGeometry"),material:as.defaultTwoLayerData("phong","layer1","layer2")},e.defaultInputObject={name:"Input",...Fn.defaultData,...ld.defaultData,geometry:od.defaultData("InputGeometry"),material:as.defaultTwoLayerData("phong","layer1","layer2")}))(xO||(xO={}));var yf;(e=>{function t(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new Pn}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new Pn})))):$f.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=Jx(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&ts.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=Jx(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=a.materials[h];if(typeof d!="string")for(let[p,f]of Object.entries(d.layers)){let v=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(p);v&&ts.patch(v,f)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[p,f]of Object.entries(d.layers)){let{texture:v,...m}=f;if(v!==void 0&&Object.keys(v).length>0){let g={path:[...h,"layers",p,"texture"],props:v,type:0};l.push(g)}if(Object.keys(m).length>0){let g={path:[...h,"layers",p],props:m,type:0};l.push(g)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...iO.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[p,f]of Object.entries(d))u(["materials",p],f);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function n(s,a){var l,c,u,h,d,p;if(a===void 0)return s;let o={...s};if(Object.assign(o,h0.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=a.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=a.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),$f.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let f=a;((d=f.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(o.targetOffset=f.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:cO.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:xd.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:xd.merge(o.cloner,a.cloner)});else if(rO.is(s.type)){let f=a;f.intensity!==void 0&&(o.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?o.color=f.color:o.color=bs.clone(f.color))}return o}e.patch=n})(yf||(yf={}));var tC;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(tC||(tC={}));var wd;(e=>e.defaultData={orbitControls:tC.defaultData,playPage:$1,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70}},stopRaycast:!0,hdTransmission:!1})(wd||(wd={}));var bO;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(bO||(bO={}));var wO;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(wO||(wO={}));var xf;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...bO.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:wO.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(xf||(xf={}));var eb;(e=>{function t(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{var l;if(o.type==="Instance"){let c=(l=nC.getComponentData(r,o.component))==null?void 0:l.data;c&&s(a,o,c.events)}else s(a,o,o.events)})}e.traverseModuleInstances=i})(eb||(eb={}));var bf;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:yO.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function t(n=!0,s=[]){let a=[],o=xO.defaultMeshObject;n&&(a.push({...e.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new _s;return l.push({fi:1,id:$1,data:{...d0.defaultData,name:"Scene 1"},children:a}),l}e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:wd.defaultData,styles:xf.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new _s,publish:wd.defaultData,styles:xf.defaultData()}},e.emptyDataWithPage=function(n=!0){return{objects:t(n),publish:wd.defaultData,styles:xf.defaultData()}},e.emptyData=function(){return{objects:new _s,publish:{...wd.defaultData},styles:xf.defaultData()}};function i(n){return{...e.defaultData,objects:nl(n,_s.prototype)}}e.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}e.withObj=r})(bf||(bf={}));var ex;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(ex||(ex={}));var _O;(e=>(e.defaultData=t=>({url:t,name:"New Webhook",parametersSchemas:new kt}),e.defaultParameterValueByType=t=>t==="number"?0:t==="boolean"?!1:""))(_O||(_O={}));var jG;(e=>e.defaultData=(t,i="GET")=>({url:t,method:i,name:"New API",headers:new kt,queries:new kt,autoStart:!0}))(jG||(jG={}));var Ss;(e=>{function t(a){return a.textValue!==void 0}e.isTextValue=t;function i(a){return typeof a=="number"}e.isNumber=i;function r(a){return typeof a=="boolean"}e.isBoolean=r;function n(a){return t(a)?"string":r(a)?"boolean":"number"}e.typeOfVariable=n;function s(a){return e.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():e.isBoolean(a)?a?"True":"False":e.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}e.getDisplayedValue=s})(Ss||(Ss={}));var SO;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(SO||(SO={}));var HG;(e=>e.all=[...SO.all,"components"])(HG||(HG={}));var GG;(e=>{function t(){return{images:new qt,videos:new qt,colors:new qt,audios:new qt,particles:new qt,fonts:new qt,materials:new qt,components:new qt,variables:new qt,userAPIs:new qt,userWebhooks:new qt}}e.defaultData=t})(GG||(GG={}));var lh;(e=>{function t(){return{images:new qt,videos:new qt,colors:new qt,audios:new qt,particles:new qt,fonts:new qt,materials:new qt,components:new qt,variables:new qt,userAPIs:new qt,userWebhooks:new qt}}e.defaultData=t})(lh||(lh={}));var jo;(e=>{function t(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},nl(a,qt.prototype)}e.defaultColors=t;function i(){return nl({},qt.prototype)}e.defaultImages=i;function r(){return{catelogs:new qt,materials:new qt,images:new qt,videos:new qt,colors:new qt,audios:new qt,particles:new qt,fonts:new qt,variables:new kt,userAPIs:new qt,userWebhooks:new qt,lib:lh.defaultData()}}e.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}e.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}e.getFormattedTimerTime=s})(jo||(jo={}));var iC;(e=>e.list=["idle","move","jump","run"])(iC||(iC={}));var rC;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new kt,move:new kt,jump:new kt,run:new kt},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:ar.fromHexAndA(3728051,1)}}))(rC||(rC={}));function WG(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Bc(dn(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,a)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...dn(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function cd(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function ud(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=as.defaultData(),n=r.materials[s]),typeof n!="string"&&t(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=as.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=as.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==Pn.prototype&&t(n.material)})})}function RPe(e){Object.assign(e.scene.publish,{orbitControls:{...tC.defaultData,...dn(e.scene.publish.orbitControls)}})}function IPe(e){Object.assign(e.scene.publish.settings,{video:{...wd.defaultData.settings.video,...dn(e.scene.publish.settings.video)}})}function OPe(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((Oee.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(LPe.includes(a)||typeof o=="boolean")&&delete s[a]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?t(s.material):s.materials&&s.materials.forEach(a=>{t(a)})})})}function NPe(e){e.scene.publish.withBackground=!0}function zPe(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function BPe(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function kPe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function UPe(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let n=dn(e.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=dn(i).booleanExclude!==!0)}})}function FPe(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function VPe(e){function t(r){Object.setPrototypeOf(r,Pn.prototype),r.texture&&Object.setPrototypeOf(r.texture,Pn.prototype)}function i(r){Object.setPrototypeOf(r,Pn.prototype);for(let n in r)t(r[n])}e.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=dn(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=dn(l).layers;i(c),l.layers=c}})})}function XG(e){e.layers===void 0&&Object.assign(e,as.defaultTwoLayerData("lambert"))}function KD(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let n={...dn(t),colors:i,steps:r};Object.assign(t,n)}})}function jPe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function qG(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&KD(r)}):"material"in i&&typeof i.material!="string"&&KD(i.material)}),Object.values(e.shared.materials).forEach(t=>KD(t))}function HPe(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function GPe(e){e.shared.audios=nl({},qt.prototype)}function WPe(e){e.shared.videos=nl({},qt.prototype)}function XPe(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:n})}})}function qPe(e){Object.entries(dn(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(dn(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function YPe(e){e.scene.publish.settings.web.preload=!1}function YG(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function ZG(e){e.layers&&e.layers.forEach(t=>{DPe(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function ZPe(e){e.shared.fonts=nl({},qt.prototype)}function QPe(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function KPe(e){let t=[];e.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=as.defaultTwoLayerData("phong"),a=typeof n.color=="string"?e.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=QPe(n.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:n.name,...Fn.defaultData,...ld.defaultData,flatShading:!1,wireframe:!1,geometry:{...od.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:dn(n.states),events:dn(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=dn(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function JPe(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(t[Number(n.type)])if(Object.assign(n,{type:t[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new kt,move:new kt,jump:new kt}});else{let s=new kt;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Mt.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,Bc(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},p={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new kt({fi:0,id:Mt.generateUUID(),data:c},{fi:1,id:Mt.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete n.targets)}})})}function $Pe(e){e.scene.objects.traverse((t,i)=>{function r(n,s){var l;let a=new kt,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...Bc(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...Bc(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&a.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),a.length){let c=(l=i.events.find(u=>u.type===n))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Mt.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function QG(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=ts.defaultData("light","phong"),n=t;Object.assign(n,r),n.visible=!1}}function KG(e){cd(e,QG),ud(e,QG)}function eDe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function tDe(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function iDe(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=as.defaultTwoLayerData("phong"))})}function rDe(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function nDe(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function sDe(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function aDe(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function oDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function lDe(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function cDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=rC.defaultDataThirdPerson.navmesh)})})}function uDe(e){e.scene.styles||(e.scene.styles=xf.defaultData())}function JG(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function hDe(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),ud(e,JG),cd(e,JG)}function dDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new kt})})})}function pDe(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}function $G(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function fDe(e,t){if(t<1&&(ud(e,WG),cd(e,WG),e.schema=1),t<2&&(RPe(e),e.schema=2),t<3&&(OPe(e),e.schema=3),t<4&&(NPe(e),e.schema=4),t<5&&(zPe(e),e.schema=5),t<6&&(BPe(e),e.schema=6),t<7&&(kPe(e),e.schema=7),t<8&&(e.schema=8),t<9&&(qG(e),e.schema=9),t<10&&(jPe(e),e.schema=10),t<11&&(HPe(e),e.schema=11),t<12&&(qG(e),e.schema=12),t<13&&(GPe(e),e.schema=13),t<14&&(XPe(e),e.schema=14),t<15&&(qPe(e),e.schema=15),t<16&&(YPe(e),e.schema=16),t<17&&(ud(e,YG),cd(e,YG),e.schema=17),t<18&&(ud(e,XG),cd(e,XG),e.schema=18),t<19&&(IPe(e),e.schema=19),t<20&&(ZPe(e),KPe(e),e.schema=20),t<21&&(JPe(e),$Pe(e),e.schema=21),t<22&&(KG(e),e.schema=22),t<23&&(eDe(e),e.schema=23),t<24&&(tDe(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(WPe(e),t<25&&(e.schema=25)),t<26&&(UPe(e),e.schema=26),t<27&&(FPe(e),e.schema=27),t<28&&(KG(e),e.schema=28),t<29&&(VPe(e),e.schema=29),t<30&&(iDe(e),e.schema=30),t<31&&(rDe(e),e.schema=31),t<33&&(nDe(e),e.schema=33),t<34&&(sDe(e),e.schema=34),t<35&&(aDe(e),e.schema=35),t<36&&(oDe(e),e.schema=36),t<37&&(lDe(e),e.schema=37),t<38&&(ud(e,ZG),cd(e,ZG),e.schema=38),t<39&&(cDe(e),e.schema=39),t<40&&(uDe(e),e.schema=40),t<41&&(hDe(e),e.schema=41),t<42&&(dDe(e),e.schema=42),t<43&&(pDe(e),e.schema=43),t<99){ud(e,$G),cd(e,$G),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=U0);let i=dn(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=$1,r.insertBefore(null,null,[{id:$1,data:{...d0.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Bc(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Bc(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...u0.defaultData,...Bc(e.scene.environment,"usePhysics","gravity")},camera:dn(e.scene.ownerCamera)??d0.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==bf.TRASH_CAN_ID&&r.move($1,a.fi,a.id);let n=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,c0.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function eW(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function mDe(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function gDe(e){var t;Array.isArray(dn(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var Vg=180/Math.PI;function tW(e){e.rotation=e.rotation.slice(0,3).map(t=>t*Vg)}function kee(e){var i,r;tW(e),e.type==="Page"&&tW(e.camera),(i=e.states)==null||i.forEach(n=>{n.rotation===void 0||n.rotation===null||(n.rotation=n.rotation.slice(0,3).map(s=>s*Vg))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*Vg),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*Vg),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=Vg,t.extrusion.twist*=Vg),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(dn(e.events))&&((r=e.events)==null||r.forEach(n=>{(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="MousePress"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="KeyPress"||n.type==="Collision"||n.type==="Trigger")&&(n.runMode=n.toggle?"Toggle":"Repeat")}))}function vDe(e){e.shared.variables=nl({},qt.prototype)}function yDe(e){let t=dn(e.shared.variables);e.shared.variables=nl(Object.entries(t??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),kt.prototype)}var Pu=115;function Uee(e,t){t(e.data);for(let i of e.children)Uee(i,t)}function xDe(e){let t=e.schema??104;t!==Pu&&t<105&&(Uee(e.asset,kee),e.schema=105)}function bDe(e){e.shared.particles=nl({},qt.prototype),e.shared.lib&&(e.shared.lib.particles=lh.defaultData().particles)}function wDe(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function _De(e){e.scene.objects.traverse((t,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function SDe(e){e.scene.objects.traverse((t,i)=>{var r;Array.isArray(dn(i.events))!==!1&&((r=i.events)==null||r.forEach(n=>{var a,o,l,c,u,h,d,p,f,v,m;let s=n.runMode;n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp"||n.type==="Collision"||n.type==="Trigger"?(a=n.actions)==null||a.forEach(g=>{g.type==="Transition"&&(g.runMode=s??"Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode=s==="Toggle"?"Toggle":"Normal")}):n.type==="MouseHover"||n.type==="MousePress"||n.type==="KeyPress"?(o=n.actions)==null||o.forEach(g=>{(g.type==="Transition"||g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Toggle")}):n.type==="GameControl"?(delete n.actions,Object.keys(n.gameActions).forEach(g=>{var y;(y=n.gameActions[g])==null||y.forEach(x=>{x.type==="Transition"&&(x.runMode="Repeat"),x.type==="Animation"&&(x.runMode="Normal")})})):n.type==="DragDrop"?(delete n.actions,(c=(l=n.dragDropActions)==null?void 0:l.drag)==null||c.forEach(g=>{(g.type==="Transition"||g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Toggle")}),(h=(u=n.dragDropActions)==null?void 0:u.drop)==null||h.forEach(g=>{(g.type==="Transition"||g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Toggle")})):n.type==="Resize"?(delete n.actions,(d=n.breakpoints)==null||d.forEach(g=>{var y;(y=g.actions)==null||y.forEach(x=>{(x.type==="Transition"||x.type==="Animation"||x.type==="SwitchCamera")&&(x.runMode="Toggle")})})):n.type==="Start"?(p=n.actions)==null||p.forEach(g=>{g.type==="Transition"&&(g.runMode="Once"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}):n.type==="VariableChange"||n.type==="Scroll"?(f=n.actions)==null||f.forEach(g=>{g.type==="Transition"&&(g.runMode="Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}):n.type==="Conditional"&&(delete n.actions,(v=n.inActions)==null||v.forEach(g=>{g.type==="Transition"&&(g.runMode="Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}),(m=n.outActions)==null||m.forEach(g=>{g.type==="Transition"&&(g.runMode="Repeat"),(g.type==="Animation"||g.type==="SwitchCamera")&&(g.runMode="Normal")}))}))})}function MDe(e){e.shared.userAPIs=nl({},qt.prototype),e.shared.userWebhooks=nl({},qt.prototype),e.shared.lib&&(e.shared.lib.userAPIs=lh.defaultData().userAPIs,e.shared.lib.userWebhooks=lh.defaultData().userWebhooks)}function Fee(e){let t=e.schema??0;if(t!==Pu){console.warn("updating from ",t,"to ",Pu),fDe(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=wd.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(ud(e,eW),cd(e,eW),e.schema=101),t<102&&(mDe(e),e.schema=102),t<104&&(e.shared.catelogs=new qt,e.shared.lib=lh.defaultData(),e.schema=104),t<105&&(vDe(e),e.scene.objects.traverse((i,r)=>{kee(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))xDe(i);t<106&&(yDe(e),e.schema=106),t<107&&(e.shared.lib.variables=lh.defaultData().variables,e.schema=107),t<109&&(bDe(e),e.schema=109),t<110&&(wDe(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{gDe(r)}),e.schema=111),t<112&&(_De(e),e.schema=112),t<113&&(SDe(e),e.schema=113),t<114&&(e.scene.publish.settings.web.imageQuality===void 0&&(e.scene.publish.settings.web.imageQuality=70),e.schema=114),t<115&&(MDe(e),e.schema=115)}}var nC;(e=>{e.defaultData={schema:Pu,scene:bf.defaultData,frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ex.defaultData),shared:{...jo.emptyData(),colors:jo.defaultColors()}},e.emptyDataForImports=function(){let s=bf.emptyDataWithPage();return{schema:Pu,scene:s,frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ex.defaultData),shared:{...jo.emptyData(),colors:jo.defaultColors(),images:jo.defaultImages()}}},e.emptyData=function(){return{schema:Pu,scene:bf.emptyDataWithPage(),frames:new qt().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",ex.defaultData),shared:jo.emptyData()}},e.clipboard2dData=function(){return{schema:Pu,scene:bf.emptyData(),frames:new qt,shared:jo.emptyData()}},e.collabHelper={...GI,updateSchema(s){return(s.schema??0)<Pu?Jx(s,Fee):(s.schema??0)-Pu}};function t(s){let a=e.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}e.updateSchemaDirectly=t;function i(s){return{...s,shared:{...s.shared,lib:lh.defaultData()}}}e.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}e.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}e.hasSensitiveData=n})(nC||(nC={}));var MO;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(MO||(MO={}));var iW;(e=>{function t(i){return!0}e.is=t})(iW||(iW={}));var sC;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function t(r,n){return{position:(n==null?void 0:n.position)??r.position,rotation:(n==null?void 0:n.rotation)??r.rotation,scale:(n==null?void 0:n.scale)??r.scale,shear:(n==null?void 0:n.shear)??r.shear}}e.merge=t;function i(r,n){return $$({position:Gu.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:Gu.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&Gu.isEqual(r.shear,n.shear)?void 0:n.shear})}e.diff=i})(sC||(sC={}));var EO;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(EO||(EO={}));var rW;(e=>e.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(rW||(rW={}));var aC;(e=>e.defaultData={opacity:1,fill:{color:ar.fromHexAndA(vo,1),enabled:!0},stroke:{color:ar.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:ar.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:ar.from0to1([0,0,0,1]),enabled:!1,spread:0}})(aC||(aC={}));var wf;(e=>{function t(a,o){return{name:o}}e.newEmpty=t;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,sC.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(wf||(wf={}));var tb;(e=>e.defaultData={...sC.defaultData,...EO.defaultData,states:new kt,events:new kt,visible:!0,raycastLock:!1})(tb||(tb={}));var p0;(e=>e.defaultData={...tb.defaultData,...aC.defaultData})(p0||(p0={}));var oC;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(oC||(oC={}));var AO;(e=>e.defaultData={...p0.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(AO||(AO={}));var ib;(e=>e.defaultData={...p0.defaultData,...oC.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(ib||(ib={}));var CO;(e=>e.defaultData={...p0.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(CO||(CO={}));var TO;(e=>e.defaultData={...p0.defaultData,type:"path2d",path:"",name:"Path"})(TO||(TO={}));var nW;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(nW||(nW={}));var lC;(e=>e.defaultData={...tb.defaultData,name:"Group",type:"group2d"})(lC||(lC={}));var PO;(e=>e.defaultData=()=>({...tb.defaultData,...oC.defaultData,...aC.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:ar.fromHexAndA(4737101,1),enabled:!0},stroke:{color:ar.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(PO||(PO={}));var kf;(e=>{function t(a){switch(a){case"rectangle2d":return{...ib.defaultData};case"ellipse2d":return{...AO.defaultData};case"text2d":return{...CO.defaultData};case"vector2d":return{...ib.defaultData};case"path2d":return{...TO.defaultData};case"frame2d":return{...PO.defaultData()};case"group2d":return{...lC.defaultData}}}e.defaultData=t;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}e.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}e.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}e.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}e.hasCorners=s})(kf||(kf={}));var DO;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new _s},e.emptyData=function(){return{type:"scene2d",objects:new _s}}))(DO||(DO={}));function _f(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),n=new Set(Object.keys(e[0].morphAttributes)),s={},a={},o=e[0].morphTargetsRelative,l=new Bt,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[p]===void 0&&(a[p]=[]),a[p].push(h.morphAttributes[p])}if(t){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)h.push(p.getX(f)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=sW(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let v=0;v<a[u].length;++v)p.push(a[u][v][d]);let f=sW(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(f)}}return l}function sW(e){let t,i,r,n=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new t(n),a=0;for(let o=0;o<e.length;++o)s.set(e[o].array,a),a+=e[o].array.length;return new Zt(s,i,r)}var EDe=Math.pow(2,-24),fS=class{constructor(){}};function Ec(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function aW(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let n=e[r+3]-e[r];n>i&&(i=n,t=r)}return t}function oW(e,t){t.set(e)}function lW(e,t,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=e[s],n=t[s],i[s]=r<n?r:n,r=e[a],n=t[a],i[a]=r>n?r:n}}function mS(e,t,i){for(let r=0;r<3;r++){let n=t[e+2*r],s=t[e+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function zy(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function ADe(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),e.setIndex(new Zt(n,1));for(let s=0;s<i;s++)n[s]=s}}function CDe(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let n of e.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];t.push({offset:s/3,count:(a-s)/3})}return t}function JD(e,t,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,v=-1/0,m=-1/0,g=n!==null;for(let y=t*6,x=(t+i)*6;y<x;y+=6){let _=e[y+0],M=e[y+1],S=_-M,E=_+M;S<s&&(s=S),E>l&&(l=E),g&&_<h&&(h=_),g&&_>f&&(f=_);let A=e[y+2],P=e[y+3],C=A-P,D=A+P;C<a&&(a=C),D>c&&(c=D),g&&A<d&&(d=A),g&&A>v&&(v=A);let N=e[y+4],U=e[y+5],I=N-U,G=N+U;I<o&&(o=I),G>u&&(u=G),g&&N<p&&(p=N),g&&N>m&&(m=N)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,g&&(n[0]=h,n[1]=d,n[2]=p,n[3]=f,n[4]=v,n[5]=m)}function TDe(e,t,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<n&&(n=d),d>o&&(o=d);let p=e[u+2];p<s&&(s=p),p>l&&(l=p);let f=e[u+4];f<a&&(a=f),f>c&&(c=f)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function PDe(e,t,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&t[s*6+l]<o;)s++;for(;s<=a&&t[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[a*3+c],e[a*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[a*6+c*2+0],t[a*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[a*6+c*2+1],t[a*6+c*2+1]=d}s++,a--}else return s}}var _u=32,DDe=(e,t)=>e.candidate-t.candidate,Ih=new Array(_u).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),gS=new Float32Array(6);function LDe(e,t,i,r,n,s){let a=-1,o=0;if(s===0)a=aW(t),a!==-1&&(o=(t[a]+t[a+3])/2);else if(s===1)a=aW(e),a!==-1&&(o=RDe(i,r,n,a));else if(s===2){let l=zy(e),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/_u;if(n<_u/4){let v=[...Ih];v.length=n;let m=0;for(let y=u;y<h;y+=6,m++){let x=v[m];x.candidate=i[y+2*d],x.count=0;let{bounds:_,leftCacheBounds:M,rightCacheBounds:S}=x;for(let E=0;E<3;E++)S[E]=1/0,S[E+3]=-1/0,M[E]=1/0,M[E+3]=-1/0,_[E]=1/0,_[E+3]=-1/0;mS(y,i,_)}v.sort(DDe);let g=n;for(let y=0;y<g;y++){let x=v[y];for(;y+1<g&&v[y+1].candidate===x.candidate;)v.splice(y+1,1),g--}for(let y=u;y<h;y+=6){let x=i[y+2*d];for(let _=0;_<g;_++){let M=v[_];x>=M.candidate?mS(y,i,M.rightCacheBounds):(mS(y,i,M.leftCacheBounds),M.count++)}}for(let y=0;y<g;y++){let x=v[y],_=x.count,M=n-x.count,S=x.leftCacheBounds,E=x.rightCacheBounds,A=0;_!==0&&(A=zy(S)/l);let P=0;M!==0&&(P=zy(E)/l);let C=1+1.25*(A*_+P*M);C<c&&(a=d,c=C,o=x.candidate)}}else{for(let g=0;g<_u;g++){let y=Ih[g];y.count=0,y.candidate=p+f+g*f;let x=y.bounds;for(let _=0;_<3;_++)x[_]=1/0,x[_+3]=-1/0}for(let g=u;g<h;g+=6){let y=~~((i[g+2*d]-p)/f);y>=_u&&(y=_u-1);let x=Ih[y];x.count++,mS(g,i,x.bounds)}let v=Ih[_u-1];oW(v.bounds,v.rightCacheBounds);for(let g=_u-2;g>=0;g--){let y=Ih[g],x=Ih[g+1];lW(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let m=0;for(let g=0;g<_u-1;g++){let y=Ih[g],x=y.count,_=y.bounds,M=Ih[g+1].rightCacheBounds;x!==0&&(m===0?oW(_,gS):lW(_,gS,gS)),m+=x;let S=0,E=0;m!==0&&(S=zy(gS)/l);let A=n-m;A!==0&&(E=zy(M)/l);let P=1+1.25*(S*m+E*A);P<c&&(a=d,c=P,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function RDe(e,t,i,r){let n=0;for(let s=t,a=t+i;s<a;s++)n+=e[s*6+r*2];return n/i}function IDe(e,t){let i=e.attributes.position,r=e.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,p=h*6,f,v,m;a?(f=r[d+0],v=r[d+1],m=r[d+2]):(f=r[d+0]*c+l,v=r[d+1]*c+l,m=r[d+2]*c+l);for(let g=0;g<3;g++){let y,x,_;a?(y=i[u[g]](f),x=i[u[g]](v),_=i[u[g]](m)):(y=o[f+g],x=o[v+g],_=o[m+g]);let M=y;x<M&&(M=x),_<M&&(M=_);let S=y;x>S&&(S=x),_>S&&(S=_);let E=(S-M)/2,A=g*2;s[p+A+0]=M+E,s[p+A+1]=E+(Math.abs(M)+E)*EDe,M<t[g]&&(t[g]=M),S>t[g+3]&&(t[g+3]=S)}}return s}function ODe(e,t){function i(g){d&&d(g/p)}function r(g,y,x,_=null,M=0){if(!f&&M>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),x<=u||M>=l)return i(y+x),g.offset=y,g.count=x,g;let S=LDe(g.boundingData,_,a,y,x,h);if(S.axis===-1)return i(y+x),g.offset=y,g.count=x,g;let E=PDe(o,a,y,x,S);if(E===y||E===y+x)i(y+x),g.offset=y,g.count=x;else{g.splitAxis=S.axis;let A=new fS,P=y,C=E-y;g.left=A,A.boundingData=new Float32Array(6),JD(a,P,C,A.boundingData,s),r(A,P,C,s,M+1);let D=new fS,N=E,U=x-C;g.right=D,D.boundingData=new Float32Array(6),JD(a,N,U,D.boundingData,s),r(D,N,U,s,M+1)}return g}ADe(e,t);let n=new Float32Array(6),s=new Float32Array(6),a=IDe(e,n),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,v=[],m=CDe(e);if(m.length===1){let g=m[0],y=new fS;y.boundingData=n,TDe(a,g.offset,g.count,s),r(y,g.offset,g.count,s),v.push(y)}else for(let g of m){let y=new fS;y.boundingData=new Float32Array(6),JD(a,g.offset,g.count,y.boundingData,s),r(y,g.offset,g.count,s),v.push(y)}return v}function NDe(e,t){let i=ODe(e,t),r,n,s,a=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),p=new o(32*d);r=new Float32Array(p),n=new Uint32Array(p),s=new Uint16Array(p),c(0,h),a.push(p)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,p=u/2,f=!!h.count,v=h.boundingData;for(let m=0;m<6;m++)r[d+m]=v[m];if(f){let m=h.offset,g=h.count;return n[d+6]=m,s[p+14]=g,s[p+15]=65535,u+32}else{let m=h.left,g=h.right,y=h.splitAxis,x;if(x=c(u+32,m),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=x/4,x=c(x,g),n[d+7]=y,x}}}var ch=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n][t];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n],o=e.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};ch.prototype.setFromBox=function(){let e=new k;return function(t,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*o+n.x*(1-o),e.y=r.y*l+n.y*(1-l),e.z=r.z*c+n.z*(1-c);let u=t.dot(e);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}}();var zDe=function(){let e=new k,t=new k,i=new k;return function(r,n,s){let a=r.start,o=e,l=n.start,c=t;i.subVectors(a,l),e.subVectors(r.end,r.start),t.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),p=i.dot(o),f=o.dot(o)*d-h*h,v,m;f!==0?v=(u*h-p*d)/f:v=0,m=(u+v*h)/d,s.x=v,s.y=m}}(),jk=function(){let e=new ve,t=new k,i=new k;return function(r,n,s,a){zDe(r,n,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=t,d=i;if(r.closestPointToPoint(u,!0,t),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}}(),BDe=function(){let e=new k,t=new k,i=new Na,r=new $o;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),kDe=1e-15;function $m(e){return Math.abs(e)<kDe}var uh=class extends ws{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new k),this.satBounds=new Array(4).fill().map(()=>new ch),this.points=[this.a,this.b,this.c],this.sphere=new Xa,this.plane=new Na,this.needsUpdate=!0}intersectsSphere(e){return BDe(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,r);let d=n[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};uh.prototype.closestPointToSegment=function(){let e=new k,t=new k,i=new $o;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),jk(i,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,n&&n.copy(e),s&&s.copy(t))}return this.closestPointToPoint(a,e),c=a.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(a)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,n&&n.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();uh.prototype.intersectsTriangle=function(){let e=new uh,t=new Array(3),i=new Array(3),r=new ch,n=new ch,s=new k,a=new k,o=new k,l=new k,c=new $o,u=new $o,h=new $o;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let v=this.plane,m=d.plane;if(Math.abs(v.normal.dot(m.normal))>1-1e-10){let g=this.satBounds,y=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let M=0;M<4;M++){let S=g[M],E=y[M];if(r.setFromPoints(E,i),S.isSeparated(r))return!1}let x=d.satBounds,_=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let M=0;M<4;M++){let S=x[M],E=_[M];if(r.setFromPoints(E,t),S.isSeparated(r))return!1}for(let M=0;M<4;M++){let S=y[M];for(let E=0;E<4;E++){let A=_[E];if(s.crossVectors(S,A),r.setFromPoints(s,t),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let g=this.points,y=!1,x=0;for(let U=0;U<3;U++){let I=g[U],G=g[(U+1)%3];c.start.copy(I),c.end.copy(G),c.delta(a);let Q=y?u.start:u.end,Y=$m(m.distanceToPoint(I));if($m(m.normal.dot(a))&&Y){u.copy(c),x=2;break}if((m.intersectLine(c,Q)||Y)&&!$m(Q.distanceTo(G))){if(x++,y)break;y=!0}}if(x===1&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(x!==2)return!1;let _=d.points,M=!1,S=0;for(let U=0;U<3;U++){let I=_[U],G=_[(U+1)%3];c.start.copy(I),c.end.copy(G),c.delta(o);let Q=M?h.start:h.end,Y=$m(v.distanceToPoint(I));if($m(v.normal.dot(o))&&Y){h.copy(c),S=2;break}if((v.intersectLine(c,Q)||Y)&&!$m(Q.distanceTo(G))){if(S++,M)break;M=!0}}if(S===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(S!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let U=h.start;h.start=h.end,h.end=U}let E=u.start.dot(a),A=u.end.dot(a),P=h.start.dot(a),C=h.end.dot(a),D=A<P,N=E<C;return E!==C&&P!==A&&D===N?!1:(p&&(l.subVectors(u.start,h.start),l.dot(a)>0?p.start.copy(u.start):p.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?p.end.copy(u.end):p.end.copy(h.end)),!0)}}}();uh.prototype.distanceToPoint=function(){let e=new k;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();uh.prototype.distanceToTriangle=function(){let e=new k,t=new k,i=["a","b","c"],r=new $o,n=new $o;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],p=s[d];this.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<c&&(c=h,a&&a.copy(e),o&&o.copy(p));let f=this[d];s.closestPointToPoint(f,e),h=f.distanceToSquared(e),h<c&&(c=h,a&&a.copy(f),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let p=0;p<3;p++){let f=i[p],v=i[(p+1)%3];n.set(s[f],s[v]),jk(r,n,e,t);let m=e.distanceToSquared(t);m<c&&(c=m,a&&a.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var Wc=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new k,this.max=new k,this.matrix=new lt,this.invMatrix=new lt,this.points=new Array(8).fill().map(()=>new k),this.satAxes=new Array(3).fill().map(()=>new k),this.satBounds=new Array(3).fill().map(()=>new ch),this.alignedSatBounds=new Array(3).fill().map(()=>new ch),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Wc.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Wc.prototype.intersectsBox=function(){let e=new ch;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,a[0].isSeparated(e)||(e.min=i.y,e.max=r.y,a[1].isSeparated(e))||(e.min=i.z,e.max=r.z,a[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();Wc.prototype.intersectsTriangle=function(){let e=new uh,t=new Array(3),i=new ch,r=new ch,n=new k;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let a=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=a[h],p=o[h];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],p=c[h];if(i.setFromPoints(p,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let f=c[p];if(n.crossVectors(d,f),i.setFromPoints(n,t),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}}();Wc.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Wc.prototype.distanceToPoint=function(){let e=new k;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Wc.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new $o),i=new Array(12).fill().map(()=>new $o),r=new k,n=new k;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,p=1/0;for(let v=0;v<8;v++){let m=d[v];n.copy(m).clamp(u,h);let g=m.distanceToSquared(n);if(g<p&&(p=g,o&&o.copy(m),l&&l.copy(n),g<c))return Math.sqrt(g)}let f=0;for(let v=0;v<3;v++)for(let m=0;m<=1;m++)for(let g=0;g<=1;g++){let y=(v+1)%3,x=(v+2)%3,_=m<<y|g<<x,M=1<<v|m<<y|g<<x,S=d[_],E=d[M];t[f].set(S,E);let A=e[v],P=e[y],C=e[x],D=i[f],N=D.start,U=D.end;N[A]=u[A],N[P]=m?u[P]:h[P],N[C]=g?u[C]:h[P],U[A]=h[A],U[P]=m?u[P]:h[P],U[C]=g?u[C]:h[P],f++}for(let v=0;v<=1;v++)for(let m=0;m<=1;m++)for(let g=0;g<=1;g++){n.x=v?h.x:u.x,n.y=m?h.y:u.y,n.z=g?h.z:u.z,this.closestPointToPoint(n,r);let y=n.distanceToSquared(r);if(y<p&&(p=y,o&&o.copy(r),l&&l.copy(n),y<c))return Math.sqrt(y)}for(let v=0;v<12;v++){let m=t[v];for(let g=0;g<12;g++){let y=i[g];jk(m,y,r,n);let x=r.distanceToSquared(n);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(n),x<c))return Math.sqrt(x)}}return Math.sqrt(p)}}();var eg=new k,tg=new k,ig=new k,vS=new ve,yS=new ve,xS=new ve,cW=new k,uW=new k,hW=new k,bS=new k;function UDe(e,t,i,r,n,s){let a;return s===os?a=e.intersectTriangle(r,i,t,!0,n):a=e.intersectTriangle(t,i,r,s!==qs,n),a===null?null:{distance:e.origin.distanceTo(n),point:n.clone()}}function FDe(e,t,i,r,n,s,a,o,l){eg.fromBufferAttribute(t,s),tg.fromBufferAttribute(t,a),ig.fromBufferAttribute(t,o);let c=UDe(e,eg,tg,ig,bS,l);if(c){r&&(vS.fromBufferAttribute(r,s),yS.fromBufferAttribute(r,a),xS.fromBufferAttribute(r,o),c.uv=ws.getInterpolation(bS,eg,tg,ig,vS,yS,xS,new ve)),n&&(vS.fromBufferAttribute(n,s),yS.fromBufferAttribute(n,a),xS.fromBufferAttribute(n,o),c.uv1=ws.getInterpolation(bS,eg,tg,ig,vS,yS,xS,new ve)),i&&(cW.fromBufferAttribute(i,s),uW.fromBufferAttribute(i,a),hW.fromBufferAttribute(i,o),c.normal=ws.getInterpolation(bS,eg,tg,ig,cW,uW,hW,new k),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new k,materialIndex:0};ws.getNormal(eg,tg,ig,u.normal),c.face=u,c.faceIndex=s}return c}function Vee(e,t,i,r,n){let s=r*3,a=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,p=FDe(i,c,u,h,d,a,o,l,t);return p?(p.faceIndex=r,n&&n.push(p),p):null}function VDe(e,t,i,r,n,s){for(let a=r,o=r+n;a<o;a++)Vee(e,t,i,a,s)}function jDe(e,t,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=Vee(e,t,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function wc(e,t,i,r){let n=e.a,s=e.b,a=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function dW(e,t,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(wc(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var jee=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function hd(e,t){return t[e+15]===65535}function Iv(e,t){return t[e+6]}function rb(e,t){return t[e+14]}function nb(e){return e+8}function sb(e,t){return t[e+6]}function HDe(e,t){return t[e+7]}var mv=new fn,cC=new k,GDe=["x","y","z"];function LO(e,t,i,r,n){let s=e*2,a=F0,o=Bd,l=kd;if(hd(s,o)){let c=Iv(e,l),u=rb(s,o);VDe(t,i,r,c,u,n)}else{let c=nb(e);uC(c,a,r,cC)&&LO(c,t,i,r,n);let u=sb(e,l);uC(u,a,r,cC)&&LO(u,t,i,r,n)}}function RO(e,t,i,r){let n=e*2,s=F0,a=Bd,o=kd;if(hd(n,a)){let l=Iv(e,o),c=rb(n,a);return jDe(t,i,r,l,c)}else{let l=HDe(e,o),c=GDe[l],u=r.direction[c]>=0,h,d;u?(h=nb(e),d=sb(e,o)):(h=sb(e,o),d=nb(e));let p=uC(h,s,r,cC)?RO(h,t,i,r):null;if(p){let v=p.point[c];if(u?v<=s[d+l]:v>=s[d+l+3])return p}let f=uC(d,s,r,cC)?RO(d,t,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var WDe=function(){let e,t,i=[],r=new jee(()=>new fn);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let a=n(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(y){let x=y*2,_=Bd,M=kd;for(;!hd(x,_);)y=nb(y),x=y*2;return Iv(y,M)}function p(y){let x=y*2,_=Bd,M=kd;for(;!hd(x,_);)y=sb(y,M),x=y*2;return Iv(y,M)+rb(x,_)}let f=s*2,v=F0,m=Bd,g=kd;if(hd(f,m)){let y=Iv(s,g),x=rb(f,m);return Ec(s,v,e),l(y,x,!1,h,u+s,e)}else{let y=nb(s),x=sb(s,g),_=y,M=x,S,E,A,P;if(c&&(A=e,P=t,Ec(_,v,A),Ec(M,v,P),S=c(A),E=c(P),E<S)){_=x,M=y;let Q=S;S=E,E=Q,A=P}A||(A=e,Ec(_,v,A));let C=hd(_*2,m),D=o(A,C,S,h+1,u+_),N;if(D===2){let Q=d(_),Y=p(_)-Q;N=l(Q,Y,!0,h+1,u+_,A)}else N=D&&n(_,a,o,l,c,u,h+1);if(N)return!0;P=t,Ec(M,v,P);let U=hd(M*2,m),I=o(P,U,E,h+1,u+M),G;if(I===2){let Q=d(M),Y=p(M)-Q;G=l(Q,Y,!0,h+1,u+M,P)}else G=I&&n(M,a,o,l,c,u,h+1);return!!G}}}(),XDe=function(){let e=new uh,t=new uh,i=new lt,r=new Wc,n=new Wc;return function s(a,o,l,c,u=null){let h=a*2,d=F0,p=Bd,f=kd;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),hd(h,p)){let v=o,m=v.index,g=v.attributes.position,y=l.index,x=l.attributes.position,_=Iv(a,f),M=rb(h,p);if(i.copy(c).invert(),l.boundsTree)return Ec(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:S=>n.intersectsBox(S),intersectsTriangle:S=>{S.a.applyMatrix4(c),S.b.applyMatrix4(c),S.c.applyMatrix4(c),S.needsUpdate=!0;for(let E=_*3,A=(M+_)*3;E<A;E+=3)if(wc(t,E,m,g),t.needsUpdate=!0,S.intersectsTriangle(t))return!0;return!1}});for(let S=_*3,E=M+_*3;S<E;S+=3){wc(e,S,m,g),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let A=0,P=y.count;A<P;A+=3)if(wc(t,A,y,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let v=a+8,m=f[a+6];return Ec(v,d,mv),!!(u.intersectsBox(mv)&&s(v,o,l,c,u)||(Ec(m,d,mv),u.intersectsBox(mv)&&s(m,o,l,c,u)))}}}();function uC(e,t,i,r){return Ec(e,t,mv),i.intersectBox(mv,r)}var IO=[],_E,F0,Bd,kd;function C1(e){_E&&IO.push(_E),_E=e,F0=new Float32Array(e),Bd=new Uint16Array(e),kd=new Uint32Array(e)}function wS(){_E=null,F0=null,Bd=null,kd=null,IO.length&&C1(IO.pop())}var $D=Symbol("skip tree generation"),e3=new fn,t3=new fn,rg=new lt,Tp=new Wc,By=new Wc,ky=new k,_S=new k,qDe=new k,YDe=new k,ZDe=new k,pW=new fn,ac=new jee(()=>new uh),tx=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),tx.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,n=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),tx.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=e,s=new tx(t,{...i,[$D]:!0});if(s._roots=n,i.setIndex){let a=t.getIndex();if(a===null){let o=new Zt(e.index,1,!1);t.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[$D]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[$D]||(this._roots=NDe(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new fn))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,p=!1){let f=h*2;if(a[f+15]===65535){let v=s[h+6],m=a[f+14],g=1/0,y=1/0,x=1/0,_=-1/0,M=-1/0,S=-1/0;for(let E=3*v,A=3*(v+m);E<A;E++){let P=i[E],C=r.getX(P),D=r.getY(P),N=r.getZ(P);C<g&&(g=C),C>_&&(_=C),D<y&&(y=D),D>M&&(M=D),N<x&&(x=N),N>S&&(S=N)}return o[h+0]!==g||o[h+1]!==y||o[h+2]!==x||o[h+3]!==_||o[h+4]!==M||o[h+5]!==S?(o[h+0]=g,o[h+1]=y,o[h+2]=x,o[h+3]=_,o[h+4]=M,o[h+5]=S,!0):!1}else{let v=h+8,m=s[h+6],g=v+d,y=m+d,x=p,_=!1,M=!1;e?x||(_=e.has(g),M=e.has(y),x=!_&&!M):(_=!0,M=!0);let S=x||_,E=x||M,A=!1;S&&(A=u(v,d,x));let P=!1;E&&(P=u(m,d,x));let C=A||P;if(C)for(let D=0;D<3;D++){let N=v+D,U=m+D,I=o[N],G=o[N+3],Q=o[U],Y=o[U+3];o[h+D]=I<Q?I:Q,o[h+D+3]=G>Y?G:Y}return C}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];e(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];e(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=Vl){let i=this._roots,r=this.geometry,n=[],s=t.isMaterial,a=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=a?t[o[c].materialIndex].side:l,d=n.length;if(C1(i[c]),LO(0,r,h,e,n),wS(),a){let p=o[c].materialIndex;for(let f=d,v=n.length;f<v;f++)n[f].face.materialIndex=p}}return n}raycastFirst(e,t=Vl){let i=this._roots,r=this.geometry,n=t.isMaterial,s=Array.isArray(t),a=null,o=r.groups,l=n?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;C1(i[c]);let d=RO(0,r,h,e);wS(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let n of this._roots)if(C1(n),r=XDe(0,i,e,t),wS(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,p,f,v)=>{let m=p*3;return h(d,m,m+1,m+2,f,v)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=ac.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,p,f,v,m)=>h(d,p,f,v,m)?!0:dW(d,p,r,l,f,v,n)}else o||(l?o=(h,d,p,f)=>dW(h,d,r,l,p,f,n):o=(h,d,p)=>p);let c=!1,u=0;for(let h of this._roots){if(C1(h),c=WDe(0,r,a,o,s,u),wS(),c)break;u+=h.byteLength}return ac.releasePrimitive(n),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;rg.copy(t).invert();let c=ac.getPrimitive(),u=ac.getPrimitive();if(n){let d=function(p,f,v,m,g,y,x,_){for(let M=v,S=v+m;M<S;M++){wc(u,M*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let E=p,A=p+f;E<A;E++)if(wc(c,E*3,s,a),c.needsUpdate=!0,n(c,u,E,M,g,y,x,_))return!0}return!1};if(r){let p=r;r=function(f,v,m,g,y,x,_,M){return p(f,v,m,g,y,x,_,M)?!0:d(f,v,m,g,y,x,_,M)}}else r=d}e.getBoundingBox(t3),t3.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>t3.intersectsBox(d),intersectsRange:(d,p,f,v,m,g)=>(e3.copy(g),e3.applyMatrix4(rg),e.shapecast({intersectsBounds:y=>e3.intersectsBox(y),intersectsRange:(y,x,_,M,S)=>r(d,p,y,x,v,m,M,S)}))});return ac.releasePrimitive(c),ac.releasePrimitive(u),h}intersectsBox(e,t){return Tp.set(e.min,e.max,t),Tp.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Tp.intersectsBox(i),intersectsTriangle:i=>Tp.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},n=0,s=1/0){e.boundingBox||e.computeBoundingBox(),Tp.set(e.boundingBox.min,e.boundingBox.max,t),Tp.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=e.attributes.position,u=e.index,h=ac.getPrimitive(),d=ac.getPrimitive(),p=_S,f=qDe,v=null,m=null;r&&(v=YDe,m=ZDe);let g=1/0,y=null,x=null;return rg.copy(t).invert(),By.matrix.copy(rg),this.shapecast({boundsTraverseOrder:_=>Tp.distanceToBox(_),intersectsBounds:(_,M,S)=>S<g&&S<s?(M&&(By.min.copy(_.min),By.max.copy(_.max),By.needsUpdate=!0),!0):!1,intersectsRange:(_,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:S=>By.distanceToBox(S),intersectsBounds:(S,E,A)=>A<g&&A<s,intersectsRange:(S,E)=>{for(let A=S*3,P=(S+E)*3;A<P;A+=3){wc(d,A,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=_*3,D=(_+M)*3;C<D;C+=3){wc(h,C,l,o),h.needsUpdate=!0;let N=h.distanceToTriangle(d,p,v);if(N<g&&(f.copy(p),m&&m.copy(v),g=N,y=C/3,x=A/3),N<n)return!0}}}});{let S=u?u.count:c.count;for(let E=0,A=S;E<A;E+=3){wc(d,E,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let P=_*3,C=(_+M)*3;P<C;P+=3){wc(h,P,l,o),h.needsUpdate=!0;let D=h.distanceToTriangle(d,p,v);if(D<g&&(f.copy(p),m&&m.copy(v),g=D,y=P/3,x=E/3),D<n)return!0}}}}}),ac.releasePrimitive(h),ac.releasePrimitive(d),g===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=g,i.faceIndex=y,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(rg),f.applyMatrix4(rg),r.distance=f.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(e,t={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(ky.copy(e).clamp(c.min,c.max),ky.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,ky);let h=e.distanceToSquared(ky);return h<a&&(_S.copy(ky),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(_S):t.point=_S.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Ec(0,new Float32Array(t),pW),e.union(pW)}),e}},OO=ap(Yme()),QDe=.5*(Math.sqrt(3)-1),Uy=(3-Math.sqrt(3))/6,KDe=1/3,oc=1/6,ix=e=>Math.floor(e)|0,fW=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),i3=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function JDe(e=Math.random){let t=Hee(e),i=new Float64Array(t).map(n=>fW[n%12*2]),r=new Float64Array(t).map(n=>fW[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*QDe,u=ix(n+c),h=ix(s+c),d=(u+h)*Uy,p=u-d,f=h-d,v=n-p,m=s-f,g,y;v>m?(g=1,y=0):(g=0,y=1);let x=v-g+Uy,_=m-y+Uy,M=v-1+2*Uy,S=m-1+2*Uy,E=u&255,A=h&255,P=.5-v*v-m*m;if(P>=0){let N=E+t[A],U=i[N],I=r[N];P*=P,a=P*P*(U*v+I*m)}let C=.5-x*x-_*_;if(C>=0){let N=E+g+t[A+y],U=i[N],I=r[N];C*=C,o=C*C*(U*x+I*_)}let D=.5-M*M-S*S;if(D>=0){let N=E+1+t[A+1],U=i[N],I=r[N];D*=D,l=D*D*(U*M+I*S)}return 70*(a+o+l)}}function $De(e=Math.random){let t=Hee(e),i=new Float64Array(t).map(s=>i3[s%12*3]),r=new Float64Array(t).map(s=>i3[s%12*3+1]),n=new Float64Array(t).map(s=>i3[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*KDe,p=ix(s+d),f=ix(a+d),v=ix(o+d),m=(p+f+v)*oc,g=p-m,y=f-m,x=v-m,_=s-g,M=a-y,S=o-x,E,A,P,C,D,N;_>=M?M>=S?(E=1,A=0,P=0,C=1,D=1,N=0):_>=S?(E=1,A=0,P=0,C=1,D=0,N=1):(E=0,A=0,P=1,C=1,D=0,N=1):M<S?(E=0,A=0,P=1,C=0,D=1,N=1):_<S?(E=0,A=1,P=0,C=0,D=1,N=1):(E=0,A=1,P=0,C=1,D=1,N=0);let U=_-E+oc,I=M-A+oc,G=S-P+oc,Q=_-C+2*oc,Y=M-D+2*oc,O=S-N+2*oc,V=_-1+3*oc,F=M-1+3*oc,W=S-1+3*oc,ee=p&255,ae=f&255,K=v&255,$=.6-_*_-M*M-S*S;if($<0)l=0;else{let me=ee+t[ae+t[K]];$*=$,l=$*$*(i[me]*_+r[me]*M+n[me]*S)}let ie=.6-U*U-I*I-G*G;if(ie<0)c=0;else{let me=ee+E+t[ae+A+t[K+P]];ie*=ie,c=ie*ie*(i[me]*U+r[me]*I+n[me]*G)}let ye=.6-Q*Q-Y*Y-O*O;if(ye<0)u=0;else{let me=ee+C+t[ae+D+t[K+N]];ye*=ye,u=ye*ye*(i[me]*Q+r[me]*Y+n[me]*O)}let pe=.6-V*V-F*F-W*W;if(pe<0)h=0;else{let me=ee+1+t[ae+1+t[K+1]];pe*=pe,h=pe*pe*(i[me]*V+r[me]*F+n[me]*W)}return 32*(l+c+u+h)}}function Hee(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),n=t[i];t[i]=t[r],t[r]=n}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var fl=new ws,e3e=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;fl.a.fromBufferAttribute(e,r),fl.b.fromBufferAttribute(e,r+1),fl.c.fromBufferAttribute(e,r+2),n*=fl.getArea(),t[r/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),fl.a.fromBufferAttribute(this.positionAttribute,e*3),fl.b.fromBufferAttribute(this.positionAttribute,e*3+1),fl.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(fl.a,r).addScaledVector(fl.b,n).addScaledVector(fl.c,1-(r+n)),fl.getNormal(i),this}},t3e=ap(SJ()),i3e=new lt,r3e=new lt,n3e=new lt,em;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(em||(em={}));var Hk=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new lt,this.copyPreviousMatrix=!0,this.hiddenMatrix=new lt,this.matrixWorldRigid=new lt,this.shearScale=new lt,this.shearScaleInv=new lt}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof $i&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)em.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)em.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:n,q:s}=(0,t3e.SVD)(i),a=i3e.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=r3e.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=n3e.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new lt().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof lt?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},s3e=class extends Hk($i){},a3e=e=>e.type==="Mesh",Ms=class extends s3e{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,i){}expand(){let t=0,i=this.object.entityChildren(t);for(;i;){let r=this.children[t];(r==null?void 0:r.object)!==i&&(r&&this.remove(r),r=new Ms(i),this.add(r),this.children.splice(t,0,this.children.pop()),r.matrixWorldNeedsUpdate=!0,r.matrixAutoUpdate=!1,r.matrix=i.matrix,r.hiddenMatrix=i.hiddenMatrix),r.expand(),t+=1,i=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){var t;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((t=this.object.dataPatched.cloner)==null?void 0:t.hideBase)===!0}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return a3e(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},af=new k,of=new k,Ov=new lt,Gee=[new k(-1,1,1),new k(-1,-1,1),new k(1,-1,1),new k(1,1,1),new k(-1,1,-1),new k(-1,-1,-1),new k(1,-1,-1),new k(1,1,-1)],o3e=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],l3e=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],mW=(e,t,i)=>{e.updateEntityBoxSize(af,of),Ov.copy(t).multiply(e.matrixWorld),of.x===0&&of.y===0&&of.z===0?i.push(new k(af.x,af.y,af.z).applyMatrix4(Ov)):Gee.forEach(r=>{i.push(r.clone().multiply(of).add(af).applyMatrix4(Ov))})},gW=class extends fn{constructor(){super(...arguments),this.matrix=new lt,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new lt().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new k);return}mW(n,t,r)}}):mW(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(Ov.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(of).multiplyScalar(.5),this.getCenter(af),Ov.copy(this.matrix).setPosition(af),this.vertices=Gee.map(e=>e.clone().multiply(of).applyMatrix4(Ov))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=o3e.map(([e,t])=>new $o(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new k))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=l3e.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},_d={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},c3e=class extends $J{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},NO=.001;function zO(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=NO}function r3(e,t){let i=new k(...e.position),r=new k(...e.controlNext.position),n=new k(...t.controlPrevious.position),s=new k(...t.position);return zO(i,r,s)&&zO(i,n,s)}function Wee(e){let t=e.points.map(u=>new k(...u.data.position)),i=[e.points[0]],r=new k(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)zO(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let n=e.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new k(...h.position),p=new k(...h.controlPrevious.position),f=new k(...h.controlNext.position),v={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:f};if(h.roundness===0||!e.isClosed&&(u===0||u===a-1)){o[u]={...v,removedLength:0};continue}let m=n&&u==0?a-1:u-1,g=n&&u==a-1?0:u+1,y=i[m].data,x=i[g].data,_=new k(...y.position),M=new k(...x.position),S=_.clone().sub(d).normalize(),E=M.clone().sub(d).normalize();Object.assign(v,{prevDir:S,nextDir:E});let A=r3(y,h),P=r3(h,x);if(!A||!P)o[u]={...v,removedLength:0};else{let C=S.clone().add(E).normalize(),D=C.clone().cross(S).length()/S.dot(C);o[u]={...v,tan:D,removedLength:h.roundness/D}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],f=o[d];if(p.removedLength!==0||f.removedLength!==0){let v=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,v/2),f.removedLength=Math.min(f.removedLength,v/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,p=o[h],f=o[d],v=null;if(!r3(i[h].data,i[d].data))p.position.distanceTo(f.position)>NO&&(v=new vE(p.position,p.controlNext,f.controlPrevious,f.position));else{let m=p.position.clone(),g=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&m.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&g.add(f.prevDir.clone().setLength(f.removedLength))),m.distanceTo(g)>NO&&(v=new vE(m,m.clone().lerp(g,.3),g.clone().lerp(m,.3),g))}l[2*u+1]=v}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),f=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),v=h.tan*h.removedLength,m=h.prevDir.clone().add(h.nextDir).normalize(),g=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,x=m.clone().multiplyScalar(Math.sqrt(Math.pow(v,2)-Math.pow(y,2))).add(g),_=m.clone().multiplyScalar(-v).add(x),M=d.distanceTo(_)/d.distanceTo(g),S=h.prevDir.clone().multiplyScalar(M*d.distanceTo(p)).add(d),E=S.clone().lerp(_,2),A=p.clone().lerp(S,4/3),P=f.clone().lerp(E,4/3);l[2*u]=new vE(p,A,P,f)}let c=new c3e;return l.forEach(u=>{u&&c.add(u)}),c}var Di;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Di||(Di={}));var Du=e=>Di.is(e),u3e={type:"completeState",isfromEntity:!0},h3e=["x","y","z"],n3=new k,d3e=new k().set(0,1,0),Gk=e=>class extends Hk(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new gW,this._recursiveBBox=new gW,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Di.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Di.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Di.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)yf.toOps(this.data,n.data).forEach(s=>{let a=HA.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(t!==null){let n=this.data.states.data(t);n&&(this.dataPatched=yf.patch(this.data,n),yf.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Du(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Di.is(i[r]))return i[r];if(Di.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Di.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Du(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Di.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Du(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Du(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Du(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Du(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Mt.RAD2DEG,this.rotation.y*Mt.RAD2DEG,this.rotation.z*Mt.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return HI(i,t)}getTransformValues(t,i,r){return i[t].map((n,s)=>(r==null?void 0:r.shared.getVariable(n,[this.uuid,t,h3e[s]]))??n)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(n3.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Mt.DEG2RAD),this.rotation.setFromVector3(n3),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??o0.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Di.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Di.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return HI(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,n){let s=this.data;this.data=i;let a=t,o=dr(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Un.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Un.removeOverridden(t.path,t.props,l);a={...t,props:c}}}if(this.updateByPatchedOpBase(a,yf.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),dr(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(Nd.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=Un.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[p,f]of Object.entries(t.props))f===void 0&&(d===t.props&&(d={...t.props}),d[p]=h[p]);t={...t,props:d}}u.overrideData=eC.resolve(i.overrides,l),u.updateByOp(t,ss.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of bd.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of bd.rootOverrideProps)if(dr(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=Nd.filterOp(c.overrideData,l);u&&c.updateByOp(u,ss.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=Nd.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=ss.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!$f.is(t.props.type)&&_d.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){_d.changeEntityProptotype(this,i,r);for(let n of this.children)Di.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){var n;if(t.path.length===0&&t.type===0?this.updateState(t.props,r):t.type===0&&("resolutionLevel"in t.props||"useChildrenColors"in t.props)&&this.updateState(i,r),t.path[0]==="morphTargetInfluences"&&t.type===0){let s=(n=i.morphTargetInfluences.get(t.path[1]))==null?void 0:n.data.name;s&&this.updateMorphInfluences(s,r.shared.getVariable(t.props.value,[this.uuid,"morphTargetInfluences",s]))}if(dr(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),dr(t.path,["cloner"])!==null){let s=ss.drop(t,1);s.path.length===0&&s.type===0&&s.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,v,m,g,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((v=this._updatedPathSnapping)==null?void 0:v.slide)??this.dataPatched.pathSnapping.slide??0,n=((m=this._updatedPathSnapping)==null?void 0:m.offset)??this.dataPatched.pathSnapping.offset??0,s=((g=this._updatedPathSnapping)==null?void 0:g.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=t.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=Wee(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new lt;a.updateMatrixWorld();let d=new lt().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let x=new lt().extractRotation(a.matrixWorld),_=l.getTangentAt(c).applyMatrix4(x).add(u),M=new lt().lookAt(u,_,d3e),S=n3.setFromEuler(new kn().setFromRotationMatrix(M)).multiplyScalar(Mt.RAD2DEG);p={...p,rotation:S.toArray()}}this.updateTransformState(p),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(u3e)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(n=>{if(n.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof _d.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new _d.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},Xee=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var l,c;let i=(l=e.parameters)==null?void 0:l.radiusTop,r=(c=e.parameters)==null?void 0:c.radiusBottom,n=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);n.thetaLength=Mt.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let u=Math.max(a,o)*2;n.width=u,n.depth=u}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:p}=e.parameters,f;return l===0?(f=new Bt,f.setAttribute("position",new _t([],3))):h||p?f=new qee(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,p):f=new lk(c,u,r,n,s,a,o,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function Oh(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function vW(e){return new ve(e.y,-e.x)}var qee=class extends Bt{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let p=[],f=[],v=[],m=[],g=0,y=i/2,x=new k,_=new k;d&&e==0&&(e=l),d&&t==0&&(t=c);let M=new ve(e,y),S=new ve(t,-y),E=null,A=null,P=null,C=null,D=M.clone().sub(S),N=0,U=0,I=0;h>0&&(N=Math.min(e,t)*(1-h),U=e-N,I=t-N);let G=M.clone();G.x-=N;let Q=Math.PI-D.angle(),Y=D.angle(),O=Math.tan(Y/2),V=Math.tan(Q/2),F=O+V,W=h?F:V,ee=h?F:O;if(l=Math.min(l,(e-U)/W,D.length()/F),c=Math.min(c,(t-I)/ee,D.length()/F),l>0){let pe=l/O;E=M.clone().sub(new ve(pe,l)),h&&(P=E.clone(),P.x-=N-F*l),M.sub(D.clone().setLength(pe))}if(c>0){let pe=c/V;A=S.clone().sub(new ve(pe,-c)),S.add(D.clone().setLength(pe)),h&&(C=A.clone(),C.x-=N-F*c,G.sub(D.clone().setLength(pe)))}D=M.clone().sub(S);let ae=D.length()<.5,K=[];for(let pe=0;pe<=r;pe++){let me=[],ge=pe/r,xe=ge*o+a,te=new ve(Math.sin(xe),Math.cos(xe));C&&A?($(me,ge,te,Q,c,C,-1,!0),$(me,ge,te,Y,c,A,-1,!1)):A?(ie(me,te,A.x,0,-1),$(me,ge,te,Y,c,A,-1,!1)):s||ie(me,te,t,I,-1);let we=vW(D).normalize();if(Oh(we,te,x),!ae)for(let Ce=0;Ce<=n;Ce++){let Se=Ce/n,Re=D.clone().multiplyScalar(Se).add(S);Oh(Re,te,_),f.push(_.x,_.y,_.z),v.push(x.x,x.y,x.z),m.push(ge,.5+_.y/i),me.push(g++)}if(P&&E?($(me,ge,te,Q,l,E,1,!1),$(me,ge,te,Y,l,P,1,!0)):E?($(me,ge,te,Q,l,E,1,!1),ie(me,te,E.x,0,1)):s||ie(me,te,e,U,1),h&&!ae){let Ce=vW(D).multiplyScalar(-1).normalize();Oh(Ce,te,x);for(let Se=0;Se<=n;Se++){let Re=Se/n,Xe=D.clone().multiplyScalar(-Re).add(G);Oh(Xe,te,_),f.push(_.x,_.y,_.z),v.push(x.x,x.y,x.z),m.push(ge,.5+_.y/i),me.push(g++)}}h&&!s&&me.push(me[0]),K.push(me)}for(let pe=0;pe<K.length-1;pe++)for(let me=0;me<K[0].length-1;me++){if(s&&h&&me==n)continue;let ge=K[pe][me],xe=K[pe+1][me],te=K[pe+1][me+1],we=K[pe][me+1],Ce=f[te*3+0],Se=f[te*3+2];p.push(ge,xe,we),(Ce!=0||Se!=0)&&p.push(xe,te,we)}o<Math.PI*2&&(ye(-1,K[0],a),ye(1,K[K.length-1],a+o)),this.setIndex(p),this.setAttribute("position",new _t(f,3)),this.setAttribute("normal",new _t(v,3)),this.setAttribute("uv",new _t(m,2));function $(pe,me,ge,xe,te,we,Ce,Se){for(let Re=0;Re<u+1;Re++){let Xe=Re/u,Be=Ce<0?Xe:1-Xe;Se&&(Be-=1),Be*=xe;let Fe=new ve(Math.sin(Be),Math.cos(Be)*Ce),dt=Fe.clone().multiplyScalar(te).add(we);Oh(dt,ge,_),f.push(_.x,_.y,_.z),Oh(Fe,ge,x),v.push(x.x,x.y,x.z),m.push(me,.5+_.y/i),pe.push(g++)}}function ie(pe,me,ge,xe,te){let we=new k,Ce=new ve,Se=[ge,xe];te<0&&Se.reverse();for(let Re of Se)Ce.set(Re,y*te),Oh(Ce,me,we),f.push(we.x,we.y,we.z),v.push(0,te,0),m.push(.5,.5),pe.push(g++)}function ye(pe,me,ge){let xe=new ve(Math.sin(ge),Math.cos(ge)),te=new ve(-Math.cos(ge),Math.sin(ge)),we=new k,Ce=pe<0?(Xe,Be,Fe)=>p.push(Xe,Be,Fe):(Xe,Be,Fe)=>p.push(Xe,Fe,Be),Se=new ve((e+t+U+I)/4,0);Oh(Se,xe,we),f.push(we.x,we.y,we.z),v.push(te.x,0,te.y),m.push(.5,.5);let Re=g++;for(let Xe of me){let Be=f.slice(Xe*3,Xe*3+3);f.push(...Be),v.push(te.x,0,te.y);let Fe=m.slice(Xe*2,Xe*2+2);m.push(...Fe),g++}for(let Xe=Re+1;Xe<g-1;Xe++)Ce(Re,Xe,Xe+1);Ce(Re,g-1,Re+1)}}},p3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Mt.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new Bt,d.setAttribute("position",new _t([],3))):c>0||u>0||l<360?d=new qee(0,t/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new ck(t/2,r,n,s,a),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},f3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o===0?c=new Hl(t,i,r,n,s,a):c=new m3e(t,i,r,n,s,a,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},s3=Math.PI/2,m3e=class extends Bt{constructor(e=1,t=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,e/2,t/2,i/2);let l=[],c=[],u=[],h=[],d=0;p("z","y","x",-1,-1,i,t,e,s,n),p("z","y","x",1,-1,i,t,-e,s,n),p("x","z","y",1,1,e,i,t,r,s),p("x","z","y",1,-1,e,i,-t,r,s),p("x","y","z",1,-1,e,t,i,r,n),p("x","y","z",-1,-1,e,t,-i,r,n),a>0&&(f("z","y","x",-1,-1,1,i,t,e,s),f("z","y","x",1,-1,-1,i,t,e,s),f("z","y","x",-1,1,-1,i,t,e,s),f("z","y","x",1,1,1,i,t,e,s),f("x","y","z",-1,-1,-1,e,t,i,r),f("x","y","z",1,-1,1,e,t,i,r),f("x","y","z",-1,1,1,e,t,i,r),f("x","y","z",1,1,-1,e,t,i,r),f("y","x","z",-1,-1,1,t,e,i,n),f("y","x","z",1,-1,-1,t,e,i,n),f("y","x","z",1,1,1,t,e,i,n),f("y","x","z",-1,1,-1,t,e,i,n),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new _t(c,3)),this.setAttribute("normal",new _t(u,3)),this.setAttribute("uv",new _t(h,2));function p(m,g,y,x,_,M,S,E,A,P){let C=(M-2*a)/A,D=(S-2*a)/P,N=M/2-a,U=S/2-a,I=E/2,G=A+1,Q=P+1,Y=0,O=new k;for(let V=0;V<Q;V++){let F=V*D-U;for(let W=0;W<G;W++){let ee=W*C-N;O[m]=ee*x,O[g]=F*_,O[y]=I,c.push(O.x,O.y,O.z),O[m]=0,O[g]=0,O[y]=E>0?1:-1,u.push(O.x,O.y,O.z),h.push(W/A),h.push(1-V/P),Y+=1}}for(let V=0;V<P;V++)for(let F=0;F<A;F++){let W=d+F+G*V,ee=d+F+G*(V+1),ae=d+(F+1)+G*(V+1),K=d+(F+1)+G*V;l.push(W,ee,K),l.push(ee,ae,K)}d+=Y}function f(m,g,y,x,_,M,S,E,A,P){let C=(S-2*a)/P,D=S/2-a,N=E/2-a,U=A/2,I=P+1,G=0,Q=new k,Y=new k;for(let O=0;O<o+1;O++){let V=O/o*s3,F=Math.sin(V)*a,W=(1-Math.cos(V))*a,ee=Math.sin(V),ae=Math.cos(V);Q[g]=(N+F)*_,Q[y]=(U-W)*M,Y[m]=0,Y[g]=ee*Math.sign(Q[g]),Y[y]=ae*Math.sign(Q[y]);for(let K=0;K<I;K++){let $=K*C-D;Q[m]=$*x,c.push(Q.x,Q.y,Q.z),u.push(Y.x,Y.y,Y.z),h.push(K/P),h.push(0),G+=1}}for(let O=0;O<o;O++)for(let V=0;V<P;V++){let F=d+V+I*O,W=d+V+I*(O+1),ee=d+(V+1)+I*(O+1),ae=d+(V+1)+I*O;l.push(F,W,ae),l.push(W,ee,ae)}d+=G}function v(m,g,y){let x=new k,_=new k(e/2,t/2,i/2);_.subScalar(a);let M=[],S=m*g*y>0?(A,P,C)=>l.push(A,P,C):(A,P,C)=>l.push(A,C,P);for(let A=0;A<=o;A++){let P=[],C=s3*(1-A/o),D=Math.cos(C),N=Math.sin(C),U=0;for(let I=0;I<=A;I++){let G=Math.cos(U),Q=Math.sin(U);x.x=D*G,x.y=N,x.z=D*Q;let Y=_.clone().addScaledVector(x,a);c.push(m*Y.x,g*Y.y,y*Y.z),u.push(m*x.x,g*x.y,y*x.z),h.push(0,0),P.push(d++),U+=s3/A}M.push(P)}let E=M.length-1;for(let A=0;A<E;A++){let P=M[A],C=M[A+1],D=P.length-1;S(P[0],C[1],C[0]);for(let N=1;N<=D;N++)S(P[N-1],P[N],C[N]),S(P[N],C[N+1],C[N])}}}},Wk=class extends Bt{constructor(e=[],t=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new _t(a,3)),this.setAttribute("normal",new _t(l,3)),this.setAttribute("uv",new _t(o,2));return;function c(){var Y;n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new k,p=d.clone(),f=new ws,v=n*r,m=r-v,g=s+1,y=new k,x=(O,V)=>y.subVectors(O,V).normalize(),_=(O,V)=>Array(O).fill(void 0).map(V),M=_(e.length/3,(O,V)=>new k().fromArray(e,V*3).setLength(r)),S=[],E=1e6;for(let O=0;O<M.length;O++){let V=M[O],F=[],W,ee,ae,K=1e10,$=-1;for(;($=t.indexOf(O,$+1))!=-1;){let me=$-$%3;W=t[me+($+1)%3],ee=t[me+($+2)%3],ae=V.distanceToSquared(M[W]),K=Math.min(K,ae),F.push([W,ee,ae])}K+=1e-6;let ie=[],ye=0,pe=F.length;for(let me=0;me<pe;me++){[W,ee,ae]=F[ye];let ge=((Y=S[W])==null?void 0:Y.includes(O))==!0;ae<=K&&ie.push(W+ +ge*E),ye=F.findIndex(xe=>xe[0]==ee)}S.push(ie)}let A=[];{let O=0,V=0,F,W,ee=h==3;for(let ae=0;ae<=s;ae++){F=ae*(ae+1)/2,W=(ae+1)*(ae+2)/2;for(let K=0;K<s-ae;K++)[O,V]=[F+K+ae+2,W+K+ae+3],A.push(F,W,...ee?[V,F]:[O,W],V,O),[F,W]=[O,V];A.push(F,W,F+s+2)}}let P=d.clone(),C=d.clone(),D=d.clone(),N=d.clone(),U=d.clone(),I=[],G=_(M.length,()=>_(h,()=>d.clone()));for(let O=0;O<M.length;O++){d.copy(M[O]).normalize(),P.copy(d).multiplyScalar(m);let V=S[O];for(let ie=0;ie<V.length;ie++){let ye=V[ie],pe=V[(ie+1)%h];f.setFromPointsAndIndices(M,O,ye%E,pe%E),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(P,G[O][ie])}let F=[],W=[],ee=[],ae=new k;s==0&&[...G[O]].reduce((ie,ye)=>ie.add(ye),ae).multiplyScalar(1/h);for(let ie=0;ie<h;ie++){let ye=[],pe=(ie-1+h)%h,me=G[O][pe],ge=G[O][ie];d.copy(me).sub(P),p.copy(ge).sub(P);let xe=P.angleTo(d),te=d.angleTo(p),we=Math.cos(xe)*v;s==0?C.copy(ae):C.copy(P).setLength(m+we),W.push(we);let Ce=[C,me,ge];for(let Se=0;Se<2;Se++){let Re=Ce[Se],Xe=Ce[Se+1];N.subVectors(Re,P),U.subVectors(Xe,P),D.crossVectors(N,U).normalize();for(let Be=0;Be<g;Be++){let Fe=[xe,te][Se]*Be/g;d.copy(N).applyAxisAngle(D,Fe).add(P),F.push(d.clone()),Se&&(x(d,P),ye.push([Be==0?Re:d.clone(),y.clone()]))}Se&&(x(Xe,P),ye.push([Xe,y.clone()]))}ee.push(ye)}I.push(ee);let K=2*g,$=2;for(let ie=0;ie<h;ie++){let ye=K*ie,pe=K*((ie+1)%h),me=[F[ye]];for(let xe=1;xe<g;xe++){N=F[ye+xe],U=F[pe+xe],me.push(N);for(let te=1,we=xe-$+1;te<=we;te++)d.lerpVectors(N,U,te/(we+1)),d.sub(P).setLength(W[ie]).add(P),me.push(d.clone());me.push(U)}for(let xe=0;xe<g;xe++)me.push(F[xe+g+ye]);me.push(F[pe+g]);let ge=A.map(xe=>me[xe]);a.push(...ge.map(xe=>[xe.x,xe.y,xe.z]).flat()),l.push(...ge.map(xe=>(x(xe,P),[y.x,y.y,y.z])).flat())}}let Q=[];for(let O=0;O<S.length;O++)for(let V=0;V<h;V++){let F=S[O][V];if(F<E){let W=S[F].findIndex(K=>K%E==O),ee=I[O][V],ae=I[F][W];for(let K=0;K<g;K++){let $=ee[K],ie=ae[g-K],ye=ee[K+1],pe=ae[g-(K+1)];[$,ie,ye,ye,ie,pe].forEach(me=>{a.push(me[0].x,me[0].y,me[0].z),l.push(me[1].x,me[1].y,me[1].z)})}Q.push(ee[0][0],ae[g][0],ee[g][0],ae[0][0])}}for(;Q.length;){let O,V,F,W;[O,V]=Q.splice(0,2);let ee=[O];for(;O!=V;)ee.push(V),F=Q.indexOf(V),W=F%2,V=Q.splice(F-W,2)[1-W];y.subVectors(ee[0],ee[1]).cross(d.subVectors(ee[0],ee[2])).normalize();let ae=y.dot(ee[0])<0;ae&&y.negate();for(let K=1;K<=ee.length-2;K++)[ee[K+ +ae],ee[K+1-+ae],ee[0]].forEach($=>{a.push($.x,$.y,$.z),l.push(y.x,y.y,y.z)})}}function u(){let h=new k;for(let S=0;S<a.length;S+=3){h.x=a[S+0],h.y=a[S+1],h.z=a[S+2];let E=_(h)/2/Math.PI+.5,A=M(h)/Math.PI+.5;o.push(E,1-A)}let d=new k,p=new k,f=new k,v=new k,m=new ve,g=new ve,y=new ve,x=(S,E,A,P)=>{P<0&&S.x===1&&(o[E]=S.x-1),A.x===0&&A.z===0&&(o[E]=P/2/Math.PI+.5)};for(let S=0,E=0;S<a.length;S+=9,E+=6){d.set(a[S+0],a[S+1],a[S+2]),p.set(a[S+3],a[S+4],a[S+5]),f.set(a[S+6],a[S+7],a[S+8]),m.set(o[E+0],o[E+1]),g.set(o[E+2],o[E+3]),y.set(o[E+4],o[E+5]),v.copy(d).add(p).add(f).divideScalar(3);let A=_(v);x(m,E+0,d,A),x(g,E+2,p,A),x(y,E+4,f,A)}for(let S=0;S<o.length;S+=6){let E=o[S+0],A=o[S+2],P=o[S+4],C=Math.max(E,A,P),D=Math.min(E,A,P);C>.9&&D<.1&&(E<.2&&(o[S+0]+=1),A<.2&&(o[S+2]+=1),P<.2&&(o[S+4]+=1))}function _(S){return Math.atan2(S.z,-S.x)}function M(S){return Math.atan2(-S.y,Math.sqrt(S.x*S.x+S.z*S.z))}}}static fromJSON(e){return new Wk(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},g3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new Yee(t*.5,s,a):new t$(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},Yee=class extends Wk{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,e,t,i),this.type=o}static fromJSON(e){return new Yee(e.radius,e.corner,e.cornerSides)}},Fy=1e-12,Xk=class{constructor(e){this.position=new ve,this.startPosition=new ve,this.uuid=Mt.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new Xk(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},BO=class extends Xk{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new BO(this.parent).copy(this)}},Nv=class extends Xk{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new BO(this),new BO(this))}static create(e,t){let i=new Nv(e,new ve(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new Nv(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new ve,t=new ve){let[i,r]=this.computeTangents();return i&&r&&(yW(i,e),yW(r,t)),[e,t]}computeTangent(e=new ve){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new ve){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function yW(e,t=new ve){let i=e.length();return t.set(-e.y/i,e.x/i)}var qk=e=>e,V0=new ve,DT=new ve,v3e=new ve,y3e=new ve,x3e=new ve,b3e=new ve,Zee=new k,Qee=new k;function w3e(e){let t=new ve;t.addVectors(e.v0,V0.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new ve;return i.addVectors(e.v2,DT.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Ol(e.v0,t,i,e.v2)}function T1(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function _3e(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function S3e(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Kee(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function M3e(e,t,i){return bW(e,t)&&bW(t,i)&&kO(e.position,t.position,i.position)}function kO(e,t,i){return V0.copy(t).sub(e).cross(DT.copy(i).sub(e))===0}function E3e(e,t,i,r,n){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function A3e(e,t,i){let r=e.distanceTo(i),n=t.distanceTo(i);return r<n?t:e}function C3e(e,t,i,r,n,s){let a=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return Kee(t,e,i)>Math.PI&&(u*=-1),T1(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(t.x-h*o,t.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function xW(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function bW(e,t){return kO(e.position,e.controls[1].position,t.position)&&kO(e.position,t.controls[0].position,t.position)}function T3e(e,t,i,r,n=.5){let s=V0.subVectors(t,e).multiplyScalar(n).add(e),a=DT.subVectors(i,t).multiplyScalar(n).add(t),o=v3e.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=y3e.subVectors(a,s).multiplyScalar(n).add(s),u=x3e.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=b3e.subVectors(u,c).multiplyScalar(n).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function P3e(e,t,i=12,r=!0){let n=Qee.set(0,0,0),s,a=0;for(let o=0;o<t.length;o++){let l=qk(t[o]),c=V0,u=Uf(l,i);for(let h=0;h<=u;h++)if(l instanceof Ol||l instanceof Zd||l instanceof Ul){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&S3e(s,n))continue;s===void 0&&(s=Zee),s.copy(n),e.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),e}function D3e(e,t,i,r=12,n=!0){let s=Qee.set(0,0,0),a=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=qk(t[l]),h=V0,d=Uf(u,r);o.push(d);for(let p=0;p<=d;p++)if(u instanceof Ol||u instanceof Zd||u instanceof Ul){if(u.getPoint(p/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=Zee:(e.setXYZ(a,c.x,c.y,c.z),a++,e.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(e.getX(a-1)===e.getX(0)&&e.getY(a-1)===e.getY(0)&&e.getZ(a-1)===e.getZ(0))&&(e.setXYZ(a,e.getX(0),e.getY(0),e.getZ(0)),a++),o}function wW(e,t=12,i=!1){let r=[];for(let n=0,s=e.length;n<s;n++){let a=e[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=Uf(a.roundedCurveCorner,t)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=Uf(a.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=Uf(e[0].roundedCurveCorner,t)*.5),r}function Uf(e,t=12){return e&&e instanceof mT?t*2:e&&(e instanceof Ul||e instanceof JJ)?1:e&&e instanceof ok?t*e.points.length:t}function L3e(e,t,i=12,r=!0){let n,s=0;for(let a=0;a<t.length;a++){let o=qk(t[a]),l=Uf(o,i),c=V0;for(let u=0;u<=l;u++)if(o instanceof Ol||o instanceof Zd||o instanceof Ul){if(o.getPoint(u/l,c),n!==void 0&&_3e(n,c,Fy))continue;n===void 0&&(n=DT),n.copy(c),e.push(c.x,c.y),s++}}return T1(e[0],e[e.length-2],Fy)&&T1(e[1],e[e.length-1],Fy)&&(e.pop(),e.pop()),r&&s>1&&!(T1(e[s-1],e[1],Fy)&&T1(e[s-2],e[0],Fy))&&(e.push(e[0],e[1]),s++),e}var a3=new ve,R3e=new ve,I3e=new ve,O3e=new ve,N3e=new ve,z3e=new ve,Jr=class extends TA{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Na(new k(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Mt.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Jr;return r.isClosed=e.isClosed,r.points=e.points.map(n=>Nv.create(n.id,n.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(n=>Jr.createFromState(n)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=e-t;if(s<=n.points.length-1)return n.points[s];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(e);if(s>=0)return t+s;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=a3.set(e,t);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Mt.generateUUID()){let r;e instanceof ve?r=e:r=new ve(e,t);let n=new Nv(i,r);return n.roundness=this.roundness,n}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return P3e(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=wW(this.points,e,!1),this.roundedCurveDivisions=wW(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return D3e(e,this.curves,t,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),L3e(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,n=0;t&&this.points[0].roundedCurveCorner!==void 0&&(n=Uf(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],n=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,a=s[e];if(xW(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(a3.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/a}dispose(){}_applyCurveForPoint(e,t){xW(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[t-1];this._applyCurveForPoint(r,n)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&M3e(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,p=c.getLength(),f=u.getLength(),v=Math.min(o,p*.499),m=Math.min(o,f*.499),g=Math.min(v,m),y=1-g/p,x=g/f,_=c.getPointAt(y,a3),M=u.getPointAt(x,R3e);this._subSplitCurve(c,h,y,_,void 0),this._subSplitCurve(u,d,x,void 0,M);let S;if(this.useCubicForRoundedCorners){let E=Kee(_,n.position,M)/2,A=Math.tan(E)*_.distanceTo(n.position),[P,C]=E3e(_,M,A,I3e,O3e),D=A3e(P,C,n.position),[N,U]=C3e(D,_,M,A,N3e,z3e);S=new Ol(_.clone(),N.clone(),U.clone(),M.clone())}else S=new Zd(_.clone(),n.position.clone(),M.clone());n.roundedCurveCorner=S,this.roundedCurves.splice(i+t,0,S),t++}}}}_subSplitCurve(e,t,i,r,n){if(e instanceof Ul)r!==void 0&&t.v2.copy(r),n!==void 0&&t.v1.copy(n);else{let s=e,a=t,o=s.getUtoTmapping(i,0),l=T3e(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return t}clone(){let e=new Jr(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let n=r*7,s=e.points[n+0],a=e.points[n+1],o=e.points[n+2],l=e.points[n+3],c=e.points[n+4],u=e.points[n+5],h=e.points[n+6],d=new Nv(Mt.generateUUID(),new ve(s,a));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let n=new Jr;return n.fromJSON(r),n}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(n,s)=>{s instanceof Ol&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof Zd&&(n[a]=w3e(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof Ol?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof Ul&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof Ol?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Ul&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(e.curves),e instanceof TA&&(this.shapeHoles=e.holes.map(n=>{let s=new Jr;return s.fromShape(n),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},UO=Math.PI*2;function o3({x:e,y:t},i,r,n,s){return{x:e*i+n,y:t*r+s}}function B3e(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),n=Math.sin(e),s=Math.cos(e+t),a=Math.sin(e+t);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function _W(e,t,i,r){let n=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return n*Math.acos(s)}function k3e(e,t,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),p=Math.pow(o,2),f=u*h-u*p-h*d;f<0&&(f=0),f/=u*p+h*d,f=Math.sqrt(f)*(l===c?-1:1);let v=f*n/s*o,m=f*-s/n*a,g=v+(e+i)/2,y=m+(t+r)/2,x=(a-v)/n,_=(o-m)/s,M=(-a-v)/n,S=(-o-m)/s,E=_W(1,0,x,_),A=_W(x,_,M,S);return!c&&A>0&&(A-=UO),c&&A<0&&(A+=UO),{centerx:g,centery:y,ang1:E,ang2:A}}function U3e({px:e,py:t,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=k3e(e,t,i,r,n,s,c,u,a,o),{ang1:p,ang2:f}=d,{centerx:v,centery:m}=d,g=Math.abs(f)/(UO/4);Math.abs(1-g)<1e-7&&(g=1);let y=Math.max(Math.ceil(g),1);f/=y;for(let x=0;x<y;x++)l.push(B3e(p,f)),p+=f;return l.map(x=>{let{x:_,y:M}=o3(x[0],n,s,v,m),{x:S,y:E}=o3(x[1],n,s,v,m),{x:A,y:P}=o3(x[2],n,s,v,m);return{x1:_,y1:M,x2:S,y2:E,x:A,y:P}})}var sr;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(sr||(sr={}));var Sn;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Sn||(Sn={}));function ri(e,t){if(!e)throw t||"Assertion Failed!"}var Xt=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){ri(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?n<s?i.t-t.t+(t.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-t.t)*(s/(n+s)):0},e.edgeSign=function(t,i,r){ri(e.vertLeq(t,i)&&e.vertLeq(i,r));var n=i.s-t.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-t.t)*s:0},e.transEval=function(t,i,r){ri(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?n<s?i.s-t.s+(t.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-t.s)*(s/(n+s)):0},e.transSign=function(t,i,r){ri(e.transLeq(t,i)&&e.transLeq(i,r));var n=i.t-t.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,n){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+n)/2:i+(n-i)*(t/(t+r)):n+(i-n)*(r/(t+r))},e.intersect=function(t,i,r,n,s){var a,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,n)||(l=r,r=n,n=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.vertLeq(r,i)?e.vertLeq(i,n)?(a=e.edgeEval(t,r,i),o=e.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,i.s)):(a=e.edgeSign(t,r,i),o=-e.edgeSign(t,n,i),a+o<0&&(a=-a,o=-o),s.s=e.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,n)||(l=r,r=n,n=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=n,n=l),e.transLeq(r,i)?e.transLeq(i,n)?(a=e.transEval(t,r,i),o=e.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,i.t)):(a=e.transSign(t,r,i),o=-e.transSign(t,n,i),a+o<0&&(a=-a,o=-o),s.t=e.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},e}(),Vy=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),SS=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),jg=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),SW=function(){function e(){var t=new jg,i=new Vy,r=new SS(0),n=new SS(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=n}return e.prototype.makeEdge_=function(t){var i=new SS(0),r=new SS(1);t.Sym.side<t.side&&(t=t.Sym);var n=t.Sym.next;return r.next=n,n.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=t,t.Onext=n,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var n=t;ri(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},e.prototype.makeFace_=function(t,i,r){var n=t;ri(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.killFace_=function(t,i){var r=t.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=t.prev,a=t.next;a.prev=s,s.next=a},e.prototype.makeEdge=function(){var t=new jg,i=new jg,r=new Vy,n=this.makeEdge_(this.eHead);return this.makeVertex_(t,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},e.prototype.splice=function(t,i){var r=!1,n=!1;if(t!==i){if(i.Org!==t.Org&&(n=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!n){var s=new jg;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var a=new Vy;this.makeFace_(a,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var n=new Vy;this.makeFace_(n,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var n=new jg;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,n=this.makeEdge_(t),s=n.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(n,t.Lnext),this.splice_(s,i),n.Org=t.Dst,s.Org=i.Org,n.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var a=new Vy;this.makeFace_(a,n,t.Lface)}return n},e.prototype.zapFace=function(t){var i=t.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=t.prev,o=t.next,o.prev=a,a.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&Xt.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&Xt.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=t,s=t;(n=s.next)!==t;s=n){ri(n.prev===s),l=n.anEdge;do ri(l.Sym!==l),ri(l.Sym.Sym===l),ri(l.Lnext.Onext.Sym===l),ri(l.Onext.Sym.Lnext===l),ri(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(ri(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){ri(a.prev===o),l=a.anEdge;do ri(l.Sym!==l),ri(l.Sym.Sym===l),ri(l.Lnext.Onext.Sym===l),ri(l.Onext.Sym.Lnext===l),ri(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(ri(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)ri(l.Sym.next===c.Sym),ri(l.Sym!==l),ri(l.Sym.Sym===l),ri(l.Org!==null),ri(l.Dst!==null),ri(l.Lnext.Onext.Sym===l),ri(l.Onext.Sym.Lnext===l);ri(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),MW=function(){function e(){this.handle=null}return e}(),EW=function(){function e(){this.key=null,this.node=0}return e}(),F3e=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new MW,this.handles[r]=new EW;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,ri(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,n,s,a;for(n=i[t].handle;;){if(a=t>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[t].handle=n,r[n].node=t;break}i[t].handle=s,r[s].node=t,t=a}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new MW;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new EW}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,n=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,n;ri(t>=1&&t<=this.max&&r[t].key!==null),n=r[t].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),l3=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),AW=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),V3e=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new AW,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new AW;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),j3e=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var n=t.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?Xt.vertLeq(s.Org,a.Org)?Xt.edgeSign(a.Dst,s.Org,a.Org)<=0:Xt.edgeSign(s.Dst,a.Org,s.Org)>=0:Xt.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return Xt.edgeSign(s.Dst,n,s.Org)>=0;var o=Xt.edgeEval(s.Dst,n,s.Org),l=Xt.edgeEval(a.Dst,n,a.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&ri(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){ri(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,n;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var n=new l3;return n.eUp=r,n.nodeUp=t.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},e.isWindingInside=function(t,i){switch(t.windingRule){case sr.ODD:return(i&1)!==0;case sr.NONZERO:return i!==0;case sr.POSITIVE:return i>0;case sr.NEGATIVE:return i<0;case sr.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=e.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,a);break}n=t.mesh.connect(o.Lprev,n.Sym),e.fixUpperEdge(t,s,n)}o.Onext!==n&&(t.mesh.splice(n.Oprev,n),t.mesh.splice(o,n)),e.finishRegion(t,a),o=s.eUp,a=s}return o},e.addRightEdges=function(t,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do ri(Xt.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,ri(l.windingNumber-c.winding===o.windingNumber),a&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var n=Xt.vertL1dist(i,t),s=Xt.vertL1dist(r,t),a=.5*s/(n+s),o=.5*n/(n+s);t.coords[0]+=a*i.coords[0]+o*r.coords[0],t.coords[1]+=a*i.coords[1]+o*r.coords[1],t.coords[2]+=a*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,n),e.vertexWeights(i,s,a)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp;if(Xt.vertLeq(n.Org,s.Org)){if(Xt.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;Xt.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(t.pq.delete(n.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,n)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(Xt.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Oprev,n)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a;if(ri(!Xt.vertEq(n.Dst,s.Dst)),Xt.vertLeq(n.Dst,s.Dst)){if(Xt.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,a=t.mesh.splitEdge(n),t.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(Xt.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=t.mesh.splitEdge(s),t.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new jg,p,f;if(ri(!Xt.vertEq(c,l)),ri(Xt.edgeSign(l,t.event,a)<=0),ri(Xt.edgeSign(c,t.event,o)>=0),ri(a!==t.event&&o!==t.event),ri(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(Xt.vertLeq(a,o)){if(Xt.edgeSign(c,a,o)>0)return!1}else if(Xt.edgeSign(l,o,a)<0)return!1;return e.debugEvent(t),Xt.intersect(l,a,c,o,d),ri(Math.min(a.t,l.t)<=d.t),ri(d.t<=Math.max(o.t,c.t)),ri(Math.min(c.s,l.s)<=d.s),ri(d.s<=Math.max(o.s,a.s)),Xt.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=Xt.vertLeq(a,o)?a:o,Xt.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),Xt.vertEq(d,a)||Xt.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!Xt.vertEq(l,t.event)&&Xt.edgeSign(l,t.event,d)>=0||!Xt.vertEq(c,t.event)&&Xt.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(n.Sym),t.mesh.splice(s.Sym,n),i=e.topLeftRegion(t,i),n=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,n.Oprev,n,n,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(n.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,n.Rprev,f,!0),!0):(Xt.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(n.Sym),n.Org.s=t.event.s,n.Org.t=t.event.t),Xt.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(n.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=t.pq.insert(n.Org),e.getIntersectData(t,n.Org,a,l,o,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);n.Org===s.Org&&n.Dst===s.Dst&&(e.addWinding(s,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var n,s=r.Onext,a=e.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),Xt.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),c=!0),Xt.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,a,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}Xt.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=t.mesh.connect(r.Lprev,n),e.addRightEdges(t,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var n,s,a,o,l;if(n=i.eUp,Xt.vertEq(n.Org,r)){ri(!1),e.spliceMergeVertices(t,n,r.anEdge);return}if(!Xt.vertEq(n.Dst,r)){t.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(t.mesh.delete(n.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,n),e.sweepEvent(t,r);return}ri(!1),i=e.topRightRegion(i),l=e.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(ri(s!==a),e.deleteRegion(t,l),t.mesh.delete(a),a=s.Oprev),t.mesh.splice(r.anEdge,a),Xt.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,a.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,n,s,a,o,l,c=new l3;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,n=e.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,Xt.edgeSign(a.Dst,i,a.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=Xt.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var n=e.topLeftRegion(t,r.activeRegion);ri(n!==null);var s=e.regionBelow(n),a=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===a?e.connectRightVertex(t,n,o):e.addRightEdges(t,n,o.Onext,a,a,!0)},e.addSentinel=function(t,i,r,n){var s=new l3,a=t.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,t.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new V3e(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],n=t.bmin[0]-i,s=t.bmax[0]+i,a=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,n,s,a),e.addSentinel(t,n,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(ri(i.fixUpperEdge),ri(++r===1)),ri(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,n,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,Xt.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,n,i),t.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),t.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,n,s=0;for(n=t.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=t.pq=new F3e(s,Xt.vertLeq),n=t.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,ri(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,n;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;n=t.pq.min(),!(n===null||!Xt.vertEq(n,r));)n=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,n.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),H3e=function(){function e(){this.mesh=new SW,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=sr.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],v=this.mesh.vHead;i=v.next;for(var m=0;m<3;++m)s=i.coords[m],c[m]=s,f[m]=i,l[m]=s,p[m]=i;for(i=v.next;i!==v;i=i.next)for(var g=0;g<3;++g)s=i.coords[g],s<c[g]&&(c[g]=s,f[g]=i),s>l[g]&&(l[g]=s,p[g]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=f[y],n=p[y],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=v.next;i!==v;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=t.next;a!==t;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;Xt.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Xt.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(Xt.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Xt.edgeGoesLeft(n.Lnext)||Xt.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=t.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Xt.edgeGoesRight(r.Lprev)||Xt.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=t.connect(n.Lnext,n),n=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var n,s=t.eHead.next;s!==t.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,n){var s,a=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===Sn.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===Sn.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new SW),t<2&&(t=2),t>3&&(t=3);for(var r=null,n=0;n<i.length;n+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],t>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,n,s,a){if(t===void 0&&(t=sr.ODD),i===void 0&&(i=Sn.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),j3e.computeInterior(this,a);var o=this.mesh;return i===Sn.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===Sn.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},e}();function Sd(e){var t=e.windingRule,i=t===void 0?sr.ODD:t,r=e.elementType,n=r===void 0?Sn.POLYGONS:r,s=e.polySize,a=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,p=e.strict,f=p===void 0?!0:p,v=e.debug,m=v===void 0?!1:v;if(!d&&f)throw new Error("Contours can't be empty");if(d){var g=new H3e;e.edgeCreateCallback&&(g.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(g.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)g.addContour(l||2,d[y]);return g.tesselate(i,n,a,l,u,f),{vertices:g.vertices,vertexIndices:g.vertexIndices,vertexCount:g.vertexCount,elements:g.elements,elementCount:g.elementCount,mesh:m?g.mesh:void 0}}}sr.ODD;sr.NONZERO;sr.POSITIVE;sr.NEGATIVE;sr.ABS_GEQ_TWO;Sn.POLYGONS;Sn.CONNECTED_POLYGONS;Sn.BOUNDARY_CONTOURS;var FO=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*FO.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.normals=new Float32Array(this.buffer,n*r,3*e),n+=3*e,this.uvs=new Float32Array(this.buffer,n*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} → ${e}`);let i=e*FO.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*e);s+=3*e;let o=new Float32Array(r,s*n,3*e);s+=3*e;let l=new Float32Array(r,s*n,2*e);t?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},Jee=FO;Jee.eSize=8*Float32Array.BYTES_PER_ELEMENT;var G3e=class{constructor(e=[],t=(i,r)=>i<r?-1:i>r?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;let e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:i}=this,r=t[e];for(;e>0;){let n=e-1>>1,s=t[n];if(i(r,s)>=0)break;t[e]=s,e=n}t[e]=r}_down(e){let{data:t,compare:i}=this,r=this.length>>1,n=t[e];for(;e<r;){let s=(e<<1)+1,a=s+1;if(a<this.length&&i(t[a],t[s])<0&&(s=a),i(t[s],n)>=0)break;t[e]=t[s],e=s}t[e]=n}};function W3e(e,t,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[y,x]of e[0])y<n&&(n=y),x<s&&(s=x),y>a&&(a=y),x>o&&(o=x);let l=a-n,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let y=[n,s];return y.distance=0,y.distance}let h=new G3e([],(y,x)=>x.max-y.max),d=q3e(e),p=new hC(n+l/2,s+c/2,0,e);p.d>d.d&&(d=p);let f=2;function v(y,x,_){let M=new hC(y,x,_,e);if(f++,M.max>d.d+i&&h.push(M),M.d>d.d&&(d=M,r&&console.log(`found best ${Math.round(1e4*M.d)/1e4} after ${f} probes`),d.d>t))return t}let m=u/2;for(let y=n;y<a;y+=u)for(let x=s;x<o;x+=u)v(y+m,x+m,m);for(;h.length;){let{max:y,x,y:_,h:M}=h.pop();if(y-d.d<=i)break;m=M/2,v(x-m,_-m,m),v(x+m,_-m,m),v(x-m,_+m,m),v(x+m,_+m,m)}r&&console.log(`num probes: ${f}
best distance: ${d.d}`);let g=[d.x,d.y];return g.distance=d.d,g.distance}function hC(e,t,i,r){this.x=e,this.y=t,this.h=i,this.d=X3e(e,t,r),this.max=this.d+this.h*Math.SQRT2}function X3e(e,t,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>t!=u[1]>t&&e<(u[0]-c[0])*(t-c[1])/(u[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,Y3e(e,t,c,u))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function q3e(e){let t=0,i=0,r=0,n=e[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,t+=h*3}let s=new hC(i/t,r/t,0,e);return t===0||s.d<0?new hC(n[0][0],n[0][1],0,e):s}function Y3e(e,t,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((e-n)*a+(t-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=e-n,o=t-s,a*a+o*o}var Yk={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},$ee={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},ete={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},c3=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),Zk=class extends Bt{constructor(e,t,i=0,r=12,n=3,s=sr.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(P=>{let C=P.extractShapePointsToFlatArray([],r),D=[];for(let N=C.length-1;N>=1;N-=2){let U=C[N-1],I=C[N-0];D.push(U,I)}return D}),c=[],u=[];for(let P=0;P<o.length;P+=2)u.push([o[P],o[P+1]]);c.push(u);for(let P=0;P<l.length;P++){let C=l[P],D=[];for(let N=0;N<C.length;N+=2)D.push([C[N],C[N+1]]);c.push(D)}let h;e.isText?h=new fk().setFromPoints(e.points.map(P=>P.position)).getSize(new ve).length()*.1:c[0].length===0?h=i:i>0?h=W3e(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(n));let d;try{d=Sd({windingRule:s,elementType:Sn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=Yk}let p;try{p=Sd({windingRule:sr.ODD,elementType:Sn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=$ee}if(!d)throw new Error("error generating geometry");let f=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let P=0;P<p.elements.length;P++){let C=p.elements[P],D=P%2===0?d.vertexCount:0;d.elements.push(C+D)}for(let P=0;P<p.vertexIndices.length;P++){let C=p.vertexIndices[P],D=d.vertexCount;d.vertexIndices.push(C+D)}for(let P=0;P<p.vertices.length;P++){let C=p.vertices[P];d.vertices.push(C)}}let v=1/0,m=-1/0,g=1/0,y=-1/0;for(let P=0,C=d.vertexCount;P<C;P++){let D=P*2,N=d.vertices[D+0],U=d.vertices[D+1];N<v&&(v=N),N>m&&(m=N),U<g&&(g=U),U>y&&(y=U)}this._minX=v,this._minY=g,this._width=m-v,this._height=y-g,this._buffer=new Jee(this._computeBufferEstimatedSize(d));let x=[],_=[];for(let P=d.elementCount-1;P>=0;P--){let C=P>=f,D=P*2,N=d.elements[D+0],U=d.elements[D+1],I=N+U,G={start:N,count:U,normals:[],continuous:[],concave:[]},Q=N,Y=I-1,O=N+1,V=this._shape.roundedCurves.length;do{let K=Q-N,$=d.vertices[Y*2+0],ie=d.vertices[Y*2+1],ye=d.vertices[Q*2+0],pe=d.vertices[Q*2+1],me=d.vertices[O*2+0],ge=d.vertices[O*2+1],xe=ye-$,te=pe-ie,we=Math.sqrt(xe*xe+te*te);xe/=we,te/=we;let Ce=ye-me,Se=pe-ge,Re=Math.sqrt(Ce*Ce+Se*Se);Ce/=Re,Se/=Re,G.normals[K*2+0]=-Se,G.normals[K*2+1]=Ce,G.concave[K]=xe*Se-te*Ce>0;let Xe=d.vertexIndices[Q];if(Array.isArray(Xe))G.continuous[K]=!1;else{let[Be,Fe]=this._shape.getCurveIndexFromVertexId(Xe-1,!0);if(Fe>0&&Fe<1)G.continuous[K]=!0;else{let dt=Fe===1?Be+1:Be-1;dt=(dt+V)%V;let se=Fe===1?0:1,z=this._shape.roundedCurves[Be].getTangent(Fe),X=this._shape.roundedCurves[dt].getTangent(se);G.continuous[K]=z.dot(X)>.95}}C&&(G.normals[K*2+0]*=-1,G.normals[K*2+1]*=-1),[Y,Q,O]=[Q,O,O+1],O>=I&&(O-=U)}while(O!==N+1);let F=[];F.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(N*2,I*2),vertexCount:U,vertexIndices:new Array(U).fill(!0).map((K,$)=>[$,$]),elements:[0,U],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(N*2,I*2)});let W=0;for(let K=1;K<=this._bevelSegments;K++){let $=K/this._bevelSegments*Math.PI/2,ie=(1-Math.cos($))*this._bevel,ye=[],pe=[],me=0;for(let xe=0;xe<U;xe++){let te=xe*2,we=(xe-1+U)%U*2,Ce=d.vertices[G.start*2+te+0],Se=d.vertices[G.start*2+te+1],Re=-G.normals[we+0]*ie,Xe=-G.normals[we+1]*ie,Be=-G.normals[te+0]*ie,Fe=-G.normals[te+1]*ie;if(G.concave[xe]||!G.concave[xe]&&C){let dt=Math.atan2(Xe,Re),se=Math.atan2(Fe,Be);se>dt&&(se-=Math.PI*2);let z=se-dt;if(G.continuous[xe]||C){let X=dt+z/2,ce=Math.cos(X)*ie,Ee=Math.sin(X)*ie;ye[2*me+0]=Ce+ce*(C?-1:1),ye[2*me+1]=Se+Ee*(C?-1:1),pe[me]=xe,me++}else{let X=Math.max(1,Math.floor(r/4*Math.abs(z)/Math.PI));for(let ce=0;ce<=X;ce++){let Ee=dt+z*(ce/X),q=Math.cos(Ee)*ie,Ye=Math.sin(Ee)*ie;ye[2*me+0]=Ce+q,ye[2*me+1]=Se+Ye,pe[me]=xe,me++}}}else ye[2*me+0]=Ce+Re,ye[2*me+1]=Se+Xe,pe[me]=xe,me++,ye[2*me+0]=Ce,ye[2*me+1]=Se,pe[me]=xe,me++,ye[2*me+0]=Ce+Be,ye[2*me+1]=Se+Fe,pe[me]=xe,me++}let ge=Sd({windingRule:sr.POSITIVE,elementType:Sn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ye],edgeCreateCallback:xe=>{let te=xe.Org.idx,we=pe[te],Ce=pe[(te+1)%pe.length];xe.idx=[we,Ce],xe.Sym.idx=[Ce,we]},vertexIdCallback:xe=>{let te=xe.Lprev.idx;return[te?te[1]:0,xe.idx?xe.idx[0]:0]}});if(!ge)throw console.log("Error"),new Error(`error generating bevel geometry for ${K}'th loop`);if(!ge.vertexCount){let xe=(K-1)/this._bevelSegments*Math.PI/2;W=(1-Math.sin(xe))*this._bevel;break}for(let xe=0;xe<ge.vertexIndices.length;xe++){let[te,we]=ge.vertexIndices[xe];if(te===we)continue;let Ce=we;we<te&&(Ce+=U);for(let Se=te;Se<Ce;Se++){let Re=Se%U,Xe=(Se+1)%U;if(!G.continuous[Re]||!G.continuous[Xe]){ge.vertexIndices[xe]=[te,Re],ge.vertexIndices.splice(xe+1,0,[Xe,we]),ge.vertices.splice((xe+1)*2,0,ge.vertices[xe*2],ge.vertices[xe*2+1]);break}}}F.push({bevelI:K,angle:$,size:ie,boundary:ge,reverseMap:pe,insetPoints:ye})}let ee=(K,$,ie)=>{let ye=0,pe=K.boundary.vertexIndices.length;for(;ye<pe&&ie(K.boundary.vertexIndices[$]);)$=($+1)%pe,ye++;return ye},ae=x.length;for(let K=1;K<F.length;K++){let $=F[K-1],ie=F[K],ye=$.boundary.vertexIndices.length,pe=ie.boundary.vertexIndices.length;if(!ye||!pe)break;let me=G.concave.length,ge=0,xe=c3(ge,U);for(;!$.boundary.vertexIndices.filter(xe).length||!ie.boundary.vertexIndices.filter(xe).length;)ge++,xe=c3(ge,U);let te=$.boundary.vertexIndices.findIndex(xe),we=ie.boundary.vertexIndices.findIndex(xe);do te=(te+1)%ye;while(xe($.boundary.vertexIndices[te]));do we=(we+1)%pe;while(xe(ie.boundary.vertexIndices[we]));ge=(ge+1)%U;let Ce=ge,Se=0,Re=this._buildBevelVert(G,$,(te-1+ye)%ye,void 0,Se),Xe=this._buildBevelVert(G,ie,(we-1+pe)%pe,void 0,Se),Be=Re,Fe=Xe,dt,se,z=!1;do{Se=(ge||me)/me,xe=c3(ge,U);let X=ee($,te,xe),ce=ee(ie,we,xe),Ee=z;if(z=!1,X&&!ce){for(let q=0;q<X;q++)dt=this._buildBevelVert(G,$,(te+q)%ye,q/(X-1),Se),x.push(Be.topN,dt.topP,Fe.topN),a===!1&&x.push(dt.bottomP,Be.bottomN,Fe.bottomN),Be=dt;z=!0}else if(!X&&ce)for(let q=0;q<ce;q++)se=this._buildBevelVert(G,ie,(we+q)%pe,q/(ce-1),Se),x.push(Fe.topN,Be.topP,se.topP),a===!1&&x.push(Be.bottomP,Fe.bottomN,se.bottomP),Fe=se;else if(X&&ce)if(dt=this._buildBevelVert(G,$,te,0,Se),se=this._buildBevelVert(G,ie,we,0,Se),Ee?(x.push(Be.topN,se.topP,Fe.topN),x.push(Be.topN,dt.topP,se.topP),a===!1&&(x.push(se.bottomP,Be.bottomN,Fe.bottomN),x.push(se.bottomP,dt.bottomP,Be.bottomN))):(x.push(Fe.topN,Be.topN,dt.topP),x.push(Fe.topN,dt.topP,se.topP),a===!1&&(x.push(dt.bottomP,Be.bottomN,Fe.bottomN),x.push(dt.bottomP,Fe.bottomN,se.bottomP))),Be=dt,Fe=se,X===ce)for(let q=1;q<X;q++)dt=this._buildBevelVert(G,$,(te+q)%ye,q/(X-1),Se),se=this._buildBevelVert(G,ie,(we+q)%pe,q/(ce-1),Se),x.push(Be.topN,dt.topP,Fe.topN),x.push(Fe.topN,dt.topP,se.topP),a===!1&&(x.push(dt.bottomP,Be.bottomN,Fe.bottomN),x.push(dt.bottomP,Fe.bottomN,se.bottomP)),Be=dt,Fe=se;else if(X>ce){let q=X/ce,Ye=0;for(let et=1;et<X;et++)dt=this._buildBevelVert(G,$,(te+et)%ye,et/(X-1),Se),x.push(Be.topN,dt.topP,Fe.topN),a===!1&&x.push(dt.bottomP,Be.bottomN,Fe.bottomN),Be=dt,et>(Ye+1)*q&&(Ye++,se=this._buildBevelVert(G,ie,(we+Ye)%pe,Ye/(ce-1),Se),x.push(Fe.topN,dt.topP,se.topP),a===!1&&x.push(dt.bottomP,Fe.bottomN,se.bottomP),Fe=se)}else{let q=ce/X,Ye=0;for(let et=1;et<ce;et++)se=this._buildBevelVert(G,ie,(we+et)%pe,et/(ce-1),Se),x.push(Fe.topN,dt.topP,se.topP),a===!1&&x.push(dt.bottomP,Fe.bottomN,se.bottomP),Fe=se,et>(Ye+1)*q&&(Ye++,dt=this._buildBevelVert(G,$,(te+Ye)%ye,Ye/(X-1),Se),x.push(Be.topN,dt.topP,Fe.topN),a===!1&&x.push(dt.bottomP,Be.bottomN,Fe.bottomN),Be=dt)}te=(te+X)%ye,we=(we+ce)%pe,ge=(ge+1)%me}while(ge!==Ce)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(F,G,x),C){let K=[];for(let $=x.length-1;$>=ae+2;$-=3){let ie=x[$-2],ye=x[$-1],pe=x[$-0];K.push(pe,ye,ie)}x.splice(ae,x.length-ae,...K)}if(C){let K=[];for(let $=F[F.length-1].boundary.vertices.length-1;$>=1;$-=2){let ie=F[F.length-1].boundary.vertices[$-1],ye=F[F.length-1].boundary.vertices[$-0];K.push(ie,ye)}_.push(K)}if(!C){let K=F[F.length-1],$;try{$=Sd({windingRule:F.length>1?sr.POSITIVE:sr.ODD,elementType:Sn.POLYGONS,vertexSize:2,strict:!0,contours:[K.insetPoints,..._]})}catch{$=ete}if(!$)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let ie=0;ie<$.elementCount*3;ie+=3){let ye=this._buildSurfaceVert($,$.elements[ie+0],W),pe=this._buildSurfaceVert($,$.elements[ie+1],W),me=this._buildSurfaceVert($,$.elements[ie+2],W);x.push(ye.top,pe.top,me.top),a===!1&&x.push(me.bottom,pe.bottom,ye.bottom)}}this.vertexCache={}}this._buffer.shrink();let M=new Zt(Uint32Array.from(x),1),S=new Zt(this._buffer.positions,3),E=new Zt(this._buffer.normals,3),A=new Zt(this._buffer.uvs,2);S.needsUpdate=!0,E.needsUpdate=!0,A.needsUpdate=!0,M.needsUpdate=!0,this.setAttribute("position",S),this.setAttribute("normal",E),this.setAttribute("uv",A),this.setIndex(M)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=e.vertices[t*2+0],s=e.vertices[t*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,n){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=t.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=a,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=i*2,v=l*2,m=c*2,g=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],x=(1-p)*this._bevel,_=(g-this._minX)/this._width,M=(y-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(_=n),M=1);let S=e.normals[v+0],E=e.normals[v+1],A=e.normals[m+0],P=e.normals[m+1];if(h){let I=A-S,G=P-E;S=S+I*(1-r),E=E+G*(1-r);let Q=Math.sqrt(S*S+E*E);S/=Q,E/=Q}let C=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),D=C*3,N=C*2,U={i,fi:l,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:n};return this._buffer.positions[D+0]=g,this._buffer.positions[D+1]=y,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[D+0]=S*d,this._buffer.normals[D+1]=E*d,this._buffer.normals[D+2]=p,this._buffer.uvs[N+0]=_,this._buffer.uvs[N+1]=M,this.forPathBevel===!1&&(this._buffer.positions[D+3]=g,this._buffer.positions[D+4]=y,this._buffer.positions[D+5]=x,this._buffer.normals[D+3]=S*d,this._buffer.normals[D+4]=E*d,this._buffer.normals[D+5]=-p,this._buffer.uvs[N+2]=M,this._buffer.uvs[N+3]=_),u||(this.forPathBevel?(C+=1,D+=3,N+=2):(C+=2,D+=6,N+=4),U.topP=C+0,U.bottomP=C+1,this._buffer.positions[D+0]=g,this._buffer.positions[D+1]=y,this._buffer.positions[D+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[D+0]=A*d,this._buffer.normals[D+1]=P*d,this._buffer.normals[D+2]=p,this._buffer.uvs[N+0]=_,this._buffer.uvs[N+1]=M,this.forPathBevel===!1&&(this._buffer.positions[D+3]=g,this._buffer.positions[D+4]=y,this._buffer.positions[D+5]=x,this._buffer.normals[D+3]=A*d,this._buffer.normals[D+4]=P*d,this._buffer.normals[D+5]=-p,this._buffer.uvs[N+2]=M,this._buffer.uvs[N+3]=_)),this.vertexCache[s]=U,U}clone(){let e=new Zk(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=ST(this.userData),e}},tte=class extends Bt{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=sr.ODD,this.elementType=Sn.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:sr.ODD,elementType:Sn.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,p=r.length/2;d<p;d++){let f=d*2,v=r[f+0],m=r[f+1];if(l!==void 0&&v!==l&&(a=!1),c!==void 0&&m!==c&&(o=!1),l=v,c=m,!a&&!o)break}if(!a&&!o)try{s=Sd({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=Yk}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new Zt(new Float32Array(u*3),3),this._normalAttribute=new Zt(new Float32Array(u*3),3),this._uvAttribute=new Zt(new Float32Array(u*2),2),this._indexAttribute=new Zt(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,f=1/0,v=-1/0;for(let y=0,x=u;y<x;y++){let _=y*2,M=s.vertices[_+0],S=s.vertices[_+1];M<d&&(d=M),M>p&&(p=M),S<f&&(f=S),S>v&&(v=S)}let m=p-d,g=v-f;for(let y=0,x=u;y<x;y++){let _=y*2,M=s.vertices[_+0],S=s.vertices[_+1],E=(M-d)/m,A=(S-f)/g;this._positionAttribute.setXYZ(y,M,S,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,E,A)}for(let y=0,x=h;y<x;y++){let _=y*3,M=s.elements[_+0],S=s.elements[_+1],E=s.elements[_+2];this._indexAttribute.setX(_+0,M),this._indexAttribute.setX(_+1,S),this._indexAttribute.setX(_+2,E)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new tte(this._shape,this._curveSegments);return e.userData=ST(this.userData),e}},ite=class extends Zk{constructor(e,t,i=0,r=12,n=3,s=sr.ODD){super(e,t,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(t,r,n),o=this._buildBevelVert(t,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let e=new ite(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=ST(this.userData),e}},vm=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:sr.ODD},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e.shape??(t==null?void 0:t.shape),o=(a==null?void 0:a.roundness)??i.roundness;a!==void 0&&(a instanceof Jr?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new Jr(r,n).fromJSON(a),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&a.update());let l=a??new Jr(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new tte(e.shape,n,{windingRule:a}):o=new ite(e.shape,t,i,n,r,a),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},rte=Math.PI*2,Qk=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Mt.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Jr?e.shape:new Jr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=Z3e(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let p;return n===0?(p=new Bt,p.setAttribute("position",new _t([],3))):p=vm.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function Z3e(e,t,i,r,n,s){if(r>=rte)return n>30||n%4===0?(K3e(e,t,i,s),Math.round(n/4)):CW(e,r,n,t,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=U3e({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?Q3e(e,a.x,a.y,c,n,t,i,s):CW(e,r,n,t,i,s)}function Q3e(e,t,i,r,n,s,a,o){let l=Math.round(n/r.length);e.addPoint(zv(t,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=e.points[c],p=zv(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),e.addPoint(p)}return o>0?nte(e,s,a,o):e.addPoint(zv(0,0)),l}function CW(e,t,i,r,n,s){let a=-t/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;e.addPoint(zv(c,u))}return t<rte?s>0?nte(e,r,n,s):e.addPoint(zv(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&ste(e,r,n,s)),1}function K3e(e,t,i,r=0,n=0,s=0){let a=.5522847498,o=t*a,l=i*a;e.addPoint(MS(n-t,s,n-t,s-l,n-t,s+l)),e.addPoint(MS(n,s+i,n-o,s+i,n+o,s+i)),e.addPoint(MS(n+t,s,n+t,s+l,n+t,s-l)),e.addPoint(MS(n,s-i,n+o,s-i,n-o,s-i)),r>0&&ste(e,t,i,r)}function zv(e,t){return new Nv(Mt.generateUUID(),new ve(e,t))}function MS(e,t,i,r,n,s){let a=zv(e,t);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function nte(e,t,i,r){ate(e,t,i,r).forEach(n=>e.addPoint(n))}function ste(e,t,i,r){let n=ate(e,t,i,r),s=new Jr;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,e.shapeHoles.push(s)}function ate(e,t,i,r){let n=r*t/100,s=n*(Math.abs(i)/Math.abs(t)),a=new ve(n/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=Mt.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var J3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new ote(!1,t,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},u3=new Dv([0,0,0],1),ote=class extends Bt{constructor(e=!0,t=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let p=()=>new k,f=new k,v=p(),m=p(),g=p(),y,x,_,M,S,E,A,P,C=p(),D=p(),N=p(),U=p(),I=p(),G=p(),Q=p(),Y=p(),O=i-2*o+.001,V=O/s,F=Math.ceil(a*s),W=F+1,ee=O/F,ae=-O/2,K=c+1,$=2*Math.PI/c,ie=Math.PI/2/h,ye=.01,pe=Math.min((1-u/100)*o,o-ye),me=o-pe,ge=0,xe=2,te=h*xe+xe,we=K*te/xe,Ce=we+K*W,Se=Math.max(0,K*(W+te)),[Re,Xe,Be]=[3,3,2].map(_e=>Array(Se*_e).fill(0)),Fe=[],dt=n-o;function se(_e,at){let Ve=Math.PI/2;E=at*ee,P=2*Math.PI*(E%V)/V+Ve,E+=ae,A=Math.sin(P)*dt,S=Math.cos(P)*dt,e?_e.set(S,A,E):_e.set(S,E,A)}se(f,-1e-10),se(v,0),C.copy(f),se(f,1);let z=f.distanceTo(v),X=d?0:me+pe,ce=z*F+2*X,Ee=pe,q=ce-X;for(let _e=0;_e<=F;_e++){se(m,_e),Y.subVectors(m,C).normalize(),C.copy(m),G.copy(m).setComponent(+e+1,0).normalize(),Q.crossVectors(Y,G).normalize();let at=_e===0,Ve=_e===F,mt=at?3*Math.PI/2:ie,pt=at?Ee:q,st=at?K:Ce,ue=at?0:Se-K,ze=Y.clone().multiplyScalar(at?-me:me).add(m),ut=Y.clone().multiplyScalar(at?-1:1).normalize();for(let de=0;de<K;de++){let Ne=de*$;if(D.addVectors(f.copy(G).multiplyScalar(o*Math.cos(Ne)),v.copy(Q).multiplyScalar(o*Math.sin(Ne))),N.copy(D).normalize(),at||Ve){d||(ge=ue+de,[0,1,2].forEach(oe=>{Re[ge*3+oe]=ze.getComponent(oe),Xe[ge*3+oe]=ut.getComponent(oe)}),Be[ge*2]=+Ve,Be[ge*2+1]=de/c),v.copy(N).multiplyScalar(pe),g.addVectors(m,v);for(let oe=0;oe<h;oe++){let He=oe*ie+mt;U.addVectors(f.copy(Y).multiplyScalar(me*Math.sin(He)),v.copy(N).multiplyScalar(me*Math.cos(He))),I.copy(U).normalize(),v.addVectors(g,U),U.normalize(),ge=st+oe*K+de,[0,1,2].forEach(tt=>{Re[ge*3+tt]=v.getComponent(tt),Xe[ge*3+tt]=I.getComponent(tt)});let Ae=+at+Math.sin(He);Be[ge*2]=(pt+me*Ae)/ce,Be[ge*2+1]=de/c}}v.addVectors(m,D),ge=we+_e*K+de,[0,1,2].forEach(oe=>{Re[ge*3+oe]=v.getComponent(oe),Xe[ge*3+oe]=N.getComponent(oe)}),Be[ge*2]=(X+_e*z)/ce,Be[ge*2+1]=de/c}}let Ye=W+2*h+xe,[et,ke]=[+d,Ye-1];for(let _e=et;_e<=ke-1;_e++){let at=d&&_e===ke-1;for(let Ve=0;Ve<K-1;Ve++)y=_e*K+Ve,x=y+1,_=(at?Ve:y)+K,M=(at?Ve+1:x)+K,_e===0?Fe.push(x,M,_):_e===Ye-2?Fe.push(y,x,_):Fe.push(y,x,_,x,M,_)}this.setIndex(Fe),this.setAttribute("position",new _t(Re,3)),this.setAttribute("normal",new _t(Xe,3)),this.setAttribute("uv",new _t(Be,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,u3.array=r,u3.count=r.length,u3}},$3e=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:n,corner:s,cornerSides:a}=e.parameters,o=n===0&&s!==0?new lte(t*.5,s,a):new a$(t*.5,n);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},lte=class extends Wk{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,e,t,i),this.type=a}static fromJSON(e){return new lte(e.radius,e.corner,e.cornerSides)}},eLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(n=>{Array.isArray(n)&&(n.x=n[0],n.y=n[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,n=new TA;n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new e$(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},lc=new lt,h3=new $i,ES=new k,dC=class extends Ts{constructor(){super(),this.uuid=Mt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Mn().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return lc.makeRotationX(e),this.applyMatrix4(lc),this}rotateY(e){return lc.makeRotationY(e),this.applyMatrix4(lc),this}rotateZ(e){return lc.makeRotationZ(e),this.applyMatrix4(lc),this}translate(e,t,i){return lc.makeTranslation(e,t,i),this.applyMatrix4(lc),this}scale(e,t,i){return lc.makeScale(e,t,i),this.applyMatrix4(lc),this}lookAt(e){return h3.lookAt(e),h3.updateMatrix(),this.applyMatrix4(h3.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)t.vertices.push(new k().fromBufferAttribute(n,h)),a!==void 0&&t.colors.push(new Yt().fromBufferAttribute(a,h));function c(h,d,p,f){let v=a===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],m=s===void 0?[]:[new k().fromBufferAttribute(s,h),new k().fromBufferAttribute(s,d),new k().fromBufferAttribute(s,p)],g=new VO(h,d,p,m,v,f);t.faces.push(g),o!==void 0&&t.faceVertexUvs[0].push([new ve().fromBufferAttribute(o,h),new ve().fromBufferAttribute(o,d),new ve().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new ve().fromBufferAttribute(l,h),new ve().fromBufferAttribute(l,d),new ve().fromBufferAttribute(l,p)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],p=d.start,f=d.count;for(let v=p,m=p+f;v<m;v+=3)i!==void 0?c(i.getX(v),i.getX(v+1),i.getX(v+2),d.materialIndex):c(v,v+1,v+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ES).negate(),this.translate(ES.x,ES.y,ES.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new lt;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new k,t=new k;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];e.subVectors(o,a),t.subVectors(s,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new k;if(e){let i=new k,r=new k;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),t[a.a].add(i),t[a.b].add(i),t[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];t[n.a].add(n.normal),t[n.b].add(n.normal),t[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(t[n.a]),s[1].copy(t[n.b]),s[2].copy(t[n.c])):(s[0]=t[n.a].clone(),s[1]=t[n.b].clone(),s[2]=t[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let e=new dC;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let n=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new k,c={a:new k,b:new k,c:new k};n.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new fn),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Xa),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,n=this.vertices.length,s=this.vertices,a=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new Mn().getNormalMatrix(t));for(let h=0,d=a.length;h<d;h++){let p=a[h].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],f,v,m=p.vertexNormals,g=p.vertexColors,y=new VO(p.a+n,p.b+n,p.c+n);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,_=m.length;x<_;x++)f=m[x].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let x=0,_=g.length;x<_;x++)v=g[x],y.vertexColors.push(v.clone());y.materialIndex=p.materialIndex+i,o.push(y)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,v=p.length;f<v;f++){let m=p[f],g=[];for(let y=0,x=m.length;y<x;y++)g.push(m[y].clone());this.faceVertexUvs[h].push(g)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],n=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new k(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===t&&(s=[]),n&&n.length===t&&(a=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],v=!0,m=!1,g=this.faceVertexUvs[0][p]!==void 0,y=f.normal.length()>0,x=f.vertexNormals.length>0,_=f.color.r!==1||f.color.g!==1||f.color.b!==1,M=f.vertexColors.length>0,S=0;if(S=c(S,0,0),S=c(S,1,v),S=c(S,2,m),S=c(S,3,g),S=c(S,4,y),S=c(S,5,x),S=c(S,6,_),S=c(S,7,M),i.push(S),i.push(f.a,f.b,f.c),i.push(f.materialIndex),g){let E=this.faceVertexUvs[0][p];i.push(d(E[0]),d(E[1]),d(E[2]))}if(y&&i.push(u(f.normal)),x){let E=f.vertexNormals;i.push(u(E[0]),u(E[1]),u(E[2]))}if(_&&i.push(h(f.color)),M){let E=f.vertexColors;i.push(h(E[0]),h(E[1]),h(E[2]))}}function c(p,f,v){return v?p|1<<f:p&~(1<<f)}function u(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return n[f]!==void 0||(n[f]=r.length/3,r.push(p.x,p.y,p.z)),n[f]}function h(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return a[f]!==void 0||(a[f]=s.length,s.push(p.getHex())),a[f]}function d(p){let f=p.x.toString()+p.y.toString();return l[f]!==void 0||(l[f]=o.length/2,o.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new dC().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,v=p.length;f<v;f++){let m=p[f],g=[];for(let y=0,x=m.length;y<x;y++){let _=m[y];g.push(_.clone())}this.faceVertexUvs[h].push(g)}}let n=e.morphTargets;for(let h=0,d=n.length;h<d;h++){let p={};if(p.name=n[h].name,n[h].vertices!==void 0){p.vertices=[];for(let f=0,v=n[h].vertices.length;f<v;f++)p.vertices.push(n[h].vertices[f].clone())}if(n[h].normals!==void 0){p.normals=[];for(let f=0,v=n[h].normals.length;f<v;f++)p.normals.push(n[h].normals[f].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,v=s[h].vertexNormals.length;f<v;f++){let m=s[h].vertexNormals[f],g={};g.a=m.a.clone(),g.b=m.b.clone(),g.c=m.c.clone(),p.vertexNormals.push(g)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let f=0,v=s[h].faceNormals.length;f<v;f++)p.faceNormals.push(s[h].faceNormals[f].clone())}this.morphNormals.push(p)}let a=e.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new tLe().fromGeometry(this),t=new Bt,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",AS.call(new Zt(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",AS.call(new Zt(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",TW.call(new Zt(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",PW.call(new Zt(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",PW.call(new Zt(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let n=[],s=e.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new _t(l.data.length*3,3);c.name=l.name,n.push(AS.call(c,l.data))}t.morphAttributes[r]=n}if(e.skinIndices.length>0){let r=new _t(e.skinIndices.length*4,4);t.setAttribute("skinIndex",DW.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new _t(e.skinWeights.length*4,4);t.setAttribute("skinWeight",DW.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Bt,i=e.geometry;if(e.isPoints||e.isLine){let r=new _t(i.vertices.length*3,3),n=new _t(i.colors.length*3,3);if(t.setAttribute("position",AS.call(r,i.vertices)),t.setAttribute("color",TW.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new _t(i.lineDistances.length,1);t.setAttribute("lineDistance",iLe.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};dC.prototype.isGeometry=!0;var tLe=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,n,s=e.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=e.morphTargets,o=a.length,l;if(o>0){l=[];for(let m=0;m<o;m++)l[m]={name:a[m].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let m=0;m<u;m++)h[m]={name:c[m].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,v=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let m=0;m<t.length;m++){let g=t[m];this.vertices.push(i[g.a],i[g.b],i[g.c]);let y=g.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let _=g.normal;this.normals.push(_,_,_)}let x=g.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let _=g.color;this.colors.push(_,_,_)}if(n===!0){let _=r[0][m];_!==void 0?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new ve,new ve,new ve))}if(s===!0){let _=r[1][m];_!==void 0?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new ve,new ve,new ve))}for(let _=0;_<o;_++){let M=a[_].vertices;l[_].data.push(M[g.a],M[g.b],M[g.c])}for(let _=0;_<u;_++){let M=c[_].vertexNormals[m];h[_].data.push(M.a,M.b,M.c)}f&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},VO=class{constructor(e,t,i,r,n,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new k,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Yt,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function iLe(e){return this.array.set(e),this}function TW(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Yt),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function PW(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new ve),t[i++]=s.x,t[i++]=s.y}return this}function AS(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new k),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function DW(e){let t=this.array,i=0;for(let r=0,n=e.length;r<n;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new li),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var rLe=["a","b","c"];function nLe(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function d3(e,t,i){let r=Math.min(e,t),n=Math.max(e,t),s=r+"_"+n;return i.get(s)}function p3(e,t,i,r,n,s){let a=Math.min(e,t),o=Math.max(e,t),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[e].edges.push(c),s[t].edges.push(c)}function sLe(e,t,i,r){let n,s,a;for(n=0,s=e.length;n<s;n++)i[n]={edges:[]};for(n=0,s=t.length;n<s;n++)a=t[n],p3(a.a,a.b,e,r,a,i),p3(a.b,a.c,e,r,a,i),p3(a.c,a.a,e,r,a,i)}function CS(e,t,i,r,n){e.push(new VO(t,i,r,void 0,void 0,n))}function ng(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function TS(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var aLe=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Bt?e=new dC().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new k,i,r,n,s,a,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;sLe(o,l,h,d);let p=[],f,v,m,g,y,x,_;for(let ye of Array.from(d.keys())){for(v=d.get(ye),m=new k,y=3/8,x=1/8,_=v.faces.length,_!=2&&(y=.5,x=0,_!=1),m.addVectors(v.a,v.b).multiplyScalar(y),t.set(0,0,0),s=0;s<_;s++){for(g=v.faces[s],a=0;a<3&&(f=o[nLe(g,rLe[a])],!(f!==v.a&&f!==v.b));a++);f&&t.add(f)}t.multiplyScalar(x),m.add(t),v.newEdge=p.length,p.push(m)}let M,S,E,A,P,C,D,N=[];for(r=0,n=o.length;r<n;r++){for(C=o[r],P=h[r].edges,i=P.length,i==3?M=3/16:i>3&&(M=3/(8*i)),S=1-i*Number(M),E=M,i<=2&&(i==2?(S=3/4,E=1/8):i==1||i==0),D=C.clone().multiplyScalar(S),t.set(0,0,0),s=0;s<i;s++)A=P[s],f=A.a!==C?A.a:A.b,t.add(f);t.multiplyScalar(Number(E)),D.add(t),N.push(D)}let U=N.concat(p),I=N.length,G,Q,Y,O=[],V=[],F,W,ee,ae,K=new ve,$=new ve,ie=new ve;for(r=0,n=l.length;r<n;r++)g=l[r],G=Number(d3(g.a,g.b,d).newEdge)+I,Q=Number(d3(g.b,g.c,d).newEdge)+I,Y=Number(d3(g.c,g.a,d).newEdge)+I,CS(O,G,Q,Y,g.materialIndex),CS(O,g.a,G,Y,g.materialIndex),CS(O,g.b,Q,G,g.materialIndex),CS(O,g.c,Y,Q,g.materialIndex),u&&(F=c[r],W=F[0],ee=F[1],ae=F[2],K.set(ng(W.x,ee.x),ng(W.y,ee.y)),$.set(ng(ee.x,ae.x),ng(ee.y,ae.y)),ie.set(ng(W.x,ae.x),ng(W.y,ae.y)),TS(V,K,$,ie),TS(V,W,K,ie),TS(V,ee,$,K),TS(V,ae,ie,$));e.vertices=U,e.faces=O,u&&(e.faceVertexUvs[0]=V)}},In=new k,oLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Bt().copy(new Hl(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(In),r={width:In.x,height:In.y,depth:In.z,subdivisions:0}):r=t.parameters;let n={...r,...e.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:n}=e.parameters,s=e.geometry??new Bt().copy(new Hl(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(In)):In.set(a.width,a.height,a.depth),(t!==In.x||i!==In.y||r!==In.z)&&s.scale(In.x===0?1:t/In.x,In.y===0?1:i/In.y,In.z===0?1:r/In.z);let o=s.originalGeometry;try{n>0?(o===void 0||(a==null?void 0:a.subdivisions)!==n)&&(o===void 0&&(o=s),s=new aLe(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new m$(i).load(e,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(In);let s=100/In.x;Object.assign(n.parameters,{width:100,height:In.y*s,depth:In.z*s}),t(this.build(n))})}},cte=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Jr?e.shape:new Jr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,p=2*Math.PI/r;for(let v=0;v<r;v++){let m=p*v,g=h+Math.sin(m)*c,y=d+Math.cos(m)*u;l.addPoint(l.createPoint(g,y))}l.isClosed=!0;for(let v=0,m=l.points.length;v<m;v++)l.points[v].roundness=n;l.roundness=n,l.update();let f=vm.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},lLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=new uLe(t*.5,i,n,s,a,o,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function jy(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function f3(e,t,i,r,n,s){let a=t.clone().sub(e),o=i.clone().sub(e),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(e),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function cLe(e,t,i){let r=e.clone().sub(t),n=i.clone().sub(t);return r.projectOnVector(n),r.add(t)}var uLe=class extends Bt{constructor(e=.5,t=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),v=2*Math.PI/i,m=(i-2)*Math.PI/i,g=Math.PI-m,y=new k(0,-d,0),x=new k(0,d,0),_=new ve(e,-d),M=new ve(f,-d),S=new ve(0,x.y).sub(M),E=new ve(0,x.y).sub(_),A=new ve(S.y,-S.x).normalize(),P=new ve(E.y,-E.x).normalize(),C=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-S.angle())/2)-1e-8;s=Math.min(s,C);let D;{let Y=new k(A.x,A.y,0),O=new k(Math.cos(v)*Y.x,Y.y,Math.sin(v)*Y.x);D=Y.angleTo(O)}let N=s/Math.tan((Math.PI-S.angle())/2),U=s/Math.tan((Math.PI-D)/2),I=new k;if(!n){l.push(y.x,y.y,y.z),c.push(0,-1,0),u.push(0,0);let Y=h++,O=[],V=_.clone(),F=N/Math.cos(Math.PI/i);V.x-=F;for(let W=0;W<i;W++){let ee=W/i*Math.PI*2+p,ae=new ve(Math.sin(ee),Math.cos(ee));jy(V,ae,I),l.push(I.x,I.y,I.z),c.push(0,-1,0),u.push(0,0),O.push(h++)}for(let W=0;W<O.length;W++)o.push(O[W],Y,O[(W+1)%O.length])}{let Y=new k,O=new k,V=new k,F=new k,W=new k,ee=new k;for(let ae=0;ae<i;ae++){let K=ae/i*Math.PI*2+p,$=(ae+.5)/i*Math.PI*2+p,ie=(ae+1)/i*Math.PI*2+p,ye=new ve(Math.sin(K),Math.cos(K)),pe=new ve(Math.sin($),Math.cos($)),me=new ve(Math.sin(ie),Math.cos(ie));jy(_,ye,O),jy(_,me,V),jy(A,pe,Y),f3(x,O,V,U,U,F),l.push(F.x,F.y,F.z),f3(O,x,V,U,N,W),l.push(W.x,W.y,W.z),f3(V,O,x,N,U,ee),l.push(ee.x,ee.y,ee.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),u.push(0,0),u.push(0,0);let ge=h++,xe=h++,te=h++;if(o.push(ge,xe,te),s>0){{let Se=O.clone().add(V).multiplyScalar(.5),Re=x.clone().sub(Se).normalize(),Xe=y.clone().sub(Se).normalize().add(Re).normalize().multiplyScalar(-1),Be=ee.clone().sub(W);G(Se,Be,Xe,S.angle())}let we,Ce;{let Se=new k;jy(P,me,Se);let Re=ee.clone().add(F).multiplyScalar(.5);Re=cLe(Re,V,x);let Xe=ee.clone().sub(F);[we,Ce]=G(Re,Xe,Se,D,F.y)}{let Se=we,Re=Se.clone().setY(0).normalize(),Xe=new k(0,-1,0),Be=Re.clone().cross(Xe);Q(Se,Re,Xe,Be)}{let Se=S.angle(),Re=Math.PI-Se,Xe=x.clone();Xe.y-=s/Math.sin(Se-Math.PI/2);let Be=new k,Fe=[];for(let se=0;se<a;se++){let z=[],X=Math.PI/2-Re*se/a,ce=Math.cos(X),Ee=Math.sin(X),q=$;for(let Ye=0;Ye<=se;Ye++){let et=Math.cos(q),ke=Math.sin(q);Y.x=ce*ke,Y.y=Ee,Y.z=ce*et,Be.copy(Xe).addScaledVector(Y,s),l.push(Be.x,Be.y,Be.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),z.push(h++),q+=Math.PI*2/se/i}Fe.push(z)}Ce.reverse(),Fe.push(Ce);let dt=Fe.length-1;for(let se=0;se<dt;se++){let z=Fe[se],X=Fe[se+1],ce=z.length-1;o.push(X[1],z[0],X[0]);for(let Ee=1;Ee<=ce;Ee++)o.push(z[Ee],z[Ee-1],X[Ee]),o.push(X[Ee+1],z[Ee],X[Ee])}}}}}this.setIndex(o),this.setAttribute("position",new _t(l,3)),this.setAttribute("normal",new _t(c,3)),this.setAttribute("uv",new _t(u,2));function G(Y,O,V,F,W){let ee=-F/2,ae=(Math.PI-F)/2,K=O.clone().normalize().cross(V);Y.addScaledVector(V,-s/Math.sin(ae));let $=new k,ie=new k,ye=1,pe=h,me=[];for(let ge=0;ge<=a;ge++){let xe=ee+ge/a*F;ie.set(0,0,0),ie.addScaledVector(K,Math.sin(xe)),ie.addScaledVector(V,Math.cos(xe));for(let te=0;te<=ye;te++){let we=te/ye-.5;if($.copy(Y),$.addScaledVector(O,we),$.addScaledVector(ie,s),W!=null){let Ce=Math.max(0,$.y-W);$.addScaledVector(O,-Ce/O.y)}l.push($.x,$.y,$.z),c.push(ie.x,ie.y,ie.z),u.push(0,0),te===0&&me.push(h),h++}}for(let ge=0;ge<a;ge++)for(let xe=0;xe<ye;xe++){let te=pe+xe+(ye+1)*ge,we=te+(ye+1),Ce=we+1,Se=te+1;o.push(te,we,Se),o.push(we,Ce,Se)}return[Y.clone().addScaledVector(O,.5),me]}function Q(Y,O,V,F){let W=Math.PI/2,ee=E.angle()-W,ae=[],K=new k,$=new k;for(let ye=0;ye<=a;ye++){let pe=[],me=ye/a;for(let ge=0;ge<=ye;ge++){let xe=((ye?ge/ye:0)-.5)*g,te=Math.cos(xe),we=Math.sin(xe),Ce=Math.atan(Math.tan(ee)*te),Se=(W+Ce)*me,Re=Math.cos(Se),Xe=Math.sin(Se);K.set(0,0,0),K.addScaledVector(O,Xe*te),K.addScaledVector(V,Re),K.addScaledVector(F,Xe*we),$.copy(Y).addScaledVector(K,s),l.push($.x,$.y,$.z),c.push(K.x,K.y,K.z),u.push(0,0),pe.push(h++)}ae.push(pe)}let ie=ae.length-1;for(let ye=0;ye<ie;ye++){let pe=ae[ye],me=ae[ye+1],ge=pe.length-1;o.push(pe[0],me[1],me[0]);for(let xe=1;xe<=ge;xe++)o.push(pe[xe-1],pe[xe],me[xe]),o.push(pe[xe],me[xe+1],me[xe])}}}},Kk=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Jr?e.shape:new Jr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(_,M,S){return M>i&&S>r?Math.min(_*i/M,_*r/S):M>i?_*i/M:S>r?_*r/S:_}let p=[];p[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),p[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),p[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),p[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let f=u.x,v=h.x,m=h.y,g=u.y;t.addPoint(t.createPoint(f,m)),t.addPoint(t.createPoint(v,m)),t.addPoint(t.createPoint(v,g)),t.addPoint(t.createPoint(f,g)),t.isClosed=!0;let y=!0;for(let _=0,M=t.points.length;_<M;_++)t.points[_].roundness=p[_],_>0&&p[_]!==p[_-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let x=vm.create({shape:t,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...e,type:"RectangleGeometry"}})}},hLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Mt.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new Bt,u.setAttribute("position",new _t([],3))):u=new Lv(.5*t,n,s,a,o,l,c*Mt.DEG2RAD),u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},dLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:n=8}=e.parameters,s=new Hc(t,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},pLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=e.parameters,o=new fLe(t,i,r,n,s,a);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},fLe=class extends Bt{constructor(e=1,t=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(ye=0,pe=0,me=0)=>new k(ye,pe,me),p=d(),f=d(),[v,m,g]=[t/2,e/2,i/2],y=-m,x=+m,[_,M,S]=[d(y,-v,+g),d(y,-v,-g),d(y,+v,-g)],E=(ye,pe=!1)=>Math.sin(ye-Math.PI/(1+ +pe)),A=(ye,pe=!1)=>Math.cos(ye-Math.PI/(1+ +pe));S.y=Math.sin(r)*t-v;let P=Math.cos(r)*t-g,C=_.z-c;r<=h?(S.z=Math.min(P,C),S.z==C&&(S.y-=(P-C)/Math.tan(h-r))):M.z=Math.min(M.z-P-g,_.z-c),p.subVectors(_,M),f.subVectors(S,M);let D=Math.min(p.length(),f.length())*n/100,N=D*Math.tan(r/2),U=D/Math.cos(r/2),I=p.clone().normalize().add(f.normalize()).setLength(U).add(M);p.set(0,E(r,!0),A(r,!0)),u.push([S,p.clone()]);let G=(Math.PI-r)/s;for(let ye=0;ye<=s;ye++){let pe=h+r+ye*G;p.set(0,Math.sin(pe)*N,Math.cos(pe)*N),p.add(I),f.set(0,E(pe),A(pe)),u.push([p.clone(),f.clone()])}u.push([_,d(0,1,0)]);let Q=Math.sin(G/2)*N*2,Y=u.length-1,O=u[0][0].distanceTo(u[1][0]),V=u[Y-1][0].distanceTo(u[Y][0]),F=O+Q*s+V;u[0].push(1);for(let ye=0;ye<=s;ye++)u[ye+1].push(1-(O+ye*Q)/F);u[Y].push(0);let[W,ee,ae]=u[0],K,$,ie;for(let ye=1;ye<u.length;ye++)[K,$,ie]=u[ye],a.push(y,W.y,W.z,y,K.y,K.z,x,W.y,W.z,x,W.y,W.z,y,K.y,K.z,x,K.y,K.z),o.push(0,ee.y,ee.z,0,$.y,$.z,0,ee.y,ee.z,0,ee.y,ee.z,0,$.y,$.z,0,$.y,$.z),l.push(0,ae,0,ie,1,ae,1,ae,0,ie,1,ie),[W,ee,ae]=[K,$,ie];this.setAttribute("position",new _t(a,3)),this.setAttribute("normal",new _t(o,3)),this.setAttribute("uv",new _t(l,2))}},ute=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Jr?e.shape:new Jr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,p=0,f=0,v=a*Math.PI/360/n,m=Math.PI/2*3*-1,g=h*r/100,y=d*r/100;if(n===3&&r===50){v=2*Math.PI/n;for(let _=0;_<n;_++){let M=v*_,S=p+Math.sin(M)*h,E=f+Math.cos(M)*d;u.addPoint(u.createPoint(S,E))}}else for(let _=0;_<n;_++){let M=p+Math.cos(m)*h,S=f+Math.sin(m)*d;u.addPoint(u.createPoint(M,S)),m+=v,M=p+Math.cos(m)*g,S=f+Math.sin(m)*y,u.addPoint(u.createPoint(M,S)),m+=v}u.isClosed=!0;for(let _=0,M=u.points.length;_<M;_++)u.points[_].roundness=s;u.roundness=s,u.update();let x=vm.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(x,{userData:{...e,type:"StarGeometry"}})}},mLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Hc(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},gLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=e.parameters,c=vLe(t,i,r,t*.5,a,s,0,0,n,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function vLe(e,t,i,r,n,s,a,o,l,c,u){[t,i]=[i,t],a=t/2;let h=Mt.clamp(n/360,0,1);if(h===0){let d=new Bt;return d.setAttribute("position",new _t([],3)),d}return h===1&&(c=0),new ote(!0,e,t,i,r,h,s,a,o,l,c,u)}var yLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new l$(o,i,r,n,s,a);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},xLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Jr?e.shape:new Jr,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=vm.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function bLe(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}function wLe(e){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(e.toLowerCase())}function _Le(e,t,i){let r,n,s,a=Math.floor(e*6),o=e*6-a,l=i*(1-t),c=i*(1-o*t),u=i*(1-(1-o)*t);switch(a%6){case 0:r=i,n=u,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=c,s=i;break;case 4:r=u,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function SLe(e,t,i){e/=255,t/=255,i/=255;let r=Math.max(e,t,i),n=Math.min(e,t,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case e:l=(t-i)/a+(t<i?6:0);break;case t:l=(i-e)/a+2;break;case i:default:l=(e-t)/a+4;break}l/=6}return{h:l,s:o,v:s}}function MLe(e){return e=Math.floor(e),{r:e>>16&255,g:e>>8&255,b:e&255}}function ELe(e,t,i){return(e<<16)+(t<<8)+i}function ALe(e,t,i){return e=Math.round(e),t=Math.round(t),i=Math.round(i),"#"+[e,t,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function CLe(e){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var TLe={parseRgba:wLe,hsvToRgb:_Le,rgbToHsv:SLe,hexToRgb:MLe,rgbToHex:ELe,rgbToHexString:ALe,hexStringToRgb:CLe},PLe=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},DLe=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},Ke=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Ke.version}static addUnaryOp(t){return Ke.max_unop_len=Math.max(t.length,Ke.max_unop_len),Ke.unary_ops[t]=1,Ke}static addBinaryOp(t,i,r){return Ke.max_binop_len=Math.max(t.length,Ke.max_binop_len),Ke.binary_ops[t]=i,r?Ke.right_associative.add(t):Ke.right_associative.delete(t),Ke}static addIdentifierChar(t){return Ke.additional_identifier_chars.add(t),Ke}static addLiteral(t,i){return Ke.literals[t]=i,Ke}static removeUnaryOp(t){return delete Ke.unary_ops[t],t.length===Ke.max_unop_len&&(Ke.max_unop_len=Ke.getMaxKeyLen(Ke.unary_ops)),Ke}static removeAllUnaryOps(){return Ke.unary_ops={},Ke.max_unop_len=0,Ke}static removeIdentifierChar(t){return Ke.additional_identifier_chars.delete(t),Ke}static removeBinaryOp(t){return delete Ke.binary_ops[t],t.length===Ke.max_binop_len&&(Ke.max_binop_len=Ke.getMaxKeyLen(Ke.binary_ops)),Ke.right_associative.delete(t),Ke}static removeAllBinaryOps(){return Ke.binary_ops={},Ke.max_binop_len=0,Ke}static removeLiteral(t){return delete Ke.literals[t],Ke}static removeAllLiterals(){return Ke.literals={},Ke}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new Ke(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(i=>i.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return Ke.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!Ke.binary_ops[String.fromCharCode(t)]||Ke.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return Ke.isIdentifierStart(t)||Ke.isDecimalDigit(t)}throwError(t){let i=new Error(t+" at character "+this.index);throw i.index=this.index,i.description=t,i}runHook(t,i){if(Ke.hooks[t]){let r={context:this,node:i};return Ke.hooks.run(t,r),r.node}return i}searchHook(t){if(Ke.hooks[t]){let i={context:this};return Ke.hooks[t].find(function(r){return r.call(i.context,i),i.node}),i.node}}gobbleSpaces(){let t=this.code;for(;t===Ke.SPACE_CODE||t===Ke.TAB_CODE||t===Ke.LF_CODE||t===Ke.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),i=t.length===1?t[0]:{type:Ke.COMPOUND,body:t};return this.runHook("after-all",i)}gobbleExpressions(t){let i=[],r,n;for(;this.index<this.expr.length;)if(r=this.code,r===Ke.SEMCOL_CODE||r===Ke.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())i.push(n);else if(this.index<this.expr.length){if(r===t)break;this.throwError('Unexpected "'+this.char+'"')}return i}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,Ke.max_binop_len),i=t.length;for(;i>0;){if(Ke.binary_ops.hasOwnProperty(t)&&(!Ke.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Ke.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=i,t;t=t.substr(0,--i)}return!1}gobbleBinaryExpression(){let t,i,r,n,s,a,o,l,c;if(a=this.gobbleToken(),!a||(i=this.gobbleBinaryOp(),!i))return a;for(s={value:i,prec:Ke.binaryPrecedence(i),right_a:Ke.right_associative.has(i)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+i),n=[a,s,o];i=this.gobbleBinaryOp();){if(r=Ke.binaryPrecedence(i),r===0){this.index-=i.length;break}s={value:i,prec:r,right_a:Ke.right_associative.has(i)},c=i;let u=h=>s.right_a&&h.right_a?r>h.prec:r<=h.prec;for(;n.length>2&&u(n[n.length-2]);)o=n.pop(),i=n.pop().value,a=n.pop(),t={type:Ke.BINARY_EXP,operator:i,left:a,right:o},n.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+c),n.push(s,t)}for(l=n.length-1,t=n[l];l>1;)t={type:Ke.BINARY_EXP,operator:n[l-1].value,left:n[l-2],right:t},l-=2;return t}gobbleToken(){let t,i,r,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(t=this.code,Ke.isDecimalDigit(t)||t===Ke.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===Ke.SQUOTE_CODE||t===Ke.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(t===Ke.OBRACK_CODE)n=this.gobbleArray();else{for(i=this.expr.substr(this.index,Ke.max_unop_len),r=i.length;r>0;){if(Ke.unary_ops.hasOwnProperty(i)&&(!Ke.isIdentifierStart(this.code)||this.index+i.length<this.expr.length&&!Ke.isIdentifierPart(this.expr.charCodeAt(this.index+i.length)))){this.index+=r;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Ke.UNARY_EXP,operator:i,argument:s,prefix:!0})}i=i.substr(0,--r)}Ke.isIdentifierStart(t)?(n=this.gobbleIdentifier(),Ke.literals.hasOwnProperty(n.name)?n={type:Ke.LITERAL,value:Ke.literals[n.name],raw:n.name}:n.name===Ke.this_str&&(n={type:Ke.THIS_EXP})):t===Ke.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let i=this.code;for(;i===Ke.PERIOD_CODE||i===Ke.OBRACK_CODE||i===Ke.OPAREN_CODE||i===Ke.QUMARK_CODE;){let r;if(i===Ke.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Ke.PERIOD_CODE)break;r=!0,this.index+=2,this.gobbleSpaces(),i=this.code}this.index++,i===Ke.OBRACK_CODE?(t={type:Ke.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),i=this.code,i!==Ke.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):i===Ke.OPAREN_CODE?t={type:Ke.CALL_EXP,arguments:this.gobbleArguments(Ke.CPAREN_CODE),callee:t}:(i===Ke.PERIOD_CODE||r)&&(r&&this.index--,this.gobbleSpaces(),t={type:Ke.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),r&&(t.optional=!0),this.gobbleSpaces(),i=this.code}return t}gobbleNumericLiteral(){let t="",i,r;for(;Ke.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===Ke.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);Ke.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(i=this.char,i==="e"||i==="E"){for(t+=this.expr.charAt(this.index++),i=this.char,(i==="+"||i==="-")&&(t+=this.expr.charAt(this.index++));Ke.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);Ke.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return r=this.code,Ke.isIdentifierStart(r)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(r===Ke.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===Ke.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Ke.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",i=this.index,r=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===r){n=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return n||this.throwError('Unclosed quote after "'+t+'"'),{type:Ke.LITERAL,value:t,raw:this.expr.substring(i,this.index)}}gobbleIdentifier(){let t=this.code,i=this.index;for(Ke.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,Ke.isIdentifierPart(t));)this.index++;return{type:Ke.IDENTIFIER,name:this.expr.slice(i,this.index)}}gobbleArguments(t){let i=[],r=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){r=!0,this.index++,t===Ke.CPAREN_CODE&&n&&n>=i.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===Ke.COMMA_CODE){if(this.index++,n++,n!==i.length){if(t===Ke.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===Ke.CBRACK_CODE)for(let a=i.length;a<n;a++)i.push(null)}}else if(i.length!==n&&n!==0)this.throwError("Expected comma");else{let a=this.gobbleExpression();(!a||a.type===Ke.COMPOUND)&&this.throwError("Expected comma"),i.push(a)}}return r||this.throwError("Expected "+String.fromCharCode(t)),i}gobbleGroup(){this.index++;let t=this.gobbleExpressions(Ke.CPAREN_CODE);if(this.code===Ke.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:Ke.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Ke.ARRAY_EXP,elements:this.gobbleArguments(Ke.CBRACK_CODE)}}},LLe=new PLe;Object.assign(Ke,{hooks:LLe,plugins:new DLe(Ke),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});Ke.max_unop_len=Ke.getMaxKeyLen(Ke.unary_ops);Ke.max_binop_len=Ke.getMaxKeyLen(Ke.binary_ops);var f0=e=>new Ke(e).parse(),RLe=Object.getOwnPropertyNames(Ke);RLe.forEach(e=>{f0[e]===void 0&&e!=="prototype"&&(f0[e]=Ke[e])});f0.Jsep=Ke;var ILe="ConditionalExpression",OLe={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),t.node={type:ILe,test:i,consequent:r,alternate:n},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};f0.plugins.register(OLe);function LT(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(n){n(i)}),(r=e.get("*"))&&r.slice().map(function(n){n(t,i)})}}}var hte=class{constructor(e,t,i){var r;this.id=e,this.userAPI=t,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(n=>n()),this.emitter=LT(),this._innerCallUserAPI=async n=>{var s,a,o;this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await ULe(this.userAPI,n),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(l){let c=((o=(a=(s=l.message)==null?void 0:s.split("_:_"))==null?void 0:a[0])==null?void 0:o.replace("status:",""))??"null";this.error=c,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},((r=t==null?void 0:t.integration)==null?void 0:r.type)==="OpenAI"?this.result={content:""}:t.method==="GET"&&t.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=Zx(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?Zx(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(e){await this.callUserAPI(e)}async callUserAPI(e){await this._debouncedCallUserAPI(e)}update(e,t,i=!0){this.userAPI=e,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(t)}retrieveValue(e){if(this.result)try{return Un.zoom(this.result,e)}catch(t){console.error(t)}}retrieveZoomedKeyValues(e){if(this.result){let t=e&&e.length?Un.zoom(this.result,e):this.result;if(kLe(t))return Object.entries(t);if(BLe(t))return t.map((i,r)=>[r.toString(),i]);throw zLe(t)?new Error("This path points to a value, use retrieveValue() instead. "+(e==null?void 0:e.join("."))):new Error("Path error"+(e==null?void 0:e.join(".")))}}dispose(){}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}get autostart(){return this.userAPI.autoStart}};function NLe(e){let t=new Headers;return e.headers.forEach(i=>{i.data.key!==""&&t.append(i.data.key,i.data.value)}),t}function zLe(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e===null}function BLe(e){return Array.isArray(e)}function kLe(e){return typeof e=="object"&&e!==null}async function ULe(e,t,i=new AbortController){var l,c,u,h;let r,n=e.url,s=((l=e.proxy)==null?void 0:l.enabled)??!1,a;if(((c=e.integration)==null?void 0:c.type)==="OpenAI"){let d=P1(e.integration.prompt===""?[]:JSON.parse(e.integration.prompt),t),p=e.integration.behavior===""?[]:P1(JSON.parse(e.integration.behavior),t);a=`{
		"model": "${e.integration.model}",
		"messages": [${e.integration.useBehavior?`
		{
			"role": "system",
			"content": "${p}"
		},`:""}
		{
			"role": "user",
			"content": "${d}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${e.proxy.fileId}/external-api/request?uuidexternalapi=${e.proxy.proxyId}`;let d;a!==void 0?d=a:e.method==="POST"&&e.body&&(d=P1(JSON.parse(e.body),t)),d!==void 0&&(n+=`&data=${encodeURIComponent(d.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else((u=e.integration)==null?void 0:u.type)==="OpenAI"?r=a:e.method==="POST"&&e.body&&(r=P1(JSON.parse(e.body),t));let o=await fetch(n,{method:s?"GET":e.method,headers:s?void 0:NLe(e),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(((h=e.integration)==null?void 0:h.type)==="OpenAI"){let d=await o.json();return s&&(d=d.response),{content:d.choices[0].message.content}}else{let d=await o.json();return s&&(d=d.response),d}}var dte=(e,t)=>{if(typeof e=="string"){let i=t.getVariable(e);if(i)return dte(i,t)}return Ss.isBoolean(e)?Ss.getDisplayedValue(e).toLowerCase():Ss.getDisplayedValue(e)},P1=(e,t)=>e.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+P1(i.children,t);if(i.type==="variable"){let n=t.getVariable(i.variableId);if(n!==void 0)return dte(n,t)}}return""}).join(""),FLe=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],VLe=["0","1","2","3","4","5","6","7","8","9","."],jLe=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function HLe(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}f0.addBinaryOp("^",11,!0);function pte(e,t,i="number"){let r="";for(let a=0;a<e.length;a++){let o=e[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=t.getUserAPI(c);if(u!==void 0&&u instanceof hte){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=t.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=t.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(t.scene.data.objects.traverse((u,h)=>{var p;let d=(p=h.events)==null?void 0:p.find(f=>f.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l==null?void 0:l.computeAnalysisForListenerEvent(c.data);if(u!==void 0){r+=u;continue}}}r+=(l==null?void 0:l.voice)??0;continue}if("id"in o){let l=e[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=Ss.getDisplayedValue(c);i==="number"&&Ss.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&Ss.isBoolean(c)?u=c?"true":"false":i==="boolean"&&Ss.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!HLe(o.name)&&!VLe.includes(o.name)&&!FLe.includes(o.name)&&!jLe.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=f0(r)}catch(a){console.error(r,a);return}let s;try{s=Ui(n)}catch(a){console.error(r,n,a)}return s}function Ui(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(Ui(e.left)===Ui(e.right));case"!=":return+(Ui(e.left)!==Ui(e.right));case">":return+(Ui(e.left)>Ui(e.right));case">=":return+(Ui(e.left)>=Ui(e.right));case"<":return+(Ui(e.left)<Ui(e.right));case"<=":return+(Ui(e.left)<=Ui(e.right));case"+":return Ui(e.left)+Ui(e.right);case"-":return Ui(e.left)-Ui(e.right);case"*":return Ui(e.left)*Ui(e.right);case"/":return Ui(e.left)/Ui(e.right);case"%":return Ui(e.left)%Ui(e.right);case"&&":return Ui(e.left)&&Ui(e.right);case"||":return Ui(e.left)||Ui(e.right);case"^":return Math.pow(Ui(e.left),Ui(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-Ui(e.argument);case"!":return+!Ui(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=Ui(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=Ui(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(Ui))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var GLe=new lt,WLe=new lt;function XLe(e,t,i){let r=[new k,new k,new k],n=[new k,new k,new k];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Mt.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new lt().makeBasis(r[0],r[1],r[2])}var qLe=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=(t==null?void 0:t.shapeData)??Qk.create({parameters:Nee}).userData.shape;return{path:e.path??KA.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...zee,...i.extrusion}}),shapeData:a}}static build(e){if(e.path.points.length>=2){let t=new YLe(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Bt,{userData:{...e,type:"PathGeometry"}})}},YLe=class extends Bt{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!bLe(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let Y=0;Y<o;Y++){let O=this.inputs.path.isClosed?(Y+s)%e.length:Math.min(Y+s,e.length-1);l.push(e[O].clone()),c.push(t[O].clone())}let u=(Y,O,V)=>{l[Y]=l[Y].clone().lerp(l[O],V),c[Y]=XLe(c[Y],c[O],V)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let p=0,f=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,u(l.length-1,l.length-2,1-p)),i===0){let Y=l.length-1;l[Y].copy(l[0]),c[Y].copy(c[0])}this._applyPathModifiers(c,h,p);let{bevel:v,bevelSides:m}=this.inputs.parameters.extrusion,g=v>0?this.inputs.parameters.extrusion.capType:"flat",y=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(y=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:x,infos:_,vertices:M}=this._computeShapePoints(y),S=0,E;g==="round"&&(E=new Zk(this.inputs.shapeData,2*v,v,y,m,void 0,!0),S=E.getAttribute("position").count);let A=0,P=0;_.sort((Y,O)=>Y.start-O.start),_.forEach(Y=>{Y.verticesStart=A,Y.verticesCount=Y.continuous.reduce((O,V,F)=>O+(F===0||!V?2:1),0),P+=Y.verticesCount,A=P});let C=P*o,D,N=0;if(this._isOpenEnded()&&g==="flat"){try{D=Sd({windingRule:sr.ODD,elementType:Sn.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{D=ete}N=D.vertexCount}let U=C+2*N+S*2,I=C+2*N,G={positions:new Float32Array(U*3),normals:new Float32Array(U*3),uvs:new Float32Array(U*2)},Q=[];if(_.forEach(Y=>{this._extrudeRegion(Y,M,c,l,G,Q,this._isGeometryClosed()&&!this._isOpenEnded())}),D&&(this._closeEnd(D,C,Q,G,c[0],l[0],!1),this._closeEnd(D,C+N,Q,G,c[c.length-1],l[l.length-1],!0)),E){G.positions.set(E.getAttribute("position").array,I*3),G.normals.set(E.getAttribute("normal").array,I*3),G.uvs.set(E.getAttribute("uv").array,I*2);for(let F=I;F<I+S;F++)G.uvs[F*2+1]=1e-4;let Y=Q.length;Q.push(...E.getIndex().array.map(F=>F+I)),I+=S,G.positions.set(E.getAttribute("position").array,I*3),G.normals.set(E.getAttribute("normal").array,I*3),G.uvs.set(E.getAttribute("uv").array,I*2);let O=Q.length;Q.push(...E.getIndex().array.map(F=>F+I)),this.setAttribute("position",new Zt(G.positions,3)),this.setAttribute("normal",new Zt(G.normals,3)),this.setAttribute("uv",new Zt(G.uvs,2)),this.setIndex(Q);let V=GLe;V.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(V,I,U),V.copy(c[0]).setPosition(l[0]).multiply(WLe.makeScale(1,1,-1)),this.applyMatrix4OnRange(V,I-S,I),this.reverseIndicesOnRange(Y,O)}else this.setAttribute("position",new Zt(G.positions,3)),this.setAttribute("normal",new Zt(G.normals,3)),this.setAttribute("uv",new Zt(G.uvs,2)),this.setIndex(Q)}_extractPathPoints(){let e=Wee(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,n=new k,s=new k,a=new k,o=new k,l=new k(0,1,0);for(let f=0;f<i;f++){let v=e[f],m;f===0?m=r?e[e.length-2]:v.clone().multiplyScalar(2).sub(e[1]):m=e[f-1];let g;f===i-1?g=r?e[1]:v.clone().multiplyScalar(2).sub(e[f-1]):g=e[f+1];let y=v.clone().sub(m).normalize(),x=g.clone().sub(v).normalize(),_=y.clone().add(x).normalize();a.copy(_),f===0&&(_.equals(l)||_.clone().negate().equals(l))&&l.set(0,0,1);let M=l.clone().cross(_).normalize(),S=_.clone().cross(M).normalize();l.copy(S),o.copy(M),f===0&&(n.copy(S),s.copy(_));let E=new lt().makeBasis(M,S,_);t.push(E)}let c=r?s:a,u=r?n:new k(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let p=u.clone().cross(h);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let v=new lt().makeRotationZ(d*f/t.length);t[f].multiply(v)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new lt,c=new lt;return e.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(Mt.lerp(n,n+s,d)*Mt.DEG2RAD);let p=Mt.lerp(a,o,d);c.makeScale(p,p,p),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=sr.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],f=u[d-0];h.push(p,f)}return h}),s;try{s=Sd({windingRule:t,elementType:Sn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=Yk}let a;try{a=Sd({windingRule:sr.ODD,elementType:Sn.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=$ee}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],p=s.elements[h+1],f=d+p,v={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(v);let m=d,g=f-1,y=d+1,x=i.roundedCurves.length;do{let _=m-d;s.vertices[g*2+0],s.vertices[g*2+1];let M=s.vertices[m*2+0],S=s.vertices[m*2+1],E=s.vertices[y*2+0],A=s.vertices[y*2+1],P=M-E,C=S-A,D=Math.sqrt(P*P+C*C);P/=D,C/=D,v.normals[_*2+0]=-C,v.normals[_*2+1]=P;let N=s.vertexIndices[m];if(Array.isArray(N))v.continuous[_]=!1;else{let[U,I]=i.getCurveIndexFromVertexId(N-1,!0);if(I>0&&I<1)v.continuous[_]=!0;else{let G=I===1?U+1:U-1;G=(G+x)%x;let Q=I===1?0:1,Y=i.roundedCurves[U].getTangent(I),O=i.roundedCurves[G].getTangent(Q);v.continuous[_]=Y.dot(O)>.95}}u&&(v.normals[_*2+0]*=-1,v.normals[_*2+1]*=-1),[g,m,y]=[m,y,y+1],y>=f&&(y-=p)}while(y!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,n){let s=t*2,a=t*3;e.positions[a+0]=i.x,e.positions[a+1]=i.y,e.positions[a+2]=i.z,e.normals[a+0]=r.x,e.normals[a+1]=r.y,e.normals[a+2]=r.z,e.uvs[s+0]=n.x,e.uvs[s+1]=n.y}_extrudeRegion(e,t,i,r,n,s,a){let o=new k,l=new k,c=new k,u=new k,h=new ve;i.forEach((p,f)=>{let v=r[f],m=e.verticesStart*i.length+e.verticesCount*f;for(let g=0;g<e.count;g++){let y=(e.start+g)*2;if(o.set(t[y+0],t[y+1],0),c.copy(o).applyMatrix4(p).add(v),e.continuous[g])u.set(e.normals[g*2+0],e.normals[g*2+1],0);else{let x=g===0?(e.start+e.count-1)*2:y-2;l.set(t[x+0],t[x+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),h.set(g===0?1:g/e.count,f/(i.length-1)),this._insertVertex(n,m,c,u,h),m++,!e.continuous[g]||g===0){if(g===0)u.set(e.normals[g*2+0],e.normals[g*2+1],0),h.set(0,f/(i.length-1));else{let x=g===e.count-1?e.start*2:y+2;l.set(t[x+0],t[x+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(n,m,c,u,h),m++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,v=e.verticesStart*i.length+e.verticesCount*(p+1),m=0;for(let g=0;g<e.count;g++){(!e.continuous[g]||g===0)&&m++;let y=g===e.count-1?0:m+1,x=f+m,_=f+y,M=v+y,S=v+m;e.isHole?s.push(x,M,_,x,S,M):s.push(x,_,M,x,M,S),m++}}}_closeEnd(e,t,i,r,n,s,a){let o=e.vertexCount,l=new k(0,0,a?-1:1).applyMatrix4(n),c=new k,u=new ve;for(let d=0;d<o;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(n).add(s),this._insertVertex(r,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,f=h[p+0]+t,v=h[p+(a?1:2)]+t,m=h[p+(a?2:1)]+t;i.push(f,v,m)}}applyMatrix4OnRange(e,t,i){let r=e.elements,n=new Mn().getNormalMatrix(e).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,p=c.itemSize;for(let f=t*p,v=i*p;f<v;f+=p){if(f===t)debugger;s=h[f+0],a=h[f+1],o=h[f+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[f+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[f+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[f+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[f+0],a=d[f+1],o=d[f+2],d[f+0]=n[0]*s+n[3]*a+n[6]*o,d[f+1]=n[1]*s+n[4]*a+n[7]*o,d[f+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function fte(){let e=new Bt;return e.setAttribute("position",new Zt(new Float32Array([]),3)),e.setIndex(new Zt(new Uint16Array([]),1)),e}var ZLe=fte().attributes,QLe=12,KLe=1,jO=class extends Bt{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,ZLe),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,text:o,textTransform:l}=e,c=Ss.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=JLe(e,t,u),{shapes:d,charWidths:p,charCoords:f}=t.generateShapes(h,e),v=(typeof i=="number"?i:1)*.5,m=(typeof r=="number"?r:1)*.5,g=d.map(_=>new Jr().fromShape(_,!0));this.vectorShapes=g;let y=g.map(_=>vm.create({shape:_,parameters:{depth:n,extrudeBevelSegments:a,extrudeBevelSize:s,windingRule:n<=0?sr.NONZERO:sr.ODD,subdivisions:this.isLowResolution&&n>0?KLe:QLe}})),x=y.length?_f(y):fte();x.translate(-v,m,0),this.dispose(),this.wrappedText=h,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(x.attributes).forEach(([_,M])=>{this.setAttribute(_,M)}),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let e=nl(new Bt,jO.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:e}})}get text(){return this.userData.parameters.text??""}};function JLe(e,t,i){let r=[""],n="";for(let s of i)n+=s,s===" "||s===`
`?(r[r.length-1]+=n,n="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+n,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+n,e)>e.width&&(n.length===1?(r[r.length-1]+=n,n=""):(r[r.length-1]+=n.slice(0,-1),n=n[n.length-1],r.push(""))));return r[r.length-1]+=n,r}var mte,gte=new Promise(e=>{mte=e}),LW=!1,PS;function $Le(){if(LW)return;if(PS)return PS;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.9.75/build",i=sp(()=>import("./process-B9H0U9ag.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});mte(a),LW=!0}return PS=e(),PS}var eRe=["font"];function ab(e,t,i,r){var c,u;let n,s,a;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),a=[[],["extrusion"]]):(s={...e},a=[[]]);for(let h of a){let d=s;for(let p of h)d=d[p];for(n in d){let p=d[n];OG(p)&&!eRe.includes(n)&&(d[n]=t.getVariable(p,[r.uuid,"geometry",...h,n]),OG(d[n])&&(d[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let h=Jr.createFromState(s.shape,s.width,s.height);o.shape=h}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&((c=s.data.groups)==null||c.forEach(h=>h.materialIndex=Math.max(h.materialIndex??0,0))),o.geometry=new m$().parse(s),o.geometry.groups.length===0){let h=o.geometry;h.addGroup(0,Math.max(((u=h.getIndex())==null?void 0:u.count)??0,h.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let h=new ha(s,i);return h.data=e,h}else{if(s.type==="TextGeometry")return new jO(s,t);if(s.type==="InputGeometry")return new jO(s,t);if(s.type==="UIGeometry")return Kk.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=zW(o)}catch(h){console.error(h)}if(!l){let h=Jr.createFromState(QA.defaultData(),100,100);o.shape=h,l=zW(o)}return l}var tRe=new lt;function HO(e,t,i,r){let n=e.position.array,s=e.normal.array,a=tRe.makeScale(t,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=t,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var DS=new fn,sg=new k,Kt;gte.then(e=>{Kt=e});var RW=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),IW=new Uint32Array([0,1,2,3]),OW=new Uint8Array([4]),ha=class extends Bt{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Bf.div(t,i);this.subdividedGeometry&&HO(this.subdividedGeometry.attributes,...r),this.originalGeometry&&HO(this.originalGeometry.attributes,...r),this.data=e;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(sg.fromArray(r));let s=sg.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=ha.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new Hl(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(ha.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Xa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;DS.setFromBufferAttribute(t),DS.getCenter(i),e.boundingSphere.radius=i.distanceTo(DS.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),DS.getSize(sg);let r={width:sg.x,height:sg.y,depth:sg.z};return this.userData.parameters=r,r}static build(e,t,i,r){let n,s,a,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(Kt.free_bvh(t),Kt.free_subdivision_surface(t));try{n=ha.allocate(e,r)}catch(l){console.error(l,e),n=ha.allocate({positionWASM:RW,indexWASM:IW,verticesPerFaceWASM:OW},r)}if(Kt.set_destination_refinement_level(n,0),s=ha.buildLevel(n,!0,o),e.subdivisions>0)try{Kt.set_destination_refinement_level(n,e.subdivisions),a=ha.buildLevel(n,!1,o)}catch{try{Kt.set_destination_refinement_level(n,e.subdivisions-1),a=ha.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:ab(e,i,!1),n;e.type==="TorusGeometry"&&e.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=RT(r.getAttribute("position"),n));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=vte(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(e,t){var x;let i,r,n,s=[],a=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,n=e.verticesPerFaceWASM):(i=RW,r=IW,n=OW);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,f=Kt._malloc(d),v=new Float32Array(Kt.HEAPF32.buffer,f,u),m=new Uint32Array(Kt.HEAPU32.buffer,f+p,h);v.set(i,0),v.set(s,i.length),v.set(a,i.length+s.length),m.set(r,0),m.set(n,r.length);let g;(x=e==null?void 0:e.scaleBaked)!=null&&x.some(_=>_!==1)&&(g=new lt().makeScale(...e.scaleBaked)),t&&(g?g.premultiply(t):g=t);let y=g?Kt.alloc_subdivision_surface2(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,g.elements):Kt.alloc_subdivision_surface(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return Kt._free(f),y}static buildLevel(e,t,i,r,n){let s=n?Kt.get_mesh_data2(e,t?Kt.Level.CONTROL:Kt.Level.REFINED,i,n.elements):Kt.get_mesh_data(e,t?Kt.Level.CONTROL:Kt.Level.REFINED,i),a=8,o=Kt.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=Kt.HEAPU32[o[c]>>2],h=Kt.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Kt.HEAPU32[o[c]>>2],p=Kt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=Kt.HEAPU32[o[c]>>2],v=Kt.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let m=Kt.HEAPU32[o[c]>>2],g=Kt.HEAPU32.subarray(m>>2,(m>>2)+l[c]);if(c++,r===void 0){let y=new Bt;if(y.setIndex(new Dv(g,1)),y.setAttribute("position",new _t(h,3)),y.setAttribute("normal",new _t(p,3)),t){y.setAttribute("faceMap",new Dv(v,1));let x=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new Zt(x,4))}return Kt.free_mesh_data(s),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Kt.free_mesh_data(s)}static freeSubdivPointer(e){Kt.free_bvh(e),Kt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=Kt.get_wireframe_data_for_base_level(e),n=4,s=Kt.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=Kt.HEAPU32[s[o]>>2],c=Kt.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=Kt.HEAPU32[s[o]>>2],h=Kt.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(t===void 0){let d=new Bt;d.setAttribute("position",new _t(c,3));let p=new Float32Array(c.length);for(let f=0,v=c.length;f<v;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new Zt(p,3)),d.setIndex(new Dv(h,1)),Kt.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,Kt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||Kt.set_destination_refinement_level(e,t);let n=i?Kt.get_topological_data2(e,r?Kt.Level.CONTROL:Kt.Level.REFINED,i.elements):Kt.get_topological_data(e,r?Kt.Level.CONTROL:Kt.Level.REFINED),s=6,a=Kt.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=Kt.HEAPU32[a[l]>>2],u=new Float32Array(Kt.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=Kt.HEAPU32[a[l]>>2],d=new Uint32Array(Kt.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=Kt.HEAPU32[a[l]>>2],f=new Uint8Array(Kt.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return Kt.free_topological_data(n),{positions:u,indices:d,verticesPerFace:f}}},NW=["getX","getY","getZ"];function RT(e,t){let i={},r=t?t.count:e.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[NW[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(e[NW[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var LS=new k,m3=new k,g3=new k,v3=new k;function vte(e,t,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,f)=>Math.floor(f/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===a||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===a||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===a||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){LS.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),m3.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),g3.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),v3.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),m3.sub(LS).normalize(),g3.sub(LS).normalize(),v3.sub(LS).normalize();let l=m3.cross(g3).dot(v3);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(n.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else n.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var Au={};Xme(Au,{calcBoolean:()=>aRe,calcBooleanTopological:()=>sRe,freeMeshSet:()=>uRe,getMeshSet:()=>oRe,hasOpenEdges:()=>lRe,transformMeshSet:()=>cRe});var yte,iRe=new Promise(e=>{yte=e}),RS;function rRe(){if(RS)return RS;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.9.75/build",i=sp(()=>import("./boolean-BpCokwB2.js"),[]),[r,n]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,a=await s({wasmBinary:n});yte(a)}return RS=e(),RS}var Pi,Bv;iRe.then(e=>Pi=e);function nRe(e,t,i){let r,n;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?n=e.getClosedTorusIndicesForBooleanOrSubdiv():n=e.getIndex();let{positions:s,triIndices:a}=RT(e.getAttribute("position"),n),o;if(t&&i){let{indices:l,verticesPerFace:c}=vte(s,a,e);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function xte(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(e[0])?i:r,s=Pi._malloc(n);return(Number.isInteger(e[0])?new Uint32Array(Pi.HEAPU32.buffer,s,t):new Float32Array(Pi.HEAPF32.buffer,s,t)).set(e,0),s}function bte(e){switch(e){case 0:return Pi.OP.UNION;case 1:return Pi.OP.INTERSECTION;case 2:return Pi.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+e)}}function sRe(e,t){Bv===void 0&&(Bv=Pi.init_csg());let i=xte(e),r=Pi.csg_calc_topological(Bv,i,e.length,bte(t));Pi._free(i);let n=6,s=Pi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=Pi.HEAPU32[s[o]>>2],c=new Float32Array(Pi.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=Pi.HEAPU32[s[o]>>2],h=new Uint32Array(Pi.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=Pi.HEAPU32[s[o]>>2],p=new Uint8Array(Pi.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Pi.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:p}}function aRe(e,t,i,r){Bv===void 0&&(Bv=Pi.init_csg());let n=xte(e),s=Pi.csg_calc(Bv,n,e.length,r,bte(t));Pi._free(n);let a=5,o=Pi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=Pi.HEAPU32[o[c]>>2],h=Pi.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Pi.HEAPU32[o[c]>>2],p=Pi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new _t(h,3)),i.setAttribute("normal",new _t(p,3));let v=Pi.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Xa),i.boundingSphere.center.set(v[0],v[1],v[2]),i.boundingSphere.radius=(v[3]**2+v[4]**2+v[5]**2)**.5,i.userData.parameters={width:v[3]*2,height:v[4]*2,depth:v[5]*2},Pi.free_mesh_data(s),f}function oRe(e,t,i){if(Pi===void 0)return-1;let r,n,s;if(t&&e.userData.positions!==void 0){let m=e.userData;s=m.verticesPerFace.length,r=m.positions,n=Array(m.verticesPerFace.reduce((g,y)=>g+y,0)+s);for(let g=0,y=0,x=0;g<m.verticesPerFace.length;g++){n[x++]=m.verticesPerFace[g];for(let _=0;_<m.verticesPerFace[g];_++)n[x++]=m.indices[y++]}}else({positions:r,faceIndices:n,nFaces:s}=nRe(e,t,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Pi._malloc(u),p=new Float32Array(Pi.HEAPF32.buffer,d,l),f=new Uint32Array(Pi.HEAPU32.buffer,d+h,c);p.set(r,0),f.set(n,0);let v=Pi.get_csg_mesh(d,a,d+h,o,s);return Pi._free(d),v}function lRe(e){return Pi.has_open_edges(e)}function cRe(e,t){Pi.transform_csg_mesh(e,t.elements)}function uRe(e){Pi.free_csg_mesh(e)}var hRe={ConeGeometry:p3e,CubeGeometry:f3e,CylinderGeometry:Xee,DodecahedronGeometry:g3e,EllipseGeometry:Qk,HelixGeometry:J3e,IcosahedronGeometry:$3e,LatheGeometry:eLe,NonParametricGeometry:oLe,PolygonGeometry:cte,PyramidGeometry:lLe,RectangleGeometry:Kk,SphereGeometry:hLe,PlaneGeometry:dLe,BackdropGeometry:pLe,StarGeometry:ute,TextFrameGeometry:mLe,TorusGeometry:gLe,TorusKnotGeometry:yLe,TriangleGeometry:xLe,PathGeometry:qLe,VectorGeometry:vm},zW=e=>hRe[e.type].create(e);function ag(e){return e!==null&&"booleanOp"in e}var wte=class extends Gk(gr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new lt}updateVisible(e){super.updateVisible(e),this.visible=!ag(this.parent)&&this.visible,ag(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Au.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),ag(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof wte&&(e.freeBooleanPointer(),ag(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&ag(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),ag(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},IS=new fn;function Jk(e,t=0,i=e.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),p=e.getY(h),f=e.getZ(h);d<s&&(s=d),p<a&&(a=p),f<o&&(o=f),d>l&&(l=d),p>c&&(c=p),f>u&&(u=f)}IS.min.set(s,a,o),IS.max.set(l,c,u),IS.getCenter(r),IS.getSize(n).multiplyScalar(.5)}var dRe=new Bt,pRe=new ah,_a=class extends wte{constructor(t,i){super(dRe,pRe),this.super_Entity(t,i)}updateState(t,i){this.updateState_Entity(t,i)}updateEntityBoxSize(t,i){let r=this.geometry.getAttribute("position");r!==void 0?Jk(r,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:r.count,t,i):super.updateEntityBoxSize(t,i)}},rd=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},rd.uuidContext===null)throw new Error("plz startContext");rd.uuidContext===rd.globalContext?this.uuid="_gid"+rd.uuidContext.nodeContextUuid++:this.uuid="_uid"+rd.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){this.uuidContext===null||this.uuidContext===rd.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,n,s){return""}generate(e,t,i,r,n){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}},Bn=rd;Bn.globalContext={nodeContextUuid:0},Bn.uuidContext=rd.globalContext;var BW=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},fRe=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},ka=new fRe,cr=class extends Bn{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let n=this.getUnique(e,t);n&&this.uuid===void 0&&(this.uuid=Mt.generateUUID()),i=e.getUUID(i??this.getUUID(),!n);let s=e.getNodeData(i),a=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(n)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,a)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,a,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,a,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,a,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,n){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),n,this.getLabel()).name}},qa=class extends cr{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}},ys=class extends qa{constructor(t=0,i){super("v2"),this.nodeType="Vector2",this.value=t instanceof ve?t:new ve(t,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,i,r,n,s,a){return t.format("vec2("+this.value.x+", "+this.value.y+")",n,i)}},Uo=class extends qa{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof k?e:new k(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},As=class extends Yt{constructor(e,t,i,r){super(e,t,i),this.isColorA=!0,this.a=r}setRGBA(e,t,i,r){super.setRGB(e,t,i),this.a=r}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e,t="srgb"){let i;if(e==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(e,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(e,t);break}}return super.setStyle(e,t)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},Cu=class extends qa{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof As?e:new As(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,n,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},mRe=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,kW=/[a-z_0-9]+/gi,wt=class extends cr{constructor(e,t,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=kW.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,p=h;if(this.keywords[h]||this.useKeywords&&d&&ka.containsKeyword(h)){let f=this.keywords[h];if(!f){let v=ka.getKeywordData(h);v.cache&&(f=e.keywords[h]),f=f||ka.getKeyword(h,e),v.cache&&(e.keywords[h]=f)}p=f.build(e)}h!==p&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+p+o.substring(u.index+h.length+a),a+=p.length-h.length),this.getIncludeByName(p)===void 0&&ka.contains(p)&&e.include(ka.get(p))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=mRe.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(kW);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},gRe=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,_te=class extends cr{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||_te.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,n){this.src=e||"";let s,a,o="",l=gRe.exec(e);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,n){return e.format(this.name,this.getType(e),t)}},Ki=_te;Ki.PI="PI",Ki.PI2="PI2",Ki.RECIPROCAL_PI="RECIPROCAL_PI",Ki.RECIPROCAL_PI2="RECIPROCAL_PI2",Ki.LOG2="LOG2",Ki.EPSILON="EPSILON";var vRe=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),yRe=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),Ste=class extends cr{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,n){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=vRe.exec(e);if(t){let i=t[2],r;for(;r=yRe.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},$k=class extends cr{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};ka.addKeyword("uv",function(){return new $k});ka.addKeyword("uv2",function(){return new $k(1)});var Hg=class extends cr{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Hg.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case jl:return["Linear"];case fi:return["sRGB"];default:return[]}}generate(e,t){var a;let i=this.input.build(e,"v4"),r=this.getType(e),n=Hg.Nodes[this.method],s=e.include(n);if(s===Hg.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((a=n.inputs)==null?void 0:a.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Hg.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Hg.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Tc=Hg;Tc.Nodes={LinearToLinear:new wt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new wt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new wt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Tc.LINEAR_TO_LINEAR="LinearToLinear",Tc.SRGB_TO_LINEAR="sRGBToLinear",Tc.LINEAR_TO_SRGB="LinearTosRGB";var br=class extends wt{constructor(e="",t,i,r,n){super(e,n,r,i,t),this.nodeType="Expression"}},Nu=class extends qa{constructor(e=new Fr,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new $k,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Tc(new br("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(e,l),e.removeContext(),e.format(a,l,t)}},Ct=class extends qa{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,n,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},UW=class extends cr{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,n){r=this.getType(e);let s=this.value,a=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return e.format(a,r,t)}},Mte=class extends cr{constructor(e,t,i=Mte.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),n=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+n+" )",i,t)}},Ia=Mte;Ia.ADD="+",Ia.SUB="-",Ia.MUL="*",Ia.DIV="/";var tr=class extends cr{constructor(e,t=tr.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case tr.MIX:case tr.CLAMP:case tr.REFRACT:case tr.SMOOTHSTEP:case tr.FACEFORWARD:return 3;case tr.MIN:case tr.MAX:case tr.MOD:case tr.STEP:case tr.REFLECT:case tr.DISTANCE:case tr.DOT:case tr.CROSS:case tr.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case tr.LENGTH:case tr.DISTANCE:case tr.DOT:return"f";case tr.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,n,s=this.a?e.getTypeLength(this.a.getType(e)):0,a=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case tr.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case tr.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case tr.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case tr.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case tr.MIN:case tr.MAX:case tr.MOD:i=this.a.build(e,l),r=this.b.build(e,a===1?"f":l);break;case tr.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,"f");break;case tr.MIX:i=this.a.build(e,l),r=this.b.build(e,l),n=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(n=this.c.build(e,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},di=tr;di.RAD="radians",di.DEG="degrees",di.EXP="exp",di.EXP2="exp2",di.LOG="log",di.LOG2="log2",di.SQRT="sqrt",di.INV_SQRT="inversesqrt",di.FLOOR="floor",di.CEIL="ceil",di.NORMALIZE="normalize",di.FRACT="fract",di.SATURATE="saturate",di.SIN="sin",di.COS="cos",di.TAN="tan",di.ASIN="asin",di.ACOS="acos",di.ARCTAN="atan",di.ABS="abs",di.SIGN="sign",di.LENGTH="length",di.NEGATE="negate",di.INVERT="invert",di.MIN="min",di.MAX="max",di.MOD="mod",di.STEP="step",di.REFLECT="reflect",di.DISTANCE="distance",di.DOT="dot",di.CROSS="cross",di.POW="pow",di.MIX="mix",di.CLAMP="clamp",di.REFRACT="refract",di.SMOOTHSTEP="smoothstep",di.FACEFORWARD="faceforward";var D1=class extends cr{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let n=new UW(D1.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Tc(new br("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Tc(new br("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Tc(new br("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Tc(new br("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new br(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new br(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new br(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new br(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let a=new br("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,n=new UW(D1.Nodes.roughnessToMip,[r]),s=new di(n,D1.Nodes.m0,D1.Nodes.cubeUV_maxMipLevel,di.CLAMP),a=new di(s,di.FLOOR),o=new di(s,di.FRACT),l=this.bilinearCubeUV(e,this.value,i,a),c=this.bilinearCubeUV(e,this.value,i,new Ia(a,new Ct(1).setReadonly(!0),Ia.ADD)),u=new di(l,c,o,di.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},GO=D1;GO.Nodes=function(){let e=new Ste(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Ki("float cubeUV_maxMipLevel 8.0",!0),i=new Ki("float cubeUV_minMipLevel 4.0",!0),r=new Ki("float cubeUV_maxTileSize 256.0",!0),n=new Ki("float cubeUV_minTileSize 16.0",!0),s=new wt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new wt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new wt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,a,t,i,r,n]);o.useKeywords=!1;let l=new Ki("float r0 1.0",!0),c=new Ki("float v0 0.339",!0),u=new Ki("float m0 -2.0",!0),h=new Ki("float r1 0.8",!0),d=new Ki("float v1 0.276",!0),p=new Ki("float m1 -1.0",!0),f=new Ki("float r4 0.4",!0),v=new Ki("float v4 0.046",!0),m=new Ki("float m4 2.0",!0),g=new Ki("float r5 0.305",!0),y=new Ki("float v5 0.016",!0),x=new Ki("float m5 3.0",!0),_=new Ki("float r6 0.21",!0),M=new Ki("float v6 0.0038",!0),S=new Ki("float m6 4.0",!0),E=[l,c,u,h,d,p,f,v,m,g,y,x,_,M,S],A=new wt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,E);return{bilinearCubeUV:o,roughnessToMip:A,m0:u,cubeUV_maxMipLevel:t}}();var Gg=class extends cr{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Gg.VIEW}getShared(){return this.scope===Gg.WORLD}build(e,t,i,r){let n=e.context[this.scope+"Normal"];return n?n.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,n){let s;switch(this.scope){case Gg.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Gg.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case Gg.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},Fa=Gg;Fa.LOCAL="local",Fa.WORLD="world",Fa.VIEW="view",Fa.NORMAL="normal";ka.addKeyword("viewNormal",function(){return new Fa(Fa.VIEW)});ka.addKeyword("localNormal",function(){return new Fa(Fa.NORMAL)});ka.addKeyword("worldNormal",function(){return new Fa(Fa.WORLD)});var Su=class extends cr{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??Su.LOCAL}getType(){switch(this.scope){case Su.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case Su.LOCAL:case Su.WORLD:return!1}return!0}generate(e,t,i,r,n){let s;switch(this.scope){case Su.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case Su.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case Su.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case Su.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},Nl=Su;Nl.LOCAL="local",Nl.WORLD="world",Nl.VIEW="view",Nl.PROJECTION="projection";ka.addKeyword("position",function(){return new Nl});ka.addKeyword("worldPosition",function(){return new Nl(Nl.WORLD)});ka.addKeyword("viewPosition",function(){return new Nl(Nl.VIEW)});var gc=class extends cr{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??gc.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case gc.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case gc.VECTOR:{let n=new Fa(Fa.VIEW),s=e.context.roughness,a=n.build(e,"v3"),o=new Nl(Nl.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case gc.CUBE:{let n=new gc(gc.VECTOR).build(e,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case gc.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new gc(gc.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},kv=gc;kv.CUBE="cube",kv.SPHERE="sphere",kv.VECTOR="vector";var xRe=class extends cr{constructor(e=new Nu,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new GO(this.value,t??new kv(kv.VECTOR),i),this.irradianceNode=new GO(this.value,new Fa(Fa.WORLD),new Ct(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},bRe=class extends qa{constructor(e=new ik,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new kv,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),n=this.bias?this.bias.build(e,"f"):void 0;n===void 0&&e.context.bias&&(n=e.context.bias.setTexture(this).build(e,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(a),this.colorSpace=this.colorSpace??new Tc(new br("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},wRe=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,_Re=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,SRe=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,MRe=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,ERe=`
layout(location = 1) out vec4 gVelocity;
`,ARe=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,FW=["x","y","z","w"],CRe=["float","vec2","vec3","vec4"],TRe={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},PRe={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},Ete=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let n="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(wRe),this.addFragmentParsCode(_Re),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(SRe),this.addFragmentFinalCode(MRe)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[e];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:t},a.push(o),a[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,n=e.length;r<n;++r){let s=e[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof Bn?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,n,s){if(t.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new BW({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new BW({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[e].push(l),a[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,n){return this.createUniform("vertex",e,t,i,r,n)}createFragmentUniform(e,t,i,r,n){return this.createUniform("fragment",e,t,i,r,n)}include(e,t,i){var s;let r;if(e=typeof e=="string"?ka.get(e):e,this.context.include===!1)return e.name;e instanceof wt?r=this.includes.functions:e instanceof Ki?r=this.includes.consts:e instanceof Ste&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(e){let a=n[e.name];if(a||(a=n[e.name]={node:e,deps:[]},n.push(a),a.src=e.build(this,"source")),e instanceof wt&&t&&n[t.name]&&n[t.name].deps.indexOf(e)===-1&&(n[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(a.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return CRe[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case Zf:case Qf:return new bRe(i);case Gb:return new xRe(new Nu(i));default:return new Nu(i)}else{if(i.isVector2)return new ys(i);if(i.isVector3)return new Uo(i);if(i.isVector4)return new Cu(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return TRe[e]||e}getFormatByType(e){return PRe[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return FW[e]}getIndexByElement(e){return FW.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=jl,t===jl&&this.context.gamma&&(t=fi),t}},$r=class extends qa{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof As?e:new As(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,n,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let a=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,n,s):e.isShader("vertex")?(a.vertex||(a.vertex=e.createVertexUniform(r,this,n,s,this.getLabel())),e.format(a.vertex.name,r,t)):(a.fragment||(a.fragment=e.createFragmentUniform(r,this,n,s,this.getLabel())),e.format(a.fragment.name,r,t))}generateReadonly(e,t,i,r,n,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},hr=class extends qa{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,n,s){return e.format(this.value.toString(),r,t)}},da=class extends qa{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Jp=class extends qa{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},eU=class extends qa{},DRe=class extends eU{constructor(e){super("v3"),this.image=e,this._value=new k}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},WO=class extends eU{constructor(e,t,i=1008,r=1006){super("t"),this.image=e,this.wrap=t,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},Ate=class extends qa{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Mn}generateReadonly(e,t,i,r,n,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},Xc=class extends qa{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new lt}generateReadonly(e,t,i,r,n,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function VW(e,t,i,r=0){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply(new Mn().makeRotation(r*Mt.DEG2RAD))}var LRe=class extends Ate{constructor(e,t,i=0){super(new Mn),this.repeat=e,this.offset=t,this.rotation=i,VW(this.value,e,t,i)}updateMatrix(){VW(this.value,this.repeat,this.offset,this.rotation)}},$p=class extends qa{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof li?new Array(e).fill(t):new Array(e).fill(new li(0))}},jW=class extends cr{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Cte=class extends cr{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Cte.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},XO=Cte;XO.Nodes=function(){return{customColor:new wt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var Tte=class extends cr{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(Tte.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Pte=Tte;Pte.Nodes=function(){return{customNormal:new wt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var L1=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(L1.Nodes.cylindrical);break;case 2:r=e.include(L1.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new wt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(L1.Nodes.triplanar);break;default:r=e.include(L1.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(e,"t")),n.push(this.textureSize.build(e,"v2")),n.push(this.crop.build(e,"f")),n.push(this.mat.build(e,"mat3")),n.push(this.size.build(e,"v2")),n.push(this.blending.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),n.push(s)}return e.format(r+"("+n.join(",")+")",this.getType(e),t)}},tU=L1;tU.Nodes=function(){let e=new wt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new wt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new wt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new wt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var R1=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new wt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[R1.Nodes.vectorLinearWorldSpaceDepth,R1.Nodes.vectorLinearObjectSpaceDepth,R1.Nodes.vectorSphericalObjectSpaceDepth,R1.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let n=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(n+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Dte=R1;Dte.Nodes=function(){let e=new wt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new wt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new wt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new wt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var RRe=class extends cr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new wt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),n=[];return n.push(this.color.build(e,"c")),n.push(this.bias.build(e,"f")),n.push(this.scale.build(e,"f")),n.push(this.intensity.build(e,"f")),n.push(this.factor.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Lte=class extends cr{constructor(e,t,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Lte.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Rte=Lte;Rte.Nodes=function(){return{gradient:new wt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var Ite=class extends cr{constructor(e,t,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(Ite.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),r.push(this.rotation.build(e,"f")),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Ote=Ite;Ote.Nodes=function(){return{matcap:new wt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var za=function(){let e=new wt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new wt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Ki("float F3 0.3333333"),t.keywords.G3=new Ki("float G3 0.1666667");let i=new wt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);i.keywords.F3=new Ki("float F3 0.3333333"),i.keywords.G3=new Ki("float G3 0.1666667");let r=new wt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[t]),n=new wt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new wt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new wt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new wt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new wt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new wt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new wt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new Ki("int NUM_OCTAVES 5");let h=new wt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new wt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),p=new wt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),f=new wt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),v=new wt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new wt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new wt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),y=new wt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),x=new wt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[p,f,v,m,g,y]);return{simplexFast:t,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:u,perlin:d,voronoi:x}}(),Nte=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m,g,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=p,this.highCut=f,this.lowCut=v,this.smoothness=m,this.seed=g,this.quality=y,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,n){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new wt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[za.simplexFast,za.simplexFractal,za.simplexAshima,za.fbm,za.perlin,za.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};Nte.numOctaves=5;var zte=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,v){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=v,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(zte.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+n.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},Bte=zte;Bte.Nodes=function(){let e=new wt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new wt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var Mu=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m,g){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=v,this.isMask=g,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new wt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new wt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new wt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,Mu.DrawFunctions.circle,Mu.DrawFunctions.ring,Mu.DrawFunctions.polygon,Mu.DrawFunctions.cross,Mu.DrawFunctions.diamond,Mu.DrawFunctions.checkerboard,Mu.DrawFunctions.line,Mu.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},kte=Mu;kte.DrawFunctions=function(){let e=new wt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new wt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new wt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new wt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),n=new wt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new wt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),a=new wt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new wt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new wt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new wt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}}();var Ute=class extends cr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Ute.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Fte=Ute;Fte.Nodes=function(){let e=new wt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[za.simplexFast]);return{rainbow:new wt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[e])}}();var Vte=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(Vte.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},jte=Vte;jte.Nodes=function(){let e=new wt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new wt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new wt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new wt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new wt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new wt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[za.simplexFast,e,i,n])}}();var IRe=function(){return{textureBicubic:new wt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function ORe(e,t){return e>=t?new ve(t/e,1):new ve(1,e/t)}var Hte=class extends cr{constructor(e,t,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Jt.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(Hte.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Gte=Hte;Gte.Nodes=function(){let e=new wt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new wt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new wt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new wt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[IRe.textureBicubic,i,e]),n=new wt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new wt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}}();var qO=(e=>(e.NOISE="noise",e.MAP="map",e))(qO||{}),Wte=class extends cr{constructor(e,t,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new hr(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(qO)[this.displacementTypeIndex.value]==="map"&&(this.mat=new Ate(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(qO)[this.displacementTypeIndex.value]){case"map":{i=e.include(Wte.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new wt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new wt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[za.simplexPrecise,za.simplexFractal,za.simplexAshima,za.fbm,za.perlin,za.voronoi]),l=new wt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Xte=Wte;Xte.Nodes=function(){let e=new wt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new wt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new wt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var Jt={normalRenderTarget:new Nu,normalRenderTargetDepth:new Nu,transmissionRenderTarget:new Nu,aspectRatio:new ys,transmissionSize:new ys(2048,2048),transmissionRenderTargetDepth:new Nu,aoRenderTarget:new Nu,aoEnabled:new da,pixelRatioNode:new Ct(1),resolution:new ys,penumbraSize:new Jp(5,.5),frameIndex:new hr(0),transmissionLod:new hr(2)};for(let e of Object.values(Jt))e.isRenderGlobal=!0;var qte={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.9.75/build/ui.wasm"},iU=class extends Bn{constructor(){super("basic"),this.nodeType="Basic",this.color=new $r(vo),this.shadingAlpha=new Ct(1),this.shadingBlend=new hr(0),this.previousModelViewMatrix=new Xc,this.previouseProjectionMatrix=new Xc}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({resolution:Jt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(P0.merge([xt.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),t=a.join(`
`)}return t}},NRe=class extends Bn{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new $r(vo),this.emissive=new $r(0),this.emissiveIntensity=new Ct(1),this.previousModelViewMatrix=new Xc,this.previouseProjectionMatrix=new Xc,this.shadingAlpha=new Ct(1),this.shadingBlend=new hr(0),this.occlusion=new da(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({resolution:Jt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(P0.merge([xt.fog,xt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Jt.penumbraSize}),e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({aoMap:Jt.aoRenderTarget}),e.mergeUniform({aoEnabled:Jt.aoEnabled}),this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},m0=function(){let e=new wt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new wt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),zRe=class extends Bn{constructor(){super("phong"),this.nodeType="Phong",this.color=new $r(vo),this.specular=new $r(1118481),this.shininess=new Ct(30),this.previousModelViewMatrix=new Xc,this.previouseProjectionMatrix=new Xc,this.shadingAlpha=new Ct(1),this.shadingBlend=new hr(0),this.occlusion=new da(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({resolution:Jt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(P0.merge([xt.fog,xt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Jt.penumbraSize}),e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({aoMap:Jt.aoRenderTarget}),e.mergeUniform({aoEnabled:Jt.aoEnabled}),this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(m0.dHdxy),e.include(m0.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${m}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},BRe=class extends Bn{constructor(){super("standard"),this.nodeType="Standard",this.color=new $r(vo),this.roughness=new Ct(.3),this.metalness=new Ct(0),this.reflectivity=new Ct(.5),this.previousModelViewMatrix=new Xc,this.previouseProjectionMatrix=new Xc,this.shadingAlpha=new Ct(1),this.shadingBlend=new hr(0),this.occlusion=new da(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({resolution:Jt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(P0.merge([xt.fog,xt.lights])),xt.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Jt.penumbraSize}),e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({aoMap:Jt.aoRenderTarget}),e.mergeUniform({aoEnabled:Jt.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let n=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),a=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(m0.dHdxy),e.include(m0.perturbNormalArb);let v=this.bumpMap.texture.flow(e,"t"),m=this.bumpMap.flow(e,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${v.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${v.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${v.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${v.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${y}
					`)}if(p.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let v=this.roughnessMap.texture.flow(e,"t"),m=this.roughnessMap.flow(e,"v3"),g="";this.roughnessMap.projection.value===4?g=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${v.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${v.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${v.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:g=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${v.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};

					const float roughnessScale = 1.0;

					${g}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");u&&p.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},kRe=class extends Bn{constructor(){super("toon"),this.nodeType="Toon",this.color=new $r(vo),this.specular=new $r(1118481),this.shininess=new Ct(30),this.previousModelViewMatrix=new Xc,this.previouseProjectionMatrix=new Xc,this.shadingAlpha=new Ct(1),this.shadingBlend=new hr(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({resolution:Jt.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(P0.merge([xt.fog,xt.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:Jt.penumbraSize}),e.mergeUniform({frameIndex:Jt.frameIndex}),e.mergeUniform({aoMap:Jt.aoRenderTarget}),e.mergeUniform({aoEnabled:Jt.aoEnabled}),this.color===void 0&&(this.color=new $r(vo)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),n=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),a=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(m0.dHdxy),e.include(m0.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",v="";this.bumpMap.projection.value===4?v=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${f});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${f});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${f});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:v=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${f});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${v}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},URe=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},FRe=class extends URe{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},y3;function VRe(e){return typeof e=="string"?e:(y3||(y3=new FRe),y3.load(e))}var jRe=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},HRe=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},Yte=class extends jRe{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isBuffer=e.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{var a;r=(a=s.target)==null?void 0:a.result,n(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=VRe(e),this.img.onload=t,await new Promise(r=>{this.img.onload=()=>{t(),r(null)}})}getTexture(e,t=1008,i=1006){var n,s;let r=(s=(n=this._cache[e])==null?void 0:n[t])==null?void 0:s[i];if(r)return r;{let a;return this.isBuffer?a=this.img.texture:this.isVideo?a=new obe(this.img,void 0,e,e):a=new Fr(this.img,void 0,e,e,i,t),this.loaded&&(a.needsUpdate=!0),this._cache[e]===void 0&&(this._cache[e]={}),this._cache[e][t]===void 0&&(this._cache[e][t]={}),this._cache[e][t][i]=a,a}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))for(let r of Object.values(i))r&&(r.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))for(let[n,s]of Object.entries(r))s==null||s.dispose(),this._cache[e]!==void 0&&this._cache[e][i]!==void 0&&(this._cache[e][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},dd=class extends Yte{};function GRe(e,t){var i=YRe(t);return i.formatToParts?XRe(i,e):qRe(i,e)}var WRe={year:0,month:1,day:2,hour:3,minute:4,second:5};function XRe(e,t){try{for(var i=e.formatToParts(t),r=[],n=0;n<i.length;n++){var s=WRe[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function qRe(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var x3={};function YRe(e){if(!x3[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";x3[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return x3[e]}function Zte(e,t,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,n,s,a),o}var HW=36e5,ZRe=6e4,b3={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Qte(e,t,i){var r,n;if(!e||(r=b3.timezoneZ.exec(e),r))return 0;var s;if(r=b3.timezoneHH.exec(e),r)return s=parseInt(r[1],10),GW(s)?-(s*HW):NaN;if(r=b3.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return GW(s,a)?(n=Math.abs(s)*HW+a*ZRe,s>0?-n:n):NaN}if(JRe(e)){t=new Date(t||Date.now());var o=i?t:QRe(t),l=YO(o,e),c=i?l:KRe(t,l,e);return-c}return NaN}function QRe(e){return Zte(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function YO(e,t){var i=GRe(e,t),r=Zte(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=e.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function KRe(e,t,i){var r=e.getTime(),n=r-t,s=YO(new Date(n),i);if(t===s)return t;n-=s-t;var a=YO(new Date(n),i);return s===a?s:Math.max(s,a)}function GW(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var WW={};function JRe(e){if(WW[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),WW[e]=!0,!0}catch{return!1}}var $Re=ap(Zme(),1),XW=ap(Qme(),1),eIe=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,tIe=eIe,w3=36e5,qW=6e4,iIe=2,pa={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:tIe};function rIe(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i={},r=i.additionalDigits==null?iIe:(0,$Re.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var n=nIe(e),s=sIe(n.date,r),a=s.year,o=s.restDateString,l=aIe(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=oIe(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=Qte(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,XW.default)(new Date(c+u)),h=(0,XW.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function nIe(e){var t={},i=pa.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=pa.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var n=pa.timeZone.exec(r);n?(t.time=r.replace(n[1],""),t.timeZone=n[1].trim()):t.time=r}return t}function sIe(e,t){var i=pa.YYY[t],r=pa.YYYYY[t],n;if(n=pa.YYYY.exec(e)||r.exec(e),n){var s=n[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(n=pa.YY.exec(e)||i.exec(e),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:e.slice(a.length)}}return{year:null}}function aIe(e,t){if(t===null)return null;var i,r,n,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=pa.MM.exec(e),i)return r=new Date(0),n=parseInt(i[1],10)-1,ZW(t,n)?(r.setUTCFullYear(t,n),r):new Date(NaN);if(i=pa.DDD.exec(e),i){r=new Date(0);var a=parseInt(i[1],10);return uIe(t,a)?(r.setUTCFullYear(t,0,a),r):new Date(NaN)}if(i=pa.MMDD.exec(e),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return ZW(t,n,o)?(r.setUTCFullYear(t,n,o),r):new Date(NaN)}if(i=pa.Www.exec(e),i)return s=parseInt(i[1],10)-1,QW(t,s)?YW(t,s):new Date(NaN);if(i=pa.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return QW(t,s,l)?YW(t,s,l):new Date(NaN)}return null}function oIe(e){var t,i,r;if(t=pa.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),_3(i)?i%24*w3:NaN;if(t=pa.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),_3(i,r)?i%24*w3+r*qW:NaN;if(t=pa.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return _3(i,r,n)?i%24*w3+r*qW+n*1e3:NaN}return null}function YW(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var n=r.getUTCDay()||7,s=t*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var lIe=[31,28,31,30,31,30,31,31,30,31,30,31],cIe=[31,29,31,30,31,30,31,31,30,31,30,31];function Kte(e){return e%400===0||e%4===0&&e%100!==0}function ZW(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=Kte(e);if(r&&i>cIe[t]||!r&&i>lIe[t])return!1}return!0}function uIe(e,t){if(t<1)return!1;var i=Kte(e);return!(i&&t>366||!i&&t>365)}function QW(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function _3(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function hIe(e,t,i){var r=rIe(e,i),n=Qte(t,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function va(e,t){return t.color(e)}function KW(e=new Date,t){let i=t.format,r=e.getSeconds(),n=e;t&&t.timeZone!==null&&(n=hIe(new Date,t.timeZone));let s=n.getHours(),a=n.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function dIe(e,t){switch(e.type){case"fresnel":return mIe(e,t);case"gradient":return gIe(e,t);case"depth":return vIe(e,t);case"normal":return yIe(e,t);case"noise":return xIe(e,t);case"rainbow":return bIe(e,t);case"toon":return wIe(e,t);case"outline":return _Ie(e,t);case"transmission":return SIe(e,t);case"color":return fIe(e,t);case"pattern":return MIe(e,t)}}function pIe(e){return{type:e.type}}function ql(e,t){let{alpha:i,mode:r,isMask:n}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...pIe(e),alpha:s,mode:r,isMask:n}}function fIe(e,t){return{...ql(e,t),color:va(e.color,t)}}function mIe(e,t){let{bias:i,scale:r,intensity:n,factor:s,color:a}=e;return{...ql(e,t),color:va(a,t),bias:i,scale:r,intensity:n,factor:s}}function gIe(e,t){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=e;return{...ql(e,t),gradientType:i,smooth:r,colors:n.map(c=>new li(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new ve(...o),morph:new ve(...l),angle:a}}function vIe(e,t){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...ql(e,t),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new k(...o),direction:l?new k(...l):new k(1,0,0),colors:c.map(d=>d!==void 0?new li(d[0],d[1],d[2],d[3]):new li(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function yIe(e,t){let{cnormal:i}=e;return{...ql(e,t),cnormal:new k(i[0],i[1],i[2])}}function xIe(e,t){return{...ql(e,t),scale:e.scale,move:e.move,fA:new ve(...e.fA),fB:new ve(...e.fB),size:new k(...e.size),distortion:new ve(...e.distortion),colorA:va(e.colorA,t),colorB:va(e.colorB,t),colorC:va(e.colorC,t),colorD:va(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function bIe(e,t){return{...ql(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new k(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new k(...e.offset)}}function wIe(e,t){return{...ql(e,t),positioning:e.positioning,colors:e.colors.map(i=>new li(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new k(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:va(e.shadowColor,t),offset:new k(...e.offset)}}function _Ie(e,t){return{...ql(e,t),outlineColor:va(e.outlineColor,t),contourColor:va(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new k(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function SIe(e,t){return{...ql(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function MIe(e,t){return{...ql(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new ve(...e.offset),colorA:va(e.colorA,t),colorB:va(e.colorB,t),frequency:new ve(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new ve(...e.vertical),horizontal:new ve(...e.horizontal),sides:e.sides}}var pC=class extends As{},EIe={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},AIe={depth:["colors"]};function CIe(e,t,i){var s,a;if(t==="isMask")return!0;let r=EIe[e.type],n=AIe[e.type];if(n!==void 0){let o=e.color;if(n.includes(t)){let l=(a=(s=o[t])==null?void 0:s.value)==null?void 0:a.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function Jte(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=e;if("image"in s){let a=s.image,o=t.image(a),l=r;l.image instanceof dd||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=t.video(a),l=r;l.image instanceof dd||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Mt.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function TIe(e,t,i,r){let n=!1;for(let[s,a]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if(eie(s,i,r,t)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof eU))switch(n=n||CIe(i,s,a),o.constructor){case $r:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof pC?o.value=new As(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Cu:if(typeof a=="string"){let l=t.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof pC?o.value=new As(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case ys:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case Uo:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Nu:{Jte(a,t,i);break}case $p:{o.value=a.map(l=>new li(...l));break}default:{o.value=a;break}}}return n}var tm=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,ew=class{constructor(e,t,i,r,n){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)eie(s,this,i,n)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return xc.createLightLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new WO(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new DRe(n),o=new LRe(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Ct(i.crop?1:0),c=new hr(i.projection??0),u=new hr(["x","y","z"].indexOf(i.axis)??0),h=new hr(i.side??0),d=new ys(i.size?new ve(i.size[0],i.size[1]):new ve(100,100)),p=new Ct(i.blending??0),f=new Ct(tm(i.alpha,r)),v=new hr(i.mode??0),m=new da(i.isMask??!1),g=new tU(s,a,l,c,u,h,d,p,o,f,v,m),y=new br(g.calpha,"f");return new qr(e,t,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:p,mat:o,alpha:f,mode:v,isMask:m},g,v,y,m,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new WO(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Ct(tm(i.alpha,r)),o=new hr(i.mode??0),l=new da(i.isMask??!1),c=new Ct((i.texture.rotation??0)*Mt.DEG2RAD),u=new Ote(s,a,o,l,c),h=new br(u.calpha,"f");return new qr(e,t,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new Uo(new k(...i.offset)),s=new Ct(i.scale??10),a=new Ct(i.intensity??8),o=new Ct(i.movement??1),l=new hr(i.noiseType??0),c=new hr(i.voronoiStyle??0),u=new Ct(i.smoothness??.5),h=new Ct(i.seed??0),d=new Ct(i.highCut??1),p=new Ct(i.lowCut??0),f=new hr(i.quality??1),v=new Xte(a,o,n,c,u,h,d,p,f,s,l);return new $te(e,t,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:p,quality:f},v,r)}else throw new Error;else return LIe(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):TIe(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?Jte(r.props,i.shared,this):!0;return!1}dispose(){if(PIe(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof dd||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},qr=class extends ew{constructor(e,t,i,r,n,s,a,o,l){super(e,t,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},$te=class extends ew{constructor(e,t,i,r,n,s){super(e,t,i,r,s),this.position=n}},xc=class extends ew{constructor(e,t,i,r,n,s){super(e,t,i,n,s),this.node=r}static createLightLayer(e,t,i,r){let n,s=new Ct(tm(i.alpha,r)),a=new hr(i.mode),o=new Ct(i.bumpMapIntensity),l=new Ct(tm(i.alphaOverride,r)),c;if(!i.visible)n=new iU,c={};else if(i.category==="lambert"){n=new NRe;let u=new $r(r.color(i.emissive)??0),h=new da(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new kRe;let u=new Ct(i.shininess??30),h=new $r(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new BRe;let u=new Ct(i.roughness??.3),h=new Ct(i.metalness??0),d=new Ct(i.reflectivity??.5),p=new da(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:p},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=p}else{n=new zRe;let u=new Ct(i.shininess??30),h=new $r(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new da(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new Ct(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new xc(e,t,i,n,c,r)}get category(){return this.node.category}};function PIe(e){let t=e instanceof ew?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function Ro(e){return{alpha:new Ct(e.alpha??1),mode:new hr(e.mode??0),isMask:new da(e.isMask??!1)}}function DIe(e,t,i,r,n){switch(e.type){case"color":{let s=new $r(r.color??vo),a=Ro(r),o=new XO(s,a.alpha),l=new br(o.calpha,"f");return new qr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new $r(r.color??16777215),a=new Ct(r.bias??.1),o=new Ct(r.scale??1),l=new Ct(r.intensity??2),c=new Ct(r.factor??1),u=Ro(r),h=new RRe(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new br(h.calpha,"f");return new qr(t,i,e,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new Ct(r.filmThickness??30),a=new Ct(r.movement??0),o=new Uo(r.wavelengths??new k(0,0,0)),l=new Ct(r.noiseStrength??0),c=new Ct(r.noiseScale??1),u=new Uo(r.offset??new k(0,0,0)),h=Ro(r),d=new Fte(s,a,o,l,c,u,h.alpha,h.isMask),p=new br(d.calpha,"f");return new qr(t,i,e,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,p,h.isMask,n)}case"transmission":{let s=new Ct(r.thickness??10),a=new Ct(r.ior??1.5),o=new Ct(r.roughness??.5),l=Jt.transmissionSize,c=Jt.transmissionRenderTarget,u=Jt.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new ys(d/h,1):new ys(1,h/d),f=Ro(r),v=new Gte(s,a,o,l,c,u,p,f.alpha),m=new br(v.calpha,"f");return new qr(t,i,e,{thickness:s,ior:a,roughness:o,aspectRatio:p,...f},v,f.mode,m,f.isMask,n)}case"toon":{let s=new hr(r.positioning??0),a;r.colors?a=new $p(r.colors.length,r.colors):(a=new $p(10,new li(0,0,0,1)),a.value[1]=new li(1,1,1,1));let o;r.steps?o=new Jp(r.steps.length,r.steps):(o=new Jp(10,1),o.value[0]=0);let l=new Uo(r.source??new k(0,0,0)),c=new da(r.isWorldSpace??!0),u=new Ct(r.noiseStrength??0),h=new Ct(r.noiseScale??1),d=new Cu(r.shadowColor),p=new Uo(r.offset??new k(0,0,0)),f=Ro(r),v=new jte(s,a,o,l,c,u,h,d,p,f.alpha),m=new br(v.calpha,"f");return new qr(t,i,e,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:p,...f},v,f.mode,m,f.isMask,n)}case"outline":{let s=new $r(r.outlineColor??16777215),a=new $r(r.contourColor??16777215),o=new Ct(r.outlineWidth??.1),l=new Ct(r.contourWidth??.1),c=new Ct(r.outlineThreshold??.1),u=new Ct(r.contourThreshold??.1),h=new Ct(r.outlineSmoothing??.1),d=new Ct(r.contourFrequency??.1),p=new Uo(r.contourDirection??new k(0,1,0)),f=new da(r.positionalLines??!1),v=new da(r.compensation??!0),m=Jt.normalRenderTarget,g=Jt.normalRenderTargetDepth,y=Jt.pixelRatioNode,x=Jt.resolution,_=Ro(r),M=new Bte(s,a,o,l,c,u,h,d,p,f,v,x,m,g,y,_.alpha),S=new br(M.calpha,"f");return new qr(t,i,e,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:v,..._},M,_.mode,S,_.isMask,n)}case"depth":{let s=new hr(r.gradientType??0),a=new da(r.smooth??!1),o=new Ct(r.near??50),l=new Ct(r.far??200),c=new Ct(r.isVector??1),u=new Ct(r.isWorldSpace??0),h=new Uo(r.origin??new k),d=new Uo(r.direction??new k),p;r.colors?p=new $p(r.colors.length,r.colors):(p=new $p(2,new li(0,0,0,1)),p.value[1]=new li(1,1,1,1));let f;r.steps?f=new Jp(r.steps.length,r.steps):(f=new Jp(2,1),f.value[0]=0);let v=Ro(r),m=new Dte(s,a,o,l,c,u,h,d,p,f,v.alpha,v.isMask),g=new br(m.calpha,"f");return new qr(t,i,e,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:p,steps:f,...v},m,v.mode,g,v.isMask,n)}case"noise":{let s=new Ct(r.scale??1),a=new Uo(r.size??new k(100,100,100)),o=new Ct(r.move??1),l=new ys(r.fA??new ve(1.7,9.2)),c=new ys(r.fB??new ve(8.3,2.8)),u=new ys(r.distortion??new ve(1,1)),h=new Cu(r.colorA),d=new Cu(r.colorB),p=new Cu(r.colorC),f=new Cu(r.colorD),v=new hr(r.noiseType??0),m=new hr(r.voronoiStyle??0),g=new Ct(r.highCut??1),y=new Ct(r.lowCut??0),x=new Ct(r.smoothness??.5),_=new Ct(r.seed??.5),M=new hr(r.quality??1),S=Ro(r),E=new Nte(s,a,o,l,c,u,h,d,p,f,S.alpha,v,S.isMask,m,g,y,x,_,M),A=new br(E.calpha,"f");return new qr(t,i,e,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:p,colorD:f,noiseType:v,...S,voronoiStyle:m,highCut:g,lowCut:y,smoothness:x,seed:_,quality:M},E,S.mode,A,S.isMask,n)}case"normal":{let s=new Uo(r.cnormal??new k(1,1,1)),a=Ro(r),o=new Pte(s,a.alpha),l=new br(o.calpha,"f");return new qr(t,i,e,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new hr(r.gradientType??0),a=new da(r.smooth??!1),o;r.colors?o=new $p(r.colors.length,r.colors):(o=new $p(10,new li(0,0,0,1)),o.value[1]=new li(1,1,1,1));let l;r.steps?l=new Jp(r.steps.length,r.steps):(l=new Jp(10,1),l.value[0]=0);let c=new ys(r.offset??new ve(0,0)),u=new ys(r.morph??new ve(0,0)),h=new Ct(r.angle??0),d=Ro(r),p=new Rte(s,a,o,l,c,u,h,d.alpha,d.isMask),f=new br(p.calpha,"f");return new qr(t,i,e,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},p,d.mode,f,d.isMask,n)}case"pattern":{let s=new hr(r.style??0),a=new hr(r.projection??0),o=new hr(["x","y","z"].indexOf(r.axis)??0),l=new Ct(r.blending??0),c=new ys(r.offset??new ve(0,0)),u=new Cu(r.colorA),h=new Cu(r.colorB),d=new ys(r.frequency??new ve(10,10)),p=new Ct(r.size??.5),f=new Ct(r.variation??0),v=new Ct(r.smoothness??.5),m=new Ct(r.zigzag??0),g=new Ct(r.rotation??0),y=new ys(r.vertical??new ve(0,1)),x=new ys(r.horizontal??new ve(0,1)),_=new hr(r.sides??6),M=Ro(r),S=new kte(s,a,o,l,c,u,h,d,p,f,v,m,g,y,x,_,M.alpha,M.isMask),E=new br(S.calpha,"f");return new qr(t,i,e,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:p,variation:f,smoothness:v,zigzag:m,rotation:g,vertical:y,horizontal:x,sides:_,...M},S,M.mode,E,M.isMask,n)}default:{let s=new $r(1,0,0,1),a=Ro(r),o=new XO(s,a.alpha),l=new br(o.calpha,"f");return new qr(t,i,e,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function LIe(e,t,i,r){let n=dIe(i,r);return DIe(i,e,t,n,r)}function eie(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let n=t.uniforms[`f${t.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let n=t.uniforms[`f${t.id}_alpha`];if(!n)return;if(n.value=tm(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function gv(e,t){let i=0,r=e.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(t.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of e.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=t.color(n.data.colorA).a,o=t.color(n.data.colorB).a,l=t.color(n.data.colorC).a,c=t.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var Kd=class extends Oi{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},RIe=class extends Kd{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,Object.assign(this.defines,e.defines),Object.assign(this.uniforms,e.uniforms),this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i,r){return this.root.getFlavor(e,t,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},rU=class extends Kd{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=t.shared.needsJitter,Bn.startContext(this),this.reset0(e,t),Bn.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i,r){let n=i?6:(e?3:0)+t;if(n+=(((r==null?void 0:r.resolutionLevel)??0)-(r!=null&&r.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new RIe(e,t,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=e,s.side=t,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){Bn.startContext(this),(this.data!==e||i)&&this.reset0(e,t),Bn.endContext(this)}reset0(e,t){this.data=e;let i=e.layers??as.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>ew.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=gv(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=gv(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],n=e[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s!=null&&s.hasValue(n)&&(n==="alpha"?(this.transparent=gv(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(n,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.lightLayer=this.layers.find(t=>t instanceof xc),this.lightLayer===void 0&&(this.lightLayer=new xc(0,"",{...ts.defaultData("light","phong"),visible:!1},new iU,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find(n=>n instanceof xc);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof qr&&s.color instanceof tU&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(Bn.startContext(this),t!==void 0?this.data=t:t=this.data,this.transparent=gv(t,i.shared),e.path[0]==="layers"){let r=i.shared,n=e.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=t.layers.data(n),o;e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:tm(e.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...e.props,alphaOverride:tm(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},a,i)&&this.reset0(t,i)}}}else this.reset0(t,i);Bn.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof qr?t.color.mask=void 0:t instanceof xc&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof qr&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof xc?r.node.mask=new Ia(t.color,t.alpha,Ia.MUL):r instanceof qr&&(r.isMask.value||(r.color.mask=new Ia(t.color,t.alpha,Ia.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof qr),t=this.layers.findIndex(i=>i instanceof xc);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let n=this.layers[r];if(n instanceof qr){if(n.isMask.value)continue;i=new jW(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new br("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof xc);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof qr){if(r.isMask.value)continue;e=new jW(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof $te);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ia(t,e[i].position,Ia.ADD),t=new Ia(t,new Ct(.5).setReadonly(!0),Ia.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.shapeBlendhack&&this.shapeBlendhack(this),e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new Ete;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof qr){let t=e.params.texture;if(t instanceof WO&&!t.image.loaded)return!1}return!0}};Object.defineProperties(Kd.prototype,{properties:{get:function(){return this.fragment.properties}}});var ZO=class extends rU{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},JW=new Map;function IIe(e){if(typeof e=="string")return e;let t=JW.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},JW.set(e,t)),t.url}var tie,OIe=new Promise(e=>{tie=e}),$W=!1,OS;function NIe(){if($W)return;if(OS)return OS;async function e(){await sp(()=>import("./howler-CilAgKbb.js").then(t=>t.h),[]),tie(window!==void 0?window:global),$W=!0}return OS=e(),OS}var iie;OIe.then(e=>iie=e);function zIe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events===void 0||Array.isArray(r.events)===!1)return!0;let n=[];r.events.forEach(s=>{"dragDropActions"in s.data?(n.push(...s.data.dragDropActions.drag),n.push(...s.data.dragDropActions.drop)):"inActions"in s.data?(n.push(...s.data.inActions),n.push(...s.data.outActions)):"gameActions"in s.data?(n.push(...s.data.gameActions.idle),n.push(...s.data.gameActions.move),n.push(...s.data.gameActions.jump),n.push(...s.data.gameActions.run)):"breakpoints"in s.data?s.data.breakpoints.forEach(a=>{n.push(...a.data.actions)}):"actions"in s.data&&n.push(...s.data.actions),t=t||n.some(a=>a.data.type==="Audio")})}),t}var I1=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof e=="string"?n={src:e}:n={src:IIe(e),format:"wav"},this.sound=new iie.Howl(n),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},BIe=class{constructor(){this.type="ShapePath",this.color=new Yt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new CA,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var n;return(n=this.currentPath)==null||n.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,n,s){var a;return(a=this.currentPath)==null||a.bezierCurveTo(e,t,i,r,n,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,v,m){let g=p.x,y=f.x,x=v.x,_=m.x,M=p.y,S=f.y,E=v.y,A=m.y,P=(_-x)*(M-E)-(A-E)*(g-x),C=(y-g)*(M-E)-(S-M)*(g-x),D=(A-E)*(y-g)-(_-x)*(S-M),N=P/D,U=C/D;if(D===0&&P!==0||N<=0||N>=1||U<0||U>1)return null;if(P===0&&D===0){for(let I=0;I<2;I++)if(r(I===0?v:m,p,f),t.loc===e.ORIGIN){let G=I===0?v:m;return{x:G.x,y:G.y,t:t.t}}else if(t.loc===e.BETWEEN){let G=+(g+t.t*(y-g)).toPrecision(10),Q=+(M+t.t*(S-M)).toPrecision(10);return{x:G,y:Q,t:t.t}}return null}else{for(let Q=0;Q<2;Q++)if(r(Q===0?v:m,p,f),t.loc===e.ORIGIN){let Y=Q===0?v:m;return{x:Y.x,y:Y.y,t:t.t}}let I=+(g+N*(y-g)).toPrecision(10),G=+(M+N*(S-M)).toPrecision(10);return{x:I,y:G,t:N}}}function r(p,f,v){let m=v.x-f.x,g=v.y-f.y,y=p.x-f.x,x=p.y-f.y,_=m*x-y*g;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===v.x&&p.y===v.y){t.loc=e.DESTINATION,t.t=1;return}if(_<-Number.EPSILON){t.loc=e.LEFT;return}if(_>Number.EPSILON){t.loc=e.RIGHT;return}if(m*y<0||g*x<0){t.loc=e.BEHIND;return}if(Math.sqrt(m*m+g*g)<Math.sqrt(y*y+x*x)){t.loc=e.BEYOND;return}let M;m!==0?M=y/m:M=x/g,t.loc=e.BETWEEN,t.t=M}function n(p,f){let v=[],m=[];for(let g=1;g<p.length;g++){let y=p[g-1],x=p[g];for(let _=1;_<f.length;_++){let M=f[_-1],S=f[_],E=i(y,x,M,S);E!==null&&v.find(A=>A.t<=E.t+Number.EPSILON&&A.t>=E.t-Number.EPSILON)===void 0&&(v.push(E),m.push(new ve(E.x,E.y)))}}return m}function s(p,f,v){let m=new ve;f.getCenter(m);let g=[];return v.forEach(y=>{y.boundingBox.containsPoint(m)&&n(p,y.points).forEach(x=>{g.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),g.sort((y,x)=>y.point.x-x.point.x),g}function a(p,f,v,m,g){(g==null||g==="")&&(g="nonzero");let y=new ve;p.boundingBox.getCenter(y);let x=[new ve(v,y.y),new ve(m,y.y)],_=s(x,p.boundingBox,f);_.sort((C,D)=>C.point.x-D.point.x);let M=[],S=[];_.forEach(C=>{C.identifier===p.identifier?M.push(C):S.push(C)});let E=M[0].point.x,A=[],P=0;for(;P<S.length&&S[P].point.x<E;)A.length>0&&A[A.length-1]===S[P].identifier?A.pop():A.push(S[P].identifier),P++;if(A.push(p.identifier),g==="evenodd"){let C=A.length%2===0,D=A[A.length-2];return{identifier:p.identifier,isHole:C,for:D}}else if(g==="nonzero"){let C=!0,D=null,N=null;for(let U=0;U<A.length;U++){let I=A[U];f[I]&&(C?(N=f[I].isCW,C=!1,D=I):N!==f[I].isCW&&(N=f[I].isCW,C=!0))}return{identifier:p.identifier,isHole:C,for:D}}else console.warn('fill-rule: "'+g+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let f=p.getPoints(),v=-999999999,m=999999999,g=-999999999,y=999999999;for(let x=0;x<f.length;x++){let _=f[x];_.y>v&&(v=_.y),_.y<m&&(m=_.y),_.x>g&&(g=_.x),_.x<y&&(y=_.x)}c<=g&&(c=g+1),l>=y&&(l=y-1),f.length&&u.push({curves:p.curves,points:f,isCW:s$.isClockWise(f),identifier:o++,boundingBox:new fk(new ve(y,m),new ve(g,v))})});let h=u.map(p=>{var f;return a(p,u,l,c,(f=this.userData)==null?void 0:f.style.fillRule)}),d=[];return u.forEach(p=>{let f=h[p.identifier];if(f&&!f.isHole){let v=new TA;v.curves=p.curves,h.filter(m=>(m==null?void 0:m.isHole)&&m.for===p.identifier).forEach(m=>{if(m){let g=u[m.identifier],y=new CA;y.curves=g.curves,v.holes.push(y)}}),d.push(v)}}),d}},rie=!1,nie,e8=new Promise(e=>{nie=e}),t8=!1,NS;function kIe(){if(rie=!0,t8)return;if(NS)return NS;async function e(){let t=await sp(()=>import("./opentype-D6jUvuOk.js"),[]);nie(t),t8=!0}return NS=e(),NS}var UIe=class{async load(e,t,i=()=>{}){let{load:r}=await e8;r(e,(n,s)=>{n||!s?i(n??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await e8;try{let r=t(e),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function FIe(e){return await(await fetch(e)).arrayBuffer()}var VIe=new UIe;async function i8(e){let t,i,r=!1;if(e.url?(t=await FIe(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(rie){let n=await VIe.parse(t);if(n)return{font:n.font,url:i,intercepted:r,arr:t,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function jIe(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var HIe=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=i8(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=i8(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if(jIe(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,p="",f=[h.state.glyphIndex],v=[],m=!1;for(;!m;)a++,p=t.charAt(a),d+=p,f.push(e.charToGlyphIndex(p)),v=e.stringToGlyphs(d),v.length===1&&v[0].index===c&&(m=!0),a>t.length&&(m=!0);s.push({char:u,index:c,replacements:f,replacementChars:Array.from(d)}),a++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,n=t.fontSize*t.lineHeight,s=e.map(g=>this.getTextWidth(g,t)),a=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],a,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(n,e.length,t.height,r,t.verticalAlign),d=[],p=e.map(g=>[]),f=e.map(g=>[]),v;for(let g=0;g<e.length;g++){let y=e[g],x={features:{liga:!0}},_=[];try{_=i.stringToGlyphs(y,x)}catch(S){console.warn(S)}u=this.getLineInitialOffsetX(s[g],a,t.horizontalAlign,y,o);let M=[];try{M=this.reverseLigaturesTable(i,y,_)}catch(S){console.warn(S)}c=this.computeSpaceWidthForLine(e,g,t);for(let S=0;S<_.length;S++){let E=_[S],A=E.index===0?`
`:E.unicode?String.fromCharCode(E.unicode):void 0,P=M[S],C=0,D=0;S===0&&t.horizontalAlign===2&&E.leftSideBearing!==void 0&&(D=-E.leftSideBearing*r),v&&(C=i.getKerningValue(E,v)*r),u+=D+C;let N=0;if(A===`
`)N=l;else if(A===" ")N=c;else{let U=this.createPath(E,r,u,h,t);U&&(N=U.offsetX-(C+D),d.push(U.path))}if(P.replacements.length===1)f[g].push([u,h]),p[g].push(N);else{let U=P.replacements.map(Y=>(i.glyphs.get(Y).advanceWidth??0)*r),I=U.reduce((Y,O)=>Y+=O,0),G=U.map(Y=>Y/I),Q=u;for(let Y=0;Y<G.length;Y++){let O=N*G[Y];f[g].push([Q,h]),p[g].push(O),Q+=O}}u+=N,v=E}h-=n}let m=[];for(let g=0,y=d.length;g<y;g++)m.push(...d[g].toShapes());return{shapes:m,charWidths:p,lineWidths:s,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=n),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,n){let s=t*e,a=Math.abs(this.ascender-this.descender)*r,o=e-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,n){var l;let s=e.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let a=new BIe,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=a.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":a.moveTo(c.x,-c.y);break;case"L":a.lineTo(c.x,-c.y);break;case"Q":a.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":a.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return a.subPaths.forEach(c=>{let u=GIe(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+n.fontSize*n.letterSpacing,path:a}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),n=e[t];if(n){let s=this.countSpaces(n.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let a=i.width,o=this.getTextWidth(n,i);return(a-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function GIe(e){if(e.length){let t=e[0];if(t instanceof Ul)return t.v1;if(t instanceof Ol||t instanceof Zd)return t.v0}}var WIe=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},r8=class extends WIe{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=ab(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},XIe={markNeedsUpdateRendererDirty:()=>{}},SE=1e3,n8=512*SE;function qIe(e,t){let i=typeof e;return!!((t==="string"||t==="number")&&i===t||t==="boolean"&&(e==="true"||e==="false"||e===!0||e===!1)||t==="image"&&i==="string"&&e.startsWith("http"))}var YIe="https://hooks.spline.design",ZIe=`${YIe}/events?hashFile=`,QIe=class{constructor(t,i){this.id=t,this.userWebhook=i,this.result=void 0,this._connected=!1,this.emitter=LT(),this.reconnectWaitFor=SE,this._onError=r=>{var n,s,a;(n=this.eventSource)==null||n.removeEventListener("message",this._onMessage),(s=this.eventSource)==null||s.removeEventListener("error",this._onError),(a=this.eventSource)==null||a.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=r=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=SE,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=SE,this._connected=!1},this._onMessage=r=>{let n=r.data,s;try{s=JSON.parse(n)}catch(a){console.error("Error parsing webhook message",a)}if(s){let a=!1;this.userWebhook.parametersSchemas.forEach(({data:o})=>{s[o.name]!==void 0&&qIe(s[o.name],o.type)&&(this.result===void 0&&(this.result={}),this.result[o.name]=s[o.name],a=!0)}),a&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(ZIe+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){var t,i,r,n;(t=this.eventSource)==null||t.removeEventListener("message",this._onMessage),(i=this.eventSource)==null||i.removeEventListener("error",this._onError),(r=this.eventSource)==null||r.removeEventListener("open",this._onConnected),(n=this.eventSource)==null||n.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>n8&&(this.reconnectWaitFor=n8),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(t){this.userWebhook=t}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(t,i){this.emitter.on(t,i)}off(t,i){this.emitter.off(t,i)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(t=>t.data.name)}getParameterValue(t){var i;if(this.getParametersKeys().includes(t)){if(this.result)return(i=this.result)==null?void 0:i[t];for(let r of this.userWebhook.parametersSchemas)if(r.data.name===t)return _O.defaultParameterValueByType(r.data.type)}}},s8=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],KIe=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Ud=[],nU=[];for(let e=1;e<=8;e++)for(let t=0;t<s8.length;t++){let i=s8[t];Ud.push(i/Math.pow(2,8-e)),nU.push(KIe[t]+e)}var fC=[32,2e3],a8=Ud.filter((e,t)=>Ud[t]>fC[0]&&Ud[t]<fC[1]),JIe=nU.filter((e,t)=>Ud[t]>fC[0]&&Ud[t]<fC[1]),$Ie=class{static getFrequencies(e,t,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(i));let a=t/2,o=1/i.length*a,l,c,u;if(r==="music"||r==="voice"){let d=r==="voice"?a8:Ud,p=Array(d.length).fill(n);for(let f=0;f<i.length;f++){let v=f*o,m=i[f];for(let g=d.length-1;g>=0;g--)if(v>d[g]){p[g]=Math.max(p[g],m);break}}l=p,c=r==="voice"?a8:Ud,u=r==="voice"?JIe:nU}else l=Array.from(i),c=l.map((d,p)=>o*p),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}},eOe="gpt-4o-realtime-preview-2024-12-17",tOe=()=>"https://relayserver.spline.design/";async function iOe(e){try{return(await(await fetch(tOe()+"session?uuidfile="+e)).json()).token}catch(t){console.error("Token generation error:",t)}}var rOe=class{constructor(e){this.value=0,this.frequencies=new Float32Array(0);let t=new AudioContext;this.source=t.createMediaStreamSource(e),this.analyser=t.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(e=-100,t=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return $Ie.getFrequencies(this.analyser,44100,void 0,"voice",e,t)}update(){let e=this.getFrequencies(),t=e.values.reduce((i,r)=>i+r,0)/e.values.length;this.value=t,this.frequencies=e.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},o8=class{constructor(e,t,i){this.data=e,this.id=t,this.shared=i,this.emitter=LT(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{var s;let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&((s=n.response)==null?void 0:s.output)){for(let a of n.response.output)if(a.type==="function_call")for(let[o,l]of this.tools)a.name===o.name&&(l(JSON.parse(a.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(e){this.data=e}setColorByName(e,t){let i=this.shared.getColorByName(e);if(i){let{id:r}=i,{r:n,g:s,b:a}=TLe.hexStringToRgb(t)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let e=await iOe(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new rOe(s)};let t=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(t.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${eOe}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(e){this.events=[e,...this.events]}sendClientEvent(e){this.dc?(e.event_id=e.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(e)),this.appendEvent(e)):console.error("Failed to send message - no data channel available",e)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let e=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${e}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let t=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${t}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(e,t){this.tools.push([e,t])}disconnect(){var e,t,i,r,n,s;cancelAnimationFrame(this.rafId),(e=this.analyser)==null||e.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,(t=this.dc)==null||t.removeEventListener("message",this.onMessage),(i=this.dc)==null||i.removeEventListener("open",this.onOpen),(r=this.dc)==null||r.close(),(n=this.pc)==null||n.getSenders().forEach(a=>{a.track&&a.track.stop()}),(s=this.pc)==null||s.close(),this.pc=void 0}computeAnalysisForListenerEvent(e){if(e.analysis==="range"){let t=this.frequencies.slice(...e.analysisRange);return t.reduce((i,r)=>i+r,0)/t.length}return e.analysis==="single"?this.frequencies[e.analysisSingle]:this.voice}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}};function QO(e){return"variable_"+e}var nOe=class extends HRe{constructor(e){super(),this.shared=e}create(e){return new Yte(e,this.shared)}},sU=class{constructor(e,t={},i=!0,r=!1){if(this.data=e,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new r8(!0),this.geometryCache2=new r8(!1),this.imageHolderCache=new nOe(this),this.thisContext={scene:XIe,shared:this},this.deletedMaterial=new ZO(as.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new dd(MO.emptyImage,this),this.deletedVideo=new dd(ZA.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[n,s]of Object.entries(t.images))this.addImage(n,s);if(t.videos)for(let[n,s]of Object.entries(t.videos))this.addVideo(n,s);if(t.audios)for(let[n,s]of Object.entries(t.audios))this.addAudio(n,s);if(t.particles)for(let[n,s]of Object.entries(t.particles))this.addParticle(n,s);this.reset(e)}setRequestRender(e){this._requestRender=e}getImageLoadPromises(){return Object.values(this.images).map(e=>e.loadPromise)}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.data=e,this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.userAPIs))this.addUserAPI(i,r);for(let[i,r]of Object.entries(e.userWebhooks))this.addUserWebhook(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new ZO(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new rU(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new dd(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addUIBuffer(e,t){return this.uiBuffers[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[e].updateSrc(t),!0):(this.uiBuffers[e]=new dd(t,this),!1)}uiBuffer(e){return this.uiBuffers[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new dd(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new pC(t.r,t.g,t.b,t.a):this.colors[e]=new pC(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}getColorNames(){return Object.values(this.data.colors).map(e=>e.name)}getColorByName(e){for(let t in this.data.colors)if(this.data.colors[t].name===e)return{color:this.colors[t],id:t}}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new As(0,0,0,0))}else return"a"in e?new As(e.r,e.g,e.b,e.a):new As(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof I1)return t;{let i=new I1({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof I1&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new HIe(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof I1&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){if(this.variables[e]===void 0){let i=t.value;if(this.enableLocalStorageForPersistentVariables&&t.persistent){let r=localStorage.getItem(QO(e));i=r!==null?JSON.parse(r):t.value}return this.variables[e]={value:i,locations:[],persistent:t.persistent},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0}return this.variables[e].value=t.value,!1}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t,this.enableLocalStorageForPersistentVariables&&this.variables[e].persistent&&localStorage.setItem(QO(e),JSON.stringify(t));let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[e].locations.length-1;n>=0;n--){let s=this.variables[e].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[e].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Mt.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Di.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,n;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let a=1;a<e.length;a++)s=s[e[a]];return e[1]==="rotation"&&(s*=Mt.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let a=this.variables[s],o=(n=a.locations)==null?void 0:n.findIndex(l=>Un.equal(l,t));o!==void 0&&o!==-1&&a.locations.splice(o,1)}if(typeof e=="string"){let s=e,a=e;do{if(a=s,this.variables[s]===void 0)break;let o=this.variables[s].value;t&&this.variables[a]!==void 0&&this.variables[a].locations.push(t),s=o}while(typeof s=="string");return s}else return e}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(e=>e.data.name)}getVariableByName(e){for(let t of this.data.variables)if(t.data.name===e)return{variable:t.data,id:t.id}}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){var r;if(this.data=t,e.path[0]==="images")e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id);else if(e.path[0]==="videos")e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id);else if(e.path[0]==="audios")e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id);else if(e.path[0]==="particles")e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id);else if(e.path[0]==="colors")e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id);else if(e.path[0]==="materials")e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(ss.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i});else if(e.path[0]==="fonts")e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id);else if(e.path[0]==="variables")e.path.length===2&&e.type===0?"value"in e.props?this.updateVariable(e.path[1],e.props.value):"persistent"in e.props&&(this.variables[e.path[1]].persistent=e.props.persistent):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id);else if(e.path[0]==="userAPIs"){if(e.path.length===1&&e.type===1)this.addUserAPI(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserAPI(e.id);else if(typeof e.path[1]=="string"){let n=t.userAPIs[e.path[1]];if(n){let s=e.type===0&&e.props.debounce===void 0,a=this.getUserAPI(e.path[1]);a instanceof o8?a.update(n):a==null||a.update(n,this,s)}}}else if(e.path[0]==="userWebhooks"){if(e.path.length===1&&e.type===1)this.addUserWebhook(e.id,e.data);else if(e.path.length===1&&e.type===2)this.deleteUserWebhook(e.id);else if(typeof e.path[1]=="string"){let n=t.userWebhooks[e.path[1]];n&&((r=this.getUserWebhook(e.path[1]))==null||r.update(n))}}else e.path[0]==="lib"&&this.updateLibByOp(ss.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),n={...this.data.fonts[e],url:t.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}addUserAPI(e,t){var i,r;return this.userAPIs[e]?(this.userAPIs[e].update(t,this),!0):((i=this.openAIRealtime)==null?void 0:i.id)===e?(this.openAIRealtime.update(t),!0):((r=t.integration)==null?void 0:r.type)==="VoiceAssistant"?(this.openAIRealtime=new o8(t,e,this),!1):(this.userAPIs[e]=new hte(e,t,this),!1)}getUserAPI(e){var t;return((t=this.openAIRealtime)==null?void 0:t.id)===e?this.openAIRealtime:this.userAPIs[e]}getUserAPIs(){return this.userAPIs}deleteUserAPI(e){let t=this.userAPIs[e];t&&(t.dispose(),delete this.userAPIs[e])}addUserWebhook(e,t){return this.userWebhooks[e]?(this.userWebhooks[e].update(t),!0):(this.userWebhooks[e]=new QIe(e,t),!1)}getUserWebhook(e){return this.userWebhooks[e]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(e){let t=this.userWebhooks[e];t&&(t.dispose(),delete this.userWebhooks[e])}get scene(){return this.entityOpContext.scene}};new sU(jo.emptyData());var j0=class extends _a{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),gPe(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(e.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(dr(e.path,["material"])&&this.material instanceof Kd)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(ss.drop(e,1),t.material,i);else if(dr(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let n=t.materials[r];typeof n!="string"&&this.material[r].updateByOp(ss.drop(e,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var n,s;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;if(this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),((n=e.geometry)==null?void 0:n.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe,r),t.scene.markNeedsUpdateRendererDirty()),(((s=e.geometry)==null?void 0:s.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(a=>t.shared.material(a).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&tee(this.material).forEach(e=>{e instanceof Kd&&(e instanceof ZO||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},l8=new k,c8=new li,u8=new li,sOe=new k,h8=new lt,En=class extends j0{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new lt().fromArray(t.bindMatrix),this.bindMatrixInverse=new lt)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Bt&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof sU){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return JA.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return JA.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),dr(e.path,["geometry"])&&this.updateByPatchedOpGeometry(ss.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let n=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...n};this.localGeometry=ab(c,t,this.data.flatShading,this)}let s,a,o;n.scaleBaked?[s,a,o]=n.scaleBaked:{width:s,height:a,depth:o}=n;let l=this.localGeometry.userData;l.sxPrev!==void 0&&HO(this.localGeometry.attributes,s/l.sxPrev,a/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=a,l.szPrev=o}else{let n={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=ab(n,t,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let e of this.attachedSurfaceCloners)e.update()}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof ha&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((n=i.scene)==null||n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t);let i=e.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,t.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(e,t)}updateMorphInfluences(e,t){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[e];i!==void 0&&(this.morphTargetInfluences[i]=t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?e.fromArray(i.centerOffset):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new li,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;c8.fromBufferAttribute(r.attributes.skinIndex,e),u8.fromBufferAttribute(r.attributes.skinWeight,e),l8.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let n=0;n<4;n++){let s=u8.getComponent(n);if(s!==0){let a=c8.getComponent(n);h8.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(sOe.copy(l8).applyMatrix4(h8),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function aOe(e){var a,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new k(n[l],n[l+1],n[l+2]);t.has(c)?(a=t.get(c))==null||a.normals.push(u):t.set(c,{normals:[u],result:new k})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new _t(s,3))}function oOe(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new k;for(let n=0;n<t.length;n+=3)r.set(t[n],t[n+1],t[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;e.geometry.setAttribute("extrudeNormal",new _t(i,3))}function aU(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof Kd)||e.material.getLayersOfType("outline").length===0)return;e instanceof En&&e.is2DAndNoDepth?oOe(e):aOe(e)}function oU(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),n=[Mt.seededRandom(r),Mt.seededRandom(r+1e4),Mt.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=n[s%3];e.geometry.setAttribute("randomColor",new Zt(i,3))}var cc=new fn,Hy=new k;function lOe(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var ob=class extends En{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new lt,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,a,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=ha.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&((a=this.originalGeometry)==null||a.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,aU(this),oU(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){ha.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&ha.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=ha.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=ha.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,_a.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Xa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;cc.setFromBufferAttribute(t),cc.getCenter(i),e.boundingSphere.radius=i.distanceTo(cc.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),cc.getSize(Hy),this.hasNonUniformScale&&Hy.divide(this.scale);let r={width:Hy.x,height:Hy.y,depth:Hy.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;cc.min.set(e[0],e[2],e[4]),cc.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(cc.min.applyMatrix4(this.shearScaleInv),cc.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Xa);let i=t.boundingSphere.center;cc.getCenter(i),t.boundingSphere.radius=i.distanceTo(cc.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(ha.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},d8=-1,cOe=1,uOe={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},hOe={polygon_center:0,edge:1,vertex:2},zS=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,pi=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-d8)*(i-r)/(cOe-d8)+r},dOe=new k,BS=new k,pOe=new k,fOe=new k;function Uv(e,t){let i=pOe.fromArray(e),r=fOe.fromArray(t);BS.copy(r).sub(i);let n=BS.length();return BS.normalize().multiplyScalar(n*.5),dOe.copy(i).add(BS).toArray()}var Xo=new ws,kS=new k,mC=new k,lf=new k;function mOe(e){let t=[];for(let i=0;i<=e.index.count;i++)if(kS.fromArray(e.index.array,i*3),Xo.setFromAttributeAndIndices(e.attributes.position,kS.x,kS.y,kS.z),Xo.getNormal(mC),Xo.getMidpoint(lf),!(isNaN(lf.x)||isNaN(lf.y)||isNaN(lf.z))){let{a:r,b:n,c:s}=Xo,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=Uv(a,o),p=Uv(o,l),f=Uv(l,a),v=[c,u,h],m=Math.max(...v),g=v.filter(_=>Math.round(_)===Math.round(m)).length>1,y=[],x=Xo.getMidpoint(lf).toArray();m===c&&!g&&(y=[p,f,f],x=d),m===u&&!g&&(y=[d,f,f],x=p),m===h&&!g&&(y=[d,p,p],x=f),g&&(y=[d,p,f]),t.push({vertices:[a,o,l],faceCenters:y,midpoint:x,norm:Xo.getNormal(mC).toArray()})}return t}function gOe(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){Xo.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),Xo.getNormal(mC),Xo.getMidpoint(lf);let n=Xo.a.toArray(),s=Xo.b.toArray(),a=Xo.c.toArray();t.push({vertices:[n,s,a],faceCenters:[Uv(n,s),Uv(s,a),Uv(a,n)],midpoint:lf.toArray(),norm:mC.toArray()})}return t}var vOe=4,yOe=.5,S3=e=>.5*(1-Math.cos(e*Math.PI)),xOe=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let m=0;m<4096;m++)this.perlin[m]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),n=Math.floor(t),s=Math.floor(i),a=e-r,o=t-n,l=i-s,c,u,h=0,d=.5,p,f,v;for(let m=0;m<vOe;m++){let g=r+(n<<4)+(s<<8);c=S3(a),u=S3(o),p=this.perlin[g&4095],p+=c*(this.perlin[g+1&4095]-p),f=this.perlin[g+16&4095],f+=c*(this.perlin[g+16+1&4095]-f),p+=u*(f-p),g+=256,f=this.perlin[g&4095],f+=c*(this.perlin[g+1&4095]-f),v=this.perlin[g+16&4095],v+=c*(this.perlin[g+16+1&4095]-v),f+=u*(v-f),p+=S3(l)*(f-p),h+=p*d,d*=yOe,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},bOe=xOe,p8=new k,f8=new lt,m8=new T0;function g8(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(t=!0)}),t}var lU=class extends En{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(f8.copy(i).invert(),m8.copy(e.ray).applyMatrix4(f8),m8.intersectBox(this.singleBBox,p8))){let r=p8.applyMatrix4(i),n=e.ray.origin.distanceTo(r);t.push({distance:n,point:r.clone(),object:this})}}},sa=1e-4,uc,sie,aie,oie,v8=new k,y8=new k;gte.then(e=>{uc=e,sie=[uc.get_face_center,uc.get_edge_midpoint,uc.get_vertex_position],aie=[uc.get_face_normal,uc.get_edge_normal,uc.get_vertex_normal],oie=[uc.face_count,uc.edge_count,uc.vertex_count]});var wOe=new lt,_Oe=new lt,Nh=new k,US=new k,Gy=new k,M3=new k,SOe=new k,MOe=new k,EOe=class{constructor(e,t){this.data=e,this.is3D=t,this.perlin=new bOe,e.noiseType==="perlin"?(this.perlin.noiseSeed(e.seed),t?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):t?this.noise=$De((0,OO.default)(e.seed)):this.noise=JDe((0,OO.default)(e.seed))}},Qo=class extends Hk($i){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof Ms&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof Ms&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)t=0;else if(e===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,n=t-i.length;r<n;++r){let s=new Ms(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-t;r<n;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let n=new Ms(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[i])}}getRandom(e,t=!1){return(this.random===null||this.random.data.seed!==e.seed||this.random.is3D!==t)&&(this.random=new EOe(e,t)),this.random}_updateRadial(e){let t=e.radial,i=t.start*Mt.DEG2RAD,r=t.end*Mt.DEG2RAD,n=i-r,s=new kn(t.rotation[0],t.rotation[1],t.rotation[2]),a;switch(t.axis){case"z":a=new k(0,0,1);break;case"y":a=new k(0,1,0);break;default:case"x":a=new k(1,0,0);break}let o=e.randomnessObject??xd.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=zS(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,p=l.noise(d,d,d),f=u+1;h.scale.x=t.scale[0]+c(f,pi(p,o.scale[0]))||sa,h.scale.y=t.scale[1]+c(f,pi(p,o.scale[1]))||sa,h.scale.z=t.scale[2]+c(f,pi(p,o.scale[2]))||sa,h.position.setScalar(0);let v=n/e.count*u-i;switch(t.axis){case"x":h.rotation.set(0,v,0);break;case"y":h.rotation.set(0,0,v);break;case"z":h.rotation.set(v,0,0);break}h.translateOnAxis(a,t.radius),h.position.x+=t.position[0]+c(f,pi(p,o.position[0])),h.position.y+=t.position[1]+c(f,pi(p,o.position[1])),h.position.z+=t.position[2]+c(f,pi(p,o.position[2]));let m=c(f,pi(p,o.rotation[0])),g=c(f,pi(p,o.rotation[1])),y=c(f,pi(p,o.rotation[2]));t.alignment===!0?(h.rotation.x+=s.x+m,h.rotation.y+=s.y+g,h.rotation.z+=s.z+y):h.rotation.set(s.x+m,s.y+g,s.z+y)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new kn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??xd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=zS(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),u=a+1,h=s(u,pi(c,r.rotation[0])),d=s(u,pi(c,r.rotation[1])),p=s(u,pi(c,r.rotation[2]));o.scale.x=1+(t.scale[0]-1)*a+s(u,pi(c,r.scale[0]))||sa,o.scale.y=1+(t.scale[1]-1)*a+s(u,pi(c,r.scale[1]))||sa,o.scale.z=1+(t.scale[2]-1)*a+s(u,pi(c,r.scale[2]))||sa,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+p,o.position.x=t.position[0]*a+s(u,pi(c,r.position[0])),o.position.y=t.position[1]*a+s(u,pi(c,r.position[1])),o.position.z=t.position[2]*a+s(u,pi(c,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??xd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=zS(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new k(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement),d=this.children[t++];d.scale.x=1+s(t,pi(h,r.scale[0]))||sa,d.scale.y=1+s(t,pi(h,r.scale[1]))||sa,d.scale.z=1+s(t,pi(h,r.scale[2]))||sa;let p=s(t,pi(h,r.rotation[0])),f=s(t,pi(h,r.rotation[1])),v=s(t,pi(h,r.rotation[2]));d.rotation.set(p,f,v),d.position.x=i.size[0]*l-o.x+s(t,pi(h,r.position[0])),d.position.y=i.size[1]*c-o.y+s(t,pi(h,r.position[1])),d.position.z=i.size[2]*u-o.z+s(t,pi(h,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),u=this.children[t++];u.scale.x=1+s(t,pi(c,r.scale[0]))||sa,u.scale.y=1+s(t,pi(c,r.scale[1]))||sa,u.scale.z=1+s(t,pi(c,r.scale[2]))||sa;let h=s(t,pi(c,r.rotation[0])),d=s(t,pi(c,r.rotation[1])),p=s(t,pi(c,r.rotation[2]));u.rotation.set(h,d,p),u.position.x=i.size[0]*a+s(t,pi(c,r.position[0])),u.position.y=-i.size[1]*o+s(t,pi(c,r.position[1])),u.position.z=-i.size[2]*l+s(t,pi(c,r.position[2]))}}_updateToObject(e){var u;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new kn(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??xd.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=zS(r.strength,this.parameters.randomness);if(!t.object){for(let[,h]of this.children.entries())h.position.set(0,0,0),h.scale.setScalar(1),h.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof lU)if(!((u=this.objectForSample.font)!=null&&u.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let h=Math.round(a.length*t.count/100);this._updateCount(h)}else{let h=this.objectForSample.geometry.getAttribute("position");if(!h||isNaN(h.count)||h.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new e3e(this.objectForSample).build(),l=uOe[t.axis],c=this.children;o.setRandomGenerator((0,OO.default)(this.object.uuid+t.seed));for(let[h,d]of c.entries()){let p=h*(r.freqScale/10)+r.movement,f=n.noise(p,p,p),v=h+1,m=s(v,pi(f,r.rotation[0])),g=s(v,pi(f,r.rotation[1])),y=s(v,pi(f,r.rotation[2]));t.spreadType==="random"?o.sample(Gy,M3):(a.length&&(Gy.fromArray(a[h].pos),M3.fromArray(a[h].norm)),this.objectForSample instanceof ob&&Gy.applyMatrix4(wOe.copy(this.objectForSample.matrixWorld).invert())),Gy.applyMatrix4(this.object.hiddenMatrix.clone().invert()),d.position.copy(Gy),Nh.fromArray(l);let x=t.align==="normal"?M3:this.object.getWorldDirection(MOe),_=US.fromArray(t.position);US.x+=s(v,pi(f,r.position[0])),US.y+=s(v,pi(f,r.position[1])),US.z+=s(v,pi(f,r.position[2]));let M=Math.acos(x.dot(Nh)),S=SOe.crossVectors(Nh,x).normalize(),E=_Oe.makeRotationAxis(S,M),A=x.clone().cross(this.object.up).normalize(),P=A.clone().cross(x).normalize(),C=new lt().makeBasis(A,x,P),D=new k(Nh.y,Nh.z,Nh.x).normalize(),N=D.clone().cross(Nh).normalize(),U=new lt().makeBasis(D,Nh,N).invert(),I=new lt().multiplyMatrices(C,U);d.rotation.setFromRotationMatrix(I),_.applyMatrix4(E),d.position.add(_),d.rotation.x=d.rotation.x+i.x+m,d.rotation.y=d.rotation.y+i.y+g,d.rotation.z=d.rotation.z+i.z+y,d.scale.setScalar(1),d.scale.x=d.scale.x+t.scale[0]+s(v,pi(f,r.scale[0]))||sa,d.scale.y=d.scale.y+t.scale[1]+s(v,pi(f,r.scale[1]))||sa,d.scale.z=d.scale.z+t.scale[2]+s(v,pi(f,r.scale[2]))||sa,d.scale.multiply(this.object.scale),d.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType,t=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=t.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):t.set(a,{pos:[...n],norm:[...s],count:1})};if(e==="random")return[];if(this.objectForSample instanceof ob){let n=this.objectForSample,s=hOe[e],a=oie[s],o=sie[s],l=aie[s],c=a(n.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(n.subdivPointerNew,u),d=l(n.subdivPointerNew,u);v8.fromArray(h).applyMatrix4(n.matrixWorld),y8.fromArray(d),i(v8.toArray(),y8.toArray())}}else(this.objectForSample.geometry.index?mOe(this.objectForSample.geometry):gOe(this.objectForSample.geometry)).forEach((n,s)=>{e==="polygon_center"&&i(n.midpoint,n.norm),e==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),e==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(t.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(e,t){var i;if(this.parameters=ST(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof _a?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new lt,this.hiddenMatrix=new lt,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},tw=e=>{var t;return t=class extends e{},t.geometryHelper=new Hl(30,30,30),t},FS=new T0,E3=new Xa,x8=new lt,iw=(e,t,i,r,n=!1,s=e)=>{let a=t,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),E3.copy(a.boundingSphere),E3.applyMatrix4(o),i.ray.intersectsSphere(E3)===!1||(x8.copy(o).invert(),FS.copy(i.ray).applyMatrix4(x8),a.boundingBox!==null&&FS.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,p=a.attributes.position,f=a.drawRange,v,m;if(n===!1){let y=Math.max(0,f.start),x=Math.min(d.count,f.start+f.count);for(v=y,m=x;v<m;v+=3)if(c=d.getX(v),u=d.getX(v+1),h=d.getX(v+2),l=g(e,i,FS,p,c,u,h),l){l.faceIndex=Math.floor(v/3),r.push(l);return}}else{let y=a.attributes.position,x=new k,_=new k,M=new k,S=new k,E=2,A=1/((s.scale.x+s.scale.y+s.scale.z)/3),P=A*A,C=Math.max(0,f.start),D=Math.min(y.count,f.start+f.count);for(let N=C,U=D-1;N<U;N+=E){if(x.fromBufferAttribute(y,N),_.fromBufferAttribute(y,N+1),FS.distanceSqToSegment(x,_,S,M)>P)continue;S.applyMatrix4(s.matrixWorld);let I=i.ray.origin.distanceTo(S);I<i.near||I>i.far||r.push({distance:I,point:M.clone().applyMatrix4(s.matrixWorld),object:e})}}function g(y,x,_,M,S,E,A){let P=new k,C=new k,D=new k,N=new k,U=new k;if(P.fromBufferAttribute(M,S),C.fromBufferAttribute(M,E),D.fromBufferAttribute(M,A),_.intersectTriangle(P,C,D,!1,N)===null)return null;U.copy(N),U.applyMatrix4(y.matrixWorld);let I=x.ray.origin.distanceTo(U);return I<x.near||I>x.far?null:{faceIndex:1,distance:I,point:U.clone(),object:y}}},VS=new k,Io=new op,AOe=class extends Xb{constructor(e){let t=new Bt,i=new lp({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new Yt(15711266),o=new Yt(15711266),l=new Yt(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,p){u(h,p),u(d,p)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new _t(r,3)),t.setAttribute("color",new _t(n,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;Io.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;ml("n1",t,e,Io,-i,-r,n),ml("n2",t,e,Io,i,-r,n),ml("n3",t,e,Io,-i,r,n),ml("n4",t,e,Io,i,r,n);let s=n;ml("f1",t,e,Io,-i,-r,s),ml("f2",t,e,Io,i,-r,s),ml("f3",t,e,Io,-i,r,s),ml("f4",t,e,Io,i,r,s);let a=s,o=.5;ml("u1",t,e,Io,i*.7*o,r*1.1,a),ml("u2",t,e,Io,-i*.7*o,r*1.1,a),ml("u3",t,e,Io,0,r*(1.1+.9*o),a),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ml(e,t,i,r,n,s,a){VS.set(n,s,a).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],VS.x,VS.y,VS.z)}}var COe=class extends tw(AOe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){iw(this.object,this.geometry,e,t,!0)}},KO;(e=>e.is=t=>"objectHelper"in t)(KO||(KO={}));var H0=(e,t)=>class extends Gk(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof IA&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Hl?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof IA&&(r.visible=!1)}}},jS=790,og=new k,A3=new k,C3=new ni,T3=new k,Wy=new k,P3=new k,Ys=class extends H0(op,COe){constructor(e="",t={...$x.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=l0.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new lt,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new pT(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new Hs(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){e==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&(e==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){e==="PerspectiveCamera"?this.toPerspective():e==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(e){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){typeof e=="number"&&(e=new k(e,t,i)),super.lookAt(e),this.getWorldPosition(og),this.targetOffset=og.distanceTo(e)}getTarget(e=new k){return this.getWorldDirection(A3),this.getWorldPosition(og),A3.multiplyScalar(this.targetOffset),e.copy(og).add(A3),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(og),og.distanceTo(e)}updateUp(){this.getWorldQuaternion(C3),T3.set(0,0,1).applyQuaternion(C3),Wy.copy($i.DEFAULT_UP),this.isUpVectorFlipped&&Wy.negate(),Wy.applyQuaternion(C3),P3.copy($i.DEFAULT_UP).projectOnPlane(T3),this.angleOffsetFromUp=P3.angleTo(Wy),this.angleOffsetFromUp*=P3.cross(Wy).dot(T3)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new k),i=e.getWorldDirection(new k).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new k).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new k;return e.getWorldPosition(t),this.getViewToTarget(t)}setViewplaneSize(e,t,i=!1){if(this.aspect=e/t,i){let r=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-jS*.5*r,this.right=jS*.5*r,this.top=jS*.5*(1/n),this.bottom=-jS*.5*(1/n)}else this.left=-e*.5,this.right=e*.5,this.top=t*.5,this.bottom=-t*.5;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(e,t,i,r,n,s):this.orthoCamera.setViewOffset(e,t,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=e.view===null?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(e=[]){let t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return HI(t,e)}updateCameraSubtype(e,t){let i=e==="perspective"?"PerspectiveCamera":"OrthographicCamera";t.zoom!==void 0&&this.setZoom(i,t.zoom),t.near!==void 0&&this.setNear(i,t.near),t.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),e.far!==void 0&&(this.far=e.far),e.orthographic!==void 0&&this.updateCameraSubtype("orthographic",e.orthographic),e.perspective!==void 0&&this.updateCameraSubtype("perspective",e.perspective),e.type!==void 0&&(this.cameraType=e.type),e.up!==void 0&&this.up.fromArray(e.up),e.targetOffset!==void 0&&(this.targetOffset=e.targetOffset),e.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.type===0&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},lg=new lt,TOe=new lt;function b8(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var n;((n=r.geometry)==null?void 0:n.type)==="BooleanGeometry"&&(t=!0)}),t}var im=class extends j0{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Bt,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let n=0;n<this.children.length;n++){let s=this.children[n];s instanceof im&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let n=0;n<this.children.length;n++){let s=this.children[n];if(s instanceof _a&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){lg.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=Au.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;Au.transformMeshSet(s.booleanMeshSetAddress,lg),s.booleanMatrixInvOld.copy(lg).invert(),s.booleanWasTransformed=!1}else s instanceof im&&s.needsTransformForDownstream===!0?(Au.transformMeshSet(s.booleanMeshSetAddress,lg),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(Au.transformMeshSet(s.booleanMeshSetAddress,TOe.multiplyMatrices(lg,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(lg).invert(),s.booleanWasTransformed=!1)}catch(a){console.error(a),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}Au.hasOpenEdges(s.booleanMeshSetAddress)===!1||n===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new _t([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return Au.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Bt,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Au.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(n){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(n)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,aU(this),oU(this)}dispose(){super.dispose(),this.geometry.dispose()}},JO;(e=>{function t(i){return Di.is(i)&&i instanceof Zb}e.is=t})(JO||(JO={}));var cU=(e,t)=>class extends H0(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Ll=e=>e instanceof _a,Wu=e=>e!==null&&e instanceof im,POe=e=>e instanceof Ys,DOe=e=>JO.is(e),$O=e=>KO.is(e),LOe=new k(1,1,1),w8=new k,ROe=new k,_8=new ni,rw=class extends tw(ywe){constructor(e,t=15){super(t),this.object=e,this.dummy=new Hu,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){iw(this.object,rw.geometryHelper,e,t,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(e){this.object.matrixWorld.decompose(w8,_8,ROe),this.matrix.compose(w8,_8,LOe),super.updateMatrixWorld(e)}updateWorldMatrix(e,t){}},Fv=class extends H0(Hu,rw){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},rx=class extends H0(Hu,rw){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},lie={RED:0,GREEN:1,BLUE:2,ALPHA:3},nw="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",IOe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,HS=class extends Oi{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new rt(null),kernel16:new rt(null),inputBuffer:new rt(null),cocBuffer:new rt(null),texelSize:new rt(new ve),scale:new rt(1)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:IOe,vertexShader:nw}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(t[r++]=u,t[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new li(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)a.push(new li(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function S8(e,t,i){return e*(t-i)-t}function eN(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var OOe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,NOe=class extends Oi{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new rt(null),focusDistance:new rt(0),focusRange:new rt(0),cameraNear:new rt(.3),cameraFar:new rt(1e3)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:OOe,vertexShader:nw}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=mh){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-S8(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=eN(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-S8(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=eN(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Hs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},zOe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,BOe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",M8=class extends Oi{constructor(e=new ve){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new rt(null),texelSize:new rt(new ve),halfTexelSize:new rt(new ve),kernel:new rt(0),scale:new rt(1)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:zOe,vertexShader:BOe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},kOe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,UOe=class extends Oi{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new rt(null),opacity:new rt(1)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:kOe,vertexShader:nw}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},FOe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,VOe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,IT={DEPTH:0,LUMA:1,COLOR:2},jOe={DISABLED:0,DEPTH:1,CUSTOM:2},HOe=class extends Oi{constructor(e=new ve,t=IT.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:C0.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new rt(null),depthBuffer:new rt(null),predicationBuffer:new rt(null),texelSize:new rt(e)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:FOe,vertexShader:VOe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=mh){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},GOe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,WOe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",gl={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},tN=class extends Oi{constructor(e,t,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:C0.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new rt(null),depthBuffer:new rt(null),resolution:new rt(new ve),texelSize:new rt(new ve),cameraNear:new rt(.3),cameraFar:new rt(1e3),aspect:new rt(1),time:new rt(0)},blending:Tn,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=mh){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=GOe.replace(gl.FRAGMENT_HEAD,e.get(gl.FRAGMENT_HEAD)).replace(gl.FRAGMENT_MAIN_UV,e.get(gl.FRAGMENT_MAIN_UV)).replace(gl.FRAGMENT_MAIN_IMAGE,e.get(gl.FRAGMENT_MAIN_IMAGE)),this.vertexShader=WOe.replace(gl.VERTEX_HEAD,e.get(gl.VERTEX_HEAD)).replace(gl.VERTEX_MAIN_SUPPORT,e.get(gl.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Hs?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return gl}},XOe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,qOe=class extends Oi{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:C0.replace(/\D+/g,"")},uniforms:{inputBuffer:new rt(null),threshold:new rt(0),smoothing:new rt(1),range:new rt(null)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:XOe,vertexShader:nw}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},YOe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,cie={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},ZOe=class extends Oi{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new rt(e),inputBuffer:new rt(null),strength:new rt(1)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:YOe,vertexShader:nw}),this.toneMapped=!1,this.setColorChannel(lie.RED),this.setMaskFunction(cie.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==Js&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},QOe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,KOe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",JOe=class extends Oi{constructor(e=new ve,t=new ve){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new rt(null),searchTexture:new rt(null),areaTexture:new rt(null),resolution:new rt(t),texelSize:new rt(e)},blending:Tn,depthWrite:!1,depthTest:!1,fragmentShader:QOe,vertexShader:KOe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},$Oe=new op,zh=null;function eNe(){if(zh===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);zh=new Bt,zh.setAttribute!==void 0?(zh.setAttribute("position",new Zt(e,3)),zh.setAttribute("uv",new Zt(t,2))):(zh.addAttribute("position",new Zt(e,3)),zh.addAttribute("uv",new Zt(t,2)))}return zh}var Ea=class{constructor(e="Pass",t=new Wa,i=$Oe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new gr(eNe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Wa),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=mh){}render(e,t,i,r,n){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Wa||t===this.renderer)continue;this[e].dispose()}}}},iN=class extends Ea{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new UOe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Ii(1,1,{minFilter:gi,magFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,n){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Js?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===fi&&(this.renderTarget.texture.encoding=fi))}},tNe=class extends Ea{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,n){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},D3=new Yt,uU=class extends Ea{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=a>=0;l?(D3.copy(e.getClearColor(D3)),e.setClearColor(s,c?a:o)):c&&e.setClearAlpha(a),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(D3,o):c&&e.setClearAlpha(o)}},Bh=-1,Va=class extends Ts{constructor(e,t=Bh,i=Bh,r=1){super(),this.resizable=e,this.base=new ve(1,1),this.preferred=new ve(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==Bh?r=t.width:t.height!==Bh?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==Bh?r=t.height:t.width!==Bh?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(Bh),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return Bh}},L3=!1,E8=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case qs:i=this.materialsFlatShadedDoubleSide;break;case os:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case qs:i=this.materialsDoubleSide;break;case os:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=Vl;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=os,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=qs,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=os,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=qs,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,L3){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return L3}static set workaroundEnabled(e){L3=e}},iNe=class extends Ea{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new uU,this.overrideMaterialManager=i===null?null:new E8(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new E8(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,a):e.render(s,a),a.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},A8=class extends Ea{constructor(e,t,{resolutionScale:i=1,width:r=Va.AUTO_SIZE,height:n=Va.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new iNe(e,t,new YJ({depthPacking:IJ}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Yt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Ii(1,1,{minFilter:_i,magFilter:_i,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new Va(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},Bi={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},rNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",nNe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",sNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",aNe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",oNe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",lNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",cNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",uNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",hNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",dNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",pNe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",fNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",mNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",gNe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",vNe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",yNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",xNe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",bNe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",wNe=new Map([[Bi.SKIP,null],[Bi.ADD,rNe],[Bi.ALPHA,nNe],[Bi.AVERAGE,sNe],[Bi.COLOR_BURN,aNe],[Bi.COLOR_DODGE,oNe],[Bi.DARKEN,lNe],[Bi.DIFFERENCE,cNe],[Bi.EXCLUSION,uNe],[Bi.LIGHTEN,hNe],[Bi.MULTIPLY,dNe],[Bi.DIVIDE,pNe],[Bi.NEGATION,fNe],[Bi.NORMAL,mNe],[Bi.OVERLAY,gNe],[Bi.REFLECT,vNe],[Bi.SCREEN,yNe],[Bi.SOFT_LIGHT,xNe],[Bi.SUBTRACT,bNe]]),_Ne=class extends Ts{constructor(e,t=1){super(),this.f=e,this.opacity=new rt(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return wNe.get(this.blendFunction)}},kc={NONE:0,DEPTH:1,CONVOLUTION:2},Zc=class extends Ts{constructor(e,t,{attributes:i=kc.NONE,blendFunction:r=Bi.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new _Ne(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=mh){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t=="object"&&typeof t.dispose=="function"){if(t instanceof Wa||t===this.renderer)continue;this[e].dispose()}}}};function C8(e,t,i){for(let r of t){let n="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function SNe(e,t,i,r,n,s,a){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&a&kc.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,v=tN.Section;if(c){let g=`	${e}MainUv(UV);
`;i.set(v.FRAGMENT_MAIN_UV,i.get(v.FRAGMENT_MAIN_UV)+g),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let g=`	${e}MainSupport(`;g+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(v.VERTEX_MAIN_SUPPORT,i.get(v.VERTEX_MAIN_SUPPORT)+g),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(f)].map(y=>y[1]))}h=h.concat([...o.get("fragment").matchAll(f)].map(g=>g[1])),h=h.concat([...t.defines.keys()].map(g=>g.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((g,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),g)),t.defines.forEach((g,y)=>n.set(e+y.charAt(0).toUpperCase()+y.slice(1),g)),C8(e,h,n),C8(e,h,o);let m=t.blendMode;if(r.set(m.blendFunction,m),l){let g=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${e}MainImage(color0, UV, `;a&kc.DEPTH&&g.test(o.get("fragment"))&&(y+="depth, ",p=!0),y+=`color1);
	`;let x=e+"BlendOpacity";s.set(x,m.opacity),y+=`color0 = blend${m.blendFunction}(color0, color1, ${x});

	`,i.set(v.FRAGMENT_MAIN_IMAGE,i.get(v.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+y)}i.set(v.FRAGMENT_HEAD,i.get(v.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(v.VERTEX_HEAD,i.get(v.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:p}}var gC=class extends Ea{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new tN(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=tN.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Bi.SKIP)l|=d.getAttributes()&kc.DEPTH;else if(l&d.getAttributes()&kc.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+a++,f=SNe(p,d,t,i,r,n,l);if(o+=f.varyings.length,c=c||f.transformedUv,u=u||f.readDepth,d.extensions!==null)for(let v of d.extensions)s.add(v)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}l&kc.DEPTH?(u&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=mh){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,n){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},MNe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],hU=class extends Ea{constructor({resolutionScale:e=.5,width:t=Va.AUTO_SIZE,height:i=Va.AUTO_SIZE,kernelSize:r=OT.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Ii(1,1,{minFilter:gi,magFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new Va(this,t,i,e);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new M8,this.ditheredBlurMaterial=new M8,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=MNe[this.kernelSize],u=this.blurMaterial,h=t,d,p;for(this.fullscreenMaterial=u,d=0,p=c.length-1;d<p;++d){let f=d&1?l:o;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(f),e.render(s,a),h=f}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Js?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===fi&&(this.renderTargetA.texture.encoding=fi,this.renderTargetB.texture.encoding=fi))}static get AUTO_SIZE(){return Va.AUTO_SIZE}},ENe=class extends Ea{constructor({width:e=Va.AUTO_SIZE,height:t=Va.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new qOe(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Ii(1,1,{minFilter:gi,magFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new Va(this,e,t);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==Js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ANe=class extends Ea{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new uU(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,n){let s=e.getContext(),a=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},qo=class extends Ea{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,n){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==Js&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},R3=1/1e3,CNe=1e3,TNe=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*R3}getFixedDelta(){return this.fixedDelta*R3}setFixedDelta(e){return this.fixedDelta=e*CNe,this}getElapsed(){return this.elapsed*R3}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},OT={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},PNe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,DNe=class extends Zc{constructor({blendFunction:e=Bi.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=Va.AUTO_SIZE,height:a=Va.AUTO_SIZE,kernelSize:o=OT.LARGE}={}){super("BloomEffect",PNe,{blendFunction:e,uniforms:new Map([["map",new rt(null)],["intensity",new rt(n)]])}),this.renderTarget=new Ii(1,1,{minFilter:gi,magFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new ENe({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new hU({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===fi&&(this.renderTarget.texture.encoding=fi))}},LNe="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",RNe=class extends Zc{constructor({blendFunction:e=Bi.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",LNe,{blendFunction:e,uniforms:new Map([["brightness",new rt(t)],["contrast",new rt(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},INe="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",ONe=class extends Zc{constructor(e=Bi.NORMAL){super("ColorAverageEffect",INe,{blendFunction:e})}},NNe="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",zNe="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",BNe=class extends Zc{constructor({blendFunction:e=Bi.NORMAL,offset:t=new ve(.001,5e-4)}={}){super("ChromaticAberrationEffect",NNe,{vertexShader:zNe,blendFunction:e,attributes:kc.CONVOLUTION,uniforms:new Map([["offset",new rt(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},kNe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,UNe=class extends Zc{constructor(e,{blendFunction:t=Bi.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=Va.AUTO_SIZE,height:c=Va.AUTO_SIZE}={}){super("DepthOfFieldEffect",kNe,{blendFunction:t,attributes:kc.DEPTH,uniforms:new Map([["nearColorBuffer",new rt(null)],["farColorBuffer",new rt(null)],["nearCoCBuffer",new rt(null)],["scale",new rt(1)]])}),this.camera=e,this.renderTarget=new Ii(1,1,{minFilter:gi,magFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new qo(new NOe(e));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new hU({kernelSize:OT.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new qo(new ZOe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=cie.MULTIPLY,d.colorChannel=lie.GREEN,this.bokehNearBasePass=new qo(new HS(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new qo(new HS(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new qo(new HS(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new qo(new HS(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return eN(-i,t.near,t.far)}setDepthTexture(e,t=mh){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,n),this.blurPass.render(e,n,s),this.maskPass.render(e,t,a),this.bokehFarBasePass.render(e,a,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,Js),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===fi&&(this.renderTarget.texture.encoding=fi,this.renderTargetNear.texture.encoding=fi,this.renderTargetFar.texture.encoding=fi,this.renderTargetMasked.texture.encoding=fi))}};new k;new lt;var FNe="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",VNe=class extends Zc{constructor({blendFunction:e=Bi.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",FNe,{blendFunction:e,uniforms:new Map([["hue",new rt(new k)],["saturation",new rt(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new Yt;var jNe=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,HNe=class extends Zc{constructor({blendFunction:e=Bi.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",jNe,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},GNe="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",WNe=class extends Zc{constructor(e=30){super("PixelationEffect",GNe,{uniforms:new Map([["active",new rt(!1)],["d",new rt(new ve)]])}),this.resolution=new ve,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new k;new k;var T8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",P8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",XNe="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",qNe="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",cf={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},uie=class extends Zc{constructor({preset:e=cf.MEDIUM,edgeDetectionMode:t=IT.COLOR,predicationMode:i=jOe.DISABLED}={}){super("SMAAEffect",XNe,{vertexShader:qNe,blendFunction:Bi.NORMAL,attributes:kc.CONVOLUTION|kc.DEPTH,uniforms:new Map([["weightMap",new rt(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Ii(1,1,{minFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new uU(!0,!1,!1),this.clearPass.overrideClearColor=new Yt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new qo(new HOe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new qo(new JOe);let s=new p$;s.onLoad=()=>{let a=new Fr(r);a.name="SMAA.Search",a.magFilter=_i,a.minFilter=_i,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Fr(n);o.name="SMAA.Area",o.magFilter=gi,o.minFilter=gi,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=T8,n.src=P8),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case cf.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case cf.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case cf.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case cf.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=mh){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return T8}static get areaImageDataURL(){return P8}},YNe=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,GS={DEFAULT:0,ESKIL:1},ZNe=class extends Zc{constructor({blendFunction:e=Bi.NORMAL,technique:t=GS.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",YNe,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new rt(r)],["darkness",new rt(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===GS.ESKIL}set eskil(e){this.technique=e?GS.ESKIL:GS.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},gh=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Bi.NORMAL}},QNe=class extends gh{constructor(){super(DNe),this.blendFunction=Bi.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},KNe=class extends gh{constructor(){super(RNe)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},JNe=class extends gh{constructor(){super(BNe),this.effect.offset=new ve(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},$Ne=class extends gh{constructor(){super(ONe)}},eze=class extends gh{constructor(){super(VNe),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},tze=class extends gh{constructor(){super(HNe),this.blendFunction=Bi.OVERLAY}},ize=class extends gh{constructor(){super(ZNe)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},rze=class extends gh{constructor(e){super(UNe)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!e.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},nze=class extends gh{constructor(){super(WNe)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},sze=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,aze=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,oze=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,lze=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,rN=class extends Oi{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new rt(null)},blending:Tn,depthWrite:!1,depthTest:!1,vertexShader:oze,fragmentShader:lze})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},cze=class extends Ea{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new rN,this.resolutionVector=new ve,this.resolveMaterial=new Oi({name:"TAAResolveMaterial",uniforms:{inputBuffer:new rt(null),historyBuffer:new rt(null),velocityBuffer:new rt(null),depthBuffer:new rt(null),resolution:new rt(new ve)},blending:Tn,depthWrite:!1,depthTest:!1,vertexShader:sze,fragmentShader:aze}),this.historyRenderTarget=new Ii(1024,1024,{minFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Ii(1024,1024,{minFilter:gi,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},uze=class extends Ea{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new A8(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new rN,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new rN,this.depthPass=new A8(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,n=e;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},D8=new Wa,hze=new Oi({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),nN=class extends Ea{constructor(e,t,i){super("OpaquePass",t??D8,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=e??D8}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof _a&&(this.originalMaterials.push([r,r.material]),r.material=hze)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},dze=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new iN,this.depthTexture=null,this.timer=new TNe,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new ve),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,n=this.inputBuffer.texture[0].type;n===Js&&e.outputEncoding===fi&&(this.inputBuffer.texture[0].encoding=fi,this.outputBuffer.texture[0].encoding=fi,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,n)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new r0(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Kf,e.type=Of):e.type=Vu,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,n,s){let a=this.renderer,o=a===null?new ve:a.getDrawingBufferSize(new ve),l={minFilter:gi,magFilter:gi,wrapS:Cr,wrapT:Cr,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new Ii(o.width,o.height,l),c.samples=r):(n?(c=new FJ(o.width,o.height,2,l),c.texture[1].type=sh):c=new Ii(o.width,o.height,l),c.depthTexture=new r0(2048,2048),c.depthTexture.type=rr),i===Js&&a!==null&&a.outputEncoding===fi&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=fi):c.texture.encoding=fi),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new ve),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,a;if(e.MRTCompatible&&(a=this.inputBuffer.texture[0].type),e.MRTCompatible||(a=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(n.width,n.height),e.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;t.reduce(r,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,n,e,o):d.render(t,s,a,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,n,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof ANe?o=!0:d instanceof tNe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new ve);e=s.width,t=s.height}r.setSize(e,t,i);let n=r.getDrawingBufferSize(new ve);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},pze=new Oi({name:"CombineMaterial",uniforms:{inputBufferA:new rt(null),inputBufferB:new rt(null)},blending:Tn,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),fze=class extends Ea{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=pze,this.helperPass=new nN(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new nN(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new uie({preset:cf.LOW,edgeDetectionMode:IT.COLOR});this.effectPass=new gC(this.camera,t),this.rt=new Ii(10,10,{minFilter:gi,magFilter:gi,wrapS:Cr,wrapT:Cr,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},mze=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,gze=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,vze=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,yze=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,xze=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,bze=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Xy=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],wze=new Oi({vertexShader:mze,fragmentShader:gze}),cg=new Oi({vertexShader:xze,fragmentShader:bze,uniforms:{texture_ao_lrez:new rt(null),texture_depth_lrez:new rt(null),texture_depth_hrez:new rt(null),near:new rt(null),far:new rt(null)}}),_ze=class extends Ea{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Ii(i,r,{type:Jb?sh:rr,depthTexture:new r0(i,r),minFilter:gi,magFilter:gi}),this.depthBufferHighRes=new Ii(i,r,{depthTexture:new r0(i,r)}),this.aoBuffer=new Ii(i,r,{minFilter:gi,magFilter:gi}),this.splineScene=e,this.splineCamera=t;let n=new Float32Array(Xy.length*2);for(let a=0;a<Xy.length;a++){let o=a*2;n[o+0]=Xy[a][0],n[o+1]=Xy[a][1]}this.blueNoiseInDiskTexture=new ga(n,Xy.length,1,bA,rr),this.blueNoiseInDiskTexture.wrapS=Fu,this.blueNoiseInDiskTexture.wrapT=Fu,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Oi({vertexShader:vze,fragmentShader:yze,uniforms:{near:new rt(null),far:new rt(null),fov:new rt(null),proj_info:new rt(new li),is_ortho:new rt(!1),resolution:new rt(new ve),radius_of_influence:new rt(8),radius_in_screen_space:new rt(1),exponent:new rt(1),ao_color:new rt(new k),bias:new rt(.5),texture_depth:new rt(null),texture_normals:new rt(null),texture_blue_noise:new rt(null),texture_blue_noise_in_disk:new rt(this.blueNoiseInDiskTexture),frame_index:new rt(0),fog_enabled:new rt(!1),fog_near:new rt(1),fog_far:new rt(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Ii(i,r,{minFilter:gi,magFilter:gi,wrapS:Cr,wrapT:Cr,depthBuffer:!1,type:rr});let s=new uie({preset:cf.ULTRA,edgeDetectionMode:IT.COLOR});this.effectPass=new gC(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,n=t*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,cg.uniforms.texture_depth_hrez.value=e,cg.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=wze;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=cg,cg.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,cg.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,cg.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Sze=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Mze=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,Eze=class extends qo{constructor(){super(new Oi({vertexShader:Sze,fragmentShader:Mze,uniforms:{tInput:new rt(null),tMap:new rt(null),uResolution:new rt(new ve),uSize:new rt(new ve),uCoords:new rt(new ve),uScale:new rt(1),uSceneColor:new rt(new Yt(16711680)),uDPR:new rt(1),uCurrent:new rt(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},Aze=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Cze=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,Tze=[],Pze=class extends qo{constructor(){super(new Oi({vertexShader:Aze,fragmentShader:Cze,uniforms:{toScene:new rt(null),fromScene:new rt(null),uResolution:new rt(new ve),uDPR:new rt(1),mixRatio:new rt(0),threshold:new rt(.1),useTexture:new rt(0),tMixTexture:{value:Tze[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},Dze=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Lze=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,Rze=class extends qo{constructor(){super(new Oi({vertexShader:Dze,fragmentShader:Lze,uniforms:{inputBuffer:new rt(null),blurredInputBuffer:new rt(null),overlay:new rt(null),uResolution:new rt(new ve),uDPR:new rt(1),blurIntensity:new rt(0)}})),this._blurEnabled=!1,this.blurTarget=new Ii(1,1,{minFilter:gi,magFilter:gi,wrapS:Cr,wrapT:Cr}),this.blurPass=new hU({width:window.innerWidth,height:window.innerHeight,kernelSize:OT.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,n)),super.render(e,t,i,r,n)}},Ize=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Oze=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,Nze=class extends qo{constructor(){super(new Oi({vertexShader:Ize,fragmentShader:Oze,uniforms:{tInput:new rt(null),tOverlayImage:new rt(null),uResolution:new rt(new ve),uImageSize:new rt(new ve),uRightBottom:new rt(new ve(20,20)),uScale:new rt(.25),uDPR:new rt(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(e){this.uniforms.tOverlayImage.value=e,this.uniforms.uImageSize.value.set(e.image.width,e.image.height)}};function L8(e,t){return t&&t.enabled&&e.push(t.effect),e}var zze=e=>Object.values(Bi).includes(e)?e:Bi.NORMAL,Bze=class extends Ts{constructor(e,t){super(),this._needsDOFResize=t,this.postprocessingState=$A.defaultData,this._scene=new Wa,this._camera=new Ys,this.effects=new Map,this.blueNoiseTexture=new ga,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new twe,this.renderer=e,this.debug=!1,this.effects.set("bloom",new QNe),this.effects.set("chromaticAberration",new JNe),this.effects.set("vignette",new ize),this.effects.set("noise",new tze),this.effects.set("colorAverage",new $Ne),this.effects.set("hueSaturation",new eze),this.effects.set("brightnessContrast",new KNe),this.effects.set("depthOfField",new rze),this.effects.set("pixelation",new nze),this.effectComposer=new dze(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new nN(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new uze(this.scene,this.camera,this.renderer),this.aoPass=new _ze(this.scene,this.camera),this.taaPass=new cze,this.taaPass.renderToScreen=!1,this.helperPass=new fze(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new Eze,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new Rze,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new Nze,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new Pze,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new ga(e,128,128),this.blueNoiseTexture.wrapS=Fu,this.blueNoiseTexture.wrapT=Fu,this.blueNoiseTexture.minFilter=_i,this.blueNoiseTexture.magFilter=_i,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,n,s,a,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t,i;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let r=[this.effects.get("pixelation")].reduce(L8,[]);r.length>0&&(this.uvEffectPass=new gC(this.camera,...r),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let n=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(L8,[]);if(n.length>0&&(this.effectPass=new gC(this.camera,...n),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&((i=this.effects.get("depthOfField"))==null?void 0:i.enabled)&&window!==void 0)){let s=this.renderer.viewportWidth,a=this.renderer.viewportHeight;this.renderer.setSize(s-1,a-1),this.renderer.setSize(s,a)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let e=new ve;this.renderer.getDrawingBufferSize(e),this._rt=new Ii(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Fu,wrapT:Fu}),this._rt.samples=0,this._savePass=new iN(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new iN(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}setWatermark(e){this.logoOverlayPass.enabled=e!==null,e&&(this.logoOverlayPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=zze(l):a[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof li?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof li?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},kze=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,Uze=mi.lights_fragment_begin,Fze=mi.shadowmask_pars_fragment,R8=null,Vze=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},jze=(e="medium")=>{if(R8===e)return!1;R8=e;let t=Vze(e);mi.shadowmap_pars_fragment=kze(t);let i=Uze.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),mi.lights_fragment_begin=i;let r=Fze.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),mi.shadowmask_pars_fragment=r,!0},Hze=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,Gze=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,I3=new Oi({vertexShader:Hze,fragmentShader:Gze,uniforms:{depthContrast:{value:1}}}),I8=new Fr,O8=new ve,Wze=class extends ZJ{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new ve,this.dummyCamera=new Ys,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new Bze(this,(e==null?void 0:e.needsDOFResize)??!1),this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=KB,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,t(n))},this.setSize=(n,s,a=!0)=>{var o,l;(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),(o=this.normalRenderTarget)==null||o.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),(l=this.transmissionDepthTarget)==null||l.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Ii(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:gi,magFilter:gi,wrapS:Cr,wrapT:Cr,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return Jt.transmissionLod.value===1}set hdTransmission(e){Jt.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Ii(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:t0,magFilter:gi,wrapS:Cr,wrapT:Cr,depthBuffer:!1}),this.transmissionDepthTarget=new Ii(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:_i,magFilter:_i,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Ii(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:_i,magFilter:_i,type:rr,depthTexture:new r0(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Ys?I3.uniforms.depthContrast.value=(i.far-i.near)/1e4:I3.uniforms.depthContrast.value=1,t.overrideMaterial=I3,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?hN:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,n=t.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){var d;let a=e instanceof xU?e.activePage:e,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((p,f)=>{Jt.penumbraSize.value[f]=p}),Jt.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Jt.resolution.value.set(this.resolution.x,this.resolution.y):Jt.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(Jt.normalRenderTarget.value=s,Jt.normalRenderTargetDepth.value=I8):l.needsNormal()&&(this.createNormalRenderTarget(),Jt.normalRenderTarget.value=this.normalRenderTarget.texture,Jt.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,t));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),Jt.aoRenderTarget.value=this.aoRenderTarget.texture),Jt.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!Jb),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=a.uiCanvas)==null?void 0:d.enabled)&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let p=this.getSize(O8),f=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==f)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},f),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(p.x,p.y,f),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let p=this.getSize(O8),f=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(p.x,p.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=f}let h=!1;if(n!==void 0)Jt.transmissionRenderTarget.value=n,Jt.transmissionRenderTargetDepth.value=I8,this.pipeline.setTransmissionPassEnabled(!1);else{let p=l.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),Jt.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Jt.aspectRatio.value=ORe(this.viewportWidth,this.viewportHeight),Jt.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(p=>{p.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?hN:null,this.pipeline.render(),Jt.frameIndex.value=(Jt.frameIndex.value+1)%16,t instanceof Ys&&t.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,n,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(n=this.normalRenderTarget)==null?void 0:n.depthTexture)==null||s.dispose()}},hie=class extends tw(vwe){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){iw(this.object,hie.geometryHelper,e,t)}},die=class extends tw(gwe){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){iw(this.object,die.geometryHelper,e,t)}},sN=class extends tw(mwe){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){iw(this.object,sN.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=sN._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},pie=sN;pie._vector=new k;var fie=class extends Hu{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new gr(new Hc(1,1),new ah({transparent:!0,opacity:0,side:qs})),this.add(this.caretMesh),this.selectionMesh=new gr(new Hc(1,1),new ah({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:qs})),this.add(this.selectionMesh),this.hide()}get caretHeight(){var e;return((e=this.object)==null?void 0:e.AD)??0}show(e){this.visible=!0,this.object=e,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:e}=this.object.geometry.userData.parameters;this.caretMesh.position.z=e,this.selectionMesh.position.z=e}updateHelperMatrix(){if(this.object===void 0)return;let e=this.object,t=e.parent;t!==null&&t.updateWorldMatrix(!0,!1),e.matrixAutoUpdate&&e.updateMatrix(),t!==null?(this.matrixWorld.multiplyMatrices(t.matrixWorld,e.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,e.matrix)):this.matrixWorld.multiplyMatrices(e.hiddenMatrix,e.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);e.updateWorldMatrix(!0,!0)}setCaretColor(e){let t=this.caretMesh.material;t.color.setRGB(e.r,e.g,e.b);let i=this._caretVisibleAlpha===t.opacity;this._caretVisibleAlpha=e.a,i&&(t.opacity=this._caretVisibleAlpha)}setSelectionColor(e){this.selectionMesh.material.color.setRGB(e.r,e.g,e.b)}setCaretPosition(e,t={}){if(this.object===void 0)return;this.caretIndex=e;let i=this.object.wrappedText,[r,n]=vC(i,e),[s,a]=e>0?vC(i,e-1):[null,null];(e>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=e,this.current.end=void 0;let[o,l]=O3(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:p,depth:f}=this.object.geometry.userData.parameters,v=typeof d=="string"?0:d,m=typeof p=="string"?0:p;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-v*.5,l+h+m*.5,f),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(e,t){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=e,this.current.end=t;let r=[],n=[],s=Xze(i,e,t),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[m,g,y]of s)if(g!==y){let[x,_]=O3(this.object,m,g),[M,S]=O3(this.object,m,y);_+=c,S+=c,S+=a;let E=r.length/3;r.push(x,_,0),r.push(M,_,0),r.push(M,S,0),r.push(x,S,0),n.push(E+0,E+1,E+2),n.push(E+2,E+3,E+0)}let u=new Bt;u.setIndex(n),u.setAttribute("position",new _t(r,3));let{width:h,height:d,depth:p}=this.object.geometry.userData.parameters,f=typeof h=="string"?0:h,v=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-f*.5,this.selectionMesh.position.y=v*.5,this.selectionMesh.position.z=p,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(e,t,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-t-u,a),0)/s),n-1),d=this.object.charCoords[h],p=this.object.charWidths[h],f=0,v=!1;if(i==="previous"){for(let m=0;m<d.length;m++)if(d[m][0]+p[m]*.5-e>0){f=m,v=!0;break}}else if(i==="closest"){let m=1/0;for(let g=0;g<d.length;g++){let y=d[g][0]+p[g]*.5,x=Math.abs(y-e);x<m&&(m=x,f=g,v=!0)}}else for(let m=0;m<d.length;m++){let g=d[m][0],y=d[m][0]+p[m];if(e>=g&&e<y){f=m,v=!0;break}}return v||(f=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,f),lineIndex:h,characterIndex:f}}getGlobalIndexFromLineAndCharIndexes(e,t,i){return e.slice(0,t).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function O3(e,t,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=e;if(r[t]&&r[t].length===0||r.length===0){let u=0,{horizontalAlign:h}=e.data.geometry,d=e.wrappedText,{width:p}=e.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=p*.5:h===2&&(u=p)),[u,s-a*t]}let o=r[t];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[t][i-1]),[l,c]}function vC(e,t){var r;let i=0;for(let n=0;n<e.length;n++){let s=e[n],a=t-i;if(a<=s.length)return[n,a];i+=s.length}return[Math.max(0,e.length-1),((r=e[e.length-1])==null?void 0:r.length)??0]}function Xze(e,t,i){let[r,n]=vC(e,t),[s,a]=vC(e,i),o=[];n>=e[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=e[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function qze(e,t){let i=bs.fromHex(3223857),r=.8;for(let n of e.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(t.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=Yze(n.data.color,t),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=Zze(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function Yze(e,t){return typeof e=="string"?t.data.colors[e]:e}function Zze(e){return e.colors[0]}function Qze(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var mie=class extends cU(ewe,hie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new RA(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof RA&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&Qze(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},N8=new k,z8=new k,B8=new ni,gie=class extends cU(Qbe,pie){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Mt.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new RA(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof RA&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),z8.setFromMatrixPosition(this.matrixWorld),B8.setFromRotationMatrix(this.matrixWorld),N8.copy(this.up).applyQuaternion(B8).negate().multiplyScalar(this.distance),this.target.position.copy(z8).add(N8),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function Kze(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,r=(e[1][0]+e[0][1])/2,n=(e[1][0]-e[0][1])/2,s=Math.sqrt(t*t+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,t),h=(u-c)/2,d=(u+c)/2,p=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],f=[[o,0],[0,l]],v=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return p[0][0]*=-1,p[0][1]*=-1,v[0][0]*=-1,v[1][0]*=-1,[p,f,v]}function ME(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function k8(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function Jze(e){let[t,i,r]=Kze(e),n=ME(t,k8(r)),s=ME(ME(r,i),k8(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function $ze({rotation:e,scale:t,shear:i}){let r=Math.cos(e),n=Math.sin(e),s=[[r,-n],[n,r]],a=[[t[0],i[0]*t[1]],[i[1]*t[0],t[1]]],o=ME(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Fi;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(S,E=e.identity()){for(let A=0,P=S.length;A<P;A++)E[A]=S[A];return E}e.copy=i;function r(S,E,A,P,C,D){return e.setAbcdef(e.identity(),S,E,A,P,C,D)}e.create=r;function n(S,E,A,P,C,D,N){return S[0]=E,S[1]=P,S[2]=D,S[3]=A,S[4]=C,S[5]=N,S}e.setAbcdef=n;function s(S,E){let[A,P,C,D,N,U]=o(S),[I,G,Q,Y,O,V]=o(E),F=I*A+G*C,W=I*P+G*D,ee=Q*A+Y*C,ae=Q*P+Y*D,K=O*A+V*C+N,$=O*P+V*D+U;return e.create(F,W,ee,ae,K,$)}e.append=s;function a(S,E){let[A,P,C,D,N,U]=o(S),[I,G,Q,Y,O,V]=o(E),F=A,W=P,ee=C,ae=D;(I!==1||G!==0||Q!==0||Y!==1)&&(F=A*I+P*Q,W=A*G+P*Y,ee=C*I+D*Q,ae=C*G+D*Y);let K=N*I+U*Q+O,$=N*G+U*Y+V;return e.create(F,W,ee,ae,K,$)}e.prepend=a;function o(S){return[S[0],S[3],S[1],S[4],S[2],S[5]]}e.getAbcdef=o;function l(S){let[E,A,P,C,D,N]=e.getAbcdef(S),U=E*C-A*P,I=C/U,G=-A/U,Q=-P/U,Y=E/U,O=(P*N-C*D)/U,V=-(E*N-A*D)/U;return e.create(I,G,Q,Y,O,V)}e.invert=l;function c([S,E],A){let[P,C,D,N,U,I]=e.getAbcdef(A);return[P*S+D*E+U,C*S+N*E+I]}e.apply=c;function u(S,E){let[A,P,C,D,N,U]=e.getAbcdef(E),I=1/(A*D+C*-P),[G,Q]=S;return[D*I*G+-C*I*Q+(U*C-N*D)*I,A*I*Q+-P*I*G+(-U*A+N*P)*I]}e.applyInverse=u;function h(S,E,A=E){let[P,C,D,N,U,I]=e.getAbcdef(S);return e.setAbcdef(S,P*E,C*A,D*E,N*A,U*E,I*A),S}e.scale=h;function d(S,E){let A=Math.cos(E),P=Math.sin(E),[C,D,N,U,I,G]=e.getAbcdef(S);return e.setAbcdef(S,C*A-D*P,C*P+D*A,N*A-U*P,N*P+U*A,I*A-G*P,I*P+G*A),S}e.rotate=d;function p(S,E,A){let[P,C]=A,D=e.translate(S,-P,-C);return D=e.rotate(D,E),D=e.translate(D,P,C),D}e.rotateAround=p;function f(S,E,A){let[P,C,D,N,U,I]=e.getAbcdef(S);return e.setAbcdef(S,P,C,D,N,U+E,I+A),S}e.translate=f;function v(S,E,A){let[P,C,D,N]=e.getAbcdef(S);return e.setAbcdef(S,P,C,D,N,E,A),S}e.setTranslate=v;function m(S,E,A){let[P,C,D,N]=e.getAbcdef(S);return e.setAbcdef(S,P,C,D,N,E,A),S}e.setPosition=m;function g(S){let[E,A,P,C]=e.getAbcdef(S),D=Math.sqrt(E*E+A*A),N=Math.sqrt(P*P+C*C);return[D,N]}e.getScale=g;function y(S){let[,,,,E,A]=e.getAbcdef(S);return[E,A]}e.getPosition=y;function x(S,E){return e.decompose(S,E).rotation}e.getRotation=x;function _(S,E){let[A,P,C,D,N,U]=e.getAbcdef(S),{rotation:I,scale:G,shear:Q}=Jze([[A,C],[P,D]]);return{position:[N+(E[0]*A+E[1]*C)-E[0],U+(E[0]*P+E[1]*D)-E[1]],scale:G,rotation:I,shear:Q,pivot:E}}e.decompose=_;function M(S,E,A,P,C=[0,0]){let[D,N]=S,[U,I]=P,[G,Q,Y,O]=$ze({rotation:A,scale:E,shear:C}),V=D-(U*G+I*Y)+U,F=N-(U*Q+I*O)+I;return e.create(G,Q,Y,O,V,F)}e.compose=M})(Fi||(Fi={}));var eBe=Math.PI/180;function tBe(e,t,i,r,n,s){let a=e-i,o=t-r;return a*a/(n*n)+o*o/(s*s)<=1}function iBe(e){return e*eBe}var us=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Fi.identity(),this.worldMatrix=Fi.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new aN,this._recursiveBBox=new aN,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=LT(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Fi.append(t.worldMatrix,i)),Fi.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=n[0]&&t>=r[1]&&t<=n[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Fi.compose(this.position,this.scale,iBe(this.rotation),kf.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Fi.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Fi.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return kf.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),e.shear!==void 0&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,n=dr(e.path,["states","*"]);if(n!==null){if(e.type===0){let[s]=n;if((this==null?void 0:this.stateSelection)===s){let a={...e.props};if(delete a.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Un.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...e,props:a,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=Un.removeOverridden(e.path,e.props,s);r={...e,props:a}}}this.updateByPatchedOpBase(r,wf.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)wf.toOps(this.data,r.data).forEach(n=>{let s=HA.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=wf.patch(this.data,r),wf.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new us(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof us&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Rl=class extends us{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Rl&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Rl?i.traverse(e):t=e(i)}intersectsChildrenHelper(e,t,i,r,n){for(let s of this.children)if(s.intersects(e,t,i,!1)&&(n.push(s),r)||s instanceof Rl&&s.intersectsChildrenHelper(e,t,i,r,n))return!0;return!1}intersectsChildren(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(e,t,i,r,n),n}intersectsChildrenHelperReverse(e,t,i,r,n){for(let s of this.children)if(s instanceof Rl&&s.intersectsChildrenHelperReverse(e,t,i,r,n)||s.intersects(e,t,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(e,t,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(e,t,i,r,n),n}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Rl(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Jd=class extends Rl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Jd(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function rBe(e,t){let[[i,r],[n,s]]=e,[[a,o],[l,c]]=t,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var vie=[[-1,1],[-1,-1],[1,-1],[1,1]],U8=(e,t,i)=>{let r=e.getCenter(),n=e.getHalfSize(),s=Fi.append(t,e.worldMatrix);n[0]===0&&n[1]===0?i.push(Fi.apply(r,s)):vie.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Fi.apply(o,s))})},aN=class{constructor(){this.matrix=Fi.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Fi.copy(e.worldMatrix,this.matrix);let i=Fi.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Rl?e.traverse(n=>{n.visible&&U8(n,t,r)}):U8(e,t,r),this.setFromPoints(r)}setFromSize(e,t,i){this.makeEmpty(),Fi.copy(i,this.matrix),this.expandBySize(e,t,i)}expandBySize(e,t,i){[Fi.apply([0,0],i),Fi.apply([0,t],i),Fi.apply([e,t],i),Fi.apply([e,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Fi.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Fi.getAbcdef(this.matrix),o=Fi.create(r,n,s,a,i[0],i[1]);this.vertices=vie.map(([l,c])=>Fi.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Fi.append(t.worldMatrix,i)),Fi.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,n]=this.min,[s,a]=this.max;return t>=r&&t<=s&&i>=n&&i<=a}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let n=0,s=e.edges.length;n<s;n++){let a=e.edges[n];if(rBe(r,a))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Fi.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new aN;return e.copy(this),e}},yie,nBe=new Promise(e=>{yie=e}),F8=!1,WS;function sBe(){if(F8)return;if(WS)return WS;async function e(){let t=await sp(()=>import("./ui-L7l3pL7d.js"),[]);yie(t.default??t),F8=!0}return WS=e(),WS}function V8(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var hi,N3;async function aBe(e){let t=await nBe;hi||(N3||(N3=t({locateFile:()=>e})),hi=await N3)}var j8=Fi.identity(),xie=class{constructor(e,t=1){this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=ar.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=ar.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=j8,this._currentTransform=new Float32Array(j8)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await aBe(this.wasmURL),this._surface=hi.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new hi.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(hi.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(hi.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=hi.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(XS(e),hi.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(XS(e),hi.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(hi.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new hi.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=hi.XYWHRect(e,t,i,r);if(n===0&&s===0&&o===0&&a===0)(c=this.ctx)==null||c.clipRect(l,hi.ClipOp.Intersect,!0);else{let h=hi.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,hi.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Fi.invert(this.currentTransform);this.ctx.concat(e);let t=Fi.translate(Fi.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,n,s,a;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(XS(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=hi.MaskFilter.MakeBlur(hi.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,hi.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,hi.ClipOp.Intersect,!0);let c=hi.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,hi.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,hi.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=hi.MaskFilter.MakeBlur(hi.BlurStyle.Normal,this._layerBlur*this.dpr*(((n=this.camera)==null?void 0:n.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new hi.Paint;c.setAntiAlias(!0),c.setStyle(hi.PaintStyle.Fill),c.setColor(XS(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=hi.MaskFilter.MakeBlur(hi.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,p,f,v]=h,m=f-d,g=v-p;this.ctx.save(),this.ctx.clipPath(this._currentPath,hi.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,hi.SaveLayerInitWithPrevious),(a=this.ctx)==null||a.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(hi.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+m+Math.abs(this._innerShadowOffsetX*2),2e3+g+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(hi.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,n=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?hi.ClipOp.Difference:hi.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(hi.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,n,s,a,o){var c;if(!H8([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=hi.XYWHRect(e-i,t-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,r,n=0,s=0,a=0,o=0){var c,u;let l=hi.XYWHRect(e,t,i,r);if(H8(l))if(n===0&&s===0&&o===0&&a===0)(c=this._currentPath)==null||c.addRect(l);else{let h=hi.RRectXY(l,n,n);h[4]=h[5]=n,h[6]=h[7]=s,h[8]=h[9]=a,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return hi.TextAlign.Right;case 3:return hi.TextAlign.Center;case 4:return hi.TextAlign.Justify;case 1:default:return hi.TextAlign.Left}}drawTextInner(e,t,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,f=>{t.pushPaintStyle(i,f,p),t.addText(e);let v=t.build();v.layout(s);let m=n;o===2?m+=(a-v.getHeight())/2:o===3&&(m+=a-v.getHeight()),h.drawParagraph(v,r,m),u=v.getHeight(),t.reset(),v.delete()},c),d.delete(),p.delete(),u}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new hi.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new hi.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=hi.XYWHRect(t.x,t.y,t.width,t.height),u=hi.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),a&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,n,s){var a;(a=this._currentPath)==null||a.cubicTo(e,t,i,r,n,s)}quadraticCurveTo(e,t,i,r){var n;(n=this._currentPath)==null||n.quadTo(e,t,i,r)}setTransform(e,t=!1){var n,s,a,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Fi.invert(i);if(r&&this.ctx.concat(r),(n=this.ctx)==null||n.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((a=this.ctx)==null||a.concat(this.camera.worldMatrix),t)){let c=Fi.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=hi.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function H8(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function XS({r:e,g:t,b:i,a:r}){return hi.Color4f(e,t,i,r)}var G8=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=ar.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},W8=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},oBe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=ar.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},lBe=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=ar.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},ns=class extends us{constructor(t,i,r){super(t,i,r),this.uuid=t,this.data=i,this.autoClose=!0,this.fill=new oBe(t+"-fill",i.fill,r),this.stroke=new lBe(t+"-stroke",i.stroke,r),this.dropShadow=new G8(t+"-dropShadow",i.dropShadow,r),this.innerShadow=new G8(t+"-innerShadow",i.innerShadow,r),this.backgroundBlur=new W8(t+"-backgroundBlur",i.backgroundBlur,r),this.layerBlur=new W8(t+"-layerBlur",i.layerBlur,r)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:ar.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:ar.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=this.layerBlur.radius*5:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=this.backgroundBlur.radius*5:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=this.dropShadow.blurRadius*5,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=ar.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=this.innerShadow.blurRadius*5,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=ar.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,i,r){super.updateByPatchedOp(t,i,r),t.type===0&&(dr(t.path,["fill"])?this.fill.update(t.props):dr(t.path,["stroke"])?this.stroke.update(t.props):dr(t.path,["dropShadow"])?this.dropShadow.update(t.props):dr(t.path,["innerShadow"])?this.innerShadow.update(t.props):dr(t.path,["layerBlur"])?this.layerBlur.update(t.props):dr(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,i){super.updateState(t,i),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let i=new ns(this.uuid,this.data,t);return i.parent=void 0,i}},dU=class extends ns{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return tBe(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new dU(this.uuid,this.data,e);return t.parent=void 0,t}},sw=class extends ns{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new sw(this.uuid,this.data,e);return t.parent=void 0,t}},pU=class extends ns{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:ar.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:ar.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:n}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new pU(this.uuid,this.data,e);return t.parent=void 0,t}},bie=class extends ns{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>yC.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=e.length;r<n;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;e.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,p={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};yC.derive(p),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,n,s,a,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new bie(this.uuid,this.data,e);return t.parent=void 0,t}},yC;(e=>{function t(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],p=[3*(u[0]-c[0]),3*(u[1]-c[1])],f={start:h,cp:d,end:p};return a.derivative=f,f.derivative=oN.derive(f),f}e.derive=t;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,p=-(h+d)/u,f=-(-h+d)/u;return[p,f]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??e.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=r;function n(a){let[o,l]=e.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(e.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,p=l*u*3,f=o*u;return[h*a.start[0]+d*a.cp1[0]+p*a.cp2[0]+f*a.end[0],h*a.start[1]+d*a.cp1[1]+p*a.cp2[1]+f*a.end[1]]}e.compute=s})(yC||(yC={}));var oN;(e=>{function t(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=lN.derive(u),n.derivative=u,u}e.derive=t;function i(n){let s=n.derivative??e.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}e.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}e.compute=r})(oN||(oN={}));var lN;(e=>{function t(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}e.derive=t;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}e.compute=i})(lN||(lN={}));var Uc=class extends Rl{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new sw(e+"-background",ib.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(dr(e.path,["fill"])?this.fill.update(e.props):dr(e.path,["stroke"])?this.stroke.update(e.props):dr(e.path,["dropShadow"])?this.dropShadow.update(e.props):dr(e.path,["innerShadow"])?this.innerShadow.update(e.props):dr(e.path,["layerBlur"])?this.layerBlur.update(e.props):dr(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Uc(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},cBe=ap(MJ(),1),NT=class extends ns{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new NT(this.uuid,this.data,e);return t.parent=void 0,t}};function uBe(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,cBe.parseSVG)(e).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return hBe(r)}function hBe(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let n=[];t.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function dBe(e,t,i){switch(t.type){case"ellipse2d":return new dU(e,t,i);case"rectangle2d":return new sw(e,t,i);case"text2d":return new pU(e,t,i);case"vector2d":return new bie(e,t,i);case"path2d":return new NT(e,t,i);case"frame2d":return new Uc(e,t,i);case"group2d":default:return new Jd(e,t,i)}}var wie=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Jd(wie.GROUP_ID,{...lC.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,n,s){let a=dBe(e,t,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof Jd||a instanceof Uc)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let n=this.find(e);if(n)try{n.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Rl&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Rl){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,n=e.parent===null?this:this.find(e.parent);if(n instanceof Rl||n===this){n.add(i);let s=e.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,n=[]){return this.group.intersectsChildren(e,t,i,r,n,!0)}intersectsChildrenReverse(e,t,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(e,t,i,r,n,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>iee(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},fU=wie;fU.GROUP_ID="scene2d";function _ie({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-r,h=i-n,d=s,p=a,f=o[0],v=o[1];if(l!==0){if(l===1)f+=u;else if(l===3)f+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let m=t/r;d*=m,f*=m}}if(c!==0){if(c===1)v+=h;else if(c===3)v+=h/2;else if(c===2)p=Math.max(1,p+h);else if(c===4){let m=i/n;p*=m,v*=m}}return{width:d,height:p,position:[f,v]}}ap(MJ(),1);var pBe=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,fBe=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,mBe=new pT(-1,1,1,-1,0,1),gBe=class extends Bt{constructor(){super(),this.setAttribute("position",new _t([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new _t([0,2,0,0,2,0],2))}},vBe=new gBe,yBe=class{constructor(e){this._mesh=new gr(vBe,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,mBe)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},Sie=new Oi({defines:{},uniforms:{tDiffuse:new rt(null)},vertexShader:pBe,fragmentShader:fBe}),xBe=new yBe(Sie),z3=null,B3=null,bBe=()=>(z3===null&&(z3=document.createElement("canvas")),z3),wBe=e=>(B3===null&&(B3=new xie(e)),B3),_Be=Fi.identity(),Mie=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{var s,a;if(((s=n.target)==null?void 0:s.uuid)!==void 0){let o=(a=this.frameRoot)==null?void 0:a.find(n.target.uuid);o&&o.dispatchEvent({...n,target:o})}},this.scene2d=new fU(Mt.generateUUID(),DO.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=bBe(),this.renderer=wBe(this.canvas),this.promise=this.init(),this.renderTarget=new Ii(1,1,{type:sh,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new lbe(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof xie&&(this.renderer.wasmURL=qte.skiaWasmUrl),await this.renderer.init()}render(e){var t,i;if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),(t=this.frameOverride)==null||t.draw(this.renderer),this.renderer.render(),Sie.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let r=e.getRenderTarget();e.setRenderTarget(this.renderTarget),e.clear(),xBe.render(e),e.setRenderTarget(r),(i=this.textureHolder)==null||i.setNeedsUpdate(!0)}}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=_Be,this.isScreenSpace&&(this.frameOverride.fill.color=ar.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},Eie({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e,t=window.devicePixelRatio){var o,l;let i=Math.max(1,(e==null?void 0:e.width)??this.width),r=Math.max(1,(e==null?void 0:e.height)??this.height);this.dpr=t,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*t<s||r*t<a)&&(n=Math.max(s/(i*t),a/(r*t))),this.renderTarget.setSize(i*t*n,r*t*n),(o=this._canvasTexture)==null||o.dispose(),this._canvasTexture=void 0,this.applyOverrides(e),(l=this.frameOverride)==null||l.requestRender()}applyFrame(e){var i,r;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Uc)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.frame)==null||i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(n=>{n.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(n=>{n.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(r=this.frame)==null||r.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function Eie({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(e instanceof Uc&&t instanceof Uc||e instanceof Jd&&t instanceof Jd)for(let a=0,o=e.children.length;a<o;a++){let l=e.children[a],c=t.children[a];l&&c&&l.uuid===c.uuid&&MBe({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function SBe(e){if(cN(e))return[e.width,e.height];if(e instanceof NT){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof Jd){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function MBe({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=SBe(t),{width:l,height:c,position:u}=_ie({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)EBe({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(cN(e)||e instanceof Jd)cN(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),Eie({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(e instanceof NT){let h=t,d=a!==0?l/a:1,p=o!==0?c/o:1;e.path=uBe(h.path,d,p),e.data={...e.data,path:e.path}}}function EBe({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:p}=_ie({constraints:t.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:kf.isResizeable(l)?l.width:0,objectInitialHeight:kf.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:p}),kf.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function cN(e){return e instanceof sw||e instanceof Uc||e instanceof dU||e instanceof pU}var rs=class extends Gk(Wa){constructor(t,i,r){super(),this.data=i,this.bgColor=new As(1,1,1,1),this.fog=null,this.backupFog=new QJ(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Yt,this.penumbraSizeArrayCache=null,this.super_Entity(t,i),this.personalCamera=new Ys(U0,{...$x.defaultData,...i.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new Ybe(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),i.uiScene?this.uiScene=new fU((Array.isArray(t)?t[0]:t)+"-ui",i.uiScene,{dpr:window.devicePixelRatio,shared:r.shared}):i.uiFrame&&this.createUICanvas(i.uiFrame,r)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var t;return(t=this.uiCanvas)==null?void 0:t.frame}createUICanvas(t,i){this.uiCanvas=new Mie(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,i),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var r,n;(r=this.uiCanvas)==null||r.applyFrame(t),(n=this.uiCanvas)==null||n.applySize()})}updateVisible(){}setBackgroundColor(t){this.bgColor=t,this.fogUseBGColor===!0&&(this.backupFog.color=t)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(t,i){t.color!==void 0&&(this.ambientLight.color=va(t.color,i)),t.intensity!==void 0&&(this.ambientLight.intensity=t.intensity),t.enabled!==void 0&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.traverseEntity(i=>{i instanceof im&&i.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(t=>{if(t instanceof j0)if(Array.isArray(t.material))for(let i of t.material)i.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()})}updateShadow(t){t.softShadowQuality!==void 0&&this.isActive&&jze(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,i){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let r=this.scene;r.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=va(t.color,i),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,i){t.aoColor!==void 0&&(this.aoColor=va(t.aoColor,i))}updateByOp(t,i,r,n){let s=this.data.uiFrame;super.updateByOp(t,i,r,n);let a=i;dr(t.path,["fog"])?this.updateFog(a.fog,r.shared):dr(t.path,["ao"])?this.updateAo(a.ao,r.shared):dr(t.path,["ambient"])?this.updateAmbientLight(a.ambient,r.shared):dr(t.path,["shadow"])?this.updateShadow(a.shadow):t.type===0&&t.path.length===0&&(t.props.uiFrame!==void 0||s!==a.uiFrame)&&this.updateUIFrame(t.props.uiFrame,r)}updateUIFrame(t,i){t?(this.uiCanvas||this.createUICanvas(t,i),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(t)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(t,i){this.updateState_Entity(t,i),t.backgroundColor!==void 0&&this.setBackgroundColor(va(t.backgroundColor,i.shared)),t.fog!==void 0&&this.updateFog(t.fog,i.shared),t.ambient!==void 0&&this.updateAmbientLight(t.ambient,i.shared),t.ao!==void 0&&this.updateAo(t.ao,i.shared),t.shadow!==void 0&&this.updateShadow(t.shadow)}createFrame(t,i){}raycast(t,i){super.raycast(t,i)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){var t;return((t=this.scene)==null?void 0:t.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,i=0;this.traverseEntity(r=>{if(!r.visible)return!0;r instanceof mie&&r.visible&&t<3&&(this.penumbraSizeArrayCache[t]=r.data.penumbraSize??.5,t+=1),r instanceof gie&&r.visible&&t<2&&(this.penumbraSizeArrayCache[3+i]=r.data.penumbraSize??.5,i+=1)})}raycastWithClones(t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;Di.is(s)&&(s.visible||a!=null&&a.object.data.visible)&&((Ll(s)||$O(s)&&this.scene.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,i),uN(s,t,i,!0)),r(s))}};return r(this),i}updateEntity2DByOp(t,i,r,n){var s;(s=this.uiCanvas)==null||s.updateEntity2DByOp(t,i,r,n)}},ABe=class extends cU(Jbe,die){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new k(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new k(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new fn(n,s),o=new IA(a,new Yt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof IA){let i=this.shadow.camera,r=new k(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new k(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},CBe=class extends En{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?Jk(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},mU=class extends En{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape(),this.refreshAttachedCloners(t)}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let n in e)typeof e[n]=="string"&&(e[n]=this._context.shared.getVariable(e[n],[this.uuid,"geometry","extrusion","shape",n]));let t;if(e.type==="Custom"){let n=e.shapeId;if(n!==this._shapeId&&this.detachShape(),n){this._shapeId=n;let s=this._context.scene.find(n);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let n;switch(e.type){case"Rectangle":n=Kk;break;case"Ellipse":n=Qk;break;case"Polygon":n=cte;break;case"Star":n=ute;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=n.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build())}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?Jk(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},gU=class extends lU{constructor(e,t,i){super(e,t,i),this.data=t}},Vv=class extends H0(Hu,rw){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=nC.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,n;for(let s of bd.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=e[s],r===void 0&&(r={...e}),r[s]=Nd.apply(i.data[s],e[s]));return this.overrideData=n,r}else return{...Fn.defaultData,...e,...Bc(Fn.defaultData,bd.rootOverrideProps)}}updateByOp(e,t,i,r){let n;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of bd.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(n===void 0&&(n={...e,props:{...e.props}}),n.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&bd.rootOverrideProps.includes(e.path[0])){let s=e.path[0];n===void 0&&(n={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(n??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Di.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),vU(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};Aie(e,[this.uuid],t.overrides,this,i,i,0,r,n);for(let s of this.children)if(Di.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof En&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(p=>e.scene.find(n[p])),h=c.boneInverses.map(p=>new lt().fromArray(p)),d=new sk(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function vU(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Di.is(i)&&vU(i)}}function X8(e,t,i,r){return e.component===t&&Lk(e.identity,r)?e.overrideData===i?2:1:0}function Aie(e,t,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof Vv&&n.isInstanceRoot&&n.expandInstanceChildren(e);let c=0;for(let u of n.children)if(Di.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=eC.resolve(i,h,1);d!=null&&!(d instanceof Pn)&&(Object.setPrototypeOf(d,Pn.prototype),console.error("wrong prototype"));let p=null,f;if(!o){let v=r.children[c];if(p=Di.is(v)?v:null,p!==null){let m=X8(p,u,d,h);f=m>=1?p.stateSelection:void 0,m!==2&&(p=null)}if(p===null&&(p=e.scene.findInstance(h)??null,p!==null)){let m=X8(p,u,d,h);if(f=m>=1?p.stateSelection:void 0,m!==2)p=null;else{let g=p.parent.children.indexOf(p);p.parent.children.splice(g,1),r.children.splice(c,0,p),p.parent===r?g<=c&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(p===null){let v=d?Nd.apply(u.data,d):u.data;$f.is(v.type)&&(v={...v,type:"Empty"}),p=_d.createEntity(h,v,e),p.overrideData=d,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(c,0,p),p.updateState(p.data,e),f&&p.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let v=p.identity[p.identity.length-1];l[v]=p.uuid}c+=1,Aie(e,t,i,p,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(Di.is(h))e.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var TBe=class extends H0(KJ,rw){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},Gs=class extends En{constructor(t,i,r){super(t,i,r),this.onBeforeRender=n=>{this.uiCanvas.render(n)},this.uiCanvas=new Mie(t+"-canvas",i.geometry.width,i.geometry.height,r),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,r.shared)})}updateByPatchedOpGeometry(t,i,r){super.updateByPatchedOpGeometry(t,i,r),t.type===0&&(t.props.frame!==void 0&&this.applyFrame(t.props.frame,r.shared),(t.props.width!==void 0||t.props.height!==void 0)&&this.applySize(t.props,r.shared))}applySize(t,i){let r=(t==null?void 0:t.width)??this.dataPatched.geometry.width,n=(t==null?void 0:t.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:r,height:n}),this.applyGeometryParametersFromFrame(i)}applyFrame(t,i){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(i),this.applyMaterialParametersFromFrame({shared:i})}applyGeometryParametersFromFrame(t){var r;let i=this.frame;i&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:i.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:i.cornerRadius,cornerType:0})}),(r=this.localGeometry)==null||r.dispose(),this.localGeometry=ab(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let i=this.frame;if(i){let r=i.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:r.radius,alpha:r.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:r.radius,alpha:r.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,i,r,n){this.uiCanvas.updateEntity2DByOp(t,i,r,n),t===this.frameId&&i.type===0&&(i.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(n):dr(i.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:n}))}get frame(){return this.uiCanvas.frame}get frameId(){var t;return(t=this.frame)==null?void 0:t.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,i){super.updateGeometryInteractions(t,i),this.applySize({width:t.width,height:t.height},i)}},PBe=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=rr,n=new Wa,s=new op;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new gr(new Hc(2,2),o);n.add(l),this.setDataType=function(p){return r=p,this},this.addVariable=function(p,f,v){let m=this.createShaderMaterial(f),g={name:p,initialValueTexture:v,material:m,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:_i,magFilter:_i};return this.variables.push(g),g},this.setVariableDependencies=function(p,f){p.dependencies=f},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let f=this.variables[p];f.renderTargets[0]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),f.renderTargets[1]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),this.renderTexture(f.initialValueTexture,f.renderTargets[0]),this.renderTexture(f.initialValueTexture,f.renderTargets[1]);let v=f.material,m=v.uniforms;if(f.dependencies!==null)for(let g=0;g<f.dependencies.length;g++){let y=f.dependencies[g];if(y.name!==f.name){let x=!1;for(let _=0;_<this.variables.length;_++)if(y.name===this.variables[_].name){x=!0;break}if(!x)return"Variable dependency not found. Variable="+f.name+", dependency="+y.name}m[y.name]={value:null},v.fragmentShader=`
uniform sampler2D `+y.name+`;
`+v.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,f=this.currentTextureIndex===0?1:0;for(let v=0,m=this.variables.length;v<m;v++){let g=this.variables[v];if(g.dependencies!==null){let y=g.material.uniforms;for(let x=0,_=g.dependencies.length;x<_;x++){let M=g.dependencies[x];y[M.name].value=M.renderTargets[p].texture}}this.doRenderTarget(g.material,g.renderTargets[f])}this.currentTextureIndex=f},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let f=0;f<p.length;f++){let v=p[f];v.initialValueTexture&&v.initialValueTexture.dispose();let m=v.renderTargets;for(let g=0;g<m.length;g++)m[g].dispose()}};function c(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(p,f){f=f||{};let v=new Oi({uniforms:f,vertexShader:h(),fragmentShader:p});return c(v),v}this.createShaderMaterial=u,this.createRenderTarget=function(p,f,v,m,g,y){return p=p||e,f=f||t,v=v||Cr,m=m||Cr,g=g||_i,y=y||_i,new Ii(p,f,{wrapS:v,wrapT:m,minFilter:g,magFilter:y,format:Rr,type:r,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),f=new ga(p,e,t,Rr,rr);return f.needsUpdate=!0,f},this.renderTexture=function(p,f){a.passThruTexture.value=p,this.doRenderTarget(o,f),a.passThruTexture.value=null},this.doRenderTarget=function(p,f){let v=i.getRenderTarget(),m=i.xr.enabled,g=i.shadowMap.autoUpdate,y=i.outputEncoding,x=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=jl,i.toneMapping=zc,l.material=p,i.setRenderTarget(f),i.render(n,s),l.material=o,i.xr.enabled=m,i.shadowMap.autoUpdate=g,i.outputEncoding=y,i.toneMapping=x,i.setRenderTarget(v)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},ps=new ws,qS=new k,DBe=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let s=1;t&&(s=t.getX(n)+t.getX(n+1)+t.getX(n+2)),ps.a.fromBufferAttribute(e,n),ps.b.fromBufferAttribute(e,n+1),ps.c.fromBufferAttribute(e,n+2),s*=ps.getArea(),i[n/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){n=s;break}else e<t[s]?r=s-1:i=s+1}return n}sampleFace(e,t,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),ps.a.fromBufferAttribute(this.positionAttribute,e*3),ps.b.fromBufferAttribute(this.positionAttribute,e*3+1),ps.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(ps.a,n).addScaledVector(ps.b,s).addScaledVector(ps.c,1-(n+s)),i!==void 0&&ps.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(ps.a.fromBufferAttribute(this.colorAttribute,e*3),ps.b.fromBufferAttribute(this.colorAttribute,e*3+1),ps.c.fromBufferAttribute(this.colorAttribute,e*3+2),qS.set(0,0,0).addScaledVector(ps.a,n).addScaledVector(ps.b,s).addScaledVector(ps.c,1-(n+s)),r.r=qS.x,r.g=qS.y,r.b=qS.z),this}};function LBe(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=i*e+r;t[n*2+0]=i/(e-1),t[n*2+1]=r/(e-1)}return t}function RBe(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function IBe(e,t){let i=new gr(e.geometry,e.material),r=[],n=[],s=new k,a=new k;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new DBe(i).build();for(let u=0;u<t;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function q8(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new ga(r,t,t,Rr,rr);return n.needsUpdate=!0,n}function OBe({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new ga(t,e,e,Rr,rr);return i.needsUpdate=!0,i}function NBe(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new ga(t,e,e,Rr,rr);return i.needsUpdate=!0,i}var zBe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,BBe=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,kBe=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,UBe=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,FBe=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,VBe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+BBe+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${kBe}
      // ATTRACTION
      ${UBe}  
      // VORTEX
      ${FBe}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,Cie=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,jBe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,HBe=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,GBe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${jBe}
  ${Cie}
`,WBe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,XBe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+Cie+`  
  ${HBe}

`,qBe=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,YBe=class extends Oi{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],Bn.startContext(Bn.globalContext),this.lightLayer=new xc(0,"",{...ts.defaultData("light","phong"),visible:!1},new iU,{},t.shared),Bn.endContext(Bn.globalContext),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new Ete;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(ERe),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(ARe),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(GBe),e.addFragmentParsCode(XBe),e.addVertexFinalCode(WBe({easeSize:this.easeSize})),e.addFragmentFinalCode(qBe({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},k3=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=RBe(t);let n=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=IBe(t,e*e),n=q8(i,e),s=q8(r,e);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new Lv(t*.5,32,32);break}case"TorusEmitterShape":{i=new o$(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new ck(t,t,15);break}case"BoxEmitterShape":{i=new Hl(t,t,t);break}case"PlaneEmitterShape":{i=new Hc(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new Lv(t,32,32);break}default:{i=new Lv(t,32,32);break}}return new gr(i,new ah({color:16711680}))}applyToShader(e,t){this.size=new k().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function Wg(e){let t={...e},i=YA.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},n={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:n}}var ZBe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,U3=10,QBe=class extends $i{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new qbe,this.currentWorldPosition=new k,this.systemQuaternion=new ni,this.worldGravity=new k(0,0,0),this.directionAxis=new k(0,0,0),this.colliderV3=new k(0,0,0),this.colliderQuaternion=new ni(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new YBe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new k(0,0,0)},uEmissionData:{value:new k(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new k(0,0,0)},uWorldQuaternion:{value:new li(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),n=new Fr(r.img);n.needsUpdate=!0,e.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new Fr(r);a.needsUpdate=!0,e.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(e,t){var r;let i=LBe(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new jx(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var a;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(a=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:a.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0],t=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(e.destroyedInAction&&t&&this.init(Wg({...this.system.data,colliderEntityId:null})),!e||e.destroyedInAction)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=e.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/U3),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(Wg(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/U3),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let n=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(n)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let n=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(n[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(n[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(n[2],[this.uuid,"particles","shape_size_2"]))],a={...Wg(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let n=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(n),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Mt.DEG2RAD,Number(e[1])*Mt.DEG2RAD,Number(e[2])*Mt.DEG2RAD],i=new kn(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new PBe(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),n=i.addVariable("uCurrentPosition",r+zBe,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+VBe,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",ZBe,NBe(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=OBe({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new k(0,0,0)},uWorldQuaternion:{value:new li(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new k(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new li(0,0,0,1)},uColliderPos:{value:new k(0,0,0)},uColliderSize:{value:new k(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new li(0,0,0,1)},uColliderQuaternionInvert:{value:new li(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/U3}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...Wg(this.system.data).shape,size:p};this.emitterShape.applyToShader(n.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new k(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===e.fromMeshId&&(r=n)}),r?new k3(i,t,e.type,r):new k3(i,t,"SphereEmitterShape")}else return new k3(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new abe(new Hc(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(Wg(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},nx=class extends _a{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Bt,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...Wg(t)},this.geometry.setAttribute("position",new _t([],3)),this.material=new ah({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new QBe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),dr(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...ss.drop(e,1).props}}),dr(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...ss.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){this.timeoutId=window.setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting(),clearTimeout(this.timeoutId)}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function KBe(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}var F3=KBe();function JBe(e,t,i){var n;F3!==void 0&&(((n=t==null?void 0:t.geometry)==null?void 0:n.subdivisions)??0)>F3&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=F3);let r;return t.geometry.type==="TextGeometry"?new lU(e,t,i):t.geometry.type==="InputGeometry"?new gU(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new ob(e,t,i):t.geometry.type==="PathGeometry"?r=new mU(e,t,i):t.geometry.type==="VectorGeometry"?r=new CBe(e,t,i):t.geometry.type==="BooleanGeometry"?r=new im(e,t,i):t.geometry.type==="ShapeBlendGeometry"?r=new rm(e,t,i):t.geometry.type==="UIGeometry"?r=new Gs(e,t,i):r=new En(e,t,i),r)}function yU(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?JBe(e,t,i):t.type==="Empty"?new Fv(e,t):t.type==="Particle"?new nx(e,t,i):t.type==="ParticleCollider"?new rx(e,t,i):t.type==="Splat"?new Fv(e,t):t.type==="Bone"?new TBe(e,t):t.type==="Page"?new rs(e,t,i):t.type==="PointLight"?new ABe(e,t,i):t.type==="SpotLight"?new gie(e,t,i):t.type==="DirectionalLight"?new mie(e,t,i):t.type==="Component"||t.type==="Instance"?new Vv(e,t,i):$f.is(t.type)?new Ys(e,t):(console.error(t),new Fv(e,t))}_d.createEntity=yU;function $Be(e,t,i){let r=yU(e.identity,t,i),n=e.children,s=e.attachedPaths,a=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...n],e.attachedPaths=s,e.parent=a,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}_d.changeEntityProptotype=$Be;_d.Cloner=Qo;function eke(e,t,i,r){e.updateByOp(t,i,r,!1)}var uf=5,sx=new Bt;sx.setAttribute("position",new Zt(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var EE=class extends Bbe{constructor(e){super({...e,depthTest:!1,depthWrite:!1,glslVersion:AI,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function tke(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/uf};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/uf};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/uf};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/uf};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/uf}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var AE=new op,ike=class{constructor(){this.pyramidPassScene=new Wa,this.pyramidPassMaterial=new EE({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let e=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=e,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let t=new gr(sx,this.pyramidPassMaterial);t.frustumCulled=!1,this.pyramidPassScene.add(t)}renderPyramid(e,t,i,r,n){new fk().min.setScalar(0);let s=t.length-1,a=new li;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?n[0]:n[1],h=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=t[c],p=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,d/p,d/p),c===2&&e%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/p,0,3/p,3/p),i.render(this.pyramidPassScene,AE);let f=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=f,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=t[c+1])}i.setViewport(a);let l=t.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},vl=24,ms=96,hc=tke(),uu=2,Tie=class extends En{constructor(e,t,i){super(e,t,i),this.data=t,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new Wa,this.potentialPassScene=new Wa,this.voxelPassScene=new Wa,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new Bt,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new gr(sx,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new ga(hc.triTable,16,256,fE,rr);r.needsUpdate=!0;let n=new ga(hc.numTrisTable,256,1,fE,rr);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new gr(sx,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new gr(sx,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(oke.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Oi({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Oi({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new k},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new k,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new ve(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new ve(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,AE),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,AE),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,AE),Tie.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new Bt,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Zt(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(e){e!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=e,this.spatialn=Math.ceil(e/(4*vl)))}get npart(){return this._npart}set resolutionLevel(e){let t=Math.min(8,Math.max(5,e));if(t!==this._resolutionLevel){switch(this._resolutionLevel=t,this.resolution=Math.pow(2,t),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=31*8*uu,this.bboxOffset=8*uu*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=63*4*uu,this.bboxOffset=4*uu*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=127*2*uu,this.bboxOffset=2*uu*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*uu,this.bboxOffset=uu*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let e=this._spatialPassRenderTargets[this.resolutionLevel];return e||(e=new Ii(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Rr,type:rr,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:_i,magFilter:_i}),this._spatialPassRenderTargets[this.resolutionLevel]=e),e}get potentialPassRenderTarget(){let e=this._potentialPassRenderTargets[this.resolutionLevel];return e||(e=new Ii(this.basePyramidSize,this.basePyramidSize,{format:Rr,type:rr,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:_i,magFilter:_i}),this._potentialPassRenderTargets[this.resolutionLevel]=e),e}get voxelPassRenderTarget(){let e=this._voxelPassRenderTargets[this.resolutionLevel];return e||(e=new FJ(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:_i,magFilter:_i}),e.texture[0].format=Rr,e.texture[0].type=rr,e.texture[1].format=fE,e.texture[1].type=rr,this._voxelPassRenderTargets[this.resolutionLevel]=e),e}get pyramidRenderTarget(){let e=this._pyramidRenderTargets[this.resolutionLevel];if(!e){let t=new Ii(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Rr,type:rr,stencilBuffer:!1,depthBuffer:!1,magFilter:_i,minFilter:_i}),i=new Ii(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Rr,type:rr,stencilBuffer:!1,depthBuffer:!1,magFilter:_i,minFilter:_i});e=[t,i],this._pyramidRenderTargets[this.resolutionLevel]=e}return e}updateState(e,t){let i=this.material;super.updateState(e,t),i!==this.material&&(this.needsRebuild=!0),e.geometry&&(this.resolutionLevel=e.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),e.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Zt(new Float32Array(this.geometry.drawRange.count*3),3)):!e.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${hc.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${vl-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${ms}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${hc.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*vl}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${vl}.);
				pc_FragColor.z = spatialKey(lowi+${2*vl}.);
				pc_FragColor.w = spatialKey(lowi+${3*vl}.);
			}
		`;return new EE({name:"Spatial Pass",fragmentShader:e,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let e=`
			precision highp float;
			out vec4 pc_FragColor;

			${hc.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${hc.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${vl}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/ms};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*vl}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${vl}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*vl}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*vl}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${hc.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new EE({name:"PotentialPass",fragmentShader:e,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let e=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${hc.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${hc.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new EE({name:"VoxelPass",fragmentShader:e,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(e){let t=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${uu}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${hc.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;e.vertexShader=t+e.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=e.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;e.fragmentShader=`in vec4 marchColor;
`+e.fragmentShader.replace(r[0],n),Object.assign(e.uniforms,this.marchPassUniforms)}initDebugPass(e){console.log("fboToDebug.width",e.width,e.height),this.geometry=new Hc(e.width,e.height),this.geometry.userData={parameters:{width:4,height:4}};let t={inputTexture:{value:Array.isArray(e.texture)?e.texture[1]:e.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,t.pyramidTextureSize.value=new ve(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,t)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},rm=Tie;rm.streamCompaction=new ike;var rke=new lt,nke=new lt,ug=new ni,kh=new k,YS=new k,ske=new ni;function ake(e,t=0){let i=this.children.length;for(;i--;){let r=this.children[i];em.is(r)&&Pie.call(r,e,t+1)}}function Pie(e,t=0){if(e(this,t)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];em.is(r)&&Pie.call(r,e,t+1)}}}function oke(){if(this.shapesDataTexture.value===void 0){let a=new ga(new Float32Array(4*ms*uf),ms,uf,Rr,rr);this.shapesDataTexture.value=a}let e=this.shapesDataTexture.value,t=e.image.data;e.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=rke.copy(this.matrixWorld).invert(),s=0;ake.call(this,a=>{var g;if(a.visible===!1)return!0;let o;if(a instanceof Qo||a instanceof rx||a instanceof nx)return;a instanceof Ms?o=a.object:o=a;let l=(g=a.data)==null?void 0:g.cloner;if(Di.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof En))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(nke.multiplyMatrices(n,a.matrixWorld).decompose(YS,ug,kh),c.type==="TorusGeometry"&&c.arc!==360){let y=c.arc*Math.PI/180;y=y/4,ug.multiply(ske.set(0,0,Math.sin(y),Math.cos(y)))}let h=u.overrideGlobalBlend?u.blendRange:r;h=h/this.bboxSize*2,t[s*4]=(YS.x-this.bboxOffset)/this.bboxSize*2,t[s*4+1]=(YS.y-this.bboxOffset)/this.bboxSize*2,t[s*4+2]=(YS.z-this.bboxOffset)/this.bboxSize*2,t[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,t[ms*4+s*4]=-ug.x,t[ms*4+s*4+1]=-ug.y,t[ms*4+s*4+2]=-ug.z,t[ms*4+s*4+3]=ug.w;let d=new Float32Array(4),p=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*kh.x+h,d[2]*kh.x+h,d[3]*kh.x+h);else if(c.type==="CubeGeometry"){p=c.cornerRadius;let y=c.width,x=c.height,_=c.depth;d[0]=2,d[1]=(y-2*p)/this.bboxSize,d[2]=(x-2*p)/this.bboxSize,d[3]=(_-2*p)/this.bboxSize,i=Math.max(i,Math.sqrt(y**2+x**2+_**2)/this.bboxSize*kh.x+h)}else if(c.type==="CylinderGeometry"){p=c.cornerRadius;let y=c.height,x=c.radiusBottom,_=c.radiusTop;if(_>=x){let M=Math.atan2(_-x,y),S=(Math.PI/2-M)/2;_-=p/Math.tan(S),x-=p*Math.tan(S)}else if(x>_){let M=Math.atan2(x-_,y),S=(Math.PI/2-M)/2;_-=p*Math.tan(S),x-=p/Math.tan(S)}d[1]=(c.height-2*p)/this.bboxSize,x===_?(d[0]=3,d[2]=x/this.bboxSize*2):(d[0]=4,d[2]=x/this.bboxSize*2,d[3]=_/this.bboxSize*2),i=Math.max(i,d[1]*4*kh.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],t[ms*12+s*4+3]=d[2];let y=2*Math.atan2(d[2]/2,d[1]),x=c.arc*Math.PI/180/2-y;d[1]=Math.sin(x),d[2]=Math.cos(x)}i=Math.max(i,c.width*kh.x/this.bboxSize+h)}t.set(d,ms*8+s*4),t[ms*12+s*4]=h,t[ms*12+s*4+1]=p/this.bboxSize*2,t[ms*12+s*4+2]=kh.x;let f=o.material,v=f.uniforms.nodeU0.node.value,m=f.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(m=-1),t[ms*16+s*4]=v.r,t[ms*16+s*4+1]=v.g,t[ms*16+s*4+2]=v.b,t[ms*16+s*4+3]=m,m<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var Die=512;function Y8(e,t){let i=!1,r=e.layers.mask&Die,n=t.getLayersOfType("transmission"),s=t.getLayersOfType("outline");return s.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,oU(e),aU(e)),n.length===0&&s.length===0&&e.layers.set(0),r&&e.layers.set(9),e instanceof j0&&e.needsAO&&e.layers.enable(5),i}function Z8(e,t){if(!t.layers)return!1;let i=e.layers.mask&Die,r=!1,n=t.getLayersOfType("transmission").filter(a=>a.data.visible),s=t.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(e.layers.set(3),s.length>0&&e.layers.enable(8),r=!0),n.length===0&&s.length===0&&e.layers.set(0),i&&e.layers.set(9),e.needsAO&&e.layers.enable(5),r}function lke(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof j0)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Y8(i,i.material[r])&&(t=!0);else Y8(i,i.material)&&(t=!0)}),t}function cke(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof j0)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)Z8(i,i.material[r])&&(t=!0);else Z8(i,i.material)&&(t=!0)}),t}var uke=new g$,hke=new lt,dke=new T0;function uN(e,t,i,r=!1){let n=e.cloner;if(n)for(let s of n.children){let a=hke.copy(s.matrixWorld).invert(),o=dke.copy(t.ray).applyMatrix4(a),l=e.matrixWorld;o.applyMatrix4(l);let c=uke;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?s:e})}}var pke=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}t.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!t.has(n[a])){let o=e.find(n[a]);o?o.applyPathSnapping(e):console.warn(`missing entity ${n[a]}`),t.add(n[a])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},fke="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",Md=class{};S1(Md,"DepthMapRange",65536),S1(Md,"MemoryPageSize",65536),S1(Md,"BytesPerFloat",4),S1(Md,"BytesPerInt",4);function mke(e){let t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m;function g(D){let N=new Float64Array(u,a,16);for(let I=0;I<16;I++)N[I]=D[I];let U;if(r>1){t.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let I=new Uint32Array(r);U=I.buffer,I.set(new Uint32Array(u,l,r))}else if(r===1){let I=new Uint32Array(r);I[0]=new Uint32Array(u,n,i)[0],U=I.buffer}else U=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:U},[U])}function y(D,N,U){let I=new Float32Array(u,s,i*3);r=0;let G=new Uint32Array(u,n,i);for(let Q=0;Q<U.length-1;Q++){let Y=N[Q],O=D[Q].elements,V=Y.filter(W=>W.enabled&&W.mode==="Include").map(W=>W.type==="Box"?S(W):P(W)),F=Y.filter(W=>W.enabled&&W.mode==="Exclude").map(W=>W.type==="Box"?S(W):P(W));for(let W=U[Q];W<U[Q+1];W++){let ee=p[W*3],ae=p[W*3+1],K=p[W*3+2];if((V.length===0||_(ee,ae,K,V))&&(F.length===0||!_(ee,ae,K,F))){let $=1/(O[3]*ee+O[7]*ae+O[11]*K+O[15]);I[r*3]=(O[0]*ee+O[4]*ae+O[8]*K+O[12])*$,I[r*3+1]=(O[1]*ee+O[5]*ae+O[9]*K+O[13])*$,I[r*3+2]=(O[2]*ee+O[6]*ae+O[10]*K+O[14])*$,G[r]=W,r++}}}}function x(D,N){let U=[],I=N.filter(Y=>Y.enabled&&Y.mode==="Include").map(Y=>Y.type==="Box"?S(Y):P(Y)),G=N.filter(Y=>Y.enabled&&Y.mode==="Exclude").map(Y=>Y.type==="Box"?S(Y):P(Y)),Q=D.length;for(let Y=0;Y<Q;Y+=3){let O=D[Y],V=D[Y+1],F=D[Y+2];(I.length===0||_(O,V,F,I))&&(G.length===0||!_(O,V,F,G))||U.push(Y/3)}return U}function _(D,N,U,I,G){return I.some(Q=>{let Y=M(D,N,U,Q.invRotationMatrix,Q.cropCenter);return Array.isArray(Q)?A(Y.x,Y.y,Y.z,Q):C(Y.x,Y.y,Y.z,Q)})}function M(D,N,U,I,G){let Q=D-G[0],Y=N-G[1],O=U-G[2],V=1/(I[3]*Q+I[7]*Y+I[11]*O+I[15]);return{x:(I[0]*Q+I[4]*Y+I[8]*O+I[12])*V+G[0],y:(I[1]*Q+I[5]*Y+I[9]*O+I[13])*V+G[1],z:(I[2]*Q+I[6]*Y+I[10]*O+I[14])*V+G[2]}}function S(D){let N=D.cropSize[0]/2,U=D.cropSize[1]/2,I=D.cropSize[2]/2,G=[D.cropCenter[0]-N,D.cropCenter[1]-U,D.cropCenter[2]-I,D.cropCenter[0]+N,D.cropCenter[1]+U,D.cropCenter[2]+I],Q=E(D.cropRotation);return Object.assign(G,{invRotationMatrix:Q,cropCenter:D.cropCenter})}function E(D){let N=[],U=D[0]*Math.PI/180,I=D[1]*Math.PI/180,G=D[2]*Math.PI/180,Q=Math.cos(U),Y=Math.sin(U),O=Math.cos(I),V=Math.sin(I),F=Math.cos(G),W=Math.sin(G),ee=Q*F,ae=Q*W,K=Y*F,$=Y*W;return N[0]=O*F,N[1]=-O*W,N[2]=V,N[4]=ae+K*V,N[5]=ee-$*V,N[6]=-Y*O,N[8]=$-ee*V,N[9]=K+ae*V,N[10]=Q*O,N[12]=0,N[13]=0,N[14]=0,N[3]=0,N[7]=0,N[11]=0,N[15]=1,N}function A(D,N,U,I){return D>=I[0]&&D<=I[3]&&N>=I[1]&&N<=I[4]&&U>=I[2]&&U<=I[5]}function P(D){let N=2/D.cropSize[0],U=2/D.cropSize[1],I=2/D.cropSize[2],G=E(D.cropRotation);return{invRadiusX:N,invRadiusY:U,invRadiusZ:I,cropCenter:D.cropCenter,invRotationMatrix:G}}function C(D,N,U,I){let G=(D-I.cropCenter[0])*I.invRadiusX,Q=(N-I.cropCenter[1])*I.invRadiusY,Y=(U-I.cropCenter[2])*I.invRadiusZ;return G*G+Q*Q+Y*Y<=1}e.onmessage=D=>{if(D.data.getCroppedIndexes){let N=new Uint32Array(x(new Float32Array(D.data.positions),D.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:N},[N])}else if(D.data.positions)h=D.data.positions,p=new Float32Array(h),v=D.data.meshMatrixWorlds,m=D.data.cropsArray,f=D.data.meshIndexIntervals,y(v,m,f),e.postMessage({sortSetupComplete:!0});else if(D.data.sort||D.data.newMatrixWorlds||D.data.newCropsArray)(D.data.newMatrixWorlds||D.data.newCropsArray)&&(m=D.data.newCropsArray||m,v=D.data.newMatrixWorlds||v,y(v,m,f)),g(D.data.sort.view,D.data.sort.cameraPosition);else if(D.data.init){d=D.data.init.Constants,i=D.data.init.splatCount;let N=d.BytesPerInt,U=d.BytesPerFloat*3,I=new Uint8Array(D.data.init.sorterWasmBytes),G=N+U,Q=i*G,Y=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,O=d.MemoryPageSize*32,V=Q+Y+O,F=Math.floor(V/d.MemoryPageSize)+1,W={module:{},env:{memory:new WebAssembly.Memory({initial:F*2,maximum:F*3,shared:!0})}};WebAssembly.compile(I).then(ee=>WebAssembly.instantiate(ee,W)).then(ee=>{t=ee,n=0,s=i*N,a=s+i*U,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=W.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function gke(e){let t=new Worker(URL.createObjectURL(new Blob(["(",mke.toString(),")(self)"],{type:"application/javascript"}))),i=atob(fke),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:Md.BytesPerFloat,BytesPerInt:Md.BytesPerInt,DepthMapRange:Md.DepthMapRange,MemoryPageSize:Md.MemoryPageSize}}}),t}var V3=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),vke=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},ZS=new ve;function Q8(e){let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(t=!0)}),t}var CE=class extends gr{constructor(e,t,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,n,s){let a=CE.buildGeomtery(t),o=CE.buildMaterial(n);return new CE(e,t,a,o,i,r,n,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new ve},viewport:{type:"v2",value:new ve},basisViewport:{type:"v2",value:new ve},debugColor:{type:"v3",value:new Yt},covariancesTextureSize:{type:"v2",value:new ve(1024,1024)},centersColorsTextureSize:{type:"v2",value:new ve(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Oi({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:If,depthTest:!0,depthWrite:!1,side:qs})}static buildGeomtery(e){let t=new Bt;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new Zt(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new f$().copy(t),s=new Uint32Array(e),a=new jx(s,1,!1);return a.setUsage(Wge),n.setAttribute("splatIndex",a),n.instanceCount=e,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(e,e+n*4).set(r.colorsA),e+=n*4,this.centers.subarray(t,t+n*3).set(r.decoded.xyz.denormDequant().data),t+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new ve(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new ve(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=_we.toHalfFloat(this.covariances[u]);r=new ga(n,t.x,t.y,bA,sh)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),r=new ga(n,t.x,t.y,bA,rr);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,p=u*4;s[p]=vke(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=V3(this.centers[d]),s[p+2]=V3(this.centers[d+1]),s[p+3]=V3(this.centers[d+2])}let a=new ga(s,i.x,i.y,DJ,Vu);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new ga(l,o,1,Rr,rr);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:t},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(ZS.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(ZS),this.material.uniforms.basisViewport.value.set(2/ZS.x,2/ZS.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},Lie,yke=new Promise(e=>{Lie=e}),K8=!1,QS;function xke(){if(K8)return;if(QS)return QS;async function e(){let t=await sp(()=>import("./gaussian-splat-compression-ro4O0smp.js"),[]);Lie(t),K8=!0}return QS=e(),QS}var Rie;yke.then(e=>Rie=e);var bke=class{constructor(e={}){S1(this,"updateView",function(){let t=new lt,i=[],r=new k(0,0,-1),n=new k(0,0,-1),s=new k,a=new k;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,p=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(p=!0),!d&&!p&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),t.copy(l.matrixWorld).invert(),t.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new lt().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new ve;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new k().fromArray(e.position)),e.orientation&&(e.orientation=new ni().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&t.push(s)}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(a=>a.data));let i=t.map(s=>new Rie.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((n,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=n.data):Object.entries(n.data).forEach(([a,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][a][u])?(e=!0,this.cropsArray[i][s][a]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[a])&&(e=!0,this.cropsArray[i][s][a]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new k,r=new ni,n=!1,s=1,a,o){this.splatMesh=CE.buildMesh(e,t,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(e){this.sortWorker=gke(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){this.splatMesh!==null&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},hN=new ah;hN.wireframe=!0;var J8=new k,xU=class extends Wa{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new pke,this.invisibleObjects=new Fv("jflkdsafjasdifjaslk",{...vO.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new rs("fdasfa",{...d0.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=cke(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=lke(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof rs&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>iee(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===U0)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof rs&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof rs&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof Gs&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof rs&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),Ll(n)&&Wu(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");r.traverseEntity(s=>{s instanceof rm&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(a=>a!==s))}),this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Wu(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Ll(r)&&(r.freeBooleanPointer(),n instanceof im&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof mU&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let n=r.parent;this.markNeedsRecomputeInstancesForAncessors(n),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;s.children.splice(a,0,s.children.pop()),Ll(r)&&(r.invalidateUpstreamBooleanData(),Wu(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof im&&n.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof rs&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let n=this.find(e);if(n)try{eke(n,t,i,{scene:this,shared:r}),n instanceof En&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,n,s=[]){e.updateEntityByOp(t,i,r,n),this.traverseEntity(a=>{(a instanceof Gs||a instanceof rs)&&(s.includes(a.frameId??"")||a.frameId===t)&&a.updateEntity2DByOp(t,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof Ys&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Di.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Di.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,n,s,a){if(e){let o=r.find(e);o&&o!==r&&n.forInstancesRec(l=>{l.data=Jx(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...tee(h.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let f=p.uuid,v=Un.zoom(u,t);v[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,n,s){e.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...t,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...t,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...t,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof Vv&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(t.forInstancesRec(s=>{s.data=Jx(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of iC.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof Vv&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),vU(n)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof Vv&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Di.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Di.is(s)&&!s.raycastLock&&(s.visible||a!=null&&a.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(Ll(s)||$O(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),uN(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let n of r.children){let s=n.cloner;Di.is(n)&&(n.visible||s!=null&&s.object.data.visible)&&((Ll(n)||$O(n)&&this.enableHelpers&&n.objectHelper.visible)&&(e.intersectObject(n,!1,t),uN(n,e,t,!0)),i(n))}};return i(this),t}forEachEntity(e){for(let t of this.children)Di.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Di.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Di.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof En&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===e){let r=i.geometry,n=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(n);let s=i.invalidateDownstreamBooleanData();Wu(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)em.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Di.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let n of e)this.createObject(n.id,n.data,n.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,n,s){var l;let a={scene:this,shared:s},o=yU(e,t,a);return o instanceof rm&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,a),o instanceof En&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof En&&u.bones&&u.boneInverses){let h=u.bones.map(f=>this.find(f)),d=u.boneInverses.map(f=>new lt().fromArray(f)),p=new sk(h,d);c.bind(p,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,n=e.length;r<n;++r){let{id:s,recursive:a}=e[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new fn;return i.setFromPoints(t),i.getCenter(J8),J8}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof _a)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof Kd&&e(t.material[i]);else t.material instanceof Kd&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof Ys&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(){this.splatViewer=new bke({scene:this}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.loadSplat()}},TE=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},wke=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Ske(Math.atan2(r,i))},_ke=(e,t,i)=>{let r={x:0,y:0};return i=dN(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},dN=e=>e*(Math.PI/180),Ske=e=>e*(180/Math.PI),Mke=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,j3=new Map,$8=e=>{j3.has(e)&&clearTimeout(j3.get(e)),j3.set(e,setTimeout(e,100))},xC=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},e9=(e,t,i)=>{let r=t.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},Iie=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),t9=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},pN=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},bU=(e,t,i)=>{let r=Oie(e);for(let n in r)if(r.hasOwnProperty(n))if(typeof t=="string")r[n]=t+" "+i;else{let s="";for(let a=0,o=t.length;a<o;a+=1)s+=t[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},Eke=(e,t)=>{let i=Oie(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},Oie=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},H3=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},Ake=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},fN=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},Cke=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(Nie="ontouchstart"in window,zie=!!window.PointerEvent,Bie=!!window.MSPointerEvent);var Nie,zie,Bie,qy={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},vv,lb={};zie?vv=qy.pointer:Bie?vv=qy.MSPointer:Nie?(vv=qy.touch,lb=qy.mouse):vv=qy.mouse;function ym(){}ym.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(t);return i};ym.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};ym.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},t)})};ym.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=Ake(t.options,e))};ym.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},xC(e,vv[t],i._domHandlers_[t]),lb[t]&&xC(e,lb[t],i._domHandlers_[t]),i};ym.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},e9(e,vv[t],i._domHandlers_[t]),lb[t]&&e9(e,lb[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var wU=ym;function Gn(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=Gn.id,Gn.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}Gn.prototype=new wU;Gn.constructor=Gn;Gn.id=0;Gn.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};Gn.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=Eke("borderRadius","50%"),i=bU("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},H3(r.el,i),this.options.shape==="circle"&&H3(r.back,t),H3(r.front,t),this.applyStyles(r),this};Gn.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};Gn.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};Gn.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};Gn.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};Gn.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};Gn.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};Gn.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",n={};n.front=bU("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};Gn.prototype.restCallback=function(){var e=this,t={};t.front=bU("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};Gn.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};Gn.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(t>i&&t<i*3&&!e.lockX?n="up":t>-i&&t<=i&&!e.lockY?n="left":t>-i*3&&t<=-i&&!e.lockX?n="down":e.lockY||(n="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?a="up":a="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+a,e),c.angle||this.trigger("dir dir:"+n,e)}else this.resetDirection();return e};var Tke=Gn;function mn(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=mn.id,mn.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}mn.prototype=new wU;mn.constructor=mn;mn.id=0;mn.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,n=t.length;r<n;r+=1)if(t[r].identifier===i)return t[r];return!1}};mn.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};mn.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};mn.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)n={x:e.x-a.x,y:e.y-a.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new Tke(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(pN(c.ui.el,n),pN(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};mn.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};mn.prototype.bindNipple=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};mn.prototype.pressureFn=function(e,t,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==n&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),n=s)}).bind(r),100)};mn.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=Iie(e),t.updateBox();var n=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[e[0]];o.identifier=a,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return fN(e,n),t.manager.bindDocument(),!1};mn.prototype.processOnStart=function(e){var t=this,i=t.options,r,n=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,a={x:e.pageX,y:e.pageY},o=t.getOrCreate(n,a);o.identifier!==n&&t.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=TE(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};mn.prototype.getOrCreate=function(e,t){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(t,e),n)};mn.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.scroll;if(!Mke(e)){this.processOnEnd(e);return}if(!n){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=TE(l,n.position),u=wke(l,n.position),h=dN(u),d=c/o,p={distance:c,position:l},f,v;if(n.options.shape==="circle"?(f=Math.min(c,o),v=_ke(n.position,f,u)):(v=Cke(l,n.position,o),f=TE(v,n.position)),i.follow){if(c>o){let x=l.x-v.x,_=l.y-v.y;n.position.x+=x,n.position.y+=_,n.el.style.top=n.position.y-(t.box.top+s.y)+"px",n.el.style.left=n.position.x-(t.box.left+s.x)+"px",c=TE(l,n.position)}}else l=v,c=f;var m=l.x-n.position.x,g=l.y-n.position.y;n.frontPosition={x:m,y:g},i.dataOnly||pN(n.ui.front,n.frontPosition);var y={identifier:n.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:m/o,y:-g/o},raw:p,instance:n,lockX:i.lockX,lockY:i.lockY};y=n.computeDirection(y),y.angle={radian:dN(180-u),degree:180-u},n.trigger("move",y),t.trigger("move "+n.id+":move",y)};mn.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),n=t.nipples.get(r),s=t.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),t.trigger("removed "+n.id+":removed",n),t.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(t.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),t.trigger("end "+n.id+":end",n),t.ids.indexOf(n.identifier)>=0&&t.ids.splice(t.ids.indexOf(n.identifier),1),t.actives.indexOf(n)>=0&&t.actives.splice(t.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?t.idles.push(n):t.nipples.indexOf(n)>=0&&t.nipples.splice(t.nipples.indexOf(n),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};mn.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};mn.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var Pke=mn;function hs(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=t9(),t.config(e),t.prepareCollections();var i=function(){var n;t.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:t.scroll.x+n.left,y:t.scroll.y+n.top}})})};if(typeof window>"u")return t.collections;xC(window,"resize",function(){$8(i)});var r=function(){t.scroll=t9()};return xC(window,"scroll",function(){$8(r)}),t.collections}hs.prototype=new wU;hs.constructor=hs;hs.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};hs.prototype.create=function(e){return this.createCollection(e)};hs.prototype.createCollection=function(e){var t=this,i=new Pke(t,e);return t.bindCollection(i),t.collections.push(i),i};hs.prototype.bindCollection=function(e){var t=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};hs.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};hs.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};hs.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};hs.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};hs.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};hs.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};hs.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};hs.prototype.onAny=function(e,t){var i=this,r,n="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=Iie(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),fN(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return fN(t,a),!1};hs.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};hs.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var Dke=hs,i9=new Dke,Lke={create:function(e){return i9.create(e)},factory:i9},kie=new Map,ax=new Map,Sf=class{constructor(e,t,i,r){this.data=t;let{audio:n,volume:s,delay:a,loop:o}=t;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new I1({src:l,volume:s,delay:a,loop:o}),ax.has(i.uuid)?ax.get(i.uuid).push(this):ax.set(i.uuid,[this]),kie.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},mN=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=kie.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=ax.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...ax.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Uie=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new Sf(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new mN(t);else throw new Error("Missing property")}dispatchBasic(){if(_r(this.shared,this.condition)===!1)return!1;this.interaction instanceof Sf?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(_r(this.shared,this.condition)===!1)return!1;this.interaction instanceof Sf?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(_r(this.shared,this.condition)===!1)return!1;this.interaction instanceof Sf&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},Fie=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},e);return}this.particleSystem.start()}stop(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},e);return}this.particleSystem.stop()}freeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},e);return}this.particleSystem.froze()}unFreeze(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},e);return}this.particleSystem.unFroze()}reset(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},e);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(_r(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(_r(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(e){if(_r(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},Rke="text/plain",Ike="us-ascii",r9=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),Oke=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=t?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===Ike)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==Rke)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function Nke(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return Oke(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];r9(a,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])r9(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var zke=class{constructor({url:e,context:t},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:Nke(e,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=t??"tab"}dispatch(){var e;if(_r(this.shared,this.condition)===!1)return!1;Jb?window.location.assign(this.url):(this.context==="tab"||eee&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp($t[0]),J2e())}},Vie=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=a.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(a.cloner){for(let h of a.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=a.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(_r(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(_r(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},jie=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(_r(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),RU(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Hie={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},_U={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},Bke=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],bC={CSS:{},springs:{}};function zl(e,t,i){return Math.min(Math.max(e,t),i)}function ox(e,t){return e.indexOf(t)>-1}function G3(e,t){return e.apply(null,t)}var si={arr:function(e){return Array.isArray(e)},obj:function(e){return ox(Object.prototype.toString.call(e),"Object")},pth:function(e){return si.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||si.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return si.hex(e)||si.rgb(e)||si.hsl(e)},key:function(e){return!Hie.hasOwnProperty(e)&&!_U.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function Gie(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function Wie(e,t){var i=Gie(e),r=zl(si.und(i[0])?1:i[0],.1,100),n=zl(si.und(i[1])?100:i[1],.1,100),s=zl(si.und(i[2])?10:i[2],.1,100),a=zl(si.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(f){var v=t?t*f/1e3:f;return l<1?v=Math.exp(-v*l*o)*(u*Math.cos(c*v)+h*Math.sin(c*v)):v=(u+h*v)*Math.exp(-v*o),f===0||f===1?f:1-v}function p(){var f=bC.springs[e];if(f)return f;for(var v=1/6,m=0,g=0;;)if(m+=v,d(m)===1){if(g++,g>=16)break}else g=0;var y=m*v*1e3;return bC.springs[e]=y,y}return t?d:p}function kke(e){return e===void 0&&(e=10),function(t){return Math.ceil(zl(t,1e-6,1)*e)*(1/e)}}var Uke=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,p,f){var v,m,g=0;do m=h+(d-h)/2,v=s(m,p,f)-u,v>0?d=m:h=m;while(Math.abs(v)>1e-7&&++g<10);return m}function l(u,h,d,p){for(var f=0;f<4;++f){var v=a(h,d,p);if(v===0)return h;var m=s(h,d,p)-u;h-=m/v}return h}function c(u,h,d,p){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var f=new Float32Array(e);if(u!==h||d!==p)for(var v=0;v<e;++v)f[v]=s(v*t,u,d);function m(g){for(var y=0,x=1,_=e-1;x!==_&&f[x]<=g;++x)y+=t;--x;var M=(g-f[x])/(f[x+1]-f[x]),S=y+M*t,E=a(S,u,d);return E>=.001?l(g,S,u,d):E===0?S:o(g,y,y+t,u,d)}return function(g){return u===h&&d===p||g===0||g===1?g:s(m(g),h,p)}}return c}(),Xie=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=zl(r,1,10),a=zl(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){t[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(t).forEach(function(r){var n=t[r];e["easeIn"+r]=n,e["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},e["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),e}();function SU(e,t){if(si.fnc(e))return e;var i=e.split("(")[0],r=Xie[i],n=Gie(e);switch(i){case"spring":return Wie(e,t);case"cubicBezier":return G3(Uke,n);case"steps":return G3(kke,n);default:return G3(r,n)}}function qie(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function zT(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in e){var a=e[s];t.call(r,a,s,e)&&n.push(a)}return n}function BT(e){return e.reduce(function(t,i){return t.concat(si.arr(i)?BT(i):i)},[])}function n9(e){return si.arr(e)?e:(si.str(e)&&(e=qie(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function MU(e,t){return e.some(function(i){return i===t})}function EU(e){var t={};for(var i in e)t[i]=e[i];return t}function gN(e,t){var i=EU(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function kT(e,t){var i=EU(e);for(var r in t)i[r]=si.und(e[r])?t[r]:e[r];return i}function Fke(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function Vke(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function jke(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,n=parseInt(t[3],10)/100,s=t[4]||1;function a(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(p-d)*6*f:f<1/2?p:f<2/3?d+(p-d)*(2/3-f)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function Hke(e){if(si.rgb(e))return Fke(e);if(si.hex(e))return Vke(e);if(si.hsl(e))return jke(e)}function Ju(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function Gke(e){if(ox(e,"translate")||e==="perspective")return"px";if(ox(e,"rotate")||ox(e,"skew"))return"deg"}function vN(e,t){return si.fnc(e)?e(t.target,t.id,t.total):e}function Pc(e,t){return e.getAttribute(t)}function AU(e,t,i){var r=Ju(t);if(MU([i,"deg","rad","turn"],r))return t;var n=bC.CSS[t+i];if(!si.und(n))return n;var s=100,a=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(t);return bC.CSS[t+i]=c,c}function Yie(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?AU(e,n,i):n}}function CU(e,t){if(si.dom(e)&&!si.inp(e)&&(Pc(e,t)||si.svg(e)&&e[t]))return"attribute";if(si.dom(e)&&MU(Bke,t))return"transform";if(si.dom(e)&&t!=="transform"&&Yie(e,t))return"css";if(e[t]!=null)return"object"}function Zie(e){if(si.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(t);)r.set(n[1],n[2]);return r}}function Wke(e,t,i,r){var n=ox(t,"scale")?1:0+Gke(t),s=Zie(e).get(t)||n;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?AU(e,s,r):s}function TU(e,t,i,r){switch(CU(e,t)){case"transform":return Wke(e,t,r,i);case"css":return Yie(e,t,i);case"attribute":return Pc(e,t);default:return e[t]||0}}function PU(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Ju(e)||0,n=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function Qie(e,t){if(si.col(e))return Hke(e);if(/\s/g.test(e))return e;var i=Ju(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function DU(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Xke(e){return Math.PI*2*Pc(e,"r")}function qke(e){return Pc(e,"width")*2+Pc(e,"height")*2}function Yke(e){return DU({x:Pc(e,"x1"),y:Pc(e,"y1")},{x:Pc(e,"x2"),y:Pc(e,"y2")})}function Kie(e){for(var t=e.points,i=0,r,n=0;n<t.numberOfItems;n++){var s=t.getItem(n);n>0&&(i+=DU(r,s)),r=s}return i}function Zke(e){var t=e.points;return Kie(e)+DU(t.getItem(t.numberOfItems-1),t.getItem(0))}function Jie(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return Xke(e);case"rect":return qke(e);case"line":return Yke(e);case"polyline":return Kie(e);case"polygon":return Zke(e)}}function Qke(e){var t=Jie(e);return e.setAttribute("stroke-dasharray",t),t}function Kke(e){for(var t=e.parentNode;si.svg(t)&&si.svg(t.parentNode);)t=t.parentNode;return t}function $ie(e,t){var i=t||{},r=i.el||Kke(e),n=r.getBoundingClientRect(),s=Pc(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function Jke(e,t){var i=si.str(e)?qie(e)[0]:e,r=t||100;return function(n){return{property:n,el:i,svg:$ie(i),totalLength:Jie(i)*(r/100)}}}function $ke(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=$ie(e.el,e.svg),n=i(),s=i(-1),a=i(1);switch(e.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function s9(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Qie(si.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:si.str(e)||t?r.split(i):[]}}function ere(e){var t=e?BT(si.arr(e)?e.map(n9):n9(e)):[];return zT(t,function(i,r,n){return n.indexOf(i)===r})}function tre(e){var t=ere(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:Zie(i)}}})}function eUe(e,t){var i=EU(t);if(/^spring/.test(i.easing)&&(i.duration=Wie(i.easing)),si.arr(e)){var r=e.length,n=r===2&&!si.obj(e[0]);n?e={value:e}:si.fnc(t.duration)||(i.duration=t.duration/r)}var s=si.arr(e)?e:[e];return s.map(function(a,o){var l=si.obj(a)&&!si.pth(a)?a:{value:a};return si.und(l.delay)&&(l.delay=o?0:t.delay),si.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(a){return kT(a,i)})}function tUe(e){for(var t=zT(BT(e.map(function(s){return Object.keys(s)})),function(s){return si.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=t[s];i[a]=e.map(function(o){var l={};for(var c in o)si.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<t.length;n++)r(n);return i}function iUe(e,t){var i=[],r=t.keyframes;r&&(t=kT(tUe(r),t));for(var n in t)si.key(n)&&i.push({name:n,tweens:eUe(t[n],e)});return i}function rUe(e,t){var i={};for(var r in e){var n=vN(e[r],t);si.arr(n)&&(n=n.map(function(s){return vN(s,t)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function nUe(e,t){var i;return e.tweens.map(function(r){var n=rUe(r,t),s=n.value,a=si.arr(s)?s[1]:s,o=Ju(a),l=TU(t.target,e.name,o,t),c=i?i.to.original:l,u=si.arr(s)?s[0]:c,h=Ju(u)||Ju(l),d=o||h;return si.und(a)&&(a=c),n.from=s9(u,d),n.to=s9(PU(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=SU(n.easing,n.duration),n.isPath=si.pth(s),n.isColor=si.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var ire={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,n){if(r.list.set(t,i),t===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),e.style.transform=s}}};function rre(e,t){var i=tre(e);i.forEach(function(r){for(var n in t){var s=vN(t[n],r),a=r.target,o=Ju(s),l=TU(a,n,o,r),c=o||Ju(l),u=PU(Qie(s,c),l),h=CU(a,n);ire[h](a,n,u,r.transforms,!0)}})}function sUe(e,t){var i=CU(e.target,t.name);if(i){var r=nUe(t,e),n=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function aUe(e,t){return zT(BT(e.map(function(i){return t.map(function(r){return sUe(i,r)})})),function(i){return!si.und(i)})}function nre(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):t.duration,n.delay=i?Math.min.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):t.delay,n.endDelay=i?n.duration-Math.max.apply(Math,e.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,n}var a9=0;function oUe(e){var t=gN(Hie,e),i=gN(_U,e),r=iUe(i,e),n=tre(e.targets),s=aUe(n,r),a=nre(s,i),o=a9;return a9++,kT(t,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var el=[],o9=[],PE,lUe=function(){function e(){PE=requestAnimationFrame(t)}function t(i){var r=el.length;if(r){for(var n=0;n<r;){var s=el[n];s.paused?(el.splice(n,1),r-=1):(s.tick(i),n++)}e()}else PE=cancelAnimationFrame(PE)}return e}();function cUe(e){document.hidden?(el.forEach(function(t){return t.pause(e.timeStamp)}),o9=el.slice(0),pn.running=el=[]):o9.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",cUe);function pn(e){e===void 0&&(e={});var t=0,i=0,r=0,n,s,a=0,o=null;function l(S){var E=window.Promise&&new Promise(function(A){return o=A});return S.finished=E,E}var c=oUe(e);l(c);function u(){var S=c.direction;S!=="alternate"&&(c.direction=S!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(E){(E.loop===1||E.loop%2===0)&&(E.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(S){return S.reversed=!1})}function d(S){return c.reversed?c.duration-S:S}function p(){t=0,i=d(c.currentTime)*(1/pn.speed)}function f(S,E,A=!1){E&&(c.reversed?E.seek(E.duration*E.loop-(S-E.timelineOffset-E.pingPongDelayCorrection),A):E.seek(S-E.timelineOffset-E.startOnceDelay-E.pingPongDelayCorrection,A))}function v(S,E=!1){if(c.reversed)for(var A=a;A--;)f(S,s[A],E);else for(var P=0;P<a;P++)f(S,s[P],E)}function m(S){var ye,pe,me,ge,xe,te,we,Ce,Se,Re;var E=0,A=c.animations,P=A.length;for(c.direction!=="alternate"&&((ye=c.parent)==null?void 0:ye.direction)==="alternate"?((pe=c.parent)==null?void 0:pe.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((me=c.parent)!=null&&me.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S):_(!1,(ge=c.parent)==null?void 0:ge.rewind,c.rewind,(xe=c.parent)==null?void 0:xe.reversePlayback,c.reversePlayback)&&((te=c.parent)!=null&&te.reversed&&c.direction==="alternate"?S=c.duration-c.delay+c.endDelay-S:S=c.duration+c.delay-c.endDelay-S);E<P;){var C=A[E],D=C.animatable,N=C.tweens,U=N.length-1,I=N[U];U&&(I=zT(N,function(Be){return S<Be.end})[0]||I);let Xe;(we=c.parent)!=null&&we.reversed&&c.direction==="alternate"?Xe=zl(S-I.start-I.endDelay,0,I.duration)/I.duration:Xe=zl(S-I.start-I.delay,0,I.duration)/I.duration;for(var G=isNaN(Xe)?1:I.easing(Xe),Q=I.to.strings,Y=I.round,O=[],V=I.to.numbers.length,F=void 0,W=0;W<V;W++){var ee=void 0;let Be,Fe;c.direction!=="alternate"?((Ce=c.parent)==null?void 0:Ce.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(Be=I.to.numbers[W],Fe=I.from.numbers[W]||0):(Fe=I.to.numbers[W],Be=I.from.numbers[W]||0):_(!0,(Se=c.parent)==null?void 0:Se.rewind,c.rewind,(Re=c.parent)==null?void 0:Re.reversePlayback,c.reversePlayback)?(Be=I.to.numbers[W],Fe=I.from.numbers[W]||0):(Fe=I.to.numbers[W],Be=I.from.numbers[W]||0),I.isPath?ee=$ke(I.value,G*Fe):ee=Be+G*(Fe-Be),Y&&(I.isColor&&W>2||(ee=Math.round(ee*Y)/Y)),O.push(ee)}var ae=Q.length;if(!ae)F=O[0];else{F=Q[0];for(var K=0;K<ae;K++){Q[K];var $=Q[K+1],ie=O[K];isNaN(ie)||($?F+=ie+$:F+=ie+" ")}}ire[C.type](D.target,C.property,F,D.transforms),C.currentValue=F,E++}}function g(S){c[S]&&!c.passThrough&&c[S](c)}function y(){c.remaining&&c.remaining!==!0&&c.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function _(S,E,A,P,C){return x[S<<4|E<<3|A<<2|P<<1|C]}function M(S,E=!1){var N;var A=c.duration;let P=c.delay,C=A-c.endDelay;(N=c.parent)!=null&&N.reversed&&c.direction==="alternate"&&(P=c.endDelay,C=A-c.delay);var D=d(S);if(c.progress=zl(D/A*100,0,100),E||(c.reversePlayback=D<c.currentTime),a&&v(D,E),!c.began&&c.currentTime>=0&&(c.began=!0,g("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,g("loopBegin")),(c.reversed||D>=0)&&D<=P&&c.currentTime!==0&&(m(0),g("change")),(D>=C&&c.currentTime!==A+c.pingPongDelayCorrection||!A)&&(m(A),g("change")),D>P&&D<C?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,g("changeBegin")),m(D),g("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,g("change"),a&&g("timelineChangeComplete")):c.began&&D>C&&g("changeComplete"),c.currentTime=zl(D,0,A+c.pingPongDelayCorrection),c.began&&g("update"),S>=A)if(y(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,g("loopComplete"),g("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?t+=c.duration/pn.speed:t+=c.duration;for(let U of s)U.setStartTime(0),U.remaining=U.loop;g("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var S=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=S==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var E=a;E--;)c.children[E].reset();m(c.reversed?c.duration:0)},c.setStartTime=function(S){t=S},c.set=function(S,E){return rre(S,E),c},c.tick=function(S){r=S,t||(t=r),M((r+(i-t))*pn.speed)},c.seek=function(S,E=!1){M(S-t,E)},c.pause=function(S){c.paused=!0,a&&(n=S??performance.now())},c.play=function(S){!c.paused||(c.completed&&c.reset(),c.paused=!1,el.push(c),a&&n!==void 0&&(t+=(S??performance.now())-n),PE||lUe())},c.reverse=function(){u(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function l9(e,t){for(var i=t.length;i--;)MU(e,t[i].animatable.target)&&t.splice(i,1)}function uUe(e){for(var t=ere(e),i=el.length;i--;){var r=el[i],n=r.animations,s=r.children;l9(t,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;l9(t,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function hUe(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?SU(t.easing):null,n=t.grid,s=t.axis,a=t.from||0,o=a==="first",l=a==="center",c=a==="last",u=si.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,p=Ju(u?e[1]:e)||0,f=t.start||0+(u?h:0),v=[],m=0;return function(g,y,x){if(o&&(a=0),l&&(a=(x-1)/2),c&&(a=x-1),!v.length){for(var _=0;_<x;_++){if(!n)v.push(Math.abs(a-_));else{var M=l?(n[0]-1)/2:a%n[0],S=l?(n[1]-1)/2:Math.floor(a/n[0]),E=_%n[0],A=Math.floor(_/n[0]),P=M-E,C=S-A,D=Math.sqrt(P*P+C*C);s==="x"&&(D=-P),s==="y"&&(D=-C),v.push(D)}m=Math.max.apply(Math,v)}r&&(v=v.map(function(U){return r(U/m)*m})),i==="reverse"&&(v=v.map(function(U){return s?U<0?U*-1:-U:Math.abs(m-U)}))}var N=u?(d-h)/m:h;return f+N*(Math.round(v[y]*100)/100)+p}}function dUe(e){e===void 0&&(e={});var t=pn(e);return t.duration=0,t.add=function(i,r){var n=el.indexOf(t),s=t.children;n>-1&&el.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=kT(i,gN(_U,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=si.und(r)?c:PU(r,c),a(t);var u=pn(l);a(u),s.push(u),u.parent=t;var h=nre(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}pn.version="3.2.0";pn.speed=1;pn.running=el;pn.remove=uUe;pn.get=TU;pn.set=rre;pn.convertPx=AU;pn.path=Jke;pn.setDashoffset=Qke;pn.stagger=hUe;pn.timeline=dUe;pn.easing=SU;pn.penner=Xie;pn.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var sre=pn,c9=new k,u9=new k,h9=new ni;function pUe(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let n=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(n>=1)return i.copy(e);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*e.w+r*t.w,i.x=u*e.x+r*t.x,i.y=u*e.y+r*t.y,i.z=u*e.z+r*t.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function xs(e,t,i,r,n,s){let a=i[e]!==void 0?i[e]:void 0,o=r[e];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:t[e],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Mt.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function LU(e,t,i,r,n,s){let a=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||Lk(c,u)))return{update:h=>{c.forEach((d,p)=>{let f=Mt.lerp(d,u[p],h);t[e][p]=s?Math.trunc(f):f})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function wC(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function d9(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?wC(new k,s,n):o.clone(),c=wC(new k,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function p9(e,t,i){return t.forEach((r,n)=>{e.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function _C(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=!(o instanceof ve),c=o instanceof ve?o:new ve().fromArray(o),u=s?p9(new ve,s,n):c.clone(),h=p9(new ve,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function fUe(e,t,i,r){let n=i[e]?i[e]:void 0,s=r[e];if(!s)return;let a=t[e],o=n?new lt().fromArray(n):a.clone(),l=new k,c=new ni,u=new k;o.decompose(l,c,u);let h=new lt().fromArray(s),d=new k,p=new ni,f=new k;if(h.decompose(d,p,f),!o.equals(h))return{update:v=>{h9.slerpQuaternions(c,p,v),c9.lerpVectors(l,d,v),u9.lerpVectors(u,f,v),a.compose(c9,h9,u9)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,p,f)}}}function mUe(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=s?typeof s=="string"?n.getColor(s).clone():new Yt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Yt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{var d,p;u.lerpColors(l,c,h),(p=(d=t[e])==null?void 0:d.copy)==null||p.call(d,u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function KS(e,t,i,r,n){let s=i[e]?i[e]:void 0,a=r[e];if(!a)return;let o=t[e],l=new As(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new As(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new As(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Mt.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function cp(e,t,i,r,n){if(typeof t[e]=="number")return xs(e,t,i??{},r,n);if(Array.isArray(t[e]))return LU(e,t,i??{},r,n)}function gUe(e,t,i,r){var o,l,c,u;let n=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,a=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(a!==void 0){let h=s??e.zoom,d=a;h!==d&&n.push({update:p=>{e.zoom=Mt.lerp(h,d,p),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=xs("targetOffset",e,t,i,r);h&&n.push(h)}return n}function vUe(e,t,i,r){if(i.scaleBaked===void 0)return;let n=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Bf.isEqual(n,s))return;let a=[];return a.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[Mt.lerp(n[0],s[0],o),Mt.lerp(n[1],s[1],o),Mt.lerp(n[2],s[2],o)]},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},start:()=>{e.updateGeometryInteractions({scaleBaked:n},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData(),e.refreshAttachedClonersInteractions()}}),a}function yUe(e,t,i,r){if(!i.extrusion)return;let n=e.extrusion,s=t.extrusion??{},a=i.extrusion,o=[];return Bee.forEach(l=>{let c=cp(l,n,s,a,r);c&&o.push(c)}),o}function xUe(e,t,i,r){let n=[];if(!("geometry"in i))return n;let s=e.geometry.userData.parameters,a="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof ob){let l=vUe(e,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Bc(s,QD),Bc(a,QD)),QD.forEach(c=>{let u=cp(c,l,a,o,r);u&&n.push(u)}),e instanceof mU){Object.assign(l,{extrusion:{...s.extrusion}});let c=yUe(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded(),e.refreshAttachedClonersInteractions()}})}return n}function bUe(e,t,i,r){let n=[];if(i.intensity!==void 0){let s=xs("intensity",e,t,i,r);s&&n.push(s)}if(i.color!==void 0){let s=mUe("color",e,t,i,r);s&&n.push(s)}return n}function wUe(e,t,i,r){let n=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in t&&t.materials?t.materials:[],a=i.materials;e.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...f9(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in t&&t.material?t.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...f9(e.material,s,a,r))}return n}function f9(e,t,i,r){var a;let n=[],s=gv(i,r)||!!t.layers&&gv(t,r);n.push(DUe(e,s));for(let o of e.layers){let l=(a=t.layers)==null?void 0:a.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!Oee.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),p;if(h==="colors")p=TUe(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(p=CUe(o,l,c,h));else if(typeof d=="number")p=_Ue(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof ve?p=SUe(o,l,c,h):d instanceof k?p=MUe(o,l,c,h,r):d instanceof As?p=AUe(o,l,c,h,r):d instanceof Yt?p=EUe(o,l,c,h,r):"isTexture"in d&&(p=PUe(o,l,c,h))}p&&(Array.isArray(p)?n.push(...p):n.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return n}function _Ue(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{e.setValue(r,Mt.lerp(o,l,c))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function SUe(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let n=e.getValue(r),s=t?new ve().fromArray(t[r]):n.clone(),a=new ve().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function MUe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),a=t?t[r]:void 0,o=i[r],l=a?wC(new k,a,n):s.clone(),c=wC(new k,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function EUe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Yt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Yt().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function AUe(e,t,i,r,n){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,a=i[r],o=e.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Yt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new As(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function CUe(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s,o=i[r];return Lk(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=Mt.lerp(h,d,l)}e.setValue(r,c)},start:()=>{e.setValue(r,a)},end:()=>{e.setValue(r,o)}}),n.length?n:void 0}function TUe(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let n=[],s=e.getValue(r),a=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];qA.isEqual(c,u)||n.push({update:h=>{s[l].fromArray(qA.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function PUe(e,t,i,r="texture"){var m,g;if(!e.hasValue(r)||!(r in i))return;let n=e.getNode("rotation"),s=((m=t==null?void 0:t[r])==null?void 0:m.rotation)??0,a=((g=i[r])==null?void 0:g.rotation)??0;if(n&&s!==a)return{update:y=>{n.value=Mt.lerp(s,a,y)*Mt.DEG2RAD},start:()=>{n.value=s*Mt.DEG2RAD},end:()=>{n.value=a*Mt.DEG2RAD}};let o=e.getNode("mat");if(!o)return;let l=t?t[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],p=[...c.offset],f=l.rotation??0,v=c.rotation??0;if(!Gu.isEqual(u,d)||!Gu.isEqual(h,p)||f!==v)return{update:y=>{o.repeat=Gu.lerp(u,d,y),o.offset=Gu.lerp(h,p,y),o.rotation=Mt.lerp(f,v,y),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=f,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...p],o.rotation=v,o.updateMatrix()}}}function DUe(e,t){return{update:()=>{e.transparent=t}}}var W3=new k,m9=new kn;function LUe(e,t,i,r,n){var f,v,m,g,y,x;let s=[],a,o,l,c,u,h,d,p;if(e instanceof us?(a=_C("position",e,t,i,n),a&&s.push(a),l=xs("rotation",e,t,i,n),l&&s.push(l),c=_C("shear",e,t,i,n),c&&s.push(c)):(p={slide:((f=t.pathSnapping)==null?void 0:f.slide)??((v=e.updatedPathSnapping)==null?void 0:v.slide)??((m=e.dataPatched.pathSnapping)==null?void 0:m.slide)??0,offset:((g=t.pathSnapping)==null?void 0:g.offset)??((y=e.updatedPathSnapping)==null?void 0:y.offset)??((x=e.dataPatched.pathSnapping)==null?void 0:x.offset)??0},h=xs("slide",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),h&&s.push(h),d=xs("offset",p,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=d9("position",e,t,i,n),a&&s.push(a),o=d9("scale",e,t,i,n),o&&s.push(o),l=RUe(e,t,i,r,n),l&&s.push(l),u=fUe("hiddenMatrix",e,t,i),u&&s.push(u))),a||o||l||u||h||d){let _=e instanceof us?()=>{e.updateWorldMatrix(!0,!1,!0),e.resetBBoxNeedsUpdate()}:()=>{var M;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(M=e.parent)!=null&&M.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Ll(e)&&Wu(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,p))};s.push({update:_,start:_,end:_})}return s}function RUe(e,t,i,r,n){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Mt.DEG2RAD):void 0,a=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(n.getVariable(h)??0):h)*Mt.DEG2RAD);if(!a)return;let o=s?new k().fromArray(s):new k().setFromEuler(e.rotation),l=new k().fromArray(a);if(o.equals(l))return;let c=W3.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new ni().setFromEuler(m9.setFromVector3(o)),d=new ni().setFromEuler(m9.setFromVector3(l));return{update:p=>{pUe(h,d,e.quaternion,p)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{W3.lerpVectors(o,l,h),e.rotation.setFromVector3(W3)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function IUe(e,t,i,r){let n=[];if(!("cloner"in i)||!e.cloner)return n;let s=e.cloner,a="cloner"in t?t.cloner:{},o=i.cloner;Tee.forEach(p=>{let f;p==="count"?f=xs("count",s.parameters,a,o,r,!0):f=cp(p,s.parameters,a??{},o,r),f&&n.push(f)});let l=OUe(s,a,o,r);l!=null&&l.length&&n.push(...l);let c=NUe(s,a,o,r);c!=null&&c.length&&n.push(...c);let u=zUe(s,a,o,r);u!=null&&u.length&&n.push(...u);let h=BUe(s,a,o,r);h!=null&&h.length&&n.push(...h);let d=kUe(s,a,o,r);return d!=null&&d.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function OUe(e,t,i,r){if(e.parameters.type!=="radial")return;let n=t.radial,s=i.radial;if(!s)return;let a=e.parameters.radial,o=[];return Pee.forEach(l=>{let c=cp(l,a,n??{},s,r);c&&o.push(c)}),o}function NUe(e,t,i,r){if(e.parameters.type!=="linear")return;let n=t.linear,s=i.linear;if(!s)return;let a=[],o=e.parameters.linear;return Dee.forEach(l=>{let c=cp(l,o,n??{},s,r);c&&a.push(c)}),a}function zUe(e,t,i,r){if(e.parameters.type!=="grid")return;let n=t.grid,s=i.grid;if(!s)return;let a=[],o=e.parameters.grid;return Lee.forEach(l=>{let c;l==="count"?c=LU(l,o,n??{},s,r,!0):c=cp(l,o,n??{},s,r),c&&a.push(c)}),a}function BUe(e,t,i,r){if(e.parameters.type!=="toObject")return;let n=t.toObject,s=i.toObject;if(!s)return;let a=[],o=e.parameters.toObject;return Ree.forEach(l=>{let c;l==="count"?c=xs(l,o,n??{},s,r,!0):c=cp(l,o,n??{},s,r),c&&a.push(c)}),a}function kUe(e,t,i,r){if(!e.parameters.randomness)return;let n=t.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=e.parameters.randomnessObject;return Iee.forEach(l=>{let c=cp(l,o,n??{},s,r);c&&a.push(c)}),a}function UUe(e,t){return{update:()=>{e instanceof ns&&(e.fill.enabled=t)}}}function FUe(e,t){return{update:()=>{e instanceof ns&&(e.stroke.enabled=t)}}}function VUe(e,t){return{update:()=>{e instanceof ns&&(e.dropShadow.enabled=t)}}}function jUe(e,t){return{update:()=>{e instanceof ns&&(e.innerShadow.enabled=t)}}}function HUe(e,t){return{update:()=>{e instanceof ns&&(e.backgroundBlur.enabled=t)}}}function GUe(e,t){return{update:()=>{e instanceof ns&&(e.layerBlur.enabled=t)}}}function WUe(e,t,i,r,n){let s=[],a,o,l,c,u,h,d,p,f,v,m,g,y,x,_;if("width"in e&&(a=xs("width",e,t,i,n),a&&s.push(a)),"height"in e&&(o=xs("height",e,t,i,n),o&&s.push(o)),e instanceof ns||e instanceof Uc){let M={...t.fill},S={...i.fill};M.enabled!==void 0&&M.enabled!==S.enabled&&(s.push(UUe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),l=KS("color",e.fill,M,S,n),l&&s.push(l)}if(e instanceof ns){let M={...t.stroke},S={...i.stroke};(M.enabled||S.enabled)&&(s.push(FUe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),c=KS("color",e.stroke,M,S,n),c&&s.push(c),u=xs("thickness",e.stroke,M,S,n),u&&s.push(u)}if(e instanceof ns){let M={...t.dropShadow},S={...i.dropShadow};(M.enabled||S.enabled)&&(s.push(VUe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),h=KS("color",e.dropShadow,M,S,n),h&&s.push(h),d=xs("blurRadius",e.dropShadow,M,S,n),d&&s.push(d),f=xs("spread",e.dropShadow,M,S,n),f&&s.push(f),p=_C("offset",e.dropShadow,M,S,n),p&&s.push(p)}if(e instanceof ns){let M={...t.innerShadow},S={...i.innerShadow};(M.enabled||S.enabled)&&(s.push(jUe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}})),v=KS("color",e.innerShadow,M,S,n),v&&s.push(v),m=xs("blurRadius",e.innerShadow,M,S,n),m&&s.push(m),y=xs("spread",e.innerShadow,M,S,n),y&&s.push(y),g=_C("offset",e.innerShadow,M,S,n),g&&s.push(g)}if(e instanceof ns||e instanceof Uc){let M={...t.backgroundBlur},S={...i.backgroundBlur};(M.enabled||S.enabled)&&(s.push(HUe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),x=xs("radius",e.backgroundBlur,M,S,n),x&&s.push(x)}if(e instanceof ns){let M={...t.layerBlur},S={...i.layerBlur};(M.enabled||S.enabled)&&(s.push(GUe(e,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),S.enabled||Object.assign(S,{enabled:!0,radius:0})),_=xs("radius",e.layerBlur,M,S,n),_&&s.push(_)}if(e instanceof Uc||e instanceof sw){let M=LU("cornerRadius",e,t,i,n);M&&s.push(M)}return s}function g9(e,t,i,r,n){let s=[];return e.data.visible&&s.push(...LUe(e,t,i,n,r)),e instanceof us?s.push(...WUe(e,t,i,n,r)):(e.data.visible&&s.push(...IUe(e,t,i,r)),Ll(e)?(e instanceof En&&e.data.visible&&s.push(...xUe(e,t,i,r)),e.data.visible&&s.push(...wUe(e,t,i,r))):DOe(e)?e.data.visible&&s.push(...bUe(e,t,i,r)):POe(e)&&s.push(...gUe(e,t,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,a)})},end:a=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,a)})}}:void 0}var v9=new k;function RU(e,t,i=!1){var s;let r=[],n=a=>{let o=a.data;delete a.states,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=wf.patch(o,c)}x9(e.scene,a,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),y9(e)};e.scene.traverse2D(n),e.traverseChildren(a=>{var u,h,d,p,f,v;if(i&&((u=a.rigidBody)==null||u.setTranslation(a.position0,!0),(h=a.rigidBody)==null||h.setRotation(a.rotation0,!0),(d=a.rigidBody)==null||d.setLinvel(v9,!0),(p=a.rigidBody)==null||p.setAngvel(v9,!0)),!Di.is(a))return;let o=a.uuid,l=a.data;if(delete a.states,a.uuid===U0)return;let c=!1;r.some(m=>{var g;return(g=e.scene.find(o))==null?void 0:g.isDescendantOf(m)})?c=!0:((f=l.physics)==null?void 0:f.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),a.data=l,a.currentState=null,a.reversibleToState=null,a.currentTransitionEvent=null;for(let m of l.states){let g={...m.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(m.data.position!==void 0&&delete g.position,m.data.rotation!==void 0&&delete g.rotation,m.data.hiddenMatrix!==void 0&&delete g.hiddenMatrix),a.states||(a.states={}),a.states[m.id]=yf.patch(l,g)}x9(e.scene,a,null,t,l.events.find(m=>m.data.type==="Follow"||m.data.type==="LookAt")!==void 0),a instanceof Gs&&a.frame&&(a.frame.traverse(m=>n(m)),(v=a.uiCanvas)==null||v.applySize())}),y9(e),e.frame&&(e.frame.traverse(a=>n(a)),(s=e.uiCanvas)==null||s.applySize())}function y9(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=e.scene.find(n.data.object);s&&(s.visible=!1)}}})}function x9(e,t,i,r,n=!1){if(t instanceof En&&!(t instanceof rm)&&t.removeInteractionGeometry(r),t instanceof us?t.changeSelectedState(i,{shared:r},n):t.changeSelectedState(i,{scene:e,shared:r},n),t instanceof En&&t.updateGeometryGroupsIfNeeded(),t instanceof Ys&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof us)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible()}}function are(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=e;t=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(e.easing){case 0:i=id.linear;break;case 1:i=id.ease;break;case 2:i=id.easeIn;break;case 3:i=id.easeOut;break;case 4:i=id.easeInOut;break;default:i=id.linear}let[r,n,s,a]=i;t=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function yN(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var XUe={type:"beginState"},qUe={type:"completeState",isfromEntity:!1},b9=class{constructor(e,t,i,r,n,s){if(this.object=e,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof us||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Ys&&o.dispatchEvent(XUe)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof us||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Ys&&o.dispatchEvent(qUe)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=g9(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let a=DE(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=DE(this.object,t);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=DE(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...yN(r),...are(r),change:this.onChange},this.callback=g9(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},ore=class extends Ts{constructor(e,t,i,r,n){var a;if(super(),this.eventType=e,this.data=t,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{var o;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((o=this.timeline)==null||o.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!t.object)throw new Error("Missing property");let s=this.page.scene.find(t.object)??((a=this.page.uiCanvas)==null?void 0:a.find(t.object))??this.page.scene.find2DInUIObjects(t.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,t.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=t.tweens[0].data.delayDirection==="start-once"?t.tweens[0].data.delay:0,this.init()}get playing(){var e;return((e=this.timeline)==null?void 0:e.paused)===!1}get changeBegan(){return this.tweens.some(e=>e.changeBegan)??!1}init(){this.initialCurrentState=DE(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&vG(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,n,s,a;try{let o=yN(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=sre.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],p;u===c&&(this.object.wasMovedByUser===!0||((n=this.object.previousAction)==null?void 0:n.changeBegan)===!0)?(p=void 0,this.object instanceof Ys&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new b9(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],p;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.changeBegan)===!0)?(p=void 0,this.object instanceof Ys&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new b9(this.object,p,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u-1]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((a=this.object.previousAction)==null?void 0:a.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(_r(this.shared,this.condition)===!1||vG(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;clearTimeout(this.timeoutId);let e=yN(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof us?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;if(_r(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(_r(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function DE(e,t){var n;let i,r;if(typeof t=="string"?(i=t,r=(n=e.states)==null?void 0:n[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var YUe={type:"beginState"},w9={type:"completeState",isfromEntity:!1},_9={type:"requestRender"},lre=class extends Ts{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new k,this.posEnd=new k,this.qStart=new ni,this.qEnd=new ni,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=sre({targets:i,t:1,...are(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(YUe));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(_9),i.t===1&&r.dispatchEvent(w9)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(_r(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(_r(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,e!==this.toggleIsForward)try{this.playing?((t=this.animation)==null||t.pause(),this.toggleIsForward=e??!this.toggleIsForward,this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,n;this.toggleIsForward=e??!this.toggleIsForward,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(n=this.animation)==null||n.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(w9),this.page.activeCamera.dispatchEvent(_9))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}};function cre(e){let t=e==null?void 0:e.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(t!=null&&t.length){let i=_2e(t);return i&&i>2?i:2}return 2}var ure=class extends Ts{constructor(e,t,i,r,n){var l,c,u;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,a=t.scene.find(e.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];if(this.duration=((l=o==null?void 0:o.getClip())==null?void 0:l.duration)??1,this.data.crop2){let h=cre(o==null?void 0:o.getClip());this.leftFrameTime=this.data.crop2[0]/(h-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(h-1)*this.duration}else{let h=(u=(c=o==null?void 0:o.getClip())==null?void 0:c.tracks[0])==null?void 0:u.times.length;h&&h>1?(this.leftFrameTime=this.data.crop[0]/h*this.duration,this.rightFrameTime=this.data.crop[1]/h*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(_r(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===t&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Mt.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(_r(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([n,s])=>{let a=n.split("/")[1];this.threeAnimAction!==s&&a===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},hre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(_r(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target||t.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),RU(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},dre=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=_r(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=pte(this.data.expression,this.shared,Ss.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},pre=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(_r(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},ZUe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){if(_r(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(e=>{var i;this.shared.getVariable(e);let t=(i=this.shared.data.variables.data(e))==null?void 0:i.value;t!==void 0&&this.shared.updateVariable(e,t),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(QO(e))})}dispose(){}},QUe=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r}dispatch(){var e;if(_r(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&((e=this.shared.getUserAPI(this.data.userAPIId))==null||e.callUserAPI(this.shared))}dispose(){}};function _r(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=pte(t.expression,e,"boolean");return t.negate?!i:!!i}function Dn(e,t,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?Bs[e.type].includes("Audio")&&a.Audio.push(new Uie(c,u,s,r,l)):u.type==="Video"&&!(s instanceof us)?Bs[e.type].includes("Video")&&a.Video.push(new mre(c,u,s,r,l)):u.type==="Particles"?Bs[e.type].includes("Particles")&&a.Particles.push(new Fie(u,i,r,l)):u.type==="Link"?Bs[e.type].includes("Link")&&a.Link.push(new zke(u,n.controlsManager,r,l)):u.type==="Create"?Bs[e.type].includes("Create")&&a.Create.push(new gre(u,i,n.controlsManager,r,l)):u.type==="Destroy"?Bs[e.type].includes("Destroy")&&a.Destroy.push(new Vie(u,i,n.controlsManager,r,l)):u.type==="Reset"?Bs[e.type].includes("Reset")&&a.Reset.push(new jie(u,i,r,n,l)):u.type==="Transition"?Bs[e.type].includes("Transition")&&a.Transition.push(new ore(e.type,u,i,r,l)):u.type==="SwitchCamera"?Bs[e.type].includes("SwitchCamera")&&a.SwitchCamera.push(new lre(u,i,r,l)):u.type==="SceneTransition"?Bs[e.type].includes("SceneTransition")&&a.SceneTransition.push(new hre(u,i,n,r,l)):u.type==="Animation"?Bs[e.type].includes("Animation")&&a.Animation.push(new ure(u,i,n.animationControls,r,l)):u.type==="SetVariable"?Bs[e.type].includes("SetVariable")&&a.SetVariable.push(new dre(u,i,r,l)):u.type==="DynamicVariablePlay"?Bs[e.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new pre(u,i,r,l)):u.type==="Conditional"?Bs[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?Bs[e.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new ZUe(u,i,r,l)):u.type==="UserAPI"&&Bs[e.type].includes("UserAPI")&&a.UserAPI.push(new QUe(u,i,r,l))}catch{}};return t.forEach(o()),a}function ls(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof Uie||i instanceof mre||i instanceof Fie||i instanceof ure||i instanceof ore||i instanceof gre||i instanceof Vie||i instanceof lre||i instanceof hre||i instanceof jie||i instanceof dre||i instanceof pre)&&i.dispose()})})}function KUe(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(n=>n.uuid===t):i=e.material.layers.find(n=>n.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var fre=new Map,lx=new Map,jv=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=KUe(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,Jb&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),lx.has(i.uuid)?lx.get(i.uuid).push(this):lx.set(i.uuid,[this]),fre.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},xN=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=fre.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=lx.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...lx.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},mre=class{constructor(e,t,i,r,n){if(this.data=t,this.shared=r,this.condition=n,t.interaction==="play")this.interaction=new jv(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new xN(t);else throw new Error("Missing property")}dispatchBasic(){if(_r(this.shared,this.condition)===!1)return!1;this.interaction instanceof jv?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(_r(this.shared,this.condition)===!1)return!1;this.interaction instanceof jv?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},S9=(()=>{let e,t,i,r;function n(o){!e&&!M9()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&u[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(u[p.userData.actionId]>p.userData.quantity&&u[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){M9()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function M9(){return!!document&&document.hidden}var E9=new ni,JUe=new k,$Ue=new k,gre=class{constructor(e,t,i,r,n){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Mt.generateUUID(),this.dispatch=()=>{if(_r(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(_r(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=F2e(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new Ms(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),S9(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{var u,h,d,p;a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof Qo)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof Ms)o=a.object;else if(o=a,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(a instanceof Qo)return;a instanceof Ms?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new k().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=a.rigidBody)==null||h.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(JUe,E9,$Ue),l.applyQuaternion(E9),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&((d=a.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&(a.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");S9(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},vre=200,X3=.02,q3=.3,eFe=65;new k;var A9=new k,C9=new k,tFe=new k,aa=new k,La=new k,Uh=new k,Y3=new lt,T9=new lt,iFe=new lt;new lt;var yl=new ni,hu=new ni,dc=new kn(0,0,0,"YXZ"),rFe=new k(1,0,0),xl=new k(0,1,0),nFe=new k(0,0,1),P9=new k(1,1,1);new Xa;var sFe=1,aFe=.025,oFe=16e-6,D9=12,lFe=20,Jn=new $o,Oo=new fn,cFe={type:"requestRender"},uFe={type:"updateMatrix"},L9=Math.PI/6,bN=class extends Ts{constructor(e,t,i,r,n,s,a,o,l){var f;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new lt,this.target0=new k,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=vre,this.euler0=new kn(0,0,0,"YXZ"),this.position0Cam=new k,this.quat0Cam=new ni,this.scale0Cam=new k,this.hiddenMatrix0Cam=new lt,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new $o(new k(0,-40,0),new k(0,40,0)),matrix:new lt,position:new k,rotation:new ni},this.euler=new kn(0,0,0,"YXZ"),this.eulerDelta=new k,this.lastPosition=new k,this.lastCameraQuaternion=new ni,this.lastCameraPosition=new k,this.PI_2=Math.PI/2,this.prevMouse=new ve,this.velocityTarget=new k,this.velocity=new k,this.directionXZ=new k,this.rotVelocityStick=new k,this.rotVelocityTarget=new k,this.rotVelocity=new k,this.rotDirection=new k,this.nonColliderRotOffset=new lt,this.nonColliderPosOffset=new lt,this.firstPointerId=-1,this.rot=new k,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new lt,this.objectToTarget=new k,this.objectToTarget0=new k,this.objectToCamXZ=new k,this.objectToCamXZ0=new k,this.targetToCamera=new k,this.targetToCamera0=new k,this.cameraPolarAxis0=new k,this.targetPos=new k,this.targetQuat=new ni,this.lerpFactorPos=new k().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ni,this.objXZQuatInv=new ni,this.objXZRotMat=new lt,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new k,this.pushedVelocity=new k,this.groundYRotation=0,this.objectRealQuat=new ni,this.colliderWorldQuat=new ni,this.groundNormal=new k,this.groundTilt=new ni,this.groundTiltInv=new ni,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new k,this.quaternion=new ni,this.scale=new k,this.initialAction=!0,this.onPointerDown=v=>{var m;!(v.target===this.domElement||v.target instanceof HTMLElement&&v.target.tagName==="SPLINE-VIEWER"&&((m=v.target.shadowRoot)!=null&&m.contains(this.domElement)))||this.firstPointerId!==-1||(this.firstPointerId=v.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!uo&&!iG&&this.domElement.requestPointerLock(),this.prevMouse.set(v.clientX,v.clientY))},this.onPointerUp=v=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),v.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=v=>{if(v.pointerId!==this.firstPointerId)return;let m=v.clientX-this.prevMouse.x,g=v.clientY-this.prevMouse.y;this.prevMouse.set(v.clientX,v.clientY),v.pointerType==="mouse"&&this.rotBy!=="keys"&&(iG&&Q2e<15.5&&!uo?(this.eulerDelta.y=-m*this.mouseOrbitSensitivity,this.eulerDelta.x=-g*this.mouseOrbitSensitivity):(this.eulerDelta.y=-v.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-v.movementY*this.mouseOrbitSensitivity)),v.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-m*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-g*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=v=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?bN.isLocked=!0:bN.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let v in this.movementState)this.movementState[v]=0},this.onKeyDown=v=>{!(v.target instanceof HTMLInputElement)&&(v.code==="ArrowLeft"||v.code==="ArrowUp"||v.code==="ArrowRight"||v.code==="ArrowDown"||v.code==="Space")&&v.preventDefault();for(let m of this.keyAssignments)if(v.key.toUpperCase()===m[1]||v.key===m[1]){this.movementState[m[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=v=>{for(let m of this.keyAssignments)if(v.key.toUpperCase()===m[1]||v.key===m[1]||v.code.slice(3,v.code.length).toUpperCase()===m[1]){this.movementState[m[0]]=0;break}},this.copyVRGamePadValues=(v,m)=>{for(let g=2;g<4;g++){let y=v.axes[g];m===0?g===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(v.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,g===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,e===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((f=this.camera)==null?void 0:f.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let v=new k(0,0,-1).applyQuaternion(this.camera.quaternion),m=new k().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(m),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let g,y;Math.abs(v.y)<1e-6?(m.y=0,v.y=0,y=m.projectOnVector(v)):m.y/v.y>0?y=v.multiplyScalar(m.y/v.y):y=v.multiplyScalar(m.length()),this.targetToCamera0.copy(y).negate(),g=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(g,this.position);let x=new kn().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x.x,x.x=0,x.z=0,x.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x)}if(this.object instanceof Ys&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*sFe,this.speedOrbit=(i.speedRotate??100)*aFe,this.mouseOrbitSensitivity=(i.speedRotate??100)*oFe,this.keyAssignments=i.keyAssignments.map(v=>{let m=[v[0],v[1]];return m[1]==="▲"?m[1]="ArrowUp":m[1]==="◀"?m[1]="ArrowLeft":m[1]==="▼"?m[1]="ArrowDown":m[1]==="▶"?m[1]="ArrowRight":m[1]==="⇧"?m[1]="Shift":m[1]==="↵"?m[1]="Enter":m[1]==="Space"?m[1]=" ":m[1]==="⌘"?m[1]="Meta":m[1]==="Ctrl"?m[1]="Control":m[1]==="Esc"&&(m[1]="Escape"),m}),i.rotBy==="mouse"){let v;v=this.keyAssignments.findIndex(m=>m[0]==="rotNegX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(m=>m[0]==="rotPosX"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(m=>m[0]==="rotPosY"),v!==-1&&(this.keyAssignments[v][1]=""),v=this.keyAssignments.findIndex(m=>m[0]==="rotNegY"),v!==-1&&(this.keyAssignments[v][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??u0.defaultData.gravity)*D9,this.usePhysics=this.gloabalPhysics.usePhysics??u0.defaultData.usePhysics,this.jumpPower=i.jumpPower*lFe,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??rC.defaultDataThirdPerson.orientWith,this.slopeThresh=eFe*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*X3/this.pixelsPerMeter,this.stepThresh=i.collider.height*q3/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*X3/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*q3/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*X3/this.pixelsPerMeter,this.stepThresh=i.collider.height*q3/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new k().fromArray(i.collider.position),d=new ni().setFromEuler(new kn().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,P9),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let v=new kt;v.push({fi:0,data:{...ts.defaultData("light","phong"),alpha:0},id:"layer1"}),v.push({fi:0,data:{...ts.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let m=new rU({layers:v},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new gr(Xee.create({parameters:{width:p,height:p/10,hollow:.7}}),m),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new kn().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Ys?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},iC.list.forEach(i=>{this.actions[i]=Dn({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),ls(this.actions.idle),ls(this.actions.move),ls(this.actions.run),ls(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return aa.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,p,f,v;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let m=La.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*D9),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),g=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,m,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(g){this.onObject=!0,this.groundNormal.set(g.normal2.x,g.normal2.y,g.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=g.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let y=g.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(x.rigidBody===y&&x.userData.isFollowingObj!==this.object.uuid){(x.hasNonUniformScale?x.matrixWorldRigid:x.matrixWorld).decompose(aa,hu,La),this.groundVelocity.subVectors(aa,x.prevT),this.object.getWorldPosition(La).add(this.collider.position).sub(aa),this.groundYRotation=dc.setFromQuaternion(hu).y-x.prevR.y,Uh.copy(La).applyAxisAngle(xl,this.groundYRotation),this.groundVelocity.add(Uh.sub(La)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let m=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let g=aa.subVectors(this.path[1],this.position),y=La.subVectors(this.path[1],this.path[0]);g.dot(y)<0?this.path.shift():(this.directionXZ.x=y.x,this.directionXZ.z=y.z),m.opacity=m.userData.opacity0}else m.opacity-=.05*m.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=tFe.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let m=La.copy(a);m.y=0,a.set(0,a.y,m.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let m=aa;this.camera.getWorldDirection(m);let g=Uh.copy(xl).multiplyScalar(m.dot(xl));m.sub(g);let y=La.copy(this.directionXZ);y.x*=-1,this.rot.y=m.angleTo(y)*(m.cross(y).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(dc.setFromVector3(this.rot),this.moveMode==="walk"&&(dc.x=0),a.applyEuler(dc),s&&(hu.setFromUnitVectors(xl,this.groundNormal),a.applyQuaternion(hu)),i){let m=dc.set(0,this.vrEulerYOffset*L9,0);i.applyEuler(m),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let m=La;this.pushedVelocity.set(0,0,0);for(let g of this.sharedGameControlGlobals.entitiesWithTransformAnim){let y=Uh.setFromMatrixPosition(g.matrixWorld).sub(g.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=g.rigidBody.collider(0).castCollider(y,this.object.rigidBody.collider(0),aa.copy(a).divideScalar(this.pixelsPerMeter),r,!1);y.multiplyScalar(this.pixelsPerMeter);let _=Di.is(g)?g:g.object;if(x!==null&&this.lastHitObj!==_){let M;g instanceof Ms&&(M=g);let S=this.sharedGameControlGlobals.entityToCollisionEvents[_.uuid];if(S)for(let E of S)E.data.target==="character"&&(E.dispatch(M),_.dispatchEvent(_N));this.lastHitObj=_}if(x!==null){this.pushedVelocity.copy(y),m.copy(x.normal1).applyQuaternion(g.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let g=m.dot(a);g<0&&a.addScaledVector(m,-g),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(xl,this.euler.y-this.euler0.y);let m=La.copy(this.objectToCamXZ).normalize(),g=Uh.copy(a).multiplyScalar(r);g.y=0;let y=g.sub(aa.copy(m).multiplyScalar(g.dot(m))).cross(m).y;this.euler.y-=Math.atan2(y,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Mt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Mt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Mt.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(dc.copy(t),dc.y=0):(dc.copy(this.euler),dc.y=0),this.nonColliderRotOffset.makeRotationFromEuler(dc)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*L9),yl.setFromAxisAngle(rFe,this.rot.x),hu.setFromAxisAngle(xl,this.rot.y),hu.multiply(yl),yl.setFromAxisAngle(nFe,this.rot.z),hu.multiply(yl),this.quaternion.copy(hu),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let m=La.copy(a).multiplyScalar(r/this.pixelsPerMeter),g=null;this.didHit=!1;let y=new k;for(let x=0;x<5;x++){let _=m.length(),M=Uh.copy(m).normalize();if(g=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),this.colliderWorldQuat,M,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,_,!1,24,void 0,void 0,this.object.rigidBody),g!==null){this.didHit=!0;let S=this.sharedGameControlGlobals.colliderToEntity.get(g.collider.handle);if(S!==this.lastHitObj&&x===0){this.lastHitObj=S;let C=this.sharedGameControlGlobals.entityToCollisionEvents[S==null?void 0:S.uuid];if(C){for(let D of C)if(D.data.target==="character"){let N=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(g.collider.handle))._parent,U;if(S.cloner){for(let I of S.cloner.children)if(I.rigidBody===N){U=I;break}}D.dispatch(U),S.dispatchEvent(_N)}}}let E=A9.set(g.normal2.x,g.normal2.y,g.normal2.z).applyQuaternion(this.colliderWorldQuat),A=C9.copy(M).multiplyScalar(g.toi).dot(E),P=g.toi;if(P===0&&(this.position.y+=this.offset*this.pixelsPerMeter),A>this.offset&&(P=g.toi*(A-this.offset)/A,y.addScaledVector(M,P)),m.copy(M).multiplyScalar(_-P),Math.acos(-E.y)>this.slopeThresh){let C=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),D=Uh.copy(g.witness2).applyQuaternion(this.colliderWorldQuat);D.y=0;let N=C.add(D);N.y+=this.stepThresh;let U=this.sharedGameControlGlobals.rapierWorld.castShape(N,this.colliderWorldQuat,m,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);U!==null&&U.toi===0&&(E.y=0,E.normalize())}m.addScaledVector(E,-m.dot(E))}else{x===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),y.add(m);break}}this.position.addScaledVector(y,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(aa.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(yl.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let m=this.onObject?1:5,g=a.multiplyScalar(r/m);for(let y=0;y<m;y++)this.position.add(g),this.collisionAdjustment(r/m)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let m=this.objectToTarget.add(this.position),g=this.targetToCamera.add(m);Y3.lookAt(g,m,xl).setPosition(g),Y3.decompose(this.targetPos,this.targetQuat,aa),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Mt.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Mt.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(uFe),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((v=(f=this.navMeshPathDest)==null?void 0:f.material)==null?void 0:v.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(cFe),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=yl.setFromAxisAngle(xl,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Mt.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Mt.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Mt.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=aa.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=hu.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){xl.angleTo(e)*180/Math.PI<15||xl.angleTo(e)*180/Math.PI>85?yl.identity():yl.setFromUnitVectors(xl,e),this.groundTilt.slerp(yl,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var n;let t=C9.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=Y3.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(aa,yl,La).compose(aa,yl,P9);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;Oo.makeEmpty(),s.updateMatrixWorldSVD();let a=s.matrixWorldRigid,o=T9.copy(a).invert(),l=iFe.copy(T9).multiply(i);Jn.copy(this.collider.segment),Jn.start.applyMatrix4(l),Jn.end.applyMatrix4(l);let c=A9.copy(this.position).applyMatrix4(o);Oo.expandByPoint(Jn.start),Oo.expandByPoint(Jn.end),Oo.min.addScalar(-this.collider.radius),Oo.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(Jn.end)},intersectsBounds:u=>u.intersectsBox(Oo),intersectsTriangle:u=>{let h=aa,d=La,p=u.closestPointToSegment(Jn,h,d);if(p<this.collider.radius){let f=this.collider.radius-p,v=d.sub(h).normalize(),m=Uh.copy(c);m.addScaledVector(v,f);let g=m.applyMatrix4(a).sub(this.position);t.add(g),Jn.start.addScaledVector(v,f),Jn.end.addScaledVector(v,f)}}})}),Oo.makeEmpty(),Jn.copy(this.collider.segment),Jn.start.applyMatrix4(i),Jn.end.applyMatrix4(i),Oo.expandByPoint(Jn.start),Oo.expandByPoint(Jn.end),Oo.min.addScalar(-this.collider.radius),Oo.max.addScalar(this.collider.radius),(n=this.sharedGameControlGlobals.staticMeshBVH)==null||n.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(Jn.end)},intersectsBounds:s=>s.intersectsBox(Oo),intersectsTriangle:s=>{let a=aa,o=La,l=s.closestPointToSegment(Jn,a,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(a).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),Jn.start.addScaledVector(u,c),Jn.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},yre=bN;yre.isLocked=!1;var hFe=ap(SJ());function xre(e){let t=e.elements,i=t[0]**2+t[1]**2+t[2]**2,r=t[4]**2+t[5]**2+t[6]**2,n=t[8]**2+t[9]**2+t[10]**2,s=t[0]**2+t[4]**2+t[8]**2,a=t[1]**2+t[5]**2+t[9]**2,o=t[2]**2+t[6]**2+t[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function Lu(e,t){let i=new Bt;if(t&&xre(t))return i.setAttribute("position",new _t([],3)),i.setIndex([]),i;if(!e.getAttribute("position"))return i.setAttribute("position",new _t([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=RT(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new _t(r,3)),i.setIndex(n),t&&i.applyMatrix4(t),i}var dFe=new lt,pFe=new lt,pc=[[0,0,0],[0,0,0],[0,0,0]];function bre(e){let t=e.elements;pc[0][0]=t[0],pc[0][1]=t[4],pc[0][2]=t[8],pc[1][0]=t[1],pc[1][1]=t[5],pc[1][2]=t[9],pc[2][0]=t[2],pc[2][1]=t[6],pc[2][2]=t[10];let{u:i,v:r}=(0,hFe.SVD)(pc),n=dFe.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=pFe.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var fFe=class extends g${constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new lp({color:65280,linewidth:10}),t=new k(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new k(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new k().addVectors(t,i.multiplyScalar(r)),s=new Bt;return s.setFromPoints([t,n]),new AA(s,e)}},wre=e=>e instanceof Fv||e instanceof Vv;function mFe(e,t){return e.distance-t.distance}function _re(e,t,i){if(!(!Du(t)||!t.visible)){Ll(t)&&t.raycast(e,i);for(let r of t.children)_re(e,r,i)}}function LE(e,t,i,r=!1){if(!r&&!i.some(s=>SC(e,s)!==void 0))return[];let n=[];return t.children.forEach(s=>_re(e,s,n)),n.sort(mFe),n}function wN(e){let t=[];if(e.length){let i=e[0].object;Du(i)&&t.push(i);let r=i.parent;for(;r;)wre(r)&&t.push(r),r=r.parent}return t}function Ru(e,t,i,r){let n=e.frame;if(n){let s=t[0]*n.width,a=(1-t[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l!=null&&l.intersects(s,a))return r(l),!0}}return!1}function SC(e,t){if(Ll(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(wre(t))return Sre(e,t)}function Sre(e,t){if(!(!Du(t)||!t.visible)){if(Ll(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=Sre(e,i);if(r)return r}}}function gFe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function vFe(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var yFe=class{constructor(e,t,i,r,n,s,a,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new fFe,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=gFe(t,i,this._domRect),this.pointerScreen=vFe(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},$s=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},IU=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],Mre=e=>{var t;return(t=IU.find(([i,r])=>r===e))==null?void 0:t[0]},aw=e=>{var t;return(t=IU.find(([i])=>i===e))==null?void 0:t[1]},xFe=(e,t)=>{let i=Mre(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},bFe=class extends $s{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var r;if(!e.eventName||!e.target||e.eventName==="Scroll")return;let t=(r=this.splineEvents[Mre(e.eventName)])==null?void 0:r[e.target.uuid];if(!t)return;e.eventName==="Scroll"&&e.deltaY!==void 0&&Object.assign(t,{deltaY:e.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(t)}}connect(){let{page:e}=this.eventContext;e.traverseEntity(t=>{var i,r;if((i=t.data)!=null&&i.events.length){for(let[n,s]of IU)if(t.data.events.some(a=>a.data.type===s&&!a.data.disabled)){this.objectsPerEvents.has(n)?(r=this.objectsPerEvents.get(n))==null||r.push(t):this.objectsPerEvents.set(n,[t]);let a={id:t.uuid,name:t.name},o=xFe(s,a),l=this.splineEvents[n];l?l[t.uuid]=o:this.splineEvents[n]={[t.uuid]:o}}}}),this.objectsPerEvents.forEach(t=>{t.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},wFe=class{constructor(e,t,i,r,n,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=Dn(t,t.actions,r,n,s,i)}disconnect(){ls(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.some(t=>t.playing&&t.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},_Fe=class extends $s{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=LE(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{$t.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{var o,l,c,u;if(!r||!n)return;let a=aw(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),(l=(o=this.eventsPerObjects[a])==null?void 0:o[n.uuid])==null||l.forEach(h=>{h.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),(u=(c=this.eventsPerObjects[a])==null?void 0:c[n.uuid])==null||u.forEach(h=>{h.dispatchUserEvent()})))}}connect(){var n,s,a,o,l,c;let{page:e,sharedAssets:t,domElement:i}=this.eventContext,r=(u,h)=>{var p,f;if(!((p=u.data)!=null&&p.events.length))return;let d=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let v of d){let m=this.eventsPerObjects[v];if(u.data.events.filter(({data:g})=>g.type===v&&g.disabled!==!0).forEach(({id:g,data:y})=>{try{let x=new wFe(g,y,u,e,t,this.eventManager);x.actions.Video.length&&(this.hasVideoAction=!0),(y.type==="MouseDown"||y.type==="MouseUp"||y.type==="MousePress")&&(y.mode==="Canvas"||y.mode==="Window")?this.canvasMouseEvents.push(x):(m[u.uuid]?m[u.uuid].some(_=>_.id===x.id)||m[u.uuid].push(x):m[u.uuid]=[x],u instanceof rm&&u.traverseChildren(_=>{var M;if(!_.visible)return!0;_ instanceof En&&((M=_.data.geometry.shapeBlendNode)==null?void 0:M.operation)!==2&&(m[_.uuid]?m[_.uuid].push(x):m[_.uuid]=[x])}))}catch{}}),((f=m[u.uuid])==null?void 0:f.length)&&(this.objectsPerTypes[v].push(u instanceof us&&(v==="MouseDown"||v==="MouseUp"||v==="MousePress")?h:u),u instanceof rm)){let g=this.objectsPerTypes[v];u.traverseChildren(y=>{if(!y.visible)return!0;y instanceof En&&g.indexOf(y)===-1&&g.push(y)})}}};e.traverseEntity(u=>{var h;(u instanceof Gs||u instanceof rs)&&((h=u.frame)==null||h.traverse(d=>{r(d,u)})),r(u)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),((n=this.objectsPerTypes.MouseDown)!=null&&n.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),(s=this.objectsPerTypes.MouseUp)!=null&&s.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),(a=this.objectsPerTypes.MousePress)!=null&&a.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),(o=this.objectsPerTypes.KeyDown)!=null&&o.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(l=this.objectsPerTypes.KeyUp)!=null&&l.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(c=this.objectsPerTypes.KeyPress)!=null&&c.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([u,h])=>{h.forEach(d=>{d.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[e],a=s.filter(h=>!(h instanceof us));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&Ru(r,[n.x,n.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=LE(i,r,a,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];wN(h).forEach(p=>{p instanceof Gs&&Ru(p,d,Object.keys(this.eventsPerObjects[e]),f=>{this.handleObjectMouseEventDispatch(f,e)}),this.eventsPerObjects[e][p.uuid]&&this.handleObjectMouseEventDispatch(p,e)})}}t||a.forEach(h=>{var p,f;let d=SC(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof Gs&&Ru(h,[((p=d==null?void 0:d.uv)==null?void 0:p.x)??0,((f=d==null?void 0:d.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[e]),v=>{this.handleObjectMouseEventDispatch(v,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof us)),n=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=Ru(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{n.push(u)})),s&&!c){let u=LE(a,o,r);n=wN(u),u.forEach(h=>{var d,p;h.object instanceof Gs&&Ru(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{n.push(f)})})}else r.forEach(u=>{var d,p;let h=SC(a,u);h&&(n.push(u),u instanceof Gs&&Ru(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{n.push(f)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=n}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(n=>{n.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let n=this.eventsPerObjects[t][r.uuid];n.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),n.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===e.key&&n.dispatchHeld(i)})})}},SFe=new k,MFe=new k,Ere=class{constructor(e,t,i,r,n){this.actionsIn=Dn(e,e.inActions,i,r,n,t),this.actionsOut=Dn(e,e.outActions,i,r,n,t)}disconnect(){ls(this.actionsIn),ls(this.actionsOut)}},EFe=class extends Ere{constructor(e,t,i,r,n,s){super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=SFe.setFromMatrixPosition(this.objects[0].matrixWorld),u=MFe.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch()),d.ClearLocalStorage.forEach(p=>p.dispatch()),d.UserAPI.forEach(p=>p.dispatch())}};let{distance:a,fromObject:o,toObject:l}=t.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},AFe=class extends Ere{constructor(e,t,i,r,n,s){var l;super(t,i,r,n,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()),this.actionsOut.ClearLocalStorage.forEach(h=>h.dispatch()),this.actionsOut.UserAPI.forEach(h=>h.dispatch()))};let{condition:a}=t;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!((l=this.toObject.states)!=null&&l[a.state]))throw new Error("Missing property");this.toState=a.state}connect(){vf(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),vf(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),vf(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),vf(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},CFe=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let{id:n,data:s}of i.data.events)if(!s.disabled&&s.type==="Conditional")try{let a;s.condition.type==="Comparison"||(s.condition.type==="Distance"?a=new EFe(n,s,i,e,t,this.eventManager):s.condition.type==="State"&&(a=new AFe(n,s,i,e,t,this.eventManager))),a&&(this.eventsPerConditions[s.condition.type].push(a),(a.actionsIn.Video.length||a.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},Yy=new k,Fh=new k,Pp=new k,R9=new Na,TFe=.01,Qi=new k,Nn=new k,I9=new k,Mf=new ni,Z3=new kn,PFe=new lt,Q3=new Mn,hg=new k,fc=new k,dg=.2;function K3(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var DFe=function(){let e=new lt;return(t,i,r)=>{let n=t.obj;e.copy(n.hiddenMatrix),n.parent!==null&&e.premultiply(n.parent.matrixWorld),e.invert(),n.position.copy(i),t.reference==="global"&&K3(n.position,t.limits),n.position.applyMatrix4(e),t.reference==="parent"?K3(n.position,t.limits):t.reference==="local"&&(Mf.copy(t.quat0).invert(),n.position.sub(t.position0),n.position.applyQuaternion(Mf),K3(n.position,t.limits),Mf.invert(),n.position.applyQuaternion(Mf),n.position.add(t.position0)),e.multiply(r??n.matrixWorld).decompose(Qi,n.quaternion,Nn),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof _a&&Wu(n.parent)&&n.invalidateDownstreamBooleanData(!0)}}(),LFe=class{constructor(e,t,i,r,n,s,a){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=Dn(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=Dn(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new k().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new k().setFromMatrixPosition(l.matrixWorld),pointStart:new k,pointEnd:new k,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new k().copy(l.position),quat0:new ni().copy(l.quaternion),snapped:!1,orientationMatrix:new lt,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){ls(this.actionsDrag),ls(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},RFe=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{var a;if($t.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let o of this.events){let l=0;for(let{obj:c,pointEnd:u,pointStart:h}of o.dragItems){if(c===s[0].object||c===s[0].object.object||Di.is(c)&&c.isAncestorOf(s[0].object.uuid)){if(o.activeIdx=l,o.activeDragItem.reset=!1,o.activeDragItem.currentDampingFactor=o.data.dampingFactor,o.activeDragItem.snapped=!1,o.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){o.activeDragItem.obj.rigidBody&&o.activeDragItem.obj.rigidBody.setBodyType(2,!0);let d=o.activeDragItem.obj;c.hasNonUniformScale&&c.updateMatrixWorldSVD(),(d.hasNonUniformScale?d.matrixWorldRigid:d.matrixWorld).decompose(Qi,Mf,Nn),Z3.setFromQuaternion(Mf),d.prevR===void 0?(d.prevR=Z3.clone(),d.prevT=Qi.clone()):(d.prevR.copy(Z3),d.prevT.copy(Qi)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(o.activeDragItem.obj)}this.calcPlaneIntersectPos(c,h,o.data.plane,o.data.referenceFrame),u.copy(h),(this.eventManager.controlsManager.usePhysics&&((a=c.data.physics)==null?void 0:a.rigidBody)==="dynamic"||o.data.drop===!1||o.data.resetOnSnapFail===!1)&&o.activeDragItem.fromPosition.setFromMatrixPosition(o.activeDragItem.obj.matrixWorld),this.activeEvent=o,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}l++}}this.activeEvent=null},this.onPointerMove=i=>{var a,o,l,c;if($t.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if($t.length===0){let u=!1;for(let h of this.events){for(let{obj:d}of h.dragItems)if(d===((a=s[0])==null?void 0:a.object)||d===((l=(o=s[0])==null?void 0:o.object)==null?void 0:l.object)||Di.is(d)&&d.isAncestorOf((c=s[0])==null?void 0:c.object.uuid)){switch(u=!0,h.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(u)break}u||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let u=this.activeEvent.activeDragItem;u.snapped=!1;let h;if(this.activeEvent.data.drop&&(h=s.filter(d=>u.obj!==d.object&&!u.obj.isAncestorOf(d.object.uuid)&&!(d.object instanceof Fv)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(p=>p===d.object.uuid||n.scene.find(p).isAncestorOf(d.object.uuid))))[0]),h){let d=I9.copy(h.face.normal).applyMatrix3(Q3.getNormalMatrix(h.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")u.fromPosition.setFromMatrixPosition(h.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(u.fromPosition.copy(h.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Qi.copy(d).applyMatrix3(Q3.setFromMatrix4(u.obj.matrixWorld).transpose());let p=u.obj;Qi.x>dg?Nn.x=-p.recursiveBBox.min.x:Qi.x<-dg&&(Nn.x=-p.recursiveBBox.max.x),Qi.y>dg?Nn.y=-p.recursiveBBox.min.y:Qi.y<-dg&&(Nn.y=-p.recursiveBBox.max.y),Qi.z>dg?Nn.z=-p.recursiveBBox.min.z:Qi.z<-dg&&(Nn.z=-p.recursiveBBox.max.z),Nn.applyMatrix3(Q3.invert())}else Nn.copy(d).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);u.fromPosition.add(Nn)}this.activeEvent.data.autoOrient&&(Qi.set(0,1,0).cross(d),Qi.length()<1e-4&&Qi.set(-1,0,0).cross(d),Nn.crossVectors(I9,Qi),u.orientationMatrix.makeBasis(Qi,Nn,d)),u.pointStart.copy(u.fromPosition),u.pointEnd.copy(u.pointStart),u.currentDampingFactor=this.activeEvent.snapDampingFactor,u.snapped=!0,this.lastDropDestination!==h.object&&(this.lastDropDestination=h.object,this.activeEvent.actionsDrop.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(p=>{p.dispatchThrottled()}))}else u.orientationMatrix.makeRotationFromQuaternion(u.quat0),this.lastDropDestination=null,u.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(u.obj,u.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(d=>{d.stop()}),this.activeEvent.actionsDrop.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(d=>{d.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(d=>{d.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(d=>d.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(d=>d.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.play()}),this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(d=>{d.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(d=>{d.stop(),d.object.currentState!==null&&d.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(d=>{d.stop()}))},500),this.updateDragItem(u),u.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{var r;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let n=((r=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:r.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!n)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&n&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(s=>{s.stop(),s.object.currentState!==null&&s.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(s=>{s.stop()}),this.activeEvent.actionsDrag.Audio.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(s=>{s.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(s=>s.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(s=>s.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(e[i.component.uuid]?e[i.component.uuid].push(i.uuid):e[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{var r;(r=i.data)==null||r.events.filter(n=>n.data.type==="DragDrop"&&!n.data.disabled).forEach(n=>{this.events.push(new LFe(i,n.id,n.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(Fh),Fh.negate();let a=Mf.identity();switch(r==="parent"?PFe.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Qi,a,Nn):r==="local"&&e.matrixWorld.decompose(Qi,a,Nn),i){case"x":Qi.set(1,0,0).applyQuaternion(a),hg.copy(Fh).cross(Qi),fc.copy(Qi).cross(hg);break;case"y":Qi.set(0,1,0).applyQuaternion(a),hg.copy(Fh).cross(Qi),fc.copy(Qi).cross(hg);break;case"z":Qi.set(0,0,1).applyQuaternion(a),hg.copy(Fh).cross(Qi),fc.copy(Qi).cross(hg);break;case"xy":fc.set(0,0,1).applyQuaternion(a);break;case"yz":fc.set(1,0,0).applyQuaternion(a);break;case"xz":fc.set(0,1,0).applyQuaternion(a);break;case"adaptive":Fh.angleTo(Nn.set(0,1,0))>Math.PI/6?(Qi.crossVectors(Nn.set(0,1,0),Fh),fc.crossVectors(Qi,Nn)):fc.set(0,1,0);break;default:fc.copy(Fh);break}Pp.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:Pp;if(R9.setFromNormalAndCoplanarPoint(fc,o),!!s.ray.intersectPlane(R9,t)&&(i==="x"||i==="y"||i==="z")){let l=Nn.subVectors(t,o).dot(Qi);t.copy(o).addScaledVector(Qi,l)}}updateDragItem(e,t=!1){var i,r;Pp.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?Yy.subVectors(e.fromPosition,Pp).divideScalar(e.currentDampingFactor):e.reset==="original"?(Yy.subVectors(e.obj.userData.worldPosition0,Pp).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):Yy.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(Pp).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?Yy.length()<TFe:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&DFe(e,Yy.add(Pp),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},pg=new k,J3=new k,du=new k,pu=new k,O9=new Na,IFe=.01,OFe={type:"requestRender"},NFe=function(){let e=new k,t=new k;return(i,r,n)=>n>0?(e.subVectors(i,r),e.length()<=n?i:t.copy(r).add(e.normalize().multiplyScalar(n))):r}(),N9=function(){let e=new lt;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof _a&&Wu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),zFe=class{constructor(e,t,i,r,n,s){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new k,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...KI.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Dn(e,e.actions,r,n,s,i)}},BFe=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!($t.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new zFe(n.data,n.id,r,e,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),uo&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),uo&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,ls(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var a;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=e.data;if(e.object.getWorldPosition(du),e.isReset)pu.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(pu);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(J3),J3.negate(),pg.copy(J3)):i==="xy"?pg.set(0,0,1):i==="xz"?pg.set(0,1,0):i==="yz"&&pg.set(1,0,0),O9.setFromNormalAndCoplanarPoint(pg,du),!l.ray.intersectPlane(O9,pu))return}if(!e.isReset){if(pu.distanceTo(e.worldPosition0)>r&&n&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)pu.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(pu.x=du.x),e.data.enabledTranslation[1]===!1&&(pu.y=du.y),e.data.enabledTranslation[2]===!1&&(pu.z=du.z);let s=NFe(du,pu,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=pg.subVectors(s,du).divideScalar(e.currentDampingFactor);du.add(o),t&&N9(e.object,du),e.paused=o.length()<IFe}else N9(e.object,s),e.paused=!0;(a=e.object)==null||a.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(OFe)}},Zy=new k,JS=new k,Qy=new lt,fg=new ni,Vh=new ni,Ky=new k,Jy=new k,Dp=new k,fu=new k,$3=new Na,kFe=1e-6,UFe={type:"requestRender"},FFe={type:"changeRotation"},z9=function(){let e=new lt;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(bre(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof _a&&Wu(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),VFe=class{constructor(e,t,i,r){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ni,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...JI.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=r.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},jFe=class extends $s{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!($t.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let t of this.events)t.target===void 0&&this.updateSingleEvent(t)}},this.onMouseEnter=e=>{for(let t of this.events)t.target===void 0&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)t.target===void 0&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let t=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(t)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>({eventName:t,target:i})=>{if(!t||!i)return;let r=aw(t);r&&r==="LookAt"&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity(r=>{var s,a;let n=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="LookAt"&&!o.data.disabled);n&&(!e.data.globalPhysics.usePhysics||((a=r.dataPatched.physics)==null?void 0:a.rigidBody)!=="dynamic")&&this.events.push(new VFe(n.data,n.id,r,e))}),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),uo&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),uo&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(Ky),!e.isReset)if(e.target)e.target.getWorldPosition(Jy);else{if(n==="custom"?(l().getWorldDirection(JS),JS.negate(),$3.setFromNormalAndCoplanarPoint(JS,Ky)):(n==="xy"?Zy.set(0,0,1):n==="xz"?Zy.set(0,1,0):n==="yz"&&Zy.set(1,0,0),$3.setFromNormalAndCoplanarPoint(Zy,Ky)),!c.ray.intersectPlane($3,Jy))return;r>0&&(n==="custom"||n===void 0)&&Jy.addScaledVector(JS,r)}if(e.isReset||(h?t==="target"?Dp.copy(h.up).applyMatrix4(Qy.extractRotation(h.matrixWorld)).normalize():a.some(p=>p===!1)?(i==="x"?(fu.set(0,0,1),a[2]===!1&&fu.set(0,1,0)):i==="y"?(fu.set(1,0,0),a[0]===!1&&fu.set(0,0,1)):(fu.set(0,1,0),a[1]===!1&&fu.set(1,0,0)),Dp.copy(fu).applyQuaternion(e.worldQuaternion0).normalize()):Dp.set(0,1,0):n==="custom"?Dp.set(0,1,0):Dp.copy(Zy)),e.isReset)Vh.copy(e.worldQuaternion0);else if(Ky.distanceTo(Jy)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)Vh.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;HFe(Qy,Jy,Ky,Dp,i,fu),Vh.setFromRotationMatrix(Qy),fg.setFromUnitVectors(fu.applyQuaternion(Vh),Dp),a.some(p=>p===!1)&&t!=="target"&&Vh.premultiply(fg).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),fg.setFromRotationMatrix(bre(u.matrixWorld)),fg.slerp(Vh,1/e.currentDampingFactor),z9(u,Qy.makeRotationFromQuaternion(fg)),e.paused=8*(1-fg.dot(Vh))<kFe):(z9(u,Qy.makeRotationFromQuaternion(Vh)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(UFe),u.dispatchEvent(FFe)}},No=new k,On=new k,an=new k;function HFe(e,t,i,r,n,s){let a=e.elements;an.subVectors(t,i),an.lengthSq()===0&&(an.z=1),an.normalize(),On.crossVectors(r,an),On.lengthSq()===0&&(Math.abs(r.z)===1?an.x+=1e-4:an.z+=1e-4,an.normalize(),On.crossVectors(r,an)),On.normalize(),No.crossVectors(an,On),n==="x"?s.z===1?[On,No,an]=[an,On,No]:(On.negate(),[On,an]=[an,On]):n==="y"?s.x===1?[On,No,an]=[No,an,On]:(On.negate(),[No,an]=[an,No]):s.x===1&&(On.negate(),[On,No]=[No,On]),a[0]=On.x,a[4]=No.x,a[8]=an.x,a[1]=On.y,a[5]=No.y,a[9]=an.y,a[2]=On.z,a[6]=No.z,a[10]=an.z}var GFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=Dn(t,t.actions,r,n,s,i)}disconnect(){ls(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatchStart()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Create.forEach(e=>e.dispatchStop()),this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},WFe=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{$t.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{$t.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{$t.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=aw(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(a=this.eventsPerObjects[r.uuid])==null||a.forEach(o=>o.dispatchUserEvent(n)))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(n,s)=>{var a,o;if(!(!n.visible||!((a=n.data)!=null&&a.events.length))){for(let{id:l,data:c}of n.data.events)if(!c.disabled&&c.type==="MouseHover")try{let u=new GFe(l,c,n,e,t,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(u):this.eventsPerObjects[n.uuid]=[u]}catch{}(o=this.eventsPerObjects[n.uuid])!=null&&o.length&&this.objects.push(n instanceof us?s:n)}};if(e.traverseEntity(n=>{var s;(n instanceof Gs||n instanceof rs)&&((s=n.frame)==null||s.traverse(a=>{i(a,n)})),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),uo&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),uo&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=Ru(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!a){let o=LE(r,n,this.objects);t=wN(o),o.forEach(l=>{var c,u;l.object instanceof Gs&&Ru(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=SC(r,o);l&&(t.push(o),o instanceof Gs&&Ru(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(n=>n.dispatchEnter())}),this._prevObjects=t}},XFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=Dn(t,t.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){ls(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},qFe=class{constructor(e,t,i,r,n,s,a){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=Dn(t,t.actions,r,n,a,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if(window.getComputedStyle(e).position==="sticky")return e;e=e.parentElement}return null}computeScrollBounds(){let e=this.getStickyParentElement(),t=e==null?void 0:e.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(t){let c=t.getBoundingClientRect(),u=window.getComputedStyle(e),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),p=parseFloat(u.bottom),f=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=f-i.height,r.bottom-=f-i.height);else if(!isNaN(p)){let v=document.body.clientHeight??window.innerHeight,m=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===v-p?(r.top+=c.top-i.height+p+m,r.bottom+=c.top-i.height+p+m):i.bottom<v-p&&(r.top-=f-i.height,r.bottom-=f-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){ls(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}},YFe=class extends $s{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a;if(!i||!r)return;let s=aw(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(a=this.wheelEventsPerObject.get(r))==null||a.forEach(o=>{o.dispatchUserEvent(n)}))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:r}=this.eventContext,n=s=>{var a,o,l;if((a=s.data)!=null&&a.events.length){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="Scroll")if(u.trigger==="load"||!r){let h=new XFe(c,u,s,e,t,this.managers);this.wheelEventsPerObject.has(s)?(o=this.wheelEventsPerObject.get(s))==null||o.push(h):this.wheelEventsPerObject.set(s,[h])}else{let h=new qFe(c,u,s,e,t,i,this.managers);this.scrollEventsPerObject.has(s)?(l=this.scrollEventsPerObject.get(s))==null||l.push(h):this.scrollEventsPerObject.set(s,[h])}}};e.traverseEntity(s=>{var a;(s instanceof Gs||s instanceof rs)&&((a=s.frame)==null||a.traverse(o=>{n(o)})),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},ZFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=Dn(t,t.actions,r,n,s,i)}disconnect(){ls(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Sf?t.interaction.audioPlayer.play():t.interaction instanceof mN&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof jv?t.interaction.play(i==="autoplay"):t.interaction instanceof xN&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Sf?t.interaction.audioPlayer.play():t.interaction instanceof mN&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof jv?t.interaction.play():t.interaction instanceof xN&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},QFe=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof Sf&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof jv&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{var a,o;if(!i||!r)return;let s=aw(i);s&&s==="Start"&&(r instanceof us||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(a=this.eventsPerObject.get(r))==null||a.forEach(l=>{l.dispatchUserEvent(n)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var n,s,a,o,l;if((n=r.data)!=null&&n.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new ZFe(c,u,r,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length||h.actions.ClearLocalStorage.length||h.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(a=this.eventsAfterPerObject.get(r))==null||a.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(t.traverseEntity(r=>{var n;(r instanceof Gs||r instanceof rs)&&((n=r.frame)==null||n.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},KFe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.actions=Dn(t,t.actions,r,n,s,i),this.target=t.target}disconnect(){ls(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Animation.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},JFe=class extends $s{constructor(e,t,i,r,n){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:p,property:f,prevValue:v}=this.propertiesToWatch[d],m=this.eventContext.scene.find(p),g=eO.propertyPaths[f];if(g[0]==="width"||g[0]==="height"||g[0]==="depth")m=m.geometry.userData.parameters[g[0]];else for(let y=0;y<g.length;y++)m=m[g[y]];v===null?this.propertiesToWatch[d].prevValue=m instanceof k?m.clone():m:(m instanceof k?!m.equals(v):v!==m)&&(c.push({objId:p,property:f}),m instanceof k?this.propertiesToWatch[d].prevValue.copy(m):this.propertiesToWatch[d].prevValue=m)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:p,prevValue:f}=this.variablesToWatch[d],v=a.getVariable(p);v!==f&&(l.push(p),this.variablesToWatch[d].prevValue=v)}for(let d=0;d<this.dynamicVars.length;d++){let{id:p,expectedTime:f,last:v,data:m,timerSeconds:g,startValue:y}=this.dynamicVars[d],x=1e3;if((m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&m.format==="number3decimal"?x=1:m.dynamicVariableType==="counter"?x=m.updateInterval:m.dynamicVariableType==="random"&&(x=m.isStatic?1/0:m.updateInterval),f===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+x;continue}if(!((a.getDynamicVariablePlayState(p)==="Stopped"||a.getDynamicVariablePlayState(p)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+x,m.dynamicVariableType==="counter"&&a.getVariable(p)!==y&&(a.updateVariable(p,y),this.eventManager.requestRender()),(m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==y&&(this.dynamicVars[d].timerSeconds=y,a.updateVariable(p,jo.getFormattedTimerTime(y,m)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(p)==="Restarted"&&a.setDynamicVariablePlayState(p,"Playing"),a.getDynamicVariablePlayState(p)==="Stopped"))){if(a.getDynamicVariablePlayState(p)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(x-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=f)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=x,m.dynamicVariableType==="random"){let _=m.min+Math.random()*(m.max-m.min),M=m.decimals;_=Math.round(_*Math.pow(10,M))/Math.pow(10,M),a.updateVariable(p,_),l.push(p),this.eventManager.requestRender()}else if(m.dynamicVariableType==="counter"){let _=a.getVariable(p),M=a.getDynamicVariableToggleIsForward(p)??!0,S=a.getVariable(p)+m.increment*(M?1:-1);m.hasEnd&&(S=m.increment>0?Mt.clamp(S,y,m.endValue):Mt.clamp(S,m.endValue,y),S===y&&a.setDynamicVariableToggleIsForward(p,void 0),m.repeat?S===m.endValue&&(S=y):(S===y||S===m.endValue)&&a.setDynamicVariablePlayState(p,"Paused")),S!==_&&(l.push(p),a.updateVariable(p,S),this.eventManager.requestRender())}else if(m.dynamicVariableType==="time"){let _=a.getVariable(p),M=KW(o,m);if(typeof _=="object"&&"textValue"in _&&typeof M=="object"&&"textValue"in M){if(Array.isArray(_.textValue)&&Array.isArray(M.textValue)){if(_.textValue.every((S,E)=>S===M.textValue[E]))continue}else if(_.textValue===M.textValue)continue}else if(_===M)continue;a.updateVariable(p,M),l.push(p),this.eventManager.requestRender()}else{let _=Ss.isTextValue(m.endValue)?B9(m.endValue.textValue):m.endValue,M=a.getDynamicVariableToggleIsForward(p)??!0,S=g+(s-v)/1e3*(m.dynamicVariableType==="timer"?-1:1)*(M?1:-1);S=Math.max(S,0),m.hasEnd&&(S=m.dynamicVariableType==="stopwatch"?Mt.clamp(S,y,_):Mt.clamp(S,_,y),S===y&&a.setDynamicVariableToggleIsForward(p,void 0),m.repeat?Math.abs(S-_)<(m.format==="number3decimal"?1e-4:.1)&&(S=y):(Math.abs(S-y)<(m.format==="number3decimal"?1e-4:.1)||Math.abs(S-_)<(m.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(p,"Paused")),S!==g&&(l.push(p),this.dynamicVars[d].timerSeconds=S,a.updateVariable(p,jo.getFormattedTimerTime(S,m)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(p=>p.objId===d.data.objectId&&p.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity(t=>{var i;(i=t.data)==null||i.events.filter(r=>r.data.type==="VariableChange"&&!r.data.disabled).forEach(r=>{this.events.push(new $Fe(r.id,r.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(t=>t.data.variableId==="objectProperty"&&t.data.objectId!==null).map(t=>({objectId:t.data.objectId,property:t.data.property,prevValue:null}));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:t,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===t)&&this.variablesToWatch.push({id:t,prevValue:e.getVariable(t)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(Ss.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&e.updateVariable(t,KW(new Date,i)),i.dynamicVariableType==="counter"&&(r=Ss.isTextValue(i.value)?B9(i.value.textValue):i.value),this.dynamicVars.push({id:t,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},$Fe=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=Dn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispose(){ls(this.actions)}};function B9(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var e4e="https://unpkg.com/@splinetool/runtime@1.9.75/build/",t4e="https://unpkg.com/@splinetool/navmesh-wasm@1.9.75/build/",i4e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${e4e}' + 'navmesh.js'),
		fetch('${t4e}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,r4e=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,n4e=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,s4e=.001,a4e={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},Are,Ci,fs;tPe.then(e=>{Are=e,Ci=new e.Vec3,fs=new e.Vec3});var o4e=new k,l4e=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if($t.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=o4e.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{var d,p,f,v,m,g,y;let s;if(n instanceof Qo)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof Ms)s=n.object;else if(s=n,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((f=s.dataPatched.physics)==null?void 0:f.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&((v=a.physics)==null?void 0:v.enabled)!==!0)return!0;n.updateMatrixWorldSVD();let o=MC(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let x of a.events)x.data.disabled!==!0&&(x.data.type==="GameControl"?u=!0:x.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((m=a.physics)==null?void 0:m.rigidBody)==="dynamic"){if(this.usePhysics&&((g=a.physics)!=null&&g.fusedBody))return!0}else if("geometry"in n&&n.geometry&&i.push(Lu(n.geometry,n.matrixWorld)),this.usePhysics&&((y=a.physics)==null?void 0:y.fusedBody))return n.traverseObject((x,_)=>{var E,A;if(_===0)return;let M;if(x instanceof Qo)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;M=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof Ms)M=x.object;else if(M=x,(E=x.dataPatched.cloner)==null?void 0:E.hideBase)return!0;let S=M.dataPatched;if(!S.visible&&((A=S.physics)==null?void 0:A.enabled)!==!0)return!0;"geometry"in x&&x.geometry&&i.push(Lu(x.geometry,x.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof Qo)return;n instanceof Ms?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(MC(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(Lu(o,n.matrixWorld))},this.navmeshWasm=Are,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?i4e:r4e)+n4e])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent(new k().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(n),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=_f(r),{positions:a,triIndices:o}=RT(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...a4e,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)n[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let a=new Bt;return a.setIndex(new Zt(n,1)),a.setAttribute("position",new Zt(s,3)),a}getClosestPoint(e){return Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,this.navMesh.getClosestPoint(Ci)}getClosestPointToRef(e,t){Ci.x=e.x,Ci.y=e.y,Ci.z=e.z;let i=this.navMesh.getClosestPoint(Ci);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,this.navMesh.getRandomPointAround(Ci,t)}getRandomPointAroundToRef(e,t,i){Ci.x=e.x,Ci.y=e.y,Ci.z=e.z;let r=this.navMesh.getRandomPointAround(Ci,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,fs.x=t.x,fs.y=t.y,fs.z=t.z,this.navMesh.moveAlong(Ci,fs)}moveAlongToRef(e,t,i){return Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,fs.x=t.x,fs.y=t.y,fs.z=t.z,this.navMesh.moveAlong(Ci,fs)}computePath(e,t){let i=this.getClosestPoint(t);if(fs.x=i.x,fs.y=i.y,fs.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let r=this.navMesh.computePath(Ci,fs),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new k(o.x,o.y,o.z))}return s}createCrowd(e,t){return new c4e(this,e,t)}setDefaultQueryExtent(e){Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,this.navMesh.setDefaultQueryExtent(Ci)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=e.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,this.navMesh.addCylinderObstacle(Ci,t,i)}addBoxObstacle(e,t,i){return Ci.x=e.x,Ci.y=e.y,Ci.z=e.z,fs.x=t.x,fs.y=t.y,fs.z=t.z,this.navMesh.addBoxObstacle(Ci,fs,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},c4e=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new k(0,0,0)),n}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=s4e)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let n=e/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),n=[];for(t=0;t<r;t++){let s=i.getPoint(t);n.push(new k(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function u4e(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&eb.traverseModuleInstances(e,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(t=!0)})}),t}var h4e={type:"change"},k9={type:"changeZoom"},d4e={type:"changePan"},Lp={type:"start"},Rp={type:"end",changed:!0},p4e={type:"end",changed:!1},eL=new ni,U9=new ve,f4e=2*Math.PI,m4e=1e-8,g4e=.01,tL=new k,$S=new ve,iL=new k,eM=new ni,F9=new lt,v4e={type:"requestRender"},Cre=class extends Ts{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Do.DOLLY_ROTATE,Do.PAN],this.offset=new k,this.eye=new k,this.lastPosition=new k,this.lastQuaternion=new ni,this.current=new ve,this.overShoot=new ve,this.overRatio=new ve,this.spherical=new fH,this.sphericalDelta=new fH,this.panOffset=new k,this.panLeftV=new k,this.panUpV=new k,this.panV=new k,this.rotateStart=new ve,this.rotateEnd=new ve,this.rotateDelta=new ve,this.panStart=new ve,this.panEnd=new ve,this.panDelta=new ve,this.dollyStart=new ve,this.dollyEnd=new ve,this.dollyDelta=new ve,this.rotationRangeFactor=new ve,this.panRangeFactor=new ve,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(iL,eM,tL),this.offset.copy(iL).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(eL.copy(eM).invert()),this.panOffset.applyQuaternion(eL),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(eM),this.panOffset.applyQuaternion(eM)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),iL.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(F9.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(F9));let r=this.spherical.phi%f4e;if(this.eye.copy(this.offset).normalize(),this.object.up.copy($i.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>g4e||8*(1-this.lastQuaternion.dot(this.object.quaternion))>m4e?(this.dispatchEvent(h4e),this.object.dispatchEvent(v4e),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&uo?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Lp),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&uo||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,tL.subVectors(this.position0,this.target0),this.spherical.setFromVector3(tL),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?$S.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):$S.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy($S).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(U9,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy($S).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&uo?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,$t.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),$t.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(Rp):this.dispatchEvent(p4e),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&uo||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!uS(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(uS(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(uS(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch($t.length>1&&r.preventDefault(),this.touches[$t.length-1]){case Do.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Do.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Do.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Do.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch($t.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=Zx(()=>this.dispatchEvent(Rp),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(Lp),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!Jb)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Lp),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(Rp)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(Lp))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp($t[0]),r.key===" "&&this.dispatchEvent(Rp))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(eL.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=mc(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=mc(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=mc(mc(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=mc(mc(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=Do.ROTATE),e.panTouches===1&&(this.touches[0]=Do.PAN),e.orbitTouches===2&&(this.touches[1]=Do.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=Do.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=Do.ROTATE),e.panTouches===3&&(this.touches[2]=Do.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;e instanceof k?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set(mc(this.spherical.theta),mc(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=mc(this.overShoot.x),this.overShoot.y=mc(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=V9(Math.abs(this.overRatio.x)),this.overRatio.y=V9(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof k?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(d4e)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(k9)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(k9)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(Lp),this.dollyOut(e),this.dispatchEvent(Rp)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(Lp),this.dollyIn(e),this.dispatchEvent(Rp)}setZoom(e){if(this.dispatchEvent(Lp),this.object.isPerspectiveCamera){let t=this.initialSphericalRadius/e/this.spherical.radius;this.scale=t}else this.object.isOrthographicCamera&&(this.object.zoom=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(Rp)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(U9,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(Z2e===!1&&uS(e)===!1&&K2e(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1||this.gesture)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if($t.length===2){let e=.5*($t[0].pageX+$t[1].pageX),t=.5*($t[0].pageY+$t[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set($t[0].pageX,$t[0].pageY)}handleTouchStartPan(){if($t.length===2){let e=.5*($t[0].pageX+$t[1].pageX),t=.5*($t[0].pageY+$t[1].pageY);this.panStart.set(e,t)}else this.panStart.set($t[0].pageX,$t[0].pageY)}handleTouchStartDolly(){let e=$t[0].pageX-$t[1].pageX,t=$t[0].pageY-$t[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if($t.length===2){let i=WD(e),r=.5*(e.pageX+i.x),n=.5*(e.pageY+i.y);this.rotateEnd.set(r,n)}else{if(e.pointerId!==$t[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if($t.length===2){let t=WD(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==$t[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=WD(e),i=e.pageX-t.x,r=e.pageY-t.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function mc(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function V9(e){return 1-Math.pow(1-e,4)}var j9=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=Dn(t,t.actions,r,n,s,i),this.target=t.target,this.triggeringObjects=[];for(let a of t.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){ls(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},zi;rPe.then(e=>zi=e);var xn=new k,bl=new ni,jh=new k,rL=new kn(0,0,0,"YXZ"),H9=new kn(0,0,0,"XYZ"),wl=new k,nL=new k,sL=new k(1,1,1),mg=new ni,tM=new lt,G9=new lt,y4e={type:"updateMatrix"},W9=new ni,aL=new Xa,_N={type:"beginEvent",eventName:"Collision"},x4e={type:"beginEvent",eventName:"Trigger"};function b4e(e){if(eb.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){t=!0;break}}}),t}var MC=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),w4e=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==zi.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(t.handle);if(xn.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),bl.copy(t.rotation()),i.matrixWorld.compose(xn,bl,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(y4e),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var a,o,l,c;if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[t]?(n=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((a=h.rigidBody)==null?void 0:a.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let f of h)f.data.target==="scene"&&this.dispatchCollisionEvent(f,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(p!==void 0)for(let f of p)f.data.target==="scene"&&this.dispatchCollisionEvent(f,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=vre,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let n of t.events){if(n.data.disabled===!0)continue;let s=(r=(i=n.data.actions)==null?void 0:i.find(a=>a.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let a of s.objects){let o=this.page.scene.find(a);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,r=t instanceof rx,n=t instanceof nx;if(t instanceof Qo||r||n)return;t instanceof Ms?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let a=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(MC(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&(h.data.type==="GameControl"||h.data.type==="Follow")))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;a&&e.push(Lu(a,t.matrixWorld))}),e.length>0){let t=_f(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new tx(t)}}addRigidBody(e,t,i){if(xre(e.matrixWorld))return;let r=[],n="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((n==null?void 0:n.getAttribute("position"))!==void 0&&r.push(Lu(n,e.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(e,r);e.traverseObject(a),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=zi.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=zi.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):a=zi.RigidBodyDesc.fixed();let l=_f(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(xn,bl,jh),e.position0=xn.clone().divideScalar(this.pixelsPerMeter),e.rotation0=bl.clone(),xn.divideScalar(this.pixelsPerMeter),a.setTranslation(xn.x,xn.y,xn.z).setRotation(bl),n?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(jh.x/this.pixelsPerMeter,jh.y/this.pixelsPerMeter,jh.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[e,jh.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(Lu(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(n=>n.updateMatrixWorld(!0)),t.length>0){let n=_f(t,!1);e.bvhGeometry=n,n.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new tx(n),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,r,n=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=zi.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=zi.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(zi.CoefficientCombineRule.Average).setRestitutionCombineRule(zi.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&a.setActiveEvents(zi.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let n;if(i instanceof Qo)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof Ms)n=i.object;else if(n=i,(o=n.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;(a==null?void 0:a.getAttribute("position"))!==void 0&&t.push(Lu(a,i.matrixWorld))}}activate(e){var d,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let f of l.data.events){if(f.data.disabled||f.data.type!=="GameControl")continue;let v=l;for(;this.usePhysics&&((d=v=v.parent)==null?void 0:d.parent)!==null;)(p=v.data.physics)==null||p.fusedBody;f.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=f.data)}if(this.page.traverseEntity(f=>{for(let v of f.dataPatched.events)if(v.data.disabled===!1&&v.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let f=new yre(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=f,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,uo&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let f=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new l4e(this.usePhysics,this.isExport);let v;f.collider.type==="sphere"?v=f.collider.radius*2:v=f.collider.height,v=Math.floor(v/f.navmesh.ch-1),this.navigationMeshWrapper.init({...f.navmesh,walkableHeight:v},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:f,enablePan:v,enableZoom:m,autoRotate:g,hoverRotatePanMode:y}=this.eventManager.publish.orbitControls;(f||v||m||g||y!==0)&&(this.orbitControls=new Cre(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((f,v)=>{let m=document.body.appendChild(document.createElement("div")),[g,y,x]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[v],_=(u-5*g)/4+g,M={},S=f==="jmp",E=S?0:g;v<10?(v<5?M.top=E/2:M.bottom=E/2,M.left=E/2+v%5*_):v===10?(M.left=E/2,M.top=h/2):(M.right=E/2,M.top=h/2),M.top?M.top-=y[1]:M.bottom+=y[1],M.left?M.left+=y[0]:M.right-=y[0];for(let C in M)M[C]+="px";if(S){let C=m.appendChild(document.createElement("div"));Object.assign(C.style,M,{position:"absolute",width:g+"px",height:g+"px",backgroundColor:`rgba(255,255,255,${x==="show"?.4:0})`,zIndex:"9999",borderRadius:g+"px",border:x==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let D=g/16*16*.4;x==="show"&&(C.innerHTML=`
						<svg width="${D}" height="${g*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",N=>N.preventDefault()),this.joysticks[v]=[void 0,m];return}let A={zone:m,mode:"static",position:M,size:g};x==="hide"&&(A.restOpacity=0);let P=Lke.create(A);P.on("move",(C,D)=>{let N=this.gameControl;f==="pos"?D.force<.2?N.moveForce=0:(N.movementState.movePosZ=Math.sin(-D.angle.radian),N.movementState.movePosX=Math.cos(-D.angle.radian),D.force>1.2?N.movementState.run=1:N.movementState.run=0,D.force<.3?N.moveForce=(D.force-.2)/.1:N.moveForce=1):f==="rot"&&(D.force<.2?N.rotForce=0:(N.movementState.rotPosX=D.vector.y,N.movementState.rotPosY=-D.vector.x,D.force<.3?N.rotForce=(D.force-.2)/.1:N.rotForce=1)),this.requestRender()}),P.on("end",(C,D)=>{let N=this.gameControl;f==="pos"?(N.movementState.movePosZ=0,N.movementState.movePosX=0,N.moveForce=1):f==="rot"&&(N.movementState.rotPosX=0,N.movementState.rotPosY=0,N.rotForce=1)}),this.joysticks[v]=[P,m]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(f=>f.initialDisabled=!1)},80)}initPhysics(){var a;(a=this.sharedGameControlGlobals.rapierWorld)==null||a.free(),this.sharedGameControlGlobals.rapierWorld=new zi.World(new zi.Vector3(0,this.gravity,0)),this.events=new zi.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var g,y,x,_;let l;if(o instanceof Qo)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof Ms)l=o.object;else{if(o instanceof nx||o instanceof rx)return;if(l=o,((g=l.dataPatched.cloner)==null?void 0:g.disabled)===!1&&((y=l.dataPatched.cloner)==null?void 0:y.hideBase)&&((x=l.dataPatched.physics)==null?void 0:x.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let M of c.events)M.data.disabled!==!0&&M.data.type==="GameControl"&&(u=M.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=MC(c),d=!1,p=l.userData.hasDestroy,f=l.userData.hasDrag,v=!1;for(let M of c.events)if(M.data.disabled!==!0){if(M.data.type==="Collision"){d=!0;let S=new KFe(M.id,M.data,l,this.page,this.sharedAssets,this.eventManager);S.initialDisabled=!0,this.collisionEvents.push(S),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(E=>E.id!==M.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(S):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[S]}else if(M.data.type==="Follow"){v=!0;let S=M.data.target;o.traverseVisible(E=>{E.userData.isFollowingObj=S})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let m=o.geometry;if(u!==void 0){let M=zi.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(xn,bl,jh),o.position0=xn.clone().divideScalar(this.pixelsPerMeter),o.rotation0=bl.clone(),xn.divideScalar(this.pixelsPerMeter),M.setTranslation(xn.x,xn.y,xn.z).setRotation(bl);let S=this.sharedGameControlGlobals.rapierWorld.createRigidBody(M);o.rigidBody=S;let E;u.collider.type==="sphere"?E=zi.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?E=zi.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):E=zi.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),E.setFrictionCombineRule(zi.CoefficientCombineRule.Average).setRestitutionCombineRule(zi.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let A=this.sharedGameControlGlobals.rapierWorld.createCollider(E,S);this.sharedGameControlGlobals.colliderToEntity.set(A.handle,l),xn.fromArray(u.collider.position).multiply(jh.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),A.setTranslationWrtParent(xn);let P=new ni().setFromEuler(new kn().setFromVector3(new k().fromArray(u.collider.rotation)));A.setRotationWrtParent(P),A.setActiveEvents(zi.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||v||p||f||d?(this.addRigidBody(o,l,{hasFollow:v,hasTransformAnim:h,hasDrag:f}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(m&&e.push(Lu(m,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((M,S)=>{var C;if(S===0)return;let E;if(M instanceof Qo)if(M.objectForSample){if(M.objectForSample.dataPatched.physics.fusedBody)return;E=M.object}else return M.object.dataPatched.physics.fusedBody===!0&&M.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(M instanceof nx||M instanceof rx)return;if(M instanceof Ms)E=M.object;else if(E=M,(C=E.dataPatched.cloner)==null?void 0:C.hideBase)return!0}let A=E.dataPatched;if(A.physics.enabled==="visibility"?!A.visible:!A.physics.enabled)return!0;let P=M.geometry;(P==null?void 0:P.getAttribute("position"))!==void 0&&e.push(Lu(P,M.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((_=c.physics)==null?void 0:_.fusedBody)===!0||u)return!0}),e.length===0)return;let i=_f(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=zi.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=zi.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(zi.CoefficientCombineRule.Multiply).setRestitutionCombineRule(zi.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,n);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new j9(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new lt().compose(wl.fromArray(t.data.position),mg.setFromEuler(H9.fromArray(t.data.rotation)),sL);if(t.data.triggerZone==="box"){let n=new fn;n.min.fromArray(t.data.size).multiplyScalar(-.5),n.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(n=>{let s=n;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([n,s])=>{n==null||n.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let n of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))n.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(xn,bl,jh),rL.setFromQuaternion(bl);let i=t;i.prevR===void 0?(i.prevR=rL.clone(),i.prevT=xn.clone()):(i.prevR.copy(rL),i.prevT.copy(xn)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(xn.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(bl))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,n;if(t.cloner){for(let a of t.cloner.children)if(a.rigidBody===r){n=a;break}}e.dispatch(n),t.dispatchEvent(_N)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=G9.copy(e.matrixWorld).invert();e.traverseEntity((n,s)=>{if(t===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new j9(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=zi.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=zi.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(zi.ActiveEvents.COLLISION_EVENTS),wl.fromArray(a.data.position),mg.setFromEuler(H9.fromArray(a.data.rotation)),tM.compose(wl,mg,sL).premultiply(n.matrixWorld),i?(tM.decompose(wl,mg,nL),l.setActiveCollisionTypes(zi.ActiveCollisionTypes.KINEMATIC_FIXED|zi.ActiveCollisionTypes.DYNAMIC_FIXED)):(tM.premultiply(r).decompose(wl,mg,nL),e.rigidBody.bodyType()===zi.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===zi.RigidBodyType.Fixed?l.setActiveCollisionTypes(zi.ActiveCollisionTypes.KINEMATIC_FIXED|zi.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(zi.ActiveCollisionTypes.KINEMATIC_KINEMATIC|zi.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),wl.divideScalar(this.pixelsPerMeter),l.setTranslation(wl.x,wl.y,wl.z),l.setRotation(mg),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[t];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Di.is(o)?o:o.object)===!1)continue;let l=G9.copy(n.matrixWorld).decompose(wl,W9,nL).compose(wl,W9,sL).multiply(r),c=tM.copy(o.matrixWorld).invert().multiply(l);i instanceof fn?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(aL.radius=i,aL.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(aL)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(x4e)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function _4e(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+e,s=this._loopCount,a=r===JB;if(e===0)return s===-1?n:a&&(s&1)===1?t-(n-i):n;if(r===LJ){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<i){let o=Math.floor((n-i)/(t-i));n-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=e>0?t:i,this.repetitions===1&&(n=t)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return t-(n-i)}return n}var X9=!1,S4e=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=II.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);X9===!1&&(Object.getPrototypeOf(c)._updateTime=_4e,X9=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new fwe(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let n=this.clipIdToAction[e];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=RJ}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=JB)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return cre(this.activeClip??void 0)}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(e/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},oL=new WeakMap,M4e=class extends Yb{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let n=new OI(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(oL.has(e)){let o=oL.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=e.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),oL.set(e,{key:i,promise:a}),a}_createGeometry(e){let t=new Bt;e.index&&t.setIndex(new Zt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],n=r.name,s=r.array,a=r.itemSize;t.setAttribute(n,new Zt(s,a))}return t}_loadLibrary(e,t){let i=new OI(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(e,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let n=E4e.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function E4e(){let e,t;onmessage=function(a){let o=a.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(h,d,p,c),v=f.attributes.map(m=>m.array.buffer);f.index&&v.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},v)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,p,f=o.GetEncodedGeometryType(l);if(f===a.TRIANGULAR_MESH)d=new a.Mesh,p=o.DecodeBufferToMesh(l,d);else if(f===a.POINT_CLOUD)d=new a.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let v={index:null,attributes:[]};for(let m in u){let g=self[h[m]],y,x;if(c.useUniqueIDs)x=u[m],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,a[u[m]]),x===-1)continue;y=o.GetAttribute(d,x)}v.attributes.push(n(a,o,d,m,g,y))}return f===a.TRIANGULAR_MESH&&(v.index=r(a,o,d)),a.destroy(d),v}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),p=l.num_points()*d,f=p*u.BYTES_PER_ELEMENT,v=s(a,u),m=a._malloc(f);o.GetAttributeDataArrayForAllPoints(l,h,v,f,m);let g=new u(a.HEAPF32.buffer,m,p).slice();return a._free(m),{name:c,array:g,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var Ed;function A4e(){return Ed||(Ed=new M4e,Ed.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),Ed.decoderPending}async function C4e(e){if(Ed){let t={attributeIDs:Ed.defaultAttributeIDs,attributeTypes:Ed.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await Ed.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function T4e(e,t){let[i,r]=mee(ZI.deserialize(new Uint8Array(e)));return Fee(i),r.result().data}function P4e(e){let t=[];return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&t.push(r)}),t}async function D4e(e){for(let t of e){let i=await C4e(t.geometry.data.draco);if(i){let r=t.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var L4e=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=e=>{let t=[e.clientX,e.clientY],i=new Date().getTime();if(this._clickCount>0){let r=t[0]-this._lastPosition[0],n=t[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=t,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=e=>{}}start(e,t=500,i=2){this._target&&this.stop(),this.reset(),this._delay=t,this._distance=i,this._target=e,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},R4e=class{constructor(e,t,i,r,n,s,a,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=Dn(r,i.actions,s,a,o,n)}disconnect(){ls(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},I4e=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=$I.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{var s;if(!(!n.visible||!((s=n.data)!=null&&s.events.length)))for(let{data:a,id:o}of n.data.events)a.disabled||a.type==="Resize"&&a.breakpoints.forEach(({data:l,id:c})=>{try{let u=new R4e(o,c,l,a,n,e,t,this.eventManager);this.breakpoints.push(u)}catch{}})};e.traverseEntity(n=>{var s;(n instanceof Gs||n instanceof rs)&&((s=n.frame)==null||s.traverse(a=>{r(a)})),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},O4e=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=e.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="API"&&!i.data.disabled).forEach(i=>{this.events.push(new N4e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([e,t])=>{t.on("success",this.onSuccess),t.on("error",this.onError),t.autostart&&t.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([e,t])=>{t.off("success",this.onSuccess),t.off("error",this.onError)})}},N4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.successActions=Dn(t,t.successActions,r,n,s,i),this.errorActions=Dn(t,t.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},z4e=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=e.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="WEBHOOK"&&!i.data.disabled).forEach(i=>{this.events.push(new B4e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([e,t])=>{t.connect(),t.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([e,t])=>{t.off("message",this.onMessage),t.disconnect()})}},B4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=Dn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}};function k4e(){let e=document.createElement("textarea");return e.style.position="fixed",e.style.top="200px",e.style.left="400px",e.style.zIndex="-1",e.style.border="1px solid rgba(255,0,0,0.5)",e.style.width="10px",e.style.height="500px",e.style.color="white",e.style.opacity="0.5",e.style.background="transparent",e.style.display="none",e.style.margin="0px",e.style.padding="0px",e.style.boxSizing="content-box",e.style.pointerEvents="none",e}var U4e=new k(0,0,1),q9=new k,Y9=new k,Z9=new Mn,F4e=class{constructor(e,t,i,r,n){this.containerScene=e,this.raycaster=t,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new fie,this.doubleClickHandler=new L4e,this.isDragging=!1,this.plane=new Na,this.caretInterval=0,this.planeIntersection=new k,this.projected=new ve,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{var a;let s=(a=this.virtualInput)==null?void 0:a.data;if(this.virtualInput!==void 0&&s){let o=s.material,l=typeof o=="string"?this.sharedAssets.data.materials[o]:o,c=qze(l,this.sharedAssets);this.helper.setCaretColor(c)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=(s==null?void 0:s.key)==="ArrowLeft"||(s==null?void 0:s.key)==="ArrowRight",l=(s==null?void 0:s.key)==="ArrowUp"||(s==null?void 0:s.key)==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=k4e(),this.htmlInput}connect(){}disconnect(){var e;this.stopAnimateTextCursor(),this.helper.hide(),(e=this.htmlInput)==null||e.remove(),this.doubleClickHandler.stop()}handleMouseDown(){var s,a;if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let e=this.doubleClickHandler.clickCount,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,e>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};(a=(s=this.virtualInput)==null?void 0:s.wrappedText)!=null&&a.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(t--,r--),this._lastIndex=t,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(e===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=t,this.isDragging=!0,this.setInputSelection(t)}else n===this.virtualInput&&(e===2?this.selectClosestWord(i,r):e>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(e){var t;if(this.virtualInput=e,this.updateTextInputStyles(),this.htmlInput)if(e){let i=(t=this.data)==null?void 0:t.geometry.text;this.htmlInput.value=typeof i=="string"?"":(i==null?void 0:i.textValue.toString())??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:e}=this;if(e)return e.dataPatched}applyRangeToTextInput(){var n;if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let e=this.selectionOnDragStart,{index:t,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&((n=this.virtualInput)==null?void 0:n.wrappedText[i][r-1])===`
`&&t--,this.htmlInput.setSelectionRange(Math.min(e,t),Math.max(e,t))}checkClickedObject(){if(this.virtualInput){let e=this.raycaster.intersectObject(this.virtualInput,!1);if(e.length>0){let t=e[0];if(t.object instanceof gU)return t.object}}return null}selectClosestWord(e,t){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[e],n=t+1,s=t;r[t]!==" "&&(n=this.findNextCharOccurence(r,t,"forward"," "),s=this.findNextCharOccurence(r,t,"backward"," "),s>0&&s++,n>=r.length-1&&e===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,e,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,e,n);this.setInputSelection(o,l)}findNextCharOccurence(e,t,i,r=" "){let n=Math.max(0,e.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(t,n),0);for(;o!==s;)if(o+=a,e.charAt(o)===r)return o;return s}getPointOnPlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;if(!(!this.virtualInput||!e)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new k);let i=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(i){this.planeIntersection.copy(this.virtualInput.worldToLocal(i));let r=typeof e.geometry.width=="number"?e.geometry.width:1,n=typeof e.geometry.height=="number"?e.geometry.height:1;this.projected.set(i.x+r*.5,i.y-n*.5)}}}updatePlane(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&(Z9.getNormalMatrix(this.virtualInput.matrixWorld),q9.copy(U4e).applyMatrix3(Z9).normalize(),this.virtualInput.localToWorld(Y9.set(0,0,e.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(q9,Y9))}setInputSelection(e,t=e){var i;(i=this.htmlInput)==null||i.setSelectionRange(e,t),setTimeout(()=>{var r;(r=this.htmlInput)==null||r.focus()})}updateTextInputStyles(){var t;let e=(t=this.virtualInput)==null?void 0:t.data;this.virtualInput&&e&&this.htmlInput&&(this.htmlInput.style.fontSize=e.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=e.geometry.letterSpacing*e.geometry.fontSize+"px",this.htmlInput.style.lineHeight=e.geometry.fontSize*e.geometry.lineHeight+"px",this.htmlInput.style.width=e.geometry.width+"px",this.htmlInput.style.height=e.geometry.height+"px",this.htmlInput.style.textAlign=V4e(e.geometry.horizontalAlign))}};function V4e(e){return e===4?"justify":e===2?"right":e===3?"center":"left"}var Tre=(e,t)=>{if(typeof e=="string"){let i=t.data(e);if(i)return Tre(i.value,t)}return Ss.getDisplayedValue(e)};function Q9(e,t){let i=e.text,r="";if(typeof i=="string"){let n=t.variables.data(r);n&&(r=Tre(n.value,t.variables))}else r=i.textValue.toString();return r}var j4e=class extends $s{constructor(e,t){super(e),this.eventManager=t,this._textInputs=[],this.sceneHelpers=new Wa,this.helper=new fie,this._onMouseDownFocusIn=i=>{if($t.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r==null||r.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new F4e(this.sceneHelpers,e.raycaster,e.sharedAssets,e.requestRender,this.onExit)}connect(){let e=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof gU&&e.push(r)}),this._textInputs=e,e.length===0)return;let{domElement:t}=this.eventContext;t.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let e=this.textInputManager.htmlInput,{domElement:t}=this.eventContext;t.removeEventListener("pointerdown",this._onMouseDownFocusIn),e==null||e.removeEventListener("keyup",this._onCaretUpdate),e==null||e.removeEventListener("keydown",this._onCaretUpdate),e==null||e.removeEventListener("beforeinput",this._onCaretUpdate),e==null||e.removeEventListener("paste",this._onCaretUpdate),e==null||e.removeEventListener("cut",this._onCaretUpdate),e==null||e.removeEventListener("select",this._onCaretUpdate),e==null||e.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(i=>{let r=Q9(i.data.geometry,this.eventContext.sharedAssets.data);i.textGeometry.setText(r)}),t.removeEventListener("pointerdown",this._onMouseDown,!1),t.removeEventListener("pointerup",this._onMouseUp,!1),t.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(e){this.textInputManager.focus(e),this.textInputManager.onTextMaterialChanged();let t=this.textInputManager.htmlInput;if(!t||e===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=Q9(e.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);t.value=i,t.setSelectionRange(0,0),this.textInputManager.helper.show(e),t.style.display="block",t.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},H4e=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantListener"&&!i.data.disabled).forEach(i=>{this.events.push(new G4e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("voice",this.onVoice)}},G4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=Dn(t,t.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(e){e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}},W4e=class extends $s{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(e=>{var t;(t=e.data)==null||t.events.filter(i=>i.data.type==="AIAssistantTrigger"&&!i.data.disabled).forEach(i=>{this.events.push(new X4e(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){var e;(e=this.openAIRealtime)==null||e.off("trigger_event",this.onTriggerEvent)}},X4e=class{constructor(e,t,i,r,n,s){this.id=e,this.data=t,this.object=i,this.actions=Dn(t,t.actions,r,n,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch()),e.ClearLocalStorage.forEach(t=>t.dispatch()),e.UserAPI.forEach(t=>t.dispatch())}dispatchReverse(){let e=this.actions;e.Transition.forEach(t=>t.reverseFromCurrent()),e.Particles.forEach(t=>t.reverseFromCurrent()),e.Animation.forEach(t=>t.reverseFromCurrent()),e.SwitchCamera.forEach(t=>t.reverseFromCurrent()),e.Create.forEach(t=>t.dispatchStop())}},q4e=class{constructor(e,t,i,r,n){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(e=!1){var r;if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new bFe(this.eventContext),VariableChange:new JFe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new O4e(this.eventContext,this),WEBHOOK:new z4e(this.eventContext,this),AIAssistantListener:new H4e(this.eventContext,this),AIAssistantTrigger:new W4e(this.eventContext,this),Conditional:new CFe(this.eventContext,this),Start:new QFe(this.eventContext,this),Basic:new _Fe(this.eventContext,this,this.needsRaycast),MouseHover:new WFe(this.eventContext,this),Scroll:new YFe(this.eventContext,this),Follow:new BFe(this.eventContext,this),DragDrop:new RFe(this.eventContext,this),LookAt:new jFe(this.eventContext),Resize:new I4e(this.eventContext,this),Textfields:new j4e(this.eventContext,this)};let{page:t,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),t.traverseEntity(n=>{n.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(n=>n.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,e||((r=this.eventContext.sharedAssets.openAIRealtime)==null||r.connect())}deactivate(e=!1){var r,n;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(s=>s.disconnect()),(r=this.controlsManager.gameControl)==null||r.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity(s=>{s.removeEventListener("requestRender",this.requestRender),s.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),e||((n=this.eventContext.sharedAssets.openAIRealtime)==null||n.disconnect())}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length)for(let n of i.data.events)if(n.data.type==="VariableChange"&&(n.data.variableId==="mouseProperty"&&(this.needsMouse=!0),n.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),n.data.type==="Conditional")for(let s of["inActions","outActions"])n.data[s].forEach(t);else if(n.data.type==="DragDrop")for(let s of["drag","drop"])n.data.dragDropActions[s].forEach(t);else if(n.data.type==="GameControl")for(let s of["idle","move","jump","run"])n.data.gameActions[s].forEach(t);else if(n.data.type==="Resize")for(let s of n.data.breakpoints)s.data.actions.forEach(t);else n.data.type==="LookAt"||n.data.type==="API"||n.data.actions.forEach(t)})}},Y4e=class{constructor(e,t,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new ve().copy(i),this._editorSize=new ve().copy(r),this._aspect=t.aspect,this._fov=n??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let n=Z4e(t,1080,2160,1,15)/100;r*=t/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function Z4e(e,t,i,r,n){return(e-t)/(i-t)*(n-r)+r}var Q4e=class{get sharedAssets(){return this.shared}constructor(e,t={},i=!0){this.shared=new sU(e.shared,t,!0,i),this.scene=new xU(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof rs&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof En&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},K4e=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function J4e(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function cx(e){return e instanceof ob?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function $4e(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof _a)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof _a&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=t.shared.materials[s];if(a){if(!as.isMergable(a))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!as.isMergable(c.material))return;s=as.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][cx(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][cx(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][cx(r)].push(c)}),i}function e5e(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>t&&(t=n)})}),t}function t5e(e,t){let i=$4e(t,e),r=e5e(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(o=0,c=0,f.forEach(m=>{m instanceof _a&&(a[o++]=m.geometry.clone(),l[c++]=m)}),c<2)continue;for(let m=0;m<c;m++)l[m].updateWorldMatrix(!0,!1),a[m].applyMatrix4(l[m].matrixWorld),l[m].matrixWorld.determinant()<0&&J4e(a[m]);let v=_f(a.slice(0,o),!1);if(v){let m;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),m=new gr(v,l[0].material);break}default:{m=new gr(v,l[0].material);break}}m.castShadow=l[0].castShadow,m.receiveShadow=l[0].receiveShadow,t.add(m);let g=y=>{h=0;for(let x of y)x.children&&g(x.children),x instanceof _a&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][cx(x)]&&i[x.material.uuid][cx(x)].length>1||(u[h++]=x));for(let x=0;x<h;x++)t.attach(u[x])};for(let y=0;y<c;y++){let x=l[y];g(x.children),n[s++]=x}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var i5e=ap(Jme(),1),r5e=new ve;function n5e(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var s5e=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var n,s,a,o,l,c,u,h,d,p,f,v,m;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(n=this._perfs)==null||n.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(a=this._perfs)==null||a.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(g=>{g.type==="ParticleSystem"&&(g.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.LookAt).onAnimationFrameDamping(),((v=this._eventManager.handlers)==null?void 0:v.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let g=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=g,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(m=this._perfs)==null||m.end()},this._resize=r=>{var n,s,a,o,l,c,u,h,d,p;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=r5e.set(this._viewportWidth,this._viewportHeight)),r){let f=this._viewportWidth,v=this._viewportHeight;this._renderer.setSize(f-1,v-1,!1),this._renderer.setSize(f,v,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=(n=this._scene)==null?void 0:n.activeCamera,(u=this._scene)==null||u.updateViewPlaneSize(((a=(s=this._frameView)==null?void 0:s.frameSize)==null?void 0:a.x)??this._viewportWidth,((l=(o=this._frameView)==null?void 0:o.frameSize)==null?void 0:l.y)??this._viewportHeight,((c=this._frameView)==null?void 0:c.enableResponsive)??!1),this._camera){let f=Object.values(((h=this._data)==null?void 0:h.frames)??{})[0].preset??"fullscreen";(d=this._frameView)==null||d.setCamera(this._camera),(p=this._frameView)==null||p.updateCamera(f!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=Zx(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new K4e({x:10,y:10})),$2e(e)}async load(e,t,i){n5e(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var l,c,u,h;if(this.disposed)return;let r=await T4e(e);this._data=r;let n=P4e(r);r.version&&(0,i5e.default)(r.version,"1.9.75")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([n.length&&A4e(),b8(r)&&rRe(),lOe(r)&&$Le(),eb.physicsEnabled(r.scene.objects)&&nPe(),g8(r)&&kIe(),Q8(r)&&xke(),zIe(r)&&NIe(),V8(r)&&sBe(),u4e(r)&&iPe()].filter(Boolean)),n.length&&await D4e(n),(l=this._eventManager)==null||l.deactivate(),(c=this._controls)==null||c.deactivate(),(u=this._scene)==null||u.dispose();let s=new Q4e(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let d=performance.now();t5e(r,s.scene);let p=performance.now();console.log("Merged geometries in ",p-d," ms")}b8(r)&&this._scene.traverse(d=>{Wu(d)&&d.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var d;this._requestRenderAutoMode(),(d=this._scene)==null||d.traverse(p=>{p instanceof Qo&&p.pendingMediaLoad&&p.update()})}),(h=this._scene)==null||h.traverse(d=>{d.type==="ParticleSystem"&&(d.wakeUp(),d.data.autoPlay?d.start():d.stop())});let a=Object.keys(r.shared.fonts).map(d=>this._sharedAssetsManager.getFont(d).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),g8(r)&&b4e(r)&&await Promise.all(a),V8(r)){let d=[];this._scene.traverseEntity(p=>{(p instanceof Gs||p instanceof rs)&&p.uiCanvas&&d.push(p.uiCanvas)}),await Promise.all(d.map(p=>p.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),RU(this._scene.activePage,this._sharedAssetsManager),!this._renderer&&(this._renderer=new Wze({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark)){let d=this._sharedAssetsManager.getImage("SplineWatermark");await d.loadPromise;let p=d.getTexture(1001);this._renderer.pipeline.setWatermark(p)}Q8(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new Y4e(this._renderer,this._camera,new ve(this._viewportWidth,this._viewportHeight),new ve(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),t){let d=new yFe(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new w4e(d),this._animationControls=new S4e(this._scene,this._requestRenderAutoMode),this._eventManager=new q4e(r.scene.publish,this._controls,this._animationControls,d,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var d;(d=this._renderer)==null||d.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let n=t;typeof i.data.value=="number"?n=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?n=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(n=t.toString());let s=typeof n=="string"?{textValue:n}:n;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&Ss.isTextValue(e)?Ss.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==U0&&!this._scene.isInvisibleObjects(i)&&!(i instanceof rs)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof Cre&&((i=this._controls)==null||i.orbitControls.setZoom(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var a;let{r:t,g:i,b:r,a:n}={r:0,g:0,b:0,a:1},s=new As(t,i,r,n);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(a=this._scene)==null||a.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,n,s,a;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{MH.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(n=this._renderer)==null||n.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(a=this._controls)==null||a.deactivate(),this.dt=0,ePe(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var n;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof rs&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof rs||e instanceof xU||(n=e.parent)==null?void 0:n.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=MH(i,(s,a)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=a),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){qte.skiaWasmUrl=e}},iM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},SN={},a5e={get exports(){return SN},set exports(e){SN=e}},$y={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K9;function o5e(){if(K9)return $y;K9=1;var e=FE,t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,c){var u,h={},d=null,p=null;c!==void 0&&(d=""+c),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(p=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(h[u]=l[u]);if(o&&o.defaultProps)for(u in l=o.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:t,type:o,key:d,ref:p,props:h,_owner:n.current}}return $y.Fragment=i,$y.jsx=a,$y.jsxs=a,$y}(function(e){e.exports=o5e()})(a5e);const MN=SN.jsx;var l5e="Expected a function",J9=NaN,c5e="[object Symbol]",u5e=/^\s+|\s+$/g,h5e=/^[-+]0x[0-9a-f]+$/i,d5e=/^0b[01]+$/i,p5e=/^0o[0-7]+$/i,f5e=parseInt,m5e=typeof iM=="object"&&iM&&iM.Object===Object&&iM,g5e=typeof self=="object"&&self&&self.Object===Object&&self,v5e=m5e||g5e||Function("return this")(),y5e=Object.prototype,x5e=y5e.toString,b5e=Math.max,w5e=Math.min,lL=function(){return v5e.Date.now()};function _5e(e,t,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(l5e);t=$9(t)||0,EN(i)&&(u=!!i.leading,h="maxWait"in i,s=h?b5e($9(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(S){var E=r,A=n;return r=n=void 0,c=S,a=e.apply(A,E),a}function f(S){return c=S,o=setTimeout(g,t),u?p(S):a}function v(S){var E=S-l,A=S-c,P=t-E;return h?w5e(P,s-A):P}function m(S){var E=S-l,A=S-c;return l===void 0||E>=t||E<0||h&&A>=s}function g(){var S=lL();if(m(S))return y(S);o=setTimeout(g,v(S))}function y(S){return o=void 0,d&&r?p(S):(r=n=void 0,a)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function _(){return o===void 0?a:y(lL())}function M(){var S=lL(),E=m(S);if(r=arguments,n=this,l=S,E){if(o===void 0)return f(l);if(h)return o=setTimeout(g,t),p(l)}return o===void 0&&(o=setTimeout(g,t)),a}return M.cancel=x,M.flush=_,M}function EN(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function S5e(e){return!!e&&typeof e=="object"}function M5e(e){return typeof e=="symbol"||S5e(e)&&x5e.call(e)==c5e}function $9(e){if(typeof e=="number")return e;if(M5e(e))return J9;if(EN(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=EN(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(u5e,"");var i=d5e.test(e);return i||p5e.test(e)?f5e(e.slice(2),i?2:8):h5e.test(e)?J9:+e}var E5e=_5e;function A5e(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const C5e=[],T5e={width:"100%",height:"100%"},P5e=R.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=C5e,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=R.useRef(null),u=R.useRef(0),[h,d]=R.useState({width:0,height:0,top:0,left:0}),p=R.useMemo(()=>{const f=Array.isArray(r)?r:[r];return E5e(v=>{d(m=>Object.keys(m).filter(g=>m[g]!==v[g]).every(g=>f.includes(g))?m:v)},i,{leading:s})},[i,s,r]);return R.useEffect(()=>{const f=a||window.ResizeObserver,v=new f(m=>{m.forEach(g=>{const{left:y,top:x,width:_,height:M}=(g==null?void 0:g.contentRect)??{};u.current=window.requestAnimationFrame(()=>{p({width:_,height:M,top:x,left:y})})})});return c.current&&v.observe(c.current),()=>{window.cancelAnimationFrame(u.current),v.disconnect(),p.cancel()}},[p,a]),MN("div",{style:{...T5e,...n},ref:A5e([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:p})})}),D5e=R.forwardRef(({scene:e,style:t,onMouseDown:i,onMouseUp:r,onMouseHover:n,onKeyDown:s,onKeyUp:a,onStart:o,onLookAt:l,onFollow:c,onWheel:u,onLoad:h,renderOnDemand:d=!0,...p},f)=>{const v=R.useRef(null),[m,g]=R.useState(!0);return R.useEffect(()=>{g(!0);let y;const x=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(v.current){y=new s5e(v.current,{renderOnDemand:d});async function _(){await y.load(e);for(let M of x)M.cb&&y.addEventListener(M.name,M.cb);g(!1),h==null||h(y)}_()}return()=>{for(let _ of x)_.cb&&y.removeEventListener(_.name,_.cb);y.dispose()}},[e]),MN(P5e,{ref:f,parentSizeStyles:t,debounceTime:50,...p,children:()=>MN("canvas",{ref:v,style:{display:m?"none":"block"}})})}),L5e=()=>{const[e,t]=R.useState(!0),[i,r]=R.useState(!1),n=()=>{t(!1)},s=()=>{r(!0),t(!1),console.error("Failed to load Spline scene")},a=()=>j.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[j.jsx(Gt.div,{animate:{scale:[1,1.2,1],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"linear"},className:"absolute top-1/4 left-1/4 w-96 h-96 bg-amber-500/20 rounded-full filter blur-3xl"}),j.jsx(Gt.div,{animate:{scale:[1.2,1,1.2],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"linear",delay:2},className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-amber-700/20 rounded-full filter blur-3xl"})]});return j.jsx("div",{className:"fixed inset-0 -z-10 w-full h-screen bg-black",children:i?j.jsx(a,{}):j.jsxs("div",{className:"relative w-full h-full",children:[j.jsx(D5e,{scene:"https://prod.spline.design/scrollbasedinteracvtivemacbookpro-17b4ba19903c98f218dc70372d0a7127/scene.splinecode",onLoad:n,onError:s,style:{opacity:e?0:1,transition:"opacity 0.5s ease-in-out",width:"100%",height:"100%"}}),e&&j.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:j.jsx(Gt.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-amber-400/20 border-t-amber-400 rounded-full"})})]})})},R5e=()=>{const[e,t]=R.useState([{id:1,sender:"Designer",text:"I've updated the living room layout",time:"10:30 AM"},{id:2,sender:"Client",text:"The new design looks great!",time:"10:32 AM"}]),[i,r]=R.useState(""),n=()=>{if(i.trim()==="")return;const s={id:e.length+1,sender:"Client",text:i,time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};t([...e,s]),r("")};return j.jsxs("section",{className:"py-20 relative overflow-hidden",children:[j.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/50 to-black/80 -z-10"}),j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},className:"text-center mb-16",children:[j.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-6",children:"Real-Time Collaboration"}),j.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Experience seamless communication and instant design updates with our real-time collaboration tools."})]}),j.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[j.jsxs(Gt.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},transition:{duration:.8},viewport:{once:!0},className:"bg-black/40 rounded-2xl p-6 backdrop-blur-sm border border-amber-400/10",children:[j.jsxs("div",{className:"flex items-center justify-between mb-6",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx(Ame,{className:"w-6 h-6 text-amber-400"}),j.jsx("h3",{className:"text-xl font-semibold text-white",children:"Live Chat"})]}),j.jsxs("div",{className:"flex items-center space-x-2",children:[j.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),j.jsx("span",{className:"text-green-500 text-sm",children:"Online"})]})]}),j.jsx("div",{className:"space-y-4 mb-6 h-64 overflow-y-auto",children:e.map(s=>j.jsxs("div",{className:`flex flex-col ${s.sender==="Designer"?"items-start":"items-end"}`,children:[j.jsxs("div",{className:`px-4 py-2 rounded-2xl max-w-xs ${s.sender==="Designer"?"bg-amber-400/10 text-white":"bg-amber-400 text-black"}`,children:[j.jsx("p",{className:"text-sm font-medium mb-1",children:s.sender}),j.jsx("p",{children:s.text})]}),j.jsx("span",{className:"text-xs text-gray-400 mt-1",children:s.time})]},s.id))}),j.jsxs("div",{className:"flex space-x-2",children:[j.jsx("input",{type:"text",placeholder:"Type your message...",value:i,onChange:s=>r(s.target.value),onKeyDown:s=>{s.key==="Enter"&&n()},className:"flex-1 px-4 py-2 bg-black/20 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white placeholder-gray-400"}),j.jsx("button",{onClick:n,className:"px-4 py-2 bg-amber-400 text-black rounded-lg hover:bg-amber-300 transition-colors",children:"Send"})]})]}),j.jsxs(Gt.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},transition:{duration:.8},viewport:{once:!0},className:"space-y-8",children:[j.jsxs("div",{className:"flex items-start space-x-4",children:[j.jsx("div",{className:"w-12 h-12 bg-amber-400/10 rounded-lg flex items-center justify-center text-amber-400",children:j.jsx(_J,{className:"w-6 h-6"})}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Client-Designer Communication"}),j.jsx("p",{className:"text-gray-300",children:"Direct communication channel between clients and designers for instant feedback and updates."})]})]}),j.jsxs("div",{className:"flex items-start space-x-4",children:[j.jsx("div",{className:"w-12 h-12 bg-amber-400/10 rounded-lg flex items-center justify-center text-amber-400",children:j.jsx(Tme,{className:"w-6 h-6"})}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Real-Time Design Updates"}),j.jsx("p",{className:"text-gray-300",children:"See design changes as they happen with our real-time 3D visualization updates."})]})]})]})]})]})]})},Pre=()=>{const[e,t]=R.useState(""),[i,r]=R.useState(""),n=["09:00 AM","10:00 AM","11:00 AM","02:00 PM","03:00 PM","04:00 PM"],s=["Personalized design recommendations","Budget planning assistance","Material and color consultation","Timeline and project planning","Virtual tour of similar projects","3D visualization preview"];return j.jsxs("section",{className:"py-20 relative overflow-hidden",children:[j.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/80 to-black/50 -z-10"}),j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},className:"text-center mb-16",children:[j.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-6",children:"Book a Consultation"}),j.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Schedule a free consultation with our expert designers to discuss your vision and requirements."})]}),j.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-start",children:[j.jsxs(Gt.div,{initial:{opacity:0,x:-50},whileInView:{opacity:1,x:0},transition:{duration:.8},viewport:{once:!0},className:"bg-black/40 rounded-2xl p-8 backdrop-blur-sm border border-amber-400/10",children:[j.jsx("h3",{className:"text-2xl font-bold text-white mb-6",children:"Schedule Your Session"}),j.jsxs("form",{className:"space-y-6",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-white mb-2",children:"Name"}),j.jsx("input",{type:"text",className:"w-full px-4 py-3 bg-black/20 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white",placeholder:"Your full name"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-white mb-2",children:"Email"}),j.jsx("input",{type:"email",className:"w-full px-4 py-3 bg-black/20 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white",placeholder:"your@email.com"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-white mb-2",children:"Preferred Date"}),j.jsx("input",{type:"date",value:e,onChange:a=>t(a.target.value),className:"w-full px-4 py-3 bg-black/20 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-white mb-2",children:"Preferred Time"}),j.jsxs("select",{value:i,onChange:a=>r(a.target.value),className:"w-full px-4 py-3 bg-black/20 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white",children:[j.jsx("option",{value:"",children:"Select a time"}),n.map(a=>j.jsx("option",{value:a,children:a},a))]})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-white mb-2",children:"Project Description"}),j.jsx("textarea",{rows:4,className:"w-full px-4 py-3 bg-black/20 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white resize-none",placeholder:"Tell us about your project..."})]}),j.jsxs(Gt.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",className:"w-full px-8 py-4 bg-amber-400 text-black rounded-lg hover:bg-amber-300 transition-colors flex items-center justify-center space-x-2",children:[j.jsx(Uj,{className:"w-5 h-5"}),j.jsx("span",{children:"Book Consultation"})]})]})]}),j.jsxs(Gt.div,{initial:{opacity:0,x:50},whileInView:{opacity:1,x:0},transition:{duration:.8},viewport:{once:!0},className:"space-y-8",children:[j.jsxs("div",{className:"bg-black/40 rounded-2xl p-8 backdrop-blur-sm border border-amber-400/10",children:[j.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[j.jsx(Ome,{className:"w-8 h-8 text-amber-400"}),j.jsx("h3",{className:"text-2xl font-bold text-white",children:"Virtual Consultation"})]}),j.jsx("p",{className:"text-gray-300 mb-6",children:"Our virtual consultations offer the same personalized experience as in-person meetings, with the convenience of connecting from anywhere."}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[j.jsxs("div",{className:"flex items-center space-x-2",children:[j.jsx(vJ,{className:"w-5 h-5 text-amber-400"}),j.jsx("span",{className:"text-white",children:"45-minute session"})]}),j.jsxs("div",{className:"flex items-center space-x-2",children:[j.jsx(Uj,{className:"w-5 h-5 text-amber-400"}),j.jsx("span",{className:"text-white",children:"Flexible scheduling"})]})]})]}),j.jsxs("div",{className:"bg-black/40 rounded-2xl p-8 backdrop-blur-sm border border-amber-400/10",children:[j.jsx("h3",{className:"text-2xl font-bold text-white mb-6",children:"What You'll Get"}),j.jsx("div",{className:"space-y-4",children:s.map((a,o)=>j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx(gJ,{className:"w-5 h-5 text-amber-400 flex-shrink-0"}),j.jsx("span",{className:"text-gray-300",children:a})]},o))})]})]})]})]})]})},I5e=()=>{const e=[{title:"Custom Designs",description:"Tailored solutions to match your unique style and preferences.",icon:"🎨"},{title:"Expert Team",description:"Experienced designers and architects to bring your vision to life.",icon:"👩‍🎨"},{title:"Quality Materials",description:"We use only the finest materials for durability and aesthetics.",icon:"🏗️"}];return j.jsx("div",{className:"py-16 bg-black/10",children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsx(Gt.h2,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},className:"text-3xl font-bold text-white mb-12 text-center",children:"Why Choose Us?"}),j.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:e.map((t,i)=>j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.5,delay:i*.1},viewport:{once:!0},className:"bg-black/20 p-6 rounded-2xl backdrop-blur-sm border border-amber-400/10",children:[j.jsx("div",{className:"text-4xl mb-4",children:t.icon}),j.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),j.jsx("p",{className:"text-gray-300",children:t.description})]},i))})]})})},O5e=()=>{const e=[{title:"Modern Minimalist Living",category:"Residential",image:"https://images.unsplash.com/photo-1600210492486-724fe5c67fb3"},{title:"Luxury Office Space",category:"Commercial",image:"https://images.unsplash.com/photo-1497366811353-6870744d04b2"},{title:"Contemporary Kitchen",category:"Kitchen",image:"https://images.unsplash.com/photo-1556912172-45b7abe8b7e1"}];return j.jsx("div",{className:"py-16",children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsx(Gt.h2,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},className:"text-3xl font-bold text-white mb-4 px-6 py-3 rounded-full bg-black/30 backdrop-blur-sm inline-block mx-auto",children:"Featured Projects"}),j.jsx(Gt.p,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8,delay:.2},viewport:{once:!0},className:"text-gray-300 mb-12 px-4 py-2 rounded-full bg-black/20 backdrop-blur-sm inline-block",children:"Discover our latest interior design transformations"}),j.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((t,i)=>j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.5,delay:i*.1},viewport:{once:!0},className:"group relative overflow-hidden rounded-2xl",children:[j.jsx("div",{className:"aspect-[4/3] overflow-hidden",children:j.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500"})}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:j.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6",children:[j.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),j.jsx("p",{className:"text-amber-400",children:t.category})]})})]},i))}),j.jsx(Gt.div,{initial:{opacity:0},whileInView:{opacity:1},transition:{duration:.8},viewport:{once:!0},className:"text-center mt-12",children:j.jsx(Zo,{to:"/portfolio",children:j.jsxs(Gt.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-8 py-3 bg-amber-400/10 text-amber-400 rounded-full hover:bg-amber-400/20 transition-colors inline-flex items-center",children:["View All Projects",j.jsx(mJ,{className:"ml-2 w-5 h-5"})]})})})]})})};function UT(e,t,i,r){return new(i||(i=Promise))(function(n,s){function a(c){try{l(r.next(c))}catch(u){s(u)}}function o(c){try{l(r.throw(c))}catch(u){s(u)}}function l(c){var u;c.done?n(c.value):(u=c.value,u instanceof i?u:new i(function(h){h(u)})).then(a,o)}l((r=r.apply(e,[])).next())})}function Fd(e,t){var i,r,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(l){return function(c){return function(u){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,r&&(n=2&u[0]?r.return:u[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,u[1])).done)return n;switch(r=0,n&&(u=[2&u[0],n.value]),u[0]){case 0:case 1:n=u;break;case 4:return a.label++,{value:u[1],done:!1};case 5:a.label++,r=u[1],u=[0];continue;case 7:u=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!((n=n.length>0&&n[n.length-1])||u[0]!==6&&u[0]!==2)){a=0;continue}if(u[0]===3&&(!n||u[1]>n[0]&&u[1]<n[3])){a.label=u[1];break}if(u[0]===6&&a.label<n[1]){a.label=n[1],n=u;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(u);break}n[2]&&a.ops.pop(),a.trys.pop();continue}u=t.call(e,a)}catch(h){u=[6,h],r=0}finally{i=n=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,c])}}}function AN(e){var t=typeof Symbol=="function"&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Il(e,t){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r,n,s=i.call(e),a=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(o){n={error:o}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return a}function Ac(e,t,i){if(arguments.length===2)for(var r,n=0,s=t.length;n<s;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}function e7(e,t,i,r,n){for(var s=[],a=5;a<arguments.length;a++)s[a-5]=arguments[a];return UT(this,void 0,void 0,function(){var o,l,c,u,h,d;return Fd(this,function(p){switch(p.label){case 0:p.trys.push([0,12,13,14]),o=AN(s),l=o.next(),p.label=1;case 1:if(l.done)return[3,11];switch(c=l.value,typeof c){case"string":return[3,2];case"number":return[3,4];case"function":return[3,6]}return[3,8];case 2:return[4,N5e(e,t,c,i,r,n)];case 3:return p.sent(),[3,10];case 4:return[4,Dre(c)];case 5:return p.sent(),[3,10];case 6:return[4,c.apply(void 0,Ac([e,t,i,r,n],Il(s),!1))];case 7:return p.sent(),[3,10];case 8:return[4,c];case 9:p.sent(),p.label=10;case 10:return l=o.next(),[3,1];case 11:return[3,14];case 12:return u=p.sent(),h={error:u},[3,14];case 13:try{l&&!l.done&&(d=o.return)&&d.call(o)}finally{if(h)throw h.error}return[7];case 14:return[2]}})})}function N5e(e,t,i,r,n,s){return UT(this,void 0,void 0,function(){var a,o;return Fd(this,function(l){switch(l.label){case 0:return a=e.textContent||"",o=function(c,u){var h=Il(u).slice(0);return Ac(Ac([],Il(c),!1),[NaN],!1).findIndex(function(d,p){return h[p]!==d})}(a,i),[4,z5e(e,Ac(Ac([],Il(k5e(a,t,o)),!1),Il(B5e(i,t,o)),!1),r,n,s)];case 1:return l.sent(),[2]}})})}function Dre(e){return UT(this,void 0,void 0,function(){return Fd(this,function(t){switch(t.label){case 0:return[4,new Promise(function(i){return setTimeout(i,e)})];case 1:return t.sent(),[2]}})})}function z5e(e,t,i,r,n){return UT(this,void 0,void 0,function(){var s,a,o,l,c,u,h,d,p,f,v,m,g;return Fd(this,function(y){switch(y.label){case 0:if(s=t,n){for(a=0,o=1;o<t.length;o++)if(l=Il([t[o-1],t[o]],2),c=l[0],(u=l[1]).length>c.length||u===""){a=o;break}s=t.slice(a,t.length)}y.label=1;case 1:y.trys.push([1,6,7,8]),h=AN(function(x){var _,M,S,E,A,P,C;return Fd(this,function(D){switch(D.label){case 0:_=function(N){return Fd(this,function(U){switch(U.label){case 0:return[4,{op:function(I){return requestAnimationFrame(function(){return I.textContent=N})},opCode:function(I){var G=I.textContent||"";return N===""||G.length>N.length?"DELETE":"WRITING"}}];case 1:return U.sent(),[2]}})},D.label=1;case 1:D.trys.push([1,6,7,8]),M=AN(x),S=M.next(),D.label=2;case 2:return S.done?[3,5]:(E=S.value,[5,_(E)]);case 3:D.sent(),D.label=4;case 4:return S=M.next(),[3,2];case 5:return[3,8];case 6:return A=D.sent(),P={error:A},[3,8];case 7:try{S&&!S.done&&(C=M.return)&&C.call(M)}finally{if(P)throw P.error}return[7];case 8:return[2]}})}(s)),d=h.next(),y.label=2;case 2:return d.done?[3,5]:(p=d.value,f=p.opCode(e)==="WRITING"?i+i*(Math.random()-.5):r+r*(Math.random()-.5),p.op(e),[4,Dre(f)]);case 3:y.sent(),y.label=4;case 4:return d=h.next(),[3,2];case 5:return[3,8];case 6:return v=y.sent(),m={error:v},[3,8];case 7:try{d&&!d.done&&(g=h.return)&&g.call(h)}finally{if(m)throw m.error}return[7];case 8:return[2]}})})}function B5e(e,t,i){var r,n;return i===void 0&&(i=0),Fd(this,function(s){switch(s.label){case 0:r=t(e),n=r.length,s.label=1;case 1:return i<n?[4,r.slice(0,++i).join("")]:[3,3];case 2:return s.sent(),[3,1];case 3:return[2]}})}function k5e(e,t,i){var r,n;return i===void 0&&(i=0),Fd(this,function(s){switch(s.label){case 0:r=t(e),n=r.length,s.label=1;case 1:return n>i?[4,r.slice(0,--n).join("")]:[3,3];case 2:return s.sent(),[3,1];case 3:return[2]}})}var U5e="index-module_type__E-SaG";(function(e,t){t===void 0&&(t={});var i=t.insertAt;if(typeof document<"u"){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",i==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}})(`.index-module_type__E-SaG::after {
  content: '|';
  animation: index-module_cursor__PQg0P 1.1s infinite step-start;
}

@keyframes index-module_cursor__PQg0P {
  50% {
    opacity: 0;
  }
}
`);var F5e=R.memo(R.forwardRef(function(e,t){var i=e.sequence,r=e.repeat,n=e.className,s=e.speed,a=s===void 0?40:s,o=e.deletionSpeed,l=e.omitDeletionAnimation,c=l!==void 0&&l,u=e.preRenderFirstString,h=u!==void 0&&u,d=e.wrapper,p=d===void 0?"span":d,f=e.splitter,v=f===void 0?function(F){return Ac([],Il(F),!1)}:f,m=e.cursor,g=m===void 0||m,y=e.style,x=function(F,W){var ee={};for(var ae in F)Object.prototype.hasOwnProperty.call(F,ae)&&W.indexOf(ae)<0&&(ee[ae]=F[ae]);if(F!=null&&typeof Object.getOwnPropertySymbols=="function"){var K=0;for(ae=Object.getOwnPropertySymbols(F);K<ae.length;K++)W.indexOf(ae[K])<0&&Object.prototype.propertyIsEnumerable.call(F,ae[K])&&(ee[ae[K]]=F[ae[K]])}return ee}(e,["sequence","repeat","className","speed","deletionSpeed","omitDeletionAnimation","preRenderFirstString","wrapper","splitter","cursor","style"]),_=x["aria-label"],M=x["aria-hidden"],S=x.role;o||(o=a);var E=new Array(2).fill(40);[a,o].forEach(function(F,W){switch(typeof F){case"number":E[W]=Math.abs(F-100);break;case"object":var ee=F.type,ae=F.value;if(typeof ae!="number")break;ee==="keyStrokeDelayInMs"&&(E[W]=ae)}});var A,P,C,D,N,U,I=E[0],G=E[1],Q=function(F,W){W===void 0&&(W=null);var ee=R.useRef(W);return R.useEffect(function(){F&&(typeof F=="function"?F(ee.current):F.current=ee.current)},[F]),ee}(t),Y=U5e;A=n?"".concat(g?Y+" ":"").concat(n):g?Y:"",P=R.useRef(function(){var F,W=i;r===1/0?F=e7:typeof r=="number"&&(W=Array(1+r).fill(i).flat());var ee=F?Ac(Ac([],Il(W),!1),[F],!1):Ac([],Il(W),!1);return e7.apply(void 0,Ac([Q.current,v,I,G,c],Il(ee),!1)),function(){Q.current}}),C=R.useRef(),D=R.useRef(!1),N=R.useRef(!1),U=Il(R.useState(0),2)[1],D.current&&(N.current=!0),R.useEffect(function(){return D.current||(C.current=P.current(),D.current=!0),U(function(F){return F+1}),function(){N.current&&C.current&&C.current()}},[]);var O=p,V=h?i.find(function(F){return typeof F=="string"})||"":null;return FE.createElement(O,{"aria-hidden":M,"aria-label":_,role:S,style:y,className:A,children:_?FE.createElement("span",{"aria-hidden":"true",ref:Q,children:V}):V,ref:_?void 0:Q})}),function(e,t){return!0});const V5e=()=>{const e=[{icon:j.jsx(Lme,{className:"w-6 h-6"}),value:"10+",label:"Years Experience"},{icon:j.jsx(_J,{className:"w-6 h-6"}),value:"200+",label:"Happy Clients"},{icon:j.jsx(gJ,{className:"w-6 h-6"}),value:"500+",label:"Projects Completed"}];return j.jsx("div",{className:"relative pt-32 pb-16",children:j.jsx("div",{className:"container mx-auto px-6",children:j.jsxs(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center max-w-4xl mx-auto",children:[j.jsx(Gt.div,{initial:{scale:0},animate:{scale:1},transition:{duration:.5,delay:.2},className:"w-20 h-20 bg-amber-400/10 rounded-full flex items-center justify-center mx-auto mb-8",children:j.jsx(Gt.div,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:"w-16 h-16 bg-amber-400/20 rounded-full flex items-center justify-center",children:j.jsx(Gt.div,{animate:{rotate:-360},transition:{duration:15,repeat:1/0,ease:"linear"},className:"w-12 h-12 bg-amber-400/30 rounded-full flex items-center justify-center",children:j.jsx("span",{className:"text-2xl",children:"✨"})})})}),j.jsxs(Gt.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.3},className:"text-4xl md:text-6xl font-bold text-white mb-6 px-8 py-4 rounded-full bg-black/30 backdrop-blur-sm border border-amber-400/10 mx-4 md:mx-8",children:["Transform Your Space with"," ",j.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-amber-400 to-amber-600 animate-gradient",children:"Elegant Design"})]}),j.jsx("div",{className:"h-12 mb-8 px-6 py-2 rounded-full bg-black/20 backdrop-blur-sm inline-block",children:j.jsx(F5e,{sequence:["Modern Interior Solutions",2e3,"Luxury Living Spaces",2e3,"Professional Design Services",2e3],wrapper:"div",speed:50,repeat:1/0,className:"text-xl md:text-2xl text-amber-400"})}),j.jsx(Gt.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"text-xl text-gray-300 mb-8 px-6 py-3 rounded-full bg-black/20 backdrop-blur-sm mx-4 md:block hidden",children:"We create stunning interior designs that reflect your style and enhance your living experience. From concept to completion, we bring your vision to life."}),j.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[j.jsx(Zo,{to:"/contact",children:j.jsxs(Gt.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-8 py-3 bg-amber-400 text-black rounded-full font-medium hover:bg-amber-300 transition-colors flex items-center",children:["Start Your Project",j.jsx(mJ,{className:"ml-2 w-5 h-5"})]})}),j.jsx(Zo,{to:"/portfolio",children:j.jsx(Gt.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-8 py-3 border-2 border-amber-400/20 text-white rounded-full hover:border-amber-400/40 transition-colors",children:"View Portfolio"})})]}),j.jsx(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8,delay:.4},className:"grid grid-cols-1 md:grid-cols-3 gap-8 mt-16",children:e.map((t,i)=>j.jsxs(Gt.div,{whileHover:{scale:1.05},className:"bg-black/30 rounded-2xl p-6 backdrop-blur-sm border border-amber-400/10",children:[j.jsx("div",{className:"text-amber-400 mb-2",children:t.icon}),j.jsx("div",{className:"text-3xl font-bold text-white mb-1",children:t.value}),j.jsx("div",{className:"text-gray-400",children:t.label})]},i))})]})})})},j5e=()=>j.jsxs(Gt.div,{className:"spinner-container",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:[j.jsx("div",{className:"spinner",children:j.jsx(Gt.div,{className:"spinner-inner",animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"}})}),j.jsx(Gt.p,{className:"spinner-text",initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5}})]}),H5e=()=>{const[e,t]=R.useState(!0);return R.useEffect(()=>{const i=setTimeout(()=>{t(!1)},2e3);return()=>clearTimeout(i)},[]),e?j.jsx(j5e,{}):j.jsxs("div",{className:"relative min-h-screen",children:[j.jsx(L5e,{}),j.jsx(V5e,{}),j.jsx(I5e,{}),j.jsx(O5e,{}),j.jsx(R5e,{}),j.jsx(Pre,{})]})},G5e=()=>{const e=[{icon:j.jsx(Cme,{className:"w-8 h-8"}),title:"Interior Design",description:"Complete interior design solutions tailored to your style and needs. We create spaces that inspire and delight.",features:["Space Planning","Color Consultation","Furniture Selection","Material Selection"]},{icon:j.jsx(wJ,{className:"w-8 h-8"}),title:"Furniture Design",description:"Custom furniture design and selection to perfectly match your space and lifestyle.",features:["Custom Furniture","Upholstery","Furniture Layout","Ergonomic Design"]},{icon:j.jsx(yJ,{className:"w-8 h-8"}),title:"Residential Design",description:"Transform your home into a beautiful and functional living space that reflects your personality.",features:["Room Makeovers","Kitchen Design","Bathroom Design","Living Spaces"]},{icon:j.jsx(_me,{className:"w-8 h-8"}),title:"Lighting Design",description:"Strategic lighting solutions that enhance the ambiance and functionality of your space.",features:["Ambient Lighting","Task Lighting","Accent Lighting","Natural Light"]},{icon:j.jsx(Pme,{className:"w-8 h-8"}),title:"Space Planning",description:"Optimize your space for maximum efficiency and flow with our expert planning services.",features:["Layout Design","Traffic Flow","Storage Solutions","Space Optimization"]},{icon:j.jsx(yme,{className:"w-8 h-8"}),title:"3D Visualization",description:"See your space come to life before any work begins with our detailed 3D renderings.",features:["3D Modeling","Virtual Tours","Material Preview","Lighting Simulation"]}];return j.jsx("div",{className:"pt-24 pb-16 min-h-screen",children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-16",children:[j.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Our Services"}),j.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"We offer a comprehensive range of interior design services to transform your space into something extraordinary."})]}),j.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((t,i)=>j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.5,delay:i*.1},viewport:{once:!0},className:"group bg-gradient-to-br from-black/50 to-black/30 rounded-2xl p-8 border border-amber-400/10 hover:border-amber-400/30 transition-all duration-300",children:[j.jsx("div",{className:"mb-6 text-amber-400 group-hover:scale-110 transform transition-transform duration-300",children:t.icon}),j.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:t.title}),j.jsx("p",{className:"text-gray-300 mb-6",children:t.description}),j.jsx("ul",{className:"space-y-2",children:t.features.map((r,n)=>j.jsxs("li",{className:"text-gray-400 flex items-center",children:[j.jsx("span",{className:"w-1.5 h-1.5 bg-amber-400 rounded-full mr-2"}),r]},n))})]},i))})]})})},W5e=()=>{const[e,t]=R.useState("all"),i=[{title:"Modern Minimalist Living Room",category:"residential",image:"https://images.unsplash.com/photo-1600210492486-724fe5c67fb3",description:"A clean, minimalist design focusing on essential elements and natural light."},{title:"Luxury Master Bedroom",category:"residential",image:"https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af",description:"Elegant master bedroom design with custom lighting and furniture."},{title:"Contemporary Office Space",category:"commercial",image:"https://images.unsplash.com/photo-1497366216548-37526070297c",description:"Modern office design promoting productivity and collaboration."},{title:"Boutique Restaurant Interior",category:"commercial",image:"https://images.unsplash.com/photo-1537726235470-8504e3beef77",description:"Atmospheric restaurant design with custom lighting and seating."},{title:"Urban Loft Kitchen",category:"kitchen",image:"https://images.unsplash.com/photo-1556912172-45b7abe8b7e1",description:"Industrial-style kitchen with modern appliances and clean lines."},{title:"Spa-Like Bathroom",category:"bathroom",image:"https://images.unsplash.com/photo-1552321554-5fefe8c9ef14",description:"Luxurious bathroom design with high-end fixtures and natural materials."}],r=[{id:"all",name:"All Projects"},{id:"residential",name:"Residential"},{id:"commercial",name:"Commercial"},{id:"kitchen",name:"Kitchen"},{id:"bathroom",name:"Bathroom"}],n=e==="all"?i:i.filter(s=>s.category===e);return j.jsx("div",{className:"pt-24 pb-16 min-h-screen",children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-16",children:[j.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Our Portfolio"}),j.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto mb-12",children:"Explore our collection of thoughtfully designed spaces that showcase our commitment to excellence."}),j.jsx("div",{className:"flex flex-wrap justify-center gap-4 mb-12",children:r.map(s=>j.jsx(Gt.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>t(s.id),className:`px-6 py-2 rounded-full transition-colors ${e===s.id?"bg-amber-400 text-black":"bg-black/30 text-white hover:bg-black/50"}`,children:s.name},s.id))})]}),j.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:n.map((s,a)=>j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.5,delay:a*.1},viewport:{once:!0},className:"group relative overflow-hidden rounded-2xl",children:[j.jsx("div",{className:"aspect-[4/3] overflow-hidden",children:j.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500"})}),j.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:j.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6",children:[j.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.title}),j.jsx("p",{className:"text-gray-300 mb-4",children:s.description}),j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx(Gt.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"p-2 bg-amber-400 rounded-full text-black",children:j.jsx(Mme,{className:"w-5 h-5"})}),j.jsx(Gt.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"p-2 bg-white/10 rounded-full text-white hover:bg-white/20",children:j.jsx(xme,{className:"w-5 h-5"})})]})]})})]},a))})]})})},X5e=()=>{const[e,t]=R.useState({name:"",email:"",phone:"",service:"",message:""}),i=n=>{n.preventDefault(),console.log("Form submitted:",e)},r=["Interior Design","Furniture Design","Residential Design","Lighting Design","Space Planning","3D Visualization"];return j.jsxs("div",{className:"pt-24 pb-16 min-h-screen relative overflow-hidden",children:[j.jsxs("div",{className:"absolute inset-0 -z-10",children:[j.jsx("div",{className:"absolute top-0 left-0 w-72 h-72 bg-amber-500/10 rounded-full filter blur-3xl animate-blob"}),j.jsx("div",{className:"absolute top-0 right-0 w-72 h-72 bg-amber-700/10 rounded-full filter blur-3xl animate-blob animation-delay-2000"}),j.jsx("div",{className:"absolute bottom-0 left-1/2 w-72 h-72 bg-amber-600/10 rounded-full filter blur-3xl animate-blob animation-delay-4000"})]}),j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.8},className:"text-center mb-16",children:[j.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"Get In Touch"}),j.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Ready to transform your space? Contact us for a consultation and let's bring your vision to life."})]}),j.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-start",children:[j.jsx(Gt.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.8},className:"space-y-8",children:j.jsxs("div",{className:"bg-black/30 rounded-2xl p-8 backdrop-blur-sm border border-amber-400/10",children:[j.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Contact Information"}),j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"w-12 h-12 bg-amber-400/10 rounded-lg flex items-center justify-center text-amber-400",children:j.jsx(xJ,{className:"w-6 h-6"})}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-semibold",children:"Email"}),j.jsx("p",{className:"text-gray-300",children:"contact@zaininterior.com"})]})]}),j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"w-12 h-12 bg-amber-400/10 rounded-lg flex items-center justify-center text-amber-400",children:j.jsx(bJ,{className:"w-6 h-6"})}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-semibold",children:"Phone"}),j.jsx("p",{className:"text-gray-300",children:"+1 (234) 567-8900"})]})]}),j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"w-12 h-12 bg-amber-400/10 rounded-lg flex items-center justify-center text-amber-400",children:j.jsx(QB,{className:"w-6 h-6"})}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-semibold",children:"Location"}),j.jsx("p",{className:"text-gray-300",children:"123 Design Street, New York, NY"})]})]}),j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("div",{className:"w-12 h-12 bg-amber-400/10 rounded-lg flex items-center justify-center text-amber-400",children:j.jsx(vJ,{className:"w-6 h-6"})}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-semibold",children:"Business Hours"}),j.jsx("p",{className:"text-gray-300",children:"Mon - Fri: 9:00 AM - 6:00 PM"})]})]})]})]})}),j.jsx(Gt.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.8},children:j.jsxs("form",{onSubmit:i,className:"bg-black/30 rounded-2xl p-8 backdrop-blur-sm border border-amber-400/10",children:[j.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Send us a Message"}),j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{children:[j.jsx("label",{htmlFor:"name",className:"block text-white mb-2",children:"Name"}),j.jsx("input",{type:"text",id:"name",value:e.name,onChange:n=>t({...e,name:n.target.value}),className:"w-full px-4 py-3 bg-black/30 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white",required:!0})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"email",className:"block text-white mb-2",children:"Email"}),j.jsx("input",{type:"email",id:"email",value:e.email,onChange:n=>t({...e,email:n.target.value}),className:"w-full px-4 py-3 bg-black/30 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white",required:!0})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"phone",className:"block text-white mb-2",children:"Phone"}),j.jsx("input",{type:"tel",id:"phone",value:e.phone,onChange:n=>t({...e,phone:n.target.value}),className:"w-full px-4 py-3 bg-black/30 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white"})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"service",className:"block text-white mb-2",children:"Service Interested In"}),j.jsxs("select",{id:"service",value:e.service,onChange:n=>t({...e,service:n.target.value}),className:"w-full px-4 py-3 bg-black/30 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white",required:!0,children:[j.jsx("option",{value:"",children:"Select a service"}),r.map(n=>j.jsx("option",{value:n,children:n},n))]})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"message",className:"block text-white mb-2",children:"Message"}),j.jsx("textarea",{id:"message",value:e.message,onChange:n=>t({...e,message:n.target.value}),rows:5,className:"w-full px-4 py-3 bg-black/30 border border-amber-400/20 rounded-lg focus:outline-none focus:border-amber-400/40 text-white resize-none",required:!0})]}),j.jsxs(Gt.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",className:"w-full px-8 py-4 bg-amber-400 text-black rounded-lg hover:bg-amber-300 transition-colors flex items-center justify-center space-x-2",children:[j.jsx("span",{children:"Send Message"}),j.jsx(Dme,{className:"w-4 h-4"})]})]})]})})]})]})]})},q5e=()=>{const e=new Date().getFullYear();return j.jsx("footer",{className:"bg-black/30 pt-16 pb-8 border-t border-amber-400/10",children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12",children:[j.jsxs("div",{children:[j.jsxs(Zo,{to:"/",className:"flex items-center space-x-2 mb-6",children:[j.jsx(Gt.div,{whileHover:{scale:1.1,rotate:360},transition:{duration:.5},children:j.jsx(wJ,{className:"w-8 h-8 text-amber-400"})}),j.jsx("span",{className:"text-2xl font-bold text-white",children:"Zain Interior"})]}),j.jsx("p",{className:"text-gray-300 mb-6",children:"Transforming spaces into extraordinary experiences through innovative design and meticulous attention to detail."}),j.jsx("div",{className:"flex space-x-4",children:[{icon:j.jsx(wme,{className:"w-5 h-5"}),href:"#"},{icon:j.jsx(bme,{className:"w-5 h-5"}),href:"#"},{icon:j.jsx(Rme,{className:"w-5 h-5"}),href:"#"},{icon:j.jsx(Sme,{className:"w-5 h-5"}),href:"#"}].map((t,i)=>j.jsx(Gt.a,{href:t.href,whileHover:{scale:1.1,y:-3},className:"w-10 h-10 rounded-full bg-amber-400/10 flex items-center justify-center text-amber-400 hover:bg-amber-400/20 transition-colors",children:t.icon},i))})]}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-bold text-lg mb-6",children:"Quick Links"}),j.jsx("ul",{className:"space-y-4",children:[{text:"About Us",href:"/about"},{text:"Services",href:"/services"},{text:"Portfolio",href:"/portfolio"},{text:"Contact",href:"/contact"}].map((t,i)=>j.jsx("li",{children:j.jsx(Zo,{to:t.href,className:"text-gray-300 hover:text-amber-400 transition-colors",children:t.text})},i))})]}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-bold text-lg mb-6",children:"Our Services"}),j.jsx("ul",{className:"space-y-4",children:["Interior Design","Furniture Design","Space Planning","3D Visualization","Lighting Design","Color Consultation"].map((t,i)=>j.jsx("li",{className:"text-gray-300",children:t},i))})]}),j.jsxs("div",{children:[j.jsx("h3",{className:"text-white font-bold text-lg mb-6",children:"Contact Info"}),j.jsxs("ul",{className:"space-y-4",children:[j.jsxs("li",{className:"flex items-center text-gray-300",children:[j.jsx(xJ,{className:"w-5 h-5 text-amber-400 mr-3"}),"contact@zaininterior.com"]}),j.jsxs("li",{className:"flex items-center text-gray-300",children:[j.jsx(bJ,{className:"w-5 h-5 text-amber-400 mr-3"}),"+1 (234) 567-8900"]}),j.jsxs("li",{className:"flex items-center text-gray-300",children:[j.jsx(QB,{className:"w-5 h-5 text-amber-400 mr-3"}),"123 Design Street, New York, NY"]})]})]})]}),j.jsx("div",{className:"border-t border-amber-400/10 pt-8 mt-8",children:j.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[j.jsxs("p",{className:"text-gray-400 text-center md:text-left mb-4 md:mb-0",children:["© ",e," Zain Interior. All rights reserved."]}),j.jsxs("div",{className:"flex space-x-6",children:[j.jsx(Zo,{to:"/privacy",className:"text-gray-400 hover:text-amber-400 transition-colors",children:"Privacy Policy"}),j.jsx(Zo,{to:"/terms",className:"text-gray-400 hover:text-amber-400 transition-colors",children:"Terms of Service"})]})]})})]})})};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ow="162",ef={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},tf={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Lre=0,CN=1,Rre=2,Y5e=3,Ire=0,FT=1,ux=2,Cl=3,hh=0,xa=1,Cc=2,$u=0,Ff=1,EC=2,TN=3,PN=4,Ore=5,pd=100,Nre=101,zre=102,DN=103,LN=104,Bre=200,kre=201,Ure=202,Fre=203,AC=204,CC=205,Vre=206,jre=207,Hre=208,Gre=209,Wre=210,Xre=211,qre=212,Yre=213,Zre=214,Qre=0,Kre=1,Jre=2,cb=3,$re=4,ene=5,tne=6,ine=7,lw=0,rne=1,nne=2,Fc=0,sne=1,ane=2,one=3,OU=4,lne=5,cne=6,une=7,RN="attached",hne="detached",VT=300,dh=301,$d=302,ub=303,hb=304,G0=306,db=1e3,Ws=1001,pb=1002,cn=1003,TC=1004,Z5e=1004,hf=1005,Q5e=1005,Nr=1006,hx=1007,K5e=1007,Dc=1008,J5e=1008,Vc=1009,dne=1010,pne=1011,jT=1012,NU=1013,Xu=1014,oo=1015,g0=1016,zU=1017,BU=1018,Vd=1020,fne=1021,fa=1023,mne=1024,gne=1025,jd=1026,nm=1027,kU=1028,UU=1029,vne=1030,FU=1031,VU=1033,RE=33776,IE=33777,OE=33778,NE=33779,IN=35840,ON=35841,NN=35842,zN=35843,jU=36196,BN=37492,kN=37496,UN=37808,FN=37809,VN=37810,jN=37811,HN=37812,GN=37813,WN=37814,XN=37815,qN=37816,YN=37817,ZN=37818,QN=37819,KN=37820,JN=37821,zE=36492,$N=36494,ez=36495,yne=36283,tz=36284,iz=36285,rz=36286,xne=2200,bne=2201,wne=2202,fb=2300,mb=2301,BE=2302,Ef=2400,Af=2401,gb=2402,HT=2500,HU=2501,$5e=0,eVe=1,tVe=2,_ne=3200,Sne=3201,up=0,Mne=1,zu="",Ho="srgb",vh="srgb-linear",GT="display-p3",cw="display-p3-linear",vb="linear",xr="srgb",yb="rec709",xb="p3",iVe=0,rf=7680,rVe=7681,nVe=7682,sVe=7683,aVe=34055,oVe=34056,lVe=5386,cVe=512,uVe=513,hVe=514,dVe=515,pVe=516,fVe=517,mVe=518,nz=519,Ene=512,Ane=513,Cne=514,GU=515,Tne=516,Pne=517,Dne=518,Lne=519,bb=35044,gVe=35048,vVe=35040,yVe=35045,xVe=35049,bVe=35041,wVe=35046,_Ve=35050,SVe=35042,MVe="100",sz="300 es",PC=1035,Lc=2e3,wb=2001;let yh=class{addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}};const ks=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let t7=1234567;const Vf=Math.PI/180,v0=180/Math.PI;function fo(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(ks[e&255]+ks[e>>8&255]+ks[e>>16&255]+ks[e>>24&255]+"-"+ks[t&255]+ks[t>>8&255]+"-"+ks[t>>16&15|64]+ks[t>>24&255]+"-"+ks[i&63|128]+ks[i>>8&255]+"-"+ks[i>>16&255]+ks[i>>24&255]+ks[r&255]+ks[r>>8&255]+ks[r>>16&255]+ks[r>>24&255]).toLowerCase()}function Kr(e,t,i){return Math.max(t,Math.min(i,e))}function WU(e,t){return(e%t+t)%t}function EVe(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)}function AVe(e,t,i){return e!==t?(i-e)/(t-e):0}function dx(e,t,i){return(1-i)*e+i*t}function CVe(e,t,i,r){return dx(e,t,1-Math.exp(-i*r))}function TVe(e,t=1){return t-Math.abs(WU(e,t*2)-t)}function PVe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function DVe(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function LVe(e,t){return e+Math.floor(Math.random()*(t-e+1))}function RVe(e,t){return e+Math.random()*(t-e)}function IVe(e){return e*(.5-Math.random())}function OVe(e){e!==void 0&&(t7=e);let t=t7+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function NVe(e){return e*Vf}function zVe(e){return e*v0}function az(e){return(e&e-1)===0&&e!==0}function BVe(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function DC(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function kVe(e,t,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((t+r)/2),u=a((t+r)/2),h=s((t-r)/2),d=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(n){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function ma(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function bi(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(e*4294967295);case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int32Array:return Math.round(e*2147483647);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}const UVe={DEG2RAD:Vf,RAD2DEG:v0,generateUUID:fo,clamp:Kr,euclideanModulo:WU,mapLinear:EVe,inverseLerp:AVe,lerp:dx,damp:CVe,pingpong:TVe,smoothstep:PVe,smootherstep:DVe,randInt:LVe,randFloat:RVe,randFloatSpread:IVe,seededRandom:OVe,degToRad:NVe,radToDeg:zVe,isPowerOfTwo:az,ceilPowerOfTwo:BVe,floorPowerOfTwo:DC,setQuaternionFromProperEuler:kVe,normalize:bi,denormalize:ma};class nt{constructor(t=0,i=0){nt.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const i=this.x,r=this.y,n=t.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Kr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-t.x,a=this.y-t.y;return this.x=s*r-a*n+t.x,this.y=s*n+a*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class xi{constructor(t,i,r,n,s,a,o,l,c){xi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c)}set(t,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(t,i,r){return t.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const i=t.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],p=r[5],f=r[8],v=n[0],m=n[3],g=n[6],y=n[1],x=n[4],_=n[7],M=n[2],S=n[5],E=n[8];return s[0]=a*v+o*y+l*M,s[3]=a*m+o*x+l*S,s[6]=a*g+o*_+l*E,s[1]=c*v+u*y+h*M,s[4]=c*m+u*x+h*S,s[7]=c*g+u*_+h*E,s[2]=d*v+p*y+f*M,s[5]=d*m+p*x+f*S,s[8]=d*g+p*_+f*E,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=u*a-o*c,d=o*l-u*s,p=c*s-a*l,f=i*h+r*d+n*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/f;return t[0]=h*v,t[1]=(n*c-u*r)*v,t[2]=(o*r-n*a)*v,t[3]=d*v,t[4]=(u*i-n*l)*v,t[5]=(n*s-o*i)*v,t[6]=p*v,t[7]=(r*l-c*i)*v,t[8]=(a*i-r*s)*v,this}transpose(){let t;const i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const i=this.elements;return t[0]=i[0],t[1]=i[3],t[2]=i[6],t[3]=i[1],t[4]=i[4],t[5]=i[7],t[6]=i[2],t[7]=i[5],t[8]=i[8],this}setUvTransform(t,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+t,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(t,i){return this.premultiply(cL.makeScale(t,i)),this}rotate(t){return this.premultiply(cL.makeRotation(-t)),this}translate(t,i){return this.premultiply(cL.makeTranslation(t,i)),this}makeTranslation(t,i){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,i,0,0,1),this}makeRotation(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(t,i){return this.set(t,0,0,0,i,0,0,0,1),this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<9;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const cL=new xi;function Rne(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const FVe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function yv(e,t){return new FVe[e](t)}function _b(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ine(){const e=_b("canvas");return e.style.display="block",e}const i7={};function One(e){e in i7||(i7[e]=!0,console.warn(e))}const r7=new xi().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),n7=new xi().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),rM={[vh]:{transfer:vb,primaries:yb,toReference:e=>e,fromReference:e=>e},[Ho]:{transfer:xr,primaries:yb,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()},[cw]:{transfer:vb,primaries:xb,toReference:e=>e.applyMatrix3(n7),fromReference:e=>e.applyMatrix3(r7)},[GT]:{transfer:xr,primaries:xb,toReference:e=>e.convertSRGBToLinear().applyMatrix3(n7),fromReference:e=>e.applyMatrix3(r7).convertLinearToSRGB()}},VVe=new Set([vh,cw]),ir={enabled:!0,_workingColorSpace:vh,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){if(!VVe.has(e))throw new Error(`Unsupported working color space, "${e}".`);this._workingColorSpace=e},convert:function(e,t,i){if(this.enabled===!1||t===i||!t||!i)return e;const r=rM[t].toReference,n=rM[i].fromReference;return n(r(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return rM[e].primaries},getTransfer:function(e){return e===zu?vb:rM[e].transfer}};function Hv(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function uL(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}let gg;class XU{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{gg===void 0&&(gg=_b("canvas")),gg.width=t.width,gg.height=t.height;const r=gg.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),i=gg}return i.width>2048||i.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),i.toDataURL("image/jpeg",.6)):i.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const i=_b("canvas");i.width=t.width,i.height=t.height;const r=i.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const n=r.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Hv(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(t.data){const i=t.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Hv(i[r]/255)*255):i[r]=Hv(i[r]);return{data:i,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let jVe=0;class Cf{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:jVe++}),this.uuid=fo(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(hL(n[a].image)):s.push(hL(n[a]))}else s=hL(n);r.url=s}return i||(t.images[this.uuid]=r),r}}function hL(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?XU.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let HVe=0;class en extends yh{constructor(t=en.DEFAULT_IMAGE,i=en.DEFAULT_MAPPING,r=Ws,n=Ws,s=Nr,a=Dc,o=fa,l=Vc,c=en.DEFAULT_ANISOTROPY,u=zu){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:HVe++}),this.uuid=fo(),this.name="",this.source=new Cf(t),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new nt(0,0),this.repeat=new nt(1,1),this.center=new nt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=t===void 0||typeof t=="string";if(!i&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==VT)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case db:t.x=t.x-Math.floor(t.x);break;case Ws:t.x=t.x<0?0:1;break;case pb:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case db:t.y=t.y-Math.floor(t.y);break;case Ws:t.y=t.y<0?0:1;break;case pb:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}en.DEFAULT_IMAGE=null;en.DEFAULT_MAPPING=VT;en.DEFAULT_ANISOTROPY=1;class nr{constructor(t=0,i=0,r=0,n=1){nr.prototype.isVector4=!0,this.x=t,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,i,r,n){return this.x=t,this.y=i,this.z=r,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=this.w,a=t.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this}setAxisAngleFromRotationMatrix(t){let i,r,n,s;const l=t.elements,c=l[0],u=l[4],h=l[8],d=l[1],p=l[5],f=l[9],v=l[2],m=l[6],g=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-v)<.01&&Math.abs(f-m)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+v)<.1&&Math.abs(f+m)<.1&&Math.abs(c+p+g-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const x=(c+1)/2,_=(p+1)/2,M=(g+1)/2,S=(u+d)/4,E=(h+v)/4,A=(f+m)/4;return x>_&&x>M?x<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(x),n=S/r,s=E/r):_>M?_<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(_),r=S/n,s=A/n):M<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(M),r=E/s,n=A/s),this.set(r,n,s,i),this}let y=Math.sqrt((m-f)*(m-f)+(h-v)*(h-v)+(d-u)*(d-u));return Math.abs(y)<.001&&(y=1),this.x=(m-f)/y,this.y=(h-v)/y,this.z=(d-u)/y,this.w=Math.acos((c+p+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this.w=Math.max(t,Math.min(i,this.w)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this.w=t.w+(i.w-t.w)*r,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this.w=t.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Nne extends yh{constructor(t=1,i=1,r={}){super(),this.isRenderTarget=!0,this.width=t,this.height=i,this.depth=1,this.scissor=new nr(0,0,t,i),this.scissorTest=!1,this.viewport=new nr(0,0,t,i);const n={width:t,height:i,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Nr,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},r);const s=new en(n,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);s.flipY=!1,s.generateMipmaps=r.generateMipmaps,s.internalFormat=r.internalFormat,this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,i,r=1){if(this.width!==t||this.height!==i||this.depth!==r){this.width=t,this.height=i,this.depth=r;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=t,this.textures[n].image.height=i,this.textures[n].image.depth=r;this.dispose()}this.viewport.set(0,0,t,i),this.scissor.set(0,0,t,i)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let r=0,n=t.textures.length;r<n;r++)this.textures[r]=t.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const i=Object.assign({},t.texture.image);return this.texture.source=new Cf(i),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Wl extends Nne{constructor(t=1,i=1,r={}){super(t,i,r),this.isWebGLRenderTarget=!0}}class WT extends en{constructor(t=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=cn,this.minFilter=cn,this.wrapR=Ws,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class GVe extends Wl{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new WT(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class qU extends en{constructor(t=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:i,height:r,depth:n},this.magFilter=cn,this.minFilter=cn,this.wrapR=Ws,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WVe extends Wl{constructor(t=1,i=1,r=1,n={}){super(t,i,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new qU(null,t,i,r),this.texture.isRenderTargetTexture=!0}}class Zs{constructor(t=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=t,this._y=i,this._z=r,this._w=n}static slerpFlat(t,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],p=s[a+1],f=s[a+2],v=s[a+3];if(o===0){t[i+0]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h;return}if(o===1){t[i+0]=d,t[i+1]=p,t[i+2]=f,t[i+3]=v;return}if(h!==v||l!==d||c!==p||u!==f){let m=1-o;const g=l*d+c*p+u*f+h*v,y=g>=0?1:-1,x=1-g*g;if(x>Number.EPSILON){const M=Math.sqrt(x),S=Math.atan2(M,g*y);m=Math.sin(m*S)/M,o=Math.sin(o*S)/M}const _=o*y;if(l=l*m+d*_,c=c*m+p*_,u=u*m+f*_,h=h*m+v*_,m===1-o){const M=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=M,c*=M,u*=M,h*=M}}t[i]=l,t[i+1]=c,t[i+2]=u,t[i+3]=h}static multiplyQuaternionsFlat(t,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],p=s[a+2],f=s[a+3];return t[i]=o*f+u*h+l*p-c*d,t[i+1]=l*f+u*d+c*h-o*p,t[i+2]=c*f+u*p+o*d-l*h,t[i+3]=u*f-o*h-l*d-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,i,r,n){return this._x=t,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,i=!0){const r=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),p=l(n/2),f=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"YXZ":this._x=d*u*h+c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"ZXY":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h-d*p*f;break;case"ZYX":this._x=d*u*h-c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h+d*p*f;break;case"YZX":this._x=d*u*h+c*p*f,this._y=c*p*h+d*u*f,this._z=c*u*f-d*p*h,this._w=c*u*h-d*p*f;break;case"XZY":this._x=d*u*h-c*p*f,this._y=c*p*h-d*u*f,this._z=c*u*f+d*p*h,this._w=c*u*h+d*p*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,i){const r=i/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const i=t.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-l)*p,this._y=(s-c)*p,this._z=(a-n)*p}else if(r>o&&r>h){const p=2*Math.sqrt(1+r-o-h);this._w=(u-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+c)/p}else if(o>h){const p=2*Math.sqrt(1+o-r-h);this._w=(s-c)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+h-r-o);this._w=(a-n)/p,this._x=(s+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,i){let r=t.dot(i)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*i.z-t.z*i.y,this._y=t.z*i.x-t.x*i.z,this._z=t.x*i.y-t.y*i.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Kr(this.dot(t),-1,1)))}rotateTowards(t,i){const r=this.angleTo(t);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,i){const r=t._x,n=t._y,s=t._z,a=t._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(t,i){if(i===0)return this;if(i===1)return this.copy(t);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+r*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-i;return this._w=p*a+i*this._w,this._x=p*r+i*this._x,this._y=p*n+i*this._y,this._z=p*s+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,i,r){return this.copy(t).slerp(i,r)}random(){const t=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(n*Math.sin(t),n*Math.cos(t),s*Math.sin(i),s*Math.cos(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,i=0){return this._x=t[i],this._y=t[i+1],this._z=t[i+2],this._w=t[i+3],this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._w,t}fromBufferAttribute(t,i){return this._x=t.getX(i),this._y=t.getY(i),this._z=t.getZ(i),this._w=t.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class he{constructor(t=0,i=0,r=0){he.prototype.isVector3=!0,this.x=t,this.y=i,this.z=r}set(t,i,r){return r===void 0&&(r=this.z),this.x=t,this.y=i,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}applyEuler(t){return this.applyQuaternion(s7.setFromEuler(t))}applyAxisAngle(t,i){return this.applyQuaternion(s7.setFromAxisAngle(t,i))}applyMatrix3(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const i=this.x,r=this.y,n=this.z,s=t.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(t){const i=this.x,r=this.y,n=this.z,s=t.x,a=t.y,o=t.z,l=t.w,c=2*(a*n-o*r),u=2*(o*i-s*n),h=2*(s*r-a*i);return this.x=i+l*c+a*h-o*u,this.y=r+l*u+o*c-s*h,this.z=n+l*h+s*u-a*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const i=this.x,r=this.y,n=this.z,s=t.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this.z=Math.max(t,Math.min(i,this.z)),this}clampLength(t,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this.z=t.z+(i.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,i){const r=t.x,n=t.y,s=t.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(t){const i=t.lengthSq();if(i===0)return this.set(0,0,0);const r=t.dot(this)/i;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return dL.copy(this).projectOnVector(t),this.sub(dL)}reflect(t){return this.sub(dL.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const i=Math.sqrt(this.lengthSq()*t.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(t)/i;return Math.acos(Kr(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const i=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return i*i+r*r+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,i,r){const n=Math.sin(i)*t;return this.x=n*Math.sin(r),this.y=Math.cos(i)*t,this.z=n*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,i,r){return this.x=t*Math.sin(i),this.y=r,this.z=t*Math.cos(i),this}setFromMatrixPosition(t){const i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(t){const i=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(t,i){return this.fromArray(t.elements,i*4)}setFromMatrix3Column(t,i){return this.fromArray(t.elements,i*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this.z=t.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(t),this.y=i,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const dL=new he,s7=new Zs;class ba{constructor(t=new he(1/0,1/0,1/0),i=new he(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromArray(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i+=3)this.expandByPoint(_l.fromArray(t,i));return this}setFromBufferAttribute(t){this.makeEmpty();for(let i=0,r=t.count;i<r;i++)this.expandByPoint(_l.fromBufferAttribute(t,i));return this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=_l.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,i=!1){return this.makeEmpty(),this.expandByObject(t,i)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,i=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0){const s=r.getAttribute("position");if(i===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,_l):_l.fromBufferAttribute(s,a),_l.applyMatrix4(t.matrixWorld),this.expandByPoint(_l);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),nM.copy(t.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),nM.copy(r.boundingBox)),nM.applyMatrix4(t.matrixWorld),this.union(nM)}const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,_l),_l.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let i,r;return t.normal.x>0?(i=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),i<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(e1),sM.subVectors(this.max,e1),vg.subVectors(t.a,e1),yg.subVectors(t.b,e1),xg.subVectors(t.c,e1),Hh.subVectors(yg,vg),Gh.subVectors(xg,yg),Ip.subVectors(vg,xg);let i=[0,-Hh.z,Hh.y,0,-Gh.z,Gh.y,0,-Ip.z,Ip.y,Hh.z,0,-Hh.x,Gh.z,0,-Gh.x,Ip.z,0,-Ip.x,-Hh.y,Hh.x,0,-Gh.y,Gh.x,0,-Ip.y,Ip.x,0];return!pL(i,vg,yg,xg,sM)||(i=[1,0,0,0,1,0,0,0,1],!pL(i,vg,yg,xg,sM))?!1:(aM.crossVectors(Hh,Gh),i=[aM.x,aM.y,aM.z],pL(i,vg,yg,xg,sM))}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_l).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(_l).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(mu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),mu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),mu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),mu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),mu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),mu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),mu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),mu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(mu),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const mu=[new he,new he,new he,new he,new he,new he,new he,new he],_l=new he,nM=new ba,vg=new he,yg=new he,xg=new he,Hh=new he,Gh=new he,Ip=new he,e1=new he,sM=new he,aM=new he,Op=new he;function pL(e,t,i,r,n){for(let s=0,a=e.length-3;s<=a;s+=3){Op.fromArray(e,s);const o=n.x*Math.abs(Op.x)+n.y*Math.abs(Op.y)+n.z*Math.abs(Op.z),l=t.dot(Op),c=i.dot(Op),u=r.dot(Op);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const XVe=new ba,t1=new he,fL=new he;let Qs=class{constructor(t=new he,i=-1){this.isSphere=!0,this.center=t,this.radius=i}set(t,i){return this.center.copy(t),this.radius=i,this}setFromPoints(t,i){const r=this.center;i!==void 0?r.copy(i):XVe.setFromPoints(t).getCenter(r);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,i){const r=this.center.distanceToSquared(t);return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;t1.subVectors(t,this.center);const i=t1.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(t1,n/r),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(fL.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(t1.copy(t.center).add(fL)),this.expandByPoint(t1.copy(t.center).sub(fL))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}};const gu=new he,mL=new he,oM=new he,Wh=new he,gL=new he,lM=new he,vL=new he;class xm{constructor(t=new he,i=new he(0,0,-1)){this.origin=t,this.direction=i}set(t,i){return this.origin.copy(t),this.direction.copy(i),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,i){return i.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,gu)),this}closestPointToPoint(t,i){i.subVectors(t,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const i=gu.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(gu.copy(this.origin).addScaledVector(this.direction,i),gu.distanceToSquared(t))}distanceSqToSegment(t,i,r,n){mL.copy(t).add(i).multiplyScalar(.5),oM.copy(i).sub(t).normalize(),Wh.copy(this.origin).sub(mL);const s=t.distanceTo(i)*.5,a=-this.direction.dot(oM),o=Wh.dot(this.direction),l=-Wh.dot(oM),c=Wh.lengthSq(),u=Math.abs(1-a*a);let h,d,p,f;if(u>0)if(h=a*l-o,d=a*o-l,f=s*u,h>=0)if(d>=-f)if(d<=f){const v=1/u;h*=v,d*=v,p=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;else d<=-f?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c):d<=f?(h=0,d=Math.min(Math.max(-s,-l),s),p=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),p=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),p=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(mL).addScaledVector(oM,d),p}intersectSphere(t,i){gu.subVectors(t.center,this.origin);const r=gu.dot(this.direction),n=gu.dot(gu)-r*r,s=t.radius*t.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const i=t.normal.dot(this.direction);if(i===0)return t.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(t.normal)+t.constant)/i;return r>=0?r:null}intersectPlane(t,i){const r=this.distanceToPlane(t);return r===null?null:this.at(r,i)}intersectsPlane(t){const i=t.distanceToPoint(this.origin);return i===0||t.normal.dot(this.direction)*i<0}intersectBox(t,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(t.min.x-d.x)*c,n=(t.max.x-d.x)*c):(r=(t.max.x-d.x)*c,n=(t.min.x-d.x)*c),u>=0?(s=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(s=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(t.min.z-d.z)*h,l=(t.max.z-d.z)*h):(o=(t.max.z-d.z)*h,l=(t.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(t){return this.intersectBox(t,gu)!==null}intersectTriangle(t,i,r,n,s){gL.subVectors(i,t),lM.subVectors(r,t),vL.crossVectors(gL,lM);let a=this.direction.dot(vL),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Wh.subVectors(this.origin,t);const l=o*this.direction.dot(lM.crossVectors(Wh,lM));if(l<0)return null;const c=o*this.direction.dot(gL.cross(Wh));if(c<0||l+c>a)return null;const u=-o*Wh.dot(vL);return u<0?null:this.at(u/a,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ui{constructor(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m){ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m)}set(t,i,r,n,s,a,o,l,c,u,h,d,p,f,v,m){const g=this.elements;return g[0]=t,g[4]=i,g[8]=r,g[12]=n,g[1]=s,g[5]=a,g[9]=o,g[13]=l,g[2]=c,g[6]=u,g[10]=h,g[14]=d,g[3]=p,g[7]=f,g[11]=v,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ui().fromArray(this.elements)}copy(t){const i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){const i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){const i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){const i=this.elements,r=t.elements,n=1/bg.setFromMatrixColumn(t,0).length(),s=1/bg.setFromMatrixColumn(t,1).length(),a=1/bg.setFromMatrixColumn(t,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){const i=this.elements,r=t.x,n=t.y,s=t.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){const d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+f*c,i[5]=d-v*c,i[9]=-o*l,i[2]=v-d*c,i[6]=f+p*c,i[10]=a*l}else if(t.order==="YXZ"){const d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d+v*o,i[4]=f*o-p,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=p*o-f,i[6]=v+d*o,i[10]=a*l}else if(t.order==="ZXY"){const d=l*u,p=l*h,f=c*u,v=c*h;i[0]=d-v*o,i[4]=-a*h,i[8]=f+p*o,i[1]=p+f*o,i[5]=a*u,i[9]=v-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(t.order==="ZYX"){const d=a*u,p=a*h,f=o*u,v=o*h;i[0]=l*u,i[4]=f*c-p,i[8]=d*c+v,i[1]=l*h,i[5]=v*c+d,i[9]=p*c-f,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(t.order==="YZX"){const d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=v-d*h,i[8]=f*h+p,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+f,i[10]=d-v*h}else if(t.order==="XZY"){const d=a*l,p=a*c,f=o*l,v=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+v,i[5]=a*u,i[9]=p*h-f,i[2]=f*h-p,i[6]=o*u,i[10]=v*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(qVe,t,YVe)}lookAt(t,i,r){const n=this.elements;return io.subVectors(t,i),io.lengthSq()===0&&(io.z=1),io.normalize(),Xh.crossVectors(r,io),Xh.lengthSq()===0&&(Math.abs(r.z)===1?io.x+=1e-4:io.z+=1e-4,io.normalize(),Xh.crossVectors(r,io)),Xh.normalize(),cM.crossVectors(io,Xh),n[0]=Xh.x,n[4]=cM.x,n[8]=io.x,n[1]=Xh.y,n[5]=cM.y,n[9]=io.y,n[2]=Xh.z,n[6]=cM.z,n[10]=io.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){const r=t.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],f=r[2],v=r[6],m=r[10],g=r[14],y=r[3],x=r[7],_=r[11],M=r[15],S=n[0],E=n[4],A=n[8],P=n[12],C=n[1],D=n[5],N=n[9],U=n[13],I=n[2],G=n[6],Q=n[10],Y=n[14],O=n[3],V=n[7],F=n[11],W=n[15];return s[0]=a*S+o*C+l*I+c*O,s[4]=a*E+o*D+l*G+c*V,s[8]=a*A+o*N+l*Q+c*F,s[12]=a*P+o*U+l*Y+c*W,s[1]=u*S+h*C+d*I+p*O,s[5]=u*E+h*D+d*G+p*V,s[9]=u*A+h*N+d*Q+p*F,s[13]=u*P+h*U+d*Y+p*W,s[2]=f*S+v*C+m*I+g*O,s[6]=f*E+v*D+m*G+g*V,s[10]=f*A+v*N+m*Q+g*F,s[14]=f*P+v*U+m*Y+g*W,s[3]=y*S+x*C+_*I+M*O,s[7]=y*E+x*D+_*G+M*V,s[11]=y*A+x*N+_*Q+M*F,s[15]=y*P+x*U+_*Y+M*W,this}multiplyScalar(t){const i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){const t=this.elements,i=t[0],r=t[4],n=t[8],s=t[12],a=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],f=t[3],v=t[7],m=t[11],g=t[15];return f*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*p-r*l*p)+v*(+i*l*p-i*c*d+s*a*d-n*a*p+n*c*u-s*l*u)+m*(+i*c*h-i*o*p-s*a*h+r*a*p+s*o*u-r*c*u)+g*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const t=this.elements;let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=i,n[14]=r),this}invert(){const t=this.elements,i=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],v=t[13],m=t[14],g=t[15],y=h*m*c-v*d*c+v*l*p-o*m*p-h*l*g+o*d*g,x=f*d*c-u*m*c-f*l*p+a*m*p+u*l*g-a*d*g,_=u*v*c-f*h*c+f*o*p-a*v*p-u*o*g+a*h*g,M=f*h*l-u*v*l-f*o*d+a*v*d+u*o*m-a*h*m,S=i*y+r*x+n*_+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/S;return t[0]=y*E,t[1]=(v*d*s-h*m*s-v*n*p+r*m*p+h*n*g-r*d*g)*E,t[2]=(o*m*s-v*l*s+v*n*c-r*m*c-o*n*g+r*l*g)*E,t[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*p-r*l*p)*E,t[4]=x*E,t[5]=(u*m*s-f*d*s+f*n*p-i*m*p-u*n*g+i*d*g)*E,t[6]=(f*l*s-a*m*s-f*n*c+i*m*c+a*n*g-i*l*g)*E,t[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*p+i*l*p)*E,t[8]=_*E,t[9]=(f*h*s-u*v*s-f*r*p+i*v*p+u*r*g-i*h*g)*E,t[10]=(a*v*s-f*o*s+f*r*c-i*v*c-a*r*g+i*o*g)*E,t[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*p-i*o*p)*E,t[12]=M*E,t[13]=(u*v*n-f*h*n+f*r*d-i*v*d-u*r*m+i*h*m)*E,t[14]=(f*o*n-a*v*n-f*r*l+i*v*l+a*r*m-i*o*m)*E,t[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*E,this}scale(t){const i=this.elements,r=t.x,n=t.y,s=t.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(t,i,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){const i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){const i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=t.x,o=t.y,l=t.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,n,s,a){return this.set(1,r,s,0,t,1,a,0,i,n,1,0,0,0,0,1),this}compose(t,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,p=s*u,f=s*h,v=a*u,m=a*h,g=o*h,y=l*c,x=l*u,_=l*h,M=r.x,S=r.y,E=r.z;return n[0]=(1-(v+g))*M,n[1]=(p+_)*M,n[2]=(f-x)*M,n[3]=0,n[4]=(p-_)*S,n[5]=(1-(d+g))*S,n[6]=(m+y)*S,n[7]=0,n[8]=(f+x)*E,n[9]=(m-y)*E,n[10]=(1-(d+v))*E,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,i,r){const n=this.elements;let s=bg.set(n[0],n[1],n[2]).length();const a=bg.set(n[4],n[5],n[6]).length(),o=bg.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],Sl.copy(this);const c=1/s,u=1/a,h=1/o;return Sl.elements[0]*=c,Sl.elements[1]*=c,Sl.elements[2]*=c,Sl.elements[4]*=u,Sl.elements[5]*=u,Sl.elements[6]*=u,Sl.elements[8]*=h,Sl.elements[9]*=h,Sl.elements[10]*=h,i.setFromRotationMatrix(Sl),r.x=s,r.y=a,r.z=o,this}makePerspective(t,i,r,n,s,a,o=Lc){const l=this.elements,c=2*s/(i-t),u=2*s/(r-n),h=(i+t)/(i-t),d=(r+n)/(r-n);let p,f;if(o===Lc)p=-(a+s)/(a-s),f=-2*a*s/(a-s);else if(o===wb)p=-a/(a-s),f=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,i,r,n,s,a,o=Lc){const l=this.elements,c=1/(i-t),u=1/(r-n),h=1/(a-s),d=(i+t)*c,p=(r+n)*u;let f,v;if(o===Lc)f=(a+s)*h,v=-2*h;else if(o===wb)f=s*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=v,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const i=this.elements,r=t.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){const r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}}const bg=new he,Sl=new ui,qVe=new he(0,0,0),YVe=new he(1,1,1),Xh=new he,cM=new he,io=new he,a7=new ui,o7=new Zs;class yo{constructor(t=0,i=0,r=0,n=yo.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,n=this._order){return this._x=t,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],p=n[10];switch(i){case"XYZ":this._y=Math.asin(Kr(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Kr(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Kr(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Kr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Kr(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Kr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return a7.makeRotationFromQuaternion(t),this.setFromRotationMatrix(a7,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return o7.setFromEuler(this),this.setFromQuaternion(o7,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}yo.DEFAULT_ORDER="XYZ";class jf{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let ZVe=0;const l7=new he,wg=new Zs,vu=new ui,uM=new he,i1=new he,QVe=new he,KVe=new Zs,c7=new he(1,0,0),u7=new he(0,1,0),h7=new he(0,0,1),JVe={type:"added"},$Ve={type:"removed"},yL={type:"childadded",child:null},xL={type:"childremoved",child:null};class Zi extends yh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ZVe++}),this.uuid=fo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zi.DEFAULT_UP.clone();const t=new he,i=new yo,r=new Zs,n=new he(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ui},normalMatrix:{value:new xi}}),this.matrix=new ui,this.matrixWorld=new ui,this.matrixAutoUpdate=Zi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new jf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return wg.setFromAxisAngle(t,i),this.quaternion.multiply(wg),this}rotateOnWorldAxis(t,i){return wg.setFromAxisAngle(t,i),this.quaternion.premultiply(wg),this}rotateX(t){return this.rotateOnAxis(c7,t)}rotateY(t){return this.rotateOnAxis(u7,t)}rotateZ(t){return this.rotateOnAxis(h7,t)}translateOnAxis(t,i){return l7.copy(t).applyQuaternion(this.quaternion),this.position.add(l7.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(c7,t)}translateY(t){return this.translateOnAxis(u7,t)}translateZ(t){return this.translateOnAxis(h7,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(vu.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?uM.copy(t):uM.set(t,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),i1.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?vu.lookAt(i1,uM,this.up):vu.lookAt(uM,i1,this.up),this.quaternion.setFromRotationMatrix(vu),n&&(vu.extractRotation(n.matrixWorld),wg.setFromRotationMatrix(vu),this.quaternion.premultiply(wg.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(JVe),yL.child=t,this.dispatchEvent(yL),yL.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent($Ve),xL.child=t,this.dispatchEvent(xL),xL.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),vu.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),vu.multiply(t.parent.matrixWorld)),t.applyMatrix4(vu),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(t,i);if(a!==void 0)return a}}getObjectsByProperty(t,i,r=[]){this[t]===i&&r.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(t,i,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(i1,t,QVe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(i1,KVe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;i!==null&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++){const s=i[r];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(t===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=t===void 0||typeof t=="string",r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(t.shapes,h)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(t.materials,this.material[l]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(t.animations,l))}}if(i){const o=a(t.geometries),l=a(t.materials),c=a(t.textures),u=a(t.images),h=a(t.shapes),d=a(t.skeletons),p=a(t.animations),f=a(t.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),i===!0)for(let r=0;r<t.children.length;r++){const n=t.children[r];this.add(n.clone())}return this}}Zi.DEFAULT_UP=new he(0,1,0);Zi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ml=new he,yu=new he,bL=new he,xu=new he,_g=new he,Sg=new he,d7=new he,wL=new he,_L=new he,SL=new he;class lo{constructor(t=new he,i=new he,r=new he){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,n){n.subVectors(r,i),Ml.subVectors(t,i),n.cross(Ml);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,i,r,n,s){Ml.subVectors(n,i),yu.subVectors(r,i),bL.subVectors(t,i);const a=Ml.dot(Ml),o=Ml.dot(yu),l=Ml.dot(bL),c=yu.dot(yu),u=yu.dot(bL),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,p=(c*l-o*u)*d,f=(a*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(t,i,r,n){return this.getBarycoord(t,i,r,n,xu)===null?!1:xu.x>=0&&xu.y>=0&&xu.x+xu.y<=1}static getInterpolation(t,i,r,n,s,a,o,l){return this.getBarycoord(t,i,r,n,xu)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,xu.x),l.addScaledVector(a,xu.y),l.addScaledVector(o,xu.z),l)}static isFrontFacing(t,i,r,n){return Ml.subVectors(r,i),yu.subVectors(t,i),Ml.cross(yu).dot(n)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,n){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,i,r,n){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ml.subVectors(this.c,this.b),yu.subVectors(this.a,this.b),Ml.cross(yu).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return lo.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return lo.getBarycoord(t,this.a,this.b,this.c,i)}getInterpolation(t,i,r,n,s){return lo.getInterpolation(t,this.a,this.b,this.c,i,r,n,s)}containsPoint(t){return lo.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return lo.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){const r=this.a,n=this.b,s=this.c;let a,o;_g.subVectors(n,r),Sg.subVectors(s,r),wL.subVectors(t,r);const l=_g.dot(wL),c=Sg.dot(wL);if(l<=0&&c<=0)return i.copy(r);_L.subVectors(t,n);const u=_g.dot(_L),h=Sg.dot(_L);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(_g,a);SL.subVectors(t,s);const p=_g.dot(SL),f=Sg.dot(SL);if(f>=0&&p<=f)return i.copy(s);const v=p*c-l*f;if(v<=0&&c>=0&&f<=0)return o=c/(c-f),i.copy(r).addScaledVector(Sg,o);const m=u*f-p*h;if(m<=0&&h-u>=0&&p-f>=0)return d7.subVectors(s,n),o=(h-u)/(h-u+(p-f)),i.copy(n).addScaledVector(d7,o);const g=1/(m+v+d);return a=v*g,o=d*g,i.copy(r).addScaledVector(_g,a).addScaledVector(Sg,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const zne={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qh={h:0,s:0,l:0},hM={h:0,s:0,l:0};function ML(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}class Rt{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,i,r)}set(t,i,r){if(i===void 0&&r===void 0){const n=t;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(t,i,r);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Ho){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ir.toWorkingColorSpace(this,i),this}setRGB(t,i,r,n=ir.workingColorSpace){return this.r=t,this.g=i,this.b=r,ir.toWorkingColorSpace(this,n),this}setHSL(t,i,r,n=ir.workingColorSpace){if(t=WU(t,1),i=Kr(i,0,1),r=Kr(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=ML(a,s,t+1/3),this.g=ML(a,s,t),this.b=ML(a,s,t-1/3)}return ir.toWorkingColorSpace(this,n),this}setStyle(t,i=Ho){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,i);return this}setColorName(t,i=Ho){const r=zne[t.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Hv(t.r),this.g=Hv(t.g),this.b=Hv(t.b),this}copyLinearToSRGB(t){return this.r=uL(t.r),this.g=uL(t.g),this.b=uL(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ho){return ir.fromWorkingColorSpace(Us.copy(this),t),Math.round(Kr(Us.r*255,0,255))*65536+Math.round(Kr(Us.g*255,0,255))*256+Math.round(Kr(Us.b*255,0,255))}getHexString(t=Ho){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=ir.workingColorSpace){ir.fromWorkingColorSpace(Us.copy(this),i);const r=Us.r,n=Us.g,s=Us.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return t.h=l,t.s=c,t.l=u,t}getRGB(t,i=ir.workingColorSpace){return ir.fromWorkingColorSpace(Us.copy(this),i),t.r=Us.r,t.g=Us.g,t.b=Us.b,t}getStyle(t=Ho){ir.fromWorkingColorSpace(Us.copy(this),t);const i=Us.r,r=Us.g,n=Us.b;return t!==Ho?`color(${t} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(t,i,r){return this.getHSL(qh),this.setHSL(qh.h+t,qh.s+i,qh.l+r)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(qh),t.getHSL(hM);const r=dx(qh.h,hM.h,i),n=dx(qh.s,hM.s,i),s=dx(qh.l,hM.l,i);return this.setHSL(r,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const i=this.r,r=this.g,n=this.b,s=t.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Us=new Rt;Rt.NAMES=zne;let eje=0;class ea extends yh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:eje++}),this.uuid=fo(),this.name="",this.type="Material",this.blending=Ff,this.side=hh,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=AC,this.blendDst=CC,this.blendEquation=pd,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Rt(0,0,0),this.blendAlpha=0,this.depthFunc=cb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=nz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rf,this.stencilZFail=rf,this.stencilZPass=rf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const i in t){const r=t[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(t){const i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Ff&&(r.blending=this.blending),this.side!==hh&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==AC&&(r.blendSrc=this.blendSrc),this.blendDst!==CC&&(r.blendDst=this.blendDst),this.blendEquation!==pd&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==cb&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==nz&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==rf&&(r.stencilFail=this.stencilFail),this.stencilZFail!==rf&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==rf&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(t.textures),a=n(t.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const i=t.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class hp extends ea{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=lw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Bu=tje();function tje(){const e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function Ra(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Kr(e,-65504,65504),Bu.floatView[0]=e;const t=Bu.uint32View[0],i=t>>23&511;return Bu.baseTable[i]+((t&8388607)>>Bu.shiftTable[i])}function O1(e){const t=e>>10;return Bu.uint32View[0]=Bu.mantissaTable[Bu.offsetTable[t]+(e&1023)]+Bu.exponentTable[t],Bu.floatView[0]}const ije={toHalfFloat:Ra,fromHalfFloat:O1},bn=new he,dM=new nt;class pr{constructor(t,i,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=i,this.count=t!==void 0?t.length/i:0,this.normalized=r,this.usage=bb,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=oo,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return One("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,i,r){t*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=i.array[r+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)dM.fromBufferAttribute(this,i),dM.applyMatrix3(t),this.setXY(i,dM.x,dM.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)bn.fromBufferAttribute(this,i),bn.applyMatrix3(t),this.setXYZ(i,bn.x,bn.y,bn.z);return this}applyMatrix4(t){for(let i=0,r=this.count;i<r;i++)bn.fromBufferAttribute(this,i),bn.applyMatrix4(t),this.setXYZ(i,bn.x,bn.y,bn.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)bn.fromBufferAttribute(this,i),bn.applyNormalMatrix(t),this.setXYZ(i,bn.x,bn.y,bn.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)bn.fromBufferAttribute(this,i),bn.transformDirection(t),this.setXYZ(i,bn.x,bn.y,bn.z);return this}set(t,i=0){return this.array.set(t,i),this}getComponent(t,i){let r=this.array[t*this.itemSize+i];return this.normalized&&(r=ma(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=bi(r,this.array)),this.array[t*this.itemSize+i]=r,this}getX(t){let i=this.array[t*this.itemSize];return this.normalized&&(i=ma(i,this.array)),i}setX(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize]=i,this}getY(t){let i=this.array[t*this.itemSize+1];return this.normalized&&(i=ma(i,this.array)),i}setY(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+1]=i,this}getZ(t){let i=this.array[t*this.itemSize+2];return this.normalized&&(i=ma(i,this.array)),i}setZ(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+2]=i,this}getW(t){let i=this.array[t*this.itemSize+3];return this.normalized&&(i=ma(i,this.array)),i}setW(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+3]=i,this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array)),this.array[t+0]=i,this.array[t+1]=r,this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array),s=bi(s,this.array)),this.array[t+0]=i,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==bb&&(t.usage=this.usage),t}}class rje extends pr{constructor(t,i,r){super(new Int8Array(t),i,r)}}class nje extends pr{constructor(t,i,r){super(new Uint8Array(t),i,r)}}class sje extends pr{constructor(t,i,r){super(new Uint8ClampedArray(t),i,r)}}class aje extends pr{constructor(t,i,r){super(new Int16Array(t),i,r)}}class YU extends pr{constructor(t,i,r){super(new Uint16Array(t),i,r)}}class oje extends pr{constructor(t,i,r){super(new Int32Array(t),i,r)}}class ZU extends pr{constructor(t,i,r){super(new Uint32Array(t),i,r)}}class lje extends pr{constructor(t,i,r){super(new Uint16Array(t),i,r),this.isFloat16BufferAttribute=!0}getX(t){let i=O1(this.array[t*this.itemSize]);return this.normalized&&(i=ma(i,this.array)),i}setX(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize]=Ra(i),this}getY(t){let i=O1(this.array[t*this.itemSize+1]);return this.normalized&&(i=ma(i,this.array)),i}setY(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+1]=Ra(i),this}getZ(t){let i=O1(this.array[t*this.itemSize+2]);return this.normalized&&(i=ma(i,this.array)),i}setZ(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+2]=Ra(i),this}getW(t){let i=O1(this.array[t*this.itemSize+3]);return this.normalized&&(i=ma(i,this.array)),i}setW(t,i){return this.normalized&&(i=bi(i,this.array)),this.array[t*this.itemSize+3]=Ra(i),this}setXY(t,i,r){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array)),this.array[t+0]=Ra(i),this.array[t+1]=Ra(r),this}setXYZ(t,i,r,n){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array)),this.array[t+0]=Ra(i),this.array[t+1]=Ra(r),this.array[t+2]=Ra(n),this}setXYZW(t,i,r,n,s){return t*=this.itemSize,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array),s=bi(s,this.array)),this.array[t+0]=Ra(i),this.array[t+1]=Ra(r),this.array[t+2]=Ra(n),this.array[t+3]=Ra(s),this}}class Ut extends pr{constructor(t,i,r){super(new Float32Array(t),i,r)}}let cje=0;const zo=new ui,EL=new Zi,Mg=new he,ro=new ba,r1=new ba,$n=new he;class Ei extends yh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:cje++}),this.uuid=fo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Rne(t)?ZU:YU)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,i){return this.attributes[t]=i,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,i,r=0){this.groups.push({start:t,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,i){this.drawRange.start=t,this.drawRange.count=i}applyMatrix4(t){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(t),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new xi().getNormalMatrix(t);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return zo.makeRotationFromQuaternion(t),this.applyMatrix4(zo),this}rotateX(t){return zo.makeRotationX(t),this.applyMatrix4(zo),this}rotateY(t){return zo.makeRotationY(t),this.applyMatrix4(zo),this}rotateZ(t){return zo.makeRotationZ(t),this.applyMatrix4(zo),this}translate(t,i,r){return zo.makeTranslation(t,i,r),this.applyMatrix4(zo),this}scale(t,i,r){return zo.makeScale(t,i,r),this.applyMatrix4(zo),this}lookAt(t){return EL.lookAt(t),EL.updateMatrix(),this.applyMatrix4(EL.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mg).negate(),this.translate(Mg.x,Mg.y,Mg.z),this}setFromPoints(t){const i=[];for(let r=0,n=t.length;r<n;r++){const s=t[r];i.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Ut(i,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ba);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new he(-1/0,-1/0,-1/0),new he(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];ro.setFromBufferAttribute(s),this.morphTargetsRelative?($n.addVectors(this.boundingBox.min,ro.min),this.boundingBox.expandByPoint($n),$n.addVectors(this.boundingBox.max,ro.max),this.boundingBox.expandByPoint($n)):(this.boundingBox.expandByPoint(ro.min),this.boundingBox.expandByPoint(ro.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qs);const t=this.attributes.position,i=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new he,1/0);return}if(t){const r=this.boundingSphere.center;if(ro.setFromBufferAttribute(t),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];r1.setFromBufferAttribute(o),this.morphTargetsRelative?($n.addVectors(ro.min,r1.min),ro.expandByPoint($n),$n.addVectors(ro.max,r1.max),ro.expandByPoint($n)):(ro.expandByPoint(r1.min),ro.expandByPoint(r1.max))}ro.getCenter(r);let n=0;for(let s=0,a=t.count;s<a;s++)$n.fromBufferAttribute(t,s),n=Math.max(n,r.distanceToSquared($n));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)$n.fromBufferAttribute(o,c),l&&(Mg.fromBufferAttribute(t,c),$n.add(Mg)),n=Math.max(n,r.distanceToSquared($n))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,i=this.attributes;if(t===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,n=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new pr(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let A=0;A<r.count;A++)o[A]=new he,l[A]=new he;const c=new he,u=new he,h=new he,d=new nt,p=new nt,f=new nt,v=new he,m=new he;function g(A,P,C){c.fromBufferAttribute(r,A),u.fromBufferAttribute(r,P),h.fromBufferAttribute(r,C),d.fromBufferAttribute(s,A),p.fromBufferAttribute(s,P),f.fromBufferAttribute(s,C),u.sub(c),h.sub(c),p.sub(d),f.sub(d);const D=1/(p.x*f.y-f.x*p.y);isFinite(D)&&(v.copy(u).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(D),m.copy(h).multiplyScalar(p.x).addScaledVector(u,-f.x).multiplyScalar(D),o[A].add(v),o[P].add(v),o[C].add(v),l[A].add(m),l[P].add(m),l[C].add(m))}let y=this.groups;y.length===0&&(y=[{start:0,count:t.count}]);for(let A=0,P=y.length;A<P;++A){const C=y[A],D=C.start,N=C.count;for(let U=D,I=D+N;U<I;U+=3)g(t.getX(U+0),t.getX(U+1),t.getX(U+2))}const x=new he,_=new he,M=new he,S=new he;function E(A){M.fromBufferAttribute(n,A),S.copy(M);const P=o[A];x.copy(P),x.sub(M.multiplyScalar(M.dot(P))).normalize(),_.crossVectors(S,P);const D=_.dot(l[A])<0?-1:1;a.setXYZW(A,x.x,x.y,x.z,D)}for(let A=0,P=y.length;A<P;++A){const C=y[A],D=C.start,N=C.count;for(let U=D,I=D+N;U<I;U+=3)E(t.getX(U+0)),E(t.getX(U+1)),E(t.getX(U+2))}}computeVertexNormals(){const t=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new pr(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const n=new he,s=new he,a=new he,o=new he,l=new he,c=new he,u=new he,h=new he;if(t)for(let d=0,p=t.count;d<p;d+=3){const f=t.getX(d+0),v=t.getX(d+1),m=t.getX(d+2);n.fromBufferAttribute(i,f),s.fromBufferAttribute(i,v),a.fromBufferAttribute(i,m),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,v),c.fromBufferAttribute(r,m),o.add(u),l.add(u),c.add(u),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(v,l.x,l.y,l.z),r.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=i.count;d<p;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let i=0,r=t.count;i<r;i++)$n.fromBufferAttribute(t,i),$n.normalize(),t.setXYZ(i,$n.x,$n.y,$n.z)}toNonIndexed(){function t(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let p=0,f=0;for(let v=0,m=l.length;v<m;v++){o.isInterleavedBufferAttribute?p=l[v]*o.data.stride+o.offset:p=l[v]*u;for(let g=0;g<u;g++)d[f++]=c[p++]}return new pr(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new Ei,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=t(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],p=t(d,r);l.push(p)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const i=this.index;i!==null&&(t.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];t.data.attributes[l]=c.toJSON(t.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h];u.push(p.toJSON(t.data))}u.length>0&&(n[l]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone(i));const n=t.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=t.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const p7=new ui,Np=new xm,pM=new Qs,f7=new he,Eg=new he,Ag=new he,Cg=new he,AL=new he,fM=new he,mM=new nt,gM=new nt,vM=new nt,m7=new he,g7=new he,v7=new he,yM=new he,xM=new he;class An extends Zi{constructor(t=new Ei,i=new hp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(t,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){fM.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(AL.fromBufferAttribute(h,t),a?fM.addScaledVector(AL,u):fM.addScaledVector(AL.sub(i),u))}i.add(fM)}return i}raycast(t,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),pM.copy(r.boundingSphere),pM.applyMatrix4(s),Np.copy(t.ray).recast(t.near),!(pM.containsPoint(Np.origin)===!1&&(Np.intersectSphere(pM,f7)===null||Np.origin.distanceToSquared(f7)>(t.far-t.near)**2))&&(p7.copy(s).invert(),Np.copy(t.ray).applyMatrix4(p7),!(r.boundingBox!==null&&Np.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(t,i,Np)))}_computeIntersections(t,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,p=s.drawRange;if(o!==null)if(Array.isArray(a))for(let f=0,v=d.length;f<v;f++){const m=d[f],g=a[m.materialIndex],y=Math.max(m.start,p.start),x=Math.min(o.count,Math.min(m.start+m.count,p.start+p.count));for(let _=y,M=x;_<M;_+=3){const S=o.getX(_),E=o.getX(_+1),A=o.getX(_+2);n=bM(this,g,t,r,c,u,h,S,E,A),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const f=Math.max(0,p.start),v=Math.min(o.count,p.start+p.count);for(let m=f,g=v;m<g;m+=3){const y=o.getX(m),x=o.getX(m+1),_=o.getX(m+2);n=bM(this,a,t,r,c,u,h,y,x,_),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let f=0,v=d.length;f<v;f++){const m=d[f],g=a[m.materialIndex],y=Math.max(m.start,p.start),x=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));for(let _=y,M=x;_<M;_+=3){const S=_,E=_+1,A=_+2;n=bM(this,g,t,r,c,u,h,S,E,A),n&&(n.faceIndex=Math.floor(_/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const f=Math.max(0,p.start),v=Math.min(l.count,p.start+p.count);for(let m=f,g=v;m<g;m+=3){const y=m,x=m+1,_=m+2;n=bM(this,a,t,r,c,u,h,y,x,_),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}}}function uje(e,t,i,r,n,s,a,o){let l;if(t.side===xa?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,t.side===hh,o),l===null)return null;xM.copy(o),xM.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(xM);return c<i.near||c>i.far?null:{distance:c,point:xM.clone(),object:e}}function bM(e,t,i,r,n,s,a,o,l,c){e.getVertexPosition(o,Eg),e.getVertexPosition(l,Ag),e.getVertexPosition(c,Cg);const u=uje(e,t,i,r,Eg,Ag,Cg,yM);if(u){n&&(mM.fromBufferAttribute(n,o),gM.fromBufferAttribute(n,l),vM.fromBufferAttribute(n,c),u.uv=lo.getInterpolation(yM,Eg,Ag,Cg,mM,gM,vM,new nt)),s&&(mM.fromBufferAttribute(s,o),gM.fromBufferAttribute(s,l),vM.fromBufferAttribute(s,c),u.uv1=lo.getInterpolation(yM,Eg,Ag,Cg,mM,gM,vM,new nt)),a&&(m7.fromBufferAttribute(a,o),g7.fromBufferAttribute(a,l),v7.fromBufferAttribute(a,c),u.normal=lo.getInterpolation(yM,Eg,Ag,Cg,m7,g7,v7,new he),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const h={a:o,b:l,c,normal:new he,materialIndex:0};lo.getNormal(Eg,Ag,Cg,h.normal),u.face=h}return u}class bm extends Ei{constructor(t=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,p=0;f("z","y","x",-1,-1,r,i,t,a,s,0),f("z","y","x",1,-1,r,i,-t,a,s,1),f("x","z","y",1,1,t,r,i,n,a,2),f("x","z","y",1,-1,t,r,-i,n,a,3),f("x","y","z",1,-1,t,i,r,n,s,4),f("x","y","z",-1,-1,t,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new Ut(c,3)),this.setAttribute("normal",new Ut(u,3)),this.setAttribute("uv",new Ut(h,2));function f(v,m,g,y,x,_,M,S,E,A,P){const C=_/E,D=M/A,N=_/2,U=M/2,I=S/2,G=E+1,Q=A+1;let Y=0,O=0;const V=new he;for(let F=0;F<Q;F++){const W=F*D-U;for(let ee=0;ee<G;ee++){const ae=ee*C-N;V[v]=ae*y,V[m]=W*x,V[g]=I,c.push(V.x,V.y,V.z),V[v]=0,V[m]=0,V[g]=S>0?1:-1,u.push(V.x,V.y,V.z),h.push(ee/E),h.push(1-F/A),Y+=1}}for(let F=0;F<A;F++)for(let W=0;W<E;W++){const ee=d+W+G*F,ae=d+W+G*(F+1),K=d+(W+1)+G*(F+1),$=d+(W+1)+G*F;l.push(ee,ae,$),l.push(ae,K,$),O+=6}o.addGroup(p,O,P),p+=O,d+=Y}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new bm(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function y0(e){const t={};for(const i in e){t[i]={};for(const r in e[i]){const n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[i][r]=null):t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}}return t}function ca(e){const t={};for(let i=0;i<e.length;i++){const r=y0(e[i]);for(const n in r)t[n]=r[n]}return t}function hje(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function Bne(e){return e.getRenderTarget()===null?e.outputColorSpace:ir.workingColorSpace}const kne={clone:y0,merge:ca};var dje=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,pje=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class sl extends ea{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=dje,this.fragmentShader=pje,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=y0(t.uniforms),this.uniformsGroups=hje(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const i=super.toJSON(t);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class uw extends Zi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ui,this.projectionMatrix=new ui,this.projectionMatrixInverse=new ui,this.coordinateSystem=Lc}copy(t,i){return super.copy(t,i),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Yh=new he,y7=new nt,x7=new nt;class hn extends uw{constructor(t=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const i=.5*this.getFilmHeight()/t;this.fov=v0*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Vf*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return v0*2*Math.atan(Math.tan(Vf*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,i,r){Yh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Yh.x,Yh.y).multiplyScalar(-t/Yh.z),Yh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Yh.x,Yh.y).multiplyScalar(-t/Yh.z)}getViewSize(t,i){return this.getViewBounds(t,y7,x7),i.subVectors(x7,y7)}setViewOffset(t,i,r,n,s,a){this.aspect=t/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let i=t*Math.tan(Vf*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const Tg=-90,Pg=1;class Une extends Zi{constructor(t,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new hn(Tg,Pg,t,i);n.layers=this.layers,this.add(n);const s=new hn(Tg,Pg,t,i);s.layers=this.layers,this.add(s);const a=new hn(Tg,Pg,t,i);a.layers=this.layers,this.add(a);const o=new hn(Tg,Pg,t,i);o.layers=this.layers,this.add(o);const l=new hn(Tg,Pg,t,i);l.layers=this.layers,this.add(l);const c=new hn(Tg,Pg,t,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(t===Lc)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===wb)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of i)this.add(c),c.updateMatrixWorld()}update(t,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=t.getRenderTarget(),d=t.getActiveCubeFace(),p=t.getActiveMipmapLevel(),f=t.xr.enabled;t.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0,n),t.render(i,s),t.setRenderTarget(r,1,n),t.render(i,a),t.setRenderTarget(r,2,n),t.render(i,o),t.setRenderTarget(r,3,n),t.render(i,l),t.setRenderTarget(r,4,n),t.render(i,c),r.texture.generateMipmaps=v,t.setRenderTarget(r,5,n),t.render(i,u),t.setRenderTarget(h,d,p),t.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class hw extends en{constructor(t,i,r,n,s,a,o,l,c,u){t=t!==void 0?t:[],i=i!==void 0?i:dh,super(t,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Fne extends Wl{constructor(t=1,i={}){super(t,t,i),this.isWebGLCubeRenderTarget=!0;const r={width:t,height:t,depth:1},n=[r,r,r,r,r,r];this.texture=new hw(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Nr}fromEquirectangularTexture(t,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new bm(5,5,5),s=new sl({name:"CubemapFromEquirect",uniforms:y0(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:xa,blending:$u});s.uniforms.tEquirect.value=i;const a=new An(n,s),o=i.minFilter;return i.minFilter===Dc&&(i.minFilter=Nr),new Une(1,10,this).update(t,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,i,r,n){const s=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(i,r,n);t.setRenderTarget(s)}}const CL=new he,fje=new he,mje=new xi;class Iu{constructor(t=new he(1,0,0),i=0){this.isPlane=!0,this.normal=t,this.constant=i}set(t,i){return this.normal.copy(t),this.constant=i,this}setComponents(t,i,r,n){return this.normal.set(t,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(t,i,r){const n=CL.subVectors(r,i).cross(fje.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,i){return i.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,i){const r=t.delta(CL),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(t.start)===0?i.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(t.start).addScaledVector(r,s)}intersectsLine(t){const i=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return i<0&&r>0||r<0&&i>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,i){const r=i||mje.getNormalMatrix(t),n=this.coplanarPoint(CL).applyMatrix4(t),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const zp=new Qs,wM=new he;class dw{constructor(t=new Iu,i=new Iu,r=new Iu,n=new Iu,s=new Iu,a=new Iu){this.planes=[t,i,r,n,s,a]}set(t,i,r,n,s,a){const o=this.planes;return o[0].copy(t),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(t){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(t.planes[r]);return this}setFromProjectionMatrix(t,i=Lc){const r=this.planes,n=t.elements,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],d=n[7],p=n[8],f=n[9],v=n[10],m=n[11],g=n[12],y=n[13],x=n[14],_=n[15];if(r[0].setComponents(l-s,d-c,m-p,_-g).normalize(),r[1].setComponents(l+s,d+c,m+p,_+g).normalize(),r[2].setComponents(l+a,d+u,m+f,_+y).normalize(),r[3].setComponents(l-a,d-u,m-f,_-y).normalize(),r[4].setComponents(l-o,d-h,m-v,_-x).normalize(),i===Lc)r[5].setComponents(l+o,d+h,m+v,_+x).normalize();else if(i===wb)r[5].setComponents(o,h,v,x).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),zp.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const i=t.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),zp.copy(i.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(zp)}intersectsSprite(t){return zp.center.set(0,0,0),zp.radius=.7071067811865476,zp.applyMatrix4(t.matrixWorld),this.intersectsSphere(zp)}intersectsSphere(t){const i=this.planes,r=t.center,n=-t.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(t){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(wM.x=n.normal.x>0?t.max.x:t.min.x,wM.y=n.normal.y>0?t.max.y:t.min.y,wM.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(wM)<0)return!1}return!0}containsPoint(t){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Vne(){let e=null,t=!1,i=null,r=null;function n(s,a){i(s,a),r=e.requestAnimationFrame(n)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function gje(e,t){const i=t.isWebGL2,r=new WeakMap;function n(c,u){const h=c.array,d=c.usage,p=h.byteLength,f=e.createBuffer();e.bindBuffer(u,f),e.bufferData(u,h,d),c.onUploadCallback();let v;if(h instanceof Float32Array)v=e.FLOAT;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)v=e.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=e.UNSIGNED_SHORT;else if(h instanceof Int16Array)v=e.SHORT;else if(h instanceof Uint32Array)v=e.UNSIGNED_INT;else if(h instanceof Int32Array)v=e.INT;else if(h instanceof Int8Array)v=e.BYTE;else if(h instanceof Uint8Array)v=e.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)v=e.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:v,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version,size:p}}function s(c,u,h){const d=u.array,p=u._updateRange,f=u.updateRanges;if(e.bindBuffer(h,c),p.count===-1&&f.length===0&&e.bufferSubData(h,0,d),f.length!==0){for(let v=0,m=f.length;v<m;v++){const g=f[v];i?e.bufferSubData(h,g.start*d.BYTES_PER_ELEMENT,d,g.start,g.count):e.bufferSubData(h,g.start*d.BYTES_PER_ELEMENT,d.subarray(g.start,g.start+g.count))}u.clearUpdateRanges()}p.count!==-1&&(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){const d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const h=r.get(c);if(h===void 0)r.set(c,n(c,u));else if(h.version<c.version){if(h.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");s(h.buffer,c,u),h.version=c.version}}return{get:a,remove:o,update:l}}class W0 extends Ei{constructor(t=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:i,widthSegments:r,heightSegments:n};const s=t/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=t/o,d=i/l,p=[],f=[],v=[],m=[];for(let g=0;g<u;g++){const y=g*d-a;for(let x=0;x<c;x++){const _=x*h-s;f.push(_,-y,0),v.push(0,0,1),m.push(x/o),m.push(1-g/l)}}for(let g=0;g<l;g++)for(let y=0;y<o;y++){const x=y+c*g,_=y+c*(g+1),M=y+1+c*(g+1),S=y+1+c*g;p.push(x,_,S),p.push(_,M,S)}this.setIndex(p),this.setAttribute("position",new Ut(f,3)),this.setAttribute("normal",new Ut(v,3)),this.setAttribute("uv",new Ut(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new W0(t.width,t.height,t.widthSegments,t.heightSegments)}}var vje=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,yje=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,xje=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,bje=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wje=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,_je=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Sje=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Mje=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Eje=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Aje=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,Cje=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Tje=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Pje=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,Dje=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Lje=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Rje=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Ije=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Oje=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Nje=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,zje=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Bje=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,kje=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Uje=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Fje=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Vje=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,jje=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Hje=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Gje=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Wje=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Xje=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,qje="gl_FragColor = linearToOutputTexel( gl_FragColor );",Yje=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Zje=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Qje=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Kje=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Jje=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,$je=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,e6e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,t6e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,i6e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,r6e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,n6e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,s6e=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,a6e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,o6e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,l6e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,c6e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,u6e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,h6e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,d6e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,p6e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,f6e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,m6e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,g6e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,v6e=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,y6e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,x6e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,b6e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,w6e=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,_6e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,S6e=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,M6e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,E6e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,A6e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,C6e=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,T6e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,P6e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,D6e=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,L6e=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,R6e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,I6e=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,O6e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,N6e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,z6e=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,B6e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,k6e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,U6e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,F6e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,V6e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,j6e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,H6e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,G6e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,W6e=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,X6e=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,q6e=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Y6e=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Z6e=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Q6e=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,K6e=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,J6e=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,$6e=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,eHe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,tHe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,iHe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,rHe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,nHe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,sHe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,aHe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,oHe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,lHe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,cHe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,uHe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,hHe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,dHe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,pHe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fHe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,mHe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,gHe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vHe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,yHe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xHe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,bHe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wHe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,_He=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,SHe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,MHe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,EHe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,AHe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,CHe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,THe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PHe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,DHe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,LHe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,RHe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IHe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,OHe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NHe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zHe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BHe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,kHe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,UHe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FHe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VHe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,jHe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HHe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,GHe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WHe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,XHe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,qHe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YHe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ZHe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,QHe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,wi={alphahash_fragment:vje,alphahash_pars_fragment:yje,alphamap_fragment:xje,alphamap_pars_fragment:bje,alphatest_fragment:wje,alphatest_pars_fragment:_je,aomap_fragment:Sje,aomap_pars_fragment:Mje,batching_pars_vertex:Eje,batching_vertex:Aje,begin_vertex:Cje,beginnormal_vertex:Tje,bsdfs:Pje,iridescence_fragment:Dje,bumpmap_pars_fragment:Lje,clipping_planes_fragment:Rje,clipping_planes_pars_fragment:Ije,clipping_planes_pars_vertex:Oje,clipping_planes_vertex:Nje,color_fragment:zje,color_pars_fragment:Bje,color_pars_vertex:kje,color_vertex:Uje,common:Fje,cube_uv_reflection_fragment:Vje,defaultnormal_vertex:jje,displacementmap_pars_vertex:Hje,displacementmap_vertex:Gje,emissivemap_fragment:Wje,emissivemap_pars_fragment:Xje,colorspace_fragment:qje,colorspace_pars_fragment:Yje,envmap_fragment:Zje,envmap_common_pars_fragment:Qje,envmap_pars_fragment:Kje,envmap_pars_vertex:Jje,envmap_physical_pars_fragment:u6e,envmap_vertex:$je,fog_vertex:e6e,fog_pars_vertex:t6e,fog_fragment:i6e,fog_pars_fragment:r6e,gradientmap_pars_fragment:n6e,lightmap_fragment:s6e,lightmap_pars_fragment:a6e,lights_lambert_fragment:o6e,lights_lambert_pars_fragment:l6e,lights_pars_begin:c6e,lights_toon_fragment:h6e,lights_toon_pars_fragment:d6e,lights_phong_fragment:p6e,lights_phong_pars_fragment:f6e,lights_physical_fragment:m6e,lights_physical_pars_fragment:g6e,lights_fragment_begin:v6e,lights_fragment_maps:y6e,lights_fragment_end:x6e,logdepthbuf_fragment:b6e,logdepthbuf_pars_fragment:w6e,logdepthbuf_pars_vertex:_6e,logdepthbuf_vertex:S6e,map_fragment:M6e,map_pars_fragment:E6e,map_particle_fragment:A6e,map_particle_pars_fragment:C6e,metalnessmap_fragment:T6e,metalnessmap_pars_fragment:P6e,morphinstance_vertex:D6e,morphcolor_vertex:L6e,morphnormal_vertex:R6e,morphtarget_pars_vertex:I6e,morphtarget_vertex:O6e,normal_fragment_begin:N6e,normal_fragment_maps:z6e,normal_pars_fragment:B6e,normal_pars_vertex:k6e,normal_vertex:U6e,normalmap_pars_fragment:F6e,clearcoat_normal_fragment_begin:V6e,clearcoat_normal_fragment_maps:j6e,clearcoat_pars_fragment:H6e,iridescence_pars_fragment:G6e,opaque_fragment:W6e,packing:X6e,premultiplied_alpha_fragment:q6e,project_vertex:Y6e,dithering_fragment:Z6e,dithering_pars_fragment:Q6e,roughnessmap_fragment:K6e,roughnessmap_pars_fragment:J6e,shadowmap_pars_fragment:$6e,shadowmap_pars_vertex:eHe,shadowmap_vertex:tHe,shadowmask_pars_fragment:iHe,skinbase_vertex:rHe,skinning_pars_vertex:nHe,skinning_vertex:sHe,skinnormal_vertex:aHe,specularmap_fragment:oHe,specularmap_pars_fragment:lHe,tonemapping_fragment:cHe,tonemapping_pars_fragment:uHe,transmission_fragment:hHe,transmission_pars_fragment:dHe,uv_pars_fragment:pHe,uv_pars_vertex:fHe,uv_vertex:mHe,worldpos_vertex:gHe,background_vert:vHe,background_frag:yHe,backgroundCube_vert:xHe,backgroundCube_frag:bHe,cube_vert:wHe,cube_frag:_He,depth_vert:SHe,depth_frag:MHe,distanceRGBA_vert:EHe,distanceRGBA_frag:AHe,equirect_vert:CHe,equirect_frag:THe,linedashed_vert:PHe,linedashed_frag:DHe,meshbasic_vert:LHe,meshbasic_frag:RHe,meshlambert_vert:IHe,meshlambert_frag:OHe,meshmatcap_vert:NHe,meshmatcap_frag:zHe,meshnormal_vert:BHe,meshnormal_frag:kHe,meshphong_vert:UHe,meshphong_frag:FHe,meshphysical_vert:VHe,meshphysical_frag:jHe,meshtoon_vert:HHe,meshtoon_frag:GHe,points_vert:WHe,points_frag:XHe,shadow_vert:qHe,shadow_frag:YHe,sprite_vert:ZHe,sprite_frag:QHe},St={common:{diffuse:{value:new Rt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new xi},alphaMap:{value:null},alphaMapTransform:{value:new xi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new xi}},envmap:{envMap:{value:null},envMapRotation:{value:new xi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new xi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new xi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new xi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new xi},normalScale:{value:new nt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new xi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new xi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new xi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new xi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Rt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Rt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new xi},alphaTest:{value:0},uvTransform:{value:new xi}},sprite:{diffuse:{value:new Rt(16777215)},opacity:{value:1},center:{value:new nt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new xi},alphaMap:{value:null},alphaMapTransform:{value:new xi},alphaTest:{value:0}}},Dl={basic:{uniforms:ca([St.common,St.specularmap,St.envmap,St.aomap,St.lightmap,St.fog]),vertexShader:wi.meshbasic_vert,fragmentShader:wi.meshbasic_frag},lambert:{uniforms:ca([St.common,St.specularmap,St.envmap,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.fog,St.lights,{emissive:{value:new Rt(0)}}]),vertexShader:wi.meshlambert_vert,fragmentShader:wi.meshlambert_frag},phong:{uniforms:ca([St.common,St.specularmap,St.envmap,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.fog,St.lights,{emissive:{value:new Rt(0)},specular:{value:new Rt(1118481)},shininess:{value:30}}]),vertexShader:wi.meshphong_vert,fragmentShader:wi.meshphong_frag},standard:{uniforms:ca([St.common,St.envmap,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.roughnessmap,St.metalnessmap,St.fog,St.lights,{emissive:{value:new Rt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:wi.meshphysical_vert,fragmentShader:wi.meshphysical_frag},toon:{uniforms:ca([St.common,St.aomap,St.lightmap,St.emissivemap,St.bumpmap,St.normalmap,St.displacementmap,St.gradientmap,St.fog,St.lights,{emissive:{value:new Rt(0)}}]),vertexShader:wi.meshtoon_vert,fragmentShader:wi.meshtoon_frag},matcap:{uniforms:ca([St.common,St.bumpmap,St.normalmap,St.displacementmap,St.fog,{matcap:{value:null}}]),vertexShader:wi.meshmatcap_vert,fragmentShader:wi.meshmatcap_frag},points:{uniforms:ca([St.points,St.fog]),vertexShader:wi.points_vert,fragmentShader:wi.points_frag},dashed:{uniforms:ca([St.common,St.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:wi.linedashed_vert,fragmentShader:wi.linedashed_frag},depth:{uniforms:ca([St.common,St.displacementmap]),vertexShader:wi.depth_vert,fragmentShader:wi.depth_frag},normal:{uniforms:ca([St.common,St.bumpmap,St.normalmap,St.displacementmap,{opacity:{value:1}}]),vertexShader:wi.meshnormal_vert,fragmentShader:wi.meshnormal_frag},sprite:{uniforms:ca([St.sprite,St.fog]),vertexShader:wi.sprite_vert,fragmentShader:wi.sprite_frag},background:{uniforms:{uvTransform:{value:new xi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:wi.background_vert,fragmentShader:wi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new xi}},vertexShader:wi.backgroundCube_vert,fragmentShader:wi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:wi.cube_vert,fragmentShader:wi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:wi.equirect_vert,fragmentShader:wi.equirect_frag},distanceRGBA:{uniforms:ca([St.common,St.displacementmap,{referencePosition:{value:new he},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:wi.distanceRGBA_vert,fragmentShader:wi.distanceRGBA_frag},shadow:{uniforms:ca([St.lights,St.fog,{color:{value:new Rt(0)},opacity:{value:1}}]),vertexShader:wi.shadow_vert,fragmentShader:wi.shadow_frag}};Dl.physical={uniforms:ca([Dl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new xi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new xi},clearcoatNormalScale:{value:new nt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new xi},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new xi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new xi},sheen:{value:0},sheenColor:{value:new Rt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new xi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new xi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new xi},transmissionSamplerSize:{value:new nt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new xi},attenuationDistance:{value:0},attenuationColor:{value:new Rt(0)},specularColor:{value:new Rt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new xi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new xi},anisotropyVector:{value:new nt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new xi}}]),vertexShader:wi.meshphysical_vert,fragmentShader:wi.meshphysical_frag};const _M={r:0,b:0,g:0},Bp=new yo,KHe=new ui;function JHe(e,t,i,r,n,s,a){const o=new Rt(0);let l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(m,g){let y=!1,x=g.isScene===!0?g.background:null;x&&x.isTexture&&(x=(g.backgroundBlurriness>0?i:t).get(x)),x===null?v(o,l):x&&x.isColor&&(v(x,1),y=!0);const _=e.xr.getEnvironmentBlendMode();_==="additive"?r.buffers.color.setClear(0,0,0,1,a):_==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),x&&(x.isCubeTexture||x.mapping===G0)?(u===void 0&&(u=new An(new bm(1,1,1),new sl({name:"BackgroundCubeMaterial",uniforms:y0(Dl.backgroundCube.uniforms),vertexShader:Dl.backgroundCube.vertexShader,fragmentShader:Dl.backgroundCube.fragmentShader,side:xa,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,S,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),Bp.copy(g.backgroundRotation),Bp.x*=-1,Bp.y*=-1,Bp.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Bp.y*=-1,Bp.z*=-1),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=g.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(KHe.makeRotationFromEuler(Bp)),u.material.toneMapped=ir.getTransfer(x.colorSpace)!==xr,(h!==x||d!==x.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=x,d=x.version,p=e.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new An(new W0(2,2),new sl({name:"BackgroundMaterial",uniforms:y0(Dl.background.uniforms),vertexShader:Dl.background.vertexShader,fragmentShader:Dl.background.fragmentShader,side:hh,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=g.backgroundIntensity,c.material.toneMapped=ir.getTransfer(x.colorSpace)!==xr,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||d!==x.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=x,d=x.version,p=e.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function v(m,g){m.getRGB(_M,Bne(e)),r.buffers.color.setClear(_M.r,_M.g,_M.b,g,a)}return{getClearColor:function(){return o},setClearColor:function(m,g=1){o.set(m),l=g,v(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,v(o,l)},render:f}}function $He(e,t,i,r){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=m(null);let c=l,u=!1;function h(I,G,Q,Y,O){let V=!1;if(a){const F=v(Y,Q,G);c!==F&&(c=F,p(c.object)),V=g(I,Y,Q,O),V&&y(I,Y,Q,O)}else{const F=G.wireframe===!0;(c.geometry!==Y.id||c.program!==Q.id||c.wireframe!==F)&&(c.geometry=Y.id,c.program=Q.id,c.wireframe=F,V=!0)}O!==null&&i.update(O,e.ELEMENT_ARRAY_BUFFER),(V||u)&&(u=!1,A(I,G,Q,Y),O!==null&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.get(O).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(I){return r.isWebGL2?e.bindVertexArray(I):s.bindVertexArrayOES(I)}function f(I){return r.isWebGL2?e.deleteVertexArray(I):s.deleteVertexArrayOES(I)}function v(I,G,Q){const Y=Q.wireframe===!0;let O=o[I.id];O===void 0&&(O={},o[I.id]=O);let V=O[G.id];V===void 0&&(V={},O[G.id]=V);let F=V[Y];return F===void 0&&(F=m(d()),V[Y]=F),F}function m(I){const G=[],Q=[],Y=[];for(let O=0;O<n;O++)G[O]=0,Q[O]=0,Y[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:G,enabledAttributes:Q,attributeDivisors:Y,object:I,attributes:{},index:null}}function g(I,G,Q,Y){const O=c.attributes,V=G.attributes;let F=0;const W=Q.getAttributes();for(const ee in W)if(W[ee].location>=0){const K=O[ee];let $=V[ee];if($===void 0&&(ee==="instanceMatrix"&&I.instanceMatrix&&($=I.instanceMatrix),ee==="instanceColor"&&I.instanceColor&&($=I.instanceColor)),K===void 0||K.attribute!==$||$&&K.data!==$.data)return!0;F++}return c.attributesNum!==F||c.index!==Y}function y(I,G,Q,Y){const O={},V=G.attributes;let F=0;const W=Q.getAttributes();for(const ee in W)if(W[ee].location>=0){let K=V[ee];K===void 0&&(ee==="instanceMatrix"&&I.instanceMatrix&&(K=I.instanceMatrix),ee==="instanceColor"&&I.instanceColor&&(K=I.instanceColor));const $={};$.attribute=K,K&&K.data&&($.data=K.data),O[ee]=$,F++}c.attributes=O,c.attributesNum=F,c.index=Y}function x(){const I=c.newAttributes;for(let G=0,Q=I.length;G<Q;G++)I[G]=0}function _(I){M(I,0)}function M(I,G){const Q=c.newAttributes,Y=c.enabledAttributes,O=c.attributeDivisors;Q[I]=1,Y[I]===0&&(e.enableVertexAttribArray(I),Y[I]=1),O[I]!==G&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,G),O[I]=G)}function S(){const I=c.newAttributes,G=c.enabledAttributes;for(let Q=0,Y=G.length;Q<Y;Q++)G[Q]!==I[Q]&&(e.disableVertexAttribArray(Q),G[Q]=0)}function E(I,G,Q,Y,O,V,F){F===!0?e.vertexAttribIPointer(I,G,Q,O,V):e.vertexAttribPointer(I,G,Q,Y,O,V)}function A(I,G,Q,Y){if(r.isWebGL2===!1&&(I.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();const O=Y.attributes,V=Q.getAttributes(),F=G.defaultAttributeValues;for(const W in V){const ee=V[W];if(ee.location>=0){let ae=O[W];if(ae===void 0&&(W==="instanceMatrix"&&I.instanceMatrix&&(ae=I.instanceMatrix),W==="instanceColor"&&I.instanceColor&&(ae=I.instanceColor)),ae!==void 0){const K=ae.normalized,$=ae.itemSize,ie=i.get(ae);if(ie===void 0)continue;const ye=ie.buffer,pe=ie.type,me=ie.bytesPerElement,ge=r.isWebGL2===!0&&(pe===e.INT||pe===e.UNSIGNED_INT||ae.gpuType===NU);if(ae.isInterleavedBufferAttribute){const xe=ae.data,te=xe.stride,we=ae.offset;if(xe.isInstancedInterleavedBuffer){for(let Ce=0;Ce<ee.locationSize;Ce++)M(ee.location+Ce,xe.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let Ce=0;Ce<ee.locationSize;Ce++)_(ee.location+Ce);e.bindBuffer(e.ARRAY_BUFFER,ye);for(let Ce=0;Ce<ee.locationSize;Ce++)E(ee.location+Ce,$/ee.locationSize,pe,K,te*me,(we+$/ee.locationSize*Ce)*me,ge)}else{if(ae.isInstancedBufferAttribute){for(let xe=0;xe<ee.locationSize;xe++)M(ee.location+xe,ae.meshPerAttribute);I.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=ae.meshPerAttribute*ae.count)}else for(let xe=0;xe<ee.locationSize;xe++)_(ee.location+xe);e.bindBuffer(e.ARRAY_BUFFER,ye);for(let xe=0;xe<ee.locationSize;xe++)E(ee.location+xe,$/ee.locationSize,pe,K,$*me,$/ee.locationSize*xe*me,ge)}}else if(F!==void 0){const K=F[W];if(K!==void 0)switch(K.length){case 2:e.vertexAttrib2fv(ee.location,K);break;case 3:e.vertexAttrib3fv(ee.location,K);break;case 4:e.vertexAttrib4fv(ee.location,K);break;default:e.vertexAttrib1fv(ee.location,K)}}}}S()}function P(){N();for(const I in o){const G=o[I];for(const Q in G){const Y=G[Q];for(const O in Y)f(Y[O].object),delete Y[O];delete G[Q]}delete o[I]}}function C(I){if(o[I.id]===void 0)return;const G=o[I.id];for(const Q in G){const Y=G[Q];for(const O in Y)f(Y[O].object),delete Y[O];delete G[Q]}delete o[I.id]}function D(I){for(const G in o){const Q=o[G];if(Q[I.id]===void 0)continue;const Y=Q[I.id];for(const O in Y)f(Y[O].object),delete Y[O];delete Q[I.id]}}function N(){U(),u=!0,c!==l&&(c=l,p(c.object))}function U(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:N,resetDefaultState:U,dispose:P,releaseStatesOfGeometry:C,releaseStatesOfProgram:D,initAttributes:x,enableAttribute:_,disableUnusedAttributes:S}}function eGe(e,t,i,r){const n=r.isWebGL2;let s;function a(u){s=u}function o(u,h){e.drawArrays(s,u,h),i.update(h,s,1)}function l(u,h,d){if(d===0)return;let p,f;if(n)p=e,f="drawArraysInstanced";else if(p=t.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[f](s,u,h,d),i.update(h,s,d)}function c(u,h,d){if(d===0)return;const p=t.get("WEBGL_multi_draw");if(p===null)for(let f=0;f<d;f++)this.render(u[f],h[f]);else{p.multiDrawArraysWEBGL(s,u,0,h,0,d);let f=0;for(let v=0;v<d;v++)f+=h[v];i.update(f,s,1)}}this.setMode=a,this.render=o,this.renderInstances=l,this.renderMultiDraw=c}function tGe(e,t,i){let r;function n(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){const E=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(E.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(E){if(E==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";E="mediump"}return E==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&e.constructor.name==="WebGL2RenderingContext";let o=i.precision!==void 0?i.precision:"highp";const l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);const c=a||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=e.getParameter(e.MAX_TEXTURE_SIZE),f=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),v=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),y=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),x=d>0,_=a||t.has("OES_texture_float"),M=x&&_,S=a?e.getParameter(e.MAX_SAMPLES):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:v,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:M,maxSamples:S}}function iGe(e){const t=this;let i=null,r=0,n=!1,s=!1;const a=new Iu,o=new xi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const p=h.length!==0||d||r!==0||n;return n=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){const f=h.clippingPlanes,v=h.clipIntersection,m=h.clipShadows,g=e.get(h);if(!n||f===null||f.length===0||s&&!m)s?u(null):c();else{const y=s?0:r,x=y*4;let _=g.clippingState||null;l.value=_,_=u(f,d,x,p);for(let M=0;M!==x;++M)_[M]=i[M];g.clippingState=_,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){const v=h!==null?h.length:0;let m=null;if(v!==0){if(m=l.value,f!==!0||m===null){const g=p+v*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(m===null||m.length<g)&&(m=new Float32Array(g));for(let x=0,_=p;x!==v;++x,_+=4)a.copy(h[x]).applyMatrix4(y,o),a.normal.toArray(m,_),m[_+3]=a.constant}l.value=m,l.needsUpdate=!0}return t.numPlanes=v,t.numIntersection=0,m}}function rGe(e){let t=new WeakMap;function i(a,o){return o===ub?a.mapping=dh:o===hb&&(a.mapping=$d),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===ub||o===hb)if(t.has(a)){const l=t.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new Fne(l.height);return c.fromEquirectangularTexture(e,a),t.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}class Hd extends uw{constructor(t=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(t,i){return super.copy(t,i),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-t,a=r+t,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const i=super.toJSON(t);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}const xv=4,b7=[.125,.215,.35,.446,.526,.582],df=20,TL=new Hd,w7=new Rt;let PL=null,DL=0,LL=0;const nf=(1+Math.sqrt(5))/2,Dg=1/nf,_7=[new he(1,1,1),new he(-1,1,1),new he(1,1,-1),new he(-1,1,-1),new he(0,nf,Dg),new he(0,nf,-Dg),new he(Dg,0,nf),new he(-Dg,0,nf),new he(nf,Dg,0),new he(-nf,Dg,0)];class oz{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,i=0,r=.1,n=100){PL=this._renderer.getRenderTarget(),DL=this._renderer.getActiveCubeFace(),LL=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,r,n,s),i>0&&this._blur(s,0,0,i),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,i=null){return this._fromTexture(t,i)}fromCubemap(t,i=null){return this._fromTexture(t,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=E7(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=M7(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(PL,DL,LL),t.scissorTest=!1,SM(t,0,0,t.width,t.height)}_fromTexture(t,i){t.mapping===dh||t.mapping===$d?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),PL=this._renderer.getRenderTarget(),DL=this._renderer.getActiveCubeFace(),LL=this._renderer.getActiveMipmapLevel();const r=i||this._allocateTargets();return this._textureToCubeUV(t,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:Nr,minFilter:Nr,generateMipmaps:!1,type:g0,format:fa,colorSpace:vh,depthBuffer:!1},n=S7(t,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=S7(t,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=nGe(s)),this._blurMaterial=sGe(s,t,i)}return n}_compileMaterial(t){const i=new An(this._lodPlanes[0],t);this._renderer.compile(i,TL)}_sceneToCubeUV(t,i,r,n){const o=new hn(90,1,i,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(w7),u.toneMapping=Fc,u.autoClear=!1;const p=new hp({name:"PMREM.Background",side:xa,depthWrite:!1,depthTest:!1}),f=new An(new bm,p);let v=!1;const m=t.background;m?m.isColor&&(p.color.copy(m),t.background=null,v=!0):(p.color.copy(w7),v=!0);for(let g=0;g<6;g++){const y=g%3;y===0?(o.up.set(0,l[g],0),o.lookAt(c[g],0,0)):y===1?(o.up.set(0,0,l[g]),o.lookAt(0,c[g],0)):(o.up.set(0,l[g],0),o.lookAt(0,0,c[g]));const x=this._cubeSize;SM(n,y*x,g>2?x:0,x,x),u.setRenderTarget(n),v&&u.render(f,o),u.render(t,o)}f.geometry.dispose(),f.material.dispose(),u.toneMapping=d,u.autoClear=h,t.background=m}_textureToCubeUV(t,i){const r=this._renderer,n=t.mapping===dh||t.mapping===$d;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=E7()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=M7());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new An(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=t;const l=this._cubeSize;SM(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,TL)}_applyPMREM(t){const i=this._renderer,r=i.autoClear;i.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){const s=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=_7[(n-1)%_7.length];this._blur(t,n-1,n,s,a)}i.autoClear=r}_blur(t,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(t,a,i,r,n,"latitudinal",s),this._halfBlur(a,t,r,r,n,"longitudinal",s)}_halfBlur(t,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new An(this._lodPlanes[n],c),d=c.uniforms,p=this._sizeLods[r]-1,f=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*df-1),v=s/f,m=isFinite(s)?1+Math.floor(u*v):df;m>df&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${df}`);const g=[];let y=0;for(let E=0;E<df;++E){const A=E/v,P=Math.exp(-A*A/2);g.push(P),E===0?y+=P:E<m&&(y+=2*P)}for(let E=0;E<g.length;E++)g[E]=g[E]/y;d.envMap.value=t.texture,d.samples.value=m,d.weights.value=g,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:x}=this;d.dTheta.value=f,d.mipInt.value=x-r;const _=this._sizeLods[n],M=3*_*(n>x-xv?n-x+xv:0),S=4*(this._cubeSize-_);SM(i,M,S,3*_,2*_),l.setRenderTarget(i),l.render(h,TL)}}function nGe(e){const t=[],i=[],r=[];let n=e;const s=e-xv+1+b7.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>e-xv?l=b7[a-e+xv-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,v=3,m=2,g=1,y=new Float32Array(v*f*p),x=new Float32Array(m*f*p),_=new Float32Array(g*f*p);for(let S=0;S<p;S++){const E=S%3*2/3-1,A=S>2?0:-1,P=[E,A,0,E+2/3,A,0,E+2/3,A+1,0,E,A,0,E+2/3,A+1,0,E,A+1,0];y.set(P,v*f*S),x.set(d,m*f*S);const C=[S,S,S,S,S,S];_.set(C,g*f*S)}const M=new Ei;M.setAttribute("position",new pr(y,v)),M.setAttribute("uv",new pr(x,m)),M.setAttribute("faceIndex",new pr(_,g)),t.push(M),n>xv&&n--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function S7(e,t,i){const r=new Wl(e,t,i);return r.texture.mapping=G0,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function SM(e,t,i,r,n){e.viewport.set(t,i,r,n),e.scissor.set(t,i,r,n)}function sGe(e,t,i){const r=new Float32Array(df),n=new he(0,1,0);return new sl({name:"SphericalGaussianBlur",defines:{n:df,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:QU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:$u,depthTest:!1,depthWrite:!1})}function M7(){return new sl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:QU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:$u,depthTest:!1,depthWrite:!1})}function E7(){return new sl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:QU(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:$u,depthTest:!1,depthWrite:!1})}function QU(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function aGe(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===ub||l===hb,u=l===dh||l===$d;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new oz(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{const h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new oz(e));const d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function a(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function oGe(e){const t={};function i(r){if(t[r]!==void 0)return t[r];let n;switch(r){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(r)}return t[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){const n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function lGe(e,t,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&t.remove(d.index);for(const f in d.attributes)t.remove(d.attributes[f]);for(const f in d.morphAttributes){const v=d.morphAttributes[f];for(let m=0,g=v.length;m<g;m++)t.remove(v[m])}d.removeEventListener("dispose",a),delete n[d.id];const p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)t.update(d[f],e.ARRAY_BUFFER);const p=h.morphAttributes;for(const f in p){const v=p[f];for(let m=0,g=v.length;m<g;m++)t.update(v[m],e.ARRAY_BUFFER)}}function c(h){const d=[],p=h.index,f=h.attributes.position;let v=0;if(p!==null){const y=p.array;v=p.version;for(let x=0,_=y.length;x<_;x+=3){const M=y[x+0],S=y[x+1],E=y[x+2];d.push(M,S,S,E,E,M)}}else if(f!==void 0){const y=f.array;v=f.version;for(let x=0,_=y.length/3-1;x<_;x+=3){const M=x+0,S=x+1,E=x+2;d.push(M,S,S,E,E,M)}}else return;const m=new(Rne(d)?ZU:YU)(d,1);m.version=v;const g=s.get(h);g&&t.remove(g),s.set(h,m)}function u(h){const d=s.get(h);if(d){const p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function cGe(e,t,i,r){const n=r.isWebGL2;let s;function a(p){s=p}let o,l;function c(p){o=p.type,l=p.bytesPerElement}function u(p,f){e.drawElements(s,f,o,p*l),i.update(f,s,1)}function h(p,f,v){if(v===0)return;let m,g;if(n)m=e,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](s,f,o,p*l,v),i.update(f,s,v)}function d(p,f,v){if(v===0)return;const m=t.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<v;g++)this.render(p[g]/l,f[g]);else{m.multiDrawElementsWEBGL(s,f,0,o,p,0,v);let g=0;for(let y=0;y<v;y++)g+=f[y];i.update(g,s,1)}}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h,this.renderMultiDraw=d}function uGe(e){const t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case e.TRIANGLES:i.triangles+=o*(s/3);break;case e.LINES:i.lines+=o*(s/2);break;case e.LINE_STRIP:i.lines+=o*(s-1);break;case e.LINE_LOOP:i.lines+=o*s;break;case e.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:n,update:r}}function hGe(e,t){return e[0]-t[0]}function dGe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function pGe(e,t,i){const r={},n=new Float32Array(8),s=new WeakMap,a=new nr,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h){const d=c.morphTargetInfluences;if(t.isWebGL2===!0){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=p!==void 0?p.length:0;let v=s.get(u);if(v===void 0||v.count!==f){let N=function(){C.dispose(),s.delete(u),u.removeEventListener("dispose",N)};v!==void 0&&v.texture.dispose();const m=u.morphAttributes.position!==void 0,g=u.morphAttributes.normal!==void 0,y=u.morphAttributes.color!==void 0,x=u.morphAttributes.position||[],_=u.morphAttributes.normal||[],M=u.morphAttributes.color||[];let S=0;m===!0&&(S=1),g===!0&&(S=2),y===!0&&(S=3);let E=u.attributes.position.count*S,A=1;E>t.maxTextureSize&&(A=Math.ceil(E/t.maxTextureSize),E=t.maxTextureSize);const P=new Float32Array(E*A*4*f),C=new WT(P,E,A,f);C.type=oo,C.needsUpdate=!0;const D=S*4;for(let U=0;U<f;U++){const I=x[U],G=_[U],Q=M[U],Y=E*A*4*U;for(let O=0;O<I.count;O++){const V=O*D;m===!0&&(a.fromBufferAttribute(I,O),P[Y+V+0]=a.x,P[Y+V+1]=a.y,P[Y+V+2]=a.z,P[Y+V+3]=0),g===!0&&(a.fromBufferAttribute(G,O),P[Y+V+4]=a.x,P[Y+V+5]=a.y,P[Y+V+6]=a.z,P[Y+V+7]=0),y===!0&&(a.fromBufferAttribute(Q,O),P[Y+V+8]=a.x,P[Y+V+9]=a.y,P[Y+V+10]=a.z,P[Y+V+11]=Q.itemSize===4?a.w:1)}}v={count:f,texture:C,size:new nt(E,A)},s.set(u,v),u.addEventListener("dispose",N)}if(c.isInstancedMesh===!0&&c.morphTexture!==null)h.getUniforms().setValue(e,"morphTexture",c.morphTexture,i);else{let m=0;for(let y=0;y<d.length;y++)m+=d[y];const g=u.morphTargetsRelative?1:1-m;h.getUniforms().setValue(e,"morphTargetBaseInfluence",g),h.getUniforms().setValue(e,"morphTargetInfluences",d)}h.getUniforms().setValue(e,"morphTargetsTexture",v.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{const p=d===void 0?0:d.length;let f=r[u.id];if(f===void 0||f.length!==p){f=[];for(let x=0;x<p;x++)f[x]=[x,0];r[u.id]=f}for(let x=0;x<p;x++){const _=f[x];_[0]=x,_[1]=d[x]}f.sort(dGe);for(let x=0;x<8;x++)x<p&&f[x][1]?(o[x][0]=f[x][0],o[x][1]=f[x][1]):(o[x][0]=Number.MAX_SAFE_INTEGER,o[x][1]=0);o.sort(hGe);const v=u.morphAttributes.position,m=u.morphAttributes.normal;let g=0;for(let x=0;x<8;x++){const _=o[x],M=_[0],S=_[1];M!==Number.MAX_SAFE_INTEGER&&S?(v&&u.getAttribute("morphTarget"+x)!==v[M]&&u.setAttribute("morphTarget"+x,v[M]),m&&u.getAttribute("morphNormal"+x)!==m[M]&&u.setAttribute("morphNormal"+x,m[M]),n[x]=S,g+=S):(v&&u.hasAttribute("morphTarget"+x)===!0&&u.deleteAttribute("morphTarget"+x),m&&u.hasAttribute("morphNormal"+x)===!0&&u.deleteAttribute("morphNormal"+x),n[x]=0)}const y=u.morphTargetsRelative?1:1-g;h.getUniforms().setValue(e,"morphTargetBaseInfluence",y),h.getUniforms().setValue(e,"morphTargetInfluences",n)}}return{update:l}}function fGe(e,t,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=t.get(l,u);if(n.get(h)!==c&&(t.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),n.get(l)!==c&&(i.update(l.instanceMatrix,e.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,e.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;n.get(d)!==c&&(d.update(),n.set(d,c))}return h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}class KU extends en{constructor(t,i,r,n,s,a,o,l,c,u){if(u=u!==void 0?u:jd,u!==jd&&u!==nm)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&u===jd&&(r=Xu),r===void 0&&u===nm&&(r=Vd),super(null,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.image={width:t,height:i},this.magFilter=o!==void 0?o:cn,this.minFilter=l!==void 0?l:cn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const i=super.toJSON(t);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}const jne=new en,Hne=new KU(1,1);Hne.compareFunction=GU;const Gne=new WT,Wne=new qU,Xne=new hw,A7=[],C7=[],T7=new Float32Array(16),P7=new Float32Array(9),D7=new Float32Array(4);function X0(e,t,i){const r=e[0];if(r<=0||r>0)return e;const n=t*i;let s=A7[n];if(s===void 0&&(s=new Float32Array(n),A7[n]=s),t!==0){r.toArray(s,0);for(let a=1,o=0;a!==t;++a)o+=i,e[a].toArray(s,o)}return s}function Wn(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function Xn(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function XT(e,t){let i=C7[t];i===void 0&&(i=new Int32Array(t),C7[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function mGe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function gGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Wn(i,t))return;e.uniform2fv(this.addr,t),Xn(i,t)}}function vGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(Wn(i,t))return;e.uniform3fv(this.addr,t),Xn(i,t)}}function yGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Wn(i,t))return;e.uniform4fv(this.addr,t),Xn(i,t)}}function xGe(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Wn(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Xn(i,t)}else{if(Wn(i,r))return;D7.set(r),e.uniformMatrix2fv(this.addr,!1,D7),Xn(i,r)}}function bGe(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Wn(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Xn(i,t)}else{if(Wn(i,r))return;P7.set(r),e.uniformMatrix3fv(this.addr,!1,P7),Xn(i,r)}}function wGe(e,t){const i=this.cache,r=t.elements;if(r===void 0){if(Wn(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Xn(i,t)}else{if(Wn(i,r))return;T7.set(r),e.uniformMatrix4fv(this.addr,!1,T7),Xn(i,r)}}function _Ge(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function SGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Wn(i,t))return;e.uniform2iv(this.addr,t),Xn(i,t)}}function MGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Wn(i,t))return;e.uniform3iv(this.addr,t),Xn(i,t)}}function EGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Wn(i,t))return;e.uniform4iv(this.addr,t),Xn(i,t)}}function AGe(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function CGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(Wn(i,t))return;e.uniform2uiv(this.addr,t),Xn(i,t)}}function TGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(Wn(i,t))return;e.uniform3uiv(this.addr,t),Xn(i,t)}}function PGe(e,t){const i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(Wn(i,t))return;e.uniform4uiv(this.addr,t),Xn(i,t)}}function DGe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n);const s=this.type===e.SAMPLER_2D_SHADOW?Hne:jne;i.setTexture2D(t||s,n)}function LGe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(t||Wne,n)}function RGe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(t||Xne,n)}function IGe(e,t,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(e.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(t||Gne,n)}function OGe(e){switch(e){case 5126:return mGe;case 35664:return gGe;case 35665:return vGe;case 35666:return yGe;case 35674:return xGe;case 35675:return bGe;case 35676:return wGe;case 5124:case 35670:return _Ge;case 35667:case 35671:return SGe;case 35668:case 35672:return MGe;case 35669:case 35673:return EGe;case 5125:return AGe;case 36294:return CGe;case 36295:return TGe;case 36296:return PGe;case 35678:case 36198:case 36298:case 36306:case 35682:return DGe;case 35679:case 36299:case 36307:return LGe;case 35680:case 36300:case 36308:case 36293:return RGe;case 36289:case 36303:case 36311:case 36292:return IGe}}function NGe(e,t){e.uniform1fv(this.addr,t)}function zGe(e,t){const i=X0(t,this.size,2);e.uniform2fv(this.addr,i)}function BGe(e,t){const i=X0(t,this.size,3);e.uniform3fv(this.addr,i)}function kGe(e,t){const i=X0(t,this.size,4);e.uniform4fv(this.addr,i)}function UGe(e,t){const i=X0(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function FGe(e,t){const i=X0(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function VGe(e,t){const i=X0(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function jGe(e,t){e.uniform1iv(this.addr,t)}function HGe(e,t){e.uniform2iv(this.addr,t)}function GGe(e,t){e.uniform3iv(this.addr,t)}function WGe(e,t){e.uniform4iv(this.addr,t)}function XGe(e,t){e.uniform1uiv(this.addr,t)}function qGe(e,t){e.uniform2uiv(this.addr,t)}function YGe(e,t){e.uniform3uiv(this.addr,t)}function ZGe(e,t){e.uniform4uiv(this.addr,t)}function QGe(e,t,i){const r=this.cache,n=t.length,s=XT(i,n);Wn(r,s)||(e.uniform1iv(this.addr,s),Xn(r,s));for(let a=0;a!==n;++a)i.setTexture2D(t[a]||jne,s[a])}function KGe(e,t,i){const r=this.cache,n=t.length,s=XT(i,n);Wn(r,s)||(e.uniform1iv(this.addr,s),Xn(r,s));for(let a=0;a!==n;++a)i.setTexture3D(t[a]||Wne,s[a])}function JGe(e,t,i){const r=this.cache,n=t.length,s=XT(i,n);Wn(r,s)||(e.uniform1iv(this.addr,s),Xn(r,s));for(let a=0;a!==n;++a)i.setTextureCube(t[a]||Xne,s[a])}function $Ge(e,t,i){const r=this.cache,n=t.length,s=XT(i,n);Wn(r,s)||(e.uniform1iv(this.addr,s),Xn(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(t[a]||Gne,s[a])}function eWe(e){switch(e){case 5126:return NGe;case 35664:return zGe;case 35665:return BGe;case 35666:return kGe;case 35674:return UGe;case 35675:return FGe;case 35676:return VGe;case 5124:case 35670:return jGe;case 35667:case 35671:return HGe;case 35668:case 35672:return GGe;case 35669:case 35673:return WGe;case 5125:return XGe;case 36294:return qGe;case 36295:return YGe;case 36296:return ZGe;case 35678:case 36198:case 36298:case 36306:case 35682:return QGe;case 35679:case 36299:case 36307:return KGe;case 35680:case 36300:case 36308:case 36293:return JGe;case 36289:case 36303:case 36311:case 36292:return $Ge}}class tWe{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.setValue=OGe(i.type)}}class iWe{constructor(t,i,r){this.id=t,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=eWe(i.type)}}class rWe{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(t,i[o.id],r)}}}const RL=/(\w+)(\])?(\[|\.)?/g;function L7(e,t){e.seq.push(t),e.map[t.id]=t}function nWe(e,t,i){const r=e.name,n=r.length;for(RL.lastIndex=0;;){const s=RL.exec(r),a=RL.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){L7(i,c===void 0?new tWe(o,e,t):new iWe(o,e,t));break}else{let h=i.map[o];h===void 0&&(h=new rWe(o),L7(i,h)),i=h}}}class kE{constructor(t,i){this.seq=[],this.map={};const r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=t.getActiveUniform(i,n),a=t.getUniformLocation(i,s.name);nWe(s,a,this)}}setValue(t,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(t,r,n)}setOptional(t,i,r){const n=i[r];n!==void 0&&this.setValue(t,r,n)}static upload(t,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(t,l.value,n)}}static seqWithValue(t,i){const r=[];for(let n=0,s=t.length;n!==s;++n){const a=t[n];a.id in i&&r.push(a)}return r}}function R7(e,t,i){const r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}const sWe=37297;let aWe=0;function oWe(e,t){const i=e.split(`
`),r=[],n=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===t?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function lWe(e){const t=ir.getPrimaries(ir.workingColorSpace),i=ir.getPrimaries(e);let r;switch(t===i?r="":t===xb&&i===yb?r="LinearDisplayP3ToLinearSRGB":t===yb&&i===xb&&(r="LinearSRGBToLinearDisplayP3"),e){case vh:case cw:return[r,"LinearTransferOETF"];case Ho:case GT:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[r,"LinearTransferOETF"]}}function I7(e,t,i){const r=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(r&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+oWe(e.getShaderSource(t),a)}else return n}function cWe(e,t){const i=lWe(t);return`vec4 ${e}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function uWe(e,t){let i;switch(t){case sne:i="Linear";break;case ane:i="Reinhard";break;case one:i="OptimizedCineon";break;case OU:i="ACESFilmic";break;case cne:i="AgX";break;case une:i="Neutral";break;case lne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function hWe(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||e.alphaToCoverage||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(bv).join(`
`)}function dWe(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(bv).join(`
`)}function pWe(e){const t=[];for(const i in e){const r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function fWe(e,t){const i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=e.getActiveAttrib(t,n),a=s.name;let o=1;s.type===e.FLOAT_MAT2&&(o=2),s.type===e.FLOAT_MAT3&&(o=3),s.type===e.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:e.getAttribLocation(t,a),locationSize:o}}return i}function bv(e){return e!==""}function O7(e,t){const i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function N7(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const mWe=/^[ \t]*#include +<([\w\d./]+)>/gm;function lz(e){return e.replace(mWe,vWe)}const gWe=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function vWe(e,t){let i=wi[t];if(i===void 0){const r=gWe.get(t);if(r!==void 0)i=wi[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,r);else throw new Error("Can not resolve #include <"+t+">")}return lz(i)}const yWe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function z7(e){return e.replace(yWe,xWe)}function xWe(e,t,i,r){let n="";for(let s=parseInt(t);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function B7(e){let t=`precision ${e.precision} float;
	precision ${e.precision} int;
	precision ${e.precision} sampler2D;
	precision ${e.precision} samplerCube;
	`;return e.isWebGL2&&(t+=`precision ${e.precision} sampler3D;
		precision ${e.precision} sampler2DArray;
		precision ${e.precision} sampler2DShadow;
		precision ${e.precision} samplerCubeShadow;
		precision ${e.precision} sampler2DArrayShadow;
		precision ${e.precision} isampler2D;
		precision ${e.precision} isampler3D;
		precision ${e.precision} isamplerCube;
		precision ${e.precision} isampler2DArray;
		precision ${e.precision} usampler2D;
		precision ${e.precision} usampler3D;
		precision ${e.precision} usamplerCube;
		precision ${e.precision} usampler2DArray;
		`),e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function bWe(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===FT?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===ux?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Cl&&(t="SHADOWMAP_TYPE_VSM"),t}function wWe(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case dh:case $d:t="ENVMAP_TYPE_CUBE";break;case G0:t="ENVMAP_TYPE_CUBE_UV";break}return t}function _We(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case $d:t="ENVMAP_MODE_REFRACTION";break}return t}function SWe(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case lw:t="ENVMAP_BLENDING_MULTIPLY";break;case rne:t="ENVMAP_BLENDING_MIX";break;case nne:t="ENVMAP_BLENDING_ADD";break}return t}function MWe(e){const t=e.envMapCubeUVHeight;if(t===null)return null;const i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function EWe(e,t,i,r){const n=e.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=bWe(i),c=wWe(i),u=_We(i),h=SWe(i),d=MWe(i),p=i.isWebGL2?"":hWe(i),f=dWe(i),v=pWe(s),m=n.createProgram();let g,y,x=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v].filter(bv).join(`
`),g.length>0&&(g+=`
`),y=[p,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v].filter(bv).join(`
`),y.length>0&&(y+=`
`)):(g=[B7(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(bv).join(`
`),y=[p,B7(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,v,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Fc?"#define TONE_MAPPING":"",i.toneMapping!==Fc?wi.tonemapping_pars_fragment:"",i.toneMapping!==Fc?uWe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",wi.colorspace_pars_fragment,cWe("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(bv).join(`
`)),a=lz(a),a=O7(a,i),a=N7(a,i),o=lz(o),o=O7(o,i),o=N7(o,i),a=z7(a),o=z7(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,g=[f,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,y=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===sz?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===sz?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const _=x+g+a,M=x+y+o,S=R7(n,n.VERTEX_SHADER,_),E=R7(n,n.FRAGMENT_SHADER,M);n.attachShader(m,S),n.attachShader(m,E),i.index0AttributeName!==void 0?n.bindAttribLocation(m,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(m,0,"position"),n.linkProgram(m);function A(N){if(e.debug.checkShaderErrors){const U=n.getProgramInfoLog(m).trim(),I=n.getShaderInfoLog(S).trim(),G=n.getShaderInfoLog(E).trim();let Q=!0,Y=!0;if(n.getProgramParameter(m,n.LINK_STATUS)===!1)if(Q=!1,typeof e.debug.onShaderError=="function")e.debug.onShaderError(n,m,S,E);else{const O=I7(n,S,"vertex"),V=I7(n,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(m,n.VALIDATE_STATUS)+`

Material Name: `+N.name+`
Material Type: `+N.type+`

Program Info Log: `+U+`
`+O+`
`+V)}else U!==""?console.warn("THREE.WebGLProgram: Program Info Log:",U):(I===""||G==="")&&(Y=!1);Y&&(N.diagnostics={runnable:Q,programLog:U,vertexShader:{log:I,prefix:g},fragmentShader:{log:G,prefix:y}})}n.deleteShader(S),n.deleteShader(E),P=new kE(n,m),C=fWe(n,m)}let P;this.getUniforms=function(){return P===void 0&&A(this),P};let C;this.getAttributes=function(){return C===void 0&&A(this),C};let D=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return D===!1&&(D=n.getProgramParameter(m,sWe)),D},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(m),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=aWe++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=S,this.fragmentShader=E,this}let AWe=0;class CWe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const i=t.vertexShader,r=t.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(t);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(t){const i=this.materialCache.get(t);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const i=this.materialCache;let r=i.get(t);return r===void 0&&(r=new Set,i.set(t,r)),r}_getShaderStage(t){const i=this.shaderCache;let r=i.get(t);return r===void 0&&(r=new TWe(t),i.set(t,r)),r}}class TWe{constructor(t){this.id=AWe++,this.code=t,this.usedTimes=0}}function PWe(e,t,i,r,n,s,a){const o=new jf,l=new CWe,c=new Set,u=[],h=n.isWebGL2,d=n.logarithmicDepthBuffer,p=n.vertexTextures;let f=n.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(C){return c.add(C),C===0?"uv":`uv${C}`}function g(C,D,N,U,I){const G=U.fog,Q=I.geometry,Y=C.isMeshStandardMaterial?U.environment:null,O=(C.isMeshStandardMaterial?i:t).get(C.envMap||Y),V=O&&O.mapping===G0?O.image.height:null,F=v[C.type];C.precision!==null&&(f=n.getMaxPrecision(C.precision),f!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",f,"instead."));const W=Q.morphAttributes.position||Q.morphAttributes.normal||Q.morphAttributes.color,ee=W!==void 0?W.length:0;let ae=0;Q.morphAttributes.position!==void 0&&(ae=1),Q.morphAttributes.normal!==void 0&&(ae=2),Q.morphAttributes.color!==void 0&&(ae=3);let K,$,ie,ye;if(F){const ai=Dl[F];K=ai.vertexShader,$=ai.fragmentShader}else K=C.vertexShader,$=C.fragmentShader,l.update(C),ie=l.getVertexShaderID(C),ye=l.getFragmentShaderID(C);const pe=e.getRenderTarget(),me=I.isInstancedMesh===!0,ge=I.isBatchedMesh===!0,xe=!!C.map,te=!!C.matcap,we=!!O,Ce=!!C.aoMap,Se=!!C.lightMap,Re=!!C.bumpMap,Xe=!!C.normalMap,Be=!!C.displacementMap,Fe=!!C.emissiveMap,dt=!!C.metalnessMap,se=!!C.roughnessMap,z=C.anisotropy>0,X=C.clearcoat>0,ce=C.iridescence>0,Ee=C.sheen>0,q=C.transmission>0,Ye=z&&!!C.anisotropyMap,et=X&&!!C.clearcoatMap,ke=X&&!!C.clearcoatNormalMap,_e=X&&!!C.clearcoatRoughnessMap,at=ce&&!!C.iridescenceMap,Ve=ce&&!!C.iridescenceThicknessMap,mt=Ee&&!!C.sheenColorMap,pt=Ee&&!!C.sheenRoughnessMap,st=!!C.specularMap,ue=!!C.specularColorMap,ze=!!C.specularIntensityMap,ut=q&&!!C.transmissionMap,de=q&&!!C.thicknessMap,Ne=!!C.gradientMap,oe=!!C.alphaMap,He=C.alphaTest>0,Ae=!!C.alphaHash,tt=!!C.extensions;let ct=Fc;C.toneMapped&&(pe===null||pe.isXRRenderTarget===!0)&&(ct=e.toneMapping);const Dt={isWebGL2:h,shaderID:F,shaderType:C.type,shaderName:C.name,vertexShader:K,fragmentShader:$,defines:C.defines,customVertexShaderID:ie,customFragmentShaderID:ye,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:f,batching:ge,instancing:me,instancingColor:me&&I.instanceColor!==null,instancingMorph:me&&I.morphTexture!==null,supportsVertexTextures:p,outputColorSpace:pe===null?e.outputColorSpace:pe.isXRRenderTarget===!0?pe.texture.colorSpace:vh,alphaToCoverage:!!C.alphaToCoverage,map:xe,matcap:te,envMap:we,envMapMode:we&&O.mapping,envMapCubeUVHeight:V,aoMap:Ce,lightMap:Se,bumpMap:Re,normalMap:Xe,displacementMap:p&&Be,emissiveMap:Fe,normalMapObjectSpace:Xe&&C.normalMapType===Mne,normalMapTangentSpace:Xe&&C.normalMapType===up,metalnessMap:dt,roughnessMap:se,anisotropy:z,anisotropyMap:Ye,clearcoat:X,clearcoatMap:et,clearcoatNormalMap:ke,clearcoatRoughnessMap:_e,iridescence:ce,iridescenceMap:at,iridescenceThicknessMap:Ve,sheen:Ee,sheenColorMap:mt,sheenRoughnessMap:pt,specularMap:st,specularColorMap:ue,specularIntensityMap:ze,transmission:q,transmissionMap:ut,thicknessMap:de,gradientMap:Ne,opaque:C.transparent===!1&&C.blending===Ff&&C.alphaToCoverage===!1,alphaMap:oe,alphaTest:He,alphaHash:Ae,combine:C.combine,mapUv:xe&&m(C.map.channel),aoMapUv:Ce&&m(C.aoMap.channel),lightMapUv:Se&&m(C.lightMap.channel),bumpMapUv:Re&&m(C.bumpMap.channel),normalMapUv:Xe&&m(C.normalMap.channel),displacementMapUv:Be&&m(C.displacementMap.channel),emissiveMapUv:Fe&&m(C.emissiveMap.channel),metalnessMapUv:dt&&m(C.metalnessMap.channel),roughnessMapUv:se&&m(C.roughnessMap.channel),anisotropyMapUv:Ye&&m(C.anisotropyMap.channel),clearcoatMapUv:et&&m(C.clearcoatMap.channel),clearcoatNormalMapUv:ke&&m(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:_e&&m(C.clearcoatRoughnessMap.channel),iridescenceMapUv:at&&m(C.iridescenceMap.channel),iridescenceThicknessMapUv:Ve&&m(C.iridescenceThicknessMap.channel),sheenColorMapUv:mt&&m(C.sheenColorMap.channel),sheenRoughnessMapUv:pt&&m(C.sheenRoughnessMap.channel),specularMapUv:st&&m(C.specularMap.channel),specularColorMapUv:ue&&m(C.specularColorMap.channel),specularIntensityMapUv:ze&&m(C.specularIntensityMap.channel),transmissionMapUv:ut&&m(C.transmissionMap.channel),thicknessMapUv:de&&m(C.thicknessMap.channel),alphaMapUv:oe&&m(C.alphaMap.channel),vertexTangents:!!Q.attributes.tangent&&(Xe||z),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!Q.attributes.color&&Q.attributes.color.itemSize===4,pointsUvs:I.isPoints===!0&&!!Q.attributes.uv&&(xe||oe),fog:!!G,useFog:C.fog===!0,fogExp2:!!G&&G.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:I.isSkinnedMesh===!0,morphTargets:Q.morphAttributes.position!==void 0,morphNormals:Q.morphAttributes.normal!==void 0,morphColors:Q.morphAttributes.color!==void 0,morphTargetsCount:ee,morphTextureStride:ae,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numLightProbes:D.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:e.shadowMap.enabled&&N.length>0,shadowMapType:e.shadowMap.type,toneMapping:ct,useLegacyLights:e._useLegacyLights,decodeVideoTexture:xe&&C.map.isVideoTexture===!0&&ir.getTransfer(C.map.colorSpace)===xr,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===Cc,flipSided:C.side===xa,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:tt&&C.extensions.derivatives===!0,extensionFragDepth:tt&&C.extensions.fragDepth===!0,extensionDrawBuffers:tt&&C.extensions.drawBuffers===!0,extensionShaderTextureLOD:tt&&C.extensions.shaderTextureLOD===!0,extensionClipCullDistance:tt&&C.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:tt&&C.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:C.customProgramCacheKey()};return Dt.vertexUv1s=c.has(1),Dt.vertexUv2s=c.has(2),Dt.vertexUv3s=c.has(3),c.clear(),Dt}function y(C){const D=[];if(C.shaderID?D.push(C.shaderID):(D.push(C.customVertexShaderID),D.push(C.customFragmentShaderID)),C.defines!==void 0)for(const N in C.defines)D.push(N),D.push(C.defines[N]);return C.isRawShaderMaterial===!1&&(x(D,C),_(D,C),D.push(e.outputColorSpace)),D.push(C.customProgramCacheKey),D.join()}function x(C,D){C.push(D.precision),C.push(D.outputColorSpace),C.push(D.envMapMode),C.push(D.envMapCubeUVHeight),C.push(D.mapUv),C.push(D.alphaMapUv),C.push(D.lightMapUv),C.push(D.aoMapUv),C.push(D.bumpMapUv),C.push(D.normalMapUv),C.push(D.displacementMapUv),C.push(D.emissiveMapUv),C.push(D.metalnessMapUv),C.push(D.roughnessMapUv),C.push(D.anisotropyMapUv),C.push(D.clearcoatMapUv),C.push(D.clearcoatNormalMapUv),C.push(D.clearcoatRoughnessMapUv),C.push(D.iridescenceMapUv),C.push(D.iridescenceThicknessMapUv),C.push(D.sheenColorMapUv),C.push(D.sheenRoughnessMapUv),C.push(D.specularMapUv),C.push(D.specularColorMapUv),C.push(D.specularIntensityMapUv),C.push(D.transmissionMapUv),C.push(D.thicknessMapUv),C.push(D.combine),C.push(D.fogExp2),C.push(D.sizeAttenuation),C.push(D.morphTargetsCount),C.push(D.morphAttributeCount),C.push(D.numDirLights),C.push(D.numPointLights),C.push(D.numSpotLights),C.push(D.numSpotLightMaps),C.push(D.numHemiLights),C.push(D.numRectAreaLights),C.push(D.numDirLightShadows),C.push(D.numPointLightShadows),C.push(D.numSpotLightShadows),C.push(D.numSpotLightShadowsWithMaps),C.push(D.numLightProbes),C.push(D.shadowMapType),C.push(D.toneMapping),C.push(D.numClippingPlanes),C.push(D.numClipIntersection),C.push(D.depthPacking)}function _(C,D){o.disableAll(),D.isWebGL2&&o.enable(0),D.supportsVertexTextures&&o.enable(1),D.instancing&&o.enable(2),D.instancingColor&&o.enable(3),D.instancingMorph&&o.enable(4),D.matcap&&o.enable(5),D.envMap&&o.enable(6),D.normalMapObjectSpace&&o.enable(7),D.normalMapTangentSpace&&o.enable(8),D.clearcoat&&o.enable(9),D.iridescence&&o.enable(10),D.alphaTest&&o.enable(11),D.vertexColors&&o.enable(12),D.vertexAlphas&&o.enable(13),D.vertexUv1s&&o.enable(14),D.vertexUv2s&&o.enable(15),D.vertexUv3s&&o.enable(16),D.vertexTangents&&o.enable(17),D.anisotropy&&o.enable(18),D.alphaHash&&o.enable(19),D.batching&&o.enable(20),C.push(o.mask),o.disableAll(),D.fog&&o.enable(0),D.useFog&&o.enable(1),D.flatShading&&o.enable(2),D.logarithmicDepthBuffer&&o.enable(3),D.skinning&&o.enable(4),D.morphTargets&&o.enable(5),D.morphNormals&&o.enable(6),D.morphColors&&o.enable(7),D.premultipliedAlpha&&o.enable(8),D.shadowMapEnabled&&o.enable(9),D.useLegacyLights&&o.enable(10),D.doubleSided&&o.enable(11),D.flipSided&&o.enable(12),D.useDepthPacking&&o.enable(13),D.dithering&&o.enable(14),D.transmission&&o.enable(15),D.sheen&&o.enable(16),D.opaque&&o.enable(17),D.pointsUvs&&o.enable(18),D.decodeVideoTexture&&o.enable(19),D.alphaToCoverage&&o.enable(20),C.push(o.mask)}function M(C){const D=v[C.type];let N;if(D){const U=Dl[D];N=kne.clone(U.uniforms)}else N=C.uniforms;return N}function S(C,D){let N;for(let U=0,I=u.length;U<I;U++){const G=u[U];if(G.cacheKey===D){N=G,++N.usedTimes;break}}return N===void 0&&(N=new EWe(e,D,C,s),u.push(N)),N}function E(C){if(--C.usedTimes===0){const D=u.indexOf(C);u[D]=u[u.length-1],u.pop(),C.destroy()}}function A(C){l.remove(C)}function P(){l.dispose()}return{getParameters:g,getProgramCacheKey:y,getUniforms:M,acquireProgram:S,releaseProgram:E,releaseShaderCache:A,programs:u,dispose:P}}function DWe(){let e=new WeakMap;function t(s){let a=e.get(s);return a===void 0&&(a={},e.set(s,a)),a}function i(s){e.delete(s)}function r(s,a,o){e.get(s)[a]=o}function n(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:n}}function LWe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function k7(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function U7(){const e=[];let t=0;const i=[],r=[],n=[];function s(){t=0,i.length=0,r.length=0,n.length=0}function a(h,d,p,f,v,m){let g=e[t];return g===void 0?(g={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:v,group:m},e[t]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=p,g.groupOrder=f,g.renderOrder=h.renderOrder,g.z=v,g.group=m),t++,g}function o(h,d,p,f,v,m){const g=a(h,d,p,f,v,m);p.transmission>0?r.push(g):p.transparent===!0?n.push(g):i.push(g)}function l(h,d,p,f,v,m){const g=a(h,d,p,f,v,m);p.transmission>0?r.unshift(g):p.transparent===!0?n.unshift(g):i.unshift(g)}function c(h,d){i.length>1&&i.sort(h||LWe),r.length>1&&r.sort(d||k7),n.length>1&&n.sort(d||k7)}function u(){for(let h=t,d=e.length;h<d;h++){const p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function RWe(){let e=new WeakMap;function t(r,n){const s=e.get(r);let a;return s===void 0?(a=new U7,e.set(r,[a])):n>=s.length?(a=new U7,s.push(a)):a=s[n],a}function i(){e=new WeakMap}return{get:t,dispose:i}}function IWe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new he,color:new Rt};break;case"SpotLight":i={position:new he,direction:new he,color:new Rt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new he,color:new Rt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new he,skyColor:new Rt,groundColor:new Rt};break;case"RectAreaLight":i={color:new Rt,position:new he,halfWidth:new he,halfHeight:new he};break}return e[t.id]=i,i}}}function OWe(){const e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nt};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nt,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}let NWe=0;function zWe(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function BWe(e,t){const i=new IWe,r=OWe(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new he);const s=new he,a=new ui,o=new ui;function l(u,h){let d=0,p=0,f=0;for(let N=0;N<9;N++)n.probe[N].set(0,0,0);let v=0,m=0,g=0,y=0,x=0,_=0,M=0,S=0,E=0,A=0,P=0;u.sort(zWe);const C=h===!0?Math.PI:1;for(let N=0,U=u.length;N<U;N++){const I=u[N],G=I.color,Q=I.intensity,Y=I.distance,O=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)d+=G.r*Q*C,p+=G.g*Q*C,f+=G.b*Q*C;else if(I.isLightProbe){for(let V=0;V<9;V++)n.probe[V].addScaledVector(I.sh.coefficients[V],Q);P++}else if(I.isDirectionalLight){const V=i.get(I);if(V.color.copy(I.color).multiplyScalar(I.intensity*C),I.castShadow){const F=I.shadow,W=r.get(I);W.shadowBias=F.bias,W.shadowNormalBias=F.normalBias,W.shadowRadius=F.radius,W.shadowMapSize=F.mapSize,n.directionalShadow[v]=W,n.directionalShadowMap[v]=O,n.directionalShadowMatrix[v]=I.shadow.matrix,_++}n.directional[v]=V,v++}else if(I.isSpotLight){const V=i.get(I);V.position.setFromMatrixPosition(I.matrixWorld),V.color.copy(G).multiplyScalar(Q*C),V.distance=Y,V.coneCos=Math.cos(I.angle),V.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),V.decay=I.decay,n.spot[g]=V;const F=I.shadow;if(I.map&&(n.spotLightMap[E]=I.map,E++,F.updateMatrices(I),I.castShadow&&A++),n.spotLightMatrix[g]=F.matrix,I.castShadow){const W=r.get(I);W.shadowBias=F.bias,W.shadowNormalBias=F.normalBias,W.shadowRadius=F.radius,W.shadowMapSize=F.mapSize,n.spotShadow[g]=W,n.spotShadowMap[g]=O,S++}g++}else if(I.isRectAreaLight){const V=i.get(I);V.color.copy(G).multiplyScalar(Q),V.halfWidth.set(I.width*.5,0,0),V.halfHeight.set(0,I.height*.5,0),n.rectArea[y]=V,y++}else if(I.isPointLight){const V=i.get(I);if(V.color.copy(I.color).multiplyScalar(I.intensity*C),V.distance=I.distance,V.decay=I.decay,I.castShadow){const F=I.shadow,W=r.get(I);W.shadowBias=F.bias,W.shadowNormalBias=F.normalBias,W.shadowRadius=F.radius,W.shadowMapSize=F.mapSize,W.shadowCameraNear=F.camera.near,W.shadowCameraFar=F.camera.far,n.pointShadow[m]=W,n.pointShadowMap[m]=O,n.pointShadowMatrix[m]=I.shadow.matrix,M++}n.point[m]=V,m++}else if(I.isHemisphereLight){const V=i.get(I);V.skyColor.copy(I.color).multiplyScalar(Q*C),V.groundColor.copy(I.groundColor).multiplyScalar(Q*C),n.hemi[x]=V,x++}}y>0&&(t.isWebGL2?e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=St.LTC_FLOAT_1,n.rectAreaLTC2=St.LTC_FLOAT_2):(n.rectAreaLTC1=St.LTC_HALF_1,n.rectAreaLTC2=St.LTC_HALF_2):e.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=St.LTC_FLOAT_1,n.rectAreaLTC2=St.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=St.LTC_HALF_1,n.rectAreaLTC2=St.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=p,n.ambient[2]=f;const D=n.hash;(D.directionalLength!==v||D.pointLength!==m||D.spotLength!==g||D.rectAreaLength!==y||D.hemiLength!==x||D.numDirectionalShadows!==_||D.numPointShadows!==M||D.numSpotShadows!==S||D.numSpotMaps!==E||D.numLightProbes!==P)&&(n.directional.length=v,n.spot.length=g,n.rectArea.length=y,n.point.length=m,n.hemi.length=x,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=S,n.spotShadowMap.length=S,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=S+E-A,n.spotLightMap.length=E,n.numSpotLightShadowsWithMaps=A,n.numLightProbes=P,D.directionalLength=v,D.pointLength=m,D.spotLength=g,D.rectAreaLength=y,D.hemiLength=x,D.numDirectionalShadows=_,D.numPointShadows=M,D.numSpotShadows=S,D.numSpotMaps=E,D.numLightProbes=P,n.version=NWe++)}function c(u,h){let d=0,p=0,f=0,v=0,m=0;const g=h.matrixWorldInverse;for(let y=0,x=u.length;y<x;y++){const _=u[y];if(_.isDirectionalLight){const M=n.directional[d];M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),d++}else if(_.isSpotLight){const M=n.spot[f];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),M.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(g),f++}else if(_.isRectAreaLight){const M=n.rectArea[v];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),o.identity(),a.copy(_.matrixWorld),a.premultiply(g),o.extractRotation(a),M.halfWidth.set(_.width*.5,0,0),M.halfHeight.set(0,_.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),v++}else if(_.isPointLight){const M=n.point[p];M.position.setFromMatrixPosition(_.matrixWorld),M.position.applyMatrix4(g),p++}else if(_.isHemisphereLight){const M=n.hemi[m];M.direction.setFromMatrixPosition(_.matrixWorld),M.direction.transformDirection(g),m++}}}return{setup:l,setupView:c,state:n}}function F7(e,t){const i=new BWe(e,t),r=[],n=[];function s(){r.length=0,n.length=0}function a(h){r.push(h)}function o(h){n.push(h)}function l(h){i.setup(r,h)}function c(h){i.setupView(r,h)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function kWe(e,t){let i=new WeakMap;function r(s,a=0){const o=i.get(s);let l;return o===void 0?(l=new F7(e,t),i.set(s,[l])):a>=o.length?(l=new F7(e,t),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}class JU extends ea{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=_ne,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class $U extends ea{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const UWe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,FWe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function VWe(e,t,i){let r=new dw;const n=new nt,s=new nt,a=new nr,o=new JU({depthPacking:Sne}),l=new $U,c={},u=i.maxTextureSize,h={[hh]:xa,[xa]:hh,[Cc]:Cc},d=new sl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new nt},radius:{value:4}},vertexShader:UWe,fragmentShader:FWe}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Ei;f.setAttribute("position",new pr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new An(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=FT;let g=this.type;this.render=function(S,E,A){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||S.length===0)return;const P=e.getRenderTarget(),C=e.getActiveCubeFace(),D=e.getActiveMipmapLevel(),N=e.state;N.setBlending($u),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);const U=g!==Cl&&this.type===Cl,I=g===Cl&&this.type!==Cl;for(let G=0,Q=S.length;G<Q;G++){const Y=S[G],O=Y.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",Y,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;n.copy(O.mapSize);const V=O.getFrameExtents();if(n.multiply(V),s.copy(O.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/V.x),n.x=s.x*V.x,O.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/V.y),n.y=s.y*V.y,O.mapSize.y=s.y)),O.map===null||U===!0||I===!0){const W=this.type!==Cl?{minFilter:cn,magFilter:cn}:{};O.map!==null&&O.map.dispose(),O.map=new Wl(n.x,n.y,W),O.map.texture.name=Y.name+".shadowMap",O.camera.updateProjectionMatrix()}e.setRenderTarget(O.map),e.clear();const F=O.getViewportCount();for(let W=0;W<F;W++){const ee=O.getViewport(W);a.set(s.x*ee.x,s.y*ee.y,s.x*ee.z,s.y*ee.w),N.viewport(a),O.updateMatrices(Y,W),r=O.getFrustum(),_(E,A,O.camera,Y,this.type)}O.isPointLightShadow!==!0&&this.type===Cl&&y(O,A),O.needsUpdate=!1}g=this.type,m.needsUpdate=!1,e.setRenderTarget(P,C,D)};function y(S,E){const A=t.update(v);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,p.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Wl(n.x,n.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,e.setRenderTarget(S.mapPass),e.clear(),e.renderBufferDirect(E,null,A,d,v,null),p.uniforms.shadow_pass.value=S.mapPass.texture,p.uniforms.resolution.value=S.mapSize,p.uniforms.radius.value=S.radius,e.setRenderTarget(S.map),e.clear(),e.renderBufferDirect(E,null,A,p,v,null)}function x(S,E,A,P){let C=null;const D=A.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(D!==void 0)C=D;else if(C=A.isPointLight===!0?l:o,e.localClippingEnabled&&E.clipShadows===!0&&Array.isArray(E.clippingPlanes)&&E.clippingPlanes.length!==0||E.displacementMap&&E.displacementScale!==0||E.alphaMap&&E.alphaTest>0||E.map&&E.alphaTest>0){const N=C.uuid,U=E.uuid;let I=c[N];I===void 0&&(I={},c[N]=I);let G=I[U];G===void 0&&(G=C.clone(),I[U]=G,E.addEventListener("dispose",M)),C=G}if(C.visible=E.visible,C.wireframe=E.wireframe,P===Cl?C.side=E.shadowSide!==null?E.shadowSide:E.side:C.side=E.shadowSide!==null?E.shadowSide:h[E.side],C.alphaMap=E.alphaMap,C.alphaTest=E.alphaTest,C.map=E.map,C.clipShadows=E.clipShadows,C.clippingPlanes=E.clippingPlanes,C.clipIntersection=E.clipIntersection,C.displacementMap=E.displacementMap,C.displacementScale=E.displacementScale,C.displacementBias=E.displacementBias,C.wireframeLinewidth=E.wireframeLinewidth,C.linewidth=E.linewidth,A.isPointLight===!0&&C.isMeshDistanceMaterial===!0){const N=e.properties.get(C);N.light=A}return C}function _(S,E,A,P,C){if(S.visible===!1)return;if(S.layers.test(E.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&C===Cl)&&(!S.frustumCulled||r.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,S.matrixWorld);const U=t.update(S),I=S.material;if(Array.isArray(I)){const G=U.groups;for(let Q=0,Y=G.length;Q<Y;Q++){const O=G[Q],V=I[O.materialIndex];if(V&&V.visible){const F=x(S,V,P,C);S.onBeforeShadow(e,S,E,A,U,F,O),e.renderBufferDirect(A,null,U,F,S,O),S.onAfterShadow(e,S,E,A,U,F,O)}}}else if(I.visible){const G=x(S,I,P,C);S.onBeforeShadow(e,S,E,A,U,G,null),e.renderBufferDirect(A,null,U,G,S,null),S.onAfterShadow(e,S,E,A,U,G,null)}}const N=S.children;for(let U=0,I=N.length;U<I;U++)_(N[U],E,A,P,C)}function M(S){S.target.removeEventListener("dispose",M);for(const A in c){const P=c[A],C=S.target.uuid;C in P&&(P[C].dispose(),delete P[C])}}}function jWe(e,t,i){const r=i.isWebGL2;function n(){let oe=!1;const He=new nr;let Ae=null;const tt=new nr(0,0,0,0);return{setMask:function(ct){Ae!==ct&&!oe&&(e.colorMask(ct,ct,ct,ct),Ae=ct)},setLocked:function(ct){oe=ct},setClear:function(ct,Dt,ai,Wt,Ni){Ni===!0&&(ct*=Wt,Dt*=Wt,ai*=Wt),He.set(ct,Dt,ai,Wt),tt.equals(He)===!1&&(e.clearColor(ct,Dt,ai,Wt),tt.copy(He))},reset:function(){oe=!1,Ae=null,tt.set(-1,0,0,0)}}}function s(){let oe=!1,He=null,Ae=null,tt=null;return{setTest:function(ct){ct?me(e.DEPTH_TEST):ge(e.DEPTH_TEST)},setMask:function(ct){He!==ct&&!oe&&(e.depthMask(ct),He=ct)},setFunc:function(ct){if(Ae!==ct){switch(ct){case Qre:e.depthFunc(e.NEVER);break;case Kre:e.depthFunc(e.ALWAYS);break;case Jre:e.depthFunc(e.LESS);break;case cb:e.depthFunc(e.LEQUAL);break;case $re:e.depthFunc(e.EQUAL);break;case ene:e.depthFunc(e.GEQUAL);break;case tne:e.depthFunc(e.GREATER);break;case ine:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}Ae=ct}},setLocked:function(ct){oe=ct},setClear:function(ct){tt!==ct&&(e.clearDepth(ct),tt=ct)},reset:function(){oe=!1,He=null,Ae=null,tt=null}}}function a(){let oe=!1,He=null,Ae=null,tt=null,ct=null,Dt=null,ai=null,Wt=null,Ni=null;return{setTest:function(Qt){oe||(Qt?me(e.STENCIL_TEST):ge(e.STENCIL_TEST))},setMask:function(Qt){He!==Qt&&!oe&&(e.stencilMask(Qt),He=Qt)},setFunc:function(Qt,Ot,Ps){(Ae!==Qt||tt!==Ot||ct!==Ps)&&(e.stencilFunc(Qt,Ot,Ps),Ae=Qt,tt=Ot,ct=Ps)},setOp:function(Qt,Ot,Ps){(Dt!==Qt||ai!==Ot||Wt!==Ps)&&(e.stencilOp(Qt,Ot,Ps),Dt=Qt,ai=Ot,Wt=Ps)},setLocked:function(Qt){oe=Qt},setClear:function(Qt){Ni!==Qt&&(e.clearStencil(Qt),Ni=Qt)},reset:function(){oe=!1,He=null,Ae=null,tt=null,ct=null,Dt=null,ai=null,Wt=null,Ni=null}}}const o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap;let d={},p={},f=new WeakMap,v=[],m=null,g=!1,y=null,x=null,_=null,M=null,S=null,E=null,A=null,P=new Rt(0,0,0),C=0,D=!1,N=null,U=null,I=null,G=null,Q=null;const Y=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let O=!1,V=0;const F=e.getParameter(e.VERSION);F.indexOf("WebGL")!==-1?(V=parseFloat(/^WebGL (\d)/.exec(F)[1]),O=V>=1):F.indexOf("OpenGL ES")!==-1&&(V=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),O=V>=2);let W=null,ee={};const ae=e.getParameter(e.SCISSOR_BOX),K=e.getParameter(e.VIEWPORT),$=new nr().fromArray(ae),ie=new nr().fromArray(K);function ye(oe,He,Ae,tt){const ct=new Uint8Array(4),Dt=e.createTexture();e.bindTexture(oe,Dt),e.texParameteri(oe,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(oe,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let ai=0;ai<Ae;ai++)r&&(oe===e.TEXTURE_3D||oe===e.TEXTURE_2D_ARRAY)?e.texImage3D(He,0,e.RGBA,1,1,tt,0,e.RGBA,e.UNSIGNED_BYTE,ct):e.texImage2D(He+ai,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ct);return Dt}const pe={};pe[e.TEXTURE_2D]=ye(e.TEXTURE_2D,e.TEXTURE_2D,1),pe[e.TEXTURE_CUBE_MAP]=ye(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(pe[e.TEXTURE_2D_ARRAY]=ye(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),pe[e.TEXTURE_3D]=ye(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),me(e.DEPTH_TEST),l.setFunc(cb),Be(!1),Fe(CN),me(e.CULL_FACE),Re($u);function me(oe){d[oe]!==!0&&(e.enable(oe),d[oe]=!0)}function ge(oe){d[oe]!==!1&&(e.disable(oe),d[oe]=!1)}function xe(oe,He){return p[oe]!==He?(e.bindFramebuffer(oe,He),p[oe]=He,r&&(oe===e.DRAW_FRAMEBUFFER&&(p[e.FRAMEBUFFER]=He),oe===e.FRAMEBUFFER&&(p[e.DRAW_FRAMEBUFFER]=He)),!0):!1}function te(oe,He){let Ae=v,tt=!1;if(oe){Ae=f.get(He),Ae===void 0&&(Ae=[],f.set(He,Ae));const ct=oe.textures;if(Ae.length!==ct.length||Ae[0]!==e.COLOR_ATTACHMENT0){for(let Dt=0,ai=ct.length;Dt<ai;Dt++)Ae[Dt]=e.COLOR_ATTACHMENT0+Dt;Ae.length=ct.length,tt=!0}}else Ae[0]!==e.BACK&&(Ae[0]=e.BACK,tt=!0);if(tt)if(i.isWebGL2)e.drawBuffers(Ae);else if(t.has("WEBGL_draw_buffers")===!0)t.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ae);else throw new Error("THREE.WebGLState: Usage of gl.drawBuffers() require WebGL2 or WEBGL_draw_buffers extension")}function we(oe){return m!==oe?(e.useProgram(oe),m=oe,!0):!1}const Ce={[pd]:e.FUNC_ADD,[Nre]:e.FUNC_SUBTRACT,[zre]:e.FUNC_REVERSE_SUBTRACT};if(r)Ce[DN]=e.MIN,Ce[LN]=e.MAX;else{const oe=t.get("EXT_blend_minmax");oe!==null&&(Ce[DN]=oe.MIN_EXT,Ce[LN]=oe.MAX_EXT)}const Se={[Bre]:e.ZERO,[kre]:e.ONE,[Ure]:e.SRC_COLOR,[AC]:e.SRC_ALPHA,[Wre]:e.SRC_ALPHA_SATURATE,[Hre]:e.DST_COLOR,[Vre]:e.DST_ALPHA,[Fre]:e.ONE_MINUS_SRC_COLOR,[CC]:e.ONE_MINUS_SRC_ALPHA,[Gre]:e.ONE_MINUS_DST_COLOR,[jre]:e.ONE_MINUS_DST_ALPHA,[Xre]:e.CONSTANT_COLOR,[qre]:e.ONE_MINUS_CONSTANT_COLOR,[Yre]:e.CONSTANT_ALPHA,[Zre]:e.ONE_MINUS_CONSTANT_ALPHA};function Re(oe,He,Ae,tt,ct,Dt,ai,Wt,Ni,Qt){if(oe===$u){g===!0&&(ge(e.BLEND),g=!1);return}if(g===!1&&(me(e.BLEND),g=!0),oe!==Ore){if(oe!==y||Qt!==D){if((x!==pd||S!==pd)&&(e.blendEquation(e.FUNC_ADD),x=pd,S=pd),Qt)switch(oe){case Ff:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case EC:e.blendFunc(e.ONE,e.ONE);break;case TN:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case PN:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}else switch(oe){case Ff:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case EC:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case TN:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case PN:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}_=null,M=null,E=null,A=null,P.set(0,0,0),C=0,y=oe,D=Qt}return}ct=ct||He,Dt=Dt||Ae,ai=ai||tt,(He!==x||ct!==S)&&(e.blendEquationSeparate(Ce[He],Ce[ct]),x=He,S=ct),(Ae!==_||tt!==M||Dt!==E||ai!==A)&&(e.blendFuncSeparate(Se[Ae],Se[tt],Se[Dt],Se[ai]),_=Ae,M=tt,E=Dt,A=ai),(Wt.equals(P)===!1||Ni!==C)&&(e.blendColor(Wt.r,Wt.g,Wt.b,Ni),P.copy(Wt),C=Ni),y=oe,D=!1}function Xe(oe,He){oe.side===Cc?ge(e.CULL_FACE):me(e.CULL_FACE);let Ae=oe.side===xa;He&&(Ae=!Ae),Be(Ae),oe.blending===Ff&&oe.transparent===!1?Re($u):Re(oe.blending,oe.blendEquation,oe.blendSrc,oe.blendDst,oe.blendEquationAlpha,oe.blendSrcAlpha,oe.blendDstAlpha,oe.blendColor,oe.blendAlpha,oe.premultipliedAlpha),l.setFunc(oe.depthFunc),l.setTest(oe.depthTest),l.setMask(oe.depthWrite),o.setMask(oe.colorWrite);const tt=oe.stencilWrite;c.setTest(tt),tt&&(c.setMask(oe.stencilWriteMask),c.setFunc(oe.stencilFunc,oe.stencilRef,oe.stencilFuncMask),c.setOp(oe.stencilFail,oe.stencilZFail,oe.stencilZPass)),se(oe.polygonOffset,oe.polygonOffsetFactor,oe.polygonOffsetUnits),oe.alphaToCoverage===!0?me(e.SAMPLE_ALPHA_TO_COVERAGE):ge(e.SAMPLE_ALPHA_TO_COVERAGE)}function Be(oe){N!==oe&&(oe?e.frontFace(e.CW):e.frontFace(e.CCW),N=oe)}function Fe(oe){oe!==Lre?(me(e.CULL_FACE),oe!==U&&(oe===CN?e.cullFace(e.BACK):oe===Rre?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):ge(e.CULL_FACE),U=oe}function dt(oe){oe!==I&&(O&&e.lineWidth(oe),I=oe)}function se(oe,He,Ae){oe?(me(e.POLYGON_OFFSET_FILL),(G!==He||Q!==Ae)&&(e.polygonOffset(He,Ae),G=He,Q=Ae)):ge(e.POLYGON_OFFSET_FILL)}function z(oe){oe?me(e.SCISSOR_TEST):ge(e.SCISSOR_TEST)}function X(oe){oe===void 0&&(oe=e.TEXTURE0+Y-1),W!==oe&&(e.activeTexture(oe),W=oe)}function ce(oe,He,Ae){Ae===void 0&&(W===null?Ae=e.TEXTURE0+Y-1:Ae=W);let tt=ee[Ae];tt===void 0&&(tt={type:void 0,texture:void 0},ee[Ae]=tt),(tt.type!==oe||tt.texture!==He)&&(W!==Ae&&(e.activeTexture(Ae),W=Ae),e.bindTexture(oe,He||pe[oe]),tt.type=oe,tt.texture=He)}function Ee(){const oe=ee[W];oe!==void 0&&oe.type!==void 0&&(e.bindTexture(oe.type,null),oe.type=void 0,oe.texture=void 0)}function q(){try{e.compressedTexImage2D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Ye(){try{e.compressedTexImage3D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function et(){try{e.texSubImage2D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function ke(){try{e.texSubImage3D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function _e(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function at(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Ve(){try{e.texStorage2D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function mt(){try{e.texStorage3D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function pt(){try{e.texImage2D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function st(){try{e.texImage3D.apply(e,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function ue(oe){$.equals(oe)===!1&&(e.scissor(oe.x,oe.y,oe.z,oe.w),$.copy(oe))}function ze(oe){ie.equals(oe)===!1&&(e.viewport(oe.x,oe.y,oe.z,oe.w),ie.copy(oe))}function ut(oe,He){let Ae=h.get(He);Ae===void 0&&(Ae=new WeakMap,h.set(He,Ae));let tt=Ae.get(oe);tt===void 0&&(tt=e.getUniformBlockIndex(He,oe.name),Ae.set(oe,tt))}function de(oe,He){const tt=h.get(He).get(oe);u.get(He)!==tt&&(e.uniformBlockBinding(He,tt,oe.__bindingPointIndex),u.set(He,tt))}function Ne(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),r===!0&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},W=null,ee={},p={},f=new WeakMap,v=[],m=null,g=!1,y=null,x=null,_=null,M=null,S=null,E=null,A=null,P=new Rt(0,0,0),C=0,D=!1,N=null,U=null,I=null,G=null,Q=null,$.set(0,0,e.canvas.width,e.canvas.height),ie.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:me,disable:ge,bindFramebuffer:xe,drawBuffers:te,useProgram:we,setBlending:Re,setMaterial:Xe,setFlipSided:Be,setCullFace:Fe,setLineWidth:dt,setPolygonOffset:se,setScissorTest:z,activeTexture:X,bindTexture:ce,unbindTexture:Ee,compressedTexImage2D:q,compressedTexImage3D:Ye,texImage2D:pt,texImage3D:st,updateUBOMapping:ut,uniformBlockBinding:de,texStorage2D:Ve,texStorage3D:mt,texSubImage2D:et,texSubImage3D:ke,compressedTexSubImage2D:_e,compressedTexSubImage3D:at,scissor:ue,viewport:ze,reset:Ne}}function HWe(e,t,i,r,n,s,a){const o=n.isWebGL2,l=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new nt,h=new WeakMap;let d;const p=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(se,z){return f?new OffscreenCanvas(se,z):_b("canvas")}function m(se,z,X,ce){let Ee=1;const q=dt(se);if((q.width>ce||q.height>ce)&&(Ee=ce/Math.max(q.width,q.height)),Ee<1||z===!0)if(typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&se instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&se instanceof ImageBitmap||typeof VideoFrame<"u"&&se instanceof VideoFrame){const Ye=z?DC:Math.floor,et=Ye(Ee*q.width),ke=Ye(Ee*q.height);d===void 0&&(d=v(et,ke));const _e=X?v(et,ke):d;return _e.width=et,_e.height=ke,_e.getContext("2d").drawImage(se,0,0,et,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+q.width+"x"+q.height+") to ("+et+"x"+ke+")."),_e}else return"data"in se&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+q.width+"x"+q.height+")."),se;return se}function g(se){const z=dt(se);return az(z.width)&&az(z.height)}function y(se){return o?!1:se.wrapS!==Ws||se.wrapT!==Ws||se.minFilter!==cn&&se.minFilter!==Nr}function x(se,z){return se.generateMipmaps&&z&&se.minFilter!==cn&&se.minFilter!==Nr}function _(se){e.generateMipmap(se)}function M(se,z,X,ce,Ee=!1){if(o===!1)return z;if(se!==null){if(e[se]!==void 0)return e[se];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+se+"'")}let q=z;if(z===e.RED&&(X===e.FLOAT&&(q=e.R32F),X===e.HALF_FLOAT&&(q=e.R16F),X===e.UNSIGNED_BYTE&&(q=e.R8)),z===e.RED_INTEGER&&(X===e.UNSIGNED_BYTE&&(q=e.R8UI),X===e.UNSIGNED_SHORT&&(q=e.R16UI),X===e.UNSIGNED_INT&&(q=e.R32UI),X===e.BYTE&&(q=e.R8I),X===e.SHORT&&(q=e.R16I),X===e.INT&&(q=e.R32I)),z===e.RG&&(X===e.FLOAT&&(q=e.RG32F),X===e.HALF_FLOAT&&(q=e.RG16F),X===e.UNSIGNED_BYTE&&(q=e.RG8)),z===e.RG_INTEGER&&(X===e.UNSIGNED_BYTE&&(q=e.RG8UI),X===e.UNSIGNED_SHORT&&(q=e.RG16UI),X===e.UNSIGNED_INT&&(q=e.RG32UI),X===e.BYTE&&(q=e.RG8I),X===e.SHORT&&(q=e.RG16I),X===e.INT&&(q=e.RG32I)),z===e.RGBA){const Ye=Ee?vb:ir.getTransfer(ce);X===e.FLOAT&&(q=e.RGBA32F),X===e.HALF_FLOAT&&(q=e.RGBA16F),X===e.UNSIGNED_BYTE&&(q=Ye===xr?e.SRGB8_ALPHA8:e.RGBA8),X===e.UNSIGNED_SHORT_4_4_4_4&&(q=e.RGBA4),X===e.UNSIGNED_SHORT_5_5_5_1&&(q=e.RGB5_A1)}return(q===e.R16F||q===e.R32F||q===e.RG16F||q===e.RG32F||q===e.RGBA16F||q===e.RGBA32F)&&t.get("EXT_color_buffer_float"),q}function S(se,z,X){return x(se,X)===!0||se.isFramebufferTexture&&se.minFilter!==cn&&se.minFilter!==Nr?Math.log2(Math.max(z.width,z.height))+1:se.mipmaps!==void 0&&se.mipmaps.length>0?se.mipmaps.length:se.isCompressedTexture&&Array.isArray(se.image)?z.mipmaps.length:1}function E(se){return se===cn||se===TC||se===hf?e.NEAREST:e.LINEAR}function A(se){const z=se.target;z.removeEventListener("dispose",A),C(z),z.isVideoTexture&&h.delete(z)}function P(se){const z=se.target;z.removeEventListener("dispose",P),N(z)}function C(se){const z=r.get(se);if(z.__webglInit===void 0)return;const X=se.source,ce=p.get(X);if(ce){const Ee=ce[z.__cacheKey];Ee.usedTimes--,Ee.usedTimes===0&&D(se),Object.keys(ce).length===0&&p.delete(X)}r.remove(se)}function D(se){const z=r.get(se);e.deleteTexture(z.__webglTexture);const X=se.source,ce=p.get(X);delete ce[z.__cacheKey],a.memory.textures--}function N(se){const z=r.get(se);if(se.depthTexture&&se.depthTexture.dispose(),se.isWebGLCubeRenderTarget)for(let ce=0;ce<6;ce++){if(Array.isArray(z.__webglFramebuffer[ce]))for(let Ee=0;Ee<z.__webglFramebuffer[ce].length;Ee++)e.deleteFramebuffer(z.__webglFramebuffer[ce][Ee]);else e.deleteFramebuffer(z.__webglFramebuffer[ce]);z.__webglDepthbuffer&&e.deleteRenderbuffer(z.__webglDepthbuffer[ce])}else{if(Array.isArray(z.__webglFramebuffer))for(let ce=0;ce<z.__webglFramebuffer.length;ce++)e.deleteFramebuffer(z.__webglFramebuffer[ce]);else e.deleteFramebuffer(z.__webglFramebuffer);if(z.__webglDepthbuffer&&e.deleteRenderbuffer(z.__webglDepthbuffer),z.__webglMultisampledFramebuffer&&e.deleteFramebuffer(z.__webglMultisampledFramebuffer),z.__webglColorRenderbuffer)for(let ce=0;ce<z.__webglColorRenderbuffer.length;ce++)z.__webglColorRenderbuffer[ce]&&e.deleteRenderbuffer(z.__webglColorRenderbuffer[ce]);z.__webglDepthRenderbuffer&&e.deleteRenderbuffer(z.__webglDepthRenderbuffer)}const X=se.textures;for(let ce=0,Ee=X.length;ce<Ee;ce++){const q=r.get(X[ce]);q.__webglTexture&&(e.deleteTexture(q.__webglTexture),a.memory.textures--),r.remove(X[ce])}r.remove(se)}let U=0;function I(){U=0}function G(){const se=U;return se>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+se+" texture units while this GPU supports only "+n.maxTextures),U+=1,se}function Q(se){const z=[];return z.push(se.wrapS),z.push(se.wrapT),z.push(se.wrapR||0),z.push(se.magFilter),z.push(se.minFilter),z.push(se.anisotropy),z.push(se.internalFormat),z.push(se.format),z.push(se.type),z.push(se.generateMipmaps),z.push(se.premultiplyAlpha),z.push(se.flipY),z.push(se.unpackAlignment),z.push(se.colorSpace),z.join()}function Y(se,z){const X=r.get(se);if(se.isVideoTexture&&Be(se),se.isRenderTargetTexture===!1&&se.version>0&&X.__version!==se.version){const ce=se.image;if(ce===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ce.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ie(X,se,z);return}}i.bindTexture(e.TEXTURE_2D,X.__webglTexture,e.TEXTURE0+z)}function O(se,z){const X=r.get(se);if(se.version>0&&X.__version!==se.version){ie(X,se,z);return}i.bindTexture(e.TEXTURE_2D_ARRAY,X.__webglTexture,e.TEXTURE0+z)}function V(se,z){const X=r.get(se);if(se.version>0&&X.__version!==se.version){ie(X,se,z);return}i.bindTexture(e.TEXTURE_3D,X.__webglTexture,e.TEXTURE0+z)}function F(se,z){const X=r.get(se);if(se.version>0&&X.__version!==se.version){ye(X,se,z);return}i.bindTexture(e.TEXTURE_CUBE_MAP,X.__webglTexture,e.TEXTURE0+z)}const W={[db]:e.REPEAT,[Ws]:e.CLAMP_TO_EDGE,[pb]:e.MIRRORED_REPEAT},ee={[cn]:e.NEAREST,[TC]:e.NEAREST_MIPMAP_NEAREST,[hf]:e.NEAREST_MIPMAP_LINEAR,[Nr]:e.LINEAR,[hx]:e.LINEAR_MIPMAP_NEAREST,[Dc]:e.LINEAR_MIPMAP_LINEAR},ae={[Ene]:e.NEVER,[Lne]:e.ALWAYS,[Ane]:e.LESS,[GU]:e.LEQUAL,[Cne]:e.EQUAL,[Dne]:e.GEQUAL,[Tne]:e.GREATER,[Pne]:e.NOTEQUAL};function K(se,z,X){if(z.type===oo&&t.has("OES_texture_float_linear")===!1&&(z.magFilter===Nr||z.magFilter===hx||z.magFilter===hf||z.magFilter===Dc||z.minFilter===Nr||z.minFilter===hx||z.minFilter===hf||z.minFilter===Dc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),X?(e.texParameteri(se,e.TEXTURE_WRAP_S,W[z.wrapS]),e.texParameteri(se,e.TEXTURE_WRAP_T,W[z.wrapT]),(se===e.TEXTURE_3D||se===e.TEXTURE_2D_ARRAY)&&e.texParameteri(se,e.TEXTURE_WRAP_R,W[z.wrapR]),e.texParameteri(se,e.TEXTURE_MAG_FILTER,ee[z.magFilter]),e.texParameteri(se,e.TEXTURE_MIN_FILTER,ee[z.minFilter])):(e.texParameteri(se,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(se,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(se===e.TEXTURE_3D||se===e.TEXTURE_2D_ARRAY)&&e.texParameteri(se,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),(z.wrapS!==Ws||z.wrapT!==Ws)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(se,e.TEXTURE_MAG_FILTER,E(z.magFilter)),e.texParameteri(se,e.TEXTURE_MIN_FILTER,E(z.minFilter)),z.minFilter!==cn&&z.minFilter!==Nr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),z.compareFunction&&(e.texParameteri(se,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(se,e.TEXTURE_COMPARE_FUNC,ae[z.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(z.magFilter===cn||z.minFilter!==hf&&z.minFilter!==Dc||z.type===oo&&t.has("OES_texture_float_linear")===!1||o===!1&&z.type===g0&&t.has("OES_texture_half_float_linear")===!1)return;if(z.anisotropy>1||r.get(z).__currentAnisotropy){const ce=t.get("EXT_texture_filter_anisotropic");e.texParameterf(se,ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,n.getMaxAnisotropy())),r.get(z).__currentAnisotropy=z.anisotropy}}}function $(se,z){let X=!1;se.__webglInit===void 0&&(se.__webglInit=!0,z.addEventListener("dispose",A));const ce=z.source;let Ee=p.get(ce);Ee===void 0&&(Ee={},p.set(ce,Ee));const q=Q(z);if(q!==se.__cacheKey){Ee[q]===void 0&&(Ee[q]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,X=!0),Ee[q].usedTimes++;const Ye=Ee[se.__cacheKey];Ye!==void 0&&(Ee[se.__cacheKey].usedTimes--,Ye.usedTimes===0&&D(z)),se.__cacheKey=q,se.__webglTexture=Ee[q].texture}return X}function ie(se,z,X){let ce=e.TEXTURE_2D;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(ce=e.TEXTURE_2D_ARRAY),z.isData3DTexture&&(ce=e.TEXTURE_3D);const Ee=$(se,z),q=z.source;i.bindTexture(ce,se.__webglTexture,e.TEXTURE0+X);const Ye=r.get(q);if(q.version!==Ye.__version||Ee===!0){i.activeTexture(e.TEXTURE0+X);const et=ir.getPrimaries(ir.workingColorSpace),ke=z.colorSpace===zu?null:ir.getPrimaries(z.colorSpace),_e=z.colorSpace===zu||et===ke?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,z.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,z.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,_e);const at=y(z)&&g(z.image)===!1;let Ve=m(z.image,at,!1,n.maxTextureSize);Ve=Fe(z,Ve);const mt=g(Ve)||o,pt=s.convert(z.format,z.colorSpace);let st=s.convert(z.type),ue=M(z.internalFormat,pt,st,z.colorSpace,z.isVideoTexture);K(ce,z,mt);let ze;const ut=z.mipmaps,de=o&&z.isVideoTexture!==!0&&ue!==jU,Ne=Ye.__version===void 0||Ee===!0,oe=q.dataReady,He=S(z,Ve,mt);if(z.isDepthTexture)ue=e.DEPTH_COMPONENT,o?z.type===oo?ue=e.DEPTH_COMPONENT32F:z.type===Xu?ue=e.DEPTH_COMPONENT24:z.type===Vd?ue=e.DEPTH24_STENCIL8:ue=e.DEPTH_COMPONENT16:z.type===oo&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),z.format===jd&&ue===e.DEPTH_COMPONENT&&z.type!==jT&&z.type!==Xu&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),z.type=Xu,st=s.convert(z.type)),z.format===nm&&ue===e.DEPTH_COMPONENT&&(ue=e.DEPTH_STENCIL,z.type!==Vd&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),z.type=Vd,st=s.convert(z.type))),Ne&&(de?i.texStorage2D(e.TEXTURE_2D,1,ue,Ve.width,Ve.height):i.texImage2D(e.TEXTURE_2D,0,ue,Ve.width,Ve.height,0,pt,st,null));else if(z.isDataTexture)if(ut.length>0&&mt){de&&Ne&&i.texStorage2D(e.TEXTURE_2D,He,ue,ut[0].width,ut[0].height);for(let Ae=0,tt=ut.length;Ae<tt;Ae++)ze=ut[Ae],de?oe&&i.texSubImage2D(e.TEXTURE_2D,Ae,0,0,ze.width,ze.height,pt,st,ze.data):i.texImage2D(e.TEXTURE_2D,Ae,ue,ze.width,ze.height,0,pt,st,ze.data);z.generateMipmaps=!1}else de?(Ne&&i.texStorage2D(e.TEXTURE_2D,He,ue,Ve.width,Ve.height),oe&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,Ve.width,Ve.height,pt,st,Ve.data)):i.texImage2D(e.TEXTURE_2D,0,ue,Ve.width,Ve.height,0,pt,st,Ve.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){de&&Ne&&i.texStorage3D(e.TEXTURE_2D_ARRAY,He,ue,ut[0].width,ut[0].height,Ve.depth);for(let Ae=0,tt=ut.length;Ae<tt;Ae++)ze=ut[Ae],z.format!==fa?pt!==null?de?oe&&i.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,Ae,0,0,0,ze.width,ze.height,Ve.depth,pt,ze.data,0,0):i.compressedTexImage3D(e.TEXTURE_2D_ARRAY,Ae,ue,ze.width,ze.height,Ve.depth,0,ze.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):de?oe&&i.texSubImage3D(e.TEXTURE_2D_ARRAY,Ae,0,0,0,ze.width,ze.height,Ve.depth,pt,st,ze.data):i.texImage3D(e.TEXTURE_2D_ARRAY,Ae,ue,ze.width,ze.height,Ve.depth,0,pt,st,ze.data)}else{de&&Ne&&i.texStorage2D(e.TEXTURE_2D,He,ue,ut[0].width,ut[0].height);for(let Ae=0,tt=ut.length;Ae<tt;Ae++)ze=ut[Ae],z.format!==fa?pt!==null?de?oe&&i.compressedTexSubImage2D(e.TEXTURE_2D,Ae,0,0,ze.width,ze.height,pt,ze.data):i.compressedTexImage2D(e.TEXTURE_2D,Ae,ue,ze.width,ze.height,0,ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):de?oe&&i.texSubImage2D(e.TEXTURE_2D,Ae,0,0,ze.width,ze.height,pt,st,ze.data):i.texImage2D(e.TEXTURE_2D,Ae,ue,ze.width,ze.height,0,pt,st,ze.data)}else if(z.isDataArrayTexture)de?(Ne&&i.texStorage3D(e.TEXTURE_2D_ARRAY,He,ue,Ve.width,Ve.height,Ve.depth),oe&&i.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,Ve.width,Ve.height,Ve.depth,pt,st,Ve.data)):i.texImage3D(e.TEXTURE_2D_ARRAY,0,ue,Ve.width,Ve.height,Ve.depth,0,pt,st,Ve.data);else if(z.isData3DTexture)de?(Ne&&i.texStorage3D(e.TEXTURE_3D,He,ue,Ve.width,Ve.height,Ve.depth),oe&&i.texSubImage3D(e.TEXTURE_3D,0,0,0,0,Ve.width,Ve.height,Ve.depth,pt,st,Ve.data)):i.texImage3D(e.TEXTURE_3D,0,ue,Ve.width,Ve.height,Ve.depth,0,pt,st,Ve.data);else if(z.isFramebufferTexture){if(Ne)if(de)i.texStorage2D(e.TEXTURE_2D,He,ue,Ve.width,Ve.height);else{let Ae=Ve.width,tt=Ve.height;for(let ct=0;ct<He;ct++)i.texImage2D(e.TEXTURE_2D,ct,ue,Ae,tt,0,pt,st,null),Ae>>=1,tt>>=1}}else if(ut.length>0&&mt){if(de&&Ne){const Ae=dt(ut[0]);i.texStorage2D(e.TEXTURE_2D,He,ue,Ae.width,Ae.height)}for(let Ae=0,tt=ut.length;Ae<tt;Ae++)ze=ut[Ae],de?oe&&i.texSubImage2D(e.TEXTURE_2D,Ae,0,0,pt,st,ze):i.texImage2D(e.TEXTURE_2D,Ae,ue,pt,st,ze);z.generateMipmaps=!1}else if(de){if(Ne){const Ae=dt(Ve);i.texStorage2D(e.TEXTURE_2D,He,ue,Ae.width,Ae.height)}oe&&i.texSubImage2D(e.TEXTURE_2D,0,0,0,pt,st,Ve)}else i.texImage2D(e.TEXTURE_2D,0,ue,pt,st,Ve);x(z,mt)&&_(ce),Ye.__version=q.version,z.onUpdate&&z.onUpdate(z)}se.__version=z.version}function ye(se,z,X){if(z.image.length!==6)return;const ce=$(se,z),Ee=z.source;i.bindTexture(e.TEXTURE_CUBE_MAP,se.__webglTexture,e.TEXTURE0+X);const q=r.get(Ee);if(Ee.version!==q.__version||ce===!0){i.activeTexture(e.TEXTURE0+X);const Ye=ir.getPrimaries(ir.workingColorSpace),et=z.colorSpace===zu?null:ir.getPrimaries(z.colorSpace),ke=z.colorSpace===zu||Ye===et?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,z.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,z.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,ke);const _e=z.isCompressedTexture||z.image[0].isCompressedTexture,at=z.image[0]&&z.image[0].isDataTexture,Ve=[];for(let Ae=0;Ae<6;Ae++)!_e&&!at?Ve[Ae]=m(z.image[Ae],!1,!0,n.maxCubemapSize):Ve[Ae]=at?z.image[Ae].image:z.image[Ae],Ve[Ae]=Fe(z,Ve[Ae]);const mt=Ve[0],pt=g(mt)||o,st=s.convert(z.format,z.colorSpace),ue=s.convert(z.type),ze=M(z.internalFormat,st,ue,z.colorSpace),ut=o&&z.isVideoTexture!==!0,de=q.__version===void 0||ce===!0,Ne=Ee.dataReady;let oe=S(z,mt,pt);K(e.TEXTURE_CUBE_MAP,z,pt);let He;if(_e){ut&&de&&i.texStorage2D(e.TEXTURE_CUBE_MAP,oe,ze,mt.width,mt.height);for(let Ae=0;Ae<6;Ae++){He=Ve[Ae].mipmaps;for(let tt=0;tt<He.length;tt++){const ct=He[tt];z.format!==fa?st!==null?ut?Ne&&i.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt,0,0,ct.width,ct.height,st,ct.data):i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt,ze,ct.width,ct.height,0,ct.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ut?Ne&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt,0,0,ct.width,ct.height,st,ue,ct.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt,ze,ct.width,ct.height,0,st,ue,ct.data)}}}else{if(He=z.mipmaps,ut&&de){He.length>0&&oe++;const Ae=dt(Ve[0]);i.texStorage2D(e.TEXTURE_CUBE_MAP,oe,ze,Ae.width,Ae.height)}for(let Ae=0;Ae<6;Ae++)if(at){ut?Ne&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,0,0,Ve[Ae].width,Ve[Ae].height,st,ue,Ve[Ae].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,ze,Ve[Ae].width,Ve[Ae].height,0,st,ue,Ve[Ae].data);for(let tt=0;tt<He.length;tt++){const Dt=He[tt].image[Ae].image;ut?Ne&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt+1,0,0,Dt.width,Dt.height,st,ue,Dt.data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt+1,ze,Dt.width,Dt.height,0,st,ue,Dt.data)}}else{ut?Ne&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,0,0,st,ue,Ve[Ae]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,ze,st,ue,Ve[Ae]);for(let tt=0;tt<He.length;tt++){const ct=He[tt];ut?Ne&&i.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt+1,0,0,st,ue,ct.image[Ae]):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,tt+1,ze,st,ue,ct.image[Ae])}}}x(z,pt)&&_(e.TEXTURE_CUBE_MAP),q.__version=Ee.version,z.onUpdate&&z.onUpdate(z)}se.__version=z.version}function pe(se,z,X,ce,Ee,q){const Ye=s.convert(X.format,X.colorSpace),et=s.convert(X.type),ke=M(X.internalFormat,Ye,et,X.colorSpace);if(!r.get(z).__hasExternalTextures){const at=Math.max(1,z.width>>q),Ve=Math.max(1,z.height>>q);Ee===e.TEXTURE_3D||Ee===e.TEXTURE_2D_ARRAY?i.texImage3D(Ee,q,ke,at,Ve,z.depth,0,Ye,et,null):i.texImage2D(Ee,q,ke,at,Ve,0,Ye,et,null)}i.bindFramebuffer(e.FRAMEBUFFER,se),Xe(z)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,ce,Ee,r.get(X).__webglTexture,0,Re(z)):(Ee===e.TEXTURE_2D||Ee>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&Ee<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,ce,Ee,r.get(X).__webglTexture,q),i.bindFramebuffer(e.FRAMEBUFFER,null)}function me(se,z,X){if(e.bindRenderbuffer(e.RENDERBUFFER,se),z.depthBuffer&&!z.stencilBuffer){let ce=o===!0?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(X||Xe(z)){const Ee=z.depthTexture;Ee&&Ee.isDepthTexture&&(Ee.type===oo?ce=e.DEPTH_COMPONENT32F:Ee.type===Xu&&(ce=e.DEPTH_COMPONENT24));const q=Re(z);Xe(z)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,q,ce,z.width,z.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,q,ce,z.width,z.height)}else e.renderbufferStorage(e.RENDERBUFFER,ce,z.width,z.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,se)}else if(z.depthBuffer&&z.stencilBuffer){const ce=Re(z);X&&Xe(z)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,ce,e.DEPTH24_STENCIL8,z.width,z.height):Xe(z)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,ce,e.DEPTH24_STENCIL8,z.width,z.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,z.width,z.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,se)}else{const ce=z.textures;for(let Ee=0;Ee<ce.length;Ee++){const q=ce[Ee],Ye=s.convert(q.format,q.colorSpace),et=s.convert(q.type),ke=M(q.internalFormat,Ye,et,q.colorSpace),_e=Re(z);X&&Xe(z)===!1?e.renderbufferStorageMultisample(e.RENDERBUFFER,_e,ke,z.width,z.height):Xe(z)?l.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,_e,ke,z.width,z.height):e.renderbufferStorage(e.RENDERBUFFER,ke,z.width,z.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function ge(se,z){if(z&&z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(e.FRAMEBUFFER,se),!(z.depthTexture&&z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(z.depthTexture).__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),Y(z.depthTexture,0);const ce=r.get(z.depthTexture).__webglTexture,Ee=Re(z);if(z.depthTexture.format===jd)Xe(z)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,ce,0,Ee):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,ce,0);else if(z.depthTexture.format===nm)Xe(z)?l.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,ce,0,Ee):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,ce,0);else throw new Error("Unknown depthTexture format")}function xe(se){const z=r.get(se),X=se.isWebGLCubeRenderTarget===!0;if(se.depthTexture&&!z.__autoAllocateDepthBuffer){if(X)throw new Error("target.depthTexture not supported in Cube render targets");ge(z.__webglFramebuffer,se)}else if(X){z.__webglDepthbuffer=[];for(let ce=0;ce<6;ce++)i.bindFramebuffer(e.FRAMEBUFFER,z.__webglFramebuffer[ce]),z.__webglDepthbuffer[ce]=e.createRenderbuffer(),me(z.__webglDepthbuffer[ce],se,!1)}else i.bindFramebuffer(e.FRAMEBUFFER,z.__webglFramebuffer),z.__webglDepthbuffer=e.createRenderbuffer(),me(z.__webglDepthbuffer,se,!1);i.bindFramebuffer(e.FRAMEBUFFER,null)}function te(se,z,X){const ce=r.get(se);z!==void 0&&pe(ce.__webglFramebuffer,se,se.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),X!==void 0&&xe(se)}function we(se){const z=se.texture,X=r.get(se),ce=r.get(z);se.addEventListener("dispose",P);const Ee=se.textures,q=se.isWebGLCubeRenderTarget===!0,Ye=Ee.length>1,et=g(se)||o;if(Ye||(ce.__webglTexture===void 0&&(ce.__webglTexture=e.createTexture()),ce.__version=z.version,a.memory.textures++),q){X.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)if(o&&z.mipmaps&&z.mipmaps.length>0){X.__webglFramebuffer[ke]=[];for(let _e=0;_e<z.mipmaps.length;_e++)X.__webglFramebuffer[ke][_e]=e.createFramebuffer()}else X.__webglFramebuffer[ke]=e.createFramebuffer()}else{if(o&&z.mipmaps&&z.mipmaps.length>0){X.__webglFramebuffer=[];for(let ke=0;ke<z.mipmaps.length;ke++)X.__webglFramebuffer[ke]=e.createFramebuffer()}else X.__webglFramebuffer=e.createFramebuffer();if(Ye)if(n.drawBuffers)for(let ke=0,_e=Ee.length;ke<_e;ke++){const at=r.get(Ee[ke]);at.__webglTexture===void 0&&(at.__webglTexture=e.createTexture(),a.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&se.samples>0&&Xe(se)===!1){X.__webglMultisampledFramebuffer=e.createFramebuffer(),X.__webglColorRenderbuffer=[],i.bindFramebuffer(e.FRAMEBUFFER,X.__webglMultisampledFramebuffer);for(let ke=0;ke<Ee.length;ke++){const _e=Ee[ke];X.__webglColorRenderbuffer[ke]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,X.__webglColorRenderbuffer[ke]);const at=s.convert(_e.format,_e.colorSpace),Ve=s.convert(_e.type),mt=M(_e.internalFormat,at,Ve,_e.colorSpace,se.isXRRenderTarget===!0),pt=Re(se);e.renderbufferStorageMultisample(e.RENDERBUFFER,pt,mt,se.width,se.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+ke,e.RENDERBUFFER,X.__webglColorRenderbuffer[ke])}e.bindRenderbuffer(e.RENDERBUFFER,null),se.depthBuffer&&(X.__webglDepthRenderbuffer=e.createRenderbuffer(),me(X.__webglDepthRenderbuffer,se,!0)),i.bindFramebuffer(e.FRAMEBUFFER,null)}}if(q){i.bindTexture(e.TEXTURE_CUBE_MAP,ce.__webglTexture),K(e.TEXTURE_CUBE_MAP,z,et);for(let ke=0;ke<6;ke++)if(o&&z.mipmaps&&z.mipmaps.length>0)for(let _e=0;_e<z.mipmaps.length;_e++)pe(X.__webglFramebuffer[ke][_e],se,z,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+ke,_e);else pe(X.__webglFramebuffer[ke],se,z,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0);x(z,et)&&_(e.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(Ye){for(let ke=0,_e=Ee.length;ke<_e;ke++){const at=Ee[ke],Ve=r.get(at);i.bindTexture(e.TEXTURE_2D,Ve.__webglTexture),K(e.TEXTURE_2D,at,et),pe(X.__webglFramebuffer,se,at,e.COLOR_ATTACHMENT0+ke,e.TEXTURE_2D,0),x(at,et)&&_(e.TEXTURE_2D)}i.unbindTexture()}else{let ke=e.TEXTURE_2D;if((se.isWebGL3DRenderTarget||se.isWebGLArrayRenderTarget)&&(o?ke=se.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(ke,ce.__webglTexture),K(ke,z,et),o&&z.mipmaps&&z.mipmaps.length>0)for(let _e=0;_e<z.mipmaps.length;_e++)pe(X.__webglFramebuffer[_e],se,z,e.COLOR_ATTACHMENT0,ke,_e);else pe(X.__webglFramebuffer,se,z,e.COLOR_ATTACHMENT0,ke,0);x(z,et)&&_(ke),i.unbindTexture()}se.depthBuffer&&xe(se)}function Ce(se){const z=g(se)||o,X=se.textures;for(let ce=0,Ee=X.length;ce<Ee;ce++){const q=X[ce];if(x(q,z)){const Ye=se.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,et=r.get(q).__webglTexture;i.bindTexture(Ye,et),_(Ye),i.unbindTexture()}}}function Se(se){if(o&&se.samples>0&&Xe(se)===!1){const z=se.textures,X=se.width,ce=se.height;let Ee=e.COLOR_BUFFER_BIT;const q=[],Ye=se.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,et=r.get(se),ke=z.length>1;if(ke)for(let _e=0;_e<z.length;_e++)i.bindFramebuffer(e.FRAMEBUFFER,et.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+_e,e.RENDERBUFFER,null),i.bindFramebuffer(e.FRAMEBUFFER,et.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+_e,e.TEXTURE_2D,null,0);i.bindFramebuffer(e.READ_FRAMEBUFFER,et.__webglMultisampledFramebuffer),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,et.__webglFramebuffer);for(let _e=0;_e<z.length;_e++){q.push(e.COLOR_ATTACHMENT0+_e),se.depthBuffer&&q.push(Ye);const at=et.__ignoreDepthValues!==void 0?et.__ignoreDepthValues:!1;if(at===!1&&(se.depthBuffer&&(Ee|=e.DEPTH_BUFFER_BIT),se.stencilBuffer&&(Ee|=e.STENCIL_BUFFER_BIT)),ke&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,et.__webglColorRenderbuffer[_e]),at===!0&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[Ye]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[Ye])),ke){const Ve=r.get(z[_e]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,Ve,0)}e.blitFramebuffer(0,0,X,ce,0,0,X,ce,Ee,e.NEAREST),c&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,q)}if(i.bindFramebuffer(e.READ_FRAMEBUFFER,null),i.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),ke)for(let _e=0;_e<z.length;_e++){i.bindFramebuffer(e.FRAMEBUFFER,et.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+_e,e.RENDERBUFFER,et.__webglColorRenderbuffer[_e]);const at=r.get(z[_e]).__webglTexture;i.bindFramebuffer(e.FRAMEBUFFER,et.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+_e,e.TEXTURE_2D,at,0)}i.bindFramebuffer(e.DRAW_FRAMEBUFFER,et.__webglMultisampledFramebuffer)}}function Re(se){return Math.min(n.maxSamples,se.samples)}function Xe(se){const z=r.get(se);return o&&se.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&z.__useRenderToTexture!==!1}function Be(se){const z=a.render.frame;h.get(se)!==z&&(h.set(se,z),se.update())}function Fe(se,z){const X=se.colorSpace,ce=se.format,Ee=se.type;return se.isCompressedTexture===!0||se.isVideoTexture===!0||se.format===PC||X!==vh&&X!==zu&&(ir.getTransfer(X)===xr?o===!1?t.has("EXT_sRGB")===!0&&ce===fa?(se.format=PC,se.minFilter=Nr,se.generateMipmaps=!1):z=XU.sRGBToLinear(z):(ce!==fa||Ee!==Vc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",X)),z}function dt(se){return typeof HTMLImageElement<"u"&&se instanceof HTMLImageElement?(u.width=se.naturalWidth||se.width,u.height=se.naturalHeight||se.height):typeof VideoFrame<"u"&&se instanceof VideoFrame?(u.width=se.displayWidth,u.height=se.displayHeight):(u.width=se.width,u.height=se.height),u}this.allocateTextureUnit=G,this.resetTextureUnits=I,this.setTexture2D=Y,this.setTexture2DArray=O,this.setTexture3D=V,this.setTextureCube=F,this.rebindTextures=te,this.setupRenderTarget=we,this.updateRenderTargetMipmap=Ce,this.updateMultisampleRenderTarget=Se,this.setupDepthRenderbuffer=xe,this.setupFrameBufferTexture=pe,this.useMultisampledRTT=Xe}function qne(e,t,i){const r=i.isWebGL2;function n(s,a=zu){let o;const l=ir.getTransfer(a);if(s===Vc)return e.UNSIGNED_BYTE;if(s===zU)return e.UNSIGNED_SHORT_4_4_4_4;if(s===BU)return e.UNSIGNED_SHORT_5_5_5_1;if(s===dne)return e.BYTE;if(s===pne)return e.SHORT;if(s===jT)return e.UNSIGNED_SHORT;if(s===NU)return e.INT;if(s===Xu)return e.UNSIGNED_INT;if(s===oo)return e.FLOAT;if(s===g0)return r?e.HALF_FLOAT:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===fne)return e.ALPHA;if(s===fa)return e.RGBA;if(s===mne)return e.LUMINANCE;if(s===gne)return e.LUMINANCE_ALPHA;if(s===jd)return e.DEPTH_COMPONENT;if(s===nm)return e.DEPTH_STENCIL;if(s===PC)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===kU)return e.RED;if(s===UU)return e.RED_INTEGER;if(s===vne)return e.RG;if(s===FU)return e.RG_INTEGER;if(s===VU)return e.RGBA_INTEGER;if(s===RE||s===IE||s===OE||s===NE)if(l===xr)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===RE)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===IE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===OE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===NE)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===RE)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===IE)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===OE)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===NE)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===IN||s===ON||s===NN||s===zN)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===IN)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===ON)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===NN)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===zN)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===jU)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===BN||s===kN)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===BN)return l===xr?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===kN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===UN||s===FN||s===VN||s===jN||s===HN||s===GN||s===WN||s===XN||s===qN||s===YN||s===ZN||s===QN||s===KN||s===JN)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===UN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===FN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===VN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===jN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===HN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===GN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===WN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===XN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===qN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===YN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===ZN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===QN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===KN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===JN)return l===xr?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===zE||s===$N||s===ez)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===zE)return l===xr?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===$N)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===ez)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===yne||s===tz||s===iz||s===rz)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===zE)return o.COMPRESSED_RED_RGTC1_EXT;if(s===tz)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===iz)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===rz)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Vd?r?e.UNSIGNED_INT_24_8:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:n}}class Yne extends hn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class wv extends Zi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const GWe={type:"move"};class IL{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new wv,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new wv,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new he,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new he),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new wv,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new he,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new he),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const i=this._hand;if(i)for(const r of t.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(t&&i.session.visibilityState!=="visible-blurred"){if(c&&t.hand){a=!0;for(const v of t.hand.values()){const m=i.getJointPose(v,r),g=this._getHandJoint(c,v);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=m.radius),g.visible=m!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=i.getPose(t.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(t.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(GWe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(t,i){if(t.joints[i.jointName]===void 0){const r=new wv;r.matrixAutoUpdate=!1,r.visible=!1,t.joints[i.jointName]=r,t.add(r)}return t.joints[i.jointName]}}const WWe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,XWe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepthEXT = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class qWe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,i,r){if(this.texture===null){const n=new en,s=t.properties.get(n);s.__webglTexture=i.texture,(i.depthNear!=r.depthNear||i.depthFar!=r.depthFar)&&(this.depthNear=i.depthNear,this.depthFar=i.depthFar),this.texture=n}}render(t,i){if(this.texture!==null){if(this.mesh===null){const r=i.cameras[0].viewport,n=new sl({extensions:{fragDepth:!0},vertexShader:WWe,fragmentShader:XWe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:r.z},depthHeight:{value:r.w}}});this.mesh=new An(new W0(20,20),n)}t.render(this.mesh,i)}}reset(){this.texture=null,this.mesh=null}}class YWe extends yh{constructor(t,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,p=null,f=null;const v=new qWe,m=i.getContextAttributes();let g=null,y=null;const x=[],_=[],M=new nt;let S=null;const E=new hn;E.layers.enable(1),E.viewport=new nr;const A=new hn;A.layers.enable(2),A.viewport=new nr;const P=[E,A],C=new Yne;C.layers.enable(1),C.layers.enable(2);let D=null,N=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let $=x[K];return $===void 0&&($=new IL,x[K]=$),$.getTargetRaySpace()},this.getControllerGrip=function(K){let $=x[K];return $===void 0&&($=new IL,x[K]=$),$.getGripSpace()},this.getHand=function(K){let $=x[K];return $===void 0&&($=new IL,x[K]=$),$.getHandSpace()};function U(K){const $=_.indexOf(K.inputSource);if($===-1)return;const ie=x[$];ie!==void 0&&(ie.update(K.inputSource,K.frame,c||a),ie.dispatchEvent({type:K.type,data:K.inputSource}))}function I(){n.removeEventListener("select",U),n.removeEventListener("selectstart",U),n.removeEventListener("selectend",U),n.removeEventListener("squeeze",U),n.removeEventListener("squeezestart",U),n.removeEventListener("squeezeend",U),n.removeEventListener("end",I),n.removeEventListener("inputsourceschange",G);for(let K=0;K<x.length;K++){const $=_[K];$!==null&&(_[K]=null,x[K].disconnect($))}D=null,N=null,v.reset(),t.setRenderTarget(g),p=null,d=null,h=null,n=null,y=null,ae.stop(),r.isPresenting=!1,t.setPixelRatio(S),t.setSize(M.width,M.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){s=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){o=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(K){c=K},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return h},this.getFrame=function(){return f},this.getSession=function(){return n},this.setSession=async function(K){if(n=K,n!==null){if(g=t.getRenderTarget(),n.addEventListener("select",U),n.addEventListener("selectstart",U),n.addEventListener("selectend",U),n.addEventListener("squeeze",U),n.addEventListener("squeezestart",U),n.addEventListener("squeezeend",U),n.addEventListener("end",I),n.addEventListener("inputsourceschange",G),m.xrCompatible!==!0&&await i.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(M),n.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const $={antialias:n.renderState.layers===void 0?m.antialias:!0,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(n,i,$),n.updateRenderState({baseLayer:p}),t.setPixelRatio(1),t.setSize(p.framebufferWidth,p.framebufferHeight,!1),y=new Wl(p.framebufferWidth,p.framebufferHeight,{format:fa,type:Vc,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let $=null,ie=null,ye=null;m.depth&&(ye=m.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,$=m.stencil?nm:jd,ie=m.stencil?Vd:Xu);const pe={colorFormat:i.RGBA8,depthFormat:ye,scaleFactor:s};h=new XRWebGLBinding(n,i),d=h.createProjectionLayer(pe),n.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),y=new Wl(d.textureWidth,d.textureHeight,{format:fa,type:Vc,depthTexture:new KU(d.textureWidth,d.textureHeight,ie,void 0,void 0,void 0,void 0,void 0,void 0,$),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0});const me=t.properties.get(y);me.__ignoreDepthValues=d.ignoreDepthValues}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),ae.setContext(n),ae.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function G(K){for(let $=0;$<K.removed.length;$++){const ie=K.removed[$],ye=_.indexOf(ie);ye>=0&&(_[ye]=null,x[ye].disconnect(ie))}for(let $=0;$<K.added.length;$++){const ie=K.added[$];let ye=_.indexOf(ie);if(ye===-1){for(let me=0;me<x.length;me++)if(me>=_.length){_.push(ie),ye=me;break}else if(_[me]===null){_[me]=ie,ye=me;break}if(ye===-1)break}const pe=x[ye];pe&&pe.connect(ie)}}const Q=new he,Y=new he;function O(K,$,ie){Q.setFromMatrixPosition($.matrixWorld),Y.setFromMatrixPosition(ie.matrixWorld);const ye=Q.distanceTo(Y),pe=$.projectionMatrix.elements,me=ie.projectionMatrix.elements,ge=pe[14]/(pe[10]-1),xe=pe[14]/(pe[10]+1),te=(pe[9]+1)/pe[5],we=(pe[9]-1)/pe[5],Ce=(pe[8]-1)/pe[0],Se=(me[8]+1)/me[0],Re=ge*Ce,Xe=ge*Se,Be=ye/(-Ce+Se),Fe=Be*-Ce;$.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(Fe),K.translateZ(Be),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert();const dt=ge+Be,se=xe+Be,z=Re-Fe,X=Xe+(ye-Fe),ce=te*xe/se*dt,Ee=we*xe/se*dt;K.projectionMatrix.makePerspective(z,X,ce,Ee,dt,se),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}function V(K,$){$===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices($.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(n===null)return;v.texture!==null&&(K.near=v.depthNear,K.far=v.depthFar),C.near=A.near=E.near=K.near,C.far=A.far=E.far=K.far,(D!==C.near||N!==C.far)&&(n.updateRenderState({depthNear:C.near,depthFar:C.far}),D=C.near,N=C.far,E.near=D,E.far=N,A.near=D,A.far=N,E.updateProjectionMatrix(),A.updateProjectionMatrix(),K.updateProjectionMatrix());const $=K.parent,ie=C.cameras;V(C,$);for(let ye=0;ye<ie.length;ye++)V(ie[ye],$);ie.length===2?O(C,E,A):C.projectionMatrix.copy(E.projectionMatrix),F(K,C,$)};function F(K,$,ie){ie===null?K.matrix.copy($.matrixWorld):(K.matrix.copy(ie.matrixWorld),K.matrix.invert(),K.matrix.multiply($.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy($.projectionMatrix),K.projectionMatrixInverse.copy($.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=v0*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return C},this.getFoveation=function(){if(!(d===null&&p===null))return l},this.setFoveation=function(K){l=K,d!==null&&(d.fixedFoveation=K),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=K)},this.hasDepthSensing=function(){return v.texture!==null};let W=null;function ee(K,$){if(u=$.getViewerPose(c||a),f=$,u!==null){const ie=u.views;p!==null&&(t.setRenderTargetFramebuffer(y,p.framebuffer),t.setRenderTarget(y));let ye=!1;ie.length!==C.cameras.length&&(C.cameras.length=0,ye=!0);for(let me=0;me<ie.length;me++){const ge=ie[me];let xe=null;if(p!==null)xe=p.getViewport(ge);else{const we=h.getViewSubImage(d,ge);xe=we.viewport,me===0&&(t.setRenderTargetTextures(y,we.colorTexture,d.ignoreDepthValues?void 0:we.depthStencilTexture),t.setRenderTarget(y))}let te=P[me];te===void 0&&(te=new hn,te.layers.enable(me),te.viewport=new nr,P[me]=te),te.matrix.fromArray(ge.transform.matrix),te.matrix.decompose(te.position,te.quaternion,te.scale),te.projectionMatrix.fromArray(ge.projectionMatrix),te.projectionMatrixInverse.copy(te.projectionMatrix).invert(),te.viewport.set(xe.x,xe.y,xe.width,xe.height),me===0&&(C.matrix.copy(te.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale)),ye===!0&&C.cameras.push(te)}const pe=n.enabledFeatures;if(pe&&pe.includes("depth-sensing")){const me=h.getDepthInformation(ie[0]);me&&me.isValid&&me.texture&&v.init(t,me,n.renderState)}}for(let ie=0;ie<x.length;ie++){const ye=_[ie],pe=x[ie];ye!==null&&pe!==void 0&&pe.update(ye,$,c||a)}v.render(t,C),W&&W(K,$),$.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:$}),f=null}const ae=new Vne;ae.setAnimationLoop(ee),this.setAnimationLoop=function(K){W=K},this.dispose=function(){}}}const kp=new yo,ZWe=new ui;function QWe(e,t){function i(m,g){m.matrixAutoUpdate===!0&&m.updateMatrix(),g.value.copy(m.matrix)}function r(m,g){g.color.getRGB(m.fogColor.value,Bne(e)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function n(m,g,y,x,_){g.isMeshBasicMaterial||g.isMeshLambertMaterial?s(m,g):g.isMeshToonMaterial?(s(m,g),h(m,g)):g.isMeshPhongMaterial?(s(m,g),u(m,g)):g.isMeshStandardMaterial?(s(m,g),d(m,g),g.isMeshPhysicalMaterial&&p(m,g,_)):g.isMeshMatcapMaterial?(s(m,g),f(m,g)):g.isMeshDepthMaterial?s(m,g):g.isMeshDistanceMaterial?(s(m,g),v(m,g)):g.isMeshNormalMaterial?s(m,g):g.isLineBasicMaterial?(a(m,g),g.isLineDashedMaterial&&o(m,g)):g.isPointsMaterial?l(m,g,y,x):g.isSpriteMaterial?c(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function s(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map,i(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,i(g.alphaMap,m.alphaMapTransform)),g.bumpMap&&(m.bumpMap.value=g.bumpMap,i(g.bumpMap,m.bumpMapTransform),m.bumpScale.value=g.bumpScale,g.side===xa&&(m.bumpScale.value*=-1)),g.normalMap&&(m.normalMap.value=g.normalMap,i(g.normalMap,m.normalMapTransform),m.normalScale.value.copy(g.normalScale),g.side===xa&&m.normalScale.value.negate()),g.displacementMap&&(m.displacementMap.value=g.displacementMap,i(g.displacementMap,m.displacementMapTransform),m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap,i(g.emissiveMap,m.emissiveMapTransform)),g.specularMap&&(m.specularMap.value=g.specularMap,i(g.specularMap,m.specularMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const y=t.get(g),x=y.envMap,_=y.envMapRotation;if(x&&(m.envMap.value=x,kp.copy(_),kp.x*=-1,kp.y*=-1,kp.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(kp.y*=-1,kp.z*=-1),m.envMapRotation.value.setFromMatrix4(ZWe.makeRotationFromEuler(kp)),m.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;const M=e._useLegacyLights===!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*M,i(g.lightMap,m.lightMapTransform)}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity,i(g.aoMap,m.aoMapTransform))}function a(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,g.map&&(m.map.value=g.map,i(g.map,m.mapTransform))}function o(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function l(m,g,y,x){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*y,m.scale.value=x*.5,g.map&&(m.map.value=g.map,i(g.map,m.uvTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,i(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}function c(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map,i(g.map,m.mapTransform)),g.alphaMap&&(m.alphaMap.value=g.alphaMap,i(g.alphaMap,m.alphaMapTransform)),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest)}function u(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function h(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function d(m,g){m.metalness.value=g.metalness,g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap,i(g.metalnessMap,m.metalnessMapTransform)),m.roughness.value=g.roughness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap,i(g.roughnessMap,m.roughnessMapTransform)),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function p(m,g,y){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap,i(g.sheenColorMap,m.sheenColorMapTransform)),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap,i(g.sheenRoughnessMap,m.sheenRoughnessMapTransform))),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap,i(g.clearcoatMap,m.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,i(g.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(m.clearcoatNormalMap.value=g.clearcoatNormalMap,i(g.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===xa&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap,i(g.iridescenceMap,m.iridescenceMapTransform)),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap,i(g.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap,i(g.transmissionMap,m.transmissionMapTransform)),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap,i(g.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(m.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(m.anisotropyMap.value=g.anisotropyMap,i(g.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap,i(g.specularColorMap,m.specularColorMapTransform)),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap,i(g.specularIntensityMap,m.specularIntensityMapTransform))}function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}function v(m,g){const y=t.get(g).light;m.referencePosition.value.setFromMatrixPosition(y.matrixWorld),m.nearDistance.value=y.shadow.camera.near,m.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function KWe(e,t,i,r){let n={},s={},a=[];const o=i.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(y,x){const _=x.program;r.uniformBlockBinding(y,_)}function c(y,x){let _=n[y.id];_===void 0&&(f(y),_=u(y),n[y.id]=_,y.addEventListener("dispose",m));const M=x.program;r.updateUBOMapping(y,M);const S=t.render.frame;s[y.id]!==S&&(d(y),s[y.id]=S)}function u(y){const x=h();y.__bindingPointIndex=x;const _=e.createBuffer(),M=y.__size,S=y.usage;return e.bindBuffer(e.UNIFORM_BUFFER,_),e.bufferData(e.UNIFORM_BUFFER,M,S),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,x,_),_}function h(){for(let y=0;y<o;y++)if(a.indexOf(y)===-1)return a.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const x=n[y.id],_=y.uniforms,M=y.__cache;e.bindBuffer(e.UNIFORM_BUFFER,x);for(let S=0,E=_.length;S<E;S++){const A=Array.isArray(_[S])?_[S]:[_[S]];for(let P=0,C=A.length;P<C;P++){const D=A[P];if(p(D,S,P,M)===!0){const N=D.__offset,U=Array.isArray(D.value)?D.value:[D.value];let I=0;for(let G=0;G<U.length;G++){const Q=U[G],Y=v(Q);typeof Q=="number"||typeof Q=="boolean"?(D.__data[0]=Q,e.bufferSubData(e.UNIFORM_BUFFER,N+I,D.__data)):Q.isMatrix3?(D.__data[0]=Q.elements[0],D.__data[1]=Q.elements[1],D.__data[2]=Q.elements[2],D.__data[3]=0,D.__data[4]=Q.elements[3],D.__data[5]=Q.elements[4],D.__data[6]=Q.elements[5],D.__data[7]=0,D.__data[8]=Q.elements[6],D.__data[9]=Q.elements[7],D.__data[10]=Q.elements[8],D.__data[11]=0):(Q.toArray(D.__data,I),I+=Y.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,N,D.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}function p(y,x,_,M){const S=y.value,E=x+"_"+_;if(M[E]===void 0)return typeof S=="number"||typeof S=="boolean"?M[E]=S:M[E]=S.clone(),!0;{const A=M[E];if(typeof S=="number"||typeof S=="boolean"){if(A!==S)return M[E]=S,!0}else if(A.equals(S)===!1)return A.copy(S),!0}return!1}function f(y){const x=y.uniforms;let _=0;const M=16;for(let E=0,A=x.length;E<A;E++){const P=Array.isArray(x[E])?x[E]:[x[E]];for(let C=0,D=P.length;C<D;C++){const N=P[C],U=Array.isArray(N.value)?N.value:[N.value];for(let I=0,G=U.length;I<G;I++){const Q=U[I],Y=v(Q),O=_%M;O!==0&&M-O<Y.boundary&&(_+=M-O),N.__data=new Float32Array(Y.storage/Float32Array.BYTES_PER_ELEMENT),N.__offset=_,_+=Y.storage}}}const S=_%M;return S>0&&(_+=M-S),y.__size=_,y.__cache={},this}function v(y){const x={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function m(y){const x=y.target;x.removeEventListener("dispose",m);const _=a.indexOf(x.__bindingPointIndex);a.splice(_,1),e.deleteBuffer(n[x.id]),delete n[x.id],delete s[x.id]}function g(){for(const y in n)e.deleteBuffer(n[y]);a=[],n={},s={}}return{bind:l,update:c,dispose:g}}class eF{constructor(t={}){const{canvas:i=Ine(),context:r=null,depth:n=!0,stencil:s=!0,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1}=t;this.isWebGLRenderer=!0;let d;r!==null?d=r.getContextAttributes().alpha:d=a;const p=new Uint32Array(4),f=new Int32Array(4);let v=null,m=null;const g=[],y=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ho,this._useLegacyLights=!1,this.toneMapping=Fc,this.toneMappingExposure=1;const x=this;let _=!1,M=0,S=0,E=null,A=-1,P=null;const C=new nr,D=new nr;let N=null;const U=new Rt(0);let I=0,G=i.width,Q=i.height,Y=1,O=null,V=null;const F=new nr(0,0,G,Q),W=new nr(0,0,G,Q);let ee=!1;const ae=new dw;let K=!1,$=!1,ie=null;const ye=new ui,pe=new nt,me=new he,ge={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function xe(){return E===null?Y:1}let te=r;function we(re,Te){for(let Le=0;Le<re.length;Le++){const Ie=re[Le],Pe=i.getContext(Ie,Te);if(Pe!==null)return Pe}return null}try{const re={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${ow}`),i.addEventListener("webglcontextlost",Ne,!1),i.addEventListener("webglcontextrestored",oe,!1),i.addEventListener("webglcontextcreationerror",He,!1),te===null){const Te=["webgl2","webgl","experimental-webgl"];if(x.isWebGL1Renderer===!0&&Te.shift(),te=we(Te,re),te===null)throw we(Te)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&te instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),te.getShaderPrecisionFormat===void 0&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(re){throw console.error("THREE.WebGLRenderer: "+re.message),re}let Ce,Se,Re,Xe,Be,Fe,dt,se,z,X,ce,Ee,q,Ye,et,ke,_e,at,Ve,mt,pt,st,ue,ze;function ut(){Ce=new oGe(te),Se=new tGe(te,Ce,t),Ce.init(Se),st=new qne(te,Ce,Se),Re=new jWe(te,Ce,Se),Xe=new uGe(te),Be=new DWe,Fe=new HWe(te,Ce,Re,Be,Se,st,Xe),dt=new rGe(x),se=new aGe(x),z=new gje(te,Se),ue=new $He(te,Ce,z,Se),X=new lGe(te,z,Xe,ue),ce=new fGe(te,X,z,Xe),Ve=new pGe(te,Se,Fe),ke=new iGe(Be),Ee=new PWe(x,dt,se,Ce,Se,ue,ke),q=new QWe(x,Be),Ye=new RWe,et=new kWe(Ce,Se),at=new JHe(x,dt,se,Re,ce,d,l),_e=new VWe(x,ce,Se),ze=new KWe(te,Xe,Se,Re),mt=new eGe(te,Ce,Xe,Se),pt=new cGe(te,Ce,Xe,Se),Xe.programs=Ee.programs,x.capabilities=Se,x.extensions=Ce,x.properties=Be,x.renderLists=Ye,x.shadowMap=_e,x.state=Re,x.info=Xe}ut();const de=new YWe(x,te);this.xr=de,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const re=Ce.get("WEBGL_lose_context");re&&re.loseContext()},this.forceContextRestore=function(){const re=Ce.get("WEBGL_lose_context");re&&re.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(re){re!==void 0&&(Y=re,this.setSize(G,Q,!1))},this.getSize=function(re){return re.set(G,Q)},this.setSize=function(re,Te,Le=!0){if(de.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=re,Q=Te,i.width=Math.floor(re*Y),i.height=Math.floor(Te*Y),Le===!0&&(i.style.width=re+"px",i.style.height=Te+"px"),this.setViewport(0,0,re,Te)},this.getDrawingBufferSize=function(re){return re.set(G*Y,Q*Y).floor()},this.setDrawingBufferSize=function(re,Te,Le){G=re,Q=Te,Y=Le,i.width=Math.floor(re*Le),i.height=Math.floor(Te*Le),this.setViewport(0,0,re,Te)},this.getCurrentViewport=function(re){return re.copy(C)},this.getViewport=function(re){return re.copy(F)},this.setViewport=function(re,Te,Le,Ie){re.isVector4?F.set(re.x,re.y,re.z,re.w):F.set(re,Te,Le,Ie),Re.viewport(C.copy(F).multiplyScalar(Y).round())},this.getScissor=function(re){return re.copy(W)},this.setScissor=function(re,Te,Le,Ie){re.isVector4?W.set(re.x,re.y,re.z,re.w):W.set(re,Te,Le,Ie),Re.scissor(D.copy(W).multiplyScalar(Y).round())},this.getScissorTest=function(){return ee},this.setScissorTest=function(re){Re.setScissorTest(ee=re)},this.setOpaqueSort=function(re){O=re},this.setTransparentSort=function(re){V=re},this.getClearColor=function(re){return re.copy(at.getClearColor())},this.setClearColor=function(){at.setClearColor.apply(at,arguments)},this.getClearAlpha=function(){return at.getClearAlpha()},this.setClearAlpha=function(){at.setClearAlpha.apply(at,arguments)},this.clear=function(re=!0,Te=!0,Le=!0){let Ie=0;if(re){let Pe=!1;if(E!==null){const gt=E.texture.format;Pe=gt===VU||gt===FU||gt===UU}if(Pe){const gt=E.texture.type,Lt=gt===Vc||gt===Xu||gt===jT||gt===Vd||gt===zU||gt===BU,Ft=at.getClearColor(),At=at.getClearAlpha(),bt=Ft.r,Vt=Ft.g,yt=Ft.b;Lt?(p[0]=bt,p[1]=Vt,p[2]=yt,p[3]=At,te.clearBufferuiv(te.COLOR,0,p)):(f[0]=bt,f[1]=Vt,f[2]=yt,f[3]=At,te.clearBufferiv(te.COLOR,0,f))}else Ie|=te.COLOR_BUFFER_BIT}Te&&(Ie|=te.DEPTH_BUFFER_BIT),Le&&(Ie|=te.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),te.clear(Ie)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Ne,!1),i.removeEventListener("webglcontextrestored",oe,!1),i.removeEventListener("webglcontextcreationerror",He,!1),Ye.dispose(),et.dispose(),Be.dispose(),dt.dispose(),se.dispose(),ce.dispose(),ue.dispose(),ze.dispose(),Ee.dispose(),de.dispose(),de.removeEventListener("sessionstart",Ni),de.removeEventListener("sessionend",Qt),ie&&(ie.dispose(),ie=null),Ot.stop()};function Ne(re){re.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),_=!0}function oe(){console.log("THREE.WebGLRenderer: Context Restored."),_=!1;const re=Xe.autoReset,Te=_e.enabled,Le=_e.autoUpdate,Ie=_e.needsUpdate,Pe=_e.type;ut(),Xe.autoReset=re,_e.enabled=Te,_e.autoUpdate=Le,_e.needsUpdate=Ie,_e.type=Pe}function He(re){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",re.statusMessage)}function Ae(re){const Te=re.target;Te.removeEventListener("dispose",Ae),tt(Te)}function tt(re){ct(re),Be.remove(re)}function ct(re){const Te=Be.get(re).programs;Te!==void 0&&(Te.forEach(function(Le){Ee.releaseProgram(Le)}),re.isShaderMaterial&&Ee.releaseShaderCache(re))}this.renderBufferDirect=function(re,Te,Le,Ie,Pe,gt){Te===null&&(Te=ge);const Lt=Pe.isMesh&&Pe.matrixWorld.determinant()<0,Ft=It(re,Te,Le,Ie,Pe);Re.setMaterial(Ie,Lt);let At=Le.index,bt=1;if(Ie.wireframe===!0){if(At=X.getWireframeAttribute(Le),At===void 0)return;bt=2}const Vt=Le.drawRange,yt=Le.attributes.position;let Vi=Vt.start*bt,Sr=(Vt.start+Vt.count)*bt;gt!==null&&(Vi=Math.max(Vi,gt.start*bt),Sr=Math.min(Sr,(gt.start+gt.count)*bt)),At!==null?(Vi=Math.max(Vi,0),Sr=Math.min(Sr,At.count)):yt!=null&&(Vi=Math.max(Vi,0),Sr=Math.min(Sr,yt.count));const ki=Sr-Vi;if(ki<0||ki===1/0)return;ue.setup(Pe,Ie,Ft,Le,At);let er,Z=mt;if(At!==null&&(er=z.get(At),Z=pt,Z.setIndex(er)),Pe.isMesh)Ie.wireframe===!0?(Re.setLineWidth(Ie.wireframeLinewidth*xe()),Z.setMode(te.LINES)):Z.setMode(te.TRIANGLES);else if(Pe.isLine){let J=Ie.linewidth;J===void 0&&(J=1),Re.setLineWidth(J*xe()),Pe.isLineSegments?Z.setMode(te.LINES):Pe.isLineLoop?Z.setMode(te.LINE_LOOP):Z.setMode(te.LINE_STRIP)}else Pe.isPoints?Z.setMode(te.POINTS):Pe.isSprite&&Z.setMode(te.TRIANGLES);if(Pe.isBatchedMesh)Z.renderMultiDraw(Pe._multiDrawStarts,Pe._multiDrawCounts,Pe._multiDrawCount);else if(Pe.isInstancedMesh)Z.renderInstances(Vi,ki,Pe.count);else if(Le.isInstancedBufferGeometry){const J=Le._maxInstanceCount!==void 0?Le._maxInstanceCount:1/0,be=Math.min(Le.instanceCount,J);Z.renderInstances(Vi,ki,be)}else Z.render(Vi,ki)};function Dt(re,Te,Le){re.transparent===!0&&re.side===Cc&&re.forceSinglePass===!1?(re.side=xa,re.needsUpdate=!0,Ze(re,Te,Le),re.side=hh,re.needsUpdate=!0,Ze(re,Te,Le),re.side=Cc):Ze(re,Te,Le)}this.compile=function(re,Te,Le=null){Le===null&&(Le=re),m=et.get(Le),m.init(),y.push(m),Le.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(Te.layers)&&(m.pushLight(Pe),Pe.castShadow&&m.pushShadow(Pe))}),re!==Le&&re.traverseVisible(function(Pe){Pe.isLight&&Pe.layers.test(Te.layers)&&(m.pushLight(Pe),Pe.castShadow&&m.pushShadow(Pe))}),m.setupLights(x._useLegacyLights);const Ie=new Set;return re.traverse(function(Pe){const gt=Pe.material;if(gt)if(Array.isArray(gt))for(let Lt=0;Lt<gt.length;Lt++){const Ft=gt[Lt];Dt(Ft,Le,Pe),Ie.add(Ft)}else Dt(gt,Le,Pe),Ie.add(gt)}),y.pop(),m=null,Ie},this.compileAsync=function(re,Te,Le=null){const Ie=this.compile(re,Te,Le);return new Promise(Pe=>{function gt(){if(Ie.forEach(function(Lt){Be.get(Lt).currentProgram.isReady()&&Ie.delete(Lt)}),Ie.size===0){Pe(re);return}setTimeout(gt,10)}Ce.get("KHR_parallel_shader_compile")!==null?gt():setTimeout(gt,10)})};let ai=null;function Wt(re){ai&&ai(re)}function Ni(){Ot.stop()}function Qt(){Ot.start()}const Ot=new Vne;Ot.setAnimationLoop(Wt),typeof self<"u"&&Ot.setContext(self),this.setAnimationLoop=function(re){ai=re,de.setAnimationLoop(re),re===null?Ot.stop():Ot.start()},de.addEventListener("sessionstart",Ni),de.addEventListener("sessionend",Qt),this.render=function(re,Te){if(Te!==void 0&&Te.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_===!0)return;re.matrixWorldAutoUpdate===!0&&re.updateMatrixWorld(),Te.parent===null&&Te.matrixWorldAutoUpdate===!0&&Te.updateMatrixWorld(),de.enabled===!0&&de.isPresenting===!0&&(de.cameraAutoUpdate===!0&&de.updateCamera(Te),Te=de.getCamera()),re.isScene===!0&&re.onBeforeRender(x,re,Te,E),m=et.get(re,y.length),m.init(),y.push(m),ye.multiplyMatrices(Te.projectionMatrix,Te.matrixWorldInverse),ae.setFromProjectionMatrix(ye),$=this.localClippingEnabled,K=ke.init(this.clippingPlanes,$),v=Ye.get(re,g.length),v.init(),g.push(v),Ps(re,Te,0,x.sortObjects),v.finish(),x.sortObjects===!0&&v.sort(O,V),this.info.render.frame++,K===!0&&ke.beginShadows();const Le=m.state.shadowsArray;if(_e.render(Le,re,Te),K===!0&&ke.endShadows(),this.info.autoReset===!0&&this.info.reset(),(de.enabled===!1||de.isPresenting===!1||de.hasDepthSensing()===!1)&&at.render(v,re),m.setupLights(x._useLegacyLights),Te.isArrayCamera){const Ie=Te.cameras;for(let Pe=0,gt=Ie.length;Pe<gt;Pe++){const Lt=Ie[Pe];Kc(v,re,Lt,Lt.viewport)}}else Kc(v,re,Te);E!==null&&(Fe.updateMultisampleRenderTarget(E),Fe.updateRenderTargetMipmap(E)),re.isScene===!0&&re.onAfterRender(x,re,Te),ue.resetDefaultState(),A=-1,P=null,y.pop(),y.length>0?m=y[y.length-1]:m=null,g.pop(),g.length>0?v=g[g.length-1]:v=null};function Ps(re,Te,Le,Ie){if(re.visible===!1)return;if(re.layers.test(Te.layers)){if(re.isGroup)Le=re.renderOrder;else if(re.isLOD)re.autoUpdate===!0&&re.update(Te);else if(re.isLight)m.pushLight(re),re.castShadow&&m.pushShadow(re);else if(re.isSprite){if(!re.frustumCulled||ae.intersectsSprite(re)){Ie&&me.setFromMatrixPosition(re.matrixWorld).applyMatrix4(ye);const Lt=ce.update(re),Ft=re.material;Ft.visible&&v.push(re,Lt,Ft,Le,me.z,null)}}else if((re.isMesh||re.isLine||re.isPoints)&&(!re.frustumCulled||ae.intersectsObject(re))){const Lt=ce.update(re),Ft=re.material;if(Ie&&(re.boundingSphere!==void 0?(re.boundingSphere===null&&re.computeBoundingSphere(),me.copy(re.boundingSphere.center)):(Lt.boundingSphere===null&&Lt.computeBoundingSphere(),me.copy(Lt.boundingSphere.center)),me.applyMatrix4(re.matrixWorld).applyMatrix4(ye)),Array.isArray(Ft)){const At=Lt.groups;for(let bt=0,Vt=At.length;bt<Vt;bt++){const yt=At[bt],Vi=Ft[yt.materialIndex];Vi&&Vi.visible&&v.push(re,Lt,Vi,Le,me.z,yt)}}else Ft.visible&&v.push(re,Lt,Ft,Le,me.z,null)}}const gt=re.children;for(let Lt=0,Ft=gt.length;Lt<Ft;Lt++)Ps(gt[Lt],Te,Le,Ie)}function Kc(re,Te,Le,Ie){const Pe=re.opaque,gt=re.transmissive,Lt=re.transparent;m.setupLightsView(Le),K===!0&&ke.setGlobalState(x.clippingPlanes,Le),gt.length>0&&al(Pe,gt,Te,Le),Ie&&Re.viewport(C.copy(Ie)),Pe.length>0&&le(Pe,Te,Le),gt.length>0&&le(gt,Te,Le),Lt.length>0&&le(Lt,Te,Le),Re.buffers.depth.setTest(!0),Re.buffers.depth.setMask(!0),Re.buffers.color.setMask(!0),Re.setPolygonOffset(!1)}function al(re,Te,Le,Ie){if((Le.isScene===!0?Le.overrideMaterial:null)!==null)return;const gt=Se.isWebGL2;ie===null&&(ie=new Wl(1,1,{generateMipmaps:!0,type:Ce.has("EXT_color_buffer_half_float")?g0:Vc,minFilter:Dc,samples:gt?4:0})),x.getDrawingBufferSize(pe),gt?ie.setSize(pe.x,pe.y):ie.setSize(DC(pe.x),DC(pe.y));const Lt=x.getRenderTarget();x.setRenderTarget(ie),x.getClearColor(U),I=x.getClearAlpha(),I<1&&x.setClearColor(16777215,.5),x.clear();const Ft=x.toneMapping;x.toneMapping=Fc,le(re,Le,Ie),Fe.updateMultisampleRenderTarget(ie),Fe.updateRenderTargetMipmap(ie);let At=!1;for(let bt=0,Vt=Te.length;bt<Vt;bt++){const yt=Te[bt],Vi=yt.object,Sr=yt.geometry,ki=yt.material,er=yt.group;if(ki.side===Cc&&Vi.layers.test(Ie.layers)){const Z=ki.side;ki.side=xa,ki.needsUpdate=!0,Ge(Vi,Le,Ie,Sr,ki,er),ki.side=Z,ki.needsUpdate=!0,At=!0}}At===!0&&(Fe.updateMultisampleRenderTarget(ie),Fe.updateRenderTargetMipmap(ie)),x.setRenderTarget(Lt),x.setClearColor(U,I),x.toneMapping=Ft}function le(re,Te,Le){const Ie=Te.isScene===!0?Te.overrideMaterial:null;for(let Pe=0,gt=re.length;Pe<gt;Pe++){const Lt=re[Pe],Ft=Lt.object,At=Lt.geometry,bt=Ie===null?Lt.material:Ie,Vt=Lt.group;Ft.layers.test(Le.layers)&&Ge(Ft,Te,Le,At,bt,Vt)}}function Ge(re,Te,Le,Ie,Pe,gt){re.onBeforeRender(x,Te,Le,Ie,Pe,gt),re.modelViewMatrix.multiplyMatrices(Le.matrixWorldInverse,re.matrixWorld),re.normalMatrix.getNormalMatrix(re.modelViewMatrix),Pe.onBeforeRender(x,Te,Le,Ie,re,gt),Pe.transparent===!0&&Pe.side===Cc&&Pe.forceSinglePass===!1?(Pe.side=xa,Pe.needsUpdate=!0,x.renderBufferDirect(Le,Te,Ie,Pe,re,gt),Pe.side=hh,Pe.needsUpdate=!0,x.renderBufferDirect(Le,Te,Ie,Pe,re,gt),Pe.side=Cc):x.renderBufferDirect(Le,Te,Ie,Pe,re,gt),re.onAfterRender(x,Te,Le,Ie,Pe,gt)}function Ze(re,Te,Le){Te.isScene!==!0&&(Te=ge);const Ie=Be.get(re),Pe=m.state.lights,gt=m.state.shadowsArray,Lt=Pe.state.version,Ft=Ee.getParameters(re,Pe.state,gt,Te,Le),At=Ee.getProgramCacheKey(Ft);let bt=Ie.programs;Ie.environment=re.isMeshStandardMaterial?Te.environment:null,Ie.fog=Te.fog,Ie.envMap=(re.isMeshStandardMaterial?se:dt).get(re.envMap||Ie.environment),Ie.envMapRotation=Ie.environment!==null&&re.envMap===null?Te.environmentRotation:re.envMapRotation,bt===void 0&&(re.addEventListener("dispose",Ae),bt=new Map,Ie.programs=bt);let Vt=bt.get(At);if(Vt!==void 0){if(Ie.currentProgram===Vt&&Ie.lightsStateVersion===Lt)return Je(re,Ft),Vt}else Ft.uniforms=Ee.getUniforms(re),re.onBuild(Le,Ft,x),re.onBeforeCompile(Ft,x),Vt=Ee.acquireProgram(Ft,At),bt.set(At,Vt),Ie.uniforms=Ft.uniforms;const yt=Ie.uniforms;return(!re.isShaderMaterial&&!re.isRawShaderMaterial||re.clipping===!0)&&(yt.clippingPlanes=ke.uniform),Je(re,Ft),Ie.needsLights=oi(re),Ie.lightsStateVersion=Lt,Ie.needsLights&&(yt.ambientLightColor.value=Pe.state.ambient,yt.lightProbe.value=Pe.state.probe,yt.directionalLights.value=Pe.state.directional,yt.directionalLightShadows.value=Pe.state.directionalShadow,yt.spotLights.value=Pe.state.spot,yt.spotLightShadows.value=Pe.state.spotShadow,yt.rectAreaLights.value=Pe.state.rectArea,yt.ltc_1.value=Pe.state.rectAreaLTC1,yt.ltc_2.value=Pe.state.rectAreaLTC2,yt.pointLights.value=Pe.state.point,yt.pointLightShadows.value=Pe.state.pointShadow,yt.hemisphereLights.value=Pe.state.hemi,yt.directionalShadowMap.value=Pe.state.directionalShadowMap,yt.directionalShadowMatrix.value=Pe.state.directionalShadowMatrix,yt.spotShadowMap.value=Pe.state.spotShadowMap,yt.spotLightMatrix.value=Pe.state.spotLightMatrix,yt.spotLightMap.value=Pe.state.spotLightMap,yt.pointShadowMap.value=Pe.state.pointShadowMap,yt.pointShadowMatrix.value=Pe.state.pointShadowMatrix),Ie.currentProgram=Vt,Ie.uniformsList=null,Vt}function Ue(re){if(re.uniformsList===null){const Te=re.currentProgram.getUniforms();re.uniformsList=kE.seqWithValue(Te.seq,re.uniforms)}return re.uniformsList}function Je(re,Te){const Le=Be.get(re);Le.outputColorSpace=Te.outputColorSpace,Le.batching=Te.batching,Le.instancing=Te.instancing,Le.instancingColor=Te.instancingColor,Le.instancingMorph=Te.instancingMorph,Le.skinning=Te.skinning,Le.morphTargets=Te.morphTargets,Le.morphNormals=Te.morphNormals,Le.morphColors=Te.morphColors,Le.morphTargetsCount=Te.morphTargetsCount,Le.numClippingPlanes=Te.numClippingPlanes,Le.numIntersection=Te.numClipIntersection,Le.vertexAlphas=Te.vertexAlphas,Le.vertexTangents=Te.vertexTangents,Le.toneMapping=Te.toneMapping}function It(re,Te,Le,Ie,Pe){Te.isScene!==!0&&(Te=ge),Fe.resetTextureUnits();const gt=Te.fog,Lt=Ie.isMeshStandardMaterial?Te.environment:null,Ft=E===null?x.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:vh,At=(Ie.isMeshStandardMaterial?se:dt).get(Ie.envMap||Lt),bt=Ie.vertexColors===!0&&!!Le.attributes.color&&Le.attributes.color.itemSize===4,Vt=!!Le.attributes.tangent&&(!!Ie.normalMap||Ie.anisotropy>0),yt=!!Le.morphAttributes.position,Vi=!!Le.morphAttributes.normal,Sr=!!Le.morphAttributes.color;let ki=Fc;Ie.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(ki=x.toneMapping);const er=Le.morphAttributes.position||Le.morphAttributes.normal||Le.morphAttributes.color,Z=er!==void 0?er.length:0,J=Be.get(Ie),be=m.state.lights;if(K===!0&&($===!0||re!==P)){const tn=re===P&&Ie.id===A;ke.setState(Ie,re,tn)}let ne=!1;Ie.version===J.__version?(J.needsLights&&J.lightsStateVersion!==be.state.version||J.outputColorSpace!==Ft||Pe.isBatchedMesh&&J.batching===!1||!Pe.isBatchedMesh&&J.batching===!0||Pe.isInstancedMesh&&J.instancing===!1||!Pe.isInstancedMesh&&J.instancing===!0||Pe.isSkinnedMesh&&J.skinning===!1||!Pe.isSkinnedMesh&&J.skinning===!0||Pe.isInstancedMesh&&J.instancingColor===!0&&Pe.instanceColor===null||Pe.isInstancedMesh&&J.instancingColor===!1&&Pe.instanceColor!==null||Pe.isInstancedMesh&&J.instancingMorph===!0&&Pe.morphTexture===null||Pe.isInstancedMesh&&J.instancingMorph===!1&&Pe.morphTexture!==null||J.envMap!==At||Ie.fog===!0&&J.fog!==gt||J.numClippingPlanes!==void 0&&(J.numClippingPlanes!==ke.numPlanes||J.numIntersection!==ke.numIntersection)||J.vertexAlphas!==bt||J.vertexTangents!==Vt||J.morphTargets!==yt||J.morphNormals!==Vi||J.morphColors!==Sr||J.toneMapping!==ki||Se.isWebGL2===!0&&J.morphTargetsCount!==Z)&&(ne=!0):(ne=!0,J.__version=Ie.version);let Me=J.currentProgram;ne===!0&&(Me=Ze(Ie,Te,Pe));let ht=!1,jr=!1,Hr=!1;const vr=Me.getUniforms(),Ca=J.uniforms;if(Re.useProgram(Me.program)&&(ht=!0,jr=!0,Hr=!0),Ie.id!==A&&(A=Ie.id,jr=!0),ht||P!==re){vr.setValue(te,"projectionMatrix",re.projectionMatrix),vr.setValue(te,"viewMatrix",re.matrixWorldInverse);const tn=vr.map.cameraPosition;tn!==void 0&&tn.setValue(te,me.setFromMatrixPosition(re.matrixWorld)),Se.logarithmicDepthBuffer&&vr.setValue(te,"logDepthBufFC",2/(Math.log(re.far+1)/Math.LN2)),(Ie.isMeshPhongMaterial||Ie.isMeshToonMaterial||Ie.isMeshLambertMaterial||Ie.isMeshBasicMaterial||Ie.isMeshStandardMaterial||Ie.isShaderMaterial)&&vr.setValue(te,"isOrthographic",re.isOrthographicCamera===!0),P!==re&&(P=re,jr=!0,Hr=!0)}if(Pe.isSkinnedMesh){vr.setOptional(te,Pe,"bindMatrix"),vr.setOptional(te,Pe,"bindMatrixInverse");const tn=Pe.skeleton;tn&&(Se.floatVertexTextures?(tn.boneTexture===null&&tn.computeBoneTexture(),vr.setValue(te,"boneTexture",tn.boneTexture,Fe)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Pe.isBatchedMesh&&(vr.setOptional(te,Pe,"batchingTexture"),vr.setValue(te,"batchingTexture",Pe._matricesTexture,Fe));const ol=Le.morphAttributes;if((ol.position!==void 0||ol.normal!==void 0||ol.color!==void 0&&Se.isWebGL2===!0)&&Ve.update(Pe,Le,Me),(jr||J.receiveShadow!==Pe.receiveShadow)&&(J.receiveShadow=Pe.receiveShadow,vr.setValue(te,"receiveShadow",Pe.receiveShadow)),Ie.isMeshGouraudMaterial&&Ie.envMap!==null&&(Ca.envMap.value=At,Ca.flipEnvMap.value=At.isCubeTexture&&At.isRenderTargetTexture===!1?-1:1),jr&&(vr.setValue(te,"toneMappingExposure",x.toneMappingExposure),J.needsLights&&ei(Ca,Hr),gt&&Ie.fog===!0&&q.refreshFogUniforms(Ca,gt),q.refreshMaterialUniforms(Ca,Ie,Y,Q,ie),kE.upload(te,Ue(J),Ca,Fe)),Ie.isShaderMaterial&&Ie.uniformsNeedUpdate===!0&&(kE.upload(te,Ue(J),Ca,Fe),Ie.uniformsNeedUpdate=!1),Ie.isSpriteMaterial&&vr.setValue(te,"center",Pe.center),vr.setValue(te,"modelViewMatrix",Pe.modelViewMatrix),vr.setValue(te,"normalMatrix",Pe.normalMatrix),vr.setValue(te,"modelMatrix",Pe.matrixWorld),Ie.isShaderMaterial||Ie.isRawShaderMaterial){const tn=Ie.uniformsGroups;for(let Mm=0,Za=tn.length;Mm<Za;Mm++)if(Se.isWebGL2){const yw=tn[Mm];ze.update(yw,Me),ze.bind(yw,Me)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Me}function ei(re,Te){re.ambientLightColor.needsUpdate=Te,re.lightProbe.needsUpdate=Te,re.directionalLights.needsUpdate=Te,re.directionalLightShadows.needsUpdate=Te,re.pointLights.needsUpdate=Te,re.pointLightShadows.needsUpdate=Te,re.spotLights.needsUpdate=Te,re.spotLightShadows.needsUpdate=Te,re.rectAreaLights.needsUpdate=Te,re.hemisphereLights.needsUpdate=Te}function oi(re){return re.isMeshLambertMaterial||re.isMeshToonMaterial||re.isMeshPhongMaterial||re.isMeshStandardMaterial||re.isShadowMaterial||re.isShaderMaterial&&re.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(re,Te,Le){Be.get(re.texture).__webglTexture=Te,Be.get(re.depthTexture).__webglTexture=Le;const Ie=Be.get(re);Ie.__hasExternalTextures=!0,Ie.__autoAllocateDepthBuffer=Le===void 0,Ie.__autoAllocateDepthBuffer||Ce.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ie.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(re,Te){const Le=Be.get(re);Le.__webglFramebuffer=Te,Le.__useDefaultFramebuffer=Te===void 0},this.setRenderTarget=function(re,Te=0,Le=0){E=re,M=Te,S=Le;let Ie=!0,Pe=null,gt=!1,Lt=!1;if(re){const At=Be.get(re);At.__useDefaultFramebuffer!==void 0?(Re.bindFramebuffer(te.FRAMEBUFFER,null),Ie=!1):At.__webglFramebuffer===void 0?Fe.setupRenderTarget(re):At.__hasExternalTextures&&Fe.rebindTextures(re,Be.get(re.texture).__webglTexture,Be.get(re.depthTexture).__webglTexture);const bt=re.texture;(bt.isData3DTexture||bt.isDataArrayTexture||bt.isCompressedArrayTexture)&&(Lt=!0);const Vt=Be.get(re).__webglFramebuffer;re.isWebGLCubeRenderTarget?(Array.isArray(Vt[Te])?Pe=Vt[Te][Le]:Pe=Vt[Te],gt=!0):Se.isWebGL2&&re.samples>0&&Fe.useMultisampledRTT(re)===!1?Pe=Be.get(re).__webglMultisampledFramebuffer:Array.isArray(Vt)?Pe=Vt[Le]:Pe=Vt,C.copy(re.viewport),D.copy(re.scissor),N=re.scissorTest}else C.copy(F).multiplyScalar(Y).floor(),D.copy(W).multiplyScalar(Y).floor(),N=ee;if(Re.bindFramebuffer(te.FRAMEBUFFER,Pe)&&Se.drawBuffers&&Ie&&Re.drawBuffers(re,Pe),Re.viewport(C),Re.scissor(D),Re.setScissorTest(N),gt){const At=Be.get(re.texture);te.framebufferTexture2D(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,te.TEXTURE_CUBE_MAP_POSITIVE_X+Te,At.__webglTexture,Le)}else if(Lt){const At=Be.get(re.texture),bt=Te||0;te.framebufferTextureLayer(te.FRAMEBUFFER,te.COLOR_ATTACHMENT0,At.__webglTexture,Le||0,bt)}A=-1},this.readRenderTargetPixels=function(re,Te,Le,Ie,Pe,gt,Lt){if(!(re&&re.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ft=Be.get(re).__webglFramebuffer;if(re.isWebGLCubeRenderTarget&&Lt!==void 0&&(Ft=Ft[Lt]),Ft){Re.bindFramebuffer(te.FRAMEBUFFER,Ft);try{const At=re.texture,bt=At.format,Vt=At.type;if(bt!==fa&&st.convert(bt)!==te.getParameter(te.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const yt=Vt===g0&&(Ce.has("EXT_color_buffer_half_float")||Se.isWebGL2&&Ce.has("EXT_color_buffer_float"));if(Vt!==Vc&&st.convert(Vt)!==te.getParameter(te.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Vt===oo&&(Se.isWebGL2||Ce.has("OES_texture_float")||Ce.has("WEBGL_color_buffer_float")))&&!yt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Te>=0&&Te<=re.width-Ie&&Le>=0&&Le<=re.height-Pe&&te.readPixels(Te,Le,Ie,Pe,st.convert(bt),st.convert(Vt),gt)}finally{const At=E!==null?Be.get(E).__webglFramebuffer:null;Re.bindFramebuffer(te.FRAMEBUFFER,At)}}},this.copyFramebufferToTexture=function(re,Te,Le=0){const Ie=Math.pow(2,-Le),Pe=Math.floor(Te.image.width*Ie),gt=Math.floor(Te.image.height*Ie);Fe.setTexture2D(Te,0),te.copyTexSubImage2D(te.TEXTURE_2D,Le,0,0,re.x,re.y,Pe,gt),Re.unbindTexture()},this.copyTextureToTexture=function(re,Te,Le,Ie=0){const Pe=Te.image.width,gt=Te.image.height,Lt=st.convert(Le.format),Ft=st.convert(Le.type);Fe.setTexture2D(Le,0),te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,Le.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Le.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,Le.unpackAlignment),Te.isDataTexture?te.texSubImage2D(te.TEXTURE_2D,Ie,re.x,re.y,Pe,gt,Lt,Ft,Te.image.data):Te.isCompressedTexture?te.compressedTexSubImage2D(te.TEXTURE_2D,Ie,re.x,re.y,Te.mipmaps[0].width,Te.mipmaps[0].height,Lt,Te.mipmaps[0].data):te.texSubImage2D(te.TEXTURE_2D,Ie,re.x,re.y,Lt,Ft,Te.image),Ie===0&&Le.generateMipmaps&&te.generateMipmap(te.TEXTURE_2D),Re.unbindTexture()},this.copyTextureToTexture3D=function(re,Te,Le,Ie,Pe=0){if(x.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const gt=Math.round(re.max.x-re.min.x),Lt=Math.round(re.max.y-re.min.y),Ft=re.max.z-re.min.z+1,At=st.convert(Ie.format),bt=st.convert(Ie.type);let Vt;if(Ie.isData3DTexture)Fe.setTexture3D(Ie,0),Vt=te.TEXTURE_3D;else if(Ie.isDataArrayTexture||Ie.isCompressedArrayTexture)Fe.setTexture2DArray(Ie,0),Vt=te.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,Ie.flipY),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ie.premultiplyAlpha),te.pixelStorei(te.UNPACK_ALIGNMENT,Ie.unpackAlignment);const yt=te.getParameter(te.UNPACK_ROW_LENGTH),Vi=te.getParameter(te.UNPACK_IMAGE_HEIGHT),Sr=te.getParameter(te.UNPACK_SKIP_PIXELS),ki=te.getParameter(te.UNPACK_SKIP_ROWS),er=te.getParameter(te.UNPACK_SKIP_IMAGES),Z=Le.isCompressedTexture?Le.mipmaps[Pe]:Le.image;te.pixelStorei(te.UNPACK_ROW_LENGTH,Z.width),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,Z.height),te.pixelStorei(te.UNPACK_SKIP_PIXELS,re.min.x),te.pixelStorei(te.UNPACK_SKIP_ROWS,re.min.y),te.pixelStorei(te.UNPACK_SKIP_IMAGES,re.min.z),Le.isDataTexture||Le.isData3DTexture?te.texSubImage3D(Vt,Pe,Te.x,Te.y,Te.z,gt,Lt,Ft,At,bt,Z.data):Ie.isCompressedArrayTexture?te.compressedTexSubImage3D(Vt,Pe,Te.x,Te.y,Te.z,gt,Lt,Ft,At,Z.data):te.texSubImage3D(Vt,Pe,Te.x,Te.y,Te.z,gt,Lt,Ft,At,bt,Z),te.pixelStorei(te.UNPACK_ROW_LENGTH,yt),te.pixelStorei(te.UNPACK_IMAGE_HEIGHT,Vi),te.pixelStorei(te.UNPACK_SKIP_PIXELS,Sr),te.pixelStorei(te.UNPACK_SKIP_ROWS,ki),te.pixelStorei(te.UNPACK_SKIP_IMAGES,er),Pe===0&&Ie.generateMipmaps&&te.generateMipmap(Vt),Re.unbindTexture()},this.initTexture=function(re){re.isCubeTexture?Fe.setTextureCube(re,0):re.isData3DTexture?Fe.setTexture3D(re,0):re.isDataArrayTexture||re.isCompressedArrayTexture?Fe.setTexture2DArray(re,0):Fe.setTexture2D(re,0),Re.unbindTexture()},this.resetState=function(){M=0,S=0,E=null,Re.reset(),ue.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Lc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const i=this.getContext();i.drawingBufferColorSpace=t===GT?"display-p3":"srgb",i.unpackColorSpace=ir.workingColorSpace===cw?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}class Zne extends eF{}Zne.prototype.isWebGL1Renderer=!0;class qT{constructor(t,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new Rt(t),this.density=i}clone(){return new qT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class YT{constructor(t,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new Rt(t),this.near=i,this.far=r}clone(){return new YT(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class tF extends Zi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new yo,this.environmentRotation=new yo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,i){return super.copy(t,i),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const i=super.toJSON(t);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class ZT{constructor(t,i){this.isInterleavedBuffer=!0,this.array=t,this.stride=i,this.count=t!==void 0?t.length/i:0,this.usage=bb,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=fo()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return One("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,i){this.updateRanges.push({start:t,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,i,r){t*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=i.array[r+n];return this}set(t,i=0){return this.array.set(t,i),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=fo()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const oa=new he;class sm{constructor(t,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let i=0,r=this.data.count;i<r;i++)oa.fromBufferAttribute(this,i),oa.applyMatrix4(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}applyNormalMatrix(t){for(let i=0,r=this.count;i<r;i++)oa.fromBufferAttribute(this,i),oa.applyNormalMatrix(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}transformDirection(t){for(let i=0,r=this.count;i<r;i++)oa.fromBufferAttribute(this,i),oa.transformDirection(t),this.setXYZ(i,oa.x,oa.y,oa.z);return this}getComponent(t,i){let r=this.array[t*this.data.stride+this.offset+i];return this.normalized&&(r=ma(r,this.array)),r}setComponent(t,i,r){return this.normalized&&(r=bi(r,this.array)),this.data.array[t*this.data.stride+this.offset+i]=r,this}setX(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset]=i,this}setY(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset+1]=i,this}setZ(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset+2]=i,this}setW(t,i){return this.normalized&&(i=bi(i,this.array)),this.data.array[t*this.data.stride+this.offset+3]=i,this}getX(t){let i=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(i=ma(i,this.array)),i}getY(t){let i=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(i=ma(i,this.array)),i}getZ(t){let i=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(i=ma(i,this.array)),i}getW(t){let i=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(i=ma(i,this.array)),i}setXY(t,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this}setXYZ(t,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this}setXYZW(t,i,r,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(i=bi(i,this.array),r=bi(r,this.array),n=bi(n,this.array),s=bi(s,this.array)),this.data.array[t+0]=i,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new pr(new this.array.constructor(i),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new sm(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class iF extends ea{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Lg;const n1=new he,Rg=new he,Ig=new he,Og=new nt,s1=new nt,Qne=new ui,MM=new he,a1=new he,EM=new he,V7=new nt,OL=new nt,j7=new nt;class Kne extends Zi{constructor(t=new iF){if(super(),this.isSprite=!0,this.type="Sprite",Lg===void 0){Lg=new Ei;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new ZT(i,5);Lg.setIndex([0,1,2,0,2,3]),Lg.setAttribute("position",new sm(r,3,0,!1)),Lg.setAttribute("uv",new sm(r,2,3,!1))}this.geometry=Lg,this.material=t,this.center=new nt(.5,.5)}raycast(t,i){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Rg.setFromMatrixScale(this.matrixWorld),Qne.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Ig.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Rg.multiplyScalar(-Ig.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;AM(MM.set(-.5,-.5,0),Ig,a,Rg,n,s),AM(a1.set(.5,-.5,0),Ig,a,Rg,n,s),AM(EM.set(.5,.5,0),Ig,a,Rg,n,s),V7.set(0,0),OL.set(1,0),j7.set(1,1);let o=t.ray.intersectTriangle(MM,a1,EM,!1,n1);if(o===null&&(AM(a1.set(-.5,.5,0),Ig,a,Rg,n,s),OL.set(0,1),o=t.ray.intersectTriangle(MM,EM,a1,!1,n1),o===null))return;const l=t.ray.origin.distanceTo(n1);l<t.near||l>t.far||i.push({distance:l,point:n1.clone(),uv:lo.getInterpolation(n1,MM,a1,EM,V7,OL,j7,new nt),face:null,object:this})}copy(t,i){return super.copy(t,i),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function AM(e,t,i,r,n,s){Og.subVectors(e,i).addScalar(.5).multiply(r),n!==void 0?(s1.x=s*Og.x-n*Og.y,s1.y=n*Og.x+s*Og.y):s1.copy(Og),e.copy(t),e.x+=s1.x,e.y+=s1.y,e.applyMatrix4(Qne)}const CM=new he,H7=new he;class Jne extends Zi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const i=t.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),t<s)break}return i[r-1].object}return null}raycast(t,i){if(this.levels.length>0){CM.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(CM);this.getObjectForDistance(n).raycast(t,i)}}update(t){const i=this.levels;if(i.length>1){CM.setFromMatrixPosition(t.matrixWorld),H7.setFromMatrixPosition(this.matrixWorld);const r=CM.distanceTo(H7)/t.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(t){const i=super.toJSON(t);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const G7=new he,W7=new nr,X7=new nr,JWe=new he,q7=new ui,TM=new he,NL=new Qs,Y7=new ui,zL=new xm;class $ne extends An{constructor(t,i){super(t,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=RN,this.bindMatrix=new ui,this.bindMatrixInverse=new ui,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new ba),this.boundingBox.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,TM),this.boundingBox.expandByPoint(TM)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Qs),this.boundingSphere.makeEmpty();const i=t.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,TM),this.boundingSphere.expandByPoint(TM)}copy(t,i){return super.copy(t,i),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),NL.copy(this.boundingSphere),NL.applyMatrix4(n),t.ray.intersectsSphere(NL)!==!1&&(Y7.copy(n).invert(),zL.copy(t.ray).applyMatrix4(Y7),!(this.boundingBox!==null&&zL.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,i,zL)))}getVertexPosition(t,i){return super.getVertexPosition(t,i),this.applyBoneTransform(t,i),i}bind(t,i){this.skeleton=t,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new nr,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){t.fromBufferAttribute(i,r);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===RN?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===hne?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,i){const r=this.skeleton,n=this.geometry;W7.fromBufferAttribute(n.attributes.skinIndex,t),X7.fromBufferAttribute(n.attributes.skinWeight,t),G7.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=X7.getComponent(s);if(a!==0){const o=W7.getComponent(s);q7.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(JWe.copy(G7).applyMatrix4(q7),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class rF extends Zi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Gd extends en{constructor(t=null,i=1,r=1,n,s,a,o,l,c=cn,u=cn,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:t,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Z7=new ui,$We=new ui;class QT{constructor(t=[],i=[]){this.uuid=fo(),this.bones=t.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),i.length===0)this.calculateInverses();else if(t.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new ui)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,i=this.bones.length;t<i;t++){const r=new ui;this.bones[t]&&r.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&r.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const t=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=t.length;s<a;s++){const o=t[s]?t[s].matrixWorld:$We;Z7.multiplyMatrices(o,i[s]),Z7.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new QT(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4);i.set(this.boneMatrices);const r=new Gd(i,t,t,fa,oo);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(t){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===t)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,i){this.uuid=t.uuid;for(let r=0,n=t.bones.length;r<n;r++){const s=t.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new rF),this.bones.push(a),this.boneInverses.push(new ui().fromArray(t.boneInverses[r]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];t.bones.push(a.uuid);const o=r[n];t.boneInverses.push(o.toArray())}return t}}class x0 extends pr{constructor(t,i,r,n=1){super(t,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ng=new ui,Q7=new ui,PM=[],K7=new ba,e8e=new ui,o1=new An,l1=new Qs;class ese extends An{constructor(t,i,r){super(t,i),this.isInstancedMesh=!0,this.instanceMatrix=new x0(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,e8e)}computeBoundingBox(){const t=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new ba),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Ng),K7.copy(t.boundingBox).applyMatrix4(Ng),this.boundingBox.union(K7)}computeBoundingSphere(){const t=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new Qs),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Ng),l1.copy(t.boundingSphere).applyMatrix4(Ng),this.boundingSphere.union(l1)}copy(t,i){return super.copy(t,i),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,i){i.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,i){i.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,i){const r=i.morphTargetInfluences,n=this.morphTexture.source.data.data,s=r.length+1,a=t*s+1;for(let o=0;o<r.length;o++)r[o]=n[a+o]}raycast(t,i){const r=this.matrixWorld,n=this.count;if(o1.geometry=this.geometry,o1.material=this.material,o1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),l1.copy(this.boundingSphere),l1.applyMatrix4(r),t.ray.intersectsSphere(l1)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,Ng),Q7.multiplyMatrices(r,Ng),o1.matrixWorld=Q7,o1.raycast(t,PM);for(let a=0,o=PM.length;a<o;a++){const l=PM[a];l.instanceId=s,l.object=this,i.push(l)}PM.length=0}}setColorAt(t,i){this.instanceColor===null&&(this.instanceColor=new x0(new Float32Array(this.instanceMatrix.count*3),3)),i.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,i){i.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,i){const r=i.morphTargetInfluences,n=r.length+1;this.morphTexture===null&&(this.morphTexture=new Gd(new Float32Array(n*this.count),n,this.count,kU,oo));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<r.length;c++)a+=r[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=n*t;s[l]=o,s.set(r,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function t8e(e,t){return e.z-t.z}function i8e(e,t){return t.z-e.z}class r8e{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,i){const r=this.pool,n=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const s=r[this.index];n.push(s),this.index++,s.start=t.start,s.count=t.count,s.z=i}reset(){this.list.length=0,this.index=0}}const zg="batchId",Zh=new ui,J7=new ui,n8e=new ui,$7=new ui,BL=new dw,DM=new ba,Up=new Qs,c1=new he,kL=new r8e,Fs=new An,LM=[];function s8e(e,t,i=0){const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const n=e.count;for(let s=0;s<n;s++)for(let a=0;a<r;a++)t.setComponent(s+i,a,e.getComponent(s,a))}else t.array.set(e.array,i*r);t.needsUpdate=!0}class tse extends An{get maxGeometryCount(){return this._maxGeometryCount}constructor(t,i,r=i*2,n){super(new Ei,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=t,this._maxVertexCount=i,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let t=Math.sqrt(this._maxGeometryCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const i=new Float32Array(t*t*4),r=new Gd(i,t,t,fa,oo);this._matricesTexture=r}_initializeGeometry(t){const i=this.geometry,r=this._maxVertexCount,n=this._maxGeometryCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in t.attributes){const l=t.getAttribute(o),{array:c,itemSize:u,normalized:h}=l,d=new c.constructor(r*u),p=new l.constructor(d,u,h);p.setUsage(l.usage),i.setAttribute(o,p)}if(t.getIndex()!==null){const o=r>65536?new Uint32Array(s):new Uint16Array(s);i.setIndex(new pr(o,1))}const a=n>65536?new Uint32Array(r):new Uint16Array(r);i.setAttribute(zg,new pr(a,1)),this._geometryInitialized=!0}}_validateGeometry(t){if(t.getAttribute(zg))throw new Error(`BatchedMesh: Geometry cannot use attribute "${zg}"`);const i=this.geometry;if(!!t.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(r===zg)continue;if(!t.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=t.getAttribute(r),s=i.getAttribute(r);if(n.itemSize!==s.itemSize||n.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ba);const t=this._geometryCount,i=this.boundingBox,r=this._active;i.makeEmpty();for(let n=0;n<t;n++)r[n]!==!1&&(this.getMatrixAt(n,Zh),this.getBoundingBoxAt(n,DM).applyMatrix4(Zh),i.union(DM))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qs);const t=this._geometryCount,i=this.boundingSphere,r=this._active;i.makeEmpty();for(let n=0;n<t;n++)r[n]!==!1&&(this.getMatrixAt(n,Zh),this.getBoundingSphereAt(n,Up).applyMatrix4(Zh),i.union(Up))}addGeometry(t,i=-1,r=-1){if(this._initializeGeometry(t),this._validateGeometry(t),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const n={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let s=null;const a=this._reservedRanges,o=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(s=a[a.length-1]),i===-1?n.vertexCount=t.getAttribute("position").count:n.vertexCount=i,s===null?n.vertexStart=0:n.vertexStart=s.vertexStart+s.vertexCount;const c=t.getIndex(),u=c!==null;if(u&&(r===-1?n.indexCount=c.count:n.indexCount=r,s===null?n.indexStart=0:n.indexStart=s.indexStart+s.indexCount),n.indexStart!==-1&&n.indexStart+n.indexCount>this._maxIndexCount||n.vertexStart+n.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,d=this._active,p=this._matricesTexture,f=this._matricesTexture.image.data;h.push(!0),d.push(!0);const v=this._geometryCount;this._geometryCount++,n8e.toArray(f,v*16),p.needsUpdate=!0,a.push(n),o.push({start:u?n.indexStart:n.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new ba,sphereInitialized:!1,sphere:new Qs});const m=this.geometry.getAttribute(zg);for(let g=0;g<n.vertexCount;g++)m.setX(n.vertexStart+g,v);return m.needsUpdate=!0,this.setGeometryAt(v,t),v}setGeometryAt(t,i){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,n=r.getIndex()!==null,s=r.getIndex(),a=i.getIndex(),o=this._reservedRanges[t];if(n&&a.count>o.indexCount||i.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.vertexCount;for(const p in r.attributes){if(p===zg)continue;const f=i.getAttribute(p),v=r.getAttribute(p);s8e(f,v,l);const m=f.itemSize;for(let g=f.count,y=c;g<y;g++){const x=l+g;for(let _=0;_<m;_++)v.setComponent(x,_,0)}v.needsUpdate=!0}if(n){const p=o.indexStart;for(let f=0;f<a.count;f++)s.setX(p+f,l+a.getX(f));for(let f=a.count,v=o.indexCount;f<v;f++)s.setX(p+f,l);s.needsUpdate=!0}const u=this._bounds[t];i.boundingBox!==null?(u.box.copy(i.boundingBox),u.boxInitialized=!0):u.boxInitialized=!1,i.boundingSphere!==null?(u.sphere.copy(i.boundingSphere),u.sphereInitialized=!0):u.sphereInitialized=!1;const h=this._drawRanges[t],d=i.getAttribute("position");return h.count=n?a.count:d.count,this._visibilityChanged=!0,t}deleteGeometry(t){const i=this._active;return t>=i.length||i[t]===!1?this:(i[t]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(t,i){if(this._active[t]===!1)return null;const n=this._bounds[t],s=n.box,a=this.geometry;if(n.boxInitialized===!1){s.makeEmpty();const o=a.index,l=a.attributes.position,c=this._drawRanges[t];for(let u=c.start,h=c.start+c.count;u<h;u++){let d=u;o&&(d=o.getX(d)),s.expandByPoint(c1.fromBufferAttribute(l,d))}n.boxInitialized=!0}return i.copy(s),i}getBoundingSphereAt(t,i){if(this._active[t]===!1)return null;const n=this._bounds[t],s=n.sphere,a=this.geometry;if(n.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(t,DM),DM.getCenter(s.center);const o=a.index,l=a.attributes.position,c=this._drawRanges[t];let u=0;for(let h=c.start,d=c.start+c.count;h<d;h++){let p=h;o&&(p=o.getX(p)),c1.fromBufferAttribute(l,p),u=Math.max(u,s.center.distanceToSquared(c1))}s.radius=Math.sqrt(u),n.sphereInitialized=!0}return i.copy(s),i}setMatrixAt(t,i){const r=this._active,n=this._matricesTexture,s=this._matricesTexture.image.data,a=this._geometryCount;return t>=a||r[t]===!1?this:(i.toArray(s,t*16),n.needsUpdate=!0,this)}getMatrixAt(t,i){const r=this._active,n=this._matricesTexture.image.data,s=this._geometryCount;return t>=s||r[t]===!1?null:i.fromArray(n,t*16)}setVisibleAt(t,i){const r=this._visibility,n=this._active,s=this._geometryCount;return t>=s||n[t]===!1||r[t]===i?this:(r[t]=i,this._visibilityChanged=!0,this)}getVisibleAt(t){const i=this._visibility,r=this._active,n=this._geometryCount;return t>=n||r[t]===!1?!1:i[t]}raycast(t,i){const r=this._visibility,n=this._active,s=this._drawRanges,a=this._geometryCount,o=this.matrixWorld,l=this.geometry;Fs.material=this.material,Fs.geometry.index=l.index,Fs.geometry.attributes=l.attributes,Fs.geometry.boundingBox===null&&(Fs.geometry.boundingBox=new ba),Fs.geometry.boundingSphere===null&&(Fs.geometry.boundingSphere=new Qs);for(let c=0;c<a;c++){if(!r[c]||!n[c])continue;const u=s[c];Fs.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(c,Fs.matrixWorld).premultiply(o),this.getBoundingBoxAt(c,Fs.geometry.boundingBox),this.getBoundingSphereAt(c,Fs.geometry.boundingSphere),Fs.raycast(t,LM);for(let h=0,d=LM.length;h<d;h++){const p=LM[h];p.object=this,p.batchId=c,i.push(p)}LM.length=0}Fs.material=null,Fs.geometry.index=null,Fs.geometry.attributes={},Fs.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._drawRanges=t._drawRanges.map(i=>({...i})),this._reservedRanges=t._reservedRanges.map(i=>({...i})),this._visibility=t._visibility.slice(),this._active=t._active.slice(),this._bounds=t._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxGeometryCount=t._maxGeometryCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(t,i,r,n,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=n.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._active,c=this._visibility,u=this._multiDrawStarts,h=this._multiDrawCounts,d=this._drawRanges,p=this.perObjectFrustumCulled;p&&($7.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),BL.setFromProjectionMatrix($7,t.coordinateSystem));let f=0;if(this.sortObjects){J7.copy(this.matrixWorld).invert(),c1.setFromMatrixPosition(r.matrixWorld).applyMatrix4(J7);for(let g=0,y=c.length;g<y;g++)if(c[g]&&l[g]){this.getMatrixAt(g,Zh),this.getBoundingSphereAt(g,Up).applyMatrix4(Zh);let x=!1;if(p&&(x=!BL.intersectsSphere(Up)),!x){const _=c1.distanceTo(Up.center);kL.push(d[g],_)}}const v=kL.list,m=this.customSort;m===null?v.sort(s.transparent?i8e:t8e):m.call(this,v,r);for(let g=0,y=v.length;g<y;g++){const x=v[g];u[f]=x.start*o,h[f]=x.count,f++}kL.reset()}else for(let v=0,m=c.length;v<m;v++)if(c[v]&&l[v]){let g=!1;if(p&&(this.getMatrixAt(v,Zh),this.getBoundingSphereAt(v,Up).applyMatrix4(Zh),g=!BL.intersectsSphere(Up)),!g){const y=d[v];u[f]=y.start*o,h[f]=y.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(t,i,r,n,s,a){this.onBeforeRender(t,null,n,s,a)}}class Aa extends ea{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Rt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const eX=new he,tX=new he,iX=new ui,UL=new xm,RM=new Qs;class ep extends Zi{constructor(t=new Ei,i=new Aa){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)eX.fromBufferAttribute(i,n-1),tX.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=eX.distanceTo(tX);t.setAttribute("lineDistance",new Ut(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),RM.copy(r.boundingSphere),RM.applyMatrix4(n),RM.radius+=s,t.ray.intersectsSphere(RM)===!1)return;iX.copy(n).invert(),UL.copy(t.ray).applyMatrix4(iX);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=new he,u=new he,h=new he,d=new he,p=this.isLineSegments?2:1,f=r.index,m=r.attributes.position;if(f!==null){const g=Math.max(0,a.start),y=Math.min(f.count,a.start+a.count);for(let x=g,_=y-1;x<_;x+=p){const M=f.getX(x),S=f.getX(x+1);if(c.fromBufferAttribute(m,M),u.fromBufferAttribute(m,S),UL.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const A=t.ray.origin.distanceTo(d);A<t.near||A>t.far||i.push({distance:A,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else{const g=Math.max(0,a.start),y=Math.min(m.count,a.start+a.count);for(let x=g,_=y-1;x<_;x+=p){if(c.fromBufferAttribute(m,x),u.fromBufferAttribute(m,x+1),UL.distanceSqToSegment(c,u,d,h)>l)continue;d.applyMatrix4(this.matrixWorld);const S=t.ray.origin.distanceTo(d);S<t.near||S>t.far||i.push({distance:S,point:h.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}const rX=new he,nX=new he;class Qc extends ep{constructor(t,i){super(t,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const i=t.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)rX.fromBufferAttribute(i,n),nX.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+rX.distanceTo(nX);t.setAttribute("lineDistance",new Ut(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class ise extends ep{constructor(t,i){super(t,i),this.isLineLoop=!0,this.type="LineLoop"}}class nF extends ea{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Rt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const sX=new ui,cz=new xm,IM=new Qs,OM=new he;class rse extends Zi{constructor(t=new Ei,i=new nF){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=i,this.updateMorphTargets()}copy(t,i){return super.copy(t,i),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,i){const r=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),IM.copy(r.boundingSphere),IM.applyMatrix4(n),IM.radius+=s,t.ray.intersectsSphere(IM)===!1)return;sX.copy(n).invert(),cz.copy(t.ray).applyMatrix4(sX);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let f=d,v=p;f<v;f++){const m=c.getX(f);OM.fromBufferAttribute(h,m),aX(OM,m,l,n,t,i,this)}}else{const d=Math.max(0,a.start),p=Math.min(h.count,a.start+a.count);for(let f=d,v=p;f<v;f++)OM.fromBufferAttribute(h,f),aX(OM,f,l,n,t,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function aX(e,t,i,r,n,s,a){const o=cz.distanceSqToPoint(e);if(o<i){const l=new he;cz.closestPointToPoint(e,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:t,face:null,object:a})}}class a8e extends en{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.minFilter=a!==void 0?a:Nr,this.magFilter=s!==void 0?s:Nr,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,t.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class o8e extends en{constructor(t,i){super({width:t,height:i}),this.isFramebufferTexture=!0,this.magFilter=cn,this.minFilter=cn,this.generateMipmaps=!1,this.needsUpdate=!0}}class KT extends en{constructor(t,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class l8e extends KT{constructor(t,i,r,n,s,a){super(t,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=Ws}}class c8e extends KT{constructor(t,i,r){super(void 0,t[0].width,t[0].height,i,r,dh),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class u8e extends en{constructor(t,i,r,n,s,a,o,l,c){super(t,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Yl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,i){const r=this.getUtoTmapping(t);return this.getPoint(r,i)}getPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return i}getSpacedPoints(t=5){const i=[];for(let r=0;r<=t;r++)i.push(this.getPointAt(r/t));return i}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=t;a++)r=this.getPoint(a/t),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,i){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=t*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,p=(a-u)/d;return(n+p)/(s-1)}getTangent(t,i){let n=t-1e-4,s=t+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new nt:new he);return l.copy(o).sub(a).normalize(),l}getTangentAt(t,i){const r=this.getUtoTmapping(t);return this.getTangent(r,i)}computeFrenetFrames(t,i){const r=new he,n=[],s=[],a=[],o=new he,l=new ui;for(let p=0;p<=t;p++){const f=p/t;n[p]=this.getTangentAt(f,new he)}s[0]=new he,a[0]=new he;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let p=1;p<=t;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(n[p-1],n[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(Kr(n[p-1].dot(n[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(o,f))}a[p].crossVectors(n[p],s[p])}if(i===!0){let p=Math.acos(Kr(s[0].dot(s[t]),-1,1));p/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(p=-p);for(let f=1;f<=t;f++)s[f].applyMatrix4(l.makeRotationAxis(n[f],p*f)),a[f].crossVectors(n[f],s[f])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class JT extends Yl{constructor(t=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(t,i=new nt){const r=i,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+t*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*u-p*h+this.aX,c=d*h+p*u+this.aY}return r.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class nse extends JT{constructor(t,i,r,n,s,a){super(t,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function sF(){let e=0,t=0,i=0,r=0;function n(s,a,o,l){e=s,t=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,p=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,p*=u,n(a,o,d,p)},calc:function(s){const a=s*s,o=a*s;return e+t*s+i*a+r*o}}}const NM=new he,FL=new sF,VL=new sF,jL=new sF;class sse extends Yl{constructor(t=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=i,this.curveType=r,this.tension=n}getPoint(t,i=new he){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*t;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(NM.subVectors(n[0],n[1]).add(n[0]),c=NM);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(NM.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=NM),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(c.distanceToSquared(h),p),v=Math.pow(h.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(u),p);v<1e-4&&(v=1),f<1e-4&&(f=v),m<1e-4&&(m=v),FL.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,f,v,m),VL.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,f,v,m),jL.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,f,v,m)}else this.curveType==="catmullrom"&&(FL.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),VL.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),jL.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(FL.calc(l),VL.calc(l),jL.calc(l)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new he().fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function oX(e,t,i,r,n){const s=(r-t)*.5,a=(n-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*e+i}function h8e(e,t){const i=1-e;return i*i*t}function d8e(e,t){return 2*(1-e)*e*t}function p8e(e,t){return e*e*t}function px(e,t,i,r){return h8e(e,t)+d8e(e,i)+p8e(e,r)}function f8e(e,t){const i=1-e;return i*i*i*t}function m8e(e,t){const i=1-e;return 3*i*i*e*t}function g8e(e,t){return 3*(1-e)*e*e*t}function v8e(e,t){return e*e*e*t}function fx(e,t,i,r,n){return f8e(e,t)+m8e(e,i)+g8e(e,r)+v8e(e,n)}class aF extends Yl{constructor(t=new nt,i=new nt,r=new nt,n=new nt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new nt){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(fx(t,n.x,s.x,a.x,o.x),fx(t,n.y,s.y,a.y,o.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class ase extends Yl{constructor(t=new he,i=new he,r=new he,n=new he){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=i,this.v2=r,this.v3=n}getPoint(t,i=new he){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(fx(t,n.x,s.x,a.x,o.x),fx(t,n.y,s.y,a.y,o.y),fx(t,n.z,s.z,a.z,o.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class oF extends Yl{constructor(t=new nt,i=new nt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=i}getPoint(t,i=new nt){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new nt){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class ose extends Yl{constructor(t=new he,i=new he){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=i}getPoint(t,i=new he){const r=i;return t===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r}getPointAt(t,i){return this.getPoint(t,i)}getTangent(t,i=new he){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,i){return this.getTangent(t,i)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class lF extends Yl{constructor(t=new nt,i=new nt,r=new nt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new nt){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(px(t,n.x,s.x,a.x),px(t,n.y,s.y,a.y)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class cF extends Yl{constructor(t=new he,i=new he,r=new he){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=i,this.v2=r}getPoint(t,i=new he){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(px(t,n.x,s.x,a.x),px(t,n.y,s.y,a.y),px(t,n.z,s.z,a.z)),r}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class uF extends Yl{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,i=new nt){const r=i,n=this.points,s=(n.length-1)*t,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(oX(o,l.x,c.x,u.x,h.x),oX(o,l.y,c.y,u.y,h.y)),r}copy(t){super.copy(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let i=0,r=t.points.length;i<r;i++){const n=t.points[i];this.points.push(new nt().fromArray(n))}return this}}var LC=Object.freeze({__proto__:null,ArcCurve:nse,CatmullRomCurve3:sse,CubicBezierCurve:aF,CubicBezierCurve3:ase,EllipseCurve:JT,LineCurve:oF,LineCurve3:ose,QuadraticBezierCurve:lF,QuadraticBezierCurve3:cF,SplineCurve:uF});class lse extends Yl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(i)){const r=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new LC[r](i,t))}return this}getPoint(t,i){const r=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),t.push(i);return this.cacheLengths=t,t}getSpacedPoints(t=40){const i=[];for(let r=0;r<=t;r++)i.push(this.getPoint(r/t));return this.autoClose&&i.push(i[0]),i}getPoints(t=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(t){super.copy(t),this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,r=t.curves.length;i<r;i++){const n=t.curves[i];this.curves.push(new LC[n.type]().fromJSON(n))}return this}}class Sb extends lse{constructor(t){super(),this.type="Path",this.currentPoint=new nt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let i=1,r=t.length;i<r;i++)this.lineTo(t[i].x,t[i].y);return this}moveTo(t,i){return this.currentPoint.set(t,i),this}lineTo(t,i){const r=new oF(this.currentPoint.clone(),new nt(t,i));return this.curves.push(r),this.currentPoint.set(t,i),this}quadraticCurveTo(t,i,r,n){const s=new lF(this.currentPoint.clone(),new nt(t,i),new nt(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(t,i,r,n,s,a){const o=new aF(this.currentPoint.clone(),new nt(t,i),new nt(r,n),new nt(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(t){const i=[this.currentPoint.clone()].concat(t),r=new uF(i);return this.curves.push(r),this.currentPoint.copy(t[t.length-1]),this}arc(t,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+o,i+l,r,n,s,a),this}absarc(t,i,r,n,s,a){return this.absellipse(t,i,r,r,n,s,a),this}ellipse(t,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+c,i+u,r,n,s,a,o,l),this}absellipse(t,i,r,n,s,a,o,l){const c=new JT(t,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class pw extends Ei{constructor(t=[new nt(0,-.5),new nt(.5,0),new nt(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=Kr(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new he,d=new nt,p=new he,f=new he,v=new he;let m=0,g=0;for(let y=0;y<=t.length-1;y++)switch(y){case 0:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,p.x=g*1,p.y=-m,p.z=g*0,v.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case t.length-1:l.push(v.x,v.y,v.z);break;default:m=t[y+1].x-t[y].x,g=t[y+1].y-t[y].y,p.x=g*1,p.y=-m,p.z=g*0,f.copy(p),p.x+=v.x,p.y+=v.y,p.z+=v.z,p.normalize(),l.push(p.x,p.y,p.z),v.copy(f)}for(let y=0;y<=i;y++){const x=r+y*u*n,_=Math.sin(x),M=Math.cos(x);for(let S=0;S<=t.length-1;S++){h.x=t[S].x*_,h.y=t[S].y,h.z=t[S].x*M,a.push(h.x,h.y,h.z),d.x=y/i,d.y=S/(t.length-1),o.push(d.x,d.y);const E=l[3*S+0]*_,A=l[3*S+1],P=l[3*S+0]*M;c.push(E,A,P)}}for(let y=0;y<i;y++)for(let x=0;x<t.length-1;x++){const _=x+y*t.length,M=_,S=_+t.length,E=_+t.length+1,A=_+1;s.push(M,S,A),s.push(E,A,S)}this.setIndex(s),this.setAttribute("position",new Ut(a,3)),this.setAttribute("uv",new Ut(o,2)),this.setAttribute("normal",new Ut(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new pw(t.points,t.segments,t.phiStart,t.phiLength)}}class $T extends pw{constructor(t=1,i=1,r=4,n=8){const s=new Sb;s.absarc(0,-i/2,t,Math.PI*1.5,0),s.absarc(0,i/2,t,0,Math.PI*.5),super(s.getPoints(r),n),this.type="CapsuleGeometry",this.parameters={radius:t,length:i,capSegments:r,radialSegments:n}}static fromJSON(t){return new $T(t.radius,t.length,t.capSegments,t.radialSegments)}}class e2 extends Ei{constructor(t=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new he,u=new nt;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const p=r+h/i*n;c.x=t*Math.cos(p),c.y=t*Math.sin(p),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/t+1)/2,u.y=(a[d+1]/t+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new Ut(a,3)),this.setAttribute("normal",new Ut(o,3)),this.setAttribute("uv",new Ut(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new e2(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class q0 extends Ei{constructor(t=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],p=[];let f=0;const v=[],m=r/2;let g=0;y(),a===!1&&(t>0&&x(!0),i>0&&x(!1)),this.setIndex(u),this.setAttribute("position",new Ut(h,3)),this.setAttribute("normal",new Ut(d,3)),this.setAttribute("uv",new Ut(p,2));function y(){const _=new he,M=new he;let S=0;const E=(i-t)/r;for(let A=0;A<=s;A++){const P=[],C=A/s,D=C*(i-t)+t;for(let N=0;N<=n;N++){const U=N/n,I=U*l+o,G=Math.sin(I),Q=Math.cos(I);M.x=D*G,M.y=-C*r+m,M.z=D*Q,h.push(M.x,M.y,M.z),_.set(G,E,Q).normalize(),d.push(_.x,_.y,_.z),p.push(U,1-C),P.push(f++)}v.push(P)}for(let A=0;A<n;A++)for(let P=0;P<s;P++){const C=v[P][A],D=v[P+1][A],N=v[P+1][A+1],U=v[P][A+1];u.push(C,D,U),u.push(D,N,U),S+=6}c.addGroup(g,S,0),g+=S}function x(_){const M=f,S=new nt,E=new he;let A=0;const P=_===!0?t:i,C=_===!0?1:-1;for(let N=1;N<=n;N++)h.push(0,m*C,0),d.push(0,C,0),p.push(.5,.5),f++;const D=f;for(let N=0;N<=n;N++){const I=N/n*l+o,G=Math.cos(I),Q=Math.sin(I);E.x=P*Q,E.y=m*C,E.z=P*G,h.push(E.x,E.y,E.z),d.push(0,C,0),S.x=G*.5+.5,S.y=Q*.5*C+.5,p.push(S.x,S.y),f++}for(let N=0;N<n;N++){const U=M+N,I=D+N;_===!0?u.push(I,I+1,U):u.push(I+1,I,U),A+=3}c.addGroup(g,A,_===!0?1:2),g+=A}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new q0(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class t2 extends q0{constructor(t=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,t,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(t){return new t2(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class dp extends Ei{constructor(t=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new Ut(s,3)),this.setAttribute("normal",new Ut(s.slice(),3)),this.setAttribute("uv",new Ut(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(y){const x=new he,_=new he,M=new he;for(let S=0;S<i.length;S+=3)p(i[S+0],x),p(i[S+1],_),p(i[S+2],M),l(x,_,M,y)}function l(y,x,_,M){const S=M+1,E=[];for(let A=0;A<=S;A++){E[A]=[];const P=y.clone().lerp(_,A/S),C=x.clone().lerp(_,A/S),D=S-A;for(let N=0;N<=D;N++)N===0&&A===S?E[A][N]=P:E[A][N]=P.clone().lerp(C,N/D)}for(let A=0;A<S;A++)for(let P=0;P<2*(S-A)-1;P++){const C=Math.floor(P/2);P%2===0?(d(E[A][C+1]),d(E[A+1][C]),d(E[A][C])):(d(E[A][C+1]),d(E[A+1][C+1]),d(E[A+1][C]))}}function c(y){const x=new he;for(let _=0;_<s.length;_+=3)x.x=s[_+0],x.y=s[_+1],x.z=s[_+2],x.normalize().multiplyScalar(y),s[_+0]=x.x,s[_+1]=x.y,s[_+2]=x.z}function u(){const y=new he;for(let x=0;x<s.length;x+=3){y.x=s[x+0],y.y=s[x+1],y.z=s[x+2];const _=m(y)/2/Math.PI+.5,M=g(y)/Math.PI+.5;a.push(_,1-M)}f(),h()}function h(){for(let y=0;y<a.length;y+=6){const x=a[y+0],_=a[y+2],M=a[y+4],S=Math.max(x,_,M),E=Math.min(x,_,M);S>.9&&E<.1&&(x<.2&&(a[y+0]+=1),_<.2&&(a[y+2]+=1),M<.2&&(a[y+4]+=1))}}function d(y){s.push(y.x,y.y,y.z)}function p(y,x){const _=y*3;x.x=t[_+0],x.y=t[_+1],x.z=t[_+2]}function f(){const y=new he,x=new he,_=new he,M=new he,S=new nt,E=new nt,A=new nt;for(let P=0,C=0;P<s.length;P+=9,C+=6){y.set(s[P+0],s[P+1],s[P+2]),x.set(s[P+3],s[P+4],s[P+5]),_.set(s[P+6],s[P+7],s[P+8]),S.set(a[C+0],a[C+1]),E.set(a[C+2],a[C+3]),A.set(a[C+4],a[C+5]),M.copy(y).add(x).add(_).divideScalar(3);const D=m(M);v(S,C+0,y,D),v(E,C+2,x,D),v(A,C+4,_,D)}}function v(y,x,_,M){M<0&&y.x===1&&(a[x]=y.x-1),_.x===0&&_.z===0&&(a[x]=M/2/Math.PI+.5)}function m(y){return Math.atan2(y.z,-y.x)}function g(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new dp(t.vertices,t.indices,t.radius,t.details)}}class i2 extends dp{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,t,i),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new i2(t.radius,t.detail)}}const zM=new he,BM=new he,HL=new he,kM=new lo;class cse extends Ei{constructor(t=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:i},t!==null){const n=Math.pow(10,4),s=Math.cos(Vf*i),a=t.getIndex(),o=t.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},p=[];for(let f=0;f<l;f+=3){a?(c[0]=a.getX(f),c[1]=a.getX(f+1),c[2]=a.getX(f+2)):(c[0]=f,c[1]=f+1,c[2]=f+2);const{a:v,b:m,c:g}=kM;if(v.fromBufferAttribute(o,c[0]),m.fromBufferAttribute(o,c[1]),g.fromBufferAttribute(o,c[2]),kM.getNormal(HL),h[0]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,h[1]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,h[2]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let y=0;y<3;y++){const x=(y+1)%3,_=h[y],M=h[x],S=kM[u[y]],E=kM[u[x]],A=`${_}_${M}`,P=`${M}_${_}`;P in d&&d[P]?(HL.dot(d[P].normal)<=s&&(p.push(S.x,S.y,S.z),p.push(E.x,E.y,E.z)),d[P]=null):A in d||(d[A]={index0:c[y],index1:c[x],normal:HL.clone()})}}for(const f in d)if(d[f]){const{index0:v,index1:m}=d[f];zM.fromBufferAttribute(o,v),BM.fromBufferAttribute(o,m),p.push(zM.x,zM.y,zM.z),p.push(BM.x,BM.y,BM.z)}this.setAttribute("position",new Ut(p,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Hf extends Sb{constructor(t){super(t),this.uuid=fo(),this.type="Shape",this.holes=[]}getPointsHoles(t){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(t);return i}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let i=0,r=t.holes.length;i<r;i++){const n=t.holes[i];this.holes.push(new Sb().fromJSON(n))}return this}}const y8e={triangulate:function(e,t,i=2){const r=t&&t.length,n=r?t[0]*i:e.length;let s=use(e,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,p;if(r&&(s=S8e(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<n;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return Mb(s,a,i,o,l,p,0),a}};function use(e,t,i,r,n){let s,a;if(n===O8e(e,t,i,r)>0)for(s=t;s<i;s+=r)a=lX(s,e[s],e[s+1],a);else for(s=i-r;s>=t;s-=r)a=lX(s,e[s],e[s+1],a);return a&&r2(a,a.next)&&(Ab(a),a=a.next),a}function am(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(r2(i,i.next)||kr(i.prev,i,i.next)===0)){if(Ab(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function Mb(e,t,i,r,n,s,a){if(!e)return;!a&&s&&T8e(e,r,n,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?b8e(e,r,n,s):x8e(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),Ab(e),e=c.next,o=c.next;continue}if(e=c,e===o){a?a===1?(e=w8e(am(e),t,i),Mb(e,t,i,r,n,s,2)):a===2&&_8e(e,t,i,r,n,s):Mb(am(e),t,i,r,n,s,1);break}}}function x8e(e){const t=e.prev,i=e,r=e.next;if(kr(t,i,r)>=0)return!1;const n=t.x,s=i.x,a=r.x,o=t.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,p=o>l?o>c?o:c:l>c?l:c;let f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&_v(n,o,s,l,a,c,f.x,f.y)&&kr(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function b8e(e,t,i,r){const n=e.prev,s=e,a=e.next;if(kr(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,v=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,g=uz(p,f,t,i,r),y=uz(v,m,t,i,r);let x=e.prevZ,_=e.nextZ;for(;x&&x.z>=g&&_&&_.z<=y;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=m&&x!==n&&x!==a&&_v(o,u,l,h,c,d,x.x,x.y)&&kr(x.prev,x,x.next)>=0||(x=x.prevZ,_.x>=p&&_.x<=v&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&_v(o,u,l,h,c,d,_.x,_.y)&&kr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;x&&x.z>=g;){if(x.x>=p&&x.x<=v&&x.y>=f&&x.y<=m&&x!==n&&x!==a&&_v(o,u,l,h,c,d,x.x,x.y)&&kr(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=y;){if(_.x>=p&&_.x<=v&&_.y>=f&&_.y<=m&&_!==n&&_!==a&&_v(o,u,l,h,c,d,_.x,_.y)&&kr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function w8e(e,t,i){let r=e;do{const n=r.prev,s=r.next.next;!r2(n,s)&&hse(n,r,r.next,s)&&Eb(n,s)&&Eb(s,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),Ab(r),Ab(r.next),r=e=s),r=r.next}while(r!==e);return am(r)}function _8e(e,t,i,r,n,s){let a=e;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&L8e(a,o)){let l=dse(a,o);a=am(a,a.next),l=am(l,l.next),Mb(a,t,i,r,n,s,0),Mb(l,t,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==e)}function S8e(e,t,i,r){const n=[];let s,a,o,l,c;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,c=use(e,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(D8e(c));for(n.sort(M8e),s=0;s<n.length;s++)i=E8e(n[s],i);return i}function M8e(e,t){return e.x-t.x}function E8e(e,t){const i=A8e(e,t);if(!i)return t;const r=dse(i,e);return am(r,r.next),am(i,i.next)}function A8e(e,t){let i=t,r=-1/0,n;const s=e.x,a=e.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){const d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==t);if(!n)return null;const o=n,l=n.x,c=n.y;let u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&_v(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),Eb(i,e)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&C8e(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function C8e(e,t){return kr(e.prev,e,t.prev)<0&&kr(t.next,e,e.next)<0}function T8e(e,t,i,r){let n=e;do n.z===0&&(n.z=uz(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,P8e(n)}function P8e(e){let t,i,r,n,s,a,o,l,c=1;do{for(i=e,e=null,s=null,a=0;i;){for(a++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return e}function uz(e,t,i,r,n){return e=(e-i)*n|0,t=(t-r)*n|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function D8e(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function _v(e,t,i,r,n,s,a,o){return(n-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(i-a)*(t-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function L8e(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!R8e(e,t)&&(Eb(e,t)&&Eb(t,e)&&I8e(e,t)&&(kr(e.prev,e,t.prev)||kr(e,t.prev,t))||r2(e,t)&&kr(e.prev,e,e.next)>0&&kr(t.prev,t,t.next)>0)}function kr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function r2(e,t){return e.x===t.x&&e.y===t.y}function hse(e,t,i,r){const n=FM(kr(e,t,i)),s=FM(kr(e,t,r)),a=FM(kr(i,r,e)),o=FM(kr(i,r,t));return!!(n!==s&&a!==o||n===0&&UM(e,i,t)||s===0&&UM(e,r,t)||a===0&&UM(i,e,r)||o===0&&UM(i,t,r))}function UM(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function FM(e){return e>0?1:e<0?-1:0}function R8e(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&hse(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function Eb(e,t){return kr(e.prev,e,e.next)<0?kr(e,t,e.next)>=0&&kr(e,e.prev,t)>=0:kr(e,t,e.prev)<0||kr(e,e.next,t)<0}function I8e(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function dse(e,t){const i=new hz(e.i,e.x,e.y),r=new hz(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function lX(e,t,i,r){const n=new hz(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Ab(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function hz(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O8e(e,t,i,r){let n=0;for(let s=t,a=i-r;s<i;s+=r)n+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return n}class jc{static area(t){const i=t.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=t[n].x*t[s].y-t[s].x*t[n].y;return r*.5}static isClockWise(t){return jc.area(t)<0}static triangulateShape(t,i){const r=[],n=[],s=[];cX(t),uX(r,t);let a=t.length;i.forEach(cX);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,uX(r,i[l]);const o=y8e.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function cX(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function uX(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class n2 extends Ei{constructor(t=new Hf([new nt(.5,.5),new nt(-.5,.5),new nt(-.5,-.5),new nt(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:i},t=Array.isArray(t)?t:[t];const r=this,n=[],s=[];for(let o=0,l=t.length;o<l;o++){const c=t[o];a(c)}this.setAttribute("position",new Ut(n,3)),this.setAttribute("uv",new Ut(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,p=i.bevelThickness!==void 0?i.bevelThickness:.2,f=i.bevelSize!==void 0?i.bevelSize:p-.1,v=i.bevelOffset!==void 0?i.bevelOffset:0,m=i.bevelSegments!==void 0?i.bevelSegments:3;const g=i.extrudePath,y=i.UVGenerator!==void 0?i.UVGenerator:N8e;let x,_=!1,M,S,E,A;g&&(x=g.getSpacedPoints(u),_=!0,d=!1,M=g.computeFrenetFrames(u,!1),S=new he,E=new he,A=new he),d||(m=0,p=0,f=0,v=0);const P=o.extractPoints(c);let C=P.shape;const D=P.holes;if(!jc.isClockWise(C)){C=C.reverse();for(let te=0,we=D.length;te<we;te++){const Ce=D[te];jc.isClockWise(Ce)&&(D[te]=Ce.reverse())}}const U=jc.triangulateShape(C,D),I=C;for(let te=0,we=D.length;te<we;te++){const Ce=D[te];C=C.concat(Ce)}function G(te,we,Ce){return we||console.error("THREE.ExtrudeGeometry: vec does not exist"),te.clone().addScaledVector(we,Ce)}const Q=C.length,Y=U.length;function O(te,we,Ce){let Se,Re,Xe;const Be=te.x-we.x,Fe=te.y-we.y,dt=Ce.x-te.x,se=Ce.y-te.y,z=Be*Be+Fe*Fe,X=Be*se-Fe*dt;if(Math.abs(X)>Number.EPSILON){const ce=Math.sqrt(z),Ee=Math.sqrt(dt*dt+se*se),q=we.x-Fe/ce,Ye=we.y+Be/ce,et=Ce.x-se/Ee,ke=Ce.y+dt/Ee,_e=((et-q)*se-(ke-Ye)*dt)/(Be*se-Fe*dt);Se=q+Be*_e-te.x,Re=Ye+Fe*_e-te.y;const at=Se*Se+Re*Re;if(at<=2)return new nt(Se,Re);Xe=Math.sqrt(at/2)}else{let ce=!1;Be>Number.EPSILON?dt>Number.EPSILON&&(ce=!0):Be<-Number.EPSILON?dt<-Number.EPSILON&&(ce=!0):Math.sign(Fe)===Math.sign(se)&&(ce=!0),ce?(Se=-Fe,Re=Be,Xe=Math.sqrt(z)):(Se=Be,Re=Fe,Xe=Math.sqrt(z/2))}return new nt(Se/Xe,Re/Xe)}const V=[];for(let te=0,we=I.length,Ce=we-1,Se=te+1;te<we;te++,Ce++,Se++)Ce===we&&(Ce=0),Se===we&&(Se=0),V[te]=O(I[te],I[Ce],I[Se]);const F=[];let W,ee=V.concat();for(let te=0,we=D.length;te<we;te++){const Ce=D[te];W=[];for(let Se=0,Re=Ce.length,Xe=Re-1,Be=Se+1;Se<Re;Se++,Xe++,Be++)Xe===Re&&(Xe=0),Be===Re&&(Be=0),W[Se]=O(Ce[Se],Ce[Xe],Ce[Be]);F.push(W),ee=ee.concat(W)}for(let te=0;te<m;te++){const we=te/m,Ce=p*Math.cos(we*Math.PI/2),Se=f*Math.sin(we*Math.PI/2)+v;for(let Re=0,Xe=I.length;Re<Xe;Re++){const Be=G(I[Re],V[Re],Se);ye(Be.x,Be.y,-Ce)}for(let Re=0,Xe=D.length;Re<Xe;Re++){const Be=D[Re];W=F[Re];for(let Fe=0,dt=Be.length;Fe<dt;Fe++){const se=G(Be[Fe],W[Fe],Se);ye(se.x,se.y,-Ce)}}}const ae=f+v;for(let te=0;te<Q;te++){const we=d?G(C[te],ee[te],ae):C[te];_?(E.copy(M.normals[0]).multiplyScalar(we.x),S.copy(M.binormals[0]).multiplyScalar(we.y),A.copy(x[0]).add(E).add(S),ye(A.x,A.y,A.z)):ye(we.x,we.y,0)}for(let te=1;te<=u;te++)for(let we=0;we<Q;we++){const Ce=d?G(C[we],ee[we],ae):C[we];_?(E.copy(M.normals[te]).multiplyScalar(Ce.x),S.copy(M.binormals[te]).multiplyScalar(Ce.y),A.copy(x[te]).add(E).add(S),ye(A.x,A.y,A.z)):ye(Ce.x,Ce.y,h/u*te)}for(let te=m-1;te>=0;te--){const we=te/m,Ce=p*Math.cos(we*Math.PI/2),Se=f*Math.sin(we*Math.PI/2)+v;for(let Re=0,Xe=I.length;Re<Xe;Re++){const Be=G(I[Re],V[Re],Se);ye(Be.x,Be.y,h+Ce)}for(let Re=0,Xe=D.length;Re<Xe;Re++){const Be=D[Re];W=F[Re];for(let Fe=0,dt=Be.length;Fe<dt;Fe++){const se=G(Be[Fe],W[Fe],Se);_?ye(se.x,se.y+x[u-1].y,x[u-1].x+Ce):ye(se.x,se.y,h+Ce)}}}K(),$();function K(){const te=n.length/3;if(d){let we=0,Ce=Q*we;for(let Se=0;Se<Y;Se++){const Re=U[Se];pe(Re[2]+Ce,Re[1]+Ce,Re[0]+Ce)}we=u+m*2,Ce=Q*we;for(let Se=0;Se<Y;Se++){const Re=U[Se];pe(Re[0]+Ce,Re[1]+Ce,Re[2]+Ce)}}else{for(let we=0;we<Y;we++){const Ce=U[we];pe(Ce[2],Ce[1],Ce[0])}for(let we=0;we<Y;we++){const Ce=U[we];pe(Ce[0]+Q*u,Ce[1]+Q*u,Ce[2]+Q*u)}}r.addGroup(te,n.length/3-te,0)}function $(){const te=n.length/3;let we=0;ie(I,we),we+=I.length;for(let Ce=0,Se=D.length;Ce<Se;Ce++){const Re=D[Ce];ie(Re,we),we+=Re.length}r.addGroup(te,n.length/3-te,1)}function ie(te,we){let Ce=te.length;for(;--Ce>=0;){const Se=Ce;let Re=Ce-1;Re<0&&(Re=te.length-1);for(let Xe=0,Be=u+m*2;Xe<Be;Xe++){const Fe=Q*Xe,dt=Q*(Xe+1),se=we+Se+Fe,z=we+Re+Fe,X=we+Re+dt,ce=we+Se+dt;me(se,z,X,ce)}}}function ye(te,we,Ce){l.push(te),l.push(we),l.push(Ce)}function pe(te,we,Ce){ge(te),ge(we),ge(Ce);const Se=n.length/3,Re=y.generateTopUV(r,n,Se-3,Se-2,Se-1);xe(Re[0]),xe(Re[1]),xe(Re[2])}function me(te,we,Ce,Se){ge(te),ge(we),ge(Se),ge(we),ge(Ce),ge(Se);const Re=n.length/3,Xe=y.generateSideWallUV(r,n,Re-6,Re-3,Re-2,Re-1);xe(Xe[0]),xe(Xe[1]),xe(Xe[3]),xe(Xe[1]),xe(Xe[2]),xe(Xe[3])}function ge(te){n.push(l[te*3+0]),n.push(l[te*3+1]),n.push(l[te*3+2])}function xe(te){s.push(te.x),s.push(te.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return z8e(i,r,t)}static fromJSON(t,i){const r=[];for(let s=0,a=t.shapes.length;s<a;s++){const o=i[t.shapes[s]];r.push(o)}const n=t.options.extrudePath;return n!==void 0&&(t.options.extrudePath=new LC[n.type]().fromJSON(n)),new n2(r,t.options)}}const N8e={generateTopUV:function(e,t,i,r,n){const s=t[i*3],a=t[i*3+1],o=t[r*3],l=t[r*3+1],c=t[n*3],u=t[n*3+1];return[new nt(s,a),new nt(o,l),new nt(c,u)]},generateSideWallUV:function(e,t,i,r,n,s){const a=t[i*3],o=t[i*3+1],l=t[i*3+2],c=t[r*3],u=t[r*3+1],h=t[r*3+2],d=t[n*3],p=t[n*3+1],f=t[n*3+2],v=t[s*3],m=t[s*3+1],g=t[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new nt(a,1-l),new nt(c,1-h),new nt(d,1-f),new nt(v,1-g)]:[new nt(o,1-l),new nt(u,1-h),new nt(p,1-f),new nt(m,1-g)]}};function z8e(e,t,i){if(i.shapes=[],Array.isArray(e))for(let r=0,n=e.length;r<n;r++){const s=e[r];i.shapes.push(s.uuid)}else i.shapes.push(e.uuid);return i.options=Object.assign({},t),t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}class s2 extends dp{constructor(t=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,t,i),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new s2(t.radius,t.detail)}}class fw extends dp{constructor(t=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,t,i),this.type="OctahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new fw(t.radius,t.detail)}}class a2 extends Ei{constructor(t=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=t;const d=(i-t)/n,p=new he,f=new nt;for(let v=0;v<=n;v++){for(let m=0;m<=r;m++){const g=s+m/r*a;p.x=h*Math.cos(g),p.y=h*Math.sin(g),l.push(p.x,p.y,p.z),c.push(0,0,1),f.x=(p.x/i+1)/2,f.y=(p.y/i+1)/2,u.push(f.x,f.y)}h+=d}for(let v=0;v<n;v++){const m=v*(r+1);for(let g=0;g<r;g++){const y=g+m,x=y,_=y+r+1,M=y+r+2,S=y+1;o.push(x,_,S),o.push(_,M,S)}}this.setIndex(o),this.setAttribute("position",new Ut(l,3)),this.setAttribute("normal",new Ut(c,3)),this.setAttribute("uv",new Ut(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new a2(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class o2 extends Ei{constructor(t=new Hf([new nt(0,.5),new nt(-.5,-.5),new nt(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let u=0;u<t.length;u++)c(t[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new Ut(n,3)),this.setAttribute("normal",new Ut(s,3)),this.setAttribute("uv",new Ut(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let p=d.shape;const f=d.holes;jc.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,g=f.length;m<g;m++){const y=f[m];jc.isClockWise(y)===!0&&(f[m]=y.reverse())}const v=jc.triangulateShape(p,f);for(let m=0,g=f.length;m<g;m++){const y=f[m];p=p.concat(y)}for(let m=0,g=p.length;m<g;m++){const y=p[m];n.push(y.x,y.y,0),s.push(0,0,1),a.push(y.x,y.y)}for(let m=0,g=v.length;m<g;m++){const y=v[m],x=y[0]+h,_=y[1]+h,M=y[2]+h;r.push(x,_,M),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),i=this.parameters.shapes;return B8e(i,t)}static fromJSON(t,i){const r=[];for(let n=0,s=t.shapes.length;n<s;n++){const a=i[t.shapes[n]];r.push(a)}return new o2(r,t.curveSegments)}}function B8e(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,r=e.length;i<r;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}class mw extends Ei{constructor(t=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new he,d=new he,p=[],f=[],v=[],m=[];for(let g=0;g<=r;g++){const y=[],x=g/r;let _=0;g===0&&a===0?_=.5/i:g===r&&l===Math.PI&&(_=-.5/i);for(let M=0;M<=i;M++){const S=M/i;h.x=-t*Math.cos(n+S*s)*Math.sin(a+x*o),h.y=t*Math.cos(a+x*o),h.z=t*Math.sin(n+S*s)*Math.sin(a+x*o),f.push(h.x,h.y,h.z),d.copy(h).normalize(),v.push(d.x,d.y,d.z),m.push(S+_,1-x),y.push(c++)}u.push(y)}for(let g=0;g<r;g++)for(let y=0;y<i;y++){const x=u[g][y+1],_=u[g][y],M=u[g+1][y],S=u[g+1][y+1];(g!==0||a>0)&&p.push(x,_,S),(g!==r-1||l<Math.PI)&&p.push(_,M,S)}this.setIndex(p),this.setAttribute("position",new Ut(f,3)),this.setAttribute("normal",new Ut(v,3)),this.setAttribute("uv",new Ut(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new mw(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class l2 extends dp{constructor(t=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,t,i),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:i}}static fromJSON(t){return new l2(t.radius,t.detail)}}class c2 extends Ei{constructor(t=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new he,h=new he,d=new he;for(let p=0;p<=r;p++)for(let f=0;f<=n;f++){const v=f/n*s,m=p/r*Math.PI*2;h.x=(t+i*Math.cos(m))*Math.cos(v),h.y=(t+i*Math.cos(m))*Math.sin(v),h.z=i*Math.sin(m),o.push(h.x,h.y,h.z),u.x=t*Math.cos(v),u.y=t*Math.sin(v),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(f/n),c.push(p/r)}for(let p=1;p<=r;p++)for(let f=1;f<=n;f++){const v=(n+1)*p+f-1,m=(n+1)*(p-1)+f-1,g=(n+1)*(p-1)+f,y=(n+1)*p+f;a.push(v,m,y),a.push(m,g,y)}this.setIndex(a),this.setAttribute("position",new Ut(o,3)),this.setAttribute("normal",new Ut(l,3)),this.setAttribute("uv",new Ut(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new c2(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class u2 extends Ei{constructor(t=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new he,d=new he,p=new he,f=new he,v=new he,m=new he,g=new he;for(let x=0;x<=r;++x){const _=x/r*s*Math.PI*2;y(_,s,a,t,p),y(_+.01,s,a,t,f),m.subVectors(f,p),g.addVectors(f,p),v.crossVectors(m,g),g.crossVectors(v,m),v.normalize(),g.normalize();for(let M=0;M<=n;++M){const S=M/n*Math.PI*2,E=-i*Math.cos(S),A=i*Math.sin(S);h.x=p.x+(E*g.x+A*v.x),h.y=p.y+(E*g.y+A*v.y),h.z=p.z+(E*g.z+A*v.z),l.push(h.x,h.y,h.z),d.subVectors(h,p).normalize(),c.push(d.x,d.y,d.z),u.push(x/r),u.push(M/n)}}for(let x=1;x<=r;x++)for(let _=1;_<=n;_++){const M=(n+1)*(x-1)+(_-1),S=(n+1)*x+(_-1),E=(n+1)*x+_,A=(n+1)*(x-1)+_;o.push(M,S,A),o.push(S,E,A)}this.setIndex(o),this.setAttribute("position",new Ut(l,3)),this.setAttribute("normal",new Ut(c,3)),this.setAttribute("uv",new Ut(u,2));function y(x,_,M,S,E){const A=Math.cos(x),P=Math.sin(x),C=M/_*x,D=Math.cos(C);E.x=S*(2+D)*.5*A,E.y=S*(2+D)*P*.5,E.z=S*Math.sin(C)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new u2(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class h2 extends Ei{constructor(t=new cF(new he(-1,-1,0),new he(-1,1,0),new he(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=t.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new he,l=new he,c=new nt;let u=new he;const h=[],d=[],p=[],f=[];v(),this.setIndex(f),this.setAttribute("position",new Ut(h,3)),this.setAttribute("normal",new Ut(d,3)),this.setAttribute("uv",new Ut(p,2));function v(){for(let x=0;x<i;x++)m(x);m(s===!1?i:0),y(),g()}function m(x){u=t.getPointAt(x/i,u);const _=a.normals[x],M=a.binormals[x];for(let S=0;S<=n;S++){const E=S/n*Math.PI*2,A=Math.sin(E),P=-Math.cos(E);l.x=P*_.x+A*M.x,l.y=P*_.y+A*M.y,l.z=P*_.z+A*M.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function g(){for(let x=1;x<=i;x++)for(let _=1;_<=n;_++){const M=(n+1)*(x-1)+(_-1),S=(n+1)*x+(_-1),E=(n+1)*x+_,A=(n+1)*(x-1)+_;f.push(M,S,A),f.push(S,E,A)}}function y(){for(let x=0;x<=i;x++)for(let _=0;_<=n;_++)c.x=x/i,c.y=_/n,p.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new h2(new LC[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class pse extends Ei{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const i=[],r=new Set,n=new he,s=new he;if(t.index!==null){const a=t.attributes.position,o=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,p=h.count;for(let f=d,v=d+p;f<v;f+=3)for(let m=0;m<3;m++){const g=o.getX(f+m),y=o.getX(f+(m+1)%3);n.fromBufferAttribute(a,g),s.fromBufferAttribute(a,y),hX(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=t.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),hX(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new Ut(i,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function hX(e,t,i){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var dX=Object.freeze({__proto__:null,BoxGeometry:bm,CapsuleGeometry:$T,CircleGeometry:e2,ConeGeometry:t2,CylinderGeometry:q0,DodecahedronGeometry:i2,EdgesGeometry:cse,ExtrudeGeometry:n2,IcosahedronGeometry:s2,LatheGeometry:pw,OctahedronGeometry:fw,PlaneGeometry:W0,PolyhedronGeometry:dp,RingGeometry:a2,ShapeGeometry:o2,SphereGeometry:mw,TetrahedronGeometry:l2,TorusGeometry:c2,TorusKnotGeometry:u2,TubeGeometry:h2,WireframeGeometry:pse});class fse extends ea{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Rt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class mse extends sl{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hF extends ea{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Rt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=up,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class dF extends hF{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Kr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Rt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Rt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Rt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class gse extends ea{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Rt(16777215),this.specular=new Rt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=up,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=lw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class vse extends ea{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Rt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=up,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class yse extends ea{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=up,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class xse extends ea{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Rt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Rt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=up,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new yo,this.combine=lw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class bse extends ea{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Rt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=up,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class wse extends Aa{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Tf(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function _se(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Sse(e){function t(n,s){return e[n]-e[s]}const i=e.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(t),r}function dz(e,t,i){const r=e.length,n=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*t;for(let l=0;l!==t;++l)n[a++]=e[o+l]}return n}function pF(e,t,i,r){let n=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(t.push(s.time),i.push.apply(i,a)),s=e[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(t.push(s.time),a.toArray(i,i.length)),s=e[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(t.push(s.time),i.push(a)),s=e[n++];while(s!==void 0)}function k8e(e,t,i,r,n=30){const s=e.clone();s.name=t;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let p=0;p<c.times.length;++p){const f=c.times[p]*n;if(!(f<i||f>=r)){h.push(c.times[p]);for(let v=0;v<u;++v)d.push(c.values[p*u+v])}}h.length!==0&&(c.times=Tf(h,c.times.constructor),c.values=Tf(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function U8e(e,t=0,i=e,r=30){r<=0&&(r=30);const n=i.tracks.length,s=t/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=e.tracks.find(function(g){return g.name===o.name&&g.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let v;if(s<=o.times[0]){const g=u,y=h-u;v=o.values.slice(g,y)}else if(s>=o.times[f]){const g=f*h+u,y=g+h-u;v=o.values.slice(g,y)}else{const g=o.createInterpolant(),y=u,x=h-u;g.evaluate(s),v=g.resultBuffer.slice(y,x)}l==="quaternion"&&new Zs().fromArray(v).normalize().conjugate().toArray(v);const m=c.times.length;for(let g=0;g<m;++g){const y=g*p+d;if(l==="quaternion")Zs.multiplyQuaternionsFlat(c.values,y,v,0,c.values,y);else{const x=p-d*2;for(let _=0;_<x;++_)c.values[y+_]-=v[_]}}}return e.blendMode=HU,e}const F8e={convertArray:Tf,isTypedArray:_se,getKeyframeOrder:Sse,sortedArray:dz,flattenJSON:pF,subclip:k8e,makeClipAdditive:U8e};class gw{constructor(t,i,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(t){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(t<n)){for(let o=r+2;;){if(n===void 0){if(t<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],t<n)break t}a=i.length;break i}if(!(t>=s)){const o=i[1];t<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],t>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;t<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=t*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Mse extends gw{constructor(t,i,r,n){super(t,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ef,endingEnd:Ef}}intervalChanged_(t,i,r){const n=this.parameterPositions;let s=t-2,a=t+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case Af:s=t,o=2*i-r;break;case gb:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=t,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Af:a=t,l=2*r-i;break;case gb:a=1,l=r+n[1]-n[0];break;default:a=t-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(r-i)/(n-i),v=f*f,m=v*f,g=-d*m+2*d*v-d*f,y=(1+d)*m+(-1.5-2*d)*v+(-.5+d)*f+1,x=(-1-p)*m+(1.5+p)*v+.5*f,_=p*m-p*v;for(let M=0;M!==o;++M)s[M]=g*a[u+M]+y*a[c+M]+x*a[l+M]+_*a[h+M];return s}}class fF extends gw{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=t*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class Ese extends gw{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Zl{constructor(t,i,r,n){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Tf(i,this.TimeBufferType),this.values=Tf(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const i=t.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(t);else{r={name:t.name,times:Tf(t.times,Array),values:Tf(t.values,Array)};const n=t.getInterpolation();n!==t.DefaultInterpolation&&(r.interpolation=n)}return r.type=t.ValueTypeName,r}InterpolantFactoryMethodDiscrete(t){return new Ese(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new fF(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Mse(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let i;switch(t){case fb:i=this.InterpolantFactoryMethodDiscrete;break;case mb:i=this.InterpolantFactoryMethodLinear;break;case BE:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return fb;case this.InterpolantFactoryMethodLinear:return mb;case this.InterpolantFactoryMethodSmooth:return BE}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=t}return this}scale(t){if(t!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=t}return this}trim(t,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<t;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let t=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),t=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),t=!1;break}a=l}if(n!==void 0&&_se(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===BE,s=t.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=t[o],u=t[o+1];if(c!==u&&(o!==1||c!==t[0]))if(n)l=!0;else{const h=o*r,d=h-r,p=h+r;for(let f=0;f!==r;++f){const v=i[h+f];if(v!==i[d+f]||v!==i[p+f]){l=!0;break}}}if(l){if(o!==a){t[a]=t[o];const h=o*r,d=a*r;for(let p=0;p!==r;++p)i[d+p]=i[h+p]}++a}}if(s>0){t[a]=t[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=i.slice(0,a*r)):(this.times=t,this.values=i),this}clone(){const t=this.times.slice(),i=this.values.slice(),r=this.constructor,n=new r(this.name,t,i);return n.createInterpolant=this.createInterpolant,n}}Zl.prototype.TimeBufferType=Float32Array;Zl.prototype.ValueBufferType=Float32Array;Zl.prototype.DefaultInterpolation=mb;class wm extends Zl{}wm.prototype.ValueTypeName="bool";wm.prototype.ValueBufferType=Array;wm.prototype.DefaultInterpolation=fb;wm.prototype.InterpolantFactoryMethodLinear=void 0;wm.prototype.InterpolantFactoryMethodSmooth=void 0;class mF extends Zl{}mF.prototype.ValueTypeName="color";class Cb extends Zl{}Cb.prototype.ValueTypeName="number";class Ase extends gw{constructor(t,i,r,n){super(t,i,r,n)}interpolate_(t,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=t*o;for(let u=c+o;c!==u;c+=4)Zs.slerpFlat(s,0,a,c-o,a,c,l);return s}}class Y0 extends Zl{InterpolantFactoryMethodLinear(t){return new Ase(this.times,this.values,this.getValueSize(),t)}}Y0.prototype.ValueTypeName="quaternion";Y0.prototype.DefaultInterpolation=mb;Y0.prototype.InterpolantFactoryMethodSmooth=void 0;class _m extends Zl{}_m.prototype.ValueTypeName="string";_m.prototype.ValueBufferType=Array;_m.prototype.DefaultInterpolation=fb;_m.prototype.InterpolantFactoryMethodLinear=void 0;_m.prototype.InterpolantFactoryMethodSmooth=void 0;class Tb extends Zl{}Tb.prototype.ValueTypeName="vector";class Pb{constructor(t,i=-1,r,n=HT){this.name=t,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=fo(),this.duration<0&&this.resetDuration()}static parse(t){const i=[],r=t.tracks,n=1/(t.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push(j8e(r[a]).scale(n));const s=new this(t.name,t.duration,i,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const i=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:i,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,a=r.length;s!==a;++s)i.push(Zl.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(t,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=Sse(l);l=dz(l,1,u),c=dz(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Cb(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(t,-1,a)}static findByName(t,i){let r=t;if(!Array.isArray(t)){const n=t;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(t,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=t.length;o<l;o++){const c=t[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(t,i){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,p,f,v){if(p.length!==0){const m=[],g=[];pF(p,m,g,f),m.length!==0&&v.push(new h(d,m,g))}},n=[],s=t.name||"default",a=t.fps||30,o=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let f;for(f=0;f<d.length;f++)if(d[f].morphTargets)for(let v=0;v<d[f].morphTargets.length;v++)p[d[f].morphTargets[v]]=-1;for(const v in p){const m=[],g=[];for(let y=0;y!==d[f].morphTargets.length;++y){const x=d[f];m.push(x.time),g.push(x.morphTarget===v?1:0)}n.push(new Cb(".morphTargetInfluence["+v+"]",m,g))}l=p.length*a}else{const p=".bones["+i[h].name+"]";r(Tb,p+".position",d,"pos",n),r(Y0,p+".quaternion",d,"rot",n),r(Tb,p+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const t=this.tracks;let i=0;for(let r=0,n=t.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function V8e(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Cb;case"vector":case"vector2":case"vector3":case"vector4":return Tb;case"color":return mF;case"quaternion":return Y0;case"bool":case"boolean":return wm;case"string":return _m}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function j8e(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=V8e(e.type);if(e.times===void 0){const i=[],r=[];pF(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const qu={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class gF{constructor(t,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=r,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const p=c[h],f=c[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return f}return null}}}const Cse=new gF;class Ya{constructor(t){this.manager=t!==void 0?t:Cse,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,i){const r=this;return new Promise(function(n,s){r.load(t,n,i,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ya.DEFAULT_MATERIAL_NAME="__DEFAULT";const bu={};class H8e extends Error{constructor(t,i){super(t),this.response=i}}class ph extends Ya{constructor(t){super(t)}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=qu.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{i&&i(s),this.manager.itemEnd(t)},0),s;if(bu[t]!==void 0){bu[t].push({onLoad:i,onProgress:r,onError:n});return}bu[t]=[],bu[t].push({onLoad:i,onProgress:r,onError:n});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=bu[t],h=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),p=d?parseInt(d):0,f=p!==0;let v=0;const m=new ReadableStream({start(g){y();function y(){h.read().then(({done:x,value:_})=>{if(x)g.close();else{v+=_.byteLength;const M=new ProgressEvent("progress",{lengthComputable:f,loaded:v,total:p});for(let S=0,E=u.length;S<E;S++){const A=u[S];A.onProgress&&A.onProgress(M)}g.enqueue(_),y()}})}}});return new Response(m)}else throw new H8e(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(f=>p.decode(f))}}}).then(c=>{qu.add(t,c);const u=bu[t];delete bu[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=bu[t];if(u===void 0)throw this.manager.itemError(t),c;delete bu[t];for(let h=0,d=u.length;h<d;h++){const p=u[h];p.onError&&p.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class G8e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new ph(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=[];for(let r=0;r<t.length;r++){const n=Pb.parse(t[r]);i.push(n)}return i}}class W8e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=[],o=new KT,l=new ph(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(t[h],function(d){const p=s.parse(d,!0);a[h]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},c+=1,c===6&&(p.mipmapCount===1&&(o.minFilter=Nr),o.image=a,o.format=p.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(t))for(let h=0,d=t.length;h<d;++h)u(h);else l.load(t,function(h){const d=s.parse(h,!0);if(d.isCubemap){const p=d.mipmaps.length/d.mipmapCount;for(let f=0;f<p;f++){a[f]={mipmaps:[]};for(let v=0;v<d.mipmapCount;v++)a[f].mipmaps.push(d.mipmaps[f*d.mipmapCount+v]),a[f].format=d.format,a[f].width=d.width,a[f].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=Nr),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}class Db extends Ya{constructor(t){super(t)}load(t,i,r,n){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=qu.get(t);if(a!==void 0)return s.manager.itemStart(t),setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a;const o=_b("img");function l(){u(),qu.add(t,this),i&&i(this),s.manager.itemEnd(t)}function c(h){u(),n&&n(h),s.manager.itemError(t),s.manager.itemEnd(t)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class X8e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=new hw;s.colorSpace=Ho;const a=new Db(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(t[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<t.length;++c)l(c);return s}}class q8e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new Gd,o=new ph(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,function(l){let c;try{c=s.parse(l)}catch(u){if(n!==void 0)n(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:Ws,a.wrapT=c.wrapT!==void 0?c.wrapT:Ws,a.magFilter=c.magFilter!==void 0?c.magFilter:Nr,a.minFilter=c.minFilter!==void 0?c.minFilter:Nr,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Dc),c.mipmapCount===1&&(a.minFilter=Nr),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},r,n),a}}class Y8e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=new en,a=new Db(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class pp extends Zi{constructor(t,i=1){super(),this.isLight=!0,this.type="Light",this.color=new Rt(t),this.intensity=i}dispose(){}copy(t,i){return super.copy(t,i),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const i=super.toJSON(t);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),i}}class Tse extends pp{constructor(t,i,r){super(t,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Zi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Rt(i)}copy(t,i){return super.copy(t,i),this.groundColor.copy(t.groundColor),this}}const GL=new ui,pX=new he,fX=new he;class vF{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nt(512,512),this.map=null,this.mapPass=null,this.matrix=new ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new dw,this._frameExtents=new nt(1,1),this._viewportCount=1,this._viewports=[new nr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const i=this.camera,r=this.matrix;pX.setFromMatrixPosition(t.matrixWorld),i.position.copy(pX),fX.setFromMatrixPosition(t.target.matrixWorld),i.lookAt(fX),i.updateMatrixWorld(),GL.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(GL),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(GL)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Z8e extends vF{constructor(){super(new hn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const i=this.camera,r=v0*2*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Pse extends pp{constructor(t,i,r=0,n=Math.PI/3,s=0,a=2){super(t,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Zi.DEFAULT_UP),this.updateMatrix(),this.target=new Zi,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Z8e}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const mX=new ui,u1=new he,WL=new he;class Q8e extends vF{constructor(){super(new hn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new nt(4,2),this._viewportCount=6,this._viewports=[new nr(2,1,1,1),new nr(0,1,1,1),new nr(3,1,1,1),new nr(1,1,1,1),new nr(3,0,1,1),new nr(1,0,1,1)],this._cubeDirections=[new he(1,0,0),new he(-1,0,0),new he(0,0,1),new he(0,0,-1),new he(0,1,0),new he(0,-1,0)],this._cubeUps=[new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,1,0),new he(0,0,1),new he(0,0,-1)]}updateMatrices(t,i=0){const r=this.camera,n=this.matrix,s=t.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),u1.setFromMatrixPosition(t.matrixWorld),r.position.copy(u1),WL.copy(r.position),WL.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(WL),r.updateMatrixWorld(),n.makeTranslation(-u1.x,-u1.y,-u1.z),mX.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mX)}}class Dse extends pp{constructor(t,i,r=0,n=2){super(t,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new Q8e}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,i){return super.copy(t,i),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class K8e extends vF{constructor(){super(new Hd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Lse extends pp{constructor(t,i){super(t,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Zi.DEFAULT_UP),this.updateMatrix(),this.target=new Zi,this.shadow=new K8e}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Rse extends pp{constructor(t,i){super(t,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class Ise extends pp{constructor(t,i,r=10,n=10){super(t,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const i=super.toJSON(t);return i.object.width=this.width,i.object.height=this.height,i}}class Ose{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new he)}set(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(t,i){const r=t.x,n=t.y,s=t.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this}addScaledSH(t,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],i);return this}scale(t){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(t);return this}lerp(t,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],i);return this}equals(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(t,i+n*3);return this}toArray(t=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(t,i+n*3);return t}static getBasisAt(t,i){const r=t.x,n=t.y,s=t.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class Nse extends pp{constructor(t=new Ose,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const i=super.toJSON(t);return i.object.sh=this.sh.toArray(),i}}class d2 extends Ya{constructor(t){super(t),this.textures={}}load(t,i,r,n){const s=this,a=new ph(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=d2.createMaterialFromType(t.type);if(t.uuid!==void 0&&(n.uuid=t.uuid),t.name!==void 0&&(n.name=t.name),t.color!==void 0&&n.color!==void 0&&n.color.setHex(t.color),t.roughness!==void 0&&(n.roughness=t.roughness),t.metalness!==void 0&&(n.metalness=t.metalness),t.sheen!==void 0&&(n.sheen=t.sheen),t.sheenColor!==void 0&&(n.sheenColor=new Rt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(n.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(t.emissive),t.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(t.specular),t.specularIntensity!==void 0&&(n.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(n.shininess=t.shininess),t.clearcoat!==void 0&&(n.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(n.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(n.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(n.transmission=t.transmission),t.thickness!==void 0&&(n.thickness=t.thickness),t.attenuationDistance!==void 0&&(n.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(n.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(n.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(n.fog=t.fog),t.flatShading!==void 0&&(n.flatShading=t.flatShading),t.blending!==void 0&&(n.blending=t.blending),t.combine!==void 0&&(n.combine=t.combine),t.side!==void 0&&(n.side=t.side),t.shadowSide!==void 0&&(n.shadowSide=t.shadowSide),t.opacity!==void 0&&(n.opacity=t.opacity),t.transparent!==void 0&&(n.transparent=t.transparent),t.alphaTest!==void 0&&(n.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(n.alphaHash=t.alphaHash),t.depthFunc!==void 0&&(n.depthFunc=t.depthFunc),t.depthTest!==void 0&&(n.depthTest=t.depthTest),t.depthWrite!==void 0&&(n.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(n.colorWrite=t.colorWrite),t.blendSrc!==void 0&&(n.blendSrc=t.blendSrc),t.blendDst!==void 0&&(n.blendDst=t.blendDst),t.blendEquation!==void 0&&(n.blendEquation=t.blendEquation),t.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=t.blendSrcAlpha),t.blendDstAlpha!==void 0&&(n.blendDstAlpha=t.blendDstAlpha),t.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=t.blendEquationAlpha),t.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(t.blendColor),t.blendAlpha!==void 0&&(n.blendAlpha=t.blendAlpha),t.stencilWriteMask!==void 0&&(n.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(n.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(n.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(n.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(n.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(n.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(n.stencilZPass=t.stencilZPass),t.stencilWrite!==void 0&&(n.stencilWrite=t.stencilWrite),t.wireframe!==void 0&&(n.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(n.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(n.rotation=t.rotation),t.linewidth!==void 0&&(n.linewidth=t.linewidth),t.dashSize!==void 0&&(n.dashSize=t.dashSize),t.gapSize!==void 0&&(n.gapSize=t.gapSize),t.scale!==void 0&&(n.scale=t.scale),t.polygonOffset!==void 0&&(n.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(n.dithering=t.dithering),t.alphaToCoverage!==void 0&&(n.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(n.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(n.visible=t.visible),t.toneMapped!==void 0&&(n.toneMapped=t.toneMapped),t.userData!==void 0&&(n.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const s in t.uniforms){const a=t.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new Rt().setHex(a.value);break;case"v2":n.uniforms[s].value=new nt().fromArray(a.value);break;case"v3":n.uniforms[s].value=new he().fromArray(a.value);break;case"v4":n.uniforms[s].value=new nr().fromArray(a.value);break;case"m3":n.uniforms[s].value=new xi().fromArray(a.value);break;case"m4":n.uniforms[s].value=new ui().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(t.defines!==void 0&&(n.defines=t.defines),t.vertexShader!==void 0&&(n.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(n.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(n.glslVersion=t.glslVersion),t.extensions!==void 0)for(const s in t.extensions)n.extensions[s]=t.extensions[s];if(t.lights!==void 0&&(n.lights=t.lights),t.clipping!==void 0&&(n.clipping=t.clipping),t.size!==void 0&&(n.size=t.size),t.sizeAttenuation!==void 0&&(n.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(n.map=r(t.map)),t.matcap!==void 0&&(n.matcap=r(t.matcap)),t.alphaMap!==void 0&&(n.alphaMap=r(t.alphaMap)),t.bumpMap!==void 0&&(n.bumpMap=r(t.bumpMap)),t.bumpScale!==void 0&&(n.bumpScale=t.bumpScale),t.normalMap!==void 0&&(n.normalMap=r(t.normalMap)),t.normalMapType!==void 0&&(n.normalMapType=t.normalMapType),t.normalScale!==void 0){let s=t.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new nt().fromArray(s)}return t.displacementMap!==void 0&&(n.displacementMap=r(t.displacementMap)),t.displacementScale!==void 0&&(n.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(n.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(n.roughnessMap=r(t.roughnessMap)),t.metalnessMap!==void 0&&(n.metalnessMap=r(t.metalnessMap)),t.emissiveMap!==void 0&&(n.emissiveMap=r(t.emissiveMap)),t.emissiveIntensity!==void 0&&(n.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(n.specularMap=r(t.specularMap)),t.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(t.specularIntensityMap)),t.specularColorMap!==void 0&&(n.specularColorMap=r(t.specularColorMap)),t.envMap!==void 0&&(n.envMap=r(t.envMap)),t.envMapRotation!==void 0&&n.envMapRotation.fromArray(t.envMapRotation),t.envMapIntensity!==void 0&&(n.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(n.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(n.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(n.lightMap=r(t.lightMap)),t.lightMapIntensity!==void 0&&(n.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(n.aoMap=r(t.aoMap)),t.aoMapIntensity!==void 0&&(n.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(n.gradientMap=r(t.gradientMap)),t.clearcoatMap!==void 0&&(n.clearcoatMap=r(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new nt().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(n.iridescenceMap=r(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(n.transmissionMap=r(t.transmissionMap)),t.thicknessMap!==void 0&&(n.thicknessMap=r(t.thicknessMap)),t.anisotropyMap!==void 0&&(n.anisotropyMap=r(t.anisotropyMap)),t.sheenColorMap!==void 0&&(n.sheenColorMap=r(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const i={ShadowMaterial:fse,SpriteMaterial:iF,RawShaderMaterial:mse,ShaderMaterial:sl,PointsMaterial:nF,MeshPhysicalMaterial:dF,MeshStandardMaterial:hF,MeshPhongMaterial:gse,MeshToonMaterial:vse,MeshNormalMaterial:yse,MeshLambertMaterial:xse,MeshDepthMaterial:JU,MeshDistanceMaterial:$U,MeshBasicMaterial:hp,MeshMatcapMaterial:bse,LineDashedMaterial:wse,LineBasicMaterial:Aa,Material:ea};return new i[t]}}class pz{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let i="";for(let r=0,n=t.length;r<n;r++)i+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(i))}catch{return i}}static extractUrlBase(t){const i=t.lastIndexOf("/");return i===-1?"./":t.slice(0,i+1)}static resolveURL(t,i){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(t)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:i+t)}}class zse extends Ei{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Bse extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new ph(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(t)}},r,n)}parse(t){const i={},r={};function n(p,f){if(i[f]!==void 0)return i[f];const m=p.interleavedBuffers[f],g=s(p,m.buffer),y=yv(m.type,g),x=new ZT(y,m.stride);return x.uuid=m.uuid,i[f]=x,x}function s(p,f){if(r[f]!==void 0)return r[f];const m=p.arrayBuffers[f],g=new Uint32Array(m).buffer;return r[f]=g,g}const a=t.isInstancedBufferGeometry?new zse:new Ei,o=t.data.index;if(o!==void 0){const p=yv(o.type,o.array);a.setIndex(new pr(p,1))}const l=t.data.attributes;for(const p in l){const f=l[p];let v;if(f.isInterleavedBufferAttribute){const m=n(t.data,f.data);v=new sm(m,f.itemSize,f.offset,f.normalized)}else{const m=yv(f.type,f.array),g=f.isInstancedBufferAttribute?x0:pr;v=new g(m,f.itemSize,f.normalized)}f.name!==void 0&&(v.name=f.name),f.usage!==void 0&&v.setUsage(f.usage),a.setAttribute(p,v)}const c=t.data.morphAttributes;if(c)for(const p in c){const f=c[p],v=[];for(let m=0,g=f.length;m<g;m++){const y=f[m];let x;if(y.isInterleavedBufferAttribute){const _=n(t.data,y.data);x=new sm(_,y.itemSize,y.offset,y.normalized)}else{const _=yv(y.type,y.array);x=new pr(_,y.itemSize,y.normalized)}y.name!==void 0&&(x.name=y.name),v.push(x)}a.morphAttributes[p]=v}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=t.data.groups||t.data.drawcalls||t.data.offsets;if(h!==void 0)for(let p=0,f=h.length;p!==f;++p){const v=h[p];a.addGroup(v.start,v.count,v.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const p=new he;d.center!==void 0&&p.fromArray(d.center),a.boundingSphere=new Qs(p,d.radius)}return t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class J8e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=this.path===""?pz.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const o=new ph(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+t+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(c,i)},r,n)}async loadAsync(t,i){const r=this,n=this.path===""?pz.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const s=new ph(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(t,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await r.parseAsync(o)}parse(t,i){const r=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,n),a=this.parseImages(t.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(t.textures,a),l=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,s,l,o,r),u=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,u),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(t){const i=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,r),s=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,n,o,a,i),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(t){const i={};if(t!==void 0)for(let r=0,n=t.length;r<n;r++){const s=new Hf().fromJSON(t[r]);i[s.uuid]=s}return i}parseSkeletons(t,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=new QT().fromJSON(t[s],n);r[o.uuid]=o}return r}parseGeometries(t,i){const r={};if(t!==void 0){const n=new Bse;for(let s=0,a=t.length;s<a;s++){let o;const l=t[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in dX?o=dX[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(t,i){const r={},n={};if(t!==void 0){const s=new d2;s.setTextures(i);for(let a=0,o=t.length;a<o;a++){const l=t[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(t){const i={};if(t!==void 0)for(let r=0;r<t.length;r++){const n=t[r],s=Pb.parse(n);i[s.uuid]=s}return i}parseImages(t,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:yv(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new gF(i);s=new Db(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=t.length;c<u;c++){const h=t[c],d=h.url;if(Array.isArray(d)){const p=[];for(let f=0,v=d.length;f<v;f++){const m=d[f],g=o(m);g!==null&&(g instanceof HTMLImageElement?p.push(g):p.push(new Gd(g.data,g.width,g.height)))}n[h.uuid]=new Cf(p)}else{const p=o(h.url);n[h.uuid]=new Cf(p)}}}return n}async parseImagesAsync(t){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:yv(a.type,a.data),width:a.width,height:a.height}:null}if(t!==void 0&&t.length>0){n=new Db(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=t.length;a<o;a++){const l=t[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const p=c[h],f=await s(p);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new Gd(f.data,f.width,f.height)))}r[l.uuid]=new Cf(u)}else{const u=await s(l.url);r[l.uuid]=new Cf(u)}}}return r}parseTextures(t,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(t!==void 0)for(let s=0,a=t.length;s<a;s++){const o=t[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new hw,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Gd:u=new en,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,$8e)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],gX),u.wrapT=r(o.wrap[1],gX)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,vX)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,vX)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(t,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let f=0,v=d.length;f<v;f++){const m=d[f];r[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),p.push(r[m])}return p}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(t.type){case"Scene":a=new tF,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new Rt(t.background):a.background=c(t.background)),t.environment!==void 0&&(a.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?a.fog=new YT(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(a.fog=new qT(t.fog.color,t.fog.density)),t.fog.name!==""&&(a.fog.name=t.fog.name)),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(t.backgroundRotation),t.environmentRotation!==void 0&&a.environmentRotation.fromArray(t.environmentRotation);break;case"PerspectiveCamera":a=new hn(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(a.focus=t.focus),t.zoom!==void 0&&(a.zoom=t.zoom),t.filmGauge!==void 0&&(a.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(a.filmOffset=t.filmOffset),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"OrthographicCamera":a=new Hd(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(a.zoom=t.zoom),t.view!==void 0&&(a.view=Object.assign({},t.view));break;case"AmbientLight":a=new Rse(t.color,t.intensity);break;case"DirectionalLight":a=new Lse(t.color,t.intensity);break;case"PointLight":a=new Dse(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":a=new Ise(t.color,t.intensity,t.width,t.height);break;case"SpotLight":a=new Pse(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":a=new Tse(t.color,t.groundColor,t.intensity);break;case"LightProbe":a=new Nse().fromJSON(t);break;case"SkinnedMesh":u=o(t.geometry),h=l(t.material),a=new $ne(u,h),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),h=l(t.material),a=new An(u,h);break;case"InstancedMesh":u=o(t.geometry),h=l(t.material);const d=t.count,p=t.instanceMatrix,f=t.instanceColor;a=new ese(u,h,d),a.instanceMatrix=new x0(new Float32Array(p.array),16),f!==void 0&&(a.instanceColor=new x0(new Float32Array(f.array),f.itemSize));break;case"BatchedMesh":u=o(t.geometry),h=l(t.material),a=new tse(t.maxGeometryCount,t.maxVertexCount,t.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=t.perObjectFrustumCulled,a.sortObjects=t.sortObjects,a._drawRanges=t.drawRanges,a._reservedRanges=t.reservedRanges,a._visibility=t.visibility,a._active=t.active,a._bounds=t.bounds.map(v=>{const m=new ba;m.min.fromArray(v.boxMin),m.max.fromArray(v.boxMax);const g=new Qs;return g.radius=v.sphereRadius,g.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:m,sphereInitialized:v.sphereInitialized,sphere:g}}),a._maxGeometryCount=t.maxGeometryCount,a._maxVertexCount=t.maxVertexCount,a._maxIndexCount=t.maxIndexCount,a._geometryInitialized=t.geometryInitialized,a._geometryCount=t.geometryCount,a._matricesTexture=c(t.matricesTexture.uuid);break;case"LOD":a=new Jne;break;case"Line":a=new ep(o(t.geometry),l(t.material));break;case"LineLoop":a=new ise(o(t.geometry),l(t.material));break;case"LineSegments":a=new Qc(o(t.geometry),l(t.material));break;case"PointCloud":case"Points":a=new rse(o(t.geometry),l(t.material));break;case"Sprite":a=new Kne(l(t.material));break;case"Group":a=new wv;break;case"Bone":a=new rF;break;default:a=new Zi}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],i,r,n,s))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const f=d[p];a.animations.push(s[f])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(a.autoUpdate=t.autoUpdate);const d=t.levels;for(let p=0;p<d.length;p++){const f=d[p],v=a.getObjectByProperty("uuid",f.object);v!==void 0&&a.addLevel(v,f.distance,f.hysteresis)}}return a}bindSkeletons(t,i){Object.keys(i).length!==0&&t.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}}const $8e={UVMapping:VT,CubeReflectionMapping:dh,CubeRefractionMapping:$d,EquirectangularReflectionMapping:ub,EquirectangularRefractionMapping:hb,CubeUVReflectionMapping:G0},gX={RepeatWrapping:db,ClampToEdgeWrapping:Ws,MirroredRepeatWrapping:pb},vX={NearestFilter:cn,NearestMipmapNearestFilter:TC,NearestMipmapLinearFilter:hf,LinearFilter:Nr,LinearMipmapNearestFilter:hx,LinearMipmapLinearFilter:Dc};class e9e extends Ya{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,i,r,n){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,a=qu.get(t);if(a!==void 0){if(s.manager.itemStart(t),a.then){a.then(c=>{i&&i(c),s.manager.itemEnd(t)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(t)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(t,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return qu.add(t,c),i&&i(c),s.manager.itemEnd(t),c}).catch(function(c){n&&n(c),qu.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)});qu.add(t,l),s.manager.itemStart(t)}}let VM,yF=class{static getContext(){return VM===void 0&&(VM=new(window.AudioContext||window.webkitAudioContext)),VM}static setContext(t){VM=t}};class t9e extends Ya{constructor(t){super(t)}load(t,i,r,n){const s=this,a=new ph(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{const c=l.slice(0);yF.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(t)}}}const yX=new ui,xX=new ui,Fp=new ui;class i9e{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new hn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new hn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const i=this._cache;if(i.focus!==t.focus||i.fov!==t.fov||i.aspect!==t.aspect*this.aspect||i.near!==t.near||i.far!==t.far||i.zoom!==t.zoom||i.eyeSep!==this.eyeSep){i.focus=t.focus,i.fov=t.fov,i.aspect=t.aspect*this.aspect,i.near=t.near,i.far=t.far,i.zoom=t.zoom,i.eyeSep=this.eyeSep,Fp.copy(t.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(Vf*i.fov*.5)/i.zoom;let o,l;xX.elements[12]=-n,yX.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,Fp.elements[0]=2*i.near/(l-o),Fp.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(Fp),o=-a*i.aspect-s,l=a*i.aspect-s,Fp.elements[0]=2*i.near/(l-o),Fp.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(Fp)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(xX),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(yX)}}class xF{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=bX(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=bX();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}function bX(){return(typeof performance>"u"?Date:performance).now()}const Vp=new he,wX=new Zs,r9e=new he,jp=new he;class n9e extends Zi{constructor(){super(),this.type="AudioListener",this.context=yF.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new xF}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const i=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Vp,wX,r9e),jp.set(0,0,-1).applyQuaternion(wX),i.positionX){const n=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(Vp.x,n),i.positionY.linearRampToValueAtTime(Vp.y,n),i.positionZ.linearRampToValueAtTime(Vp.z,n),i.forwardX.linearRampToValueAtTime(jp.x,n),i.forwardY.linearRampToValueAtTime(jp.y,n),i.forwardZ.linearRampToValueAtTime(jp.z,n),i.upX.linearRampToValueAtTime(r.x,n),i.upY.linearRampToValueAtTime(r.y,n),i.upZ.linearRampToValueAtTime(r.z,n)}else i.setPosition(Vp.x,Vp.y,Vp.z),i.setOrientation(jp.x,jp.y,jp.z,r.x,r.y,r.z)}}class kse extends Zi{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,i=this.filters.length;t<i;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){return this.detune=t,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Hp=new he,_X=new Zs,s9e=new he,Gp=new he;class a9e extends kse{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,i,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Hp,_X,s9e),Gp.set(0,0,1).applyQuaternion(_X);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(Hp.x,r),i.positionY.linearRampToValueAtTime(Hp.y,r),i.positionZ.linearRampToValueAtTime(Hp.z,r),i.orientationX.linearRampToValueAtTime(Gp.x,r),i.orientationY.linearRampToValueAtTime(Gp.y,r),i.orientationZ.linearRampToValueAtTime(Gp.z,r)}else i.setPosition(Hp.x,Hp.y,Hp.z),i.setOrientation(Gp.x,Gp.y,Gp.z)}}class o9e{constructor(t,i=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)t+=i[r];return t/i.length}}class Use{constructor(t,i,r){this.binding=t,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,i){const r=this.buffer,n=this.valueSize,s=t*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(t){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,t,r),this.cumulativeWeightAdditive+=t}apply(t){const i=this.valueSize,r=this.buffer,n=t*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const t=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,i=t+this.valueSize;for(let r=t;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[t+r]}_select(t,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)t[i+a]=t[r+a]}_slerp(t,i,r,n){Zs.slerpFlat(t,i,t,i,t,r,n)}_slerpAdditive(t,i,r,n,s){const a=this._workIndex*s;Zs.multiplyQuaternionsFlat(t,a,t,i,t,r),Zs.slerpFlat(t,i,t,i,t,a,n)}_lerp(t,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;t[l]=t[l]*a+t[r+o]*n}}_lerpAdditive(t,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;t[o]=t[o]+t[r+a]*n}}}const bF="\\[\\]\\.:\\/",l9e=new RegExp("["+bF+"]","g"),wF="[^"+bF+"]",c9e="[^"+bF.replace("\\.","")+"]",u9e=/((?:WC+[\/:])*)/.source.replace("WC",wF),h9e=/(WCOD+)?/.source.replace("WCOD",c9e),d9e=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wF),p9e=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wF),f9e=new RegExp("^"+u9e+h9e+d9e+p9e+"$"),m9e=["material","materials","bones","map"];class g9e{constructor(t,i,r){const n=r||ji.parseTrackName(i);this._targetGroup=t,this._bindings=t.subscribe_(i,n)}getValue(t,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(t,i)}setValue(t,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(t,i)}bind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].bind()}unbind(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=t.length;i!==r;++i)t[i].unbind()}}class ji{constructor(t,i,r){this.path=i,this.parsedPath=r||ji.parseTrackName(i),this.node=ji.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new ji.Composite(t,i,r):new ji(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(l9e,"")}static parseTrackName(t){const i=f9e.exec(t);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);m9e.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(i===void 0||i===""||i==="."||i===-1||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(r!==void 0)return r}if(t.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)t[i++]=r[n]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(t||(t=ji.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===c){c=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[r]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const a=t[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",t);return}let o=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ji.Composite=g9e;ji.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ji.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ji.prototype.GetterByBindingType=[ji.prototype._getValue_direct,ji.prototype._getValue_array,ji.prototype._getValue_arrayElement,ji.prototype._getValue_toArray];ji.prototype.SetterByBindingTypeAndVersioning=[[ji.prototype._setValue_direct,ji.prototype._setValue_direct_setNeedsUpdate,ji.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ji.prototype._setValue_array,ji.prototype._setValue_array_setNeedsUpdate,ji.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ji.prototype._setValue_arrayElement,ji.prototype._setValue_arrayElement_setNeedsUpdate,ji.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ji.prototype._setValue_fromArray,ji.prototype._setValue_fromArray_setNeedsUpdate,ji.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class v9e{constructor(){this.isAnimationObjectGroup=!0,this.uuid=fo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let r=0,n=arguments.length;r!==n;++r)t[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const t=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=t.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],p=d.uuid;let f=i[p];if(f===void 0){f=l++,i[p]=f,t.push(d);for(let v=0,m=a;v!==m;++v)s[v].push(new ji(d,r[v],n[v]))}else if(f<c){o=t[f];const v=--c,m=t[v];i[m.uuid]=f,t[f]=m,i[p]=v,t[v]=d;for(let g=0,y=a;g!==y;++g){const x=s[g],_=x[v];let M=x[f];x[f]=_,M===void 0&&(M=new ji(d,r[g],n[g])),x[v]=M}}else t[f]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=t[h];i[d.uuid]=u,t[u]=d,i[c]=h,t[h]=l;for(let p=0,f=n;p!==f;++p){const v=r[p],m=v[h],g=v[u];v[u]=m,v[h]=g}}}this.nCachedObjects_=s}uncache(){const t=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=t.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,p=t[d],f=--a,v=t[f];i[p.uuid]=h,t[h]=p,i[v.uuid]=d,t[d]=v,t.pop();for(let m=0,g=n;m!==g;++m){const y=r[m],x=y[d],_=y[f];y[h]=x,y[d]=_,y.pop()}}else{const d=--a,p=t[d];d>0&&(i[p.uuid]=h),t[h]=p,t.pop();for(let f=0,v=n;f!==v;++f){const m=r[f];m[h]=m[d],m.pop()}}}this.nCachedObjects_=s}subscribe_(t,i){const r=this._bindingsIndicesByPath;let n=r[t];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[t]=n,a.push(t),o.push(i),s.push(h);for(let d=u,p=l.length;d!==p;++d){const f=l[d];h[d]=new ji(f,t,i)}return h}unsubscribe_(t){const i=this._bindingsIndicesByPath,r=i[t];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=t[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class Fse{constructor(t,i,r=null,n=i.blendMode){this._mixer=t,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:Ef,endingEnd:Ef};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=bne,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,i){return this.loop=t,this.repetitions=i,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,i,r){if(t.fadeOut(i),this.fadeIn(i),r){const n=this._clip.duration,s=t._clip.duration,a=s/n,o=n/s;t.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(t,i,r){return t.crossFadeFrom(this,i,r)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=t/a,c[1]=i/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,i,r,n){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const l=(t-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(t);const a=this._updateTime(i),o=this._updateWeight(t);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case HU:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case HT:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(t){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(t){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(t)[0];i*=n,t>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(t){const i=this._clip.duration,r=this.loop;let n=this.time+t,s=this._loopCount;const a=r===wne;if(t===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===xne){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(t,i,r){const n=this._interpolantSettings;r?(n.endingStart=Af,n.endingEnd=Af):(t?n.endingStart=this.zeroSlopeAtStart?Af:Ef:n.endingStart=gb,i?n.endingEnd=this.zeroSlopeAtEnd?Af:Ef:n.endingEnd=gb)}_scheduleFading(t,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+t,l[1]=r,this}}const y9e=new Float32Array(1);class x9e extends yh{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,i){const r=t._localRoot||this._root,n=t._clip.tracks,s=n.length,a=t._propertyBindings,o=t._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],p=d.name;let f=u[p];if(f!==void 0)++f.referenceCount,a[h]=f;else{if(f=a[h],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const v=i&&i._propertyBindings[h].binding.parsedPath;f=new Use(ji.create(r,p,v),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),a[h]=f}o[h].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const r=(t._localRoot||this._root).uuid,n=t._clip.uuid,s=this._actionsByClip[n];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,n,r)}const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const i=t._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(t,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t}_removeInactiveAction(t){const i=this._actions,r=i[i.length-1],n=t._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),t._cacheIndex=null;const s=t._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=t._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),t._byClipCacheIndex=null;const h=o.actionByRoot,d=(t._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const i=t._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const i=this._actions,r=t._cacheIndex,n=this._nActiveActions++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackAction(t){const i=this._actions,r=t._cacheIndex,n=--this._nActiveActions,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_addInactiveBinding(t,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const i=this._bindings,r=t.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=t._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(t){const i=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_takeBackBinding(t){const i=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,s=i[n];t._cacheIndex=n,i[n]=t,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const t=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=t[i];return r===void 0&&(r=new fF(new Float32Array(2),new Float32Array(2),1,y9e),r.__cacheIndex=i,t[i]=r),r}_takeBackControlInterpolant(t){const i=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];t.__cacheIndex=n,i[n]=t,s.__cacheIndex=r,i[r]=s}clipAction(t,i,r){const n=i||this._root,s=n.uuid;let a=typeof t=="string"?Pb.findByName(n,t):t;const o=a!==null?a.uuid:t,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=HT),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new Fse(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(t,i){const r=i||this._root,n=r.uuid,s=typeof t=="string"?Pb.findByName(r,t):t,a=s?s.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)t[r].stop();return this}update(t){t*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=t,s=Math.sign(t),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,t,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const i=this._actions,r=t.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(t){const i=t.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(t,i){const r=this.existingAction(t,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class _F{constructor(t){this.value=t}clone(){return new _F(this.value.clone===void 0?this.value:this.value.clone())}}let b9e=0;class w9e extends yh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:b9e++}),this.name="",this.usage=bb,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const i=this.uniforms.indexOf(t);return i!==-1&&this.uniforms.splice(i,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const i=t.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++){const s=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class _9e extends ZT{constructor(t,i,r=1){super(t,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const i=super.clone(t);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(t){const i=super.toJSON(t);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class S9e{constructor(t,i,r,n,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,i){return this.type=t,this.elementSize=i,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}const SX=new ui;class Vse{constructor(t,i,r=0,n=1/0){this.ray=new xm(t,i),this.near=r,this.far=n,this.camera=null,this.layers=new jf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,i){this.ray.set(t,i)}setFromCamera(t,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(t){return SX.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(SX),this}intersectObject(t,i=!0,r=[]){return fz(t,this,r,i),r.sort(MX),r}intersectObjects(t,i=!0,r=[]){for(let n=0,s=t.length;n<s;n++)fz(t[n],this,r,i);return r.sort(MX),r}}function MX(e,t){return e.distance-t.distance}function fz(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){const n=e.children;for(let s=0,a=n.length;s<a;s++)fz(n[s],t,i,!0)}}class RC{constructor(t=1,i=0,r=0){return this.radius=t,this.phi=i,this.theta=r,this}set(t,i,r){return this.radius=t,this.phi=i,this.theta=r,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(Kr(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class M9e{constructor(t=1,i=0,r=0){return this.radius=t,this.theta=i,this.y=r,this}set(t,i,r){return this.radius=t,this.theta=i,this.y=r,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,i,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}const EX=new nt;class E9e{constructor(t=new nt(1/0,1/0),i=new nt(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=i}set(t,i){return this.min.copy(t),this.max.copy(i),this}setFromPoints(t){this.makeEmpty();for(let i=0,r=t.length;i<r;i++)this.expandByPoint(t[i]);return this}setFromCenterAndSize(t,i){const r=EX.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,i){return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,i){return i.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,EX).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const AX=new he,jM=new he;class A9e{constructor(t=new he,i=new he){this.start=t,this.end=i}set(t,i){return this.start.copy(t),this.end.copy(i),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,i){return this.delta(i).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,i){AX.subVectors(t,this.start),jM.subVectors(this.end,this.start);const r=jM.dot(jM);let s=jM.dot(AX)/r;return i&&(s=Kr(s,0,1)),s}closestPointToPoint(t,i,r){const n=this.closestPointToPointParameter(t,i);return this.delta(r).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const CX=new he;class C9e extends Zi{constructor(t,i){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new Ei,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new Ut(n,3));const s=new Aa({fog:!1,toneMapped:!1});this.cone=new Qc(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),CX.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(CX),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Qh=new he,HM=new ui,XL=new ui;class T9e extends Qc{constructor(t){const i=jse(t),r=new Ei,n=[],s=[],a=new Rt(0,0,1),o=new Rt(0,1,0);for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(o.r,o.g,o.b))}r.setAttribute("position",new Ut(n,3)),r.setAttribute("color",new Ut(s,3));const l=new Aa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=i,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const i=this.bones,r=this.geometry,n=r.getAttribute("position");XL.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(HM.multiplyMatrices(XL,o.matrixWorld),Qh.setFromMatrixPosition(HM),n.setXYZ(a,Qh.x,Qh.y,Qh.z),HM.multiplyMatrices(XL,o.parent.matrixWorld),Qh.setFromMatrixPosition(HM),n.setXYZ(a+1,Qh.x,Qh.y,Qh.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function jse(e){const t=[];e.isBone===!0&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,jse(e.children[i]));return t}class P9e extends An{constructor(t,i,r){const n=new mw(i,4,2),s=new hp({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=t,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const D9e=new he,TX=new Rt,PX=new Rt;class L9e extends Zi{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new fw(i);n.rotateY(Math.PI*.5),this.material=new hp({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new pr(a,3)),this.add(new An(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=t.geometry.getAttribute("color");TX.copy(this.light.color),PX.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?TX:PX;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(D9e.setFromMatrixPosition(this.light.matrixWorld).negate())}}class R9e extends Qc{constructor(t=10,i=10,r=4473924,n=8947848){r=new Rt(r),n=new Rt(n);const s=i/2,a=t/i,o=t/2,l=[],c=[];for(let d=0,p=0,f=-o;d<=i;d++,f+=a){l.push(-o,0,f,o,0,f),l.push(f,0,-o,f,0,o);const v=d===s?r:n;v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3,v.toArray(c,p),p+=3}const u=new Ei;u.setAttribute("position",new Ut(l,3)),u.setAttribute("color",new Ut(c,3));const h=new Aa({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class I9e extends Qc{constructor(t=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new Rt(s),a=new Rt(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),p=Math.sin(d)*t,f=Math.cos(d)*t;o.push(0,0,0),o.push(p,0,f);const v=h&1?s:a;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(let h=0;h<r;h++){const d=h&1?s:a,p=t-t/r*h;for(let f=0;f<n;f++){let v=f/n*(Math.PI*2),m=Math.sin(v)*p,g=Math.cos(v)*p;o.push(m,0,g),l.push(d.r,d.g,d.b),v=(f+1)/n*(Math.PI*2),m=Math.sin(v)*p,g=Math.cos(v)*p,o.push(m,0,g),l.push(d.r,d.g,d.b)}}const c=new Ei;c.setAttribute("position",new Ut(o,3)),c.setAttribute("color",new Ut(l,3));const u=new Aa({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const DX=new he,GM=new he,LX=new he;class O9e extends Zi{constructor(t,i,r){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new Ei;n.setAttribute("position",new Ut([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new Aa({fog:!1,toneMapped:!1});this.lightPlane=new ep(n,s),this.add(this.lightPlane),n=new Ei,n.setAttribute("position",new Ut([0,0,0,0,0,1],3)),this.targetLine=new ep(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),DX.setFromMatrixPosition(this.light.matrixWorld),GM.setFromMatrixPosition(this.light.target.matrixWorld),LX.subVectors(GM,DX),this.lightPlane.lookAt(GM),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(GM),this.targetLine.scale.z=LX.length()}}const WM=new he,Xr=new uw;class N9e extends Qc{constructor(t){const i=new Ei,r=new Aa({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(f,v){l(f),l(v)}function l(f){n.push(0,0,0),s.push(0,0,0),a[f]===void 0&&(a[f]=[]),a[f].push(n.length/3-1)}i.setAttribute("position",new Ut(n,3)),i.setAttribute("color",new Ut(s,3)),super(i,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new Rt(16755200),u=new Rt(16711680),h=new Rt(43775),d=new Rt(16777215),p=new Rt(3355443);this.setColors(c,u,h,d,p)}setColors(t,i,r,n,s){const o=this.geometry.getAttribute("color");o.setXYZ(0,t.r,t.g,t.b),o.setXYZ(1,t.r,t.g,t.b),o.setXYZ(2,t.r,t.g,t.b),o.setXYZ(3,t.r,t.g,t.b),o.setXYZ(4,t.r,t.g,t.b),o.setXYZ(5,t.r,t.g,t.b),o.setXYZ(6,t.r,t.g,t.b),o.setXYZ(7,t.r,t.g,t.b),o.setXYZ(8,t.r,t.g,t.b),o.setXYZ(9,t.r,t.g,t.b),o.setXYZ(10,t.r,t.g,t.b),o.setXYZ(11,t.r,t.g,t.b),o.setXYZ(12,t.r,t.g,t.b),o.setXYZ(13,t.r,t.g,t.b),o.setXYZ(14,t.r,t.g,t.b),o.setXYZ(15,t.r,t.g,t.b),o.setXYZ(16,t.r,t.g,t.b),o.setXYZ(17,t.r,t.g,t.b),o.setXYZ(18,t.r,t.g,t.b),o.setXYZ(19,t.r,t.g,t.b),o.setXYZ(20,t.r,t.g,t.b),o.setXYZ(21,t.r,t.g,t.b),o.setXYZ(22,t.r,t.g,t.b),o.setXYZ(23,t.r,t.g,t.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0}update(){const t=this.geometry,i=this.pointMap,r=1,n=1;Xr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),on("c",i,t,Xr,0,0,-1),on("t",i,t,Xr,0,0,1),on("n1",i,t,Xr,-r,-n,-1),on("n2",i,t,Xr,r,-n,-1),on("n3",i,t,Xr,-r,n,-1),on("n4",i,t,Xr,r,n,-1),on("f1",i,t,Xr,-r,-n,1),on("f2",i,t,Xr,r,-n,1),on("f3",i,t,Xr,-r,n,1),on("f4",i,t,Xr,r,n,1),on("u1",i,t,Xr,r*.7,n*1.1,-1),on("u2",i,t,Xr,-r*.7,n*1.1,-1),on("u3",i,t,Xr,0,n*2,-1),on("cf1",i,t,Xr,-r,0,1),on("cf2",i,t,Xr,r,0,1),on("cf3",i,t,Xr,0,-n,1),on("cf4",i,t,Xr,0,n,1),on("cn1",i,t,Xr,-r,0,-1),on("cn2",i,t,Xr,r,0,-1),on("cn3",i,t,Xr,0,-n,-1),on("cn4",i,t,Xr,0,n,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function on(e,t,i,r,n,s,a){WM.set(n,s,a).unproject(r);const o=t[e];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],WM.x,WM.y,WM.z)}}const XM=new ba;class z9e extends Qc{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(8*3),s=new Ei;s.setIndex(new pr(r,1)),s.setAttribute("position",new pr(n,3)),super(s,new Aa({color:i,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&XM.setFromObject(this.object),XM.isEmpty())return;const i=XM.min,r=XM.max,n=this.geometry.attributes.position,s=n.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=i.x,s[4]=r.y,s[5]=r.z,s[6]=i.x,s[7]=i.y,s[8]=r.z,s[9]=r.x,s[10]=i.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=i.z,s[15]=i.x,s[16]=r.y,s[17]=i.z,s[18]=i.x,s[19]=i.y,s[20]=i.z,s[21]=r.x,s[22]=i.y,s[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,i){return super.copy(t,i),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class B9e extends Qc{constructor(t,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Ei;s.setIndex(new pr(r,1)),s.setAttribute("position",new Ut(n,3)),super(s,new Aa({color:i,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class k9e extends ep{constructor(t,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new Ei;a.setAttribute("position",new Ut(s,3)),a.computeBoundingSphere(),super(a,new Aa({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Ei;l.setAttribute("position",new Ut(o,3)),l.computeBoundingSphere(),this.add(new An(l,new hp({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const RX=new he;let qM,qL;class U9e extends Zi{constructor(t=new he(0,0,1),i=new he(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",qM===void 0&&(qM=new Ei,qM.setAttribute("position",new Ut([0,0,0,0,1,0],3)),qL=new q0(0,.5,1,5,1),qL.translate(0,-.5,0)),this.position.copy(i),this.line=new ep(qM,new Aa({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new An(qL,new hp({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{RX.set(t.z,0,-t.x).normalize();const i=Math.acos(t.y);this.quaternion.setFromAxisAngle(RX,i)}}setLength(t,i=t*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,t-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class F9e extends Qc{constructor(t=1){const i=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new Ei;n.setAttribute("position",new Ut(i,3)),n.setAttribute("color",new Ut(r,3));const s=new Aa({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(t,i,r){const n=new Rt,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class V9e{constructor(){this.type="ShapePath",this.color=new Rt,this.subPaths=[],this.currentPath=null}moveTo(t,i){return this.currentPath=new Sb,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,i),this}lineTo(t,i){return this.currentPath.lineTo(t,i),this}quadraticCurveTo(t,i,r,n){return this.currentPath.quadraticCurveTo(t,i,r,n),this}bezierCurveTo(t,i,r,n,s,a){return this.currentPath.bezierCurveTo(t,i,r,n,s,a),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function i(g){const y=[];for(let x=0,_=g.length;x<_;x++){const M=g[x],S=new Hf;S.curves=M.curves,y.push(S)}return y}function r(g,y){const x=y.length;let _=!1;for(let M=x-1,S=0;S<x;M=S++){let E=y[M],A=y[S],P=A.x-E.x,C=A.y-E.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(E=y[S],P=-P,A=y[M],C=-C),g.y<E.y||g.y>A.y)continue;if(g.y===E.y){if(g.x===E.x)return!0}else{const D=C*(g.x-E.x)-P*(g.y-E.y);if(D===0)return!0;if(D<0)continue;_=!_}}else{if(g.y!==E.y)continue;if(A.x<=g.x&&g.x<=E.x||E.x<=g.x&&g.x<=A.x)return!0}}return _}const n=jc.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new Hf,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=t?!u:u;const h=[],d=[];let p=[],f=0,v;d[f]=void 0,p[f]=[];for(let g=0,y=s.length;g<y;g++)o=s[g],v=o.getPoints(),a=n(v),a=t?!a:a,a?(!u&&d[f]&&f++,d[f]={s:new Hf,p:v},d[f].s.curves=o.curves,u&&f++,p[f]=[]):p[f].push({h:o,p:v[0]});if(!d[0])return i(s);if(d.length>1){let g=!1,y=0;for(let x=0,_=d.length;x<_;x++)h[x]=[];for(let x=0,_=d.length;x<_;x++){const M=p[x];for(let S=0;S<M.length;S++){const E=M[S];let A=!0;for(let P=0;P<d.length;P++)r(E.p,d[P].p)&&(x!==P&&y++,A?(A=!1,h[P].push(E)):g=!0);A&&h[x].push(E)}}y>0&&g===!1&&(p=h)}let m;for(let g=0,y=d.length;g<y;g++){l=d[g].s,c.push(l),m=p[g];for(let x=0,_=m.length;x<_;x++)l.holes.push(m[x].h)}return c}}class j9e extends Wl{constructor(t=1,i=1,r=1,n={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(t,i,{...n,count:r}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ow}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ow);const H9e=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:OU,AddEquation:pd,AddOperation:nne,AdditiveAnimationBlendMode:HU,AdditiveBlending:EC,AgXToneMapping:cne,AlphaFormat:fne,AlwaysCompare:Lne,AlwaysDepth:Kre,AlwaysStencilFunc:nz,AmbientLight:Rse,AnimationAction:Fse,AnimationClip:Pb,AnimationLoader:G8e,AnimationMixer:x9e,AnimationObjectGroup:v9e,AnimationUtils:F8e,ArcCurve:nse,ArrayCamera:Yne,ArrowHelper:U9e,AttachedBindMode:RN,Audio:kse,AudioAnalyser:o9e,AudioContext:yF,AudioListener:n9e,AudioLoader:t9e,AxesHelper:F9e,BackSide:xa,BasicDepthPacking:_ne,BasicShadowMap:Ire,BatchedMesh:tse,Bone:rF,BooleanKeyframeTrack:wm,Box2:E9e,Box3:ba,Box3Helper:B9e,BoxGeometry:bm,BoxHelper:z9e,BufferAttribute:pr,BufferGeometry:Ei,BufferGeometryLoader:Bse,ByteType:dne,Cache:qu,Camera:uw,CameraHelper:N9e,CanvasTexture:u8e,CapsuleGeometry:$T,CatmullRomCurve3:sse,CineonToneMapping:one,CircleGeometry:e2,ClampToEdgeWrapping:Ws,Clock:xF,Color:Rt,ColorKeyframeTrack:mF,ColorManagement:ir,CompressedArrayTexture:l8e,CompressedCubeTexture:c8e,CompressedTexture:KT,CompressedTextureLoader:W8e,ConeGeometry:t2,ConstantAlphaFactor:Yre,ConstantColorFactor:Xre,CubeCamera:Une,CubeReflectionMapping:dh,CubeRefractionMapping:$d,CubeTexture:hw,CubeTextureLoader:X8e,CubeUVReflectionMapping:G0,CubicBezierCurve:aF,CubicBezierCurve3:ase,CubicInterpolant:Mse,CullFaceBack:CN,CullFaceFront:Rre,CullFaceFrontBack:Y5e,CullFaceNone:Lre,Curve:Yl,CurvePath:lse,CustomBlending:Ore,CustomToneMapping:lne,CylinderGeometry:q0,Cylindrical:M9e,Data3DTexture:qU,DataArrayTexture:WT,DataTexture:Gd,DataTextureLoader:q8e,DataUtils:ije,DecrementStencilOp:sVe,DecrementWrapStencilOp:oVe,DefaultLoadingManager:Cse,DepthFormat:jd,DepthStencilFormat:nm,DepthTexture:KU,DetachedBindMode:hne,DirectionalLight:Lse,DirectionalLightHelper:O9e,DiscreteInterpolant:Ese,DisplayP3ColorSpace:GT,DodecahedronGeometry:i2,DoubleSide:Cc,DstAlphaFactor:Vre,DstColorFactor:Hre,DynamicCopyUsage:_Ve,DynamicDrawUsage:gVe,DynamicReadUsage:xVe,EdgesGeometry:cse,EllipseCurve:JT,EqualCompare:Cne,EqualDepth:$re,EqualStencilFunc:hVe,EquirectangularReflectionMapping:ub,EquirectangularRefractionMapping:hb,Euler:yo,EventDispatcher:yh,ExtrudeGeometry:n2,FileLoader:ph,Float16BufferAttribute:lje,Float32BufferAttribute:Ut,FloatType:oo,Fog:YT,FogExp2:qT,FramebufferTexture:o8e,FrontSide:hh,Frustum:dw,GLBufferAttribute:S9e,GLSL1:MVe,GLSL3:sz,GreaterCompare:Tne,GreaterDepth:tne,GreaterEqualCompare:Dne,GreaterEqualDepth:ene,GreaterEqualStencilFunc:mVe,GreaterStencilFunc:pVe,GridHelper:R9e,Group:wv,HalfFloatType:g0,HemisphereLight:Tse,HemisphereLightHelper:L9e,IcosahedronGeometry:s2,ImageBitmapLoader:e9e,ImageLoader:Db,ImageUtils:XU,IncrementStencilOp:nVe,IncrementWrapStencilOp:aVe,InstancedBufferAttribute:x0,InstancedBufferGeometry:zse,InstancedInterleavedBuffer:_9e,InstancedMesh:ese,Int16BufferAttribute:aje,Int32BufferAttribute:oje,Int8BufferAttribute:rje,IntType:NU,InterleavedBuffer:ZT,InterleavedBufferAttribute:sm,Interpolant:gw,InterpolateDiscrete:fb,InterpolateLinear:mb,InterpolateSmooth:BE,InvertStencilOp:lVe,KeepStencilOp:rf,KeyframeTrack:Zl,LOD:Jne,LatheGeometry:pw,Layers:jf,LessCompare:Ane,LessDepth:Jre,LessEqualCompare:GU,LessEqualDepth:cb,LessEqualStencilFunc:dVe,LessStencilFunc:uVe,Light:pp,LightProbe:Nse,Line:ep,Line3:A9e,LineBasicMaterial:Aa,LineCurve:oF,LineCurve3:ose,LineDashedMaterial:wse,LineLoop:ise,LineSegments:Qc,LinearDisplayP3ColorSpace:cw,LinearFilter:Nr,LinearInterpolant:fF,LinearMipMapLinearFilter:J5e,LinearMipMapNearestFilter:K5e,LinearMipmapLinearFilter:Dc,LinearMipmapNearestFilter:hx,LinearSRGBColorSpace:vh,LinearToneMapping:sne,LinearTransfer:vb,Loader:Ya,LoaderUtils:pz,LoadingManager:gF,LoopOnce:xne,LoopPingPong:wne,LoopRepeat:bne,LuminanceAlphaFormat:gne,LuminanceFormat:mne,MOUSE:ef,Material:ea,MaterialLoader:d2,MathUtils:UVe,Matrix3:xi,Matrix4:ui,MaxEquation:LN,Mesh:An,MeshBasicMaterial:hp,MeshDepthMaterial:JU,MeshDistanceMaterial:$U,MeshLambertMaterial:xse,MeshMatcapMaterial:bse,MeshNormalMaterial:yse,MeshPhongMaterial:gse,MeshPhysicalMaterial:dF,MeshStandardMaterial:hF,MeshToonMaterial:vse,MinEquation:DN,MirroredRepeatWrapping:pb,MixOperation:rne,MultiplyBlending:PN,MultiplyOperation:lw,NearestFilter:cn,NearestMipMapLinearFilter:Q5e,NearestMipMapNearestFilter:Z5e,NearestMipmapLinearFilter:hf,NearestMipmapNearestFilter:TC,NeutralToneMapping:une,NeverCompare:Ene,NeverDepth:Qre,NeverStencilFunc:cVe,NoBlending:$u,NoColorSpace:zu,NoToneMapping:Fc,NormalAnimationBlendMode:HT,NormalBlending:Ff,NotEqualCompare:Pne,NotEqualDepth:ine,NotEqualStencilFunc:fVe,NumberKeyframeTrack:Cb,Object3D:Zi,ObjectLoader:J8e,ObjectSpaceNormalMap:Mne,OctahedronGeometry:fw,OneFactor:kre,OneMinusConstantAlphaFactor:Zre,OneMinusConstantColorFactor:qre,OneMinusDstAlphaFactor:jre,OneMinusDstColorFactor:Gre,OneMinusSrcAlphaFactor:CC,OneMinusSrcColorFactor:Fre,OrthographicCamera:Hd,P3Primaries:xb,PCFShadowMap:FT,PCFSoftShadowMap:ux,PMREMGenerator:oz,Path:Sb,PerspectiveCamera:hn,Plane:Iu,PlaneGeometry:W0,PlaneHelper:k9e,PointLight:Dse,PointLightHelper:P9e,Points:rse,PointsMaterial:nF,PolarGridHelper:I9e,PolyhedronGeometry:dp,PositionalAudio:a9e,PropertyBinding:ji,PropertyMixer:Use,QuadraticBezierCurve:lF,QuadraticBezierCurve3:cF,Quaternion:Zs,QuaternionKeyframeTrack:Y0,QuaternionLinearInterpolant:Ase,RED_GREEN_RGTC2_Format:iz,RED_RGTC1_Format:yne,REVISION:ow,RGBADepthPacking:Sne,RGBAFormat:fa,RGBAIntegerFormat:VU,RGBA_ASTC_10x10_Format:QN,RGBA_ASTC_10x5_Format:qN,RGBA_ASTC_10x6_Format:YN,RGBA_ASTC_10x8_Format:ZN,RGBA_ASTC_12x10_Format:KN,RGBA_ASTC_12x12_Format:JN,RGBA_ASTC_4x4_Format:UN,RGBA_ASTC_5x4_Format:FN,RGBA_ASTC_5x5_Format:VN,RGBA_ASTC_6x5_Format:jN,RGBA_ASTC_6x6_Format:HN,RGBA_ASTC_8x5_Format:GN,RGBA_ASTC_8x6_Format:WN,RGBA_ASTC_8x8_Format:XN,RGBA_BPTC_Format:zE,RGBA_ETC2_EAC_Format:kN,RGBA_PVRTC_2BPPV1_Format:zN,RGBA_PVRTC_4BPPV1_Format:NN,RGBA_S3TC_DXT1_Format:IE,RGBA_S3TC_DXT3_Format:OE,RGBA_S3TC_DXT5_Format:NE,RGB_BPTC_SIGNED_Format:$N,RGB_BPTC_UNSIGNED_Format:ez,RGB_ETC1_Format:jU,RGB_ETC2_Format:BN,RGB_PVRTC_2BPPV1_Format:ON,RGB_PVRTC_4BPPV1_Format:IN,RGB_S3TC_DXT1_Format:RE,RGFormat:vne,RGIntegerFormat:FU,RawShaderMaterial:mse,Ray:xm,Raycaster:Vse,Rec709Primaries:yb,RectAreaLight:Ise,RedFormat:kU,RedIntegerFormat:UU,ReinhardToneMapping:ane,RenderTarget:Nne,RepeatWrapping:db,ReplaceStencilOp:rVe,ReverseSubtractEquation:zre,RingGeometry:a2,SIGNED_RED_GREEN_RGTC2_Format:rz,SIGNED_RED_RGTC1_Format:tz,SRGBColorSpace:Ho,SRGBTransfer:xr,Scene:tF,ShaderChunk:wi,ShaderLib:Dl,ShaderMaterial:sl,ShadowMaterial:fse,Shape:Hf,ShapeGeometry:o2,ShapePath:V9e,ShapeUtils:jc,ShortType:pne,Skeleton:QT,SkeletonHelper:T9e,SkinnedMesh:$ne,Source:Cf,Sphere:Qs,SphereGeometry:mw,Spherical:RC,SphericalHarmonics3:Ose,SplineCurve:uF,SpotLight:Pse,SpotLightHelper:C9e,Sprite:Kne,SpriteMaterial:iF,SrcAlphaFactor:AC,SrcAlphaSaturateFactor:Wre,SrcColorFactor:Ure,StaticCopyUsage:wVe,StaticDrawUsage:bb,StaticReadUsage:yVe,StereoCamera:i9e,StreamCopyUsage:SVe,StreamDrawUsage:vVe,StreamReadUsage:bVe,StringKeyframeTrack:_m,SubtractEquation:Nre,SubtractiveBlending:TN,TOUCH:tf,TangentSpaceNormalMap:up,TetrahedronGeometry:l2,Texture:en,TextureLoader:Y8e,TorusGeometry:c2,TorusKnotGeometry:u2,Triangle:lo,TriangleFanDrawMode:tVe,TriangleStripDrawMode:eVe,TrianglesDrawMode:$5e,TubeGeometry:h2,UVMapping:VT,Uint16BufferAttribute:YU,Uint32BufferAttribute:ZU,Uint8BufferAttribute:nje,Uint8ClampedBufferAttribute:sje,Uniform:_F,UniformsGroup:w9e,UniformsLib:St,UniformsUtils:kne,UnsignedByteType:Vc,UnsignedInt248Type:Vd,UnsignedIntType:Xu,UnsignedShort4444Type:zU,UnsignedShort5551Type:BU,UnsignedShortType:jT,VSMShadowMap:Cl,Vector2:nt,Vector3:he,Vector4:nr,VectorKeyframeTrack:Tb,VideoTexture:a8e,WebGL1Renderer:Zne,WebGL3DRenderTarget:WVe,WebGLArrayRenderTarget:GVe,WebGLCoordinateSystem:Lc,WebGLCubeRenderTarget:Fne,WebGLMultipleRenderTargets:j9e,WebGLRenderTarget:Wl,WebGLRenderer:eF,WebGLUtils:qne,WebGPUCoordinateSystem:wb,WireframeGeometry:pse,WrapAroundEnding:gb,ZeroCurvatureEnding:Ef,ZeroFactor:Bre,ZeroSlopeEnding:Af,ZeroStencilOp:iVe,_SRGBAFormat:PC,createCanvasElement:Ine},Symbol.toStringTag,{value:"Module"}));var Hse={exports:{}},Sm={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Sm.ConcurrentRoot=1;Sm.ContinuousEventPriority=4;Sm.DefaultEventPriority=16;Sm.DiscreteEventPriority=1;Sm.IdleEventPriority=536870912;Sm.LegacyRoot=0;Hse.exports=Sm;var Sv=Hse.exports;function G9e(e){let t;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(t):c;if(h!==t){const d=t;t=u?h:Object.assign({},t,h),i.forEach(p=>p(t,d))}},n=()=>t,s=(c,u=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(t);function p(){const f=u(t);if(!h(d,f)){const v=d;c(d=f,v)}}return i.add(p),()=>i.delete(p)},l={setState:r,getState:n,subscribe:(c,u,h)=>u||h?s(c,u,h):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return t=e(r,n,l),l}const W9e=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),IX=W9e?R.useEffect:R.useLayoutEffect;function X9e(e){const t=typeof e=="function"?G9e(e):e,i=(r=t.getState,n=Object.is)=>{const[,s]=R.useReducer(m=>m+1,0),a=t.getState(),o=R.useRef(a),l=R.useRef(r),c=R.useRef(n),u=R.useRef(!1),h=R.useRef();h.current===void 0&&(h.current=r(a));let d,p=!1;(o.current!==a||l.current!==r||c.current!==n||u.current)&&(d=r(a),p=!n(h.current,d)),IX(()=>{p&&(h.current=d),o.current=a,l.current=r,c.current=n,u.current=!1});const f=R.useRef(a);IX(()=>{const m=()=>{try{const y=t.getState(),x=l.current(y);c.current(h.current,x)||(o.current=y,h.current=x,s())}catch{u.current=!0,s()}},g=t.subscribe(m);return t.getState()!==f.current&&m(),g},[]);const v=p?d:h.current;return R.useDebugValue(v),v};return Object.assign(i,t),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,t];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}var Gse={exports:{}},YL={exports:{}},ZL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OX;function q9e(){return OX||(OX=1,function(e){function t(O,V){var F=O.length;O.push(V);e:for(;0<F;){var W=F-1>>>1,ee=O[W];if(0<n(ee,V))O[W]=V,O[F]=ee,F=W;else break e}}function i(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var V=O[0],F=O.pop();if(F!==V){O[0]=F;e:for(var W=0,ee=O.length,ae=ee>>>1;W<ae;){var K=2*(W+1)-1,$=O[K],ie=K+1,ye=O[ie];if(0>n($,F))ie<ee&&0>n(ye,$)?(O[W]=ye,O[ie]=F,W=ie):(O[W]=$,O[K]=F,W=K);else if(ie<ee&&0>n(ye,F))O[W]=ye,O[ie]=F,W=ie;else break e}}return V}function n(O,V){var F=O.sortIndex-V.sortIndex;return F!==0?F:O.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(O){for(var V=i(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=O)r(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=i(c)}}function _(O){if(v=!1,x(O),!f)if(i(l)!==null)f=!0,Q(M);else{var V=i(c);V!==null&&Y(_,V.startTime-O)}}function M(O,V){f=!1,v&&(v=!1,g(A),A=-1),p=!0;var F=d;try{for(x(V),h=i(l);h!==null&&(!(h.expirationTime>V)||O&&!D());){var W=h.callback;if(typeof W=="function"){h.callback=null,d=h.priorityLevel;var ee=W(h.expirationTime<=V);V=e.unstable_now(),typeof ee=="function"?h.callback=ee:h===i(l)&&r(l),x(V)}else r(l);h=i(l)}if(h!==null)var ae=!0;else{var K=i(c);K!==null&&Y(_,K.startTime-V),ae=!1}return ae}finally{h=null,d=F,p=!1}}var S=!1,E=null,A=-1,P=5,C=-1;function D(){return!(e.unstable_now()-C<P)}function N(){if(E!==null){var O=e.unstable_now();C=O;var V=!0;try{V=E(!0,O)}finally{V?U():(S=!1,E=null)}}else S=!1}var U;if(typeof y=="function")U=function(){y(N)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,G=I.port2;I.port1.onmessage=N,U=function(){G.postMessage(null)}}else U=function(){m(N,0)};function Q(O){E=O,S||(S=!0,U())}function Y(O,V){A=m(function(){O(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,Q(M))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var V=3;break;default:V=d}var F=d;d=V;try{return O()}finally{d=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,V){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var F=d;d=O;try{return V()}finally{d=F}},e.unstable_scheduleCallback=function(O,V,F){var W=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?W+F:W):F=W,O){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=F+ee,O={id:u++,callback:V,priorityLevel:O,startTime:F,expirationTime:ee,sortIndex:-1},F>W?(O.sortIndex=F,t(c,O),i(l)===null&&O===i(c)&&(v?(g(A),A=-1):v=!0,Y(_,F-W))):(O.sortIndex=ee,t(l,O),f||p||(f=!0,Q(M))),O},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(O){var V=d;return function(){var F=d;d=V;try{return O.apply(this,arguments)}finally{d=F}}}}(ZL)),ZL}var NX;function Y9e(){return NX||(NX=1,YL.exports=q9e()),YL.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z9e=function(t){var i={},r=R,n=Y9e(),s=Object.assign;function a(b){for(var w="https://reactjs.org/docs/error-decoder.html?invariant="+b,T=1;T<arguments.length;T++)w+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+b+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),_=Symbol.for("react.offscreen"),M=Symbol.iterator;function S(b){return b===null||typeof b!="object"?null:(b=M&&b[M]||b["@@iterator"],typeof b=="function"?b:null)}function E(b){if(b==null)return null;if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b;switch(b){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case g:return"SuspenseList"}if(typeof b=="object")switch(b.$$typeof){case f:return(b.displayName||"Context")+".Consumer";case p:return(b._context.displayName||"Context")+".Provider";case v:var w=b.render;return b=b.displayName,b||(b=w.displayName||w.name||"",b=b!==""?"ForwardRef("+b+")":"ForwardRef"),b;case y:return w=b.displayName||null,w!==null?w:E(b.type)||"Memo";case x:w=b._payload,b=b._init;try{return E(b(w))}catch{}}return null}function A(b){var w=b.type;switch(b.tag){case 24:return"Cache";case 9:return(w.displayName||"Context")+".Consumer";case 10:return(w._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return b=w.render,b=b.displayName||b.name||"",w.displayName||(b!==""?"ForwardRef("+b+")":"ForwardRef");case 7:return"Fragment";case 5:return w;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return E(w);case 8:return w===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w}return null}function P(b){var w=b,T=b;if(b.alternate)for(;w.return;)w=w.return;else{b=w;do w=b,w.flags&4098&&(T=w.return),b=w.return;while(b)}return w.tag===3?T:null}function C(b){if(P(b)!==b)throw Error(a(188))}function D(b){var w=b.alternate;if(!w){if(w=P(b),w===null)throw Error(a(188));return w!==b?null:b}for(var T=b,L=w;;){var B=T.return;if(B===null)break;var H=B.alternate;if(H===null){if(L=B.return,L!==null){T=L;continue}break}if(B.child===H.child){for(H=B.child;H;){if(H===T)return C(B),b;if(H===L)return C(B),w;H=H.sibling}throw Error(a(188))}if(T.return!==L.return)T=B,L=H;else{for(var fe=!1,De=B.child;De;){if(De===T){fe=!0,T=B,L=H;break}if(De===L){fe=!0,L=B,T=H;break}De=De.sibling}if(!fe){for(De=H.child;De;){if(De===T){fe=!0,T=H,L=B;break}if(De===L){fe=!0,L=H,T=B;break}De=De.sibling}if(!fe)throw Error(a(189))}}if(T.alternate!==L)throw Error(a(190))}if(T.tag!==3)throw Error(a(188));return T.stateNode.current===T?b:w}function N(b){return b=D(b),b!==null?U(b):null}function U(b){if(b.tag===5||b.tag===6)return b;for(b=b.child;b!==null;){var w=U(b);if(w!==null)return w;b=b.sibling}return null}function I(b){if(b.tag===5||b.tag===6)return b;for(b=b.child;b!==null;){if(b.tag!==4){var w=I(b);if(w!==null)return w}b=b.sibling}return null}var G=Array.isArray,Q=t.getPublicInstance,Y=t.getRootHostContext,O=t.getChildHostContext,V=t.prepareForCommit,F=t.resetAfterCommit,W=t.createInstance,ee=t.appendInitialChild,ae=t.finalizeInitialChildren,K=t.prepareUpdate,$=t.shouldSetTextContent,ie=t.createTextInstance,ye=t.scheduleTimeout,pe=t.cancelTimeout,me=t.noTimeout,ge=t.isPrimaryRenderer,xe=t.supportsMutation,te=t.supportsPersistence,we=t.supportsHydration,Ce=t.getInstanceFromNode,Se=t.preparePortalMount,Re=t.getCurrentEventPriority,Xe=t.detachDeletedInstance,Be=t.supportsMicrotasks,Fe=t.scheduleMicrotask,dt=t.supportsTestSelectors,se=t.findFiberRoot,z=t.getBoundingRect,X=t.getTextContent,ce=t.isHiddenSubtree,Ee=t.matchAccessibilityRole,q=t.setFocusIfFocusable,Ye=t.setupIntersectionObserver,et=t.appendChild,ke=t.appendChildToContainer,_e=t.commitTextUpdate,at=t.commitMount,Ve=t.commitUpdate,mt=t.insertBefore,pt=t.insertInContainerBefore,st=t.removeChild,ue=t.removeChildFromContainer,ze=t.resetTextContent,ut=t.hideInstance,de=t.hideTextInstance,Ne=t.unhideInstance,oe=t.unhideTextInstance,He=t.clearContainer,Ae=t.cloneInstance,tt=t.createContainerChildSet,ct=t.appendChildToContainerChildSet,Dt=t.finalizeContainerChildren,ai=t.replaceContainerChildren,Wt=t.cloneHiddenInstance,Ni=t.cloneHiddenTextInstance,Qt=t.canHydrateInstance,Ot=t.canHydrateTextInstance,Ps=t.canHydrateSuspenseInstance,Kc=t.isSuspenseInstancePending,al=t.isSuspenseInstanceFallback,le=t.registerSuspenseInstanceRetry,Ge=t.getNextHydratableSibling,Ze=t.getFirstHydratableChild,Ue=t.getFirstHydratableChildWithinContainer,Je=t.getFirstHydratableChildWithinSuspenseInstance,It=t.hydrateInstance,ei=t.hydrateTextInstance,oi=t.hydrateSuspenseInstance,re=t.getNextHydratableInstanceAfterSuspenseInstance,Te=t.commitHydratedContainer,Le=t.commitHydratedSuspenseInstance,Ie=t.clearSuspenseBoundary,Pe=t.clearSuspenseBoundaryFromContainer,gt=t.shouldDeleteUnhydratedTailInstances,Lt=t.didNotMatchHydratedContainerTextInstance,Ft=t.didNotMatchHydratedTextInstance,At;function bt(b){if(At===void 0)try{throw Error()}catch(T){var w=T.stack.trim().match(/\n( *(at )?)/);At=w&&w[1]||""}return`
`+At+b}var Vt=!1;function yt(b,w){if(!b||Vt)return"";Vt=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(w)if(w=function(){throw Error()},Object.defineProperty(w.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(w,[])}catch(vt){var L=vt}Reflect.construct(b,[],w)}else{try{w.call()}catch(vt){L=vt}b.call(w.prototype)}else{try{throw Error()}catch(vt){L=vt}b()}}catch(vt){if(vt&&L&&typeof vt.stack=="string"){for(var B=vt.stack.split(`
`),H=L.stack.split(`
`),fe=B.length-1,De=H.length-1;1<=fe&&0<=De&&B[fe]!==H[De];)De--;for(;1<=fe&&0<=De;fe--,De--)if(B[fe]!==H[De]){if(fe!==1||De!==1)do if(fe--,De--,0>De||B[fe]!==H[De]){var $e=`
`+B[fe].replace(" at new "," at ");return b.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",b.displayName)),$e}while(1<=fe&&0<=De);break}}}finally{Vt=!1,Error.prepareStackTrace=T}return(b=b?b.displayName||b.name:"")?bt(b):""}var Vi=Object.prototype.hasOwnProperty,Sr=[],ki=-1;function er(b){return{current:b}}function Z(b){0>ki||(b.current=Sr[ki],Sr[ki]=null,ki--)}function J(b,w){ki++,Sr[ki]=b.current,b.current=w}var be={},ne=er(be),Me=er(!1),ht=be;function jr(b,w){var T=b.type.contextTypes;if(!T)return be;var L=b.stateNode;if(L&&L.__reactInternalMemoizedUnmaskedChildContext===w)return L.__reactInternalMemoizedMaskedChildContext;var B={},H;for(H in T)B[H]=w[H];return L&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=w,b.__reactInternalMemoizedMaskedChildContext=B),B}function Hr(b){return b=b.childContextTypes,b!=null}function vr(){Z(Me),Z(ne)}function Ca(b,w,T){if(ne.current!==be)throw Error(a(168));J(ne,w),J(Me,T)}function ol(b,w,T){var L=b.stateNode;if(w=w.childContextTypes,typeof L.getChildContext!="function")return T;L=L.getChildContext();for(var B in L)if(!(B in w))throw Error(a(108,A(b)||"Unknown",B));return s({},T,L)}function tn(b){return b=(b=b.stateNode)&&b.__reactInternalMemoizedMergedChildContext||be,ht=ne.current,J(ne,b),J(Me,Me.current),!0}function Mm(b,w,T){var L=b.stateNode;if(!L)throw Error(a(169));T?(b=ol(b,w,ht),L.__reactInternalMemoizedMergedChildContext=b,Z(Me),Z(ne),J(ne,b)):Z(Me),J(Me,T)}var Za=Math.clz32?Math.clz32:Cae,yw=Math.log,Aae=Math.LN2;function Cae(b){return b>>>=0,b===0?32:31-(yw(b)/Aae|0)|0}var xw=64,bw=4194304;function Q0(b){switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return b&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return b}}function ww(b,w){var T=b.pendingLanes;if(T===0)return 0;var L=0,B=b.suspendedLanes,H=b.pingedLanes,fe=T&268435455;if(fe!==0){var De=fe&~B;De!==0?L=Q0(De):(H&=fe,H!==0&&(L=Q0(H)))}else fe=T&~B,fe!==0?L=Q0(fe):H!==0&&(L=Q0(H));if(L===0)return 0;if(w!==0&&w!==L&&!(w&B)&&(B=L&-L,H=w&-w,B>=H||B===16&&(H&4194240)!==0))return w;if(L&4&&(L|=T&16),w=b.entangledLanes,w!==0)for(b=b.entanglements,w&=L;0<w;)T=31-Za(w),B=1<<T,L|=b[T],w&=~B;return L}function Tae(b,w){switch(b){case 1:case 2:case 4:return w+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Pae(b,w){for(var T=b.suspendedLanes,L=b.pingedLanes,B=b.expirationTimes,H=b.pendingLanes;0<H;){var fe=31-Za(H),De=1<<fe,$e=B[fe];$e===-1?(!(De&T)||De&L)&&(B[fe]=Tae(De,w)):$e<=w&&(b.expiredLanes|=De),H&=~De}}function p2(b){return b=b.pendingLanes&-1073741825,b!==0?b:b&1073741824?1073741824:0}function f2(b){for(var w=[],T=0;31>T;T++)w.push(b);return w}function K0(b,w,T){b.pendingLanes|=w,w!==536870912&&(b.suspendedLanes=0,b.pingedLanes=0),b=b.eventTimes,w=31-Za(w),b[w]=T}function Dae(b,w){var T=b.pendingLanes&~w;b.pendingLanes=w,b.suspendedLanes=0,b.pingedLanes=0,b.expiredLanes&=w,b.mutableReadLanes&=w,b.entangledLanes&=w,w=b.entanglements;var L=b.eventTimes;for(b=b.expirationTimes;0<T;){var B=31-Za(T),H=1<<B;w[B]=0,L[B]=-1,b[B]=-1,T&=~H}}function m2(b,w){var T=b.entangledLanes|=w;for(b=b.entanglements;T;){var L=31-Za(T),B=1<<L;B&w|b[L]&w&&(b[L]|=w),T&=~B}}var Gi=0;function PF(b){return b&=-b,1<b?4<b?b&268435455?16:536870912:4:1}var g2=n.unstable_scheduleCallback,DF=n.unstable_cancelCallback,Lae=n.unstable_shouldYield,Rae=n.unstable_requestPaint,Yn=n.unstable_now,v2=n.unstable_ImmediatePriority,Iae=n.unstable_UserBlockingPriority,y2=n.unstable_NormalPriority,Oae=n.unstable_IdlePriority,_w=null,Ql=null;function Nae(b){if(Ql&&typeof Ql.onCommitFiberRoot=="function")try{Ql.onCommitFiberRoot(_w,b,void 0,(b.current.flags&128)===128)}catch{}}function zae(b,w){return b===w&&(b!==0||1/b===1/w)||b!==b&&w!==w}var Kl=typeof Object.is=="function"?Object.is:zae,Jc=null,Sw=!1,x2=!1;function LF(b){Jc===null?Jc=[b]:Jc.push(b)}function Bae(b){Sw=!0,LF(b)}function Jl(){if(!x2&&Jc!==null){x2=!0;var b=0,w=Gi;try{var T=Jc;for(Gi=1;b<T.length;b++){var L=T[b];do L=L(!0);while(L!==null)}Jc=null,Sw=!1}catch(B){throw Jc!==null&&(Jc=Jc.slice(b+1)),g2(v2,Jl),B}finally{Gi=w,x2=!1}}return null}var kae=o.ReactCurrentBatchConfig;function Mw(b,w){if(Kl(b,w))return!0;if(typeof b!="object"||b===null||typeof w!="object"||w===null)return!1;var T=Object.keys(b),L=Object.keys(w);if(T.length!==L.length)return!1;for(L=0;L<T.length;L++){var B=T[L];if(!Vi.call(w,B)||!Kl(b[B],w[B]))return!1}return!0}function Uae(b){switch(b.tag){case 5:return bt(b.type);case 16:return bt("Lazy");case 13:return bt("Suspense");case 19:return bt("SuspenseList");case 0:case 2:case 15:return b=yt(b.type,!1),b;case 11:return b=yt(b.type.render,!1),b;case 1:return b=yt(b.type,!0),b;default:return""}}function ll(b,w){if(b&&b.defaultProps){w=s({},w),b=b.defaultProps;for(var T in b)w[T]===void 0&&(w[T]=b[T]);return w}return w}var Ew=er(null),Aw=null,Em=null,b2=null;function w2(){b2=Em=Aw=null}function RF(b,w,T){ge?(J(Ew,w._currentValue),w._currentValue=T):(J(Ew,w._currentValue2),w._currentValue2=T)}function _2(b){var w=Ew.current;Z(Ew),ge?b._currentValue=w:b._currentValue2=w}function S2(b,w,T){for(;b!==null;){var L=b.alternate;if((b.childLanes&w)!==w?(b.childLanes|=w,L!==null&&(L.childLanes|=w)):L!==null&&(L.childLanes&w)!==w&&(L.childLanes|=w),b===T)break;b=b.return}}function Am(b,w){Aw=b,b2=Em=null,b=b.dependencies,b!==null&&b.firstContext!==null&&(b.lanes&w&&(Ja=!0),b.firstContext=null)}function wo(b){var w=ge?b._currentValue:b._currentValue2;if(b2!==b)if(b={context:b,memoizedValue:w,next:null},Em===null){if(Aw===null)throw Error(a(308));Em=b,Aw.dependencies={lanes:0,firstContext:b}}else Em=Em.next=b;return w}var $l=null,xh=!1;function M2(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function IF(b,w){b=b.updateQueue,w.updateQueue===b&&(w.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,effects:b.effects})}function $c(b,w){return{eventTime:b,lane:w,tag:0,payload:null,callback:null,next:null}}function bh(b,w){var T=b.updateQueue;T!==null&&(T=T.shared,gn!==null&&b.mode&1&&!(Ai&2)?(b=T.interleaved,b===null?(w.next=w,$l===null?$l=[T]:$l.push(T)):(w.next=b.next,b.next=w),T.interleaved=w):(b=T.pending,b===null?w.next=w:(w.next=b.next,b.next=w),T.pending=w))}function Cw(b,w,T){if(w=w.updateQueue,w!==null&&(w=w.shared,(T&4194240)!==0)){var L=w.lanes;L&=b.pendingLanes,T|=L,w.lanes=T,m2(b,T)}}function OF(b,w){var T=b.updateQueue,L=b.alternate;if(L!==null&&(L=L.updateQueue,T===L)){var B=null,H=null;if(T=T.firstBaseUpdate,T!==null){do{var fe={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};H===null?B=H=fe:H=H.next=fe,T=T.next}while(T!==null);H===null?B=H=w:H=H.next=w}else B=H=w;T={baseState:L.baseState,firstBaseUpdate:B,lastBaseUpdate:H,shared:L.shared,effects:L.effects},b.updateQueue=T;return}b=T.lastBaseUpdate,b===null?T.firstBaseUpdate=w:b.next=w,T.lastBaseUpdate=w}function Tw(b,w,T,L){var B=b.updateQueue;xh=!1;var H=B.firstBaseUpdate,fe=B.lastBaseUpdate,De=B.shared.pending;if(De!==null){B.shared.pending=null;var $e=De,vt=$e.next;$e.next=null,fe===null?H=vt:fe.next=vt,fe=$e;var zt=b.alternate;zt!==null&&(zt=zt.updateQueue,De=zt.lastBaseUpdate,De!==fe&&(De===null?zt.firstBaseUpdate=vt:De.next=vt,zt.lastBaseUpdate=$e))}if(H!==null){var vi=B.baseState;fe=0,zt=vt=$e=null,De=H;do{var ti=De.lane,fr=De.eventTime;if((L&ti)===ti){zt!==null&&(zt=zt.next={eventTime:fr,lane:0,tag:De.tag,payload:De.payload,callback:De.callback,next:null});e:{var Ht=b,Is=De;switch(ti=w,fr=T,Is.tag){case 1:if(Ht=Is.payload,typeof Ht=="function"){vi=Ht.call(fr,vi,ti);break e}vi=Ht;break e;case 3:Ht.flags=Ht.flags&-65537|128;case 0:if(Ht=Is.payload,ti=typeof Ht=="function"?Ht.call(fr,vi,ti):Ht,ti==null)break e;vi=s({},vi,ti);break e;case 2:xh=!0}}De.callback!==null&&De.lane!==0&&(b.flags|=64,ti=B.effects,ti===null?B.effects=[De]:ti.push(De))}else fr={eventTime:fr,lane:ti,tag:De.tag,payload:De.payload,callback:De.callback,next:null},zt===null?(vt=zt=fr,$e=vi):zt=zt.next=fr,fe|=ti;if(De=De.next,De===null){if(De=B.shared.pending,De===null)break;ti=De,De=ti.next,ti.next=null,B.lastBaseUpdate=ti,B.shared.pending=null}}while(!0);if(zt===null&&($e=vi),B.baseState=$e,B.firstBaseUpdate=vt,B.lastBaseUpdate=zt,w=B.shared.interleaved,w!==null){B=w;do fe|=B.lane,B=B.next;while(B!==w)}else H===null&&(B.shared.lanes=0);Nm|=fe,b.lanes=fe,b.memoizedState=vi}}function NF(b,w,T){if(b=w.effects,w.effects=null,b!==null)for(w=0;w<b.length;w++){var L=b[w],B=L.callback;if(B!==null){if(L.callback=null,L=T,typeof B!="function")throw Error(a(191,B));B.call(L)}}}var zF=new r.Component().refs;function E2(b,w,T,L){w=b.memoizedState,T=T(L,w),T=T==null?w:s({},w,T),b.memoizedState=T,b.lanes===0&&(b.updateQueue.baseState=T)}var Pw={isMounted:function(b){return(b=b._reactInternals)?P(b)===b:!1},enqueueSetState:function(b,w,T){b=b._reactInternals;var L=ia(),B=Sh(b),H=$c(L,B);H.payload=w,T!=null&&(H.callback=T),bh(b,H),w=Ao(b,B,L),w!==null&&Cw(w,b,B)},enqueueReplaceState:function(b,w,T){b=b._reactInternals;var L=ia(),B=Sh(b),H=$c(L,B);H.tag=1,H.payload=w,T!=null&&(H.callback=T),bh(b,H),w=Ao(b,B,L),w!==null&&Cw(w,b,B)},enqueueForceUpdate:function(b,w){b=b._reactInternals;var T=ia(),L=Sh(b),B=$c(T,L);B.tag=2,w!=null&&(B.callback=w),bh(b,B),w=Ao(b,L,T),w!==null&&Cw(w,b,L)}};function BF(b,w,T,L,B,H,fe){return b=b.stateNode,typeof b.shouldComponentUpdate=="function"?b.shouldComponentUpdate(L,H,fe):w.prototype&&w.prototype.isPureReactComponent?!Mw(T,L)||!Mw(B,H):!0}function kF(b,w,T){var L=!1,B=be,H=w.contextType;return typeof H=="object"&&H!==null?H=wo(H):(B=Hr(w)?ht:ne.current,L=w.contextTypes,H=(L=L!=null)?jr(b,B):be),w=new w(T,H),b.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Pw,b.stateNode=w,w._reactInternals=b,L&&(b=b.stateNode,b.__reactInternalMemoizedUnmaskedChildContext=B,b.__reactInternalMemoizedMaskedChildContext=H),w}function UF(b,w,T,L){b=w.state,typeof w.componentWillReceiveProps=="function"&&w.componentWillReceiveProps(T,L),typeof w.UNSAFE_componentWillReceiveProps=="function"&&w.UNSAFE_componentWillReceiveProps(T,L),w.state!==b&&Pw.enqueueReplaceState(w,w.state,null)}function A2(b,w,T,L){var B=b.stateNode;B.props=T,B.state=b.memoizedState,B.refs=zF,M2(b);var H=w.contextType;typeof H=="object"&&H!==null?B.context=wo(H):(H=Hr(w)?ht:ne.current,B.context=jr(b,H)),B.state=b.memoizedState,H=w.getDerivedStateFromProps,typeof H=="function"&&(E2(b,w,H,T),B.state=b.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(w=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),w!==B.state&&Pw.enqueueReplaceState(B,B.state,null),Tw(b,T,B,L),B.state=b.memoizedState),typeof B.componentDidMount=="function"&&(b.flags|=4194308)}var Cm=[],Tm=0,Dw=null,Lw=0,_o=[],So=0,fp=null,eu=1,tu="";function mp(b,w){Cm[Tm++]=Lw,Cm[Tm++]=Dw,Dw=b,Lw=w}function FF(b,w,T){_o[So++]=eu,_o[So++]=tu,_o[So++]=fp,fp=b;var L=eu;b=tu;var B=32-Za(L)-1;L&=~(1<<B),T+=1;var H=32-Za(w)+B;if(30<H){var fe=B-B%5;H=(L&(1<<fe)-1).toString(32),L>>=fe,B-=fe,eu=1<<32-Za(w)+B|T<<B|L,tu=H+b}else eu=1<<H|T<<B|L,tu=b}function C2(b){b.return!==null&&(mp(b,1),FF(b,1,0))}function T2(b){for(;b===Dw;)Dw=Cm[--Tm],Cm[Tm]=null,Lw=Cm[--Tm],Cm[Tm]=null;for(;b===fp;)fp=_o[--So],_o[So]=null,tu=_o[--So],_o[So]=null,eu=_o[--So],_o[So]=null}var Qa=null,Ka=null,Dr=!1,J0=!1,cl=null;function VF(b,w){var T=Co(5,null,null,0);T.elementType="DELETED",T.stateNode=w,T.return=b,w=b.deletions,w===null?(b.deletions=[T],b.flags|=16):w.push(T)}function jF(b,w){switch(b.tag){case 5:return w=Qt(w,b.type,b.pendingProps),w!==null?(b.stateNode=w,Qa=b,Ka=Ze(w),!0):!1;case 6:return w=Ot(w,b.pendingProps),w!==null?(b.stateNode=w,Qa=b,Ka=null,!0):!1;case 13:if(w=Ps(w),w!==null){var T=fp!==null?{id:eu,overflow:tu}:null;return b.memoizedState={dehydrated:w,treeContext:T,retryLane:1073741824},T=Co(18,null,null,0),T.stateNode=w,T.return=b,b.child=T,Qa=b,Ka=null,!0}return!1;default:return!1}}function P2(b){return(b.mode&1)!==0&&(b.flags&128)===0}function D2(b){if(Dr){var w=Ka;if(w){var T=w;if(!jF(b,w)){if(P2(b))throw Error(a(418));w=Ge(T);var L=Qa;w&&jF(b,w)?VF(L,T):(b.flags=b.flags&-4097|2,Dr=!1,Qa=b)}}else{if(P2(b))throw Error(a(418));b.flags=b.flags&-4097|2,Dr=!1,Qa=b}}}function HF(b){for(b=b.return;b!==null&&b.tag!==5&&b.tag!==3&&b.tag!==13;)b=b.return;Qa=b}function $0(b){if(!we||b!==Qa)return!1;if(!Dr)return HF(b),Dr=!0,!1;if(b.tag!==3&&(b.tag!==5||gt(b.type)&&!$(b.type,b.memoizedProps))){var w=Ka;if(w){if(P2(b)){for(b=Ka;b;)b=Ge(b);throw Error(a(418))}for(;w;)VF(b,w),w=Ge(w)}}if(HF(b),b.tag===13){if(!we)throw Error(a(316));if(b=b.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(a(317));Ka=re(b)}else Ka=Qa?Ge(b.stateNode):null;return!0}function Pm(){we&&(Ka=Qa=null,J0=Dr=!1)}function L2(b){cl===null?cl=[b]:cl.push(b)}function ey(b,w,T){if(b=T.ref,b!==null&&typeof b!="function"&&typeof b!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(a(309));var L=T.stateNode}if(!L)throw Error(a(147,b));var B=L,H=""+b;return w!==null&&w.ref!==null&&typeof w.ref=="function"&&w.ref._stringRef===H?w.ref:(w=function(fe){var De=B.refs;De===zF&&(De=B.refs={}),fe===null?delete De[H]:De[H]=fe},w._stringRef=H,w)}if(typeof b!="string")throw Error(a(284));if(!T._owner)throw Error(a(290,b))}return b}function Rw(b,w){throw b=Object.prototype.toString.call(w),Error(a(31,b==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":b))}function GF(b){var w=b._init;return w(b._payload)}function WF(b){function w(We,Oe){if(b){var Qe=We.deletions;Qe===null?(We.deletions=[Oe],We.flags|=16):Qe.push(Oe)}}function T(We,Oe){if(!b)return null;for(;Oe!==null;)w(We,Oe),Oe=Oe.sibling;return null}function L(We,Oe){for(We=new Map;Oe!==null;)Oe.key!==null?We.set(Oe.key,Oe):We.set(Oe.index,Oe),Oe=Oe.sibling;return We}function B(We,Oe){return We=Eh(We,Oe),We.index=0,We.sibling=null,We}function H(We,Oe,Qe){return We.index=Qe,b?(Qe=We.alternate,Qe!==null?(Qe=Qe.index,Qe<Oe?(We.flags|=2,Oe):Qe):(We.flags|=2,Oe)):(We.flags|=1048576,Oe)}function fe(We){return b&&We.alternate===null&&(We.flags|=2),We}function De(We,Oe,Qe,Tt){return Oe===null||Oe.tag!==6?(Oe=fP(Qe,We.mode,Tt),Oe.return=We,Oe):(Oe=B(Oe,Qe),Oe.return=We,Oe)}function $e(We,Oe,Qe,Tt){var jt=Qe.type;return jt===u?zt(We,Oe,Qe.props.children,Tt,Qe.key):Oe!==null&&(Oe.elementType===jt||typeof jt=="object"&&jt!==null&&jt.$$typeof===x&&GF(jt)===Oe.type)?(Tt=B(Oe,Qe.props),Tt.ref=ey(We,Oe,Qe),Tt.return=We,Tt):(Tt=c_(Qe.type,Qe.key,Qe.props,null,We.mode,Tt),Tt.ref=ey(We,Oe,Qe),Tt.return=We,Tt)}function vt(We,Oe,Qe,Tt){return Oe===null||Oe.tag!==4||Oe.stateNode.containerInfo!==Qe.containerInfo||Oe.stateNode.implementation!==Qe.implementation?(Oe=mP(Qe,We.mode,Tt),Oe.return=We,Oe):(Oe=B(Oe,Qe.children||[]),Oe.return=We,Oe)}function zt(We,Oe,Qe,Tt,jt){return Oe===null||Oe.tag!==7?(Oe=_p(Qe,We.mode,Tt,jt),Oe.return=We,Oe):(Oe=B(Oe,Qe),Oe.return=We,Oe)}function vi(We,Oe,Qe){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return Oe=fP(""+Oe,We.mode,Qe),Oe.return=We,Oe;if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case l:return Qe=c_(Oe.type,Oe.key,Oe.props,null,We.mode,Qe),Qe.ref=ey(We,null,Oe),Qe.return=We,Qe;case c:return Oe=mP(Oe,We.mode,Qe),Oe.return=We,Oe;case x:var Tt=Oe._init;return vi(We,Tt(Oe._payload),Qe)}if(G(Oe)||S(Oe))return Oe=_p(Oe,We.mode,Qe,null),Oe.return=We,Oe;Rw(We,Oe)}return null}function ti(We,Oe,Qe,Tt){var jt=Oe!==null?Oe.key:null;if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number")return jt!==null?null:De(We,Oe,""+Qe,Tt);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case l:return Qe.key===jt?$e(We,Oe,Qe,Tt):null;case c:return Qe.key===jt?vt(We,Oe,Qe,Tt):null;case x:return jt=Qe._init,ti(We,Oe,jt(Qe._payload),Tt)}if(G(Qe)||S(Qe))return jt!==null?null:zt(We,Oe,Qe,Tt,null);Rw(We,Qe)}return null}function fr(We,Oe,Qe,Tt,jt){if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return We=We.get(Qe)||null,De(Oe,We,""+Tt,jt);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case l:return We=We.get(Tt.key===null?Qe:Tt.key)||null,$e(Oe,We,Tt,jt);case c:return We=We.get(Tt.key===null?Qe:Tt.key)||null,vt(Oe,We,Tt,jt);case x:var Mi=Tt._init;return fr(We,Oe,Qe,Mi(Tt._payload),jt)}if(G(Tt)||S(Tt))return We=We.get(Qe)||null,zt(Oe,We,Tt,jt,null);Rw(Oe,Tt)}return null}function Ht(We,Oe,Qe,Tt){for(var jt=null,Mi=null,yi=Oe,Wi=Oe=0,Qn=null;yi!==null&&Wi<Qe.length;Wi++){yi.index>Wi?(Qn=yi,yi=null):Qn=yi.sibling;var Xi=ti(We,yi,Qe[Wi],Tt);if(Xi===null){yi===null&&(yi=Qn);break}b&&yi&&Xi.alternate===null&&w(We,yi),Oe=H(Xi,Oe,Wi),Mi===null?jt=Xi:Mi.sibling=Xi,Mi=Xi,yi=Qn}if(Wi===Qe.length)return T(We,yi),Dr&&mp(We,Wi),jt;if(yi===null){for(;Wi<Qe.length;Wi++)yi=vi(We,Qe[Wi],Tt),yi!==null&&(Oe=H(yi,Oe,Wi),Mi===null?jt=yi:Mi.sibling=yi,Mi=yi);return Dr&&mp(We,Wi),jt}for(yi=L(We,yi);Wi<Qe.length;Wi++)Qn=fr(yi,We,Wi,Qe[Wi],Tt),Qn!==null&&(b&&Qn.alternate!==null&&yi.delete(Qn.key===null?Wi:Qn.key),Oe=H(Qn,Oe,Wi),Mi===null?jt=Qn:Mi.sibling=Qn,Mi=Qn);return b&&yi.forEach(function(Ah){return w(We,Ah)}),Dr&&mp(We,Wi),jt}function Is(We,Oe,Qe,Tt){var jt=S(Qe);if(typeof jt!="function")throw Error(a(150));if(Qe=jt.call(Qe),Qe==null)throw Error(a(151));for(var Mi=jt=null,yi=Oe,Wi=Oe=0,Qn=null,Xi=Qe.next();yi!==null&&!Xi.done;Wi++,Xi=Qe.next()){yi.index>Wi?(Qn=yi,yi=null):Qn=yi.sibling;var Ah=ti(We,yi,Xi.value,Tt);if(Ah===null){yi===null&&(yi=Qn);break}b&&yi&&Ah.alternate===null&&w(We,yi),Oe=H(Ah,Oe,Wi),Mi===null?jt=Ah:Mi.sibling=Ah,Mi=Ah,yi=Qn}if(Xi.done)return T(We,yi),Dr&&mp(We,Wi),jt;if(yi===null){for(;!Xi.done;Wi++,Xi=Qe.next())Xi=vi(We,Xi.value,Tt),Xi!==null&&(Oe=H(Xi,Oe,Wi),Mi===null?jt=Xi:Mi.sibling=Xi,Mi=Xi);return Dr&&mp(We,Wi),jt}for(yi=L(We,yi);!Xi.done;Wi++,Xi=Qe.next())Xi=fr(yi,We,Wi,Xi.value,Tt),Xi!==null&&(b&&Xi.alternate!==null&&yi.delete(Xi.key===null?Wi:Xi.key),Oe=H(Xi,Oe,Wi),Mi===null?jt=Xi:Mi.sibling=Xi,Mi=Xi);return b&&yi.forEach(function(moe){return w(We,moe)}),Dr&&mp(We,Wi),jt}function To(We,Oe,Qe,Tt){if(typeof Qe=="object"&&Qe!==null&&Qe.type===u&&Qe.key===null&&(Qe=Qe.props.children),typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case l:e:{for(var jt=Qe.key,Mi=Oe;Mi!==null;){if(Mi.key===jt){if(jt=Qe.type,jt===u){if(Mi.tag===7){T(We,Mi.sibling),Oe=B(Mi,Qe.props.children),Oe.return=We,We=Oe;break e}}else if(Mi.elementType===jt||typeof jt=="object"&&jt!==null&&jt.$$typeof===x&&GF(jt)===Mi.type){T(We,Mi.sibling),Oe=B(Mi,Qe.props),Oe.ref=ey(We,Mi,Qe),Oe.return=We,We=Oe;break e}T(We,Mi);break}else w(We,Mi);Mi=Mi.sibling}Qe.type===u?(Oe=_p(Qe.props.children,We.mode,Tt,Qe.key),Oe.return=We,We=Oe):(Tt=c_(Qe.type,Qe.key,Qe.props,null,We.mode,Tt),Tt.ref=ey(We,Oe,Qe),Tt.return=We,We=Tt)}return fe(We);case c:e:{for(Mi=Qe.key;Oe!==null;){if(Oe.key===Mi)if(Oe.tag===4&&Oe.stateNode.containerInfo===Qe.containerInfo&&Oe.stateNode.implementation===Qe.implementation){T(We,Oe.sibling),Oe=B(Oe,Qe.children||[]),Oe.return=We,We=Oe;break e}else{T(We,Oe);break}else w(We,Oe);Oe=Oe.sibling}Oe=mP(Qe,We.mode,Tt),Oe.return=We,We=Oe}return fe(We);case x:return Mi=Qe._init,To(We,Oe,Mi(Qe._payload),Tt)}if(G(Qe))return Ht(We,Oe,Qe,Tt);if(S(Qe))return Is(We,Oe,Qe,Tt);Rw(We,Qe)}return typeof Qe=="string"&&Qe!==""||typeof Qe=="number"?(Qe=""+Qe,Oe!==null&&Oe.tag===6?(T(We,Oe.sibling),Oe=B(Oe,Qe),Oe.return=We,We=Oe):(T(We,Oe),Oe=fP(Qe,We.mode,Tt),Oe.return=We,We=Oe),fe(We)):T(We,Oe)}return To}var Dm=WF(!0),XF=WF(!1),ty={},Mo=er(ty),iy=er(ty),Lm=er(ty);function ec(b){if(b===ty)throw Error(a(174));return b}function R2(b,w){J(Lm,w),J(iy,b),J(Mo,ty),b=Y(w),Z(Mo),J(Mo,b)}function Rm(){Z(Mo),Z(iy),Z(Lm)}function qF(b){var w=ec(Lm.current),T=ec(Mo.current);w=O(T,b.type,w),T!==w&&(J(iy,b),J(Mo,w))}function I2(b){iy.current===b&&(Z(Mo),Z(iy))}var Ir=er(0);function Iw(b){for(var w=b;w!==null;){if(w.tag===13){var T=w.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||Kc(T)||al(T)))return w}else if(w.tag===19&&w.memoizedProps.revealOrder!==void 0){if(w.flags&128)return w}else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===b)break;for(;w.sibling===null;){if(w.return===null||w.return===b)return null;w=w.return}w.sibling.return=w.return,w=w.sibling}return null}var O2=[];function N2(){for(var b=0;b<O2.length;b++){var w=O2[b];ge?w._workInProgressVersionPrimary=null:w._workInProgressVersionSecondary=null}O2.length=0}var Ow=o.ReactCurrentDispatcher,Eo=o.ReactCurrentBatchConfig,Im=0,Gr=null,Ds=null,Zn=null,Nw=!1,ry=!1,ny=0,Fae=0;function Ls(){throw Error(a(321))}function z2(b,w){if(w===null)return!1;for(var T=0;T<w.length&&T<b.length;T++)if(!Kl(b[T],w[T]))return!1;return!0}function B2(b,w,T,L,B,H){if(Im=H,Gr=w,w.memoizedState=null,w.updateQueue=null,w.lanes=0,Ow.current=b===null||b.memoizedState===null?Gae:Wae,b=T(L,B),ry){H=0;do{if(ry=!1,ny=0,25<=H)throw Error(a(301));H+=1,Zn=Ds=null,w.updateQueue=null,Ow.current=Xae,b=T(L,B)}while(ry)}if(Ow.current=Fw,w=Ds!==null&&Ds.next!==null,Im=0,Zn=Ds=Gr=null,Nw=!1,w)throw Error(a(300));return b}function k2(){var b=ny!==0;return ny=0,b}function iu(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zn===null?Gr.memoizedState=Zn=b:Zn=Zn.next=b,Zn}function tc(){if(Ds===null){var b=Gr.alternate;b=b!==null?b.memoizedState:null}else b=Ds.next;var w=Zn===null?Gr.memoizedState:Zn.next;if(w!==null)Zn=w,Ds=b;else{if(b===null)throw Error(a(310));Ds=b,b={memoizedState:Ds.memoizedState,baseState:Ds.baseState,baseQueue:Ds.baseQueue,queue:Ds.queue,next:null},Zn===null?Gr.memoizedState=Zn=b:Zn=Zn.next=b}return Zn}function gp(b,w){return typeof w=="function"?w(b):w}function zw(b){var w=tc(),T=w.queue;if(T===null)throw Error(a(311));T.lastRenderedReducer=b;var L=Ds,B=L.baseQueue,H=T.pending;if(H!==null){if(B!==null){var fe=B.next;B.next=H.next,H.next=fe}L.baseQueue=B=H,T.pending=null}if(B!==null){H=B.next,L=L.baseState;var De=fe=null,$e=null,vt=H;do{var zt=vt.lane;if((Im&zt)===zt)$e!==null&&($e=$e.next={lane:0,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null}),L=vt.hasEagerState?vt.eagerState:b(L,vt.action);else{var vi={lane:zt,action:vt.action,hasEagerState:vt.hasEagerState,eagerState:vt.eagerState,next:null};$e===null?(De=$e=vi,fe=L):$e=$e.next=vi,Gr.lanes|=zt,Nm|=zt}vt=vt.next}while(vt!==null&&vt!==H);$e===null?fe=L:$e.next=De,Kl(L,w.memoizedState)||(Ja=!0),w.memoizedState=L,w.baseState=fe,w.baseQueue=$e,T.lastRenderedState=L}if(b=T.interleaved,b!==null){B=b;do H=B.lane,Gr.lanes|=H,Nm|=H,B=B.next;while(B!==b)}else B===null&&(T.lanes=0);return[w.memoizedState,T.dispatch]}function Bw(b){var w=tc(),T=w.queue;if(T===null)throw Error(a(311));T.lastRenderedReducer=b;var L=T.dispatch,B=T.pending,H=w.memoizedState;if(B!==null){T.pending=null;var fe=B=B.next;do H=b(H,fe.action),fe=fe.next;while(fe!==B);Kl(H,w.memoizedState)||(Ja=!0),w.memoizedState=H,w.baseQueue===null&&(w.baseState=H),T.lastRenderedState=H}return[H,L]}function YF(){}function ZF(b,w){var T=Gr,L=tc(),B=w(),H=!Kl(L.memoizedState,B);if(H&&(L.memoizedState=B,Ja=!0),L=L.queue,ay(JF.bind(null,T,L,b),[b]),L.getSnapshot!==w||H||Zn!==null&&Zn.memoizedState.tag&1){if(T.flags|=2048,sy(9,KF.bind(null,T,L,B,w),void 0,null),gn===null)throw Error(a(349));Im&30||QF(T,w,B)}return B}function QF(b,w,T){b.flags|=16384,b={getSnapshot:w,value:T},w=Gr.updateQueue,w===null?(w={lastEffect:null,stores:null},Gr.updateQueue=w,w.stores=[b]):(T=w.stores,T===null?w.stores=[b]:T.push(b))}function KF(b,w,T,L){w.value=T,w.getSnapshot=L,$F(w)&&Ao(b,1,-1)}function JF(b,w,T){return T(function(){$F(w)&&Ao(b,1,-1)})}function $F(b){var w=b.getSnapshot;b=b.value;try{var T=w();return!Kl(b,T)}catch{return!0}}function U2(b){var w=iu();return typeof b=="function"&&(b=b()),w.memoizedState=w.baseState=b,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:b},w.queue=b,b=b.dispatch=Hae.bind(null,Gr,b),[w.memoizedState,b]}function sy(b,w,T,L){return b={tag:b,create:w,destroy:T,deps:L,next:null},w=Gr.updateQueue,w===null?(w={lastEffect:null,stores:null},Gr.updateQueue=w,w.lastEffect=b.next=b):(T=w.lastEffect,T===null?w.lastEffect=b.next=b:(L=T.next,T.next=b,b.next=L,w.lastEffect=b)),b}function e4(){return tc().memoizedState}function kw(b,w,T,L){var B=iu();Gr.flags|=b,B.memoizedState=sy(1|w,T,void 0,L===void 0?null:L)}function Uw(b,w,T,L){var B=tc();L=L===void 0?null:L;var H=void 0;if(Ds!==null){var fe=Ds.memoizedState;if(H=fe.destroy,L!==null&&z2(L,fe.deps)){B.memoizedState=sy(w,T,H,L);return}}Gr.flags|=b,B.memoizedState=sy(1|w,T,H,L)}function F2(b,w){return kw(8390656,8,b,w)}function ay(b,w){return Uw(2048,8,b,w)}function t4(b,w){return Uw(4,2,b,w)}function i4(b,w){return Uw(4,4,b,w)}function r4(b,w){if(typeof w=="function")return b=b(),w(b),function(){w(null)};if(w!=null)return b=b(),w.current=b,function(){w.current=null}}function n4(b,w,T){return T=T!=null?T.concat([b]):null,Uw(4,4,r4.bind(null,w,b),T)}function V2(){}function s4(b,w){var T=tc();w=w===void 0?null:w;var L=T.memoizedState;return L!==null&&w!==null&&z2(w,L[1])?L[0]:(T.memoizedState=[b,w],b)}function a4(b,w){var T=tc();w=w===void 0?null:w;var L=T.memoizedState;return L!==null&&w!==null&&z2(w,L[1])?L[0]:(b=b(),T.memoizedState=[b,w],b)}function Vae(b,w){var T=Gi;Gi=T!==0&&4>T?T:4,b(!0);var L=Eo.transition;Eo.transition={};try{b(!1),w()}finally{Gi=T,Eo.transition=L}}function o4(){return tc().memoizedState}function jae(b,w,T){var L=Sh(b);T={lane:L,action:T,hasEagerState:!1,eagerState:null,next:null},l4(b)?c4(w,T):(u4(b,w,T),T=ia(),b=Ao(b,L,T),b!==null&&h4(b,w,L))}function Hae(b,w,T){var L=Sh(b),B={lane:L,action:T,hasEagerState:!1,eagerState:null,next:null};if(l4(b))c4(w,B);else{u4(b,w,B);var H=b.alternate;if(b.lanes===0&&(H===null||H.lanes===0)&&(H=w.lastRenderedReducer,H!==null))try{var fe=w.lastRenderedState,De=H(fe,T);if(B.hasEagerState=!0,B.eagerState=De,Kl(De,fe))return}catch{}finally{}T=ia(),b=Ao(b,L,T),b!==null&&h4(b,w,L)}}function l4(b){var w=b.alternate;return b===Gr||w!==null&&w===Gr}function c4(b,w){ry=Nw=!0;var T=b.pending;T===null?w.next=w:(w.next=T.next,T.next=w),b.pending=w}function u4(b,w,T){gn!==null&&b.mode&1&&!(Ai&2)?(b=w.interleaved,b===null?(T.next=T,$l===null?$l=[w]:$l.push(w)):(T.next=b.next,b.next=T),w.interleaved=T):(b=w.pending,b===null?T.next=T:(T.next=b.next,b.next=T),w.pending=T)}function h4(b,w,T){if(T&4194240){var L=w.lanes;L&=b.pendingLanes,T|=L,w.lanes=T,m2(b,T)}}var Fw={readContext:wo,useCallback:Ls,useContext:Ls,useEffect:Ls,useImperativeHandle:Ls,useInsertionEffect:Ls,useLayoutEffect:Ls,useMemo:Ls,useReducer:Ls,useRef:Ls,useState:Ls,useDebugValue:Ls,useDeferredValue:Ls,useTransition:Ls,useMutableSource:Ls,useSyncExternalStore:Ls,useId:Ls,unstable_isNewReconciler:!1},Gae={readContext:wo,useCallback:function(b,w){return iu().memoizedState=[b,w===void 0?null:w],b},useContext:wo,useEffect:F2,useImperativeHandle:function(b,w,T){return T=T!=null?T.concat([b]):null,kw(4194308,4,r4.bind(null,w,b),T)},useLayoutEffect:function(b,w){return kw(4194308,4,b,w)},useInsertionEffect:function(b,w){return kw(4,2,b,w)},useMemo:function(b,w){var T=iu();return w=w===void 0?null:w,b=b(),T.memoizedState=[b,w],b},useReducer:function(b,w,T){var L=iu();return w=T!==void 0?T(w):w,L.memoizedState=L.baseState=w,b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:w},L.queue=b,b=b.dispatch=jae.bind(null,Gr,b),[L.memoizedState,b]},useRef:function(b){var w=iu();return b={current:b},w.memoizedState=b},useState:U2,useDebugValue:V2,useDeferredValue:function(b){var w=U2(b),T=w[0],L=w[1];return F2(function(){var B=Eo.transition;Eo.transition={};try{L(b)}finally{Eo.transition=B}},[b]),T},useTransition:function(){var b=U2(!1),w=b[0];return b=Vae.bind(null,b[1]),iu().memoizedState=b,[w,b]},useMutableSource:function(){},useSyncExternalStore:function(b,w,T){var L=Gr,B=iu();if(Dr){if(T===void 0)throw Error(a(407));T=T()}else{if(T=w(),gn===null)throw Error(a(349));Im&30||QF(L,w,T)}B.memoizedState=T;var H={value:T,getSnapshot:w};return B.queue=H,F2(JF.bind(null,L,H,b),[b]),L.flags|=2048,sy(9,KF.bind(null,L,H,T,w),void 0,null),T},useId:function(){var b=iu(),w=gn.identifierPrefix;if(Dr){var T=tu,L=eu;T=(L&~(1<<32-Za(L)-1)).toString(32)+T,w=":"+w+"R"+T,T=ny++,0<T&&(w+="H"+T.toString(32)),w+=":"}else T=Fae++,w=":"+w+"r"+T.toString(32)+":";return b.memoizedState=w},unstable_isNewReconciler:!1},Wae={readContext:wo,useCallback:s4,useContext:wo,useEffect:ay,useImperativeHandle:n4,useInsertionEffect:t4,useLayoutEffect:i4,useMemo:a4,useReducer:zw,useRef:e4,useState:function(){return zw(gp)},useDebugValue:V2,useDeferredValue:function(b){var w=zw(gp),T=w[0],L=w[1];return ay(function(){var B=Eo.transition;Eo.transition={};try{L(b)}finally{Eo.transition=B}},[b]),T},useTransition:function(){var b=zw(gp)[0],w=tc().memoizedState;return[b,w]},useMutableSource:YF,useSyncExternalStore:ZF,useId:o4,unstable_isNewReconciler:!1},Xae={readContext:wo,useCallback:s4,useContext:wo,useEffect:ay,useImperativeHandle:n4,useInsertionEffect:t4,useLayoutEffect:i4,useMemo:a4,useReducer:Bw,useRef:e4,useState:function(){return Bw(gp)},useDebugValue:V2,useDeferredValue:function(b){var w=Bw(gp),T=w[0],L=w[1];return ay(function(){var B=Eo.transition;Eo.transition={};try{L(b)}finally{Eo.transition=B}},[b]),T},useTransition:function(){var b=Bw(gp)[0],w=tc().memoizedState;return[b,w]},useMutableSource:YF,useSyncExternalStore:ZF,useId:o4,unstable_isNewReconciler:!1};function j2(b,w){try{var T="",L=w;do T+=Uae(L),L=L.return;while(L);var B=T}catch(H){B=`
Error generating stack: `+H.message+`
`+H.stack}return{value:b,source:w,stack:B}}function H2(b,w){try{console.error(w.value)}catch(T){setTimeout(function(){throw T})}}var qae=typeof WeakMap=="function"?WeakMap:Map;function d4(b,w,T){T=$c(-1,T),T.tag=3,T.payload={element:null};var L=w.value;return T.callback=function(){i_||(i_=!0,oP=L),H2(b,w)},T}function p4(b,w,T){T=$c(-1,T),T.tag=3;var L=b.type.getDerivedStateFromError;if(typeof L=="function"){var B=w.value;T.payload=function(){return L(B)},T.callback=function(){H2(b,w)}}var H=b.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(T.callback=function(){H2(b,w),typeof L!="function"&&(wh===null?wh=new Set([this]):wh.add(this));var fe=w.stack;this.componentDidCatch(w.value,{componentStack:fe!==null?fe:""})}),T}function f4(b,w,T){var L=b.pingCache;if(L===null){L=b.pingCache=new qae;var B=new Set;L.set(w,B)}else B=L.get(w),B===void 0&&(B=new Set,L.set(w,B));B.has(T)||(B.add(T),b=ooe.bind(null,b,w,T),w.then(b,b))}function m4(b){do{var w;if((w=b.tag===13)&&(w=b.memoizedState,w=w!==null?w.dehydrated!==null:!0),w)return b;b=b.return}while(b!==null);return null}function g4(b,w,T,L,B){return b.mode&1?(b.flags|=65536,b.lanes=B,b):(b===w?b.flags|=65536:(b.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(w=$c(-1,1),w.tag=2,bh(T,w))),T.lanes|=1),b)}function ic(b){b.flags|=4}function v4(b,w){if(b!==null&&b.child===w.child)return!0;if(w.flags&16)return!1;for(b=w.child;b!==null;){if(b.flags&12854||b.subtreeFlags&12854)return!1;b=b.sibling}return!0}var oy,ly,Vw,jw;if(xe)oy=function(b,w){for(var T=w.child;T!==null;){if(T.tag===5||T.tag===6)ee(b,T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===w)break;for(;T.sibling===null;){if(T.return===null||T.return===w)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},ly=function(){},Vw=function(b,w,T,L,B){if(b=b.memoizedProps,b!==L){var H=w.stateNode,fe=ec(Mo.current);T=K(H,T,b,L,B,fe),(w.updateQueue=T)&&ic(w)}},jw=function(b,w,T,L){T!==L&&ic(w)};else if(te){oy=function(b,w,T,L){for(var B=w.child;B!==null;){if(B.tag===5){var H=B.stateNode;T&&L&&(H=Wt(H,B.type,B.memoizedProps,B)),ee(b,H)}else if(B.tag===6)H=B.stateNode,T&&L&&(H=Ni(H,B.memoizedProps,B)),ee(b,H);else if(B.tag!==4){if(B.tag===22&&B.memoizedState!==null)H=B.child,H!==null&&(H.return=B),oy(b,B,!0,!0);else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===w)break;for(;B.sibling===null;){if(B.return===null||B.return===w)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};var y4=function(b,w,T,L){for(var B=w.child;B!==null;){if(B.tag===5){var H=B.stateNode;T&&L&&(H=Wt(H,B.type,B.memoizedProps,B)),ct(b,H)}else if(B.tag===6)H=B.stateNode,T&&L&&(H=Ni(H,B.memoizedProps,B)),ct(b,H);else if(B.tag!==4){if(B.tag===22&&B.memoizedState!==null)H=B.child,H!==null&&(H.return=B),y4(b,B,!0,!0);else if(B.child!==null){B.child.return=B,B=B.child;continue}}if(B===w)break;for(;B.sibling===null;){if(B.return===null||B.return===w)return;B=B.return}B.sibling.return=B.return,B=B.sibling}};ly=function(b,w){var T=w.stateNode;if(!v4(b,w)){b=T.containerInfo;var L=tt(b);y4(L,w,!1,!1),T.pendingChildren=L,ic(w),Dt(b,L)}},Vw=function(b,w,T,L,B){var H=b.stateNode,fe=b.memoizedProps;if((b=v4(b,w))&&fe===L)w.stateNode=H;else{var De=w.stateNode,$e=ec(Mo.current),vt=null;fe!==L&&(vt=K(De,T,fe,L,B,$e)),b&&vt===null?w.stateNode=H:(H=Ae(H,vt,T,fe,L,w,b,De),ae(H,T,L,B,$e)&&ic(w),w.stateNode=H,b?ic(w):oy(H,w,!1,!1))}},jw=function(b,w,T,L){T!==L?(b=ec(Lm.current),T=ec(Mo.current),w.stateNode=ie(L,b,T,w),ic(w)):w.stateNode=b.stateNode}}else ly=function(){},Vw=function(){},jw=function(){};function cy(b,w){if(!Dr)switch(b.tailMode){case"hidden":w=b.tail;for(var T=null;w!==null;)w.alternate!==null&&(T=w),w=w.sibling;T===null?b.tail=null:T.sibling=null;break;case"collapsed":T=b.tail;for(var L=null;T!==null;)T.alternate!==null&&(L=T),T=T.sibling;L===null?w||b.tail===null?b.tail=null:b.tail.sibling=null:L.sibling=null}}function Rs(b){var w=b.alternate!==null&&b.alternate.child===b.child,T=0,L=0;if(w)for(var B=b.child;B!==null;)T|=B.lanes|B.childLanes,L|=B.subtreeFlags&14680064,L|=B.flags&14680064,B.return=b,B=B.sibling;else for(B=b.child;B!==null;)T|=B.lanes|B.childLanes,L|=B.subtreeFlags,L|=B.flags,B.return=b,B=B.sibling;return b.subtreeFlags|=L,b.childLanes=T,w}function Yae(b,w,T){var L=w.pendingProps;switch(T2(w),w.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rs(w),null;case 1:return Hr(w.type)&&vr(),Rs(w),null;case 3:return L=w.stateNode,Rm(),Z(Me),Z(ne),N2(),L.pendingContext&&(L.context=L.pendingContext,L.pendingContext=null),(b===null||b.child===null)&&($0(w)?ic(w):b===null||b.memoizedState.isDehydrated&&!(w.flags&256)||(w.flags|=1024,cl!==null&&(uP(cl),cl=null))),ly(b,w),Rs(w),null;case 5:I2(w),T=ec(Lm.current);var B=w.type;if(b!==null&&w.stateNode!=null)Vw(b,w,B,L,T),b.ref!==w.ref&&(w.flags|=512,w.flags|=2097152);else{if(!L){if(w.stateNode===null)throw Error(a(166));return Rs(w),null}if(b=ec(Mo.current),$0(w)){if(!we)throw Error(a(175));b=It(w.stateNode,w.type,w.memoizedProps,T,b,w,!J0),w.updateQueue=b,b!==null&&ic(w)}else{var H=W(B,L,T,b,w);oy(H,w,!1,!1),w.stateNode=H,ae(H,B,L,T,b)&&ic(w)}w.ref!==null&&(w.flags|=512,w.flags|=2097152)}return Rs(w),null;case 6:if(b&&w.stateNode!=null)jw(b,w,b.memoizedProps,L);else{if(typeof L!="string"&&w.stateNode===null)throw Error(a(166));if(b=ec(Lm.current),T=ec(Mo.current),$0(w)){if(!we)throw Error(a(176));if(b=w.stateNode,L=w.memoizedProps,(T=ei(b,L,w,!J0))&&(B=Qa,B!==null))switch(H=(B.mode&1)!==0,B.tag){case 3:Lt(B.stateNode.containerInfo,b,L,H);break;case 5:Ft(B.type,B.memoizedProps,B.stateNode,b,L,H)}T&&ic(w)}else w.stateNode=ie(L,b,T,w)}return Rs(w),null;case 13:if(Z(Ir),L=w.memoizedState,Dr&&Ka!==null&&w.mode&1&&!(w.flags&128)){for(b=Ka;b;)b=Ge(b);return Pm(),w.flags|=98560,w}if(L!==null&&L.dehydrated!==null){if(L=$0(w),b===null){if(!L)throw Error(a(318));if(!we)throw Error(a(344));if(b=w.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(a(317));oi(b,w)}else Pm(),!(w.flags&128)&&(w.memoizedState=null),w.flags|=4;return Rs(w),null}return cl!==null&&(uP(cl),cl=null),w.flags&128?(w.lanes=T,w):(L=L!==null,T=!1,b===null?$0(w):T=b.memoizedState!==null,L&&!T&&(w.child.flags|=8192,w.mode&1&&(b===null||Ir.current&1?Ln===0&&(Ln=3):dP())),w.updateQueue!==null&&(w.flags|=4),Rs(w),null);case 4:return Rm(),ly(b,w),b===null&&Se(w.stateNode.containerInfo),Rs(w),null;case 10:return _2(w.type._context),Rs(w),null;case 17:return Hr(w.type)&&vr(),Rs(w),null;case 19:if(Z(Ir),B=w.memoizedState,B===null)return Rs(w),null;if(L=(w.flags&128)!==0,H=B.rendering,H===null)if(L)cy(B,!1);else{if(Ln!==0||b!==null&&b.flags&128)for(b=w.child;b!==null;){if(H=Iw(b),H!==null){for(w.flags|=128,cy(B,!1),b=H.updateQueue,b!==null&&(w.updateQueue=b,w.flags|=4),w.subtreeFlags=0,b=T,L=w.child;L!==null;)T=L,B=b,T.flags&=14680066,H=T.alternate,H===null?(T.childLanes=0,T.lanes=B,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=H.childLanes,T.lanes=H.lanes,T.child=H.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=H.memoizedProps,T.memoizedState=H.memoizedState,T.updateQueue=H.updateQueue,T.type=H.type,B=H.dependencies,T.dependencies=B===null?null:{lanes:B.lanes,firstContext:B.firstContext}),L=L.sibling;return J(Ir,Ir.current&1|2),w.child}b=b.sibling}B.tail!==null&&Yn()>aP&&(w.flags|=128,L=!0,cy(B,!1),w.lanes=4194304)}else{if(!L)if(b=Iw(H),b!==null){if(w.flags|=128,L=!0,b=b.updateQueue,b!==null&&(w.updateQueue=b,w.flags|=4),cy(B,!0),B.tail===null&&B.tailMode==="hidden"&&!H.alternate&&!Dr)return Rs(w),null}else 2*Yn()-B.renderingStartTime>aP&&T!==1073741824&&(w.flags|=128,L=!0,cy(B,!1),w.lanes=4194304);B.isBackwards?(H.sibling=w.child,w.child=H):(b=B.last,b!==null?b.sibling=H:w.child=H,B.last=H)}return B.tail!==null?(w=B.tail,B.rendering=w,B.tail=w.sibling,B.renderingStartTime=Yn(),w.sibling=null,b=Ir.current,J(Ir,L?b&1|2:b&1),w):(Rs(w),null);case 22:case 23:return hP(),L=w.memoizedState!==null,b!==null&&b.memoizedState!==null!==L&&(w.flags|=8192),L&&w.mode&1?$a&1073741824&&(Rs(w),xe&&w.subtreeFlags&6&&(w.flags|=8192)):Rs(w),null;case 24:return null;case 25:return null}throw Error(a(156,w.tag))}var Zae=o.ReactCurrentOwner,Ja=!1;function ta(b,w,T,L){w.child=b===null?XF(w,null,T,L):Dm(w,b.child,T,L)}function x4(b,w,T,L,B){T=T.render;var H=w.ref;return Am(w,B),L=B2(b,w,T,L,H,B),T=k2(),b!==null&&!Ja?(w.updateQueue=b.updateQueue,w.flags&=-2053,b.lanes&=~B,ru(b,w,B)):(Dr&&T&&C2(w),w.flags|=1,ta(b,w,L,B),w.child)}function b4(b,w,T,L,B){if(b===null){var H=T.type;return typeof H=="function"&&!pP(H)&&H.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(w.tag=15,w.type=H,w4(b,w,H,L,B)):(b=c_(T.type,null,L,w,w.mode,B),b.ref=w.ref,b.return=w,w.child=b)}if(H=b.child,!(b.lanes&B)){var fe=H.memoizedProps;if(T=T.compare,T=T!==null?T:Mw,T(fe,L)&&b.ref===w.ref)return ru(b,w,B)}return w.flags|=1,b=Eh(H,L),b.ref=w.ref,b.return=w,w.child=b}function w4(b,w,T,L,B){if(b!==null&&Mw(b.memoizedProps,L)&&b.ref===w.ref)if(Ja=!1,(b.lanes&B)!==0)b.flags&131072&&(Ja=!0);else return w.lanes=b.lanes,ru(b,w,B);return G2(b,w,T,L,B)}function _4(b,w,T){var L=w.pendingProps,B=L.children,H=b!==null?b.memoizedState:null;if(L.mode==="hidden")if(!(w.mode&1))w.memoizedState={baseLanes:0,cachePool:null},J(Om,$a),$a|=T;else if(T&1073741824)w.memoizedState={baseLanes:0,cachePool:null},L=H!==null?H.baseLanes:T,J(Om,$a),$a|=L;else return b=H!==null?H.baseLanes|T:T,w.lanes=w.childLanes=1073741824,w.memoizedState={baseLanes:b,cachePool:null},w.updateQueue=null,J(Om,$a),$a|=b,null;else H!==null?(L=H.baseLanes|T,w.memoizedState=null):L=T,J(Om,$a),$a|=L;return ta(b,w,B,T),w.child}function S4(b,w){var T=w.ref;(b===null&&T!==null||b!==null&&b.ref!==T)&&(w.flags|=512,w.flags|=2097152)}function G2(b,w,T,L,B){var H=Hr(T)?ht:ne.current;return H=jr(w,H),Am(w,B),T=B2(b,w,T,L,H,B),L=k2(),b!==null&&!Ja?(w.updateQueue=b.updateQueue,w.flags&=-2053,b.lanes&=~B,ru(b,w,B)):(Dr&&L&&C2(w),w.flags|=1,ta(b,w,T,B),w.child)}function M4(b,w,T,L,B){if(Hr(T)){var H=!0;tn(w)}else H=!1;if(Am(w,B),w.stateNode===null)b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),kF(w,T,L),A2(w,T,L,B),L=!0;else if(b===null){var fe=w.stateNode,De=w.memoizedProps;fe.props=De;var $e=fe.context,vt=T.contextType;typeof vt=="object"&&vt!==null?vt=wo(vt):(vt=Hr(T)?ht:ne.current,vt=jr(w,vt));var zt=T.getDerivedStateFromProps,vi=typeof zt=="function"||typeof fe.getSnapshotBeforeUpdate=="function";vi||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(De!==L||$e!==vt)&&UF(w,fe,L,vt),xh=!1;var ti=w.memoizedState;fe.state=ti,Tw(w,L,fe,B),$e=w.memoizedState,De!==L||ti!==$e||Me.current||xh?(typeof zt=="function"&&(E2(w,T,zt,L),$e=w.memoizedState),(De=xh||BF(w,T,De,L,ti,$e,vt))?(vi||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(w.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(w.flags|=4194308),w.memoizedProps=L,w.memoizedState=$e),fe.props=L,fe.state=$e,fe.context=vt,L=De):(typeof fe.componentDidMount=="function"&&(w.flags|=4194308),L=!1)}else{fe=w.stateNode,IF(b,w),De=w.memoizedProps,vt=w.type===w.elementType?De:ll(w.type,De),fe.props=vt,vi=w.pendingProps,ti=fe.context,$e=T.contextType,typeof $e=="object"&&$e!==null?$e=wo($e):($e=Hr(T)?ht:ne.current,$e=jr(w,$e));var fr=T.getDerivedStateFromProps;(zt=typeof fr=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(De!==vi||ti!==$e)&&UF(w,fe,L,$e),xh=!1,ti=w.memoizedState,fe.state=ti,Tw(w,L,fe,B);var Ht=w.memoizedState;De!==vi||ti!==Ht||Me.current||xh?(typeof fr=="function"&&(E2(w,T,fr,L),Ht=w.memoizedState),(vt=xh||BF(w,T,vt,L,ti,Ht,$e)||!1)?(zt||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(L,Ht,$e),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(L,Ht,$e)),typeof fe.componentDidUpdate=="function"&&(w.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(w.flags|=1024)):(typeof fe.componentDidUpdate!="function"||De===b.memoizedProps&&ti===b.memoizedState||(w.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||De===b.memoizedProps&&ti===b.memoizedState||(w.flags|=1024),w.memoizedProps=L,w.memoizedState=Ht),fe.props=L,fe.state=Ht,fe.context=$e,L=vt):(typeof fe.componentDidUpdate!="function"||De===b.memoizedProps&&ti===b.memoizedState||(w.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||De===b.memoizedProps&&ti===b.memoizedState||(w.flags|=1024),L=!1)}return W2(b,w,T,L,H,B)}function W2(b,w,T,L,B,H){S4(b,w);var fe=(w.flags&128)!==0;if(!L&&!fe)return B&&Mm(w,T,!1),ru(b,w,H);L=w.stateNode,Zae.current=w;var De=fe&&typeof T.getDerivedStateFromError!="function"?null:L.render();return w.flags|=1,b!==null&&fe?(w.child=Dm(w,b.child,null,H),w.child=Dm(w,null,De,H)):ta(b,w,De,H),w.memoizedState=L.state,B&&Mm(w,T,!0),w.child}function E4(b){var w=b.stateNode;w.pendingContext?Ca(b,w.pendingContext,w.pendingContext!==w.context):w.context&&Ca(b,w.context,!1),R2(b,w.containerInfo)}function A4(b,w,T,L,B){return Pm(),L2(B),w.flags|=256,ta(b,w,T,L),w.child}var Hw={dehydrated:null,treeContext:null,retryLane:0};function Gw(b){return{baseLanes:b,cachePool:null}}function C4(b,w,T){var L=w.pendingProps,B=Ir.current,H=!1,fe=(w.flags&128)!==0,De;if((De=fe)||(De=b!==null&&b.memoizedState===null?!1:(B&2)!==0),De?(H=!0,w.flags&=-129):(b===null||b.memoizedState!==null)&&(B|=1),J(Ir,B&1),b===null)return D2(w),b=w.memoizedState,b!==null&&(b=b.dehydrated,b!==null)?(w.mode&1?al(b)?w.lanes=8:w.lanes=1073741824:w.lanes=1,null):(B=L.children,b=L.fallback,H?(L=w.mode,H=w.child,B={mode:"hidden",children:B},!(L&1)&&H!==null?(H.childLanes=0,H.pendingProps=B):H=u_(B,L,0,null),b=_p(b,L,T,null),H.return=w,b.return=w,H.sibling=b,w.child=H,w.child.memoizedState=Gw(T),w.memoizedState=Hw,b):X2(w,B));if(B=b.memoizedState,B!==null){if(De=B.dehydrated,De!==null){if(fe)return w.flags&256?(w.flags&=-257,Ww(b,w,T,Error(a(422)))):w.memoizedState!==null?(w.child=b.child,w.flags|=128,null):(H=L.fallback,B=w.mode,L=u_({mode:"visible",children:L.children},B,0,null),H=_p(H,B,T,null),H.flags|=2,L.return=w,H.return=w,L.sibling=H,w.child=L,w.mode&1&&Dm(w,b.child,null,T),w.child.memoizedState=Gw(T),w.memoizedState=Hw,H);if(!(w.mode&1))w=Ww(b,w,T,null);else if(al(De))w=Ww(b,w,T,Error(a(419)));else if(L=(T&b.childLanes)!==0,Ja||L){if(L=gn,L!==null){switch(T&-T){case 4:H=2;break;case 16:H=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:H=32;break;case 536870912:H=268435456;break;default:H=0}L=H&(L.suspendedLanes|T)?0:H,L!==0&&L!==B.retryLane&&(B.retryLane=L,Ao(b,L,-1))}dP(),w=Ww(b,w,T,Error(a(421)))}else Kc(De)?(w.flags|=128,w.child=b.child,w=loe.bind(null,b),le(De,w),w=null):(T=B.treeContext,we&&(Ka=Je(De),Qa=w,Dr=!0,cl=null,J0=!1,T!==null&&(_o[So++]=eu,_o[So++]=tu,_o[So++]=fp,eu=T.id,tu=T.overflow,fp=w)),w=X2(w,w.pendingProps.children),w.flags|=4096);return w}return H?(L=P4(b,w,L.children,L.fallback,T),H=w.child,B=b.child.memoizedState,H.memoizedState=B===null?Gw(T):{baseLanes:B.baseLanes|T,cachePool:null},H.childLanes=b.childLanes&~T,w.memoizedState=Hw,L):(T=T4(b,w,L.children,T),w.memoizedState=null,T)}return H?(L=P4(b,w,L.children,L.fallback,T),H=w.child,B=b.child.memoizedState,H.memoizedState=B===null?Gw(T):{baseLanes:B.baseLanes|T,cachePool:null},H.childLanes=b.childLanes&~T,w.memoizedState=Hw,L):(T=T4(b,w,L.children,T),w.memoizedState=null,T)}function X2(b,w){return w=u_({mode:"visible",children:w},b.mode,0,null),w.return=b,b.child=w}function T4(b,w,T,L){var B=b.child;return b=B.sibling,T=Eh(B,{mode:"visible",children:T}),!(w.mode&1)&&(T.lanes=L),T.return=w,T.sibling=null,b!==null&&(L=w.deletions,L===null?(w.deletions=[b],w.flags|=16):L.push(b)),w.child=T}function P4(b,w,T,L,B){var H=w.mode;b=b.child;var fe=b.sibling,De={mode:"hidden",children:T};return!(H&1)&&w.child!==b?(T=w.child,T.childLanes=0,T.pendingProps=De,w.deletions=null):(T=Eh(b,De),T.subtreeFlags=b.subtreeFlags&14680064),fe!==null?L=Eh(fe,L):(L=_p(L,H,B,null),L.flags|=2),L.return=w,T.return=w,T.sibling=L,w.child=T,L}function Ww(b,w,T,L){return L!==null&&L2(L),Dm(w,b.child,null,T),b=X2(w,w.pendingProps.children),b.flags|=2,w.memoizedState=null,b}function D4(b,w,T){b.lanes|=w;var L=b.alternate;L!==null&&(L.lanes|=w),S2(b.return,w,T)}function q2(b,w,T,L,B){var H=b.memoizedState;H===null?b.memoizedState={isBackwards:w,rendering:null,renderingStartTime:0,last:L,tail:T,tailMode:B}:(H.isBackwards=w,H.rendering=null,H.renderingStartTime=0,H.last=L,H.tail=T,H.tailMode=B)}function L4(b,w,T){var L=w.pendingProps,B=L.revealOrder,H=L.tail;if(ta(b,w,L.children,T),L=Ir.current,L&2)L=L&1|2,w.flags|=128;else{if(b!==null&&b.flags&128)e:for(b=w.child;b!==null;){if(b.tag===13)b.memoizedState!==null&&D4(b,T,w);else if(b.tag===19)D4(b,T,w);else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===w)break e;for(;b.sibling===null;){if(b.return===null||b.return===w)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}L&=1}if(J(Ir,L),!(w.mode&1))w.memoizedState=null;else switch(B){case"forwards":for(T=w.child,B=null;T!==null;)b=T.alternate,b!==null&&Iw(b)===null&&(B=T),T=T.sibling;T=B,T===null?(B=w.child,w.child=null):(B=T.sibling,T.sibling=null),q2(w,!1,B,T,H);break;case"backwards":for(T=null,B=w.child,w.child=null;B!==null;){if(b=B.alternate,b!==null&&Iw(b)===null){w.child=B;break}b=B.sibling,B.sibling=T,T=B,B=b}q2(w,!0,T,null,H);break;case"together":q2(w,!1,null,null,void 0);break;default:w.memoizedState=null}return w.child}function ru(b,w,T){if(b!==null&&(w.dependencies=b.dependencies),Nm|=w.lanes,!(T&w.childLanes))return null;if(b!==null&&w.child!==b.child)throw Error(a(153));if(w.child!==null){for(b=w.child,T=Eh(b,b.pendingProps),w.child=T,T.return=w;b.sibling!==null;)b=b.sibling,T=T.sibling=Eh(b,b.pendingProps),T.return=w;T.sibling=null}return w.child}function Qae(b,w,T){switch(w.tag){case 3:E4(w),Pm();break;case 5:qF(w);break;case 1:Hr(w.type)&&tn(w);break;case 4:R2(w,w.stateNode.containerInfo);break;case 10:RF(w,w.type._context,w.memoizedProps.value);break;case 13:var L=w.memoizedState;if(L!==null)return L.dehydrated!==null?(J(Ir,Ir.current&1),w.flags|=128,null):T&w.child.childLanes?C4(b,w,T):(J(Ir,Ir.current&1),b=ru(b,w,T),b!==null?b.sibling:null);J(Ir,Ir.current&1);break;case 19:if(L=(T&w.childLanes)!==0,b.flags&128){if(L)return L4(b,w,T);w.flags|=128}var B=w.memoizedState;if(B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),J(Ir,Ir.current),L)break;return null;case 22:case 23:return w.lanes=0,_4(b,w,T)}return ru(b,w,T)}function Kae(b,w){switch(T2(w),w.tag){case 1:return Hr(w.type)&&vr(),b=w.flags,b&65536?(w.flags=b&-65537|128,w):null;case 3:return Rm(),Z(Me),Z(ne),N2(),b=w.flags,b&65536&&!(b&128)?(w.flags=b&-65537|128,w):null;case 5:return I2(w),null;case 13:if(Z(Ir),b=w.memoizedState,b!==null&&b.dehydrated!==null){if(w.alternate===null)throw Error(a(340));Pm()}return b=w.flags,b&65536?(w.flags=b&-65537|128,w):null;case 19:return Z(Ir),null;case 4:return Rm(),null;case 10:return _2(w.type._context),null;case 22:case 23:return hP(),null;case 24:return null;default:return null}}var Xw=!1,vp=!1,Jae=typeof WeakSet=="function"?WeakSet:Set,Et=null;function qw(b,w){var T=b.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(L){Da(b,w,L)}else T.current=null}function Y2(b,w,T){try{T()}catch(L){Da(b,w,L)}}var R4=!1;function $ae(b,w){for(V(b.containerInfo),Et=w;Et!==null;)if(b=Et,w=b.child,(b.subtreeFlags&1028)!==0&&w!==null)w.return=b,Et=w;else for(;Et!==null;){b=Et;try{var T=b.alternate;if(b.flags&1024)switch(b.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var L=T.memoizedProps,B=T.memoizedState,H=b.stateNode,fe=H.getSnapshotBeforeUpdate(b.elementType===b.type?L:ll(b.type,L),B);H.__reactInternalSnapshotBeforeUpdate=fe}break;case 3:xe&&He(b.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(De){Da(b,b.return,De)}if(w=b.sibling,w!==null){w.return=b.return,Et=w;break}Et=b.return}return T=R4,R4=!1,T}function yp(b,w,T){var L=w.updateQueue;if(L=L!==null?L.lastEffect:null,L!==null){var B=L=L.next;do{if((B.tag&b)===b){var H=B.destroy;B.destroy=void 0,H!==void 0&&Y2(w,T,H)}B=B.next}while(B!==L)}}function uy(b,w){if(w=w.updateQueue,w=w!==null?w.lastEffect:null,w!==null){var T=w=w.next;do{if((T.tag&b)===b){var L=T.create;T.destroy=L()}T=T.next}while(T!==w)}}function Z2(b){var w=b.ref;if(w!==null){var T=b.stateNode;switch(b.tag){case 5:b=Q(T);break;default:b=T}typeof w=="function"?w(b):w.current=b}}function I4(b,w,T){if(Ql&&typeof Ql.onCommitFiberUnmount=="function")try{Ql.onCommitFiberUnmount(_w,w)}catch{}switch(w.tag){case 0:case 11:case 14:case 15:if(b=w.updateQueue,b!==null&&(b=b.lastEffect,b!==null)){var L=b=b.next;do{var B=L,H=B.destroy;B=B.tag,H!==void 0&&(B&2||B&4)&&Y2(w,T,H),L=L.next}while(L!==b)}break;case 1:if(qw(w,T),b=w.stateNode,typeof b.componentWillUnmount=="function")try{b.props=w.memoizedProps,b.state=w.memoizedState,b.componentWillUnmount()}catch(fe){Da(w,T,fe)}break;case 5:qw(w,T);break;case 4:xe?U4(b,w,T):te&&te&&(w=w.stateNode.containerInfo,T=tt(w),ai(w,T))}}function O4(b,w,T){for(var L=w;;)if(I4(b,L,T),L.child===null||xe&&L.tag===4){if(L===w)break;for(;L.sibling===null;){if(L.return===null||L.return===w)return;L=L.return}L.sibling.return=L.return,L=L.sibling}else L.child.return=L,L=L.child}function N4(b){var w=b.alternate;w!==null&&(b.alternate=null,N4(w)),b.child=null,b.deletions=null,b.sibling=null,b.tag===5&&(w=b.stateNode,w!==null&&Xe(w)),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function z4(b){return b.tag===5||b.tag===3||b.tag===4}function B4(b){e:for(;;){for(;b.sibling===null;){if(b.return===null||z4(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;b.tag!==5&&b.tag!==6&&b.tag!==18;){if(b.flags&2||b.child===null||b.tag===4)continue e;b.child.return=b,b=b.child}if(!(b.flags&2))return b.stateNode}}function k4(b){if(xe){e:{for(var w=b.return;w!==null;){if(z4(w))break e;w=w.return}throw Error(a(160))}var T=w;switch(T.tag){case 5:w=T.stateNode,T.flags&32&&(ze(w),T.flags&=-33),T=B4(b),K2(b,T,w);break;case 3:case 4:w=T.stateNode.containerInfo,T=B4(b),Q2(b,T,w);break;default:throw Error(a(161))}}}function Q2(b,w,T){var L=b.tag;if(L===5||L===6)b=b.stateNode,w?pt(T,b,w):ke(T,b);else if(L!==4&&(b=b.child,b!==null))for(Q2(b,w,T),b=b.sibling;b!==null;)Q2(b,w,T),b=b.sibling}function K2(b,w,T){var L=b.tag;if(L===5||L===6)b=b.stateNode,w?mt(T,b,w):et(T,b);else if(L!==4&&(b=b.child,b!==null))for(K2(b,w,T),b=b.sibling;b!==null;)K2(b,w,T),b=b.sibling}function U4(b,w,T){for(var L=w,B=!1,H,fe;;){if(!B){B=L.return;e:for(;;){if(B===null)throw Error(a(160));switch(H=B.stateNode,B.tag){case 5:fe=!1;break e;case 3:H=H.containerInfo,fe=!0;break e;case 4:H=H.containerInfo,fe=!0;break e}B=B.return}B=!0}if(L.tag===5||L.tag===6)O4(b,L,T),fe?ue(H,L.stateNode):st(H,L.stateNode);else if(L.tag===18)fe?Pe(H,L.stateNode):Ie(H,L.stateNode);else if(L.tag===4){if(L.child!==null){H=L.stateNode.containerInfo,fe=!0,L.child.return=L,L=L.child;continue}}else if(I4(b,L,T),L.child!==null){L.child.return=L,L=L.child;continue}if(L===w)break;for(;L.sibling===null;){if(L.return===null||L.return===w)return;L=L.return,L.tag===4&&(B=!1)}L.sibling.return=L.return,L=L.sibling}}function J2(b,w){if(xe){switch(w.tag){case 0:case 11:case 14:case 15:yp(3,w,w.return),uy(3,w),yp(5,w,w.return);return;case 1:return;case 5:var T=w.stateNode;if(T!=null){var L=w.memoizedProps;b=b!==null?b.memoizedProps:L;var B=w.type,H=w.updateQueue;w.updateQueue=null,H!==null&&Ve(T,H,B,b,L,w)}return;case 6:if(w.stateNode===null)throw Error(a(162));T=w.memoizedProps,_e(w.stateNode,b!==null?b.memoizedProps:T,T);return;case 3:we&&b!==null&&b.memoizedState.isDehydrated&&Te(w.stateNode.containerInfo);return;case 12:return;case 13:Yw(w);return;case 19:Yw(w);return;case 17:return}throw Error(a(163))}switch(w.tag){case 0:case 11:case 14:case 15:yp(3,w,w.return),uy(3,w),yp(5,w,w.return);return;case 12:return;case 13:Yw(w);return;case 19:Yw(w);return;case 3:we&&b!==null&&b.memoizedState.isDehydrated&&Te(w.stateNode.containerInfo);break;case 22:case 23:return}e:if(te){switch(w.tag){case 1:case 5:case 6:break e;case 3:case 4:w=w.stateNode,ai(w.containerInfo,w.pendingChildren);break e}throw Error(a(163))}}function Yw(b){var w=b.updateQueue;if(w!==null){b.updateQueue=null;var T=b.stateNode;T===null&&(T=b.stateNode=new Jae),w.forEach(function(L){var B=coe.bind(null,b,L);T.has(L)||(T.add(L),L.then(B,B))})}}function eoe(b,w){for(Et=w;Et!==null;){w=Et;var T=w.deletions;if(T!==null)for(var L=0;L<T.length;L++){var B=T[L];try{var H=b;xe?U4(H,B,w):O4(H,B,w);var fe=B.alternate;fe!==null&&(fe.return=null),B.return=null}catch(jt){Da(B,w,jt)}}if(T=w.child,w.subtreeFlags&12854&&T!==null)T.return=w,Et=T;else for(;Et!==null;){w=Et;try{var De=w.flags;if(De&32&&xe&&ze(w.stateNode),De&512){var $e=w.alternate;if($e!==null){var vt=$e.ref;vt!==null&&(typeof vt=="function"?vt(null):vt.current=null)}}if(De&8192)switch(w.tag){case 13:if(w.memoizedState!==null){var zt=w.alternate;(zt===null||zt.memoizedState===null)&&(sP=Yn())}break;case 22:var vi=w.memoizedState!==null,ti=w.alternate,fr=ti!==null&&ti.memoizedState!==null;if(T=w,xe){e:if(L=T,B=vi,H=null,xe)for(var Ht=L;;){if(Ht.tag===5){if(H===null){H=Ht;var Is=Ht.stateNode;B?ut(Is):Ne(Ht.stateNode,Ht.memoizedProps)}}else if(Ht.tag===6){if(H===null){var To=Ht.stateNode;B?de(To):oe(To,Ht.memoizedProps)}}else if((Ht.tag!==22&&Ht.tag!==23||Ht.memoizedState===null||Ht===L)&&Ht.child!==null){Ht.child.return=Ht,Ht=Ht.child;continue}if(Ht===L)break;for(;Ht.sibling===null;){if(Ht.return===null||Ht.return===L)break e;H===Ht&&(H=null),Ht=Ht.return}H===Ht&&(H=null),Ht.sibling.return=Ht.return,Ht=Ht.sibling}}if(vi&&!fr&&T.mode&1){Et=T;for(var We=T.child;We!==null;){for(T=Et=We;Et!==null;){L=Et;var Oe=L.child;switch(L.tag){case 0:case 11:case 14:case 15:yp(4,L,L.return);break;case 1:qw(L,L.return);var Qe=L.stateNode;if(typeof Qe.componentWillUnmount=="function"){var Tt=L.return;try{Qe.props=L.memoizedProps,Qe.state=L.memoizedState,Qe.componentWillUnmount()}catch(jt){Da(L,Tt,jt)}}break;case 5:qw(L,L.return);break;case 22:if(L.memoizedState!==null){j4(T);continue}}Oe!==null?(Oe.return=L,Et=Oe):j4(T)}We=We.sibling}}}switch(De&4102){case 2:k4(w),w.flags&=-3;break;case 6:k4(w),w.flags&=-3,J2(w.alternate,w);break;case 4096:w.flags&=-4097;break;case 4100:w.flags&=-4097,J2(w.alternate,w);break;case 4:J2(w.alternate,w)}}catch(jt){Da(w,w.return,jt)}if(T=w.sibling,T!==null){T.return=w.return,Et=T;break}Et=w.return}}}function toe(b,w,T){Et=b,F4(b)}function F4(b,w,T){for(var L=(b.mode&1)!==0;Et!==null;){var B=Et,H=B.child;if(B.tag===22&&L){var fe=B.memoizedState!==null||Xw;if(!fe){var De=B.alternate,$e=De!==null&&De.memoizedState!==null||vp;De=Xw;var vt=vp;if(Xw=fe,(vp=$e)&&!vt)for(Et=B;Et!==null;)fe=Et,$e=fe.child,fe.tag===22&&fe.memoizedState!==null?H4(B):$e!==null?($e.return=fe,Et=$e):H4(B);for(;H!==null;)Et=H,F4(H),H=H.sibling;Et=B,Xw=De,vp=vt}V4(b)}else B.subtreeFlags&8772&&H!==null?(H.return=B,Et=H):V4(b)}}function V4(b){for(;Et!==null;){var w=Et;if(w.flags&8772){var T=w.alternate;try{if(w.flags&8772)switch(w.tag){case 0:case 11:case 15:vp||uy(5,w);break;case 1:var L=w.stateNode;if(w.flags&4&&!vp)if(T===null)L.componentDidMount();else{var B=w.elementType===w.type?T.memoizedProps:ll(w.type,T.memoizedProps);L.componentDidUpdate(B,T.memoizedState,L.__reactInternalSnapshotBeforeUpdate)}var H=w.updateQueue;H!==null&&NF(w,H,L);break;case 3:var fe=w.updateQueue;if(fe!==null){if(T=null,w.child!==null)switch(w.child.tag){case 5:T=Q(w.child.stateNode);break;case 1:T=w.child.stateNode}NF(w,fe,T)}break;case 5:var De=w.stateNode;T===null&&w.flags&4&&at(De,w.type,w.memoizedProps,w);break;case 6:break;case 4:break;case 12:break;case 13:if(we&&w.memoizedState===null){var $e=w.alternate;if($e!==null){var vt=$e.memoizedState;if(vt!==null){var zt=vt.dehydrated;zt!==null&&Le(zt)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}vp||w.flags&512&&Z2(w)}catch(vi){Da(w,w.return,vi)}}if(w===b){Et=null;break}if(T=w.sibling,T!==null){T.return=w.return,Et=T;break}Et=w.return}}function j4(b){for(;Et!==null;){var w=Et;if(w===b){Et=null;break}var T=w.sibling;if(T!==null){T.return=w.return,Et=T;break}Et=w.return}}function H4(b){for(;Et!==null;){var w=Et;try{switch(w.tag){case 0:case 11:case 15:var T=w.return;try{uy(4,w)}catch($e){Da(w,T,$e)}break;case 1:var L=w.stateNode;if(typeof L.componentDidMount=="function"){var B=w.return;try{L.componentDidMount()}catch($e){Da(w,B,$e)}}var H=w.return;try{Z2(w)}catch($e){Da(w,H,$e)}break;case 5:var fe=w.return;try{Z2(w)}catch($e){Da(w,fe,$e)}}}catch($e){Da(w,w.return,$e)}if(w===b){Et=null;break}var De=w.sibling;if(De!==null){De.return=w.return,Et=De;break}Et=w.return}}var Zw=0,Qw=1,Kw=2,Jw=3,$w=4;if(typeof Symbol=="function"&&Symbol.for){var hy=Symbol.for;Zw=hy("selector.component"),Qw=hy("selector.has_pseudo_class"),Kw=hy("selector.role"),Jw=hy("selector.test_id"),$w=hy("selector.text")}function $2(b){var w=Ce(b);if(w!=null){if(typeof w.memoizedProps["data-testname"]!="string")throw Error(a(364));return w}if(b=se(b),b===null)throw Error(a(362));return b.stateNode.current}function eP(b,w){switch(w.$$typeof){case Zw:if(b.type===w.value)return!0;break;case Qw:e:{w=w.value,b=[b,0];for(var T=0;T<b.length;){var L=b[T++],B=b[T++],H=w[B];if(L.tag!==5||!ce(L)){for(;H!=null&&eP(L,H);)B++,H=w[B];if(B===w.length){w=!0;break e}else for(L=L.child;L!==null;)b.push(L,B),L=L.sibling}}w=!1}return w;case Kw:if(b.tag===5&&Ee(b.stateNode,w.value))return!0;break;case $w:if((b.tag===5||b.tag===6)&&(b=X(b),b!==null&&0<=b.indexOf(w.value)))return!0;break;case Jw:if(b.tag===5&&(b=b.memoizedProps["data-testname"],typeof b=="string"&&b.toLowerCase()===w.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function tP(b){switch(b.$$typeof){case Zw:return"<"+(E(b.value)||"Unknown")+">";case Qw:return":has("+(tP(b)||"")+")";case Kw:return'[role="'+b.value+'"]';case $w:return'"'+b.value+'"';case Jw:return'[data-testname="'+b.value+'"]';default:throw Error(a(365))}}function G4(b,w){var T=[];b=[b,0];for(var L=0;L<b.length;){var B=b[L++],H=b[L++],fe=w[H];if(B.tag!==5||!ce(B)){for(;fe!=null&&eP(B,fe);)H++,fe=w[H];if(H===w.length)T.push(B);else for(B=B.child;B!==null;)b.push(B,H),B=B.sibling}}return T}function iP(b,w){if(!dt)throw Error(a(363));b=$2(b),b=G4(b,w),w=[],b=Array.from(b);for(var T=0;T<b.length;){var L=b[T++];if(L.tag===5)ce(L)||w.push(L.stateNode);else for(L=L.child;L!==null;)b.push(L),L=L.sibling}return w}var ioe=Math.ceil,e_=o.ReactCurrentDispatcher,rP=o.ReactCurrentOwner,rn=o.ReactCurrentBatchConfig,Ai=0,gn=null,vn=null,ds=0,$a=0,Om=er(0),Ln=0,dy=null,Nm=0,t_=0,nP=0,py=null,Ta=null,sP=0,aP=1/0;function zm(){aP=Yn()+500}var i_=!1,oP=null,wh=null,r_=!1,_h=null,n_=0,fy=0,lP=null,s_=-1,a_=0;function ia(){return Ai&6?Yn():s_!==-1?s_:s_=Yn()}function Sh(b){return b.mode&1?Ai&2&&ds!==0?ds&-ds:kae.transition!==null?(a_===0&&(b=xw,xw<<=1,!(xw&4194240)&&(xw=64),a_=b),a_):(b=Gi,b!==0?b:Re()):1}function Ao(b,w,T){if(50<fy)throw fy=0,lP=null,Error(a(185));var L=o_(b,w);return L===null?null:(K0(L,w,T),(!(Ai&2)||L!==gn)&&(L===gn&&(!(Ai&2)&&(t_|=w),Ln===4&&Mh(L,ds)),Pa(L,T),w===1&&Ai===0&&!(b.mode&1)&&(zm(),Sw&&Jl())),L)}function o_(b,w){b.lanes|=w;var T=b.alternate;for(T!==null&&(T.lanes|=w),T=b,b=b.return;b!==null;)b.childLanes|=w,T=b.alternate,T!==null&&(T.childLanes|=w),T=b,b=b.return;return T.tag===3?T.stateNode:null}function Pa(b,w){var T=b.callbackNode;Pae(b,w);var L=ww(b,b===gn?ds:0);if(L===0)T!==null&&DF(T),b.callbackNode=null,b.callbackPriority=0;else if(w=L&-L,b.callbackPriority!==w){if(T!=null&&DF(T),w===1)b.tag===0?Bae(X4.bind(null,b)):LF(X4.bind(null,b)),Be?Fe(function(){Ai===0&&Jl()}):g2(v2,Jl),T=null;else{switch(PF(L)){case 1:T=v2;break;case 4:T=Iae;break;case 16:T=y2;break;case 536870912:T=Oae;break;default:T=y2}T=t5(T,W4.bind(null,b))}b.callbackPriority=w,b.callbackNode=T}}function W4(b,w){if(s_=-1,a_=0,Ai&6)throw Error(a(327));var T=b.callbackNode;if(wp()&&b.callbackNode!==T)return null;var L=ww(b,b===gn?ds:0);if(L===0)return null;if(L&30||L&b.expiredLanes||w)w=l_(b,L);else{w=L;var B=Ai;Ai|=2;var H=Z4();(gn!==b||ds!==w)&&(zm(),xp(b,w));do try{soe();break}catch(De){Y4(b,De)}while(!0);w2(),e_.current=H,Ai=B,vn!==null?w=0:(gn=null,ds=0,w=Ln)}if(w!==0){if(w===2&&(B=p2(b),B!==0&&(L=B,w=cP(b,B))),w===1)throw T=dy,xp(b,0),Mh(b,L),Pa(b,Yn()),T;if(w===6)Mh(b,L);else{if(B=b.current.alternate,!(L&30)&&!roe(B)&&(w=l_(b,L),w===2&&(H=p2(b),H!==0&&(L=H,w=cP(b,H))),w===1))throw T=dy,xp(b,0),Mh(b,L),Pa(b,Yn()),T;switch(b.finishedWork=B,b.finishedLanes=L,w){case 0:case 1:throw Error(a(345));case 2:bp(b,Ta);break;case 3:if(Mh(b,L),(L&130023424)===L&&(w=sP+500-Yn(),10<w)){if(ww(b,0)!==0)break;if(B=b.suspendedLanes,(B&L)!==L){ia(),b.pingedLanes|=b.suspendedLanes&B;break}b.timeoutHandle=ye(bp.bind(null,b,Ta),w);break}bp(b,Ta);break;case 4:if(Mh(b,L),(L&4194240)===L)break;for(w=b.eventTimes,B=-1;0<L;){var fe=31-Za(L);H=1<<fe,fe=w[fe],fe>B&&(B=fe),L&=~H}if(L=B,L=Yn()-L,L=(120>L?120:480>L?480:1080>L?1080:1920>L?1920:3e3>L?3e3:4320>L?4320:1960*ioe(L/1960))-L,10<L){b.timeoutHandle=ye(bp.bind(null,b,Ta),L);break}bp(b,Ta);break;case 5:bp(b,Ta);break;default:throw Error(a(329))}}}return Pa(b,Yn()),b.callbackNode===T?W4.bind(null,b):null}function cP(b,w){var T=py;return b.current.memoizedState.isDehydrated&&(xp(b,w).flags|=256),b=l_(b,w),b!==2&&(w=Ta,Ta=T,w!==null&&uP(w)),b}function uP(b){Ta===null?Ta=b:Ta.push.apply(Ta,b)}function roe(b){for(var w=b;;){if(w.flags&16384){var T=w.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var L=0;L<T.length;L++){var B=T[L],H=B.getSnapshot;B=B.value;try{if(!Kl(H(),B))return!1}catch{return!1}}}if(T=w.child,w.subtreeFlags&16384&&T!==null)T.return=w,w=T;else{if(w===b)break;for(;w.sibling===null;){if(w.return===null||w.return===b)return!0;w=w.return}w.sibling.return=w.return,w=w.sibling}}return!0}function Mh(b,w){for(w&=~nP,w&=~t_,b.suspendedLanes|=w,b.pingedLanes&=~w,b=b.expirationTimes;0<w;){var T=31-Za(w),L=1<<T;b[T]=-1,w&=~L}}function X4(b){if(Ai&6)throw Error(a(327));wp();var w=ww(b,0);if(!(w&1))return Pa(b,Yn()),null;var T=l_(b,w);if(b.tag!==0&&T===2){var L=p2(b);L!==0&&(w=L,T=cP(b,L))}if(T===1)throw T=dy,xp(b,0),Mh(b,w),Pa(b,Yn()),T;if(T===6)throw Error(a(345));return b.finishedWork=b.current.alternate,b.finishedLanes=w,bp(b,Ta),Pa(b,Yn()),null}function q4(b){_h!==null&&_h.tag===0&&!(Ai&6)&&wp();var w=Ai;Ai|=1;var T=rn.transition,L=Gi;try{if(rn.transition=null,Gi=1,b)return b()}finally{Gi=L,rn.transition=T,Ai=w,!(Ai&6)&&Jl()}}function hP(){$a=Om.current,Z(Om)}function xp(b,w){b.finishedWork=null,b.finishedLanes=0;var T=b.timeoutHandle;if(T!==me&&(b.timeoutHandle=me,pe(T)),vn!==null)for(T=vn.return;T!==null;){var L=T;switch(T2(L),L.tag){case 1:L=L.type.childContextTypes,L!=null&&vr();break;case 3:Rm(),Z(Me),Z(ne),N2();break;case 5:I2(L);break;case 4:Rm();break;case 13:Z(Ir);break;case 19:Z(Ir);break;case 10:_2(L.type._context);break;case 22:case 23:hP()}T=T.return}if(gn=b,vn=b=Eh(b.current,null),ds=$a=w,Ln=0,dy=null,nP=t_=Nm=0,Ta=py=null,$l!==null){for(w=0;w<$l.length;w++)if(T=$l[w],L=T.interleaved,L!==null){T.interleaved=null;var B=L.next,H=T.pending;if(H!==null){var fe=H.next;H.next=B,L.next=fe}T.pending=L}$l=null}return b}function Y4(b,w){do{var T=vn;try{if(w2(),Ow.current=Fw,Nw){for(var L=Gr.memoizedState;L!==null;){var B=L.queue;B!==null&&(B.pending=null),L=L.next}Nw=!1}if(Im=0,Zn=Ds=Gr=null,ry=!1,ny=0,rP.current=null,T===null||T.return===null){Ln=1,dy=w,vn=null;break}e:{var H=b,fe=T.return,De=T,$e=w;if(w=ds,De.flags|=32768,$e!==null&&typeof $e=="object"&&typeof $e.then=="function"){var vt=$e,zt=De,vi=zt.tag;if(!(zt.mode&1)&&(vi===0||vi===11||vi===15)){var ti=zt.alternate;ti?(zt.updateQueue=ti.updateQueue,zt.memoizedState=ti.memoizedState,zt.lanes=ti.lanes):(zt.updateQueue=null,zt.memoizedState=null)}var fr=m4(fe);if(fr!==null){fr.flags&=-257,g4(fr,fe,De,H,w),fr.mode&1&&f4(H,vt,w),w=fr,$e=vt;var Ht=w.updateQueue;if(Ht===null){var Is=new Set;Is.add($e),w.updateQueue=Is}else Ht.add($e);break e}else{if(!(w&1)){f4(H,vt,w),dP();break e}$e=Error(a(426))}}else if(Dr&&De.mode&1){var To=m4(fe);if(To!==null){!(To.flags&65536)&&(To.flags|=256),g4(To,fe,De,H,w),L2($e);break e}}H=$e,Ln!==4&&(Ln=2),py===null?py=[H]:py.push(H),$e=j2($e,De),De=fe;do{switch(De.tag){case 3:De.flags|=65536,w&=-w,De.lanes|=w;var We=d4(De,$e,w);OF(De,We);break e;case 1:H=$e;var Oe=De.type,Qe=De.stateNode;if(!(De.flags&128)&&(typeof Oe.getDerivedStateFromError=="function"||Qe!==null&&typeof Qe.componentDidCatch=="function"&&(wh===null||!wh.has(Qe)))){De.flags|=65536,w&=-w,De.lanes|=w;var Tt=p4(De,H,w);OF(De,Tt);break e}}De=De.return}while(De!==null)}K4(T)}catch(jt){w=jt,vn===T&&T!==null&&(vn=T=T.return);continue}break}while(!0)}function Z4(){var b=e_.current;return e_.current=Fw,b===null?Fw:b}function dP(){(Ln===0||Ln===3||Ln===2)&&(Ln=4),gn===null||!(Nm&268435455)&&!(t_&268435455)||Mh(gn,ds)}function l_(b,w){var T=Ai;Ai|=2;var L=Z4();gn===b&&ds===w||xp(b,w);do try{noe();break}catch(B){Y4(b,B)}while(!0);if(w2(),Ai=T,e_.current=L,vn!==null)throw Error(a(261));return gn=null,ds=0,Ln}function noe(){for(;vn!==null;)Q4(vn)}function soe(){for(;vn!==null&&!Lae();)Q4(vn)}function Q4(b){var w=e5(b.alternate,b,$a);b.memoizedProps=b.pendingProps,w===null?K4(b):vn=w,rP.current=null}function K4(b){var w=b;do{var T=w.alternate;if(b=w.return,w.flags&32768){if(T=Kae(T,w),T!==null){T.flags&=32767,vn=T;return}if(b!==null)b.flags|=32768,b.subtreeFlags=0,b.deletions=null;else{Ln=6,vn=null;return}}else if(T=Yae(T,w,$a),T!==null){vn=T;return}if(w=w.sibling,w!==null){vn=w;return}vn=w=b}while(w!==null);Ln===0&&(Ln=5)}function bp(b,w){var T=Gi,L=rn.transition;try{rn.transition=null,Gi=1,aoe(b,w,T)}finally{rn.transition=L,Gi=T}return null}function aoe(b,w,T){do wp();while(_h!==null);if(Ai&6)throw Error(a(327));var L=b.finishedWork,B=b.finishedLanes;if(L===null)return null;if(b.finishedWork=null,b.finishedLanes=0,L===b.current)throw Error(a(177));b.callbackNode=null,b.callbackPriority=0;var H=L.lanes|L.childLanes;if(Dae(b,H),b===gn&&(vn=gn=null,ds=0),!(L.subtreeFlags&2064)&&!(L.flags&2064)||r_||(r_=!0,t5(y2,function(){return wp(),null})),H=(L.flags&15990)!==0,L.subtreeFlags&15990||H){H=rn.transition,rn.transition=null;var fe=Gi;Gi=1;var De=Ai;Ai|=4,rP.current=null,$ae(b,L),eoe(b,L),F(b.containerInfo),b.current=L,toe(L),Rae(),Ai=De,Gi=fe,rn.transition=H}else b.current=L;if(r_&&(r_=!1,_h=b,n_=B),H=b.pendingLanes,H===0&&(wh=null),Nae(L.stateNode),Pa(b,Yn()),w!==null)for(T=b.onRecoverableError,L=0;L<w.length;L++)T(w[L]);if(i_)throw i_=!1,b=oP,oP=null,b;return n_&1&&b.tag!==0&&wp(),H=b.pendingLanes,H&1?b===lP?fy++:(fy=0,lP=b):fy=0,Jl(),null}function wp(){if(_h!==null){var b=PF(n_),w=rn.transition,T=Gi;try{if(rn.transition=null,Gi=16>b?16:b,_h===null)var L=!1;else{if(b=_h,_h=null,n_=0,Ai&6)throw Error(a(331));var B=Ai;for(Ai|=4,Et=b.current;Et!==null;){var H=Et,fe=H.child;if(Et.flags&16){var De=H.deletions;if(De!==null){for(var $e=0;$e<De.length;$e++){var vt=De[$e];for(Et=vt;Et!==null;){var zt=Et;switch(zt.tag){case 0:case 11:case 15:yp(8,zt,H)}var vi=zt.child;if(vi!==null)vi.return=zt,Et=vi;else for(;Et!==null;){zt=Et;var ti=zt.sibling,fr=zt.return;if(N4(zt),zt===vt){Et=null;break}if(ti!==null){ti.return=fr,Et=ti;break}Et=fr}}}var Ht=H.alternate;if(Ht!==null){var Is=Ht.child;if(Is!==null){Ht.child=null;do{var To=Is.sibling;Is.sibling=null,Is=To}while(Is!==null)}}Et=H}}if(H.subtreeFlags&2064&&fe!==null)fe.return=H,Et=fe;else e:for(;Et!==null;){if(H=Et,H.flags&2048)switch(H.tag){case 0:case 11:case 15:yp(9,H,H.return)}var We=H.sibling;if(We!==null){We.return=H.return,Et=We;break e}Et=H.return}}var Oe=b.current;for(Et=Oe;Et!==null;){fe=Et;var Qe=fe.child;if(fe.subtreeFlags&2064&&Qe!==null)Qe.return=fe,Et=Qe;else e:for(fe=Oe;Et!==null;){if(De=Et,De.flags&2048)try{switch(De.tag){case 0:case 11:case 15:uy(9,De)}}catch(jt){Da(De,De.return,jt)}if(De===fe){Et=null;break e}var Tt=De.sibling;if(Tt!==null){Tt.return=De.return,Et=Tt;break e}Et=De.return}}if(Ai=B,Jl(),Ql&&typeof Ql.onPostCommitFiberRoot=="function")try{Ql.onPostCommitFiberRoot(_w,b)}catch{}L=!0}return L}finally{Gi=T,rn.transition=w}}return!1}function J4(b,w,T){w=j2(T,w),w=d4(b,w,1),bh(b,w),w=ia(),b=o_(b,1),b!==null&&(K0(b,1,w),Pa(b,w))}function Da(b,w,T){if(b.tag===3)J4(b,b,T);else for(;w!==null;){if(w.tag===3){J4(w,b,T);break}else if(w.tag===1){var L=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(wh===null||!wh.has(L))){b=j2(T,b),b=p4(w,b,1),bh(w,b),b=ia(),w=o_(w,1),w!==null&&(K0(w,1,b),Pa(w,b));break}}w=w.return}}function ooe(b,w,T){var L=b.pingCache;L!==null&&L.delete(w),w=ia(),b.pingedLanes|=b.suspendedLanes&T,gn===b&&(ds&T)===T&&(Ln===4||Ln===3&&(ds&130023424)===ds&&500>Yn()-sP?xp(b,0):nP|=T),Pa(b,w)}function $4(b,w){w===0&&(b.mode&1?(w=bw,bw<<=1,!(bw&130023424)&&(bw=4194304)):w=1);var T=ia();b=o_(b,w),b!==null&&(K0(b,w,T),Pa(b,T))}function loe(b){var w=b.memoizedState,T=0;w!==null&&(T=w.retryLane),$4(b,T)}function coe(b,w){var T=0;switch(b.tag){case 13:var L=b.stateNode,B=b.memoizedState;B!==null&&(T=B.retryLane);break;case 19:L=b.stateNode;break;default:throw Error(a(314))}L!==null&&L.delete(w),$4(b,T)}var e5;e5=function(b,w,T){if(b!==null)if(b.memoizedProps!==w.pendingProps||Me.current)Ja=!0;else{if(!(b.lanes&T)&&!(w.flags&128))return Ja=!1,Qae(b,w,T);Ja=!!(b.flags&131072)}else Ja=!1,Dr&&w.flags&1048576&&FF(w,Lw,w.index);switch(w.lanes=0,w.tag){case 2:var L=w.type;b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),b=w.pendingProps;var B=jr(w,ne.current);Am(w,T),B=B2(null,w,L,b,B,T);var H=k2();return w.flags|=1,typeof B=="object"&&B!==null&&typeof B.render=="function"&&B.$$typeof===void 0?(w.tag=1,w.memoizedState=null,w.updateQueue=null,Hr(L)?(H=!0,tn(w)):H=!1,w.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,M2(w),B.updater=Pw,w.stateNode=B,B._reactInternals=w,A2(w,L,b,T),w=W2(null,w,L,!0,H,T)):(w.tag=0,Dr&&H&&C2(w),ta(null,w,B,T),w=w.child),w;case 16:L=w.elementType;e:{switch(b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),b=w.pendingProps,B=L._init,L=B(L._payload),w.type=L,B=w.tag=hoe(L),b=ll(L,b),B){case 0:w=G2(null,w,L,b,T);break e;case 1:w=M4(null,w,L,b,T);break e;case 11:w=x4(null,w,L,b,T);break e;case 14:w=b4(null,w,L,ll(L.type,b),T);break e}throw Error(a(306,L,""))}return w;case 0:return L=w.type,B=w.pendingProps,B=w.elementType===L?B:ll(L,B),G2(b,w,L,B,T);case 1:return L=w.type,B=w.pendingProps,B=w.elementType===L?B:ll(L,B),M4(b,w,L,B,T);case 3:e:{if(E4(w),b===null)throw Error(a(387));L=w.pendingProps,H=w.memoizedState,B=H.element,IF(b,w),Tw(w,L,null,T);var fe=w.memoizedState;if(L=fe.element,we&&H.isDehydrated)if(H={element:L,isDehydrated:!1,cache:fe.cache,transitions:fe.transitions},w.updateQueue.baseState=H,w.memoizedState=H,w.flags&256){B=Error(a(423)),w=A4(b,w,L,T,B);break e}else if(L!==B){B=Error(a(424)),w=A4(b,w,L,T,B);break e}else for(we&&(Ka=Ue(w.stateNode.containerInfo),Qa=w,Dr=!0,cl=null,J0=!1),T=XF(w,null,L,T),w.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Pm(),L===B){w=ru(b,w,T);break e}ta(b,w,L,T)}w=w.child}return w;case 5:return qF(w),b===null&&D2(w),L=w.type,B=w.pendingProps,H=b!==null?b.memoizedProps:null,fe=B.children,$(L,B)?fe=null:H!==null&&$(L,H)&&(w.flags|=32),S4(b,w),ta(b,w,fe,T),w.child;case 6:return b===null&&D2(w),null;case 13:return C4(b,w,T);case 4:return R2(w,w.stateNode.containerInfo),L=w.pendingProps,b===null?w.child=Dm(w,null,L,T):ta(b,w,L,T),w.child;case 11:return L=w.type,B=w.pendingProps,B=w.elementType===L?B:ll(L,B),x4(b,w,L,B,T);case 7:return ta(b,w,w.pendingProps,T),w.child;case 8:return ta(b,w,w.pendingProps.children,T),w.child;case 12:return ta(b,w,w.pendingProps.children,T),w.child;case 10:e:{if(L=w.type._context,B=w.pendingProps,H=w.memoizedProps,fe=B.value,RF(w,L,fe),H!==null)if(Kl(H.value,fe)){if(H.children===B.children&&!Me.current){w=ru(b,w,T);break e}}else for(H=w.child,H!==null&&(H.return=w);H!==null;){var De=H.dependencies;if(De!==null){fe=H.child;for(var $e=De.firstContext;$e!==null;){if($e.context===L){if(H.tag===1){$e=$c(-1,T&-T),$e.tag=2;var vt=H.updateQueue;if(vt!==null){vt=vt.shared;var zt=vt.pending;zt===null?$e.next=$e:($e.next=zt.next,zt.next=$e),vt.pending=$e}}H.lanes|=T,$e=H.alternate,$e!==null&&($e.lanes|=T),S2(H.return,T,w),De.lanes|=T;break}$e=$e.next}}else if(H.tag===10)fe=H.type===w.type?null:H.child;else if(H.tag===18){if(fe=H.return,fe===null)throw Error(a(341));fe.lanes|=T,De=fe.alternate,De!==null&&(De.lanes|=T),S2(fe,T,w),fe=H.sibling}else fe=H.child;if(fe!==null)fe.return=H;else for(fe=H;fe!==null;){if(fe===w){fe=null;break}if(H=fe.sibling,H!==null){H.return=fe.return,fe=H;break}fe=fe.return}H=fe}ta(b,w,B.children,T),w=w.child}return w;case 9:return B=w.type,L=w.pendingProps.children,Am(w,T),B=wo(B),L=L(B),w.flags|=1,ta(b,w,L,T),w.child;case 14:return L=w.type,B=ll(L,w.pendingProps),B=ll(L.type,B),b4(b,w,L,B,T);case 15:return w4(b,w,w.type,w.pendingProps,T);case 17:return L=w.type,B=w.pendingProps,B=w.elementType===L?B:ll(L,B),b!==null&&(b.alternate=null,w.alternate=null,w.flags|=2),w.tag=1,Hr(L)?(b=!0,tn(w)):b=!1,Am(w,T),kF(w,L,B),A2(w,L,B,T),W2(null,w,L,!0,b,T);case 19:return L4(b,w,T);case 22:return _4(b,w,T)}throw Error(a(156,w.tag))};function t5(b,w){return g2(b,w)}function uoe(b,w,T,L){this.tag=b,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=w,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Co(b,w,T,L){return new uoe(b,w,T,L)}function pP(b){return b=b.prototype,!(!b||!b.isReactComponent)}function hoe(b){if(typeof b=="function")return pP(b)?1:0;if(b!=null){if(b=b.$$typeof,b===v)return 11;if(b===y)return 14}return 2}function Eh(b,w){var T=b.alternate;return T===null?(T=Co(b.tag,w,b.key,b.mode),T.elementType=b.elementType,T.type=b.type,T.stateNode=b.stateNode,T.alternate=b,b.alternate=T):(T.pendingProps=w,T.type=b.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=b.flags&14680064,T.childLanes=b.childLanes,T.lanes=b.lanes,T.child=b.child,T.memoizedProps=b.memoizedProps,T.memoizedState=b.memoizedState,T.updateQueue=b.updateQueue,w=b.dependencies,T.dependencies=w===null?null:{lanes:w.lanes,firstContext:w.firstContext},T.sibling=b.sibling,T.index=b.index,T.ref=b.ref,T}function c_(b,w,T,L,B,H){var fe=2;if(L=b,typeof b=="function")pP(b)&&(fe=1);else if(typeof b=="string")fe=5;else e:switch(b){case u:return _p(T.children,B,H,w);case h:fe=8,B|=8;break;case d:return b=Co(12,T,w,B|2),b.elementType=d,b.lanes=H,b;case m:return b=Co(13,T,w,B),b.elementType=m,b.lanes=H,b;case g:return b=Co(19,T,w,B),b.elementType=g,b.lanes=H,b;case _:return u_(T,B,H,w);default:if(typeof b=="object"&&b!==null)switch(b.$$typeof){case p:fe=10;break e;case f:fe=9;break e;case v:fe=11;break e;case y:fe=14;break e;case x:fe=16,L=null;break e}throw Error(a(130,b==null?b:typeof b,""))}return w=Co(fe,T,w,B),w.elementType=b,w.type=L,w.lanes=H,w}function _p(b,w,T,L){return b=Co(7,b,L,w),b.lanes=T,b}function u_(b,w,T,L){return b=Co(22,b,L,w),b.elementType=_,b.lanes=T,b.stateNode={},b}function fP(b,w,T){return b=Co(6,b,null,w),b.lanes=T,b}function mP(b,w,T){return w=Co(4,b.children!==null?b.children:[],b.key,w),w.lanes=T,w.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},w}function doe(b,w,T,L,B){this.tag=w,this.containerInfo=b,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=me,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=f2(0),this.expirationTimes=f2(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=f2(0),this.identifierPrefix=L,this.onRecoverableError=B,we&&(this.mutableSourceEagerHydrationData=null)}function i5(b,w,T,L,B,H,fe,De,$e){return b=new doe(b,w,T,De,$e),w===1?(w=1,H===!0&&(w|=8)):w=0,H=Co(3,null,null,w),b.current=H,H.stateNode=b,H.memoizedState={element:L,isDehydrated:T,cache:null,transitions:null},M2(H),b}function r5(b){if(!b)return be;b=b._reactInternals;e:{if(P(b)!==b||b.tag!==1)throw Error(a(170));var w=b;do{switch(w.tag){case 3:w=w.stateNode.context;break e;case 1:if(Hr(w.type)){w=w.stateNode.__reactInternalMemoizedMergedChildContext;break e}}w=w.return}while(w!==null);throw Error(a(171))}if(b.tag===1){var T=b.type;if(Hr(T))return ol(b,T,w)}return w}function n5(b){var w=b._reactInternals;if(w===void 0)throw typeof b.render=="function"?Error(a(188)):(b=Object.keys(b).join(","),Error(a(268,b)));return b=N(w),b===null?null:b.stateNode}function s5(b,w){if(b=b.memoizedState,b!==null&&b.dehydrated!==null){var T=b.retryLane;b.retryLane=T!==0&&T<w?T:w}}function gP(b,w){s5(b,w),(b=b.alternate)&&s5(b,w)}function poe(b){return b=N(b),b===null?null:b.stateNode}function foe(){return null}return i.attemptContinuousHydration=function(b){if(b.tag===13){var w=ia();Ao(b,134217728,w),gP(b,134217728)}},i.attemptHydrationAtCurrentPriority=function(b){if(b.tag===13){var w=ia(),T=Sh(b);Ao(b,T,w),gP(b,T)}},i.attemptSynchronousHydration=function(b){switch(b.tag){case 3:var w=b.stateNode;if(w.current.memoizedState.isDehydrated){var T=Q0(w.pendingLanes);T!==0&&(m2(w,T|1),Pa(w,Yn()),!(Ai&6)&&(zm(),Jl()))}break;case 13:var L=ia();q4(function(){return Ao(b,1,L)}),gP(b,1)}},i.batchedUpdates=function(b,w){var T=Ai;Ai|=1;try{return b(w)}finally{Ai=T,Ai===0&&(zm(),Sw&&Jl())}},i.createComponentSelector=function(b){return{$$typeof:Zw,value:b}},i.createContainer=function(b,w,T,L,B,H,fe){return i5(b,w,!1,null,T,L,B,H,fe)},i.createHasPseudoClassSelector=function(b){return{$$typeof:Qw,value:b}},i.createHydrationContainer=function(b,w,T,L,B,H,fe,De,$e){return b=i5(T,L,!0,b,B,H,fe,De,$e),b.context=r5(null),T=b.current,L=ia(),B=Sh(T),H=$c(L,B),H.callback=w??null,bh(T,H),b.current.lanes=B,K0(b,B,L),Pa(b,L),b},i.createPortal=function(b,w,T){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:L==null?null:""+L,children:b,containerInfo:w,implementation:T}},i.createRoleSelector=function(b){return{$$typeof:Kw,value:b}},i.createTestNameSelector=function(b){return{$$typeof:Jw,value:b}},i.createTextSelector=function(b){return{$$typeof:$w,value:b}},i.deferredUpdates=function(b){var w=Gi,T=rn.transition;try{return rn.transition=null,Gi=16,b()}finally{Gi=w,rn.transition=T}},i.discreteUpdates=function(b,w,T,L,B){var H=Gi,fe=rn.transition;try{return rn.transition=null,Gi=1,b(w,T,L,B)}finally{Gi=H,rn.transition=fe,Ai===0&&zm()}},i.findAllNodes=iP,i.findBoundingRects=function(b,w){if(!dt)throw Error(a(363));w=iP(b,w),b=[];for(var T=0;T<w.length;T++)b.push(z(w[T]));for(w=b.length-1;0<w;w--){T=b[w];for(var L=T.x,B=L+T.width,H=T.y,fe=H+T.height,De=w-1;0<=De;De--)if(w!==De){var $e=b[De],vt=$e.x,zt=vt+$e.width,vi=$e.y,ti=vi+$e.height;if(L>=vt&&H>=vi&&B<=zt&&fe<=ti){b.splice(w,1);break}else if(L!==vt||T.width!==$e.width||ti<H||vi>fe){if(!(H!==vi||T.height!==$e.height||zt<L||vt>B)){vt>L&&($e.width+=vt-L,$e.x=L),zt<B&&($e.width=B-vt),b.splice(w,1);break}}else{vi>H&&($e.height+=vi-H,$e.y=H),ti<fe&&($e.height=fe-vi),b.splice(w,1);break}}}return b},i.findHostInstance=n5,i.findHostInstanceWithNoPortals=function(b){return b=D(b),b=b!==null?I(b):null,b===null?null:b.stateNode},i.findHostInstanceWithWarning=function(b){return n5(b)},i.flushControlled=function(b){var w=Ai;Ai|=1;var T=rn.transition,L=Gi;try{rn.transition=null,Gi=1,b()}finally{Gi=L,rn.transition=T,Ai=w,Ai===0&&(zm(),Jl())}},i.flushPassiveEffects=wp,i.flushSync=q4,i.focusWithin=function(b,w){if(!dt)throw Error(a(363));for(b=$2(b),w=G4(b,w),w=Array.from(w),b=0;b<w.length;){var T=w[b++];if(!ce(T)){if(T.tag===5&&q(T.stateNode))return!0;for(T=T.child;T!==null;)w.push(T),T=T.sibling}}return!1},i.getCurrentUpdatePriority=function(){return Gi},i.getFindAllNodesFailureDescription=function(b,w){if(!dt)throw Error(a(363));var T=0,L=[];b=[$2(b),0];for(var B=0;B<b.length;){var H=b[B++],fe=b[B++],De=w[fe];if((H.tag!==5||!ce(H))&&(eP(H,De)&&(L.push(tP(De)),fe++,fe>T&&(T=fe)),fe<w.length))for(H=H.child;H!==null;)b.push(H,fe),H=H.sibling}if(T<w.length){for(b=[];T<w.length;T++)b.push(tP(w[T]));return`findAllNodes was able to match part of the selector:
  `+(L.join(" > ")+`

No matching component was found for:
  `)+b.join(" > ")}return null},i.getPublicRootInstance=function(b){if(b=b.current,!b.child)return null;switch(b.child.tag){case 5:return Q(b.child.stateNode);default:return b.child.stateNode}},i.injectIntoDevTools=function(b){if(b={bundleType:b.bundleType,version:b.version,rendererPackageName:b.rendererPackageName,rendererConfig:b.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:poe,findFiberByHostInstance:b.findFiberByHostInstance||foe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")b=!1;else{var w=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(w.isDisabled||!w.supportsFiber)b=!0;else{try{_w=w.inject(b),Ql=w}catch{}b=!!w.checkDCE}}return b},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(b,w,T,L){if(!dt)throw Error(a(363));b=iP(b,w);var B=Ye(b,T,L).disconnect;return{disconnect:function(){B()}}},i.registerMutableSourceForHydration=function(b,w){var T=w._getVersion;T=T(w._source),b.mutableSourceEagerHydrationData==null?b.mutableSourceEagerHydrationData=[w,T]:b.mutableSourceEagerHydrationData.push(w,T)},i.runWithPriority=function(b,w){var T=Gi;try{return Gi=b,w()}finally{Gi=T}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(b,w,T,L){var B=w.current,H=ia(),fe=Sh(B);return T=r5(T),w.context===null?w.context=T:w.pendingContext=T,w=$c(H,fe),w.payload={element:b},L=L===void 0?null:L,L!==null&&(w.callback=L),bh(B,w),b=Ao(B,fe,H),b!==null&&Cw(b,B,fe),fe},i};Gse.exports=Z9e;var Q9e=Gse.exports;const K9e=gY(Q9e);var Wse={exports:{}},Xse={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(O,V){var F=O.length;O.push(V);e:for(;0<F;){var W=F-1>>>1,ee=O[W];if(0<n(ee,V))O[W]=V,O[F]=ee,F=W;else break e}}function i(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var V=O[0],F=O.pop();if(F!==V){O[0]=F;e:for(var W=0,ee=O.length,ae=ee>>>1;W<ae;){var K=2*(W+1)-1,$=O[K],ie=K+1,ye=O[ie];if(0>n($,F))ie<ee&&0>n(ye,$)?(O[W]=ye,O[ie]=F,W=ie):(O[W]=$,O[K]=F,W=K);else if(ie<ee&&0>n(ye,F))O[W]=ye,O[ie]=F,W=ie;else break e}}return V}function n(O,V){var F=O.sortIndex-V.sortIndex;return F!==0?F:O.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,v=!1,m=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(O){for(var V=i(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=O)r(c),V.sortIndex=V.expirationTime,t(l,V);else break;V=i(c)}}function _(O){if(v=!1,x(O),!f)if(i(l)!==null)f=!0,Q(M);else{var V=i(c);V!==null&&Y(_,V.startTime-O)}}function M(O,V){f=!1,v&&(v=!1,g(A),A=-1),p=!0;var F=d;try{for(x(V),h=i(l);h!==null&&(!(h.expirationTime>V)||O&&!D());){var W=h.callback;if(typeof W=="function"){h.callback=null,d=h.priorityLevel;var ee=W(h.expirationTime<=V);V=e.unstable_now(),typeof ee=="function"?h.callback=ee:h===i(l)&&r(l),x(V)}else r(l);h=i(l)}if(h!==null)var ae=!0;else{var K=i(c);K!==null&&Y(_,K.startTime-V),ae=!1}return ae}finally{h=null,d=F,p=!1}}var S=!1,E=null,A=-1,P=5,C=-1;function D(){return!(e.unstable_now()-C<P)}function N(){if(E!==null){var O=e.unstable_now();C=O;var V=!0;try{V=E(!0,O)}finally{V?U():(S=!1,E=null)}}else S=!1}var U;if(typeof y=="function")U=function(){y(N)};else if(typeof MessageChannel<"u"){var I=new MessageChannel,G=I.port2;I.port1.onmessage=N,U=function(){G.postMessage(null)}}else U=function(){m(N,0)};function Q(O){E=O,S||(S=!0,U())}function Y(O,V){A=m(function(){O(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(O){O.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,Q(M))},e.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<O?Math.floor(1e3/O):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(O){switch(d){case 1:case 2:case 3:var V=3;break;default:V=d}var F=d;d=V;try{return O()}finally{d=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(O,V){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var F=d;d=O;try{return V()}finally{d=F}},e.unstable_scheduleCallback=function(O,V,F){var W=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?W+F:W):F=W,O){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=F+ee,O={id:u++,callback:V,priorityLevel:O,startTime:F,expirationTime:ee,sortIndex:-1},F>W?(O.sortIndex=F,t(c,O),i(l)===null&&O===i(c)&&(v?(g(A),A=-1):v=!0,Y(_,F-W))):(O.sortIndex=ee,t(l,O),f||p||(f=!0,Q(M))),O},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(O){var V=d;return function(){var F=d;d=V;try{return O.apply(this,arguments)}finally{d=F}}}})(Xse);Wse.exports=Xse;var zX=Wse.exports;const SF={},J9e=e=>void Object.assign(SF,e);function $9e(e,t){function i(u,{args:h=[],attach:d,...p},f){let v=`${u[0].toUpperCase()}${u.slice(1)}`,m;if(u==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const g=p.object;m=Xg(g,{type:u,root:f,attach:d,primitive:!0})}else{const g=SF[v];if(!g)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");m=Xg(new g(...h),{type:u,root:f,attach:d,memoizedProps:{args:h}})}return m.__r3f.attach===void 0&&(m.isBufferGeometry?m.__r3f.attach="geometry":m.isMaterial&&(m.__r3f.attach="material")),v!=="inject"&&JL(m,p),m}function r(u,h){let d=!1;if(h){var p,f;(p=h.__r3f)!=null&&p.attach?KL(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(f=u.__r3f)==null||f.objects.push(h),h.__r3f||Xg(h,{}),h.__r3f.parent=u,gz(h),qg(h)}}function n(u,h,d){let p=!1;if(h){var f,v;if((f=h.__r3f)!=null&&f.attach)KL(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const m=u.children.filter(y=>y!==h),g=m.indexOf(d);u.children=[...m.slice(0,g),h,...m.slice(g)],p=!0}p||(v=u.__r3f)==null||v.objects.push(h),h.__r3f||Xg(h,{}),h.__r3f.parent=u,gz(h),qg(h)}}function s(u,h,d=!1){u&&[...u].forEach(p=>a(h,p,d))}function a(u,h,d){if(h){var p,f,v;if(h.__r3f&&(h.__r3f.parent=null),(p=u.__r3f)!=null&&p.objects&&(u.__r3f.objects=u.__r3f.objects.filter(_=>_!==h)),(f=h.__r3f)!=null&&f.attach)VX(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var m;u.remove(h),(m=h.__r3f)!=null&&m.root&&o7e(UE(h),h)}const y=(v=h.__r3f)==null?void 0:v.primitive,x=!y&&(d===void 0?h.dispose!==null:d);if(!y){var g;s((g=h.__r3f)==null?void 0:g.objects,h,x),s(h.children,h,x)}if(delete h.__r3f,x&&h.dispose&&h.type!=="Scene"){const _=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?zX.unstable_scheduleCallback(zX.unstable_IdlePriority,_):_()}qg(u)}}function o(u,h,d,p){var f;const v=(f=u.__r3f)==null?void 0:f.parent;if(!v)return;const m=i(h,d,u.__r3f.root);if(u.children){for(const g of u.children)g.__r3f&&r(m,g);u.children=u.children.filter(g=>!g.__r3f)}u.__r3f.objects.forEach(g=>r(m,g)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||a(v,u),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),r(v,m),m.raycast&&m.__r3f.eventCount&&UE(m).getState().internal.interaction.push(m),[p,p.alternate].forEach(g=>{g!==null&&(g.stateNode=m,g.ref&&(typeof g.ref=="function"?g.ref(m):g.ref.current=m))})}const l=()=>{};return{reconciler:K9e({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&a(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const p=u.getState().scene;p.__r3f&&n(p,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u==null?void 0:u.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,p){var f;if(((f=u==null?void 0:u.__r3f)!=null?f:{}).primitive&&p.object&&p.object!==u)return[!0];{const{args:m=[],children:g,...y}=p,{args:x=[],children:_,...M}=d;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((E,A)=>E!==x[A]))return[!0];const S=$se(u,y,M,!0);return S.changes.length?[!1,S]:null}},commitUpdate(u,[h,d],p,f,v,m){h?o(u,p,v,m):JL(u,d)},commitMount(u,h,d,p){var f;const v=(f=u.__r3f)!=null?f:{};u.raycast&&v.handlers&&v.eventCount&&UE(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Xg(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:p}=(h=u.__r3f)!=null?h:{};d&&p&&VX(p,u,d),u.isObject3D&&(u.visible=!1),qg(u)},unhideInstance(u,h){var d;const{attach:p,parent:f}=(d=u.__r3f)!=null?d:{};p&&f&&KL(f,u,p),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),qg(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():Sv.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ar.fun(performance.now)?performance.now:Ar.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ar.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ar.fun(clearTimeout)?clearTimeout:void 0}),applyProps:JL}}var BX,kX;const QL=e=>"colorSpace"in e||"outputColorSpace"in e,qse=()=>{var e;return(e=SF.ColorManagement)!=null?e:null},Yse=e=>e&&e.isOrthographicCamera,e7e=e=>e&&e.hasOwnProperty("current"),vw=typeof window<"u"&&((BX=window.document)!=null&&BX.createElement||((kX=window.navigator)==null?void 0:kX.product)==="ReactNative")?R.useLayoutEffect:R.useEffect;function Zse(e){const t=R.useRef(e);return vw(()=>void(t.current=e),[e]),t}function t7e({set:e}){return vw(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Qse extends R.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Qse.getDerivedStateFromError=()=>({error:!0});const Kse="__default",UX=new Map,i7e=e=>e&&!!e.memoized&&!!e.changes;function Jse(e){var t;const i=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const h1=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function UE(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Ar={obj:e=>e===Object(e)&&!Ar.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(Ar.str(e)||Ar.num(e)||Ar.boo(e))return e===t;const s=Ar.obj(e);if(s&&r==="reference")return e===t;const a=Ar.arr(e);if(a&&i==="reference")return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?t:e)if(!Ar.equ(e[o],t[o],{strict:n,objects:"reference"}))return!1}else for(o in n?t:e)if(e[o]!==t[o])return!1;if(Ar.und(o)){if(a&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function r7e(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function Xg(e,t){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function mz(e,t){let i=e;if(t.includes("-")){const r=t.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],e),{target:i,key:n}}else return{target:i,key:t}}const FX=/-\d+$/;function KL(e,t,i){if(Ar.str(i)){if(FX.test(i)){const s=i.replace(FX,""),{target:a,key:o}=mz(e,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=mz(e,i);t.__r3f.previousAttach=r[n],r[n]=t}else t.__r3f.previousAttach=i(e,t)}function VX(e,t,i){var r,n;if(Ar.str(i)){const{target:s,key:a}=mz(e,i),o=t.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(n=t.__r3f)==null||delete n.previousAttach}function $se(e,{children:t,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){const u=e.__r3f,h=Object.entries(n),d=[];if(c){const f=Object.keys(l);for(let v=0;v<f.length;v++)n.hasOwnProperty(f[v])||h.unshift([f[v],Kse+"remove"])}h.forEach(([f,v])=>{var m;if((m=e.__r3f)!=null&&m.primitive&&f==="object"||Ar.equ(v,l[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return d.push([f,v,!0,[]]);let g=[];f.includes("-")&&(g=f.split("-")),d.push([f,v,!1,g]);for(const y in n){const x=n[y];y.startsWith(`${f}-`)&&d.push([y,x,!1,y.split("-")])}});const p={...n};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:d}}const n7e=typeof process<"u"&&!1;function JL(e,t){var i;const r=e.__r3f,n=r==null?void 0:r.root,s=n==null||n.getState==null?void 0:n.getState(),{memoized:a,changes:o}=i7e(t)?t:$se(e,t),l=r==null?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let d=0;d<o.length;d++){let[p,f,v,m]=o[d];if(QL(e)){const _="srgb",M="srgb-linear";p==="encoding"?(p="colorSpace",f=f===3001?_:M):p==="outputEncoding"&&(p="outputColorSpace",f=f===3001?_:M)}let g=e,y=g[p];if(m.length&&(y=m.reduce((x,_)=>x[_],e),!(y&&y.set))){const[x,..._]=m.reverse();g=_.reverse().reduce((M,S)=>M[S],e),p=x}if(f===Kse+"remove")if(g.constructor){let x=UX.get(g.constructor);x||(x=new g.constructor,UX.set(g.constructor,x)),f=x[p]}else f=0;if(v&&r)f?r.handlers[p]=f:delete r.handlers[p],r.eventCount=Object.keys(r.handlers).length;else if(y&&y.set&&(y.copy||y instanceof jf)){if(Array.isArray(f))y.fromArray?y.fromArray(f):y.set(...f);else if(y.copy&&f&&f.constructor&&(n7e?y.constructor.name===f.constructor.name:y.constructor===f.constructor))y.copy(f);else if(f!==void 0){var c;const x=(c=y)==null?void 0:c.isColor;!x&&y.setScalar?y.setScalar(f):y instanceof jf&&f instanceof jf?y.mask=f.mask:y.set(f),!qse()&&s&&!s.linear&&x&&y.convertSRGBToLinear()}}else{var u;if(g[p]=f,(u=g[p])!=null&&u.isTexture&&g[p].format===fa&&g[p].type===Vc&&s){const x=g[p];QL(x)&&QL(s.gl)?x.colorSpace=s.gl.outputColorSpace:x.encoding=s.gl.outputEncoding}}qg(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const d=UE(e).getState().internal,p=d.interaction.indexOf(e);p>-1&&d.interaction.splice(p,1),r.eventCount&&d.interaction.push(e)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(i=e.__r3f)!=null&&i.parent&&gz(e),e}function qg(e){var t,i;const r=(t=e.__r3f)==null||(i=t.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function gz(e){e.onUpdate==null||e.onUpdate(e)}function s7e(e,t){e.manual||(Yse(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function YM(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function a7e(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return Sv.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Sv.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Sv.ContinuousEventPriority;default:return Sv.DefaultEventPriority}}function eae(e,t,i,r){const n=i.get(t);n&&(i.delete(t),i.size===0&&(e.delete(r),n.target.releasePointerCapture(r)))}function o7e(e,t){const{internal:i}=e.getState();i.interaction=i.interaction.filter(r=>r!==t),i.initialHits=i.initialHits.filter(r=>r!==t),i.hovered.forEach((r,n)=>{(r.eventObject===t||r.object===t)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{eae(i.capturedMap,t,r,n)})}function l7e(e){function t(l){const{internal:c}=e.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=e.getState(),h=new Set,d=[],p=c?c(u.internal.interaction):u.internal.interaction;for(let g=0;g<p.length;g++){const y=h1(p[g]);y&&(y.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function f(g){const y=h1(g);if(!y||!y.events.enabled||y.raycaster.camera===null)return[];if(y.raycaster.camera===void 0){var x;y.events.compute==null||y.events.compute(l,y,(x=y.previousRoot)==null?void 0:x.getState()),y.raycaster.camera===void 0&&(y.raycaster.camera=null)}return y.raycaster.camera?y.raycaster.intersectObject(g,!0):[]}let v=p.flatMap(f).sort((g,y)=>{const x=h1(g.object),_=h1(y.object);return!x||!_?g.distance-y.distance:_.events.priority-x.events.priority||g.distance-y.distance}).filter(g=>{const y=YM(g);return h.has(y)?!1:(h.add(y),!0)});u.events.filter&&(v=u.events.filter(v,u));for(const g of v){let y=g.object;for(;y;){var m;(m=y.__r3f)!=null&&m.eventCount&&d.push({...g,eventObject:y}),y=y.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let g of u.internal.capturedMap.get(l.pointerId).values())h.has(YM(g.intersection))||d.push(g.intersection);return d}function n(l,c,u,h){const d=e.getState();if(l.length){const p={stopped:!1};for(const f of l){const v=h1(f.object)||d,{raycaster:m,pointer:g,camera:y,internal:x}=v,_=new he(g.x,g.y,0).unproject(y),M=C=>{var D,N;return(D=(N=x.capturedMap.get(C))==null?void 0:N.has(f.eventObject))!=null?D:!1},S=C=>{const D={intersection:f,target:c.target};x.capturedMap.has(C)?x.capturedMap.get(C).set(f.eventObject,D):x.capturedMap.set(C,new Map([[f.eventObject,D]])),c.target.setPointerCapture(C)},E=C=>{const D=x.capturedMap.get(C);D&&eae(x.capturedMap,f.eventObject,D,C)};let A={};for(let C in c){let D=c[C];typeof D!="function"&&(A[C]=D)}let P={...f,...A,pointer:g,intersections:l,stopped:p.stopped,delta:u,unprojectedPoint:_,ray:m.ray,camera:y,stopPropagation(){const C="pointerId"in c&&x.capturedMap.get(c.pointerId);if((!C||C.has(f.eventObject))&&(P.stopped=p.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(D=>D.eventObject===f.eventObject))){const D=l.slice(0,l.indexOf(f));s([...D,f])}},target:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:E},currentTarget:{hasPointerCapture:M,setPointerCapture:S,releasePointerCapture:E},nativeEvent:c};if(h(P),p.stopped===!0)break}}return l}function s(l){const{internal:c}=e.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,p=d==null?void 0:d.handlers;if(c.hovered.delete(YM(u)),d!=null&&d.eventCount){const f={...u,intersections:l};p.onPointerOut==null||p.onPointerOut(f),p.onPointerLeave==null||p.onPointerLeave(f)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=e.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=e.getState();d.lastEvent.current=u;const p=l==="onPointerMove",f=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",m=r(u,p?i:void 0),g=f?t(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=m.map(x=>x.eventObject)),f&&!m.length&&g<=2&&(a(u,d.interaction),h&&h(u)),p&&s(m);function y(x){const _=x.eventObject,M=_.__r3f,S=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(p){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const E=YM(x),A=d.hovered.get(E);A?A.stopped&&x.stopPropagation():(d.hovered.set(E,x),S.onPointerOver==null||S.onPointerOver(x),S.onPointerEnter==null||S.onPointerEnter(x))}S.onPointerMove==null||S.onPointerMove(x)}else{const E=S[l];E?(!f||d.initialHits.includes(_))&&(a(u,d.interaction.filter(A=>!d.initialHits.includes(A))),E(x)):f&&d.initialHits.includes(_)&&a(u,d.interaction.filter(A=>!d.initialHits.includes(A)))}}n(m,u,g,y)}}return{handlePointer:o}}const tae=e=>!!(e!=null&&e.render),iae=R.createContext(null),c7e=(e,t)=>{const i=X9e((o,l)=>{const c=new he,u=new he,h=new he;function d(g=l().camera,y=u,x=l().size){const{width:_,height:M,top:S,left:E}=x,A=_/M;y.isVector3?h.copy(y):h.set(...y);const P=g.getWorldPosition(c).distanceTo(h);if(Yse(g))return{width:_/g.zoom,height:M/g.zoom,top:S,left:E,factor:1,distance:P,aspect:A};{const C=g.fov*Math.PI/180,D=2*Math.tan(C/2)*P,N=D*(_/M);return{width:N,height:D,top:S,left:E,factor:_/N,distance:P,aspect:A}}}let p;const f=g=>o(y=>({performance:{...y.performance,current:g}})),v=new nt;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(g=1)=>e(l(),g),advance:(g,y)=>t(g,y,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new xF,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const g=l();p&&clearTimeout(p),g.performance.current!==g.performance.min&&f(g.performance.min),p=setTimeout(()=>f(l().performance.max),g.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:g=>o(y=>({...y,events:{...y.events,...g}})),setSize:(g,y,x,_,M)=>{const S=l().camera,E={width:g,height:y,top:_||0,left:M||0,updateStyle:x};o(A=>({size:E,viewport:{...A.viewport,...d(S,u,E)}}))},setDpr:g=>o(y=>{const x=Jse(g);return{viewport:{...y.viewport,dpr:x,initialDpr:y.viewport.initialDpr||x}}}),setFrameloop:(g="always")=>{const y=l().clock;y.stop(),y.elapsedTime=0,g!=="never"&&(y.start(),y.elapsedTime=0),o(()=>({frameloop:g}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:R.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(g,y,x)=>{const _=l().internal;return _.priority=_.priority+(y>0?1:0),_.subscribers.push({ref:g,priority:y,store:x}),_.subscribers=_.subscribers.sort((M,S)=>M.priority-S.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(y>0?1:0),M.subscribers=M.subscribers.filter(S=>S.ref!==g))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){var d;n=l,s=c.dpr,s7e(o,l),u.setPixelRatio(c.dpr);const p=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,p)}o!==a&&(a=o,h(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>e(o)),i};let ZM,u7e=new Set,h7e=new Set,d7e=new Set;function $L(e,t){if(e.size)for(const{callback:i}of e.values())i(t)}function d1(e,t){switch(e){case"before":return $L(u7e,t);case"after":return $L(h7e,t);case"tail":return $L(d7e,t)}}let eR,tR;function iR(e,t,i){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),eR=t.internal.subscribers,ZM=0;ZM<eR.length;ZM++)tR=eR[ZM],tR.ref.current(tR.store.getState(),r,i);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function p7e(e){let t=!1,i=!1,r,n,s;function a(c){n=requestAnimationFrame(a),t=!0,r=0,d1("before",c),i=!0;for(const h of e.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=iR(c,s))}if(i=!1,d1("after",c),r===0)return d1("tail",c),t=!1,cancelAnimationFrame(n)}function o(c,u=1){var h;if(!c)return e.forEach(d=>o(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):i?c.internal.frames=2:c.internal.frames=1,t||(t=!0,requestAnimationFrame(a)))}function l(c,u=!0,h,d){if(u&&d1("before",c),h)iR(c,h,d);else for(const p of e.values())iR(c,p.store.getState());u&&d1("after",c)}return{loop:a,invalidate:o,advance:l}}function rae(){const e=R.useContext(iae);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function Kh(e=i=>i,t){return rae()(e,t)}function MF(e,t=0){const i=rae(),r=i.getState().internal.subscribe,n=Zse(e);return vw(()=>r(n,t,i),[t,r,i]),null}const b0=new Map,{invalidate:jX,advance:HX}=p7e(b0),{reconciler:IC,applyProps:Bg}=$9e(b0,a7e),kg={objects:"shallow",strict:!1},f7e=(e,t)=>{const i=typeof e=="function"?e(t):e;return tae(i)?i:new eF({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function m7e(e,t){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=t;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:n,top:s,left:a}=e.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function g7e(e){const t=b0.get(e),i=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||c7e(jX,HX),a=i||IC.createContainer(s,Sv.ConcurrentRoot,null,!1,null,"",n,null);t||b0.set(e,{fiber:a,store:s});let o,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:p,events:f,onCreated:v,shadows:m=!1,linear:g=!1,flat:y=!1,legacy:x=!1,orthographic:_=!1,frameloop:M="always",dpr:S=[1,2],performance:E,raycaster:A,camera:P,onPointerMissed:C}=u,D=s.getState(),N=D.gl;D.gl||D.set({gl:N=f7e(h,e)});let U=D.raycaster;U||D.set({raycaster:U=new Vse});const{params:I,...G}=A||{};if(Ar.equ(G,U,kg)||Bg(U,{...G}),Ar.equ(I,U.params,kg)||Bg(U,{params:{...U.params,...I}}),!D.camera||D.camera===c&&!Ar.equ(c,P,kg)){c=P;const F=P instanceof uw,W=F?P:_?new Hd(0,0,0,0,.1,1e3):new hn(75,0,.1,1e3);F||(W.position.z=5,P&&(Bg(W,P),("aspect"in P||"left"in P||"right"in P||"bottom"in P||"top"in P)&&(W.manual=!0,W.updateProjectionMatrix())),!D.camera&&!(P!=null&&P.rotation)&&W.lookAt(0,0,0)),D.set({camera:W}),U.camera=W}if(!D.scene){let F;p!=null&&p.isScene?F=p:(F=new tF,p&&Bg(F,p)),D.set({scene:Xg(F)})}if(!D.xr){var Q;const F=(ae,K)=>{const $=s.getState();$.frameloop!=="never"&&HX(ae,!0,$,K)},W=()=>{const ae=s.getState();ae.gl.xr.enabled=ae.gl.xr.isPresenting,ae.gl.xr.setAnimationLoop(ae.gl.xr.isPresenting?F:null),ae.gl.xr.isPresenting||jX(ae)},ee={connect(){const ae=s.getState().gl;ae.xr.addEventListener("sessionstart",W),ae.xr.addEventListener("sessionend",W)},disconnect(){const ae=s.getState().gl;ae.xr.removeEventListener("sessionstart",W),ae.xr.removeEventListener("sessionend",W)}};typeof((Q=N.xr)==null?void 0:Q.addEventListener)=="function"&&ee.connect(),D.set({xr:ee})}if(N.shadowMap){const F=N.shadowMap.enabled,W=N.shadowMap.type;if(N.shadowMap.enabled=!!m,Ar.boo(m))N.shadowMap.type=ux;else if(Ar.str(m)){var Y;const ee={basic:Ire,percentage:FT,soft:ux,variance:Cl};N.shadowMap.type=(Y=ee[m])!=null?Y:ux}else Ar.obj(m)&&Object.assign(N.shadowMap,m);(F!==N.shadowMap.enabled||W!==N.shadowMap.type)&&(N.shadowMap.needsUpdate=!0)}const O=qse();O&&("enabled"in O?O.enabled=!x:"legacyMode"in O&&(O.legacyMode=x)),l||Bg(N,{outputEncoding:g?3e3:3001,toneMapping:y?Fc:OU}),D.legacy!==x&&D.set(()=>({legacy:x})),D.linear!==g&&D.set(()=>({linear:g})),D.flat!==y&&D.set(()=>({flat:y})),h&&!Ar.fun(h)&&!tae(h)&&!Ar.equ(h,N,kg)&&Bg(N,h),f&&!D.events.handlers&&D.set({events:f(s)});const V=m7e(e,d);return Ar.equ(V,D.size,kg)||D.setSize(V.width,V.height,V.updateStyle,V.top,V.left),S&&D.viewport.dpr!==Jse(S)&&D.setDpr(S),D.frameloop!==M&&D.setFrameloop(M),D.onPointerMissed||D.set({onPointerMissed:C}),E&&!Ar.equ(E,D.performance,kg)&&D.set(F=>({performance:{...F.performance,...E}})),o=v,l=!0,this},render(u){return l||this.configure(),IC.updateContainer(j.jsx(v7e,{store:s,children:u,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){nae(e)}}}function v7e({store:e,children:t,onCreated:i,rootElement:r}){return vw(()=>{const n=e.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),e.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),j.jsx(iae.Provider,{value:e,children:t})}function nae(e,t){const i=b0.get(e),r=i==null?void 0:i.fiber;if(r){const n=i==null?void 0:i.store.getState();n&&(n.internal.active=!1),IC.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),r7e(n),b0.delete(e)}catch{}},500)})}}IC.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:R.version});const rR={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function y7e(e){const{handlePointer:t}=l7e(e);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(rR).reduce((i,r)=>({...i,[r]:t(r)}),{}),update:()=>{var i;const{events:r,internal:n}=e.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=e.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=rR[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=e.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=rR[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}function GX(e,t){let i;return(...r)=>{window.clearTimeout(i),i=window.setTimeout(()=>e(...r),t)}}function x7e({debounce:e,scroll:t,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=R.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=R.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,u=R.useRef(!1);R.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,p]=R.useMemo(()=>{const g=()=>{if(!o.current.element)return;const{left:y,top:x,width:_,height:M,bottom:S,right:E,x:A,y:P}=o.current.element.getBoundingClientRect(),C={left:y,top:x,width:_,height:M,bottom:S,right:E,x:A,y:P};o.current.element instanceof HTMLElement&&r&&(C.height=o.current.element.offsetHeight,C.width=o.current.element.offsetWidth),Object.freeze(C),u.current&&!S7e(o.current.lastBounds,C)&&a(o.current.lastBounds=C)};return[g,c?GX(g,c):g,l?GX(g,l):g]},[a,r,l,c]);function f(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(g=>g.removeEventListener("scroll",p,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function v(){o.current.element&&(o.current.resizeObserver=new n(p),o.current.resizeObserver.observe(o.current.element),t&&o.current.scrollContainers&&o.current.scrollContainers.forEach(g=>g.addEventListener("scroll",p,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const m=g=>{!g||g===o.current.element||(f(),o.current.element=g,o.current.scrollContainers=sae(g),v())};return w7e(p,!!t),b7e(d),R.useEffect(()=>{f(),v()},[t,p,d]),R.useEffect(()=>f,[]),[m,s,h]}function b7e(e){R.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function w7e(e,t){R.useEffect(()=>{if(t){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,t])}function sae(e){const t=[];if(!e||e===document.body)return t;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(e);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...sae(e.parentElement)]}const _7e=["x","y","top","bottom","left","right","width","height"],S7e=(e,t)=>_7e.every(i=>e[i]===t[i]);var M7e=Object.defineProperty,E7e=Object.defineProperties,A7e=Object.getOwnPropertyDescriptors,WX=Object.getOwnPropertySymbols,C7e=Object.prototype.hasOwnProperty,T7e=Object.prototype.propertyIsEnumerable,XX=(e,t,i)=>t in e?M7e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,qX=(e,t)=>{for(var i in t||(t={}))C7e.call(t,i)&&XX(e,i,t[i]);if(WX)for(var i of WX(t))T7e.call(t,i)&&XX(e,i,t[i]);return e},P7e=(e,t)=>E7e(e,A7e(t)),YX,ZX;typeof window<"u"&&((YX=window.document)!=null&&YX.createElement||((ZX=window.navigator)==null?void 0:ZX.product)==="ReactNative")?R.useLayoutEffect:R.useEffect;function aae(e,t,i){if(!e)return;if(i(e)===!0)return e;let r=e.child;for(;r;){const n=aae(r,t,i);if(n)return n;r=r.sibling}}function oae(e){try{return Object.defineProperties(e,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return e}}const QX=console.error;console.error=function(){const e=[...arguments].join("");if(e!=null&&e.startsWith("Warning:")&&e.includes("useContext")){console.error=QX;return}return QX.apply(this,arguments)};const EF=oae(R.createContext(null));class lae extends R.Component{render(){return R.createElement(EF.Provider,{value:this._reactInternals},this.props.children)}}function D7e(){const e=R.useContext(EF);if(e===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const t=R.useId();return R.useMemo(()=>{for(const r of[e,e==null?void 0:e.alternate]){if(!r)continue;const n=aae(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===t)return!0;a=a.next}});if(n)return n}},[e,t])}function L7e(){const e=D7e(),[t]=R.useState(()=>new Map);t.clear();let i=e;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==EF&&!t.has(n)&&t.set(n,R.useContext(oae(n)))}i=i.return}return t}function R7e(){const e=L7e();return R.useMemo(()=>Array.from(e.keys()).reduce((t,i)=>r=>R.createElement(t,null,R.createElement(i.Provider,P7e(qX({},r),{value:e.get(i)}))),t=>R.createElement(lae,qX({},t))),[e])}const I7e=R.forwardRef(function({children:t,fallback:i,resize:r,style:n,gl:s,events:a=y7e,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:f,dpr:v,performance:m,raycaster:g,camera:y,scene:x,onPointerMissed:_,onCreated:M,...S},E){R.useMemo(()=>J9e(H9e),[]);const A=R7e(),[P,C]=x7e({scroll:!0,debounce:{scroll:50,resize:0},...r}),D=R.useRef(null),N=R.useRef(null);R.useImperativeHandle(E,()=>D.current);const U=Zse(_),[I,G]=R.useState(!1),[Q,Y]=R.useState(!1);if(I)throw I;if(Q)throw Q;const O=R.useRef(null);vw(()=>{const F=D.current;C.width>0&&C.height>0&&F&&(O.current||(O.current=g7e(F)),O.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:p,frameloop:f,dpr:v,performance:m,raycaster:g,camera:y,scene:x,size:C,onPointerMissed:(...W)=>U.current==null?void 0:U.current(...W),onCreated:W=>{W.events.connect==null||W.events.connect(o?e7e(o)?o.current:o:N.current),l&&W.setEvents({compute:(ee,ae)=>{const K=ee[l+"X"],$=ee[l+"Y"];ae.pointer.set(K/ae.size.width*2-1,-($/ae.size.height)*2+1),ae.raycaster.setFromCamera(ae.pointer,ae.camera)}}),M==null||M(W)}}),O.current.render(j.jsx(A,{children:j.jsx(Qse,{set:Y,children:j.jsx(R.Suspense,{fallback:j.jsx(t7e,{set:G}),children:t??null})})})))}),R.useEffect(()=>{const F=D.current;if(F)return()=>nae(F)},[]);const V=o?"none":"auto";return j.jsx("div",{ref:N,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:V,...n},...S,children:j.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:j.jsx("canvas",{ref:D,style:{display:"block"},children:i})})})}),O7e=R.forwardRef(function(t,i){return j.jsx(lae,{children:j.jsx(I7e,{...t,ref:i})})});function Lb(){return Lb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Lb.apply(null,arguments)}var N7e=Object.defineProperty,z7e=(e,t,i)=>t in e?N7e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,B7e=(e,t,i)=>(z7e(e,t+"",i),i);class k7e{constructor(){B7e(this,"_listeners")}addEventListener(t,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(i)===-1&&r[t].push(i)}hasEventListener(t,i){if(this._listeners===void 0)return!1;const r=this._listeners;return r[t]!==void 0&&r[t].indexOf(i)!==-1}removeEventListener(t,i){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const r=this._listeners[t.type];if(r!==void 0){t.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}var U7e=Object.defineProperty,F7e=(e,t,i)=>t in e?U7e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ii=(e,t,i)=>(F7e(e,typeof t!="symbol"?t+"":t,i),i);const QM=new xm,KX=new Iu,V7e=Math.cos(70*(Math.PI/180)),JX=(e,t)=>(e%t+t)%t;let j7e=class extends k7e{constructor(t,i){super(),ii(this,"object"),ii(this,"domElement"),ii(this,"enabled",!0),ii(this,"target",new he),ii(this,"minDistance",0),ii(this,"maxDistance",1/0),ii(this,"minZoom",0),ii(this,"maxZoom",1/0),ii(this,"minPolarAngle",0),ii(this,"maxPolarAngle",Math.PI),ii(this,"minAzimuthAngle",-1/0),ii(this,"maxAzimuthAngle",1/0),ii(this,"enableDamping",!1),ii(this,"dampingFactor",.05),ii(this,"enableZoom",!0),ii(this,"zoomSpeed",1),ii(this,"enableRotate",!0),ii(this,"rotateSpeed",1),ii(this,"enablePan",!0),ii(this,"panSpeed",1),ii(this,"screenSpacePanning",!0),ii(this,"keyPanSpeed",7),ii(this,"zoomToCursor",!1),ii(this,"autoRotate",!1),ii(this,"autoRotateSpeed",2),ii(this,"reverseOrbit",!1),ii(this,"reverseHorizontalOrbit",!1),ii(this,"reverseVerticalOrbit",!1),ii(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),ii(this,"mouseButtons",{LEFT:ef.ROTATE,MIDDLE:ef.DOLLY,RIGHT:ef.PAN}),ii(this,"touches",{ONE:tf.ROTATE,TWO:tf.DOLLY_PAN}),ii(this,"target0"),ii(this,"position0"),ii(this,"zoom0"),ii(this,"_domElementKeyEvents",null),ii(this,"getPolarAngle"),ii(this,"getAzimuthalAngle"),ii(this,"setPolarAngle"),ii(this,"setAzimuthalAngle"),ii(this,"getDistance"),ii(this,"getZoomScale"),ii(this,"listenToKeyEvents"),ii(this,"stopListenToKeyEvents"),ii(this,"saveState"),ii(this,"reset"),ii(this,"update"),ii(this,"connect"),ii(this,"dispose"),ii(this,"dollyIn"),ii(this,"dollyOut"),ii(this,"getScale"),ii(this,"setScale"),this.object=t,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=ue=>{let ze=JX(ue,2*Math.PI),ut=u.phi;ut<0&&(ut+=2*Math.PI),ze<0&&(ze+=2*Math.PI);let de=Math.abs(ze-ut);2*Math.PI-de<de&&(ze<ut?ze+=2*Math.PI:ut+=2*Math.PI),h.phi=ze-ut,r.update()},this.setAzimuthalAngle=ue=>{let ze=JX(ue,2*Math.PI),ut=u.theta;ut<0&&(ut+=2*Math.PI),ze<0&&(ze+=2*Math.PI);let de=Math.abs(ze-ut);2*Math.PI-de<de&&(ze<ut?ze+=2*Math.PI:ut+=2*Math.PI),h.theta=ze-ut,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=ue=>{ue.addEventListener("keydown",et),this._domElementKeyEvents=ue},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",et),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(n),r.update(),l=o.NONE},this.update=(()=>{const ue=new he,ze=new he(0,1,0),ut=new Zs().setFromUnitVectors(t.up,ze),de=ut.clone().invert(),Ne=new he,oe=new Zs,He=2*Math.PI;return function(){const tt=r.object.position;ut.setFromUnitVectors(t.up,ze),de.copy(ut).invert(),ue.copy(tt).sub(r.target),ue.applyQuaternion(ut),u.setFromVector3(ue),r.autoRotate&&l===o.NONE&&I(N()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let ct=r.minAzimuthAngle,Dt=r.maxAzimuthAngle;isFinite(ct)&&isFinite(Dt)&&(ct<-Math.PI?ct+=He:ct>Math.PI&&(ct-=He),Dt<-Math.PI?Dt+=He:Dt>Math.PI&&(Dt-=He),ct<=Dt?u.theta=Math.max(ct,Math.min(Dt,u.theta)):u.theta=u.theta>(ct+Dt)/2?Math.max(ct,u.theta):Math.min(Dt,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(p,r.dampingFactor):r.target.add(p),r.zoomToCursor&&P||r.object.isOrthographicCamera?u.radius=ae(u.radius):u.radius=ae(u.radius*d),ue.setFromSpherical(u),ue.applyQuaternion(de),tt.copy(r.target).add(ue),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,p.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),p.set(0,0,0));let ai=!1;if(r.zoomToCursor&&P){let Wt=null;if(r.object instanceof hn&&r.object.isPerspectiveCamera){const Ni=ue.length();Wt=ae(Ni*d);const Qt=Ni-Wt;r.object.position.addScaledVector(E,Qt),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Ni=new he(A.x,A.y,0);Ni.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix(),ai=!0;const Qt=new he(A.x,A.y,0);Qt.unproject(r.object),r.object.position.sub(Qt).add(Ni),r.object.updateMatrixWorld(),Wt=ue.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Wt!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Wt).add(r.object.position):(QM.origin.copy(r.object.position),QM.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(QM.direction))<V7e?t.lookAt(r.target):(KX.setFromNormalAndCoplanarPoint(r.object.up,r.target),QM.intersectPlane(KX,r.target))))}else r.object instanceof Hd&&r.object.isOrthographicCamera&&(ai=d!==1,ai&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/d)),r.object.updateProjectionMatrix()));return d=1,P=!1,ai||Ne.distanceToSquared(r.object.position)>c||8*(1-oe.dot(r.object.quaternion))>c?(r.dispatchEvent(n),Ne.copy(r.object.position),oe.copy(r.object.quaternion),ai=!1,!0):!1}})(),this.connect=ue=>{r.domElement=ue,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",at),r.domElement.addEventListener("pointerdown",z),r.domElement.addEventListener("pointercancel",ce),r.domElement.addEventListener("wheel",Ye)},this.dispose=()=>{var ue,ze,ut,de,Ne,oe;r.domElement&&(r.domElement.style.touchAction="auto"),(ue=r.domElement)==null||ue.removeEventListener("contextmenu",at),(ze=r.domElement)==null||ze.removeEventListener("pointerdown",z),(ut=r.domElement)==null||ut.removeEventListener("pointercancel",ce),(de=r.domElement)==null||de.removeEventListener("wheel",Ye),(Ne=r.domElement)==null||Ne.ownerDocument.removeEventListener("pointermove",X),(oe=r.domElement)==null||oe.ownerDocument.removeEventListener("pointerup",ce),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",et)};const r=this,n={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new RC,h=new RC;let d=1;const p=new he,f=new nt,v=new nt,m=new nt,g=new nt,y=new nt,x=new nt,_=new nt,M=new nt,S=new nt,E=new he,A=new nt;let P=!1;const C=[],D={};function N(){return 2*Math.PI/60/60*r.autoRotateSpeed}function U(){return Math.pow(.95,r.zoomSpeed)}function I(ue){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=ue:h.theta-=ue}function G(ue){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=ue:h.phi-=ue}const Q=(()=>{const ue=new he;return function(ut,de){ue.setFromMatrixColumn(de,0),ue.multiplyScalar(-ut),p.add(ue)}})(),Y=(()=>{const ue=new he;return function(ut,de){r.screenSpacePanning===!0?ue.setFromMatrixColumn(de,1):(ue.setFromMatrixColumn(de,0),ue.crossVectors(r.object.up,ue)),ue.multiplyScalar(ut),p.add(ue)}})(),O=(()=>{const ue=new he;return function(ut,de){const Ne=r.domElement;if(Ne&&r.object instanceof hn&&r.object.isPerspectiveCamera){const oe=r.object.position;ue.copy(oe).sub(r.target);let He=ue.length();He*=Math.tan(r.object.fov/2*Math.PI/180),Q(2*ut*He/Ne.clientHeight,r.object.matrix),Y(2*de*He/Ne.clientHeight,r.object.matrix)}else Ne&&r.object instanceof Hd&&r.object.isOrthographicCamera?(Q(ut*(r.object.right-r.object.left)/r.object.zoom/Ne.clientWidth,r.object.matrix),Y(de*(r.object.top-r.object.bottom)/r.object.zoom/Ne.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function V(ue){r.object instanceof hn&&r.object.isPerspectiveCamera||r.object instanceof Hd&&r.object.isOrthographicCamera?d=ue:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function F(ue){V(d/ue)}function W(ue){V(d*ue)}function ee(ue){if(!r.zoomToCursor||!r.domElement)return;P=!0;const ze=r.domElement.getBoundingClientRect(),ut=ue.clientX-ze.left,de=ue.clientY-ze.top,Ne=ze.width,oe=ze.height;A.x=ut/Ne*2-1,A.y=-(de/oe)*2+1,E.set(A.x,A.y,1).unproject(r.object).sub(r.object.position).normalize()}function ae(ue){return Math.max(r.minDistance,Math.min(r.maxDistance,ue))}function K(ue){f.set(ue.clientX,ue.clientY)}function $(ue){ee(ue),_.set(ue.clientX,ue.clientY)}function ie(ue){g.set(ue.clientX,ue.clientY)}function ye(ue){v.set(ue.clientX,ue.clientY),m.subVectors(v,f).multiplyScalar(r.rotateSpeed);const ze=r.domElement;ze&&(I(2*Math.PI*m.x/ze.clientHeight),G(2*Math.PI*m.y/ze.clientHeight)),f.copy(v),r.update()}function pe(ue){M.set(ue.clientX,ue.clientY),S.subVectors(M,_),S.y>0?F(U()):S.y<0&&W(U()),_.copy(M),r.update()}function me(ue){y.set(ue.clientX,ue.clientY),x.subVectors(y,g).multiplyScalar(r.panSpeed),O(x.x,x.y),g.copy(y),r.update()}function ge(ue){ee(ue),ue.deltaY<0?W(U()):ue.deltaY>0&&F(U()),r.update()}function xe(ue){let ze=!1;switch(ue.code){case r.keys.UP:O(0,r.keyPanSpeed),ze=!0;break;case r.keys.BOTTOM:O(0,-r.keyPanSpeed),ze=!0;break;case r.keys.LEFT:O(r.keyPanSpeed,0),ze=!0;break;case r.keys.RIGHT:O(-r.keyPanSpeed,0),ze=!0;break}ze&&(ue.preventDefault(),r.update())}function te(){if(C.length==1)f.set(C[0].pageX,C[0].pageY);else{const ue=.5*(C[0].pageX+C[1].pageX),ze=.5*(C[0].pageY+C[1].pageY);f.set(ue,ze)}}function we(){if(C.length==1)g.set(C[0].pageX,C[0].pageY);else{const ue=.5*(C[0].pageX+C[1].pageX),ze=.5*(C[0].pageY+C[1].pageY);g.set(ue,ze)}}function Ce(){const ue=C[0].pageX-C[1].pageX,ze=C[0].pageY-C[1].pageY,ut=Math.sqrt(ue*ue+ze*ze);_.set(0,ut)}function Se(){r.enableZoom&&Ce(),r.enablePan&&we()}function Re(){r.enableZoom&&Ce(),r.enableRotate&&te()}function Xe(ue){if(C.length==1)v.set(ue.pageX,ue.pageY);else{const ut=st(ue),de=.5*(ue.pageX+ut.x),Ne=.5*(ue.pageY+ut.y);v.set(de,Ne)}m.subVectors(v,f).multiplyScalar(r.rotateSpeed);const ze=r.domElement;ze&&(I(2*Math.PI*m.x/ze.clientHeight),G(2*Math.PI*m.y/ze.clientHeight)),f.copy(v)}function Be(ue){if(C.length==1)y.set(ue.pageX,ue.pageY);else{const ze=st(ue),ut=.5*(ue.pageX+ze.x),de=.5*(ue.pageY+ze.y);y.set(ut,de)}x.subVectors(y,g).multiplyScalar(r.panSpeed),O(x.x,x.y),g.copy(y)}function Fe(ue){const ze=st(ue),ut=ue.pageX-ze.x,de=ue.pageY-ze.y,Ne=Math.sqrt(ut*ut+de*de);M.set(0,Ne),S.set(0,Math.pow(M.y/_.y,r.zoomSpeed)),F(S.y),_.copy(M)}function dt(ue){r.enableZoom&&Fe(ue),r.enablePan&&Be(ue)}function se(ue){r.enableZoom&&Fe(ue),r.enableRotate&&Xe(ue)}function z(ue){var ze,ut;r.enabled!==!1&&(C.length===0&&((ze=r.domElement)==null||ze.ownerDocument.addEventListener("pointermove",X),(ut=r.domElement)==null||ut.ownerDocument.addEventListener("pointerup",ce)),Ve(ue),ue.pointerType==="touch"?ke(ue):Ee(ue))}function X(ue){r.enabled!==!1&&(ue.pointerType==="touch"?_e(ue):q(ue))}function ce(ue){var ze,ut,de;mt(ue),C.length===0&&((ze=r.domElement)==null||ze.releasePointerCapture(ue.pointerId),(ut=r.domElement)==null||ut.ownerDocument.removeEventListener("pointermove",X),(de=r.domElement)==null||de.ownerDocument.removeEventListener("pointerup",ce)),r.dispatchEvent(a),l=o.NONE}function Ee(ue){let ze;switch(ue.button){case 0:ze=r.mouseButtons.LEFT;break;case 1:ze=r.mouseButtons.MIDDLE;break;case 2:ze=r.mouseButtons.RIGHT;break;default:ze=-1}switch(ze){case ef.DOLLY:if(r.enableZoom===!1)return;$(ue),l=o.DOLLY;break;case ef.ROTATE:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(r.enablePan===!1)return;ie(ue),l=o.PAN}else{if(r.enableRotate===!1)return;K(ue),l=o.ROTATE}break;case ef.PAN:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(r.enableRotate===!1)return;K(ue),l=o.ROTATE}else{if(r.enablePan===!1)return;ie(ue),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function q(ue){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;ye(ue);break;case o.DOLLY:if(r.enableZoom===!1)return;pe(ue);break;case o.PAN:if(r.enablePan===!1)return;me(ue);break}}function Ye(ue){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(ue.preventDefault(),r.dispatchEvent(s),ge(ue),r.dispatchEvent(a))}function et(ue){r.enabled===!1||r.enablePan===!1||xe(ue)}function ke(ue){switch(pt(ue),C.length){case 1:switch(r.touches.ONE){case tf.ROTATE:if(r.enableRotate===!1)return;te(),l=o.TOUCH_ROTATE;break;case tf.PAN:if(r.enablePan===!1)return;we(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case tf.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Se(),l=o.TOUCH_DOLLY_PAN;break;case tf.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Re(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function _e(ue){switch(pt(ue),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;Xe(ue),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;Be(ue),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;dt(ue),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;se(ue),r.update();break;default:l=o.NONE}}function at(ue){r.enabled!==!1&&ue.preventDefault()}function Ve(ue){C.push(ue)}function mt(ue){delete D[ue.pointerId];for(let ze=0;ze<C.length;ze++)if(C[ze].pointerId==ue.pointerId){C.splice(ze,1);return}}function pt(ue){let ze=D[ue.pointerId];ze===void 0&&(ze=new nt,D[ue.pointerId]=ze),ze.set(ue.pageX,ue.pageY)}function st(ue){const ze=ue.pointerId===C[0].pointerId?C[1]:C[0];return D[ze.pointerId]}this.dollyIn=(ue=U())=>{W(ue),r.update()},this.dollyOut=(ue=U())=>{F(ue),r.update()},this.getScale=()=>d,this.setScale=ue=>{V(ue),r.update()},this.getZoomScale=()=>U(),i!==void 0&&this.connect(i),this.update()}};const H7e=()=>parseInt(ow.replace(/\D+/g,"")),G7e=H7e(),W7e=R.forwardRef(({makeDefault:e,camera:t,regress:i,domElement:r,enableDamping:n=!0,keyEvents:s=!1,onChange:a,onStart:o,onEnd:l,...c},u)=>{const h=Kh(S=>S.invalidate),d=Kh(S=>S.camera),p=Kh(S=>S.gl),f=Kh(S=>S.events),v=Kh(S=>S.setEvents),m=Kh(S=>S.set),g=Kh(S=>S.get),y=Kh(S=>S.performance),x=t||d,_=r||f.connected||p.domElement,M=R.useMemo(()=>new j7e(x),[x]);return MF(()=>{M.enabled&&M.update()},-1),R.useEffect(()=>(s&&M.connect(s===!0?_:s),M.connect(_),()=>void M.dispose()),[s,_,i,M,h]),R.useEffect(()=>{const S=P=>{h(),i&&y.regress(),a&&a(P)},E=P=>{o&&o(P)},A=P=>{l&&l(P)};return M.addEventListener("change",S),M.addEventListener("start",E),M.addEventListener("end",A),()=>{M.removeEventListener("start",E),M.removeEventListener("end",A),M.removeEventListener("change",S)}},[a,o,l,M,h,v]),R.useEffect(()=>{if(e){const S=g().controls;return m({controls:M}),()=>m({controls:S})}},[e,M]),R.createElement("primitive",Lb({ref:u,object:M,enableDamping:n},c))});var X7e=`#define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}`;class q7e extends dF{constructor(t={}){super(t),this.setValues(t),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(t){t.uniforms.time=this._time,t.uniforms.radius=this._radius,t.uniforms.distort=this._distort,t.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      ${X7e}
      ${t.vertexShader}
    `,t.vertexShader=t.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(t){this._time.value=t}get distort(){return this._distort.value}set distort(t){this._distort.value=t}get radius(){return this._radius.value}set radius(t){this._radius.value=t}}const Y7e=R.forwardRef(({speed:e=1,...t},i)=>{const[r]=R.useState(()=>new q7e);return MF(n=>r&&(r.time=n.clock.elapsedTime*e)),R.createElement("primitive",Lb({object:r,ref:i,attach:"material"},t))});function Z7e(e,t){const i=e+"Geometry";return R.forwardRef(({args:r,children:n,...s},a)=>{const o=R.useRef(null);return R.useImperativeHandle(a,()=>o.current),R.useLayoutEffect(()=>void(t==null?void 0:t(o.current))),R.createElement("mesh",Lb({ref:o},s),R.createElement(i,{attach:"geometry",args:r}),n)})}const Q7e=Z7e("sphere");class K7e extends sl{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${G7e>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}const J7e=e=>new he().setFromSpherical(new RC(e,Math.acos(1-Math.random()*2),Math.random()*2*Math.PI)),$7e=R.forwardRef(({radius:e=100,depth:t=50,count:i=5e3,saturation:r=0,factor:n=4,fade:s=!1,speed:a=1},o)=>{const l=R.useRef(),[c,u,h]=R.useMemo(()=>{const p=[],f=[],v=Array.from({length:i},()=>(.5+.5*Math.random())*n),m=new Rt;let g=e+t;const y=t/i;for(let x=0;x<i;x++)g-=y*Math.random(),p.push(...J7e(g).toArray()),m.setHSL(x/i,r,.9),f.push(m.r,m.g,m.b);return[new Float32Array(p),new Float32Array(f),new Float32Array(v)]},[i,t,n,e,r]);MF(p=>l.current&&(l.current.uniforms.time.value=p.clock.elapsedTime*a));const[d]=R.useState(()=>new K7e);return R.createElement("points",{ref:o},R.createElement("bufferGeometry",null,R.createElement("bufferAttribute",{attach:"attributes-position",args:[c,3]}),R.createElement("bufferAttribute",{attach:"attributes-color",args:[u,3]}),R.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1]})),R.createElement("primitive",{ref:l,object:d,attach:"material",blending:EC,"uniforms-fade-value":s,depthWrite:!1,transparent:!0,vertexColors:!0}))}),eXe=()=>(R.useRef(),j.jsx("div",{className:"fixed top-0 left-0 w-full h-full -z-10",children:j.jsxs(O7e,{camera:{position:[0,0,15]},children:[j.jsx("color",{attach:"background",args:["#1a1a1a"]}),j.jsx("ambientLight",{intensity:.5}),j.jsx("pointLight",{position:[10,10,10],intensity:1}),j.jsx("pointLight",{position:[-10,-10,-10],intensity:.5}),j.jsx(Q7e,{args:[1,100,100],scale:2.5,children:j.jsx(Y7e,{color:"#fbbf24",attach:"material",distort:.4,speed:2,roughness:.2,metalness:.8})}),j.jsx($7e,{radius:100,depth:50,count:3e3,factor:4,saturation:0,fade:!0,speed:1}),j.jsx(W7e,{enableZoom:!1,enablePan:!1,autoRotate:!0,autoRotateSpeed:.5,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2})]})}));function Rb(e){"@babel/helpers - typeof";return Rb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rb(e)}function tXe(e,t){if(Rb(e)!="object"||!e)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var r=i.call(e,t||"default");if(Rb(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function iXe(e){var t=tXe(e,"string");return Rb(t)=="symbol"?t:t+""}function it(e,t,i){return(t=iXe(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function cae(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nR,$X;function rXe(){if($X)return nR;$X=1;var e=function(i,r,n,s,a,o,l,c){if(!i){var u;if(r===void 0)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var h=[n,s,a,o,l,c],d=0;u=new Error(r.replace(/%s/g,function(){return h[d++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}};return nR=e,nR}var nXe=rXe(),qn=cae(nXe),Si=R.createContext(null);function sXe(){qn(!!R.useContext,"useGoogleMap is React hook and requires React version 16.8+");var e=R.useContext(Si);return qn(!!e,"useGoogleMap needs a GoogleMap available up in the tree"),e}function aXe(e,t,i){return Object.keys(e).reduce(function(n,s){return t(n,e[s],s)},i)}function oXe(e,t){Object.keys(e).forEach(i=>t(e[i],i))}function lXe(e,t,i,r){var n={},s=(a,o)=>{var l=i[o];l!==t[o]&&(n[o]=l,a(r,l))};return oXe(e,s),n}function cXe(e,t,i){var r=aXe(i,function(s,a,o){return typeof e[o]=="function"&&s.push(google.maps.event.addListener(t,a,e[o])),s},[]);return r}function uXe(e){google.maps.event.removeListener(e)}function Li(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];e.forEach(uXe)}function Ti(e){var{updaterMap:t,eventMap:i,prevProps:r,nextProps:n,instance:s}=e,a=cXe(n,s,i);return lXe(t,r,n,s),a}var eq={onDblClick:"dblclick",onDragEnd:"dragend",onDragStart:"dragstart",onMapTypeIdChanged:"maptypeid_changed",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseDown:"mousedown",onMouseUp:"mouseup",onRightClick:"rightclick",onTilesLoaded:"tilesloaded",onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onDrag:"drag",onHeadingChanged:"heading_changed",onIdle:"idle",onProjectionChanged:"projection_changed",onResize:"resize",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed"},tq={extraMapTypes(e,t){t.forEach(function(r,n){e.mapTypes.set(String(n),r)})},center(e,t){e.setCenter(t)},clickableIcons(e,t){e.setClickableIcons(t)},heading(e,t){e.setHeading(t)},mapTypeId(e,t){e.setMapTypeId(t)},options(e,t){e.setOptions(t)},streetView(e,t){e.setStreetView(t)},tilt(e,t){e.setTilt(t)},zoom(e,t){e.setZoom(t)}};function hXe(e){var{children:t,options:i,id:r,mapContainerStyle:n,mapContainerClassName:s,center:a,onClick:o,onDblClick:l,onDrag:c,onDragEnd:u,onDragStart:h,onMouseMove:d,onMouseOut:p,onMouseOver:f,onMouseDown:v,onMouseUp:m,onRightClick:g,onCenterChanged:y,onLoad:x,onUnmount:_}=e,[M,S]=R.useState(null),E=R.useRef(null),[A,P]=R.useState(null),[C,D]=R.useState(null),[N,U]=R.useState(null),[I,G]=R.useState(null),[Q,Y]=R.useState(null),[O,V]=R.useState(null),[F,W]=R.useState(null),[ee,ae]=R.useState(null),[K,$]=R.useState(null),[ie,ye]=R.useState(null),[pe,me]=R.useState(null),[ge,xe]=R.useState(null);return R.useEffect(()=>{i&&M!==null&&M.setOptions(i)},[M,i]),R.useEffect(()=>{M!==null&&typeof a<"u"&&M.setCenter(a)},[M,a]),R.useEffect(()=>{M&&l&&(C!==null&&google.maps.event.removeListener(C),D(google.maps.event.addListener(M,"dblclick",l)))},[l]),R.useEffect(()=>{M&&u&&(N!==null&&google.maps.event.removeListener(N),U(google.maps.event.addListener(M,"dragend",u)))},[u]),R.useEffect(()=>{M&&h&&(I!==null&&google.maps.event.removeListener(I),G(google.maps.event.addListener(M,"dragstart",h)))},[h]),R.useEffect(()=>{M&&v&&(Q!==null&&google.maps.event.removeListener(Q),Y(google.maps.event.addListener(M,"mousedown",v)))},[v]),R.useEffect(()=>{M&&d&&(O!==null&&google.maps.event.removeListener(O),V(google.maps.event.addListener(M,"mousemove",d)))},[d]),R.useEffect(()=>{M&&p&&(F!==null&&google.maps.event.removeListener(F),W(google.maps.event.addListener(M,"mouseout",p)))},[p]),R.useEffect(()=>{M&&f&&(ee!==null&&google.maps.event.removeListener(ee),ae(google.maps.event.addListener(M,"mouseover",f)))},[f]),R.useEffect(()=>{M&&m&&(K!==null&&google.maps.event.removeListener(K),$(google.maps.event.addListener(M,"mouseup",m)))},[m]),R.useEffect(()=>{M&&g&&(ie!==null&&google.maps.event.removeListener(ie),ye(google.maps.event.addListener(M,"rightclick",g)))},[g]),R.useEffect(()=>{M&&o&&(pe!==null&&google.maps.event.removeListener(pe),me(google.maps.event.addListener(M,"click",o)))},[o]),R.useEffect(()=>{M&&c&&(ge!==null&&google.maps.event.removeListener(ge),xe(google.maps.event.addListener(M,"drag",c)))},[c]),R.useEffect(()=>{M&&y&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(M,"center_changed",y)))},[o]),R.useEffect(()=>{var te=E.current===null?null:new google.maps.Map(E.current,i);return S(te),te!==null&&x&&x(te),()=>{te!==null&&_&&_(te)}},[]),j.jsx("div",{id:r,ref:E,style:n,className:s,children:j.jsx(Si.Provider,{value:M,children:M!==null?t:null})})}R.memo(hXe);class dXe extends R.PureComponent{constructor(){super(...arguments),it(this,"state",{map:null}),it(this,"registeredEvents",[]),it(this,"mapRef",null),it(this,"getInstance",()=>this.mapRef===null?null:new google.maps.Map(this.mapRef,this.props.options)),it(this,"panTo",t=>{var i=this.getInstance();i&&i.panTo(t)}),it(this,"setMapCallback",()=>{this.state.map!==null&&this.props.onLoad&&this.props.onLoad(this.state.map)}),it(this,"getRef",t=>{this.mapRef=t})}componentDidMount(){var t=this.getInstance();this.registeredEvents=Ti({updaterMap:tq,eventMap:eq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{map:t}},this.setMapCallback)}componentDidUpdate(t){this.state.map!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:tq,eventMap:eq,prevProps:t,nextProps:this.props,instance:this.state.map}))}componentWillUnmount(){this.state.map!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.map),Li(this.registeredEvents))}render(){return j.jsx("div",{id:this.props.id,ref:this.getRef,style:this.props.mapContainerStyle,className:this.props.mapContainerClassName,children:j.jsx(Si.Provider,{value:this.state.map,children:this.state.map!==null?this.props.children:null})})}}function iq(e,t,i,r,n,s,a){try{var o=e[s](a),l=o.value}catch(c){return void i(c)}o.done?t(l):Promise.resolve(l).then(r,n)}function uae(e){return function(){var t=this,i=arguments;return new Promise(function(r,n){var s=e.apply(t,i);function a(l){iq(s,r,n,a,o,"next",l)}function o(l){iq(s,r,n,a,o,"throw",l)}a(void 0)})}}function hae(e){var{googleMapsApiKey:t,googleMapsClientId:i,version:r="weekly",language:n,region:s,libraries:a,channel:o,mapIds:l,authReferrerPolicy:c}=e,u=[];return qn(t&&i||!(t&&i),"You need to specify either googleMapsApiKey or googleMapsClientId for @react-google-maps/api load script to work. You cannot use both at the same time."),t?u.push("key=".concat(t)):i&&u.push("client=".concat(i)),r&&u.push("v=".concat(r)),n&&u.push("language=".concat(n)),s&&u.push("region=".concat(s)),a&&a.length&&u.push("libraries=".concat(a.sort().join(","))),o&&u.push("channel=".concat(o)),l&&l.length&&u.push("map_ids=".concat(l.join(","))),c&&u.push("auth_referrer_policy=".concat(c)),u.push("loading=async"),u.push("callback=initMap"),"https://maps.googleapis.com/maps/api/js?".concat(u.join("&"))}var Pf=typeof document<"u";function dae(e){var{url:t,id:i,nonce:r}=e;return Pf?new Promise(function(s,a){var o=document.getElementById(i),l=window;if(o){var c=o.getAttribute("data-state");if(o.src===t&&c!=="error"){if(c==="ready")return s(i);var u=l.initMap,h=o.onerror;l.initMap=function(){u&&u(),s(i)},o.onerror=function(p){h&&h(p),a(p)};return}else o.remove()}var d=document.createElement("script");d.type="text/javascript",d.src=t,d.id=i,d.async=!0,d.nonce=r||"",d.onerror=function(f){d.setAttribute("data-state","error"),a(f)},l.initMap=function(){d.setAttribute("data-state","ready"),s(i)},document.head.appendChild(d)}).catch(n=>{throw console.error("injectScript error: ",n),n}):Promise.reject(new Error("document is undefined"))}function rq(e){var t=e.href;return t&&(t.indexOf("https://fonts.googleapis.com/css?family=Roboto")===0||t.indexOf("https://fonts.googleapis.com/css?family=Google+Sans+Text")===0)?!0:e.tagName.toLowerCase()==="style"&&e.styleSheet&&e.styleSheet.cssText&&e.styleSheet.cssText.replace(`\r
`,"").indexOf(".gm-style")===0?(e.styleSheet.cssText="",!0):e.tagName.toLowerCase()==="style"&&e.innerHTML&&e.innerHTML.replace(`\r
`,"").indexOf(".gm-style")===0?(e.innerHTML="",!0):e.tagName.toLowerCase()==="style"&&!e.styleSheet&&!e.innerHTML}function pae(){var e=document.getElementsByTagName("head")[0];if(e){var t=e.insertBefore.bind(e);e.insertBefore=function(n,s){return rq(n)||Reflect.apply(t,e,[n,s]),n};var i=e.appendChild.bind(e);e.appendChild=function(n){return rq(n)||Reflect.apply(i,e,[n]),n}}}var p1=!1;function fae(){return j.jsx("div",{children:"Loading..."})}var vz={id:"script-loader",version:"weekly"};class pXe extends R.PureComponent{constructor(){super(...arguments),it(this,"check",null),it(this,"state",{loaded:!1}),it(this,"cleanupCallback",()=>{delete window.google.maps,this.injectScript()}),it(this,"isCleaningUp",uae(function*(){function t(i){if(!p1)i();else if(Pf)var r=window.setInterval(function(){p1||(window.clearInterval(r),i())},1)}return new Promise(t)})),it(this,"cleanup",()=>{p1=!0;var t=document.getElementById(this.props.id);t&&t.parentNode&&t.parentNode.removeChild(t),Array.prototype.slice.call(document.getElementsByTagName("script")).filter(function(r){return typeof r.src=="string"&&r.src.includes("maps.googleapis")}).forEach(function(r){r.parentNode&&r.parentNode.removeChild(r)}),Array.prototype.slice.call(document.getElementsByTagName("link")).filter(function(r){return r.href==="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans"}).forEach(function(r){r.parentNode&&r.parentNode.removeChild(r)}),Array.prototype.slice.call(document.getElementsByTagName("style")).filter(function(r){return r.innerText!==void 0&&r.innerText.length>0&&r.innerText.includes(".gm-")}).forEach(function(r){r.parentNode&&r.parentNode.removeChild(r)})}),it(this,"injectScript",()=>{this.props.preventGoogleFontsLoading&&pae(),qn(!!this.props.id,'LoadScript requires "id" prop to be a string: %s',this.props.id);var t={id:this.props.id,nonce:this.props.nonce,url:hae(this.props)};dae(t).then(()=>{this.props.onLoad&&this.props.onLoad(),this.setState(function(){return{loaded:!0}})}).catch(i=>{this.props.onError&&this.props.onError(i),console.error(`
          There has been an Error with loading Google Maps API script, please check that you provided correct google API key (`.concat(this.props.googleMapsApiKey||"-",") or Client ID (").concat(this.props.googleMapsClientId||"-",`) to <LoadScript />
          Otherwise it is a Network issue.
        `))})}),it(this,"getRef",t=>{this.check=t})}componentDidMount(){if(Pf){if(window.google&&window.google.maps&&!p1){console.error("google api is already presented");return}this.isCleaningUp().then(this.injectScript).catch(function(i){console.error("Error at injecting script after cleaning up: ",i)})}}componentDidUpdate(t){this.props.libraries!==t.libraries&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),Pf&&t.language!==this.props.language&&(this.cleanup(),this.setState(function(){return{loaded:!1}},this.cleanupCallback))}componentWillUnmount(){if(Pf){this.cleanup();var t=()=>{this.check||(delete window.google,p1=!1)};window.setTimeout(t,1),this.props.onUnmount&&this.props.onUnmount()}}render(){return j.jsxs(j.Fragment,{children:[j.jsx("div",{ref:this.getRef}),this.state.loaded?this.props.children:this.props.loadingElement||j.jsx(fae,{})]})}}it(pXe,"defaultProps",vz);function fXe(e,t){if(e==null)return{};var i={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;i[r]=e[r]}return i}function AF(e,t){if(e==null)return{};var i,r,n=fXe(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)i=s[r],t.includes(i)||{}.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var nq;function mae(e){var{id:t=vz.id,version:i=vz.version,nonce:r,googleMapsApiKey:n,googleMapsClientId:s,language:a,region:o,libraries:l,preventGoogleFontsLoading:c,channel:u,mapIds:h,authReferrerPolicy:d}=e,p=R.useRef(!1),[f,v]=R.useState(!1),[m,g]=R.useState(void 0);R.useEffect(function(){return p.current=!0,()=>{p.current=!1}},[]),R.useEffect(function(){Pf&&c&&pae()},[c]),R.useEffect(function(){f&&qn(!!window.google,"useLoadScript was marked as loaded, but window.google is not present. Something went wrong.")},[f]);var y=hae({version:i,googleMapsApiKey:n,googleMapsClientId:s,language:a,region:o,libraries:l,channel:u,mapIds:h,authReferrerPolicy:d});R.useEffect(function(){if(!Pf)return;function M(){p.current&&(v(!0),nq=y)}if(window.google&&window.google.maps&&nq===y){M();return}dae({id:t,url:y,nonce:r}).then(M).catch(function(E){p.current&&g(E),console.warn(`
        There has been an Error with loading Google Maps API script, please check that you provided correct google API key (`.concat(n||"-",") or Client ID (").concat(s||"-",`)
        Otherwise it is a Network issue.
      `)),console.error(E)})},[t,y,r]);var x=R.useRef(void 0);return R.useEffect(function(){x.current&&l!==x.current&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),x.current=l},[l]),{isLoaded:f,loadError:m,url:y}}var mXe=["loadingElement","onLoad","onError","onUnmount","children"],gXe=j.jsx(fae,{});function vXe(e){var{loadingElement:t,onLoad:i,onError:r,onUnmount:n,children:s}=e,a=AF(e,mXe),{isLoaded:o,loadError:l}=mae(a);return R.useEffect(function(){o&&typeof i=="function"&&i()},[o,i]),R.useEffect(function(){l&&typeof r=="function"&&r(l)},[l,r]),R.useEffect(function(){return()=>{n&&n()}},[n]),o?s:t||gXe}R.memo(vXe);var sq;(function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"})(sq||(sq={}));function aq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function OC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?aq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var oq={},lq={options(e,t){e.setOptions(t)}};function yXe(e){var{options:t,onLoad:i,onUnmount:r}=e,n=R.useContext(Si),[s,a]=R.useState(null);return R.useEffect(()=>{s!==null&&s.setMap(n)},[n]),R.useEffect(()=>{t&&s!==null&&s.setOptions(t)},[s,t]),R.useEffect(()=>{var o=new google.maps.TrafficLayer(OC(OC({},t),{},{map:n}));return a(o),i&&i(o),()=>{s!==null&&(r&&r(s),s.setMap(null))}},[]),null}R.memo(yXe);class xXe extends R.PureComponent{constructor(){super(...arguments),it(this,"state",{trafficLayer:null}),it(this,"setTrafficLayerCallback",()=>{this.state.trafficLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.trafficLayer)}),it(this,"registeredEvents",[])}componentDidMount(){var t=new google.maps.TrafficLayer(OC(OC({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:lq,eventMap:oq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{trafficLayer:t}},this.setTrafficLayerCallback)}componentDidUpdate(t){this.state.trafficLayer!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:lq,eventMap:oq,prevProps:t,nextProps:this.props,instance:this.state.trafficLayer}))}componentWillUnmount(){this.state.trafficLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.trafficLayer),Li(this.registeredEvents),this.state.trafficLayer.setMap(null))}render(){return null}}it(xXe,"contextType",Si);function bXe(e){var{onLoad:t,onUnmount:i}=e,r=R.useContext(Si),[n,s]=R.useState(null);return R.useEffect(()=>{n!==null&&n.setMap(r)},[r]),R.useEffect(()=>{var a=new google.maps.BicyclingLayer;return s(a),a.setMap(r),t&&t(a),()=>{a!==null&&(i&&i(a),a.setMap(null))}},[]),null}R.memo(bXe);class wXe extends R.PureComponent{constructor(){super(...arguments),it(this,"state",{bicyclingLayer:null}),it(this,"setBicyclingLayerCallback",()=>{this.state.bicyclingLayer!==null&&(this.state.bicyclingLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.bicyclingLayer))})}componentDidMount(){var t=new google.maps.BicyclingLayer;this.setState(()=>({bicyclingLayer:t}),this.setBicyclingLayerCallback)}componentWillUnmount(){this.state.bicyclingLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.bicyclingLayer),this.state.bicyclingLayer.setMap(null))}render(){return null}}it(wXe,"contextType",Si);function _Xe(e){var{onLoad:t,onUnmount:i}=e,r=R.useContext(Si),[n,s]=R.useState(null);return R.useEffect(()=>{n!==null&&n.setMap(r)},[r]),R.useEffect(()=>{var a=new google.maps.TransitLayer;return s(a),a.setMap(r),t&&t(a),()=>{n!==null&&(i&&i(n),n.setMap(null))}},[]),null}R.memo(_Xe);class SXe extends R.PureComponent{constructor(){super(...arguments),it(this,"state",{transitLayer:null}),it(this,"setTransitLayerCallback",()=>{this.state.transitLayer!==null&&(this.state.transitLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.transitLayer))})}componentDidMount(){var t=new google.maps.TransitLayer;this.setState(function(){return{transitLayer:t}},this.setTransitLayerCallback)}componentWillUnmount(){this.state.transitLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.transitLayer),this.state.transitLayer.setMap(null))}render(){return null}}it(SXe,"contextType",Si);function cq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function NC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var uq={onCircleComplete:"circlecomplete",onMarkerComplete:"markercomplete",onOverlayComplete:"overlaycomplete",onPolygonComplete:"polygoncomplete",onPolylineComplete:"polylinecomplete",onRectangleComplete:"rectanglecomplete"},hq={drawingMode(e,t){e.setDrawingMode(t)},options(e,t){e.setOptions(t)}};function MXe(e){var{options:t,drawingMode:i,onCircleComplete:r,onMarkerComplete:n,onOverlayComplete:s,onPolygonComplete:a,onPolylineComplete:o,onRectangleComplete:l,onLoad:c,onUnmount:u}=e,h=R.useContext(Si),[d,p]=R.useState(null),[f,v]=R.useState(null),[m,g]=R.useState(null),[y,x]=R.useState(null),[_,M]=R.useState(null),[S,E]=R.useState(null),[A,P]=R.useState(null);return R.useEffect(()=>{d!==null&&d.setMap(h)},[h]),R.useEffect(()=>{t&&d!==null&&d.setOptions(t)},[d,t]),R.useEffect(()=>{d!==null&&d.setDrawingMode(i??null)},[d,i]),R.useEffect(()=>{d&&r&&(f!==null&&google.maps.event.removeListener(f),v(google.maps.event.addListener(d,"circlecomplete",r)))},[d,r]),R.useEffect(()=>{d&&n&&(m!==null&&google.maps.event.removeListener(m),g(google.maps.event.addListener(d,"markercomplete",n)))},[d,n]),R.useEffect(()=>{d&&s&&(y!==null&&google.maps.event.removeListener(y),x(google.maps.event.addListener(d,"overlaycomplete",s)))},[d,s]),R.useEffect(()=>{d&&a&&(_!==null&&google.maps.event.removeListener(_),M(google.maps.event.addListener(d,"polygoncomplete",a)))},[d,a]),R.useEffect(()=>{d&&o&&(S!==null&&google.maps.event.removeListener(S),E(google.maps.event.addListener(d,"polylinecomplete",o)))},[d,o]),R.useEffect(()=>{d&&l&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(d,"rectanglecomplete",l)))},[d,l]),R.useEffect(()=>{qn(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing);var C=new google.maps.drawing.DrawingManager(NC(NC({},t),{},{map:h}));return i&&C.setDrawingMode(i),r&&v(google.maps.event.addListener(C,"circlecomplete",r)),n&&g(google.maps.event.addListener(C,"markercomplete",n)),s&&x(google.maps.event.addListener(C,"overlaycomplete",s)),a&&M(google.maps.event.addListener(C,"polygoncomplete",a)),o&&E(google.maps.event.addListener(C,"polylinecomplete",o)),l&&P(google.maps.event.addListener(C,"rectanglecomplete",l)),p(C),c&&c(C),()=>{d!==null&&(f&&google.maps.event.removeListener(f),m&&google.maps.event.removeListener(m),y&&google.maps.event.removeListener(y),_&&google.maps.event.removeListener(_),S&&google.maps.event.removeListener(S),A&&google.maps.event.removeListener(A),u&&u(d),d.setMap(null))}},[]),null}R.memo(MXe);class EXe extends R.PureComponent{constructor(t){super(t),it(this,"registeredEvents",[]),it(this,"state",{drawingManager:null}),it(this,"setDrawingManagerCallback",()=>{this.state.drawingManager!==null&&this.props.onLoad&&this.props.onLoad(this.state.drawingManager)}),qn(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing)}componentDidMount(){var t=new google.maps.drawing.DrawingManager(NC(NC({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:hq,eventMap:uq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{drawingManager:t}},this.setDrawingManagerCallback)}componentDidUpdate(t){this.state.drawingManager!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:hq,eventMap:uq,prevProps:t,nextProps:this.props,instance:this.state.drawingManager}))}componentWillUnmount(){this.state.drawingManager!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.drawingManager),Li(this.registeredEvents),this.state.drawingManager.setMap(null))}render(){return null}}it(EXe,"contextType",Si);function dq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Gv(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?dq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var pq={onAnimationChanged:"animation_changed",onClick:"click",onClickableChanged:"clickable_changed",onCursorChanged:"cursor_changed",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDraggableChanged:"draggable_changed",onDragStart:"dragstart",onFlatChanged:"flat_changed",onIconChanged:"icon_changed",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPositionChanged:"position_changed",onRightClick:"rightclick",onShapeChanged:"shape_changed",onTitleChanged:"title_changed",onVisibleChanged:"visible_changed",onZindexChanged:"zindex_changed"},fq={animation(e,t){e.setAnimation(t)},clickable(e,t){e.setClickable(t)},cursor(e,t){e.setCursor(t)},draggable(e,t){e.setDraggable(t)},icon(e,t){e.setIcon(t)},label(e,t){e.setLabel(t)},map(e,t){e.setMap(t)},opacity(e,t){e.setOpacity(t)},options(e,t){e.setOptions(t)},position(e,t){e.setPosition(t)},shape(e,t){e.setShape(t)},title(e,t){e.setTitle(t)},visible(e,t){e.setVisible(t)},zIndex(e,t){e.setZIndex(t)}},zC={};function AXe(e){var{position:t,options:i,clusterer:r,noClustererRedraw:n,children:s,draggable:a,visible:o,animation:l,clickable:c,cursor:u,icon:h,label:d,opacity:p,shape:f,title:v,zIndex:m,onClick:g,onDblClick:y,onDrag:x,onDragEnd:_,onDragStart:M,onMouseOut:S,onMouseOver:E,onMouseUp:A,onMouseDown:P,onRightClick:C,onClickableChanged:D,onCursorChanged:N,onAnimationChanged:U,onDraggableChanged:I,onFlatChanged:G,onIconChanged:Q,onPositionChanged:Y,onShapeChanged:O,onTitleChanged:V,onVisibleChanged:F,onZindexChanged:W,onLoad:ee,onUnmount:ae}=e,K=R.useContext(Si),[$,ie]=R.useState(null),[ye,pe]=R.useState(null),[me,ge]=R.useState(null),[xe,te]=R.useState(null),[we,Ce]=R.useState(null),[Se,Re]=R.useState(null),[Xe,Be]=R.useState(null),[Fe,dt]=R.useState(null),[se,z]=R.useState(null),[X,ce]=R.useState(null),[Ee,q]=R.useState(null),[Ye,et]=R.useState(null),[ke,_e]=R.useState(null),[at,Ve]=R.useState(null),[mt,pt]=R.useState(null),[st,ue]=R.useState(null),[ze,ut]=R.useState(null),[de,Ne]=R.useState(null),[oe,He]=R.useState(null),[Ae,tt]=R.useState(null),[ct,Dt]=R.useState(null),[ai,Wt]=R.useState(null);R.useEffect(()=>{$!==null&&$.setMap(K)},[K]),R.useEffect(()=>{typeof i<"u"&&$!==null&&$.setOptions(i)},[$,i]),R.useEffect(()=>{typeof a<"u"&&$!==null&&$.setDraggable(a)},[$,a]),R.useEffect(()=>{t&&$!==null&&$.setPosition(t)},[$,t]),R.useEffect(()=>{typeof o<"u"&&$!==null&&$.setVisible(o)},[$,o]),R.useEffect(()=>{$==null||$.setAnimation(l)},[$,l]),R.useEffect(()=>{$&&c!==void 0&&$.setClickable(c)},[$,c]),R.useEffect(()=>{$&&u!==void 0&&$.setCursor(u)},[$,u]),R.useEffect(()=>{$&&h!==void 0&&$.setIcon(h)},[$,h]),R.useEffect(()=>{$&&d!==void 0&&$.setLabel(d)},[$,d]),R.useEffect(()=>{$&&p!==void 0&&$.setOpacity(p)},[$,p]),R.useEffect(()=>{$&&f!==void 0&&$.setShape(f)},[$,f]),R.useEffect(()=>{$&&v!==void 0&&$.setTitle(v)},[$,v]),R.useEffect(()=>{$&&m!==void 0&&$.setZIndex(m)},[$,m]),R.useEffect(()=>{$&&y&&(ye!==null&&google.maps.event.removeListener(ye),pe(google.maps.event.addListener($,"dblclick",y)))},[y]),R.useEffect(()=>{$&&_&&(me!==null&&google.maps.event.removeListener(me),ge(google.maps.event.addListener($,"dragend",_)))},[_]),R.useEffect(()=>{$&&M&&(xe!==null&&google.maps.event.removeListener(xe),te(google.maps.event.addListener($,"dragstart",M)))},[M]),R.useEffect(()=>{$&&P&&(we!==null&&google.maps.event.removeListener(we),Ce(google.maps.event.addListener($,"mousedown",P)))},[P]),R.useEffect(()=>{$&&S&&(Se!==null&&google.maps.event.removeListener(Se),Re(google.maps.event.addListener($,"mouseout",S)))},[S]),R.useEffect(()=>{$&&E&&(Xe!==null&&google.maps.event.removeListener(Xe),Be(google.maps.event.addListener($,"mouseover",E)))},[E]),R.useEffect(()=>{$&&A&&(Fe!==null&&google.maps.event.removeListener(Fe),dt(google.maps.event.addListener($,"mouseup",A)))},[A]),R.useEffect(()=>{$&&C&&(se!==null&&google.maps.event.removeListener(se),z(google.maps.event.addListener($,"rightclick",C)))},[C]),R.useEffect(()=>{$&&g&&(X!==null&&google.maps.event.removeListener(X),ce(google.maps.event.addListener($,"click",g)))},[g]),R.useEffect(()=>{$&&x&&(Ee!==null&&google.maps.event.removeListener(Ee),q(google.maps.event.addListener($,"drag",x)))},[x]),R.useEffect(()=>{$&&D&&(Ye!==null&&google.maps.event.removeListener(Ye),et(google.maps.event.addListener($,"clickable_changed",D)))},[D]),R.useEffect(()=>{$&&N&&(ke!==null&&google.maps.event.removeListener(ke),_e(google.maps.event.addListener($,"cursor_changed",N)))},[N]),R.useEffect(()=>{$&&U&&(at!==null&&google.maps.event.removeListener(at),Ve(google.maps.event.addListener($,"animation_changed",U)))},[U]),R.useEffect(()=>{$&&I&&(mt!==null&&google.maps.event.removeListener(mt),pt(google.maps.event.addListener($,"draggable_changed",I)))},[I]),R.useEffect(()=>{$&&G&&(st!==null&&google.maps.event.removeListener(st),ue(google.maps.event.addListener($,"flat_changed",G)))},[G]),R.useEffect(()=>{$&&Q&&(ze!==null&&google.maps.event.removeListener(ze),ut(google.maps.event.addListener($,"icon_changed",Q)))},[Q]),R.useEffect(()=>{$&&Y&&(de!==null&&google.maps.event.removeListener(de),Ne(google.maps.event.addListener($,"position_changed",Y)))},[Y]),R.useEffect(()=>{$&&O&&(oe!==null&&google.maps.event.removeListener(oe),He(google.maps.event.addListener($,"shape_changed",O)))},[O]),R.useEffect(()=>{$&&V&&(Ae!==null&&google.maps.event.removeListener(Ae),tt(google.maps.event.addListener($,"title_changed",V)))},[V]),R.useEffect(()=>{$&&F&&(ct!==null&&google.maps.event.removeListener(ct),Dt(google.maps.event.addListener($,"visible_changed",F)))},[F]),R.useEffect(()=>{$&&W&&(ai!==null&&google.maps.event.removeListener(ai),Wt(google.maps.event.addListener($,"zindex_changed",W)))},[W]),R.useEffect(()=>{var Qt=Gv(Gv(Gv({},i||zC),r?zC:{map:K}),{},{position:t}),Ot=new google.maps.Marker(Qt);return r?r.addMarker(Ot,!!n):Ot.setMap(K),t&&Ot.setPosition(t),typeof o<"u"&&Ot.setVisible(o),typeof a<"u"&&Ot.setDraggable(a),typeof c<"u"&&Ot.setClickable(c),typeof u=="string"&&Ot.setCursor(u),h&&Ot.setIcon(h),typeof d<"u"&&Ot.setLabel(d),typeof p<"u"&&Ot.setOpacity(p),f&&Ot.setShape(f),typeof v=="string"&&Ot.setTitle(v),typeof m=="number"&&Ot.setZIndex(m),y&&pe(google.maps.event.addListener(Ot,"dblclick",y)),_&&ge(google.maps.event.addListener(Ot,"dragend",_)),M&&te(google.maps.event.addListener(Ot,"dragstart",M)),P&&Ce(google.maps.event.addListener(Ot,"mousedown",P)),S&&Re(google.maps.event.addListener(Ot,"mouseout",S)),E&&Be(google.maps.event.addListener(Ot,"mouseover",E)),A&&dt(google.maps.event.addListener(Ot,"mouseup",A)),C&&z(google.maps.event.addListener(Ot,"rightclick",C)),g&&ce(google.maps.event.addListener(Ot,"click",g)),x&&q(google.maps.event.addListener(Ot,"drag",x)),D&&et(google.maps.event.addListener(Ot,"clickable_changed",D)),N&&_e(google.maps.event.addListener(Ot,"cursor_changed",N)),U&&Ve(google.maps.event.addListener(Ot,"animation_changed",U)),I&&pt(google.maps.event.addListener(Ot,"draggable_changed",I)),G&&ue(google.maps.event.addListener(Ot,"flat_changed",G)),Q&&ut(google.maps.event.addListener(Ot,"icon_changed",Q)),Y&&Ne(google.maps.event.addListener(Ot,"position_changed",Y)),O&&He(google.maps.event.addListener(Ot,"shape_changed",O)),V&&tt(google.maps.event.addListener(Ot,"title_changed",V)),F&&Dt(google.maps.event.addListener(Ot,"visible_changed",F)),W&&Wt(google.maps.event.addListener(Ot,"zindex_changed",W)),ie(Ot),ee&&ee(Ot),()=>{ye!==null&&google.maps.event.removeListener(ye),me!==null&&google.maps.event.removeListener(me),xe!==null&&google.maps.event.removeListener(xe),we!==null&&google.maps.event.removeListener(we),Se!==null&&google.maps.event.removeListener(Se),Xe!==null&&google.maps.event.removeListener(Xe),Fe!==null&&google.maps.event.removeListener(Fe),se!==null&&google.maps.event.removeListener(se),X!==null&&google.maps.event.removeListener(X),Ye!==null&&google.maps.event.removeListener(Ye),ke!==null&&google.maps.event.removeListener(ke),at!==null&&google.maps.event.removeListener(at),mt!==null&&google.maps.event.removeListener(mt),st!==null&&google.maps.event.removeListener(st),ze!==null&&google.maps.event.removeListener(ze),de!==null&&google.maps.event.removeListener(de),Ae!==null&&google.maps.event.removeListener(Ae),ct!==null&&google.maps.event.removeListener(ct),ai!==null&&google.maps.event.removeListener(ai),ae&&ae(Ot),r?r.removeMarker(Ot,!!n):Ot&&Ot.setMap(null)}},[]);var Ni=R.useMemo(()=>s?R.Children.map(s,Qt=>{if(!R.isValidElement(Qt))return Qt;var Ot=Qt;return R.cloneElement(Ot,{anchor:$})}):null,[s,$]);return j.jsx(j.Fragment,{children:Ni})||null}R.memo(AXe);class gae extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[])}componentDidMount(){var t=this;return uae(function*(){var i=Gv(Gv(Gv({},t.props.options||zC),t.props.clusterer?zC:{map:t.context}),{},{position:t.props.position});t.marker=new google.maps.Marker(i),t.props.clusterer?t.props.clusterer.addMarker(t.marker,!!t.props.noClustererRedraw):t.marker.setMap(t.context),t.registeredEvents=Ti({updaterMap:fq,eventMap:pq,prevProps:{},nextProps:t.props,instance:t.marker}),t.props.onLoad&&t.props.onLoad(t.marker)})()}componentDidUpdate(t){this.marker&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:fq,eventMap:pq,prevProps:t,nextProps:this.props,instance:this.marker}))}componentWillUnmount(){this.marker&&(this.props.onUnmount&&this.props.onUnmount(this.marker),Li(this.registeredEvents),this.props.clusterer?this.props.clusterer.removeMarker(this.marker,!!this.props.noClustererRedraw):this.marker&&this.marker.setMap(null))}render(){var t=this.props.children?R.Children.map(this.props.children,i=>{if(!R.isValidElement(i))return i;var r=i;return R.cloneElement(r,{anchor:this.marker})}):null;return t||null}}it(gae,"contextType",Si);var CXe=function(){function e(t,i){t.getClusterer().extend(e,google.maps.OverlayView),this.cluster=t,this.clusterClassName=this.cluster.getClusterer().getClusterClass(),this.className=this.clusterClassName,this.styles=i,this.center=void 0,this.div=null,this.sums=null,this.visible=!1,this.boundsChangedListener=null,this.url="",this.height=0,this.width=0,this.anchorText=[0,0],this.anchorIcon=[0,0],this.textColor="black",this.textSize=11,this.textDecoration="none",this.fontWeight="bold",this.fontStyle="normal",this.fontFamily="Arial,sans-serif",this.backgroundPosition="0 0",this.cMouseDownInCluster=null,this.cDraggingMapByCluster=null,this.timeOut=null,this.setMap(t.getMap()),this.onBoundsChanged=this.onBoundsChanged.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onAdd=this.onAdd.bind(this),this.onRemove=this.onRemove.bind(this),this.draw=this.draw.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.useStyle=this.useStyle.bind(this),this.setCenter=this.setCenter.bind(this),this.getPosFromLatLng=this.getPosFromLatLng.bind(this)}return e.prototype.onBoundsChanged=function(){this.cDraggingMapByCluster=this.cMouseDownInCluster},e.prototype.onMouseDown=function(){this.cMouseDownInCluster=!0,this.cDraggingMapByCluster=!1},e.prototype.onClick=function(t){if(this.cMouseDownInCluster=!1,!this.cDraggingMapByCluster){var i=this.cluster.getClusterer();if(google.maps.event.trigger(i,"click",this.cluster),google.maps.event.trigger(i,"clusterclick",this.cluster),i.getZoomOnClick()){var r=i.getMaxZoom(),n=this.cluster.getBounds(),s=i.getMap();s!==null&&"fitBounds"in s&&s.fitBounds(n),this.timeOut=window.setTimeout(function(){var a=i.getMap();if(a!==null){"fitBounds"in a&&a.fitBounds(n);var o=a.getZoom()||0;r!==null&&o>r&&a.setZoom(r+1)}},100)}t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}},e.prototype.onMouseOver=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseover",this.cluster)},e.prototype.onMouseOut=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseout",this.cluster)},e.prototype.onAdd=function(){var t;this.div=document.createElement("div"),this.div.className=this.className,this.visible&&this.show(),(t=this.getPanes())===null||t===void 0||t.overlayMouseTarget.appendChild(this.div);var i=this.getMap();i!==null&&(this.boundsChangedListener=google.maps.event.addListener(i,"bounds_changed",this.onBoundsChanged),this.div.addEventListener("mousedown",this.onMouseDown),this.div.addEventListener("click",this.onClick),this.div.addEventListener("mouseover",this.onMouseOver),this.div.addEventListener("mouseout",this.onMouseOut))},e.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.hide(),this.boundsChangedListener!==null&&google.maps.event.removeListener(this.boundsChangedListener),this.div.removeEventListener("mousedown",this.onMouseDown),this.div.removeEventListener("click",this.onClick),this.div.removeEventListener("mouseover",this.onMouseOver),this.div.removeEventListener("mouseout",this.onMouseOut),this.div.parentNode.removeChild(this.div),this.timeOut!==null&&(window.clearTimeout(this.timeOut),this.timeOut=null),this.div=null)},e.prototype.draw=function(){if(this.visible&&this.div!==null&&this.center){var t=this.getPosFromLatLng(this.center);this.div.style.top=t!==null?"".concat(t.y,"px"):"0",this.div.style.left=t!==null?"".concat(t.x,"px"):"0"}},e.prototype.hide=function(){this.div&&(this.div.style.display="none"),this.visible=!1},e.prototype.show=function(){var t,i,r,n,s,a;if(this.div&&this.center){var o=this.sums===null||typeof this.sums.title>"u"||this.sums.title===""?this.cluster.getClusterer().getTitle():this.sums.title,l=this.backgroundPosition.split(" "),c=parseInt(((t=l[0])===null||t===void 0?void 0:t.replace(/^\s+|\s+$/g,""))||"0",10),u=parseInt(((i=l[1])===null||i===void 0?void 0:i.replace(/^\s+|\s+$/g,""))||"0",10),h=this.getPosFromLatLng(this.center);this.div.className=this.className,this.div.setAttribute("style","cursor: pointer; position: absolute; top: ".concat(h!==null?"".concat(h.y,"px"):"0","; left: ").concat(h!==null?"".concat(h.x,"px"):"0","; width: ").concat(this.width,"px; height: ").concat(this.height,"px; "));var d=document.createElement("img");d.alt=o,d.src=this.url,d.width=this.width,d.height=this.height,d.setAttribute("style","position: absolute; top: ".concat(u,"px; left: ").concat(c,"px")),this.cluster.getClusterer().enableRetinaIcons||(d.style.clip="rect(-".concat(u,"px, -").concat(c+this.width,"px, -").concat(u+this.height,", -").concat(c,")"));var p=document.createElement("div");p.setAttribute("style","position: absolute; top: ".concat(this.anchorText[0],"px; left: ").concat(this.anchorText[1],"px; color: ").concat(this.textColor,"; font-size: ").concat(this.textSize,"px; font-family: ").concat(this.fontFamily,"; font-weight: ").concat(this.fontWeight,"; fontStyle: ").concat(this.fontStyle,"; text-decoration: ").concat(this.textDecoration,"; text-align: center; width: ").concat(this.width,"px; line-height: ").concat(this.height,"px")),!((r=this.sums)===null||r===void 0)&&r.text&&(p.innerText="".concat((n=this.sums)===null||n===void 0?void 0:n.text)),!((s=this.sums)===null||s===void 0)&&s.html&&(p.innerHTML="".concat((a=this.sums)===null||a===void 0?void 0:a.html)),this.div.innerHTML="",this.div.appendChild(d),this.div.appendChild(p),this.div.title=o,this.div.style.display=""}this.visible=!0},e.prototype.useStyle=function(t){this.sums=t;var i=this.cluster.getClusterer().getStyles(),r=i[Math.min(i.length-1,Math.max(0,t.index-1))];r&&(this.url=r.url,this.height=r.height,this.width=r.width,r.className&&(this.className="".concat(this.clusterClassName," ").concat(r.className)),this.anchorText=r.anchorText||[0,0],this.anchorIcon=r.anchorIcon||[this.height/2,this.width/2],this.textColor=r.textColor||"black",this.textSize=r.textSize||11,this.textDecoration=r.textDecoration||"none",this.fontWeight=r.fontWeight||"bold",this.fontStyle=r.fontStyle||"normal",this.fontFamily=r.fontFamily||"Arial,sans-serif",this.backgroundPosition=r.backgroundPosition||"0 0")},e.prototype.setCenter=function(t){this.center=t},e.prototype.getPosFromLatLng=function(t){var i=this.getProjection().fromLatLngToDivPixel(t);return i!==null&&(i.x-=this.anchorIcon[1],i.y-=this.anchorIcon[0]),i},e}(),TXe=function(){function e(t){this.markerClusterer=t,this.map=this.markerClusterer.getMap(),this.gridSize=this.markerClusterer.getGridSize(),this.minClusterSize=this.markerClusterer.getMinimumClusterSize(),this.averageCenter=this.markerClusterer.getAverageCenter(),this.markers=[],this.center=void 0,this.bounds=null,this.clusterIcon=new CXe(this,this.markerClusterer.getStyles()),this.getSize=this.getSize.bind(this),this.getMarkers=this.getMarkers.bind(this),this.getCenter=this.getCenter.bind(this),this.getMap=this.getMap.bind(this),this.getClusterer=this.getClusterer.bind(this),this.getBounds=this.getBounds.bind(this),this.remove=this.remove.bind(this),this.addMarker=this.addMarker.bind(this),this.isMarkerInClusterBounds=this.isMarkerInClusterBounds.bind(this),this.calculateBounds=this.calculateBounds.bind(this),this.updateIcon=this.updateIcon.bind(this),this.isMarkerAlreadyAdded=this.isMarkerAlreadyAdded.bind(this)}return e.prototype.getSize=function(){return this.markers.length},e.prototype.getMarkers=function(){return this.markers},e.prototype.getCenter=function(){return this.center},e.prototype.getMap=function(){return this.map},e.prototype.getClusterer=function(){return this.markerClusterer},e.prototype.getBounds=function(){for(var t=new google.maps.LatLngBounds(this.center,this.center),i=this.getMarkers(),r=0,n=i;r<n.length;r++){var s=n[r],a=s.getPosition();a&&t.extend(a)}return t},e.prototype.remove=function(){this.clusterIcon.setMap(null),this.markers=[],delete this.markers},e.prototype.addMarker=function(t){var i;if(this.isMarkerAlreadyAdded(t))return!1;if(this.center){if(this.averageCenter){var r=t.getPosition();if(r){var n=this.markers.length+1;this.center=new google.maps.LatLng((this.center.lat()*(n-1)+r.lat())/n,(this.center.lng()*(n-1)+r.lng())/n),this.calculateBounds()}}}else{var r=t.getPosition();r&&(this.center=r,this.calculateBounds())}t.isAdded=!0,this.markers.push(t);var s=this.markers.length,a=this.markerClusterer.getMaxZoom(),o=(i=this.map)===null||i===void 0?void 0:i.getZoom();if(a!==null&&typeof o<"u"&&o>a)t.getMap()!==this.map&&t.setMap(this.map);else if(s<this.minClusterSize)t.getMap()!==this.map&&t.setMap(this.map);else if(s===this.minClusterSize)for(var l=0,c=this.markers;l<c.length;l++){var u=c[l];u.setMap(null)}else t.setMap(null);return!0},e.prototype.isMarkerInClusterBounds=function(t){if(this.bounds!==null){var i=t.getPosition();if(i)return this.bounds.contains(i)}return!1},e.prototype.calculateBounds=function(){this.bounds=this.markerClusterer.getExtendedBounds(new google.maps.LatLngBounds(this.center,this.center))},e.prototype.updateIcon=function(){var t,i=this.markers.length,r=this.markerClusterer.getMaxZoom(),n=(t=this.map)===null||t===void 0?void 0:t.getZoom();if(r!==null&&typeof n<"u"&&n>r){this.clusterIcon.hide();return}if(i<this.minClusterSize){this.clusterIcon.hide();return}this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.useStyle(this.markerClusterer.getCalculator()(this.markers,this.markerClusterer.getStyles().length)),this.clusterIcon.show()},e.prototype.isMarkerAlreadyAdded=function(t){if(this.markers.includes)return this.markers.includes(t);for(var i=0;i<this.markers.length;i++)if(t===this.markers[i])return!0;return!1},e}();function PXe(e,t){var i=e.length,r=i.toString().length,n=Math.min(r,t);return{text:i.toString(),index:n,title:""}}var DXe=2e3,LXe=500,RXe="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",IXe="png",OXe=[53,56,66,78,90],NXe="cluster",vae=function(){function e(t,i,r){i===void 0&&(i=[]),r===void 0&&(r={}),this.getMinimumClusterSize=this.getMinimumClusterSize.bind(this),this.setMinimumClusterSize=this.setMinimumClusterSize.bind(this),this.getEnableRetinaIcons=this.getEnableRetinaIcons.bind(this),this.setEnableRetinaIcons=this.setEnableRetinaIcons.bind(this),this.addToClosestCluster=this.addToClosestCluster.bind(this),this.getImageExtension=this.getImageExtension.bind(this),this.setImageExtension=this.setImageExtension.bind(this),this.getExtendedBounds=this.getExtendedBounds.bind(this),this.getAverageCenter=this.getAverageCenter.bind(this),this.setAverageCenter=this.setAverageCenter.bind(this),this.getTotalClusters=this.getTotalClusters.bind(this),this.fitMapToMarkers=this.fitMapToMarkers.bind(this),this.getIgnoreHidden=this.getIgnoreHidden.bind(this),this.setIgnoreHidden=this.setIgnoreHidden.bind(this),this.getClusterClass=this.getClusterClass.bind(this),this.setClusterClass=this.setClusterClass.bind(this),this.getTotalMarkers=this.getTotalMarkers.bind(this),this.getZoomOnClick=this.getZoomOnClick.bind(this),this.setZoomOnClick=this.setZoomOnClick.bind(this),this.getBatchSizeIE=this.getBatchSizeIE.bind(this),this.setBatchSizeIE=this.setBatchSizeIE.bind(this),this.createClusters=this.createClusters.bind(this),this.onZoomChanged=this.onZoomChanged.bind(this),this.getImageSizes=this.getImageSizes.bind(this),this.setImageSizes=this.setImageSizes.bind(this),this.getCalculator=this.getCalculator.bind(this),this.setCalculator=this.setCalculator.bind(this),this.removeMarkers=this.removeMarkers.bind(this),this.resetViewport=this.resetViewport.bind(this),this.getImagePath=this.getImagePath.bind(this),this.setImagePath=this.setImagePath.bind(this),this.pushMarkerTo=this.pushMarkerTo.bind(this),this.removeMarker=this.removeMarker.bind(this),this.clearMarkers=this.clearMarkers.bind(this),this.setupStyles=this.setupStyles.bind(this),this.getGridSize=this.getGridSize.bind(this),this.setGridSize=this.setGridSize.bind(this),this.getClusters=this.getClusters.bind(this),this.getMaxZoom=this.getMaxZoom.bind(this),this.setMaxZoom=this.setMaxZoom.bind(this),this.getMarkers=this.getMarkers.bind(this),this.addMarkers=this.addMarkers.bind(this),this.getStyles=this.getStyles.bind(this),this.setStyles=this.setStyles.bind(this),this.addMarker=this.addMarker.bind(this),this.onRemove=this.onRemove.bind(this),this.getTitle=this.getTitle.bind(this),this.setTitle=this.setTitle.bind(this),this.repaint=this.repaint.bind(this),this.onIdle=this.onIdle.bind(this),this.redraw=this.redraw.bind(this),this.onAdd=this.onAdd.bind(this),this.draw=this.draw.bind(this),this.extend=this.extend.bind(this),this.extend(e,google.maps.OverlayView),this.markers=[],this.clusters=[],this.listeners=[],this.activeMap=null,this.ready=!1,this.gridSize=r.gridSize||60,this.minClusterSize=r.minimumClusterSize||2,this.maxZoom=r.maxZoom||null,this.styles=r.styles||[],this.title=r.title||"",this.zoomOnClick=!0,r.zoomOnClick!==void 0&&(this.zoomOnClick=r.zoomOnClick),this.averageCenter=!1,r.averageCenter!==void 0&&(this.averageCenter=r.averageCenter),this.ignoreHidden=!1,r.ignoreHidden!==void 0&&(this.ignoreHidden=r.ignoreHidden),this.enableRetinaIcons=!1,r.enableRetinaIcons!==void 0&&(this.enableRetinaIcons=r.enableRetinaIcons),this.imagePath=r.imagePath||RXe,this.imageExtension=r.imageExtension||IXe,this.imageSizes=r.imageSizes||OXe,this.calculator=r.calculator||PXe,this.batchSize=r.batchSize||DXe,this.batchSizeIE=r.batchSizeIE||LXe,this.clusterClass=r.clusterClass||NXe,navigator.userAgent.toLowerCase().indexOf("msie")!==-1&&(this.batchSize=this.batchSizeIE),this.timerRefStatic=null,this.setupStyles(),this.addMarkers(i,!0),this.setMap(t)}return e.prototype.onZoomChanged=function(){var t,i;this.resetViewport(!1),(((t=this.getMap())===null||t===void 0?void 0:t.getZoom())===(this.get("minZoom")||0)||((i=this.getMap())===null||i===void 0?void 0:i.getZoom())===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")},e.prototype.onIdle=function(){this.redraw()},e.prototype.onAdd=function(){var t=this.getMap();this.activeMap=t,this.ready=!0,this.repaint(),t!==null&&(this.listeners=[google.maps.event.addListener(t,"zoom_changed",this.onZoomChanged),google.maps.event.addListener(t,"idle",this.onIdle)])},e.prototype.onRemove=function(){for(var t=0,i=this.markers;t<i.length;t++){var r=i[t];r.getMap()!==this.activeMap&&r.setMap(this.activeMap)}for(var n=0,s=this.clusters;n<s.length;n++){var a=s[n];a.remove()}this.clusters=[];for(var o=0,l=this.listeners;o<l.length;o++){var c=l[o];google.maps.event.removeListener(c)}this.listeners=[],this.activeMap=null,this.ready=!1},e.prototype.draw=function(){},e.prototype.getMap=function(){return null},e.prototype.getPanes=function(){return null},e.prototype.getProjection=function(){return{fromContainerPixelToLatLng:function(){return null},fromDivPixelToLatLng:function(){return null},fromLatLngToContainerPixel:function(){return null},fromLatLngToDivPixel:function(){return null},getVisibleRegion:function(){return null},getWorldWidth:function(){return 0}}},e.prototype.setMap=function(){},e.prototype.addListener=function(){return{remove:function(){}}},e.prototype.bindTo=function(){},e.prototype.get=function(){},e.prototype.notify=function(){},e.prototype.set=function(){},e.prototype.setValues=function(){},e.prototype.unbind=function(){},e.prototype.unbindAll=function(){},e.prototype.setupStyles=function(){if(!(this.styles.length>0))for(var t=0;t<this.imageSizes.length;t++)this.styles.push({url:"".concat(this.imagePath+(t+1),".").concat(this.imageExtension),height:this.imageSizes[t]||0,width:this.imageSizes[t]||0})},e.prototype.fitMapToMarkers=function(){for(var t=this.getMarkers(),i=new google.maps.LatLngBounds,r=0,n=t;r<n.length;r++){var s=n[r],a=s.getPosition();a&&i.extend(a)}var o=this.getMap();o!==null&&"fitBounds"in o&&o.fitBounds(i)},e.prototype.getGridSize=function(){return this.gridSize},e.prototype.setGridSize=function(t){this.gridSize=t},e.prototype.getMinimumClusterSize=function(){return this.minClusterSize},e.prototype.setMinimumClusterSize=function(t){this.minClusterSize=t},e.prototype.getMaxZoom=function(){return this.maxZoom},e.prototype.setMaxZoom=function(t){this.maxZoom=t},e.prototype.getStyles=function(){return this.styles},e.prototype.setStyles=function(t){this.styles=t},e.prototype.getTitle=function(){return this.title},e.prototype.setTitle=function(t){this.title=t},e.prototype.getZoomOnClick=function(){return this.zoomOnClick},e.prototype.setZoomOnClick=function(t){this.zoomOnClick=t},e.prototype.getAverageCenter=function(){return this.averageCenter},e.prototype.setAverageCenter=function(t){this.averageCenter=t},e.prototype.getIgnoreHidden=function(){return this.ignoreHidden},e.prototype.setIgnoreHidden=function(t){this.ignoreHidden=t},e.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons},e.prototype.setEnableRetinaIcons=function(t){this.enableRetinaIcons=t},e.prototype.getImageExtension=function(){return this.imageExtension},e.prototype.setImageExtension=function(t){this.imageExtension=t},e.prototype.getImagePath=function(){return this.imagePath},e.prototype.setImagePath=function(t){this.imagePath=t},e.prototype.getImageSizes=function(){return this.imageSizes},e.prototype.setImageSizes=function(t){this.imageSizes=t},e.prototype.getCalculator=function(){return this.calculator},e.prototype.setCalculator=function(t){this.calculator=t},e.prototype.getBatchSizeIE=function(){return this.batchSizeIE},e.prototype.setBatchSizeIE=function(t){this.batchSizeIE=t},e.prototype.getClusterClass=function(){return this.clusterClass},e.prototype.setClusterClass=function(t){this.clusterClass=t},e.prototype.getMarkers=function(){return this.markers},e.prototype.getTotalMarkers=function(){return this.markers.length},e.prototype.getClusters=function(){return this.clusters},e.prototype.getTotalClusters=function(){return this.clusters.length},e.prototype.addMarker=function(t,i){this.pushMarkerTo(t),i||this.redraw()},e.prototype.addMarkers=function(t,i){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];n&&this.pushMarkerTo(n)}i||this.redraw()},e.prototype.pushMarkerTo=function(t){var i=this;t.getDraggable()&&google.maps.event.addListener(t,"dragend",function(){i.ready&&(t.isAdded=!1,i.repaint())}),t.isAdded=!1,this.markers.push(t)},e.prototype.removeMarker_=function(t){var i=-1;if(this.markers.indexOf)i=this.markers.indexOf(t);else for(var r=0;r<this.markers.length;r++)if(t===this.markers[r]){i=r;break}return i===-1?!1:(t.setMap(null),this.markers.splice(i,1),!0)},e.prototype.removeMarker=function(t,i){var r=this.removeMarker_(t);return!i&&r&&this.repaint(),r},e.prototype.removeMarkers=function(t,i){for(var r=!1,n=0,s=t;n<s.length;n++){var a=s[n];r=r||this.removeMarker_(a)}return!i&&r&&this.repaint(),r},e.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers=[]},e.prototype.repaint=function(){var t=this.clusters.slice();this.clusters=[],this.resetViewport(!1),this.redraw(),setTimeout(function(){for(var r=0,n=t;r<n.length;r++){var s=n[r];s.remove()}},0)},e.prototype.getExtendedBounds=function(t){var i=this.getProjection(),r=i.fromLatLngToDivPixel(new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()));r!==null&&(r.x+=this.gridSize,r.y-=this.gridSize);var n=i.fromLatLngToDivPixel(new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()));if(n!==null&&(n.x-=this.gridSize,n.y+=this.gridSize),r!==null){var s=i.fromDivPixelToLatLng(r);s!==null&&t.extend(s)}if(n!==null){var a=i.fromDivPixelToLatLng(n);a!==null&&t.extend(a)}return t},e.prototype.redraw=function(){this.createClusters(0)},e.prototype.resetViewport=function(t){for(var i=0,r=this.clusters;i<r.length;i++){var n=r[i];n.remove()}this.clusters=[];for(var s=0,a=this.markers;s<a.length;s++){var o=a[s];o.isAdded=!1,t&&o.setMap(null)}},e.prototype.distanceBetweenPoints=function(t,i){var r=6371,n=(i.lat()-t.lat())*Math.PI/180,s=(i.lng()-t.lng())*Math.PI/180,a=Math.sin(n/2)*Math.sin(n/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(i.lat()*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return r*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))},e.prototype.isMarkerInBounds=function(t,i){var r=t.getPosition();return r?i.contains(r):!1},e.prototype.addToClosestCluster=function(t){for(var i,r=4e4,n=null,s=0,a=this.clusters;s<a.length;s++){var o=a[s];i=o;var l=i.getCenter(),c=t.getPosition();if(l&&c){var u=this.distanceBetweenPoints(l,c);u<r&&(r=u,n=i)}}n&&n.isMarkerInClusterBounds(t)?n.addMarker(t):(i=new TXe(this),i.addMarker(t),this.clusters.push(i))},e.prototype.createClusters=function(t){var i=this;if(this.ready){t===0&&(google.maps.event.trigger(this,"clusteringbegin",this),this.timerRefStatic!==null&&(window.clearTimeout(this.timerRefStatic),delete this.timerRefStatic));for(var r=this.getMap(),n=r!==null&&("getBounds"in r)?r.getBounds():null,s=(r==null?void 0:r.getZoom())||0,a=s>3?new google.maps.LatLngBounds(n==null?void 0:n.getSouthWest(),n==null?void 0:n.getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625)),o=this.getExtendedBounds(a),l=Math.min(t+this.batchSize,this.markers.length),c=t;c<l;c++){var u=this.markers[c];u&&!u.isAdded&&this.isMarkerInBounds(u,o)&&(!this.ignoreHidden||this.ignoreHidden&&u.getVisible())&&this.addToClosestCluster(u)}if(l<this.markers.length)this.timerRefStatic=window.setTimeout(function(){i.createClusters(l)},0);else{this.timerRefStatic=null,google.maps.event.trigger(this,"clusteringend",this);for(var h=0,d=this.clusters;h<d.length;h++){var p=d[h];p.updateIcon()}}}},e.prototype.extend=function(t,i){return(function(n){for(var s in n.prototype){var a=s;this.prototype[a]=n.prototype[a]}return this}).apply(t,[i])},e}();function mq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function zXe(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var ko={onClick:"click",onClusteringBegin:"clusteringbegin",onClusteringEnd:"clusteringend",onMouseOut:"mouseout",onMouseOver:"mouseover"},qi={averageCenter(e,t){e.setAverageCenter(t)},batchSizeIE(e,t){e.setBatchSizeIE(t)},calculator(e,t){e.setCalculator(t)},clusterClass(e,t){e.setClusterClass(t)},enableRetinaIcons(e,t){e.setEnableRetinaIcons(t)},gridSize(e,t){e.setGridSize(t)},ignoreHidden(e,t){e.setIgnoreHidden(t)},imageExtension(e,t){e.setImageExtension(t)},imagePath(e,t){e.setImagePath(t)},imageSizes(e,t){e.setImageSizes(t)},maxZoom(e,t){e.setMaxZoom(t)},minimumClusterSize(e,t){e.setMinimumClusterSize(t)},styles(e,t){e.setStyles(t)},title(e,t){e.setTitle(t)},zoomOnClick(e,t){e.setZoomOnClick(t)}},BXe={};function kXe(e){var{children:t,options:i,averageCenter:r,batchSizeIE:n,calculator:s,clusterClass:a,enableRetinaIcons:o,gridSize:l,ignoreHidden:c,imageExtension:u,imagePath:h,imageSizes:d,maxZoom:p,minimumClusterSize:f,styles:v,title:m,zoomOnClick:g,onClick:y,onClusteringBegin:x,onClusteringEnd:_,onMouseOver:M,onMouseOut:S,onLoad:E,onUnmount:A}=e,[P,C]=R.useState(null),D=R.useContext(Si),[N,U]=R.useState(null),[I,G]=R.useState(null),[Q,Y]=R.useState(null),[O,V]=R.useState(null),[F,W]=R.useState(null);return R.useEffect(()=>{P&&S&&(O!==null&&google.maps.event.removeListener(O),V(google.maps.event.addListener(P,ko.onMouseOut,S)))},[S]),R.useEffect(()=>{P&&M&&(F!==null&&google.maps.event.removeListener(F),W(google.maps.event.addListener(P,ko.onMouseOver,M)))},[M]),R.useEffect(()=>{P&&y&&(N!==null&&google.maps.event.removeListener(N),U(google.maps.event.addListener(P,ko.onClick,y)))},[y]),R.useEffect(()=>{P&&x&&(I!==null&&google.maps.event.removeListener(I),G(google.maps.event.addListener(P,ko.onClusteringBegin,x)))},[x]),R.useEffect(()=>{P&&_&&(Q!==null&&google.maps.event.removeListener(Q),G(google.maps.event.addListener(P,ko.onClusteringEnd,_)))},[_]),R.useEffect(()=>{typeof r<"u"&&P!==null&&qi.averageCenter(P,r)},[P,r]),R.useEffect(()=>{typeof n<"u"&&P!==null&&qi.batchSizeIE(P,n)},[P,n]),R.useEffect(()=>{typeof s<"u"&&P!==null&&qi.calculator(P,s)},[P,s]),R.useEffect(()=>{typeof a<"u"&&P!==null&&qi.clusterClass(P,a)},[P,a]),R.useEffect(()=>{typeof o<"u"&&P!==null&&qi.enableRetinaIcons(P,o)},[P,o]),R.useEffect(()=>{typeof l<"u"&&P!==null&&qi.gridSize(P,l)},[P,l]),R.useEffect(()=>{typeof c<"u"&&P!==null&&qi.ignoreHidden(P,c)},[P,c]),R.useEffect(()=>{typeof u<"u"&&P!==null&&qi.imageExtension(P,u)},[P,u]),R.useEffect(()=>{typeof h<"u"&&P!==null&&qi.imagePath(P,h)},[P,h]),R.useEffect(()=>{typeof d<"u"&&P!==null&&qi.imageSizes(P,d)},[P,d]),R.useEffect(()=>{typeof p<"u"&&P!==null&&qi.maxZoom(P,p)},[P,p]),R.useEffect(()=>{typeof f<"u"&&P!==null&&qi.minimumClusterSize(P,f)},[P,f]),R.useEffect(()=>{typeof v<"u"&&P!==null&&qi.styles(P,v)},[P,v]),R.useEffect(()=>{typeof m<"u"&&P!==null&&qi.title(P,m)},[P,m]),R.useEffect(()=>{typeof g<"u"&&P!==null&&qi.zoomOnClick(P,g)},[P,g]),R.useEffect(()=>{if(D){var ee=zXe({},i||BXe),ae=new vae(D,[],ee);return r&&qi.averageCenter(ae,r),n&&qi.batchSizeIE(ae,n),s&&qi.calculator(ae,s),a&&qi.clusterClass(ae,a),o&&qi.enableRetinaIcons(ae,o),l&&qi.gridSize(ae,l),c&&qi.ignoreHidden(ae,c),u&&qi.imageExtension(ae,u),h&&qi.imagePath(ae,h),d&&qi.imageSizes(ae,d),p&&qi.maxZoom(ae,p),f&&qi.minimumClusterSize(ae,f),v&&qi.styles(ae,v),m&&qi.title(ae,m),g&&qi.zoomOnClick(ae,g),S&&V(google.maps.event.addListener(ae,ko.onMouseOut,S)),M&&W(google.maps.event.addListener(ae,ko.onMouseOver,M)),y&&U(google.maps.event.addListener(ae,ko.onClick,y)),x&&G(google.maps.event.addListener(ae,ko.onClusteringBegin,x)),_&&Y(google.maps.event.addListener(ae,ko.onClusteringEnd,_)),C(ae),E&&E(ae),()=>{O!==null&&google.maps.event.removeListener(O),F!==null&&google.maps.event.removeListener(F),N!==null&&google.maps.event.removeListener(N),I!==null&&google.maps.event.removeListener(I),Q!==null&&google.maps.event.removeListener(Q),A&&A(ae)}}},[]),P!==null&&t(P)||null}R.memo(kXe);class UXe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{markerClusterer:null}),it(this,"setClustererCallback",()=>{this.state.markerClusterer!==null&&this.props.onLoad&&this.props.onLoad(this.state.markerClusterer)})}componentDidMount(){if(this.context){var t=new vae(this.context,[],this.props.options);this.registeredEvents=Ti({updaterMap:qi,eventMap:ko,prevProps:{},nextProps:this.props,instance:t}),this.setState(()=>({markerClusterer:t}),this.setClustererCallback)}}componentDidUpdate(t){this.state.markerClusterer&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:qi,eventMap:ko,prevProps:t,nextProps:this.props,instance:this.state.markerClusterer}))}componentWillUnmount(){this.state.markerClusterer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.markerClusterer),Li(this.registeredEvents),this.state.markerClusterer.setMap(null))}render(){return this.state.markerClusterer!==null?this.props.children(this.state.markerClusterer):null}}it(UXe,"contextType",Si);function gq(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()}var yae=function(){function e(t){t===void 0&&(t={}),this.getCloseClickHandler=this.getCloseClickHandler.bind(this),this.closeClickHandler=this.closeClickHandler.bind(this),this.createInfoBoxDiv=this.createInfoBoxDiv.bind(this),this.addClickHandler=this.addClickHandler.bind(this),this.getCloseBoxImg=this.getCloseBoxImg.bind(this),this.getBoxWidths=this.getBoxWidths.bind(this),this.setBoxStyle=this.setBoxStyle.bind(this),this.setPosition=this.setPosition.bind(this),this.getPosition=this.getPosition.bind(this),this.setOptions=this.setOptions.bind(this),this.setContent=this.setContent.bind(this),this.setVisible=this.setVisible.bind(this),this.getContent=this.getContent.bind(this),this.getVisible=this.getVisible.bind(this),this.setZIndex=this.setZIndex.bind(this),this.getZIndex=this.getZIndex.bind(this),this.onRemove=this.onRemove.bind(this),this.panBox=this.panBox.bind(this),this.extend=this.extend.bind(this),this.close=this.close.bind(this),this.draw=this.draw.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.open=this.open.bind(this),this.extend(e,google.maps.OverlayView),this.content=t.content||"",this.disableAutoPan=t.disableAutoPan||!1,this.maxWidth=t.maxWidth||0,this.pixelOffset=t.pixelOffset||new google.maps.Size(0,0),this.position=t.position||new google.maps.LatLng(0,0),this.zIndex=t.zIndex||null,this.boxClass=t.boxClass||"infoBox",this.boxStyle=t.boxStyle||{},this.closeBoxMargin=t.closeBoxMargin||"2px",this.closeBoxURL=t.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",t.closeBoxURL===""&&(this.closeBoxURL=""),this.infoBoxClearance=t.infoBoxClearance||new google.maps.Size(1,1),typeof t.visible>"u"&&(typeof t.isHidden>"u"?t.visible=!0:t.visible=!t.isHidden),this.isHidden=!t.visible,this.alignBottom=t.alignBottom||!1,this.pane=t.pane||"floatPane",this.enableEventPropagation=t.enableEventPropagation||!1,this.div=null,this.closeListener=null,this.moveListener=null,this.mapListener=null,this.contextListener=null,this.eventListeners=null,this.fixedWidthSet=null}return e.prototype.createInfoBoxDiv=function(){var t=this,i=function(u){u.returnValue=!1,u.preventDefault&&u.preventDefault(),t.enableEventPropagation||gq(u)};if(!this.div){this.div=document.createElement("div"),this.setBoxStyle(),typeof this.content=="string"?this.div.innerHTML=this.getCloseBoxImg()+this.content:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(this.content));var r=this.getPanes();if(r!==null&&r[this.pane].appendChild(this.div),this.addClickHandler(),this.div.style.width)this.fixedWidthSet=!0;else if(this.maxWidth!==0&&this.div.offsetWidth>this.maxWidth)this.div.style.width=this.maxWidth+"px",this.fixedWidthSet=!0;else{var n=this.getBoxWidths();this.div.style.width=this.div.offsetWidth-n.left-n.right+"px",this.fixedWidthSet=!1}if(this.panBox(this.disableAutoPan),!this.enableEventPropagation){this.eventListeners=[];for(var s=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],a=0,o=s;a<o.length;a++){var l=o[a];this.eventListeners.push(google.maps.event.addListener(this.div,l,gq))}this.eventListeners.push(google.maps.event.addListener(this.div,"mouseover",function(){t.div&&(t.div.style.cursor="default")}))}this.contextListener=google.maps.event.addListener(this.div,"contextmenu",i),google.maps.event.trigger(this,"domready")}},e.prototype.getCloseBoxImg=function(){var t="";return this.closeBoxURL!==""&&(t='<img alt=""',t+=' aria-hidden="true"',t+=" src='"+this.closeBoxURL+"'",t+=" align=right",t+=" style='",t+=" position: relative;",t+=" cursor: pointer;",t+=" margin: "+this.closeBoxMargin+";",t+="'>"),t},e.prototype.addClickHandler=function(){this.closeListener=this.div&&this.div.firstChild&&this.closeBoxURL!==""?google.maps.event.addListener(this.div.firstChild,"click",this.getCloseClickHandler()):null},e.prototype.closeClickHandler=function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),google.maps.event.trigger(this,"closeclick"),this.close()},e.prototype.getCloseClickHandler=function(){return this.closeClickHandler},e.prototype.panBox=function(t){if(this.div&&!t){var i=this.getMap();if(i instanceof google.maps.Map){var r=0,n=0,s=i.getBounds();s&&!s.contains(this.position)&&i.setCenter(this.position);var a=i.getDiv(),o=a.offsetWidth,l=a.offsetHeight,c=this.pixelOffset.width,u=this.pixelOffset.height,h=this.div.offsetWidth,d=this.div.offsetHeight,p=this.infoBoxClearance.width,f=this.infoBoxClearance.height,v=this.getProjection(),m=v.fromLatLngToContainerPixel(this.position);m!==null&&(m.x<-c+p?r=m.x+c-p:m.x+h+c+p>o&&(r=m.x+h+c+p-o),this.alignBottom?m.y<-u+f+d?n=m.y+u-f-d:m.y+u+f>l&&(n=m.y+u+f-l):m.y<-u+f?n=m.y+u-f:m.y+d+u+f>l&&(n=m.y+d+u+f-l)),r===0&&n===0||i.panBy(r,n)}}},e.prototype.setBoxStyle=function(){if(this.div){this.div.className=this.boxClass,this.div.style.cssText="";var t=this.boxStyle;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(this.div.style[i]=t[i]);if(this.div.style.webkitTransform="translateZ(0)",typeof this.div.style.opacity<"u"&&this.div.style.opacity!==""){var r=parseFloat(this.div.style.opacity||"");this.div.style.msFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+r*100+')"',this.div.style.filter="alpha(opacity="+r*100+")"}this.div.style.position="absolute",this.div.style.visibility="hidden",this.zIndex!==null&&(this.div.style.zIndex=this.zIndex+""),this.div.style.overflow||(this.div.style.overflow="auto")}},e.prototype.getBoxWidths=function(){var t={top:0,bottom:0,left:0,right:0};if(!this.div)return t;if(document.defaultView){var i=this.div.ownerDocument,r=i&&i.defaultView?i.defaultView.getComputedStyle(this.div,""):null;r&&(t.top=parseInt(r.borderTopWidth||"",10)||0,t.bottom=parseInt(r.borderBottomWidth||"",10)||0,t.left=parseInt(r.borderLeftWidth||"",10)||0,t.right=parseInt(r.borderRightWidth||"",10)||0)}else if(document.documentElement.currentStyle){var n=this.div.currentStyle;n&&(t.top=parseInt(n.borderTopWidth||"",10)||0,t.bottom=parseInt(n.borderBottomWidth||"",10)||0,t.left=parseInt(n.borderLeftWidth||"",10)||0,t.right=parseInt(n.borderRightWidth||"",10)||0)}return t},e.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.div.parentNode.removeChild(this.div),this.div=null)},e.prototype.draw=function(){if(this.createInfoBoxDiv(),this.div){var t=this.getProjection(),i=t.fromLatLngToDivPixel(this.position);i!==null&&(this.div.style.left=i.x+this.pixelOffset.width+"px",this.alignBottom?this.div.style.bottom=-(i.y+this.pixelOffset.height)+"px":this.div.style.top=i.y+this.pixelOffset.height+"px"),this.isHidden?this.div.style.visibility="hidden":this.div.style.visibility="visible"}},e.prototype.setOptions=function(t){t===void 0&&(t={}),typeof t.boxClass<"u"&&(this.boxClass=t.boxClass,this.setBoxStyle()),typeof t.boxStyle<"u"&&(this.boxStyle=t.boxStyle,this.setBoxStyle()),typeof t.content<"u"&&this.setContent(t.content),typeof t.disableAutoPan<"u"&&(this.disableAutoPan=t.disableAutoPan),typeof t.maxWidth<"u"&&(this.maxWidth=t.maxWidth),typeof t.pixelOffset<"u"&&(this.pixelOffset=t.pixelOffset),typeof t.alignBottom<"u"&&(this.alignBottom=t.alignBottom),typeof t.position<"u"&&this.setPosition(t.position),typeof t.zIndex<"u"&&this.setZIndex(t.zIndex),typeof t.closeBoxMargin<"u"&&(this.closeBoxMargin=t.closeBoxMargin),typeof t.closeBoxURL<"u"&&(this.closeBoxURL=t.closeBoxURL),typeof t.infoBoxClearance<"u"&&(this.infoBoxClearance=t.infoBoxClearance),typeof t.isHidden<"u"&&(this.isHidden=t.isHidden),typeof t.visible<"u"&&(this.isHidden=!t.visible),typeof t.enableEventPropagation<"u"&&(this.enableEventPropagation=t.enableEventPropagation),this.div&&this.draw()},e.prototype.setContent=function(t){this.content=t,this.div&&(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.fixedWidthSet||(this.div.style.width=""),typeof t=="string"?this.div.innerHTML=this.getCloseBoxImg()+t:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(t)),this.fixedWidthSet||(this.div.style.width=this.div.offsetWidth+"px",typeof t=="string"?this.div.innerHTML=this.getCloseBoxImg()+t:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(t))),this.addClickHandler()),google.maps.event.trigger(this,"content_changed")},e.prototype.setPosition=function(t){this.position=t,this.div&&this.draw(),google.maps.event.trigger(this,"position_changed")},e.prototype.setVisible=function(t){this.isHidden=!t,this.div&&(this.div.style.visibility=this.isHidden?"hidden":"visible")},e.prototype.setZIndex=function(t){this.zIndex=t,this.div&&(this.div.style.zIndex=t+""),google.maps.event.trigger(this,"zindex_changed")},e.prototype.getContent=function(){return this.content},e.prototype.getPosition=function(){return this.position},e.prototype.getZIndex=function(){return this.zIndex},e.prototype.getVisible=function(){var t=this.getMap();return typeof t>"u"||t===null?!1:!this.isHidden},e.prototype.show=function(){this.isHidden=!1,this.div&&(this.div.style.visibility="visible")},e.prototype.hide=function(){this.isHidden=!0,this.div&&(this.div.style.visibility="hidden")},e.prototype.open=function(t,i){var r=this;i&&(this.position=i.getPosition(),this.moveListener=google.maps.event.addListener(i,"position_changed",function(){var n=i.getPosition();r.setPosition(n)}),this.mapListener=google.maps.event.addListener(i,"map_changed",function(){r.setMap(i.map)})),this.setMap(t),this.div&&this.panBox()},e.prototype.close=function(){if(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.eventListeners){for(var t=0,i=this.eventListeners;t<i.length;t++){var r=i[t];google.maps.event.removeListener(r)}this.eventListeners=null}this.moveListener&&(google.maps.event.removeListener(this.moveListener),this.moveListener=null),this.mapListener&&(google.maps.event.removeListener(this.mapListener),this.mapListener=null),this.contextListener&&(google.maps.event.removeListener(this.contextListener),this.contextListener=null),this.setMap(null)},e.prototype.extend=function(t,i){return(function(n){for(var s in n.prototype)Object.prototype.hasOwnProperty.call(this,s)||(this.prototype[s]=n.prototype[s]);return this}).apply(t,[i])},e}(),FXe=["position"],VXe=["position"];function vq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function BC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?vq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var yq={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},xq={options(e,t){e.setOptions(t)},position(e,t){t instanceof google.maps.LatLng?e.setPosition(t):e.setPosition(new google.maps.LatLng(t.lat,t.lng))},visible(e,t){e.setVisible(t)},zIndex(e,t){e.setZIndex(t)}},jXe={};function HXe(e){var{children:t,anchor:i,options:r,position:n,zIndex:s,onCloseClick:a,onDomReady:o,onContentChanged:l,onPositionChanged:c,onZindexChanged:u,onLoad:h,onUnmount:d}=e,p=R.useContext(Si),[f,v]=R.useState(null),[m,g]=R.useState(null),[y,x]=R.useState(null),[_,M]=R.useState(null),[S,E]=R.useState(null),[A,P]=R.useState(null),C=R.useRef(null);return R.useEffect(()=>{p&&f!==null&&(f.close(),i?f.open(p,i):f.getPosition()&&f.open(p))},[p,f,i]),R.useEffect(()=>{r&&f!==null&&f.setOptions(r)},[f,r]),R.useEffect(()=>{if(n&&f!==null){var D=n instanceof google.maps.LatLng?n:new google.maps.LatLng(n.lat,n.lng);f.setPosition(D)}},[n]),R.useEffect(()=>{typeof s=="number"&&f!==null&&f.setZIndex(s)},[s]),R.useEffect(()=>{f&&a&&(m!==null&&google.maps.event.removeListener(m),g(google.maps.event.addListener(f,"closeclick",a)))},[a]),R.useEffect(()=>{f&&o&&(y!==null&&google.maps.event.removeListener(y),x(google.maps.event.addListener(f,"domready",o)))},[o]),R.useEffect(()=>{f&&l&&(_!==null&&google.maps.event.removeListener(_),M(google.maps.event.addListener(f,"content_changed",l)))},[l]),R.useEffect(()=>{f&&c&&(S!==null&&google.maps.event.removeListener(S),E(google.maps.event.addListener(f,"position_changed",c)))},[c]),R.useEffect(()=>{f&&u&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(f,"zindex_changed",u)))},[u]),R.useEffect(()=>{if(p){var D=r||jXe,{position:N}=D,U=AF(D,FXe),I;N&&!(N instanceof google.maps.LatLng)&&(I=new google.maps.LatLng(N.lat,N.lng));var G=new yae(BC(BC({},U),I?{position:I}:{}));C.current=document.createElement("div"),v(G),a&&g(google.maps.event.addListener(G,"closeclick",a)),o&&x(google.maps.event.addListener(G,"domready",o)),l&&M(google.maps.event.addListener(G,"content_changed",l)),c&&E(google.maps.event.addListener(G,"position_changed",c)),u&&P(google.maps.event.addListener(G,"zindex_changed",u)),G.setContent(C.current),i?G.open(p,i):G.getPosition()?G.open(p):qn(!1,"You must provide either an anchor or a position prop for <InfoBox>."),h&&h(G)}return()=>{f!==null&&(m&&google.maps.event.removeListener(m),_&&google.maps.event.removeListener(_),y&&google.maps.event.removeListener(y),S&&google.maps.event.removeListener(S),A&&google.maps.event.removeListener(A),d&&d(f),f.close())}},[]),C.current?cm.createPortal(R.Children.only(t),C.current):null}R.memo(HXe);class GXe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"containerElement",null),it(this,"state",{infoBox:null}),it(this,"open",(t,i)=>{i?this.context!==null&&t.open(this.context,i):t.getPosition()?this.context!==null&&t.open(this.context):qn(!1,"You must provide either an anchor or a position prop for <InfoBox>.")}),it(this,"setInfoBoxCallback",()=>{this.state.infoBox!==null&&this.containerElement!==null&&(this.state.infoBox.setContent(this.containerElement),this.open(this.state.infoBox,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoBox))})}componentDidMount(){var t=this.props.options||{},{position:i}=t,r=AF(t,VXe),n;i&&!(i instanceof google.maps.LatLng)&&(n=new google.maps.LatLng(i.lat,i.lng));var s=new yae(BC(BC({},r),n?{position:n}:{}));this.containerElement=document.createElement("div"),this.registeredEvents=Ti({updaterMap:xq,eventMap:yq,prevProps:{},nextProps:this.props,instance:s}),this.setState({infoBox:s},this.setInfoBoxCallback)}componentDidUpdate(t){var{infoBox:i}=this.state;i!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:xq,eventMap:yq,prevProps:t,nextProps:this.props,instance:i}))}componentWillUnmount(){var{onUnmount:t}=this.props,{infoBox:i}=this.state;i!==null&&(t&&t(i),Li(this.registeredEvents),i.close())}render(){return this.containerElement?cm.createPortal(R.Children.only(this.props.children),this.containerElement):null}}it(GXe,"contextType",Si);var sR,bq;function WXe(){return bq||(bq=1,sR=function e(t,i){if(t===i)return!0;if(t&&i&&typeof t=="object"&&typeof i=="object"){if(t.constructor!==i.constructor)return!1;var r,n,s;if(Array.isArray(t)){if(r=t.length,r!=i.length)return!1;for(n=r;n--!==0;)if(!e(t[n],i[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===i.source&&t.flags===i.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===i.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===i.toString();if(s=Object.keys(t),r=s.length,r!==Object.keys(i).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(i,s[n]))return!1;for(n=r;n--!==0;){var a=s[n];if(!e(t[a],i[a]))return!1}return!0}return t!==t&&i!==i}),sR}var XXe=WXe(),wq=cae(XXe),_q=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],aR=1,f1=8;class CF{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[i,r]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");var n=r>>4;if(n!==aR)throw new Error("Got v".concat(n," data when expected v").concat(aR,"."));var s=_q[r&15];if(!s)throw new Error("Unrecognized array type.");var[a]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new CF(o,a,s,t)}constructor(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,n=arguments.length>3?arguments[3]:void 0;if(isNaN(t)||t<0)throw new Error("Unpexpected numItems value: ".concat(t,"."));this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;var s=_q.indexOf(this.ArrayType),a=t*2*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-o%8)%8;if(s<0)throw new Error("Unexpected typed array class: ".concat(r,"."));n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,f1,t),this.coords=new this.ArrayType(this.data,f1+o+l,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(f1+a+o+l),this.ids=new this.IndexArrayType(this.data,f1,t),this.coords=new this.ArrayType(this.data,f1+o+l,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(aR<<4)+s]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){var r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=t,this.coords[this._pos++]=i,r}finish(){var t=this._pos>>1;if(t!==this.numItems)throw new Error("Added ".concat(t," items when expected ").concat(this.numItems,"."));return yz(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:s,coords:a,nodeSize:o}=this,l=[0,s.length-1,0],c=[];l.length;){var u=l.pop()||0,h=l.pop()||0,d=l.pop()||0;if(h-d<=o){for(var p=d;p<=h;p++){var f=a[2*p],v=a[2*p+1];f>=t&&f<=r&&v>=i&&v<=n&&c.push(s[p])}continue}var m=d+h>>1,g=a[2*m],y=a[2*m+1];g>=t&&g<=r&&y>=i&&y<=n&&c.push(s[m]),(u===0?t<=g:i<=y)&&(l.push(d),l.push(m-1),l.push(1-u)),(u===0?r>=g:n>=y)&&(l.push(m+1),l.push(h),l.push(1-u))}return c}within(t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:n,coords:s,nodeSize:a}=this,o=[0,n.length-1,0],l=[],c=r*r;o.length;){var u=o.pop()||0,h=o.pop()||0,d=o.pop()||0;if(h-d<=a){for(var p=d;p<=h;p++)Sq(s[2*p],s[2*p+1],t,i)<=c&&l.push(n[p]);continue}var f=d+h>>1,v=s[2*f],m=s[2*f+1];Sq(v,m,t,i)<=c&&l.push(n[f]),(u===0?t-r<=v:i-r<=m)&&(o.push(d),o.push(f-1),o.push(1-u)),(u===0?t+r>=v:i+r>=m)&&(o.push(f+1),o.push(h),o.push(1-u))}return l}}function yz(e,t,i,r,n,s){if(!(n-r<=i)){var a=r+n>>1;xae(e,t,a,r,n,s),yz(e,t,i,r,a-1,1-s),yz(e,t,i,a+1,n,1-s)}}function xae(e,t,i,r,n,s){for(;n>r;){if(n-r>600){var a=n-r+1,o=i-r+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(o-a/2<0?-1:1),h=Math.max(r,Math.floor(i-o*c/a+u)),d=Math.min(n,Math.floor(i+(a-o)*c/a+u));xae(e,t,i,h,d,s)}var p=t[2*i+s],f=r,v=n;for(m1(e,t,r,i),t[2*n+s]>p&&m1(e,t,r,n);f<v;){for(m1(e,t,f,v),f++,v--;t[2*f+s]<p;)f++;for(;t[2*v+s]>p;)v--}t[2*r+s]===p?m1(e,t,r,v):(v++,m1(e,t,v,n)),v<=i&&(r=v+1),i<=v&&(n=v-1)}}function m1(e,t,i,r){oR(e,i,r),oR(t,2*i,2*r),oR(t,2*i+1,2*r+1)}function oR(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function Sq(e,t,i,r){var n=e-i,s=t-r;return n*n+s*s}var qXe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},Mq=Math.fround||(e=>t=>(e[0]=+t,e[0]))(new Float32Array(1)),Wp=2,nd=3,lR=4,$h=5,bae=6;class YXe{constructor(t){this.options=Object.assign(Object.create(qXe),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){var{log:i,minZoom:r,maxZoom:n}=this.options;i&&console.time("total time");var s="prepare ".concat(t.length," points");i&&console.time(s),this.points=t;for(var a=[],o=0;o<t.length;o++){var l=t[o];if(l.geometry){var[c,u]=l.geometry.coordinates,h=Mq(KM(c)),d=Mq(JM(u));a.push(h,d,1/0,o,-1,1),this.options.reduce&&a.push(0)}}var p=this.trees[n+1]=this._createTree(a);i&&console.timeEnd(s);for(var f=n;f>=r;f--){var v=+Date.now();p=this.trees[f]=this._createTree(this._cluster(p,f)),i&&console.log("z%d: %d clusters in %dms",f,p.numItems,+Date.now()-v)}return i&&console.timeEnd("total time"),this}getClusters(t,i){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),s=t[2]===180?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,s=180;else if(r>s){var o=this.getClusters([r,n,180,a],i),l=this.getClusters([-180,n,s,a],i);return o.concat(l)}var c=this.trees[this._limitZoom(i)],u=c.range(KM(r),JM(a),KM(s),JM(n)),h=c.data,d=[];for(var p of u){var f=this.stride*p;d.push(h[f+$h]>1?Eq(h,f,this.clusterProps):this.points[h[f+nd]])}return d}getChildren(t){var i=this._getOriginId(t),r=this._getOriginZoom(t),n="No cluster with the specified id.",s=this.trees[r];if(!s)throw new Error(n);var a=s.data;if(i*this.stride>=a.length)throw new Error(n);var o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),l=a[i*this.stride],c=a[i*this.stride+1],u=s.within(l,c,o),h=[];for(var d of u){var p=d*this.stride;a[p+lR]===t&&h.push(a[p+$h]>1?Eq(a,p,this.clusterProps):this.points[a[p+nd]])}if(h.length===0)throw new Error(n);return h}getLeaves(t,i,r){i=i||10,r=r||0;var n=[];return this._appendLeaves(n,t,i,r,0),n}getTile(t,i,r){var n=this.trees[this._limitZoom(t)],s=Math.pow(2,t),{extent:a,radius:o}=this.options,l=o/a,c=(r-l)/s,u=(r+1+l)/s,h={features:[]};return this._addTileFeatures(n.range((i-l)/s,c,(i+1+l)/s,u),n.data,i,r,s,h),i===0&&this._addTileFeatures(n.range(1-l/s,c,1,u),n.data,s,r,s,h),i===s-1&&this._addTileFeatures(n.range(0,c,l/s,u),n.data,-1,r,s,h),h.features.length?h:null}getClusterExpansionZoom(t){for(var i=this._getOriginZoom(t)-1;i<=this.options.maxZoom;){var r=this.getChildren(t);if(i++,r.length!==1)break;t=r[0].properties.cluster_id}return i}_appendLeaves(t,i,r,n,s){var a=this.getChildren(i);for(var o of a){var l=o.properties;if(l&&l.cluster?s+l.point_count<=n?s+=l.point_count:s=this._appendLeaves(t,l.cluster_id,r,n,s):s<n?s++:t.push(o),t.length===r)break}return s}_createTree(t){for(var i=new CF(t.length/this.stride|0,this.options.nodeSize,Float32Array),r=0;r<t.length;r+=this.stride)i.add(t[r],t[r+1]);return i.finish(),i.data=t,i}_addTileFeatures(t,i,r,n,s,a){for(var o of t){var l=o*this.stride,c=i[l+$h]>1,u=void 0,h=void 0,d=void 0;if(c)u=wae(i,l,this.clusterProps),h=i[l],d=i[l+1];else{var p=this.points[i[l+nd]];u=p.properties;var[f,v]=p.geometry.coordinates;h=KM(f),d=JM(v)}var m={type:1,geometry:[[Math.round(this.options.extent*(h*s-r)),Math.round(this.options.extent*(d*s-n))]],tags:u},g=void 0;c||this.options.generateId?g=i[l+nd]:g=this.points[i[l+nd]].id,g!==void 0&&(m.id=g),a.features.push(m)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,i){for(var{radius:r,extent:n,reduce:s,minPoints:a}=this.options,o=r/(n*Math.pow(2,i)),l=t.data,c=[],u=this.stride,h=0;h<l.length;h+=u)if(!(l[h+Wp]<=i)){l[h+Wp]=i;var d=l[h],p=l[h+1],f=t.within(l[h],l[h+1],o),v=l[h+$h],m=v;for(var g of f){var y=g*u;l[y+Wp]>i&&(m+=l[y+$h])}if(m>v&&m>=a){var x=d*v,_=p*v,M=void 0,S=-1,E=((h/u|0)<<5)+(i+1)+this.points.length;for(var A of f){var P=A*u;if(!(l[P+Wp]<=i)){l[P+Wp]=i;var C=l[P+$h];x+=l[P]*C,_+=l[P+1]*C,l[P+lR]=E,s&&(M||(M=this._map(l,h,!0),S=this.clusterProps.length,this.clusterProps.push(M)),s(M,this._map(l,P)))}}l[h+lR]=E,c.push(x/m,_/m,1/0,E,-1,m),s&&c.push(S)}else{for(var D=0;D<u;D++)c.push(l[h+D]);if(m>1)for(var N of f){var U=N*u;if(!(l[U+Wp]<=i)){l[U+Wp]=i;for(var I=0;I<u;I++)c.push(l[U+I])}}}}return c}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,i,r){if(t[i+$h]>1){var n=this.clusterProps[t[i+bae]];return r?Object.assign({},n):n}var s=this.points[t[i+nd]].properties,a=this.options.map(s);return r&&a===s?Object.assign({},a):a}}function Eq(e,t,i){return{type:"Feature",id:e[t+nd],properties:wae(e,t,i),geometry:{type:"Point",coordinates:[ZXe(e[t]),QXe(e[t+1])]}}}function wae(e,t,i){var r=e[t+$h],n=r>=1e4?"".concat(Math.round(r/1e3),"k"):r>=1e3?"".concat(Math.round(r/100)/10,"k"):r,s=e[t+bae],a=s===-1?{}:Object.assign({},i[s]);return Object.assign(a,{cluster:!0,cluster_id:e[t+nd],point_count:r,point_count_abbreviated:n})}function KM(e){return e/360+.5}function JM(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function ZXe(e){return(e-.5)*360}function QXe(e){var t=(180-e*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function KXe(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(i[r[n]]=e[r[n]]);return i}class ao{static isAdvancedMarkerAvailable(t){return google.maps.marker&&t.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(t){return google.maps.marker&&t instanceof google.maps.marker.AdvancedMarkerElement}static setMap(t,i){this.isAdvancedMarker(t)?t.map=i:t.setMap(i)}static getPosition(t){if(this.isAdvancedMarker(t)){if(t.position){if(t.position instanceof google.maps.LatLng)return t.position;if(t.position.lat&&t.position.lng)return new google.maps.LatLng(t.position.lat,t.position.lng)}return new google.maps.LatLng(null)}return t.getPosition()}static getVisible(t){return this.isAdvancedMarker(t)?!0:t.getVisible()}}class xz{constructor(t){var{markers:i,position:r}=t;this.markers=i,r&&(r instanceof google.maps.LatLng?this._position=r:this._position=new google.maps.LatLng(r))}get bounds(){if(!(this.markers.length===0&&!this._position)){var t=new google.maps.LatLngBounds(this._position,this._position);for(var i of this.markers)t.extend(ao.getPosition(i));return t}}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(t=>ao.getVisible(t)).length}push(t){this.markers.push(t)}delete(){this.marker&&(ao.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}class JXe{constructor(t){var{maxZoom:i=16}=t;this.maxZoom=i}noop(t){var{markers:i}=t;return $Xe(i)}}var $Xe=e=>{var t=e.map(i=>new xz({position:ao.getPosition(i),markers:[i]}));return t};class eqe extends JXe{constructor(t){var{maxZoom:i,radius:r=60}=t,n=KXe(t,["maxZoom","radius"]);super({maxZoom:i}),this.state={zoom:-1},this.superCluster=new YXe(Object.assign({maxZoom:this.maxZoom,radius:r},n))}calculate(t){var i=!1,r={zoom:t.map.getZoom()};if(!wq(t.markers,this.markers)){i=!0,this.markers=[...t.markers];var n=this.markers.map(s=>{var a=ao.getPosition(s),o=[a.lng(),a.lat()];return{type:"Feature",geometry:{type:"Point",coordinates:o},properties:{marker:s}}});this.superCluster.load(n)}return i||(this.state.zoom<=this.maxZoom||r.zoom<=this.maxZoom)&&(i=!wq(this.state,r)),this.state=r,i&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:i}}cluster(t){var{map:i}=t;return this.superCluster.getClusters([-180,-90,180,90],Math.round(i.getZoom())).map(r=>this.transformCluster(r))}transformCluster(t){var{geometry:{coordinates:[i,r]},properties:n}=t;if(n.cluster)return new xz({markers:this.superCluster.getLeaves(n.cluster_id,1/0).map(a=>a.properties.marker),position:{lat:r,lng:i}});var s=n.marker;return new xz({markers:[s],position:ao.getPosition(s)})}}class tqe{constructor(t,i){this.markers={sum:t.length};var r=i.map(s=>s.count),n=r.reduce((s,a)=>s+a,0);this.clusters={count:i.length,markers:{mean:n/i.length,sum:n,min:Math.min(...r),max:Math.max(...r)}}}}class iqe{render(t,i,r){var{count:n,position:s}=t,a=n>Math.max(10,i.clusters.markers.mean)?"#ff0000":"#0000ff",o='<svg fill="'.concat(a,`" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">
<circle cx="120" cy="120" opacity=".6" r="70" />
<circle cx="120" cy="120" opacity=".3" r="90" />
<circle cx="120" cy="120" opacity=".2" r="110" />
<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">`).concat(n,`</text>
</svg>`),l="Cluster of ".concat(n," markers"),c=Number(google.maps.Marker.MAX_ZINDEX)+n;if(ao.isAdvancedMarkerAvailable(r)){var u=new DOMParser,h=u.parseFromString(o,"image/svg+xml").documentElement;h.setAttribute("transform","translate(0 25)");var d={map:r,position:s,zIndex:c,title:l,content:h};return new google.maps.marker.AdvancedMarkerElement(d)}var p={position:s,zIndex:c,title:l,icon:{url:"data:image/svg+xml;base64,".concat(btoa(o)),anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(p)}}function rqe(e,t){for(var i in t.prototype)e.prototype[i]=t.prototype[i]}class TF{constructor(){rqe(TF,google.maps.OverlayView)}}var mx;(function(e){e.CLUSTERING_BEGIN="clusteringbegin",e.CLUSTERING_END="clusteringend",e.CLUSTER_CLICK="click"})(mx||(mx={}));var nqe=(e,t,i)=>{i.fitBounds(t.bounds)};class sqe extends TF{constructor(t){var{map:i,markers:r=[],algorithmOptions:n={},algorithm:s=new eqe(n),renderer:a=new iqe,onClusterClick:o=nqe}=t;super(),this.markers=[...r],this.clusters=[],this.algorithm=s,this.renderer=a,this.onClusterClick=o,i&&this.setMap(i)}addMarker(t,i){this.markers.includes(t)||(this.markers.push(t),i||this.render())}addMarkers(t,i){t.forEach(r=>{this.addMarker(r,!0)}),i||this.render()}removeMarker(t,i){var r=this.markers.indexOf(t);return r===-1?!1:(ao.setMap(t,null),this.markers.splice(r,1),i||this.render(),!0)}removeMarkers(t,i){var r=!1;return t.forEach(n=>{r=this.removeMarker(n,!0)||r}),r&&!i&&this.render(),r}clearMarkers(t){this.markers.length=0,t||this.render()}render(){var t=this.getMap();if(t instanceof google.maps.Map&&t.getProjection()){google.maps.event.trigger(this,mx.CLUSTERING_BEGIN,this);var{clusters:i,changed:r}=this.algorithm.calculate({markers:this.markers,map:t,mapCanvasProjection:this.getProjection()});if(r||r==null){var n=new Set;for(var s of i)s.markers.length==1&&n.add(s.markers[0]);var a=[];for(var o of this.clusters)o.marker!=null&&(o.markers.length==1?n.has(o.marker)||ao.setMap(o.marker,null):a.push(o.marker));this.clusters=i,this.renderClusters(),requestAnimationFrame(()=>a.forEach(l=>ao.setMap(l,null)))}google.maps.event.trigger(this,mx.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(t=>ao.setMap(t,null)),this.clusters.forEach(t=>t.delete()),this.clusters=[]}renderClusters(){var t=new tqe(this.markers,this.clusters),i=this.getMap();this.clusters.forEach(r=>{r.markers.length===1?r.marker=r.markers[0]:(r.marker=this.renderer.render(r,t,i),r.markers.forEach(n=>ao.setMap(n,null)),this.onClusterClick&&r.marker.addListener("click",n=>{google.maps.event.trigger(this,mx.CLUSTER_CLICK,r),this.onClusterClick(n,r,i)})),ao.setMap(r.marker,i)})}}function Aq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Cq(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Aq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Aq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function aqe(e){var t=sXe(),[i,r]=R.useState(null);return R.useEffect(()=>{if(t&&i===null){var n=new sqe(Cq(Cq({},e),{},{map:t}));r(n)}},[t]),i}function oqe(e){var{children:t,options:i}=e,r=aqe(i);return r!==null?t(r):null}R.memo(oqe);var Tq={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},Pq={options(e,t){e.setOptions(t)},position(e,t){e.setPosition(t)},zIndex(e,t){e.setZIndex(t)}};function lqe(e){var{children:t,anchor:i,options:r,position:n,zIndex:s,onCloseClick:a,onDomReady:o,onContentChanged:l,onPositionChanged:c,onZindexChanged:u,onLoad:h,onUnmount:d}=e,p=R.useContext(Si),[f,v]=R.useState(null),[m,g]=R.useState(null),[y,x]=R.useState(null),[_,M]=R.useState(null),[S,E]=R.useState(null),[A,P]=R.useState(null),C=R.useRef(null);return R.useEffect(()=>{f!==null&&(f.close(),i?f.open(p,i):f.getPosition()&&f.open(p))},[p,f,i]),R.useEffect(()=>{r&&f!==null&&f.setOptions(r)},[f,r]),R.useEffect(()=>{n&&f!==null&&f.setPosition(n)},[n]),R.useEffect(()=>{typeof s=="number"&&f!==null&&f.setZIndex(s)},[s]),R.useEffect(()=>{f&&a&&(m!==null&&google.maps.event.removeListener(m),g(google.maps.event.addListener(f,"closeclick",a)))},[a]),R.useEffect(()=>{f&&o&&(y!==null&&google.maps.event.removeListener(y),x(google.maps.event.addListener(f,"domready",o)))},[o]),R.useEffect(()=>{f&&l&&(_!==null&&google.maps.event.removeListener(_),M(google.maps.event.addListener(f,"content_changed",l)))},[l]),R.useEffect(()=>{f&&c&&(S!==null&&google.maps.event.removeListener(S),E(google.maps.event.addListener(f,"position_changed",c)))},[c]),R.useEffect(()=>{f&&u&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(f,"zindex_changed",u)))},[u]),R.useEffect(()=>{var D=new google.maps.InfoWindow(r);return v(D),C.current=document.createElement("div"),a&&g(google.maps.event.addListener(D,"closeclick",a)),o&&x(google.maps.event.addListener(D,"domready",o)),l&&M(google.maps.event.addListener(D,"content_changed",l)),c&&E(google.maps.event.addListener(D,"position_changed",c)),u&&P(google.maps.event.addListener(D,"zindex_changed",u)),D.setContent(C.current),n&&D.setPosition(n),s&&D.setZIndex(s),i?D.open(p,i):D.getPosition()?D.open(p):qn(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>."),h&&h(D),()=>{m&&google.maps.event.removeListener(m),_&&google.maps.event.removeListener(_),y&&google.maps.event.removeListener(y),S&&google.maps.event.removeListener(S),A&&google.maps.event.removeListener(A),d&&d(D),D.close()}},[]),C.current?cm.createPortal(R.Children.only(t),C.current):null}R.memo(lqe);class cqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"containerElement",null),it(this,"state",{infoWindow:null}),it(this,"open",(t,i)=>{i?t.open(this.context,i):t.getPosition()?t.open(this.context):qn(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.")}),it(this,"setInfoWindowCallback",()=>{this.state.infoWindow!==null&&this.containerElement!==null&&(this.state.infoWindow.setContent(this.containerElement),this.open(this.state.infoWindow,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoWindow))})}componentDidMount(){var t=new google.maps.InfoWindow(this.props.options);this.containerElement=document.createElement("div"),this.registeredEvents=Ti({updaterMap:Pq,eventMap:Tq,prevProps:{},nextProps:this.props,instance:t}),this.setState(()=>({infoWindow:t}),this.setInfoWindowCallback)}componentDidUpdate(t){this.state.infoWindow!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:Pq,eventMap:Tq,prevProps:t,nextProps:this.props,instance:this.state.infoWindow}))}componentWillUnmount(){this.state.infoWindow!==null&&(Li(this.registeredEvents),this.props.onUnmount&&this.props.onUnmount(this.state.infoWindow),this.state.infoWindow.close())}render(){return this.containerElement?cm.createPortal(R.Children.only(this.props.children),this.containerElement):null}}it(cqe,"contextType",Si);function Dq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function kC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Dq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Dq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Lq={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},Rq={draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},path(e,t){e.setPath(t)},visible(e,t){e.setVisible(t)}},uqe={};function hqe(e){var{options:t,draggable:i,editable:r,visible:n,path:s,onDblClick:a,onDragEnd:o,onDragStart:l,onMouseDown:c,onMouseMove:u,onMouseOut:h,onMouseOver:d,onMouseUp:p,onRightClick:f,onClick:v,onDrag:m,onLoad:g,onUnmount:y}=e,x=R.useContext(Si),[_,M]=R.useState(null),[S,E]=R.useState(null),[A,P]=R.useState(null),[C,D]=R.useState(null),[N,U]=R.useState(null),[I,G]=R.useState(null),[Q,Y]=R.useState(null),[O,V]=R.useState(null),[F,W]=R.useState(null),[ee,ae]=R.useState(null),[K,$]=R.useState(null),[ie,ye]=R.useState(null);return R.useEffect(()=>{_!==null&&_.setMap(x)},[x]),R.useEffect(()=>{typeof t<"u"&&_!==null&&_.setOptions(t)},[_,t]),R.useEffect(()=>{typeof i<"u"&&_!==null&&_.setDraggable(i)},[_,i]),R.useEffect(()=>{typeof r<"u"&&_!==null&&_.setEditable(r)},[_,r]),R.useEffect(()=>{typeof n<"u"&&_!==null&&_.setVisible(n)},[_,n]),R.useEffect(()=>{typeof s<"u"&&_!==null&&_.setPath(s)},[_,s]),R.useEffect(()=>{_&&a&&(S!==null&&google.maps.event.removeListener(S),E(google.maps.event.addListener(_,"dblclick",a)))},[a]),R.useEffect(()=>{_&&o&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(_,"dragend",o)))},[o]),R.useEffect(()=>{_&&l&&(C!==null&&google.maps.event.removeListener(C),D(google.maps.event.addListener(_,"dragstart",l)))},[l]),R.useEffect(()=>{_&&c&&(N!==null&&google.maps.event.removeListener(N),U(google.maps.event.addListener(_,"mousedown",c)))},[c]),R.useEffect(()=>{_&&u&&(I!==null&&google.maps.event.removeListener(I),G(google.maps.event.addListener(_,"mousemove",u)))},[u]),R.useEffect(()=>{_&&h&&(Q!==null&&google.maps.event.removeListener(Q),Y(google.maps.event.addListener(_,"mouseout",h)))},[h]),R.useEffect(()=>{_&&d&&(O!==null&&google.maps.event.removeListener(O),V(google.maps.event.addListener(_,"mouseover",d)))},[d]),R.useEffect(()=>{_&&p&&(F!==null&&google.maps.event.removeListener(F),W(google.maps.event.addListener(_,"mouseup",p)))},[p]),R.useEffect(()=>{_&&f&&(ee!==null&&google.maps.event.removeListener(ee),ae(google.maps.event.addListener(_,"rightclick",f)))},[f]),R.useEffect(()=>{_&&v&&(K!==null&&google.maps.event.removeListener(K),$(google.maps.event.addListener(_,"click",v)))},[v]),R.useEffect(()=>{_&&m&&(ie!==null&&google.maps.event.removeListener(ie),ye(google.maps.event.addListener(_,"drag",m)))},[m]),R.useEffect(()=>{var pe=new google.maps.Polyline(kC(kC({},t||uqe),{},{map:x}));return s&&pe.setPath(s),typeof n<"u"&&pe.setVisible(n),typeof r<"u"&&pe.setEditable(r),typeof i<"u"&&pe.setDraggable(i),a&&E(google.maps.event.addListener(pe,"dblclick",a)),o&&P(google.maps.event.addListener(pe,"dragend",o)),l&&D(google.maps.event.addListener(pe,"dragstart",l)),c&&U(google.maps.event.addListener(pe,"mousedown",c)),u&&G(google.maps.event.addListener(pe,"mousemove",u)),h&&Y(google.maps.event.addListener(pe,"mouseout",h)),d&&V(google.maps.event.addListener(pe,"mouseover",d)),p&&W(google.maps.event.addListener(pe,"mouseup",p)),f&&ae(google.maps.event.addListener(pe,"rightclick",f)),v&&$(google.maps.event.addListener(pe,"click",v)),m&&ye(google.maps.event.addListener(pe,"drag",m)),M(pe),g&&g(pe),()=>{S!==null&&google.maps.event.removeListener(S),A!==null&&google.maps.event.removeListener(A),C!==null&&google.maps.event.removeListener(C),N!==null&&google.maps.event.removeListener(N),I!==null&&google.maps.event.removeListener(I),Q!==null&&google.maps.event.removeListener(Q),O!==null&&google.maps.event.removeListener(O),F!==null&&google.maps.event.removeListener(F),ee!==null&&google.maps.event.removeListener(ee),K!==null&&google.maps.event.removeListener(K),y&&y(pe),pe.setMap(null)}},[]),null}R.memo(hqe);class dqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{polyline:null}),it(this,"setPolylineCallback",()=>{this.state.polyline!==null&&this.props.onLoad&&this.props.onLoad(this.state.polyline)})}componentDidMount(){var t=new google.maps.Polyline(kC(kC({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:Rq,eventMap:Lq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{polyline:t}},this.setPolylineCallback)}componentDidUpdate(t){this.state.polyline!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:Rq,eventMap:Lq,prevProps:t,nextProps:this.props,instance:this.state.polyline}))}componentWillUnmount(){this.state.polyline!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.polyline),Li(this.registeredEvents),this.state.polyline.setMap(null))}render(){return null}}it(dqe,"contextType",Si);function Iq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Oq(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Iq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Iq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Nq={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},zq={draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},path(e,t){e.setPath(t)},paths(e,t){e.setPaths(t)},visible(e,t){e.setVisible(t)}};function pqe(e){var{options:t,draggable:i,editable:r,visible:n,path:s,paths:a,onDblClick:o,onDragEnd:l,onDragStart:c,onMouseDown:u,onMouseMove:h,onMouseOut:d,onMouseOver:p,onMouseUp:f,onRightClick:v,onClick:m,onDrag:g,onLoad:y,onUnmount:x,onEdit:_}=e,M=R.useContext(Si),[S,E]=R.useState(null),[A,P]=R.useState(null),[C,D]=R.useState(null),[N,U]=R.useState(null),[I,G]=R.useState(null),[Q,Y]=R.useState(null),[O,V]=R.useState(null),[F,W]=R.useState(null),[ee,ae]=R.useState(null),[K,$]=R.useState(null),[ie,ye]=R.useState(null),[pe,me]=R.useState(null);return R.useEffect(()=>{S!==null&&S.setMap(M)},[M]),R.useEffect(()=>{typeof t<"u"&&S!==null&&S.setOptions(t)},[S,t]),R.useEffect(()=>{typeof i<"u"&&S!==null&&S.setDraggable(i)},[S,i]),R.useEffect(()=>{typeof r<"u"&&S!==null&&S.setEditable(r)},[S,r]),R.useEffect(()=>{typeof n<"u"&&S!==null&&S.setVisible(n)},[S,n]),R.useEffect(()=>{typeof s<"u"&&S!==null&&S.setPath(s)},[S,s]),R.useEffect(()=>{typeof a<"u"&&S!==null&&S.setPaths(a)},[S,a]),R.useEffect(()=>{S&&typeof o=="function"&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(S,"dblclick",o)))},[o]),R.useEffect(()=>{S&&(google.maps.event.addListener(S.getPath(),"insert_at",()=>{_==null||_(S)}),google.maps.event.addListener(S.getPath(),"set_at",()=>{_==null||_(S)}),google.maps.event.addListener(S.getPath(),"remove_at",()=>{_==null||_(S)}))},[S,_]),R.useEffect(()=>{S&&typeof l=="function"&&(C!==null&&google.maps.event.removeListener(C),D(google.maps.event.addListener(S,"dragend",l)))},[l]),R.useEffect(()=>{S&&typeof c=="function"&&(N!==null&&google.maps.event.removeListener(N),U(google.maps.event.addListener(S,"dragstart",c)))},[c]),R.useEffect(()=>{S&&typeof u=="function"&&(I!==null&&google.maps.event.removeListener(I),G(google.maps.event.addListener(S,"mousedown",u)))},[u]),R.useEffect(()=>{S&&typeof h=="function"&&(Q!==null&&google.maps.event.removeListener(Q),Y(google.maps.event.addListener(S,"mousemove",h)))},[h]),R.useEffect(()=>{S&&typeof d=="function"&&(O!==null&&google.maps.event.removeListener(O),V(google.maps.event.addListener(S,"mouseout",d)))},[d]),R.useEffect(()=>{S&&typeof p=="function"&&(F!==null&&google.maps.event.removeListener(F),W(google.maps.event.addListener(S,"mouseover",p)))},[p]),R.useEffect(()=>{S&&typeof f=="function"&&(ee!==null&&google.maps.event.removeListener(ee),ae(google.maps.event.addListener(S,"mouseup",f)))},[f]),R.useEffect(()=>{S&&typeof v=="function"&&(K!==null&&google.maps.event.removeListener(K),$(google.maps.event.addListener(S,"rightclick",v)))},[v]),R.useEffect(()=>{S&&typeof m=="function"&&(ie!==null&&google.maps.event.removeListener(ie),ye(google.maps.event.addListener(S,"click",m)))},[m]),R.useEffect(()=>{S&&typeof g=="function"&&(pe!==null&&google.maps.event.removeListener(pe),me(google.maps.event.addListener(S,"drag",g)))},[g]),R.useEffect(()=>{var ge=new google.maps.Polygon(Oq(Oq({},t),{},{map:M}));return s&&ge.setPath(s),a&&ge.setPaths(a),typeof n<"u"&&ge.setVisible(n),typeof r<"u"&&ge.setEditable(r),typeof i<"u"&&ge.setDraggable(i),o&&P(google.maps.event.addListener(ge,"dblclick",o)),l&&D(google.maps.event.addListener(ge,"dragend",l)),c&&U(google.maps.event.addListener(ge,"dragstart",c)),u&&G(google.maps.event.addListener(ge,"mousedown",u)),h&&Y(google.maps.event.addListener(ge,"mousemove",h)),d&&V(google.maps.event.addListener(ge,"mouseout",d)),p&&W(google.maps.event.addListener(ge,"mouseover",p)),f&&ae(google.maps.event.addListener(ge,"mouseup",f)),v&&$(google.maps.event.addListener(ge,"rightclick",v)),m&&ye(google.maps.event.addListener(ge,"click",m)),g&&me(google.maps.event.addListener(ge,"drag",g)),E(ge),y&&y(ge),()=>{A!==null&&google.maps.event.removeListener(A),C!==null&&google.maps.event.removeListener(C),N!==null&&google.maps.event.removeListener(N),I!==null&&google.maps.event.removeListener(I),Q!==null&&google.maps.event.removeListener(Q),O!==null&&google.maps.event.removeListener(O),F!==null&&google.maps.event.removeListener(F),ee!==null&&google.maps.event.removeListener(ee),K!==null&&google.maps.event.removeListener(K),ie!==null&&google.maps.event.removeListener(ie),x&&x(ge),ge.setMap(null)}},[]),null}R.memo(pqe);class fqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[])}componentDidMount(){var t=this.props.options||{};this.polygon=new google.maps.Polygon(t),this.polygon.setMap(this.context),this.registeredEvents=Ti({updaterMap:zq,eventMap:Nq,prevProps:{},nextProps:this.props,instance:this.polygon}),this.props.onLoad&&this.props.onLoad(this.polygon)}componentDidUpdate(t){this.polygon&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:zq,eventMap:Nq,prevProps:t,nextProps:this.props,instance:this.polygon}))}componentWillUnmount(){this.polygon&&(this.props.onUnmount&&this.props.onUnmount(this.polygon),Li(this.registeredEvents),this.polygon&&this.polygon.setMap(null))}render(){return null}}it(fqe,"contextType",Si);function Bq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function UC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Bq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Bq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var kq={onBoundsChanged:"bounds_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},Uq={bounds(e,t){e.setBounds(t)},draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},visible(e,t){e.setVisible(t)}};function mqe(e){var{options:t,bounds:i,draggable:r,editable:n,visible:s,onDblClick:a,onDragEnd:o,onDragStart:l,onMouseDown:c,onMouseMove:u,onMouseOut:h,onMouseOver:d,onMouseUp:p,onRightClick:f,onClick:v,onDrag:m,onBoundsChanged:g,onLoad:y,onUnmount:x}=e,_=R.useContext(Si),[M,S]=R.useState(null),[E,A]=R.useState(null),[P,C]=R.useState(null),[D,N]=R.useState(null),[U,I]=R.useState(null),[G,Q]=R.useState(null),[Y,O]=R.useState(null),[V,F]=R.useState(null),[W,ee]=R.useState(null),[ae,K]=R.useState(null),[$,ie]=R.useState(null),[ye,pe]=R.useState(null),[me,ge]=R.useState(null);return R.useEffect(()=>{M!==null&&M.setMap(_)},[_]),R.useEffect(()=>{typeof t<"u"&&M!==null&&M.setOptions(t)},[M,t]),R.useEffect(()=>{typeof r<"u"&&M!==null&&M.setDraggable(r)},[M,r]),R.useEffect(()=>{typeof n<"u"&&M!==null&&M.setEditable(n)},[M,n]),R.useEffect(()=>{typeof s<"u"&&M!==null&&M.setVisible(s)},[M,s]),R.useEffect(()=>{typeof i<"u"&&M!==null&&M.setBounds(i)},[M,i]),R.useEffect(()=>{M&&a&&(E!==null&&google.maps.event.removeListener(E),A(google.maps.event.addListener(M,"dblclick",a)))},[a]),R.useEffect(()=>{M&&o&&(P!==null&&google.maps.event.removeListener(P),C(google.maps.event.addListener(M,"dragend",o)))},[o]),R.useEffect(()=>{M&&l&&(D!==null&&google.maps.event.removeListener(D),N(google.maps.event.addListener(M,"dragstart",l)))},[l]),R.useEffect(()=>{M&&c&&(U!==null&&google.maps.event.removeListener(U),I(google.maps.event.addListener(M,"mousedown",c)))},[c]),R.useEffect(()=>{M&&u&&(G!==null&&google.maps.event.removeListener(G),Q(google.maps.event.addListener(M,"mousemove",u)))},[u]),R.useEffect(()=>{M&&h&&(Y!==null&&google.maps.event.removeListener(Y),O(google.maps.event.addListener(M,"mouseout",h)))},[h]),R.useEffect(()=>{M&&d&&(V!==null&&google.maps.event.removeListener(V),F(google.maps.event.addListener(M,"mouseover",d)))},[d]),R.useEffect(()=>{M&&p&&(W!==null&&google.maps.event.removeListener(W),ee(google.maps.event.addListener(M,"mouseup",p)))},[p]),R.useEffect(()=>{M&&f&&(ae!==null&&google.maps.event.removeListener(ae),K(google.maps.event.addListener(M,"rightclick",f)))},[f]),R.useEffect(()=>{M&&v&&($!==null&&google.maps.event.removeListener($),ie(google.maps.event.addListener(M,"click",v)))},[v]),R.useEffect(()=>{M&&m&&(ye!==null&&google.maps.event.removeListener(ye),pe(google.maps.event.addListener(M,"drag",m)))},[m]),R.useEffect(()=>{M&&g&&(me!==null&&google.maps.event.removeListener(me),ge(google.maps.event.addListener(M,"bounds_changed",g)))},[g]),R.useEffect(()=>{var xe=new google.maps.Rectangle(UC(UC({},t),{},{map:_}));return typeof s<"u"&&xe.setVisible(s),typeof n<"u"&&xe.setEditable(n),typeof r<"u"&&xe.setDraggable(r),typeof i<"u"&&xe.setBounds(i),a&&A(google.maps.event.addListener(xe,"dblclick",a)),o&&C(google.maps.event.addListener(xe,"dragend",o)),l&&N(google.maps.event.addListener(xe,"dragstart",l)),c&&I(google.maps.event.addListener(xe,"mousedown",c)),u&&Q(google.maps.event.addListener(xe,"mousemove",u)),h&&O(google.maps.event.addListener(xe,"mouseout",h)),d&&F(google.maps.event.addListener(xe,"mouseover",d)),p&&ee(google.maps.event.addListener(xe,"mouseup",p)),f&&K(google.maps.event.addListener(xe,"rightclick",f)),v&&ie(google.maps.event.addListener(xe,"click",v)),m&&pe(google.maps.event.addListener(xe,"drag",m)),g&&ge(google.maps.event.addListener(xe,"bounds_changed",g)),S(xe),y&&y(xe),()=>{E!==null&&google.maps.event.removeListener(E),P!==null&&google.maps.event.removeListener(P),D!==null&&google.maps.event.removeListener(D),U!==null&&google.maps.event.removeListener(U),G!==null&&google.maps.event.removeListener(G),Y!==null&&google.maps.event.removeListener(Y),V!==null&&google.maps.event.removeListener(V),W!==null&&google.maps.event.removeListener(W),ae!==null&&google.maps.event.removeListener(ae),$!==null&&google.maps.event.removeListener($),ye!==null&&google.maps.event.removeListener(ye),me!==null&&google.maps.event.removeListener(me),x&&x(xe),xe.setMap(null)}},[]),null}R.memo(mqe);class gqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{rectangle:null}),it(this,"setRectangleCallback",()=>{this.state.rectangle!==null&&this.props.onLoad&&this.props.onLoad(this.state.rectangle)})}componentDidMount(){var t=new google.maps.Rectangle(UC(UC({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:Uq,eventMap:kq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{rectangle:t}},this.setRectangleCallback)}componentDidUpdate(t){this.state.rectangle!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:Uq,eventMap:kq,prevProps:t,nextProps:this.props,instance:this.state.rectangle}))}componentWillUnmount(){this.state.rectangle!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.rectangle),Li(this.registeredEvents),this.state.rectangle.setMap(null))}render(){return null}}it(gqe,"contextType",Si);function Fq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function FC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Fq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Fq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Vq={onCenterChanged:"center_changed",onRadiusChanged:"radius_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},jq={center(e,t){e.setCenter(t)},draggable(e,t){e.setDraggable(t)},editable(e,t){e.setEditable(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},radius(e,t){e.setRadius(t)},visible(e,t){e.setVisible(t)}},vqe={};function yqe(e){var{options:t,center:i,radius:r,draggable:n,editable:s,visible:a,onDblClick:o,onDragEnd:l,onDragStart:c,onMouseDown:u,onMouseMove:h,onMouseOut:d,onMouseOver:p,onMouseUp:f,onRightClick:v,onClick:m,onDrag:g,onCenterChanged:y,onRadiusChanged:x,onLoad:_,onUnmount:M}=e,S=R.useContext(Si),[E,A]=R.useState(null),[P,C]=R.useState(null),[D,N]=R.useState(null),[U,I]=R.useState(null),[G,Q]=R.useState(null),[Y,O]=R.useState(null),[V,F]=R.useState(null),[W,ee]=R.useState(null),[ae,K]=R.useState(null),[$,ie]=R.useState(null),[ye,pe]=R.useState(null),[me,ge]=R.useState(null),[xe,te]=R.useState(null),[we,Ce]=R.useState(null);return R.useEffect(()=>{E!==null&&E.setMap(S)},[S]),R.useEffect(()=>{typeof t<"u"&&E!==null&&E.setOptions(t)},[E,t]),R.useEffect(()=>{typeof n<"u"&&E!==null&&E.setDraggable(n)},[E,n]),R.useEffect(()=>{typeof s<"u"&&E!==null&&E.setEditable(s)},[E,s]),R.useEffect(()=>{typeof a<"u"&&E!==null&&E.setVisible(a)},[E,a]),R.useEffect(()=>{typeof r=="number"&&E!==null&&E.setRadius(r)},[E,r]),R.useEffect(()=>{typeof i<"u"&&E!==null&&E.setCenter(i)},[E,i]),R.useEffect(()=>{E&&o&&(P!==null&&google.maps.event.removeListener(P),C(google.maps.event.addListener(E,"dblclick",o)))},[o]),R.useEffect(()=>{E&&l&&(D!==null&&google.maps.event.removeListener(D),N(google.maps.event.addListener(E,"dragend",l)))},[l]),R.useEffect(()=>{E&&c&&(U!==null&&google.maps.event.removeListener(U),I(google.maps.event.addListener(E,"dragstart",c)))},[c]),R.useEffect(()=>{E&&u&&(G!==null&&google.maps.event.removeListener(G),Q(google.maps.event.addListener(E,"mousedown",u)))},[u]),R.useEffect(()=>{E&&h&&(Y!==null&&google.maps.event.removeListener(Y),O(google.maps.event.addListener(E,"mousemove",h)))},[h]),R.useEffect(()=>{E&&d&&(V!==null&&google.maps.event.removeListener(V),F(google.maps.event.addListener(E,"mouseout",d)))},[d]),R.useEffect(()=>{E&&p&&(W!==null&&google.maps.event.removeListener(W),ee(google.maps.event.addListener(E,"mouseover",p)))},[p]),R.useEffect(()=>{E&&f&&(ae!==null&&google.maps.event.removeListener(ae),K(google.maps.event.addListener(E,"mouseup",f)))},[f]),R.useEffect(()=>{E&&v&&($!==null&&google.maps.event.removeListener($),ie(google.maps.event.addListener(E,"rightclick",v)))},[v]),R.useEffect(()=>{E&&m&&(ye!==null&&google.maps.event.removeListener(ye),pe(google.maps.event.addListener(E,"click",m)))},[m]),R.useEffect(()=>{E&&g&&(me!==null&&google.maps.event.removeListener(me),ge(google.maps.event.addListener(E,"drag",g)))},[g]),R.useEffect(()=>{E&&y&&(xe!==null&&google.maps.event.removeListener(xe),te(google.maps.event.addListener(E,"center_changed",y)))},[m]),R.useEffect(()=>{E&&x&&(we!==null&&google.maps.event.removeListener(we),Ce(google.maps.event.addListener(E,"radius_changed",x)))},[x]),R.useEffect(()=>{var Se=new google.maps.Circle(FC(FC({},t||vqe),{},{map:S}));return typeof r=="number"&&Se.setRadius(r),typeof i<"u"&&Se.setCenter(i),typeof r=="number"&&Se.setRadius(r),typeof a<"u"&&Se.setVisible(a),typeof s<"u"&&Se.setEditable(s),typeof n<"u"&&Se.setDraggable(n),o&&C(google.maps.event.addListener(Se,"dblclick",o)),l&&N(google.maps.event.addListener(Se,"dragend",l)),c&&I(google.maps.event.addListener(Se,"dragstart",c)),u&&Q(google.maps.event.addListener(Se,"mousedown",u)),h&&O(google.maps.event.addListener(Se,"mousemove",h)),d&&F(google.maps.event.addListener(Se,"mouseout",d)),p&&ee(google.maps.event.addListener(Se,"mouseover",p)),f&&K(google.maps.event.addListener(Se,"mouseup",f)),v&&ie(google.maps.event.addListener(Se,"rightclick",v)),m&&pe(google.maps.event.addListener(Se,"click",m)),g&&ge(google.maps.event.addListener(Se,"drag",g)),y&&te(google.maps.event.addListener(Se,"center_changed",y)),x&&Ce(google.maps.event.addListener(Se,"radius_changed",x)),A(Se),_&&_(Se),()=>{P!==null&&google.maps.event.removeListener(P),D!==null&&google.maps.event.removeListener(D),U!==null&&google.maps.event.removeListener(U),G!==null&&google.maps.event.removeListener(G),Y!==null&&google.maps.event.removeListener(Y),V!==null&&google.maps.event.removeListener(V),W!==null&&google.maps.event.removeListener(W),ae!==null&&google.maps.event.removeListener(ae),$!==null&&google.maps.event.removeListener($),ye!==null&&google.maps.event.removeListener(ye),xe!==null&&google.maps.event.removeListener(xe),we!==null&&google.maps.event.removeListener(we),M&&M(Se),Se.setMap(null)}},[]),null}R.memo(yqe);class xqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{circle:null}),it(this,"setCircleCallback",()=>{this.state.circle!==null&&this.props.onLoad&&this.props.onLoad(this.state.circle)})}componentDidMount(){var t=new google.maps.Circle(FC(FC({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:jq,eventMap:Vq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{circle:t}},this.setCircleCallback)}componentDidUpdate(t){this.state.circle!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:jq,eventMap:Vq,prevProps:t,nextProps:this.props,instance:this.state.circle}))}componentWillUnmount(){if(this.state.circle!==null){var t;this.props.onUnmount&&this.props.onUnmount(this.state.circle),Li(this.registeredEvents),(t=this.state.circle)===null||t===void 0||t.setMap(null)}}render(){return null}}it(xqe,"contextType",Si);function Hq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function VC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Hq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Hq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Gq={onClick:"click",onDblClick:"dblclick",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick",onAddFeature:"addfeature",onRemoveFeature:"removefeature",onRemoveProperty:"removeproperty",onSetGeometry:"setgeometry",onSetProperty:"setproperty"},Wq={add(e,t){e.add(t)},addgeojson(e,t,i){e.addGeoJson(t,i)},contains(e,t){e.contains(t)},foreach(e,t){e.forEach(t)},loadgeojson(e,t,i,r){e.loadGeoJson(t,i,r)},overridestyle(e,t,i){e.overrideStyle(t,i)},remove(e,t){e.remove(t)},revertstyle(e,t){e.revertStyle(t)},controlposition(e,t){e.setControlPosition(t)},controls(e,t){e.setControls(t)},drawingmode(e,t){e.setDrawingMode(t)},map(e,t){e.setMap(t)},style(e,t){e.setStyle(t)},togeojson(e,t){e.toGeoJson(t)}};function bqe(e){var{options:t,onClick:i,onDblClick:r,onMouseDown:n,onMouseMove:s,onMouseOut:a,onMouseOver:o,onMouseUp:l,onRightClick:c,onAddFeature:u,onRemoveFeature:h,onRemoveProperty:d,onSetGeometry:p,onSetProperty:f,onLoad:v,onUnmount:m}=e,g=R.useContext(Si),[y,x]=R.useState(null),[_,M]=R.useState(null),[S,E]=R.useState(null),[A,P]=R.useState(null),[C,D]=R.useState(null),[N,U]=R.useState(null),[I,G]=R.useState(null),[Q,Y]=R.useState(null),[O,V]=R.useState(null),[F,W]=R.useState(null),[ee,ae]=R.useState(null),[K,$]=R.useState(null),[ie,ye]=R.useState(null),[pe,me]=R.useState(null);return R.useEffect(()=>{y!==null&&y.setMap(g)},[g]),R.useEffect(()=>{y&&r&&(_!==null&&google.maps.event.removeListener(_),M(google.maps.event.addListener(y,"dblclick",r)))},[r]),R.useEffect(()=>{y&&n&&(S!==null&&google.maps.event.removeListener(S),E(google.maps.event.addListener(y,"mousedown",n)))},[n]),R.useEffect(()=>{y&&s&&(A!==null&&google.maps.event.removeListener(A),P(google.maps.event.addListener(y,"mousemove",s)))},[s]),R.useEffect(()=>{y&&a&&(C!==null&&google.maps.event.removeListener(C),D(google.maps.event.addListener(y,"mouseout",a)))},[a]),R.useEffect(()=>{y&&o&&(N!==null&&google.maps.event.removeListener(N),U(google.maps.event.addListener(y,"mouseover",o)))},[o]),R.useEffect(()=>{y&&l&&(I!==null&&google.maps.event.removeListener(I),G(google.maps.event.addListener(y,"mouseup",l)))},[l]),R.useEffect(()=>{y&&c&&(Q!==null&&google.maps.event.removeListener(Q),Y(google.maps.event.addListener(y,"rightclick",c)))},[c]),R.useEffect(()=>{y&&i&&(O!==null&&google.maps.event.removeListener(O),V(google.maps.event.addListener(y,"click",i)))},[i]),R.useEffect(()=>{y&&u&&(F!==null&&google.maps.event.removeListener(F),W(google.maps.event.addListener(y,"addfeature",u)))},[u]),R.useEffect(()=>{y&&h&&(ee!==null&&google.maps.event.removeListener(ee),ae(google.maps.event.addListener(y,"removefeature",h)))},[h]),R.useEffect(()=>{y&&d&&(K!==null&&google.maps.event.removeListener(K),$(google.maps.event.addListener(y,"removeproperty",d)))},[d]),R.useEffect(()=>{y&&p&&(ie!==null&&google.maps.event.removeListener(ie),ye(google.maps.event.addListener(y,"setgeometry",p)))},[p]),R.useEffect(()=>{y&&f&&(pe!==null&&google.maps.event.removeListener(pe),me(google.maps.event.addListener(y,"setproperty",f)))},[f]),R.useEffect(()=>{if(g!==null){var ge=new google.maps.Data(VC(VC({},t),{},{map:g}));r&&M(google.maps.event.addListener(ge,"dblclick",r)),n&&E(google.maps.event.addListener(ge,"mousedown",n)),s&&P(google.maps.event.addListener(ge,"mousemove",s)),a&&D(google.maps.event.addListener(ge,"mouseout",a)),o&&U(google.maps.event.addListener(ge,"mouseover",o)),l&&G(google.maps.event.addListener(ge,"mouseup",l)),c&&Y(google.maps.event.addListener(ge,"rightclick",c)),i&&V(google.maps.event.addListener(ge,"click",i)),u&&W(google.maps.event.addListener(ge,"addfeature",u)),h&&ae(google.maps.event.addListener(ge,"removefeature",h)),d&&$(google.maps.event.addListener(ge,"removeproperty",d)),p&&ye(google.maps.event.addListener(ge,"setgeometry",p)),f&&me(google.maps.event.addListener(ge,"setproperty",f)),x(ge),v&&v(ge)}return()=>{y&&(_!==null&&google.maps.event.removeListener(_),S!==null&&google.maps.event.removeListener(S),A!==null&&google.maps.event.removeListener(A),C!==null&&google.maps.event.removeListener(C),N!==null&&google.maps.event.removeListener(N),I!==null&&google.maps.event.removeListener(I),Q!==null&&google.maps.event.removeListener(Q),O!==null&&google.maps.event.removeListener(O),F!==null&&google.maps.event.removeListener(F),ee!==null&&google.maps.event.removeListener(ee),K!==null&&google.maps.event.removeListener(K),ie!==null&&google.maps.event.removeListener(ie),pe!==null&&google.maps.event.removeListener(pe),m&&m(y),y.setMap(null))}},[]),null}R.memo(bqe);class wqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{data:null}),it(this,"setDataCallback",()=>{this.state.data!==null&&this.props.onLoad&&this.props.onLoad(this.state.data)})}componentDidMount(){if(this.context!==null){var t=new google.maps.Data(VC(VC({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:Wq,eventMap:Gq,prevProps:{},nextProps:this.props,instance:t}),this.setState(()=>({data:t}),this.setDataCallback)}}componentDidUpdate(t){this.state.data!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:Wq,eventMap:Gq,prevProps:t,nextProps:this.props,instance:this.state.data}))}componentWillUnmount(){this.state.data!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.data),Li(this.registeredEvents),this.state.data&&this.state.data.setMap(null))}render(){return null}}it(wqe,"contextType",Si);function Xq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function qq(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Xq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Xq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var Yq={onClick:"click",onDefaultViewportChanged:"defaultviewport_changed",onStatusChanged:"status_changed"},Zq={options(e,t){e.setOptions(t)},url(e,t){e.setUrl(t)},zIndex(e,t){e.setZIndex(t)}};class _qe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{kmlLayer:null}),it(this,"setKmlLayerCallback",()=>{this.state.kmlLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.kmlLayer)})}componentDidMount(){var t=new google.maps.KmlLayer(qq(qq({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:Zq,eventMap:Yq,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{kmlLayer:t}},this.setKmlLayerCallback)}componentDidUpdate(t){this.state.kmlLayer!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:Zq,eventMap:Yq,prevProps:t,nextProps:this.props,instance:this.state.kmlLayer}))}componentWillUnmount(){this.state.kmlLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.kmlLayer),Li(this.registeredEvents),this.state.kmlLayer.setMap(null))}render(){return null}}it(_qe,"contextType",Si);function _ae(e,t){return typeof t=="function"?t(e.offsetWidth,e.offsetHeight):{x:0,y:0}}function Sqe(e,t){return new t(e.lat,e.lng)}function Mqe(e,t){return new t(new google.maps.LatLng(e.ne.lat,e.ne.lng),new google.maps.LatLng(e.sw.lat,e.sw.lng))}function Eqe(e,t,i){return e instanceof t?e:i(e,t)}function Aqe(e,t,i){return e instanceof t?e:i(e,t)}function Cqe(e,t,i){var r=e&&e.fromLatLngToDivPixel(i.getNorthEast()),n=e&&e.fromLatLngToDivPixel(i.getSouthWest());return r&&n?{left:"".concat(n.x+t.x,"px"),top:"".concat(r.y+t.y,"px"),width:"".concat(r.x-n.x-t.x,"px"),height:"".concat(n.y-r.y-t.y,"px")}:{left:"-9999px",top:"-9999px"}}function Tqe(e,t,i){var r=e&&e.fromLatLngToDivPixel(i);if(r){var{x:n,y:s}=r;return{left:"".concat(n+t.x,"px"),top:"".concat(s+t.y,"px")}}return{left:"-9999px",top:"-9999px"}}function Sae(e,t,i,r){return i!==void 0?Cqe(e,t,Aqe(i,google.maps.LatLngBounds,Mqe)):Tqe(e,t,Eqe(r,google.maps.LatLng,Sqe))}function Pqe(e,t){return e.left===t.left&&e.top===t.top&&e.width===t.height&&e.height===t.height}function Qq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Dqe(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Qq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function Lqe(e,t,i,r,n){class s extends google.maps.OverlayView{constructor(o,l,c,u){super(),this.container=o,this.pane=l,this.position=c,this.bounds=u}onAdd(){var o,l=(o=this.getPanes())===null||o===void 0?void 0:o[this.pane];l==null||l.appendChild(this.container)}draw(){var o=this.getProjection(),l=Dqe({},this.container?_ae(this.container,n):{x:0,y:0}),c=Sae(o,l,this.bounds,this.position);for(var[u,h]of Object.entries(c))this.container.style[u]=h}onRemove(){this.container.parentNode!==null&&this.container.parentNode.removeChild(this.container)}}return new s(e,t,i,r)}function Kq(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function Rqe(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Kq(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Kq(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}function Jq(e){if(!e)return"";var t=e instanceof google.maps.LatLng?e:new google.maps.LatLng(e.lat,e.lng);return t+""}function $q(e){if(!e)return"";var t=e instanceof google.maps.LatLngBounds?e:new google.maps.LatLngBounds(new google.maps.LatLng(e.south,e.east),new google.maps.LatLng(e.north,e.west));return t+""}function Iqe(e){var{position:t,bounds:i,mapPaneName:r,zIndex:n,onLoad:s,onUnmount:a,getPixelPositionOffset:o,children:l}=e,c=R.useContext(Si),u=R.useMemo(()=>{var d=document.createElement("div");return d.style.position="absolute",d},[]),h=R.useMemo(()=>Lqe(u,r,t,i,o),[u,r,t,i]);return R.useEffect(()=>(s==null||s(h),h==null||h.setMap(c),()=>{a==null||a(h),h==null||h.setMap(null)}),[c,h]),R.useEffect(()=>{u.style.zIndex="".concat(n)},[n,u]),cm.createPortal(l,u)}R.memo(Iqe);class Z0 extends R.PureComponent{constructor(t){super(t),it(this,"state",{paneEl:null,containerStyle:{position:"absolute"}}),it(this,"updatePane",()=>{var r=this.props.mapPaneName,n=this.overlayView.getPanes();qn(!!r,"OverlayView requires props.mapPaneName but got %s",r),n?this.setState({paneEl:n[r]}):this.setState({paneEl:null})}),it(this,"onAdd",()=>{var r,n;this.updatePane(),(r=(n=this.props).onLoad)===null||r===void 0||r.call(n,this.overlayView)}),it(this,"onPositionElement",()=>{var r=this.overlayView.getProjection(),n=Rqe({x:0,y:0},this.containerRef.current?_ae(this.containerRef.current,this.props.getPixelPositionOffset):{}),s=Sae(r,n,this.props.bounds,this.props.position);if(!Pqe(s,{left:this.state.containerStyle.left,top:this.state.containerStyle.top,width:this.state.containerStyle.width,height:this.state.containerStyle.height})){var a,o,l,c;this.setState({containerStyle:{top:(a=s.top)!==null&&a!==void 0?a:0,left:(o=s.left)!==null&&o!==void 0?o:0,width:(l=s.width)!==null&&l!==void 0?l:0,height:(c=s.height)!==null&&c!==void 0?c:0,position:"absolute"}})}}),it(this,"draw",()=>{this.onPositionElement()}),it(this,"onRemove",()=>{var r,n;this.setState(()=>({paneEl:null})),(r=(n=this.props).onUnmount)===null||r===void 0||r.call(n,this.overlayView)}),this.containerRef=R.createRef();var i=new google.maps.OverlayView;i.onAdd=this.onAdd,i.draw=this.draw,i.onRemove=this.onRemove,this.overlayView=i}componentDidMount(){this.overlayView.setMap(this.context)}componentDidUpdate(t){var i=Jq(t.position),r=Jq(this.props.position),n=$q(t.bounds),s=$q(this.props.bounds);(i!==r||n!==s)&&this.overlayView.draw(),t.mapPaneName!==this.props.mapPaneName&&this.updatePane()}componentWillUnmount(){this.overlayView.setMap(null)}render(){var t=this.state.paneEl;return t?cm.createPortal(j.jsx("div",{ref:this.containerRef,style:this.state.containerStyle,children:R.Children.only(this.props.children)}),t):null}}it(Z0,"FLOAT_PANE","floatPane");it(Z0,"MAP_PANE","mapPane");it(Z0,"MARKER_LAYER","markerLayer");it(Z0,"OVERLAY_LAYER","overlayLayer");it(Z0,"OVERLAY_MOUSE_TARGET","overlayMouseTarget");it(Z0,"contextType",Si);function Oqe(){}function eY(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function tY(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?eY(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eY(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var iY={onDblClick:"dblclick",onClick:"click"},rY={opacity(e,t){e.setOpacity(t)}};function Nqe(e){var{url:t,bounds:i,options:r,visible:n}=e,s=R.useContext(Si),a=new google.maps.LatLngBounds(new google.maps.LatLng(i.south,i.west),new google.maps.LatLng(i.north,i.east)),o=R.useMemo(()=>new google.maps.GroundOverlay(t,a,r),[]);return R.useEffect(()=>{o!==null&&o.setMap(s)},[s]),R.useEffect(()=>{typeof t<"u"&&o!==null&&(o.set("url",t),o.setMap(s))},[o,t]),R.useEffect(()=>{typeof n<"u"&&o!==null&&o.setOpacity(n?1:0)},[o,n]),R.useEffect(()=>{var l=new google.maps.LatLngBounds(new google.maps.LatLng(i.south,i.west),new google.maps.LatLng(i.north,i.east));typeof i<"u"&&o!==null&&(o.set("bounds",l),o.setMap(s))},[o,i]),null}R.memo(Nqe);class Mae extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{groundOverlay:null}),it(this,"setGroundOverlayCallback",()=>{this.state.groundOverlay!==null&&this.props.onLoad&&this.props.onLoad(this.state.groundOverlay)})}componentDidMount(){qn(!!this.props.url||!!this.props.bounds,"For GroundOverlay, url and bounds are passed in to constructor and are immutable after instantiated. This is the behavior of Google Maps JavaScript API v3 ( See https://developers.google.com/maps/documentation/javascript/reference#GroundOverlay) Hence, use the corresponding two props provided by `react-google-maps-api`, url and bounds. In some cases, you'll need the GroundOverlay component to reflect the changes of url and bounds. You can leverage the React's key property to remount the component. Typically, just `key={url}` would serve your need. See https://github.com/tomchentw/react-google-maps/issues/655");var t=new google.maps.GroundOverlay(this.props.url,this.props.bounds,tY(tY({},this.props.options),{},{map:this.context}));this.registeredEvents=Ti({updaterMap:rY,eventMap:iY,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{groundOverlay:t}},this.setGroundOverlayCallback)}componentDidUpdate(t){this.state.groundOverlay!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:rY,eventMap:iY,prevProps:t,nextProps:this.props,instance:this.state.groundOverlay}))}componentWillUnmount(){this.state.groundOverlay&&(this.props.onUnmount&&this.props.onUnmount(this.state.groundOverlay),this.state.groundOverlay.setMap(null))}render(){return null}}it(Mae,"defaultProps",{onLoad:Oqe});it(Mae,"contextType",Si);function nY(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,r)}return i}function jC(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nY(Object(i),!0).forEach(function(r){it(e,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nY(Object(i)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(i,r))})}return e}var sY={},aY={data(e,t){e.setData(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)}};function zqe(e){var{data:t,onLoad:i,onUnmount:r,options:n}=e,s=R.useContext(Si),[a,o]=R.useState(null);return R.useEffect(()=>{google.maps.visualization||qn(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} in useJsApiScript? %s',google.maps.visualization)},[]),R.useEffect(()=>{qn(!!t,"data property is required in HeatmapLayer %s",t)},[t]),R.useEffect(()=>{a!==null&&a.setMap(s)},[s]),R.useEffect(()=>{n&&a!==null&&a.setOptions(n)},[a,n]),R.useEffect(()=>{var l=new google.maps.visualization.HeatmapLayer(jC(jC({},n),{},{data:t,map:s}));return o(l),i&&i(l),()=>{a!==null&&(r&&r(a),a.setMap(null))}},[]),null}R.memo(zqe);class Bqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{heatmapLayer:null}),it(this,"setHeatmapLayerCallback",()=>{this.state.heatmapLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.heatmapLayer)})}componentDidMount(){qn(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} to <LoadScript />? %s',google.maps.visualization),qn(!!this.props.data,"data property is required in HeatmapLayer %s",this.props.data);var t=new google.maps.visualization.HeatmapLayer(jC(jC({},this.props.options),{},{data:this.props.data,map:this.context}));this.registeredEvents=Ti({updaterMap:aY,eventMap:sY,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{heatmapLayer:t}},this.setHeatmapLayerCallback)}componentDidUpdate(t){Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:aY,eventMap:sY,prevProps:t,nextProps:this.props,instance:this.state.heatmapLayer})}componentWillUnmount(){this.state.heatmapLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.heatmapLayer),Li(this.registeredEvents),this.state.heatmapLayer.setMap(null))}render(){return null}}it(Bqe,"contextType",Si);var oY={onCloseClick:"closeclick",onPanoChanged:"pano_changed",onPositionChanged:"position_changed",onPovChanged:"pov_changed",onResize:"resize",onStatusChanged:"status_changed",onVisibleChanged:"visible_changed",onZoomChanged:"zoom_changed"},lY={register(e,t,i){e.registerPanoProvider(t,i)},links(e,t){e.setLinks(t)},motionTracking(e,t){e.setMotionTracking(t)},options(e,t){e.setOptions(t)},pano(e,t){e.setPano(t)},position(e,t){e.setPosition(t)},pov(e,t){e.setPov(t)},visible(e,t){e.setVisible(t)},zoom(e,t){e.setZoom(t)}};class kqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{streetViewPanorama:null}),it(this,"setStreetViewPanoramaCallback",()=>{this.state.streetViewPanorama!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewPanorama)})}componentDidMount(){var t,i,r=(t=(i=this.context)===null||i===void 0?void 0:i.getStreetView())!==null&&t!==void 0?t:null;this.registeredEvents=Ti({updaterMap:lY,eventMap:oY,prevProps:{},nextProps:this.props,instance:r}),this.setState(()=>({streetViewPanorama:r}),this.setStreetViewPanoramaCallback)}componentDidUpdate(t){this.state.streetViewPanorama!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:lY,eventMap:oY,prevProps:t,nextProps:this.props,instance:this.state.streetViewPanorama}))}componentWillUnmount(){this.state.streetViewPanorama!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.streetViewPanorama),Li(this.registeredEvents),this.state.streetViewPanorama.setVisible(!1))}render(){return null}}it(kqe,"contextType",Si);class Uqe extends R.PureComponent{constructor(){super(...arguments),it(this,"state",{streetViewService:null}),it(this,"setStreetViewServiceCallback",()=>{this.state.streetViewService!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewService)})}componentDidMount(){var t=new google.maps.StreetViewService;this.setState(function(){return{streetViewService:t}},this.setStreetViewServiceCallback)}componentWillUnmount(){this.state.streetViewService!==null&&this.props.onUnmount&&this.props.onUnmount(this.state.streetViewService)}render(){return null}}it(Uqe,"contextType",Si);var cY={onDirectionsChanged:"directions_changed"},uY={directions(e,t){e.setDirections(t)},map(e,t){e.setMap(t)},options(e,t){e.setOptions(t)},panel(e,t){e.setPanel(t)},routeIndex(e,t){e.setRouteIndex(t)}};class Fqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"state",{directionsRenderer:null}),it(this,"setDirectionsRendererCallback",()=>{this.state.directionsRenderer!==null&&(this.state.directionsRenderer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.directionsRenderer))})}componentDidMount(){var t=new google.maps.DirectionsRenderer(this.props.options);this.registeredEvents=Ti({updaterMap:uY,eventMap:cY,prevProps:{},nextProps:this.props,instance:t}),this.setState(function(){return{directionsRenderer:t}},this.setDirectionsRendererCallback)}componentDidUpdate(t){this.state.directionsRenderer!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:uY,eventMap:cY,prevProps:t,nextProps:this.props,instance:this.state.directionsRenderer}))}componentWillUnmount(){this.state.directionsRenderer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.directionsRenderer),Li(this.registeredEvents),this.state.directionsRenderer&&this.state.directionsRenderer.setMap(null))}render(){return null}}it(Fqe,"contextType",Si);var hY={onPlacesChanged:"places_changed"},dY={bounds(e,t){e.setBounds(t)}};class Vqe extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"containerElement",R.createRef()),it(this,"state",{searchBox:null}),it(this,"setSearchBoxCallback",()=>{this.state.searchBox!==null&&this.props.onLoad&&this.props.onLoad(this.state.searchBox)})}componentDidMount(){if(qn(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places),this.containerElement!==null&&this.containerElement.current!==null){var t=this.containerElement.current.querySelector("input");if(t!==null){var i=new google.maps.places.SearchBox(t,this.props.options);this.registeredEvents=Ti({updaterMap:dY,eventMap:hY,prevProps:{},nextProps:this.props,instance:i}),this.setState(function(){return{searchBox:i}},this.setSearchBoxCallback)}}}componentDidUpdate(t){this.state.searchBox!==null&&(Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:dY,eventMap:hY,prevProps:t,nextProps:this.props,instance:this.state.searchBox}))}componentWillUnmount(){this.state.searchBox!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.searchBox),Li(this.registeredEvents))}render(){return j.jsx("div",{ref:this.containerElement,children:R.Children.only(this.props.children)})}}it(Vqe,"contextType",Si);var pY={onPlaceChanged:"place_changed"},fY={bounds(e,t){e.setBounds(t)},restrictions(e,t){e.setComponentRestrictions(t)},fields(e,t){e.setFields(t)},options(e,t){e.setOptions(t)},types(e,t){e.setTypes(t)}};class Eae extends R.PureComponent{constructor(){super(...arguments),it(this,"registeredEvents",[]),it(this,"containerElement",R.createRef()),it(this,"state",{autocomplete:null}),it(this,"setAutocompleteCallback",()=>{this.state.autocomplete!==null&&this.props.onLoad&&this.props.onLoad(this.state.autocomplete)})}componentDidMount(){var t;qn(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places);var i=(t=this.containerElement.current)===null||t===void 0?void 0:t.querySelector("input");if(i){var r=new google.maps.places.Autocomplete(i,this.props.options);this.registeredEvents=Ti({updaterMap:fY,eventMap:pY,prevProps:{},nextProps:this.props,instance:r}),this.setState(()=>({autocomplete:r}),this.setAutocompleteCallback)}}componentDidUpdate(t){Li(this.registeredEvents),this.registeredEvents=Ti({updaterMap:fY,eventMap:pY,prevProps:t,nextProps:this.props,instance:this.state.autocomplete})}componentWillUnmount(){this.state.autocomplete!==null&&Li(this.registeredEvents)}render(){return j.jsx("div",{ref:this.containerElement,className:this.props.className,children:R.Children.only(this.props.children)})}}it(Eae,"defaultProps",{className:""});it(Eae,"contextType",Si);const mY="AIzaSyDFEf-Cr8nBoi0BwLkqqjASA24obLVYo6E",jqe=["places"],Hqe={width:"100%",height:"400px"},Gqe={lat:10.8505,lng:76.2711},Wqe=({onLocationSelect:e})=>{const{isLoaded:t,loadError:i}=mae({googleMapsApiKey:mY,libraries:jqe}),[r,n]=R.useState(null),[s,a]=R.useState(""),[o,l]=R.useState(""),c=R.useRef(null),u=R.useCallback(async(p,f)=>{try{const m=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${p},${f}&key=${mY}`)).json();if(console.log("Geocode API Response:",m),m.results.length>0){const g=m.results[0].formatted_address;console.log("Fetched Address:",g),a(g),n({lat:p,lng:f,address:g})}else a("Address not found"),n({lat:p,lng:f,address:"Address not found"})}catch(v){console.error("Error fetching address:",v),a("Error fetching address"),n({lat:p,lng:f,address:"Error fetching address"})}},[]),h=R.useCallback(p=>{const f=p.latLng.lat(),v=p.latLng.lng();n({lat:f,lng:v,address:""}),u(f,v)},[u]),d=()=>{r&&s&&(e({...r,address:s}),alert("Location Selected!"))};return R.useEffect(()=>{if(t&&!i){const p=new window.google.maps.places.Autocomplete(c.current,{types:["geocode"]});p.addListener("place_changed",()=>{const f=p.getPlace();if(!f.geometry||!f.geometry.location){console.error("No location found for the selected place.");return}const v=f.geometry.location.lat(),m=f.geometry.location.lng();n({lat:v,lng:m,address:f.formatted_address}),a(f.formatted_address)})}},[t,i]),i?j.jsx("p",{className:"text-red-500",children:"Error loading maps"}):t?j.jsxs("div",{className:"relative pt-32 mb-10",children:[j.jsx("div",{className:"mb-4",children:j.jsx("input",{type:"text",placeholder:"Search for a location",ref:c,value:o,onChange:p=>l(p.target.value),className:"w-full p-2 border rounded shadow"})}),j.jsx(dXe,{mapContainerStyle:Hqe,zoom:10,center:r||Gqe,onClick:h,children:r&&j.jsx(gae,{position:r},`${r.lat}-${r.lng}`)}),r&&j.jsxs("div",{className:"p-4 border rounded shadow mt-4",children:[j.jsxs("p",{children:[j.jsx("strong",{children:"Latitude:"})," ",r.lat]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Longitude:"})," ",r.lng]}),j.jsxs("p",{children:[j.jsx("strong",{children:"Address:"})," ",r.address||"Fetching address..."]}),j.jsx("button",{className:"mt-3 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition",onClick:d,children:"Select Location"})]})]}):j.jsx("p",{children:"Loading maps..."})},Xqe=()=>{const[e,t]=R.useState(1),[i,r]=R.useState({material:"",type:"",width:"",height:"",diameter:"",area:"",size:"",image:null}),[n,s]=R.useState({room:"",building:"",site:""}),a=()=>{e<3&&t(e+1)},o=()=>{e>1&&t(e-1)},l=()=>{console.log("Product:",i),console.log("Location:",n),alert("Product details submitted successfully!")};return j.jsx("section",{className:"py-20",children:j.jsxs("div",{className:"container mx-auto px-6",children:[j.jsxs(Gt.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.8},viewport:{once:!0},className:"text-center mb-16",children:[j.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:"Upload Your Interior Product"}),j.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Add details about your product to showcase it in our interior design platform."})]}),j.jsxs("div",{className:"bg-black rounded-2xl p-8 shadow-lg max-w-3xl mx-auto",children:[j.jsx("div",{className:"flex justify-center space-x-4 mb-8",children:[1,2,3].map(c=>j.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${e===c?"bg-amber-400 text-black":"bg-gray-200 text-gray-600"}`,children:c},c))}),e===1&&j.jsxs(Gt.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.5},className:"space-y-6",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx(vme,{className:"w-6 h-6 text-amber-400"}),j.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Product Details"})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Material"}),j.jsxs("select",{value:i.material,onChange:c=>r({...i,material:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",children:[j.jsx("option",{value:"",children:"Select Material"}),j.jsx("option",{value:"wood",children:"Wood"}),j.jsx("option",{value:"metal",children:"Metal"}),j.jsx("option",{value:"glass",children:"Glass"}),j.jsx("option",{value:"plastic",children:"Plastic"})]})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),j.jsxs("select",{value:i.type,onChange:c=>r({...i,type:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",children:[j.jsx("option",{value:"",children:"Select Type"}),j.jsx("option",{value:"furniture",children:"Furniture"}),j.jsx("option",{value:"lighting",children:"Lighting"}),j.jsx("option",{value:"decor",children:"Decor"}),j.jsx("option",{value:"appliances",children:"Appliances"})]})]}),j.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Width (cm)"}),j.jsx("input",{type:"number",value:i.width,onChange:c=>r({...i,width:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",placeholder:"Enter width"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Height (cm)"}),j.jsx("input",{type:"number",value:i.height,onChange:c=>r({...i,height:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",placeholder:"Enter height"})]})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image"}),j.jsx("input",{type:"file",onChange:c=>{var u;return r({...i,image:((u=c.target.files)==null?void 0:u[0])||null})},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400"})]})]})]}),e===2&&j.jsxs(Gt.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.5},className:"space-y-6",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx(QB,{className:"w-6 h-6 text-amber-400"}),j.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Location Details"})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Room"}),j.jsx("input",{type:"text",value:n.room,onChange:c=>s({...n,room:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",placeholder:"Enter room"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Building"}),j.jsx("input",{type:"text",value:n.building,onChange:c=>s({...n,building:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",placeholder:"Enter building"})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Site"}),j.jsx("input",{type:"text",value:n.site,onChange:c=>s({...n,site:c.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-amber-400",placeholder:"Enter site"})]})]})]}),e===3&&j.jsxs(Gt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"space-y-6",children:[j.jsxs("div",{className:"flex items-center space-x-3",children:[j.jsx(Ime,{className:"w-6 h-6 text-amber-400"}),j.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Preview"})]}),j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Product Details"}),j.jsxs("p",{className:"text-gray-600",children:["Material: ",i.material]}),j.jsxs("p",{className:"text-gray-600",children:["Type: ",i.type]}),j.jsxs("p",{className:"text-gray-600",children:["Width: ",i.width," cm"]}),j.jsxs("p",{className:"text-gray-600",children:["Height: ",i.height," cm"]})]}),j.jsxs("div",{children:[j.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Location Details"}),j.jsxs("p",{className:"text-gray-600",children:["Room: ",n.room]}),j.jsxs("p",{className:"text-gray-600",children:["Building: ",n.building]}),j.jsxs("p",{className:"text-gray-600",children:["Site: ",n.site]})]}),i.image&&j.jsxs("div",{children:[j.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Product Image"}),j.jsx("img",{src:URL.createObjectURL(i.image),alt:"Product",className:"w-32 h-32 object-cover rounded-lg"})]})]})]}),j.jsxs("div",{className:"flex justify-between mt-8",children:[e>1&&j.jsx("button",{onClick:o,className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors",children:"Previous"}),e<3?j.jsx("button",{onClick:a,className:"px-6 py-2 bg-amber-400 text-black rounded-lg hover:bg-amber-500 transition-colors",children:"Next"}):j.jsx("button",{onClick:l,className:"px-6 py-2 bg-green-500 text-black rounded-lg hover:bg-green-600 transition-colors",children:"Submit"})]})]})]})})},qqe=()=>{const e={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.8,ease:"easeOut"}}},t={initial:{scale:1},animate:{scale:[1,1.1,1],transition:{duration:2,repeat:1/0,ease:"easeInOut"}}};return j.jsx("div",{className:"min-h-screen pt-24 pb-16 flex items-center",children:j.jsxs("div",{className:"container mx-auto px-6 text-center",children:[j.jsxs(Gt.div,{variants:e,initial:"hidden",animate:"visible",className:"relative",children:[j.jsx(Gt.h1,{variants:t,initial:"initial",animate:"animate",className:"text-[150px] md:text-[200px] font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 leading-none mb-8",children:"404"}),j.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:j.jsx("div",{className:"w-full h-40 bg-gradient-to-r from-indigo-500/20 via-purple-500/20 to-pink-500/20 blur-3xl"})}),j.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:"Page Not Found"}),j.jsx("p",{className:"text-xl text-gray-300 mb-8 max-w-lg mx-auto",children:"Oops! The page you're looking for seems to have vanished into the digital void."}),j.jsx(Gt.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:j.jsxs(Zo,{to:"/",className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white rounded-full hover:shadow-lg hover:shadow-indigo-500/50 transition-all duration-300",children:[j.jsx(yJ,{className:"w-5 h-5 mr-2"}),"Back to Home"]})})]}),j.jsxs("div",{className:"absolute inset-0 -z-10 overflow-hidden",children:[j.jsx("div",{className:"absolute top-1/4 left-1/4 w-72 h-72 bg-indigo-500/30 rounded-full filter blur-3xl animate-blob"}),j.jsx("div",{className:"absolute top-3/4 right-1/4 w-72 h-72 bg-purple-500/30 rounded-full filter blur-3xl animate-blob animation-delay-2000"}),j.jsx("div",{className:"absolute bottom-1/4 left-1/2 w-72 h-72 bg-pink-500/30 rounded-full filter blur-3xl animate-blob animation-delay-4000"})]})]})})};function Yqe(){const e=t=>{console.log("Selected Location:",t)};return j.jsx(Uue,{children:j.jsxs("div",{className:"min-h-screen",children:[j.jsx(Bme,{}),j.jsx(eXe,{}),j.jsxs(Rue,{children:[j.jsx(wu,{path:"/",element:j.jsx(H5e,{})}),j.jsx(wu,{path:"/services",element:j.jsx(G5e,{})}),j.jsx(wu,{path:"/portfolio",element:j.jsx(W5e,{})}),j.jsx(wu,{path:"/contact",element:j.jsx(X5e,{})}),j.jsx(wu,{path:"/consultation",element:j.jsx(Pre,{})}),j.jsx(wu,{path:"/upload",element:j.jsx(Xqe,{})}),j.jsx(wu,{path:"/location",element:j.jsx(Wqe,{onLocationSelect:e})}),j.jsx(wu,{path:"*",element:j.jsx(qqe,{})})]}),j.jsx(q5e,{})]})})}PQ(document.getElementById("root")).render(j.jsx(R.StrictMode,{children:j.jsx(Yqe,{})}));export{Zqe as c,gY as g};
